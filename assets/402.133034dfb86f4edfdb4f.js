/*! For license information please see 402.133034dfb86f4edfdb4f.js.LICENSE.txt */
(self.webpackChunkab_platform_web=self.webpackChunkab_platform_web||[]).push([[402],{28893:(t,e,i)=>{const s=i(8030),n=i(69594);t.exports=class extends s{constructor(t,e){super(t,e=e||"ab_work_object_workspace_popupNewDataField");var i=this.Label(),s={component:this.unique(`${e}_popNewField`),types:this.unique(`${e}_popNewField_types`),editDefinitions:this.unique(`${e}_popNewField_editDefinitions`),buttonSave:this.unique(`${e}_popNewField_buttonSave`),buttonCancel:this.unique(`${e}_popNewField_buttonCancel`)};this.ui={view:"window",position:"center",id:s.component,resize:!0,modal:!0,height:500,width:700,head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:i("Add new field"),css:"modal_title",align:"center"},{view:"button",label:i("Close"),autowidth:!0,align:"center",click:function(){_.buttonCancel()}}]},body:{view:"scrollview",scroll:"y",css:"ab-add-fields-popup",borderless:!0,body:{type:"form",rows:[{view:"richselect",id:s.types,label:i("Field type"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:[{id:"temporary",view:"temporary"}],on:{onChange:function(t,e,i){_.onChange(t)}}},{height:10,type:"line"},{view:"multiview",id:s.editDefinitions,padding:0,cells:[{id:"del_me",view:"label",label:i("edit definition here")}]},{height:10},{cols:[{fillspace:!0},{view:"button",value:i("Cancel"),css:"ab-cancel-button",autowidth:!0,click:function(){_.buttonCancel()}},{view:"button",css:"webix_primary",id:s.buttonSave,label:i("Add Column"),autowidth:!0,type:"form",click:function(){_.buttonSave()}}]}]}},on:{onHide:function(){_.resetState()}}};var a={},r={},o={},l=null,h=null,c=null,d=[],u=null;this.init=i=>{for(let t in _.callbacks)_.callbacks[t]=i[t]||_.callbacks[t];webix.ui(this.ui),webix.extend($$(s.component),webix.ProgressBar);var h=n.allFields(),u={view:"multiview",id:s.editDefinitions,animate:!1,rows:[]};h.forEach((function(i){var s=i.defaults().menuName,n=i.defaults().key;d.push({id:s,value:s});var l=i.propertiesComponent(t,e);c||(c=l),u.rows.push(l.ui),a[s]=i,r[s]=l,o[n]=l})),$$(s.types).define("options",d),$$(s.types).refresh(),webix.ui(u,$$(s.editDefinitions));for(let t in r)r[t].init(),r[t].hide();c.show(),l=c,$$(s.types).setValue(d[0].id)};var _=this._logic={applicationLoad:t=>{for(var e in r)r[e]&&r[e]._logic.applicationLoad&&r[e]._logic.applicationLoad(t)},objectLoad:t=>{for(var e in h=t,r)r[e]&&r[e]._logic.objectLoad&&r[e]._logic.objectLoad(h)},buttonCancel:function(){for(var t in _.resetState(),r)r[t].clear();$$(s.component).hide()},buttonSave:async function(){$$(s.buttonSave).disable(),$$(s.component).showProgress();var t=l;if(t)if(t.isValid()){var e,i=this.AB.cloneDeep(t.values()),n=null,a=null;if(u){i.label&&(u.label=i.label),a=u.toObj();var r=this.AB.cloneDeep(a);for(let t in i)if("settings"==t&&i.settings&&"object"==typeof i.settings){r.settings=r.settings||{};for(let t in i.settings)r.settings[t]=i.settings[t]}else r[t]=i[t];u.fromValues(r),n=u}else{var o=20+10*(n=h.fieldNew(i)).label.length;if(n.settings.showIcon&&(o+=20),o<100&&(o=100),n.settings.width=o,"connectObject"==n.key){let t=Math.floor(1e3*Math.random());n.settings.isSource=1;var c=n.datasourceLink;let i=n.columnName;c.fields((t=>t.columnName==i)).length&&(i=`${i}${t}`),"many"==n.settings.linkType&&"many"==n.settings.linkViaType&&(i=`${h.name}${t}`),e=c.fieldNew({key:n.key,columnName:i,label:h.label,settings:{showIcon:n.settings.showIcon,linkObject:n.object.id,linkType:n.settings.linkViaType,linkViaType:n.settings.linkType,isCustomFK:n.settings.isCustomFK,indexField:n.settings.indexField,indexField2:n.settings.indexField2,isSource:0,width:o}})}}var d=n.isValid();if(d.fail())d.updateForm($$(t.ui.id)),a&&n.fromValues(a),$$(s.buttonSave).enable(),$$(s.component).hideProgress();else try{await n.save();let t=()=>{$$(s.buttonSave).enable(),$$(s.component).hideProgress(),l.clear(),_.hide(),_.callbacks.onSave(n)},i=()=>{e.object.model().refresh(),n.object.model().refresh()};null!=e?(e.settings.linkColumn=n.id,await e.save(),n.settings.linkColumn=e.id,await n.save(),u||(await n.migrateCreate(),await e.migrateCreate()),i(),t()):t()}catch(t){}}else $$(s.buttonSave).enable(),$$(s.component).hideProgress();else this.AB.notify.developer(new Error("Could not find the current editor."),{}),$$(s.buttonSave).enable(),$$(s.component).hideProgress()},callbacks:{onCancel:function(){console.warn("NO onCancel()!")},onSave:function(t){console.warn("NO onSave()!")}},hide:function(){$$(s.component).hide()},modeAdd:function(t){if(c.show(!1,!1),l=c,h.isImported&&(t="connectObject"),t){var e=n.allFields().filter((e=>e.defaults().key==t))[0];if(!e)return;var a=e.defaults().menuName;$$(s.types).setValue(a),$$(s.types).disable()}else $$(s.types).enable();$$(s.types).show(),$$(s.buttonSave).define("label",i("Add Column")),$$(s.buttonSave).refresh()},modeEdit:function(t){for(var e in l&&l.hide(),o)e==t.key?(o[e].show(!1,!1),o[e].populate(t),l=o[e]):o[e].hide();if(l&&l.ui&&l.ui.elements){var n=t=>{t.disallowEdit&&$$(t.id)&&$$(t.id).disable&&$$(t.id).disable()};l.ui.elements.forEach((t=>{n(t);var e=t.cols||t.rows;e&&e.forEach&&e.forEach((t=>{n(t)}))}))}$$(s.types).hide(),$$(s.buttonSave).define("label",i("Save")),$$(s.buttonSave).refresh()},onChange:function(t){var e=r[t];e&&(e.show(),l=e,$$(s.types).blur())},resetState:function(){if(l&&l.ui&&l.ui.elements){var t=t=>{t.disallowEdit&&$$(t.id)&&$$(t.id).enable&&$$(t.id).enable()};l.ui.elements.forEach((e=>{t(e);var i=e.cols||e.rows;i&&i.forEach&&i.forEach((e=>{t(e)}))}))}c.show(),l=c,$$(s.types).setValue(d[0].id)},show:function(t,e){(u=t)?_.modeEdit(t):_.modeAdd(e),$$(s.component).show()},typeClick:function(){var t=$$(s.types).config.data[0].submenu;"string"!=typeof t&&($$(s.types).getSubMenu($$(s.types).config.data[0].id),t=$$(s.types).config.data[0].submenu),$$(t)&&$$(t).show()}};this.actions({}),this.applicationLoad=_.applicationLoad,this.objectLoad=_.objectLoad,this.show=_.show}}},43947:(t,e,i)=>{const s=i(8030);t.exports=class extends s{constructor(t,e){super(t,e=e||"ab_work_object_workspace_popupSortFields");var i=this.Label(),s={component:this.unique(`${e}_popupSort`),list:this.unique(`${e}_popupSort_list`),form:this.unique(`${e}_popupSort_form`)},n={view:"form",id:s.form,borderless:!0,elements:[{view:"button",type:"form",css:"webix_primary",value:i("Add new sort"),on:{onItemClick:function(t,e,i){r.clickAddNewSort(),r.triggerOnChange()}}}]};this.ui={view:"popup",id:s.component,width:600,body:n,on:{onShow:function(){r.onShow()}}},this.init=t=>{for(var e in r.callbacks)r.callbacks[e]=t[e]||r.callbacks[e];webix.ui(this.ui)};let a=null;var r=this._logic={callbacks:{onChange:function(){}},clickAddNewSort:function(t,e){var n=$$(s.form),a=n.getChildViews().length-1,o=r.getFieldList(!0);n.addView({id:"sort"+webix.uid(),cols:[{view:"combo",width:220,options:o,on:{onChange:function(t){r.onChangeCombo(t,this)}}},{view:"segmented",width:200,options:[{id:"",value:i("Please select field")}],on:{onChange:function(t,e){r.triggerOnChange()}}},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",width:30,on:{onItemClick:function(){n.removeView(this.getParentView()),r.refreshFieldList(!0),r.triggerOnChange()}}}]},a),t&&n.getChildViews()[a].getChildViews()[0].setValue(t),e&&n.getChildViews()[a].getChildViews()[1].setValue(e)},getFieldList:function(t){$$(s.component);var e=$$(s.form),i=[];if(!a.fields())return i;if(a.fields().forEach((t=>{t.fieldIsSortable()&&i.push({id:t.id,value:t.label})})),t){var n=e.getChildViews();n.length>1&&n.forEach((function(t,e){if(n.length-1<=e)return!1;var s=t.getChildViews()[0].getValue();if(s){var a=null;i.filter((function(t,e){return t.id==s&&(a=e,!0)})),i.splice(a,1)}}))}return i},objectLoad:function(t){a=t},setSettings:t=>{this._settings=this.AB.cloneDeep(t)},getSettings:function(){var t=$$(s.form),e=[],i=t.getChildViews();return i.length>1&&i.forEach((function(t,s){if(i.length-1<=s)return!1;var n=t.getChildViews()[0].getValue(),a=t.getChildViews()[1].getValue();e.push({key:n,dir:a})})),e},onChangeCombo:function(t,e){var s=a.fields(),n="",o=e.getParentView().getChildViews()[1],l=null;if(s.forEach((e=>{e.id==t&&(n=e)})),n){switch(n.key){case"string":default:l=[{id:"asc",value:i("A -> Z")},{id:"desc",value:i("Z -> A")}];break;case"date":l=[{id:"asc",value:i("Before -> After")},{id:"desc",value:i("After -> Before")}];break;case"number":l=[{id:"asc",value:i("1 -> 9")},{id:"desc",value:i("9 -> 1")}]}o.define("options",l),o.refresh(),r.refreshFieldList(),r.triggerOnChange()}},onShow:()=>{var t=$$(s.form);webix.ui(n,t);var e=this._settings;e&&e.forEach&&e.forEach((t=>{r.clickAddNewSort(t.key,t.dir)})),null!=e&&0!=e.length||r.clickAddNewSort()},refreshFieldList:function(t){var e=$$(s.form),i=r.getFieldList(!1),n=[],a=[],o=e.getChildViews();o.length>1&&o.forEach((function(t,e){if(o.length-1<=e)return!1;var s=t.getChildViews()[0].getValue(),r=i.filter((function(t){return t.id==s}));r.length>0?n.push(r[0]):a.push(t)})),t||a.forEach((function(t,i){e.removeView(t)})),(o=e.getChildViews()).length>1&&o.forEach((function(t,e){if(o.length-1<=e)return!1;var s=t.getChildViews()[0].getValue(),a=i.filter((function(t){return t.id==s})),r=n.filter((function(t){return!Array.isArray(a)||-1===a.indexOf(t)})),l=i.filter((function(t){return!Array.isArray(r)||-1===r.indexOf(t)}));t.getChildViews()[0].define("options",l),t.getChildViews()[0].refresh()}))},triggerOnChange:()=>{this._blockOnChange||(this._settings=r.getSettings(),r.callbacks.onChange(this._settings))},blockOnChange:()=>{this._blockOnChange=!0},unblockOnChange:()=>{this._blockOnChange=!1},show:(t,e,i)=>{r.blockOnChange(),$$(s.component).show(t,i||null),e&&r.clickAddNewSort(e),r.unblockOnChange()},sort:function(t,e){var i=0,n=$$(s.form).getChildViews();return n.length>1&&n.forEach((function(s,r){if(!(n.length-1<=r||0!=i)){var o=s.getChildViews()[0].getValue(),l=s.getChildViews()[1].getValue(),h=a.fieldByID(o);if(h){var c=h.columnName,d=t[c],u=e[c];Array.isArray(d)&&(d=(d||[]).map((function(t){return t.text||t})).join(" ")),Array.isArray(u)&&(u=(u||[]).map((function(t){return t.text||t})).join(" ")),d!=u&&(i="asc"==l?d>u?1:-1:d<u?1:-1)}}})),i}};this.actions({}),this.objectLoad=r.objectLoad,this.show=r.show,this.sort=r.sort,this.setValue=r.setSettings,this.getValue=r.getSettings}}},84647:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>q});var s=i(35095),n=i.n(s),a=i(96486),r=i.n(a),o=i(30381),l=i.n(o),h=i(53416),c=i(44586),d=i(10350),u=i(64487),_=i(21021),p=i.n(_),f=i(12804),g=i(17187).EventEmitter;const m=new class extends g{constructor(){super(),this.isAuthenticated=!1,this._config=null,this._listRoles=null,this._listScopes=null,this._listUsers=null}init(t){this.AB=t;var e=this.AB.Config.userConfig();e&&(this.isAuthenticated=!0,this._config=e);var i=this.AB.Config.metaConfig();return i&&(this._listRoles=i.roles||[],this._listScopes=i.scopes||[],this._listUsers=i.users||[]),this.AB.Network.on("account.logout",((t,e,i)=>{e?console.error(e):this.emit("logout",i)})),Promise.resolve()}canSwitcheroo(){return this.roles((t=>"320ef94a-73b5-476e-9db4-c08130c64bb8"===t.uuid)).length>0}isSwitcherood(){return this.AB.Config.userReal()}isSystemDesigner(){return this.roles((t=>"6cc04894-a61b-4fb5-b3e5-b8c3f78bd331"===t.uuid)).length>0}email(){return this._config?.email??""}language(){return this._config?.languageCode??"en"}logout(){return this.AB.Network.post({url:"/auth/logout",data:{tenantUrl:this.AB.Tenant.setting("url")}},{key:"account.logout",context:{}})}roles(t=(()=>!0)){return(this._config?.roles||[]).filter(t)}rolesAll(){return this._listRoles}scopes(){return this._listScopes}username(){return this._config?.username}userList(){return this._listUsers}uuid(){return this._config?.uuid}imageID(){return this._config?.image_id}sendEmailNotifications(){return this._config?.sendEmailNotifications}};var v=i(32735);const b={Alert:function(t){webix.alert({title:t.title||AB.Multilingual.label("opp.dialog.alert.title","*Alert"),text:t.text||t.message||AB.Multilingual.label("opp.dialog.alert.text","*Something is wrong."),ok:t.ok||AB.Multilingual.label("opp.dialog.alert.ok","*OK")})},Confirm:function(t){var e=t.title||AB.Multilingual.label("opp.dialog.confirm.confirmTitle","* Confirm"),i=t.text||t.message||AB.Multilingual.label("opp.dialog.confirm.confirmMsg","* Are you sure you want to do this?"),s=t.labelYes||t.ok||AB.Multilingual.label("opp.common.yes","* yes"),n=t.labelNo||t.cancel||AB.Multilingual.label("opp.common.no","* no");webix.confirm({title:e,text:i,ok:s,cancel:n,callback:function(e){e?t.fnYes&&t.fnYes():t.fnNo&&t.fnNo(),t.callback&&t.callback(e)}})},ConfirmDelete:function(t){this.Confirm({title:t.title||AB.Multilingual.label("opp.dialog.confirm.deleteTitle","* Confirm Delete"),ok:t.ok||AB.Multilingual.label("opp.common.delete","* Delete"),cancel:t.cancel||AB.Multilingual.label("opp.common.cancel","* Cancel"),text:t.text||t.message||AB.Multilingual.label("opp.dialog.confirm.deleteMsg","* Are you sure you want to delete this?",["this"]),callback:function(e){e?t.fnYes&&t.fnYes():t.fnNo&&t.fnNo(),t.callback&&t.callback(e)}})},Message:function(t){var e=t.text||t.message,i=t.timeout||2e3;webix.message({text:e,expire:i})}};var w=i(97069);const y=new class extends w{constructor(){super([],{}),this.isAuthenticated=!1,this._config=null,this._missingLabelID=!1,this._missingLabels={},this._pluginLabelsMissing={}}init(t){return this.AB=t,this.labels=this.AB.Config.labelConfig(),this._languages=this.AB.Config.languageConfig(),this.pluginLabels={},Promise.resolve()}currentLanguage(){return this.AB.Account.language()}label(t,e,i=[],s=!0){void 0===e&&t&&(e=t),2==arguments.length&&Array.isArray(e)&&(i=e,e=t),e=e.replace(/"/g,'\\"'),t=t.replace(/"/g,'\\"');var n=e;"*"==n[0]&&(n=n.slice(1));var a=this.labels[n];return a||(s&&this.postMissingLabel(t,e),a=e),i.forEach(((t,e)=>{var i=`{${e}}`;a=a.replaceAll(i,t)})),a=a.replace(/\\"/g,'"')}labelPlugin(t,e,i=[]){var s=this.label(e,e,i,!1);return s||(s=this.pluginLabels[t][e]),s||(this._pluginLabelsMissing[t]=this._pluginLabelsMissing[t]||{},this._pluginLabelsMissing[t][e]=e,s=e),i.forEach(((t,e)=>{var i=`{${e}}`;s=s.replaceAll(i,t)})),s}languages(){return this._languages}pluginLoadLabels(t,e){this.pluginLabels[t]=e}pluginLabelReport(t){console.warn("missing labels for plugin: ",t),console.warn("current language:",this.currentLanguage());var e=JSON.stringify(this._pluginLabelsMissing[t],null,3);console.warn(e)}postMissingLabel(t,e){this._missingLabelID&&clearTimeout(this._missingLabelID);var i=()=>{var t=[];let e=Object.keys(this._missingLabels).map((t=>this._missingLabels[t]));if(e.length<=50)t=e,this._missingLabels={};else for(var s=0;s<=50;s++){var n=e.shift();t.push(n),delete this._missingLabels[n.key]}this.AB.Network.post({url:"/multilingual/label-missing",data:{labels:JSON.stringify(t)}}).then((()=>{Object.keys(this._missingLabels).length>0&&i()})).catch((t=>{t.toString().indexOf("unable to get")>-1&&console.error("Missing language file for :"+this.currentLanguage())}))};this._missingLabelID=setTimeout((()=>{i()}),1e3),this._missingLabels[t]={key:t,altText:e}}destroy(){return console.error("Multilingual:destroy(): Should not be called."),Promise.resolve()}save(){return console.error("Multilingual:save(): Should not be called."),Promise.resolve()}toObj(){return console.error("Multilingual:toObj(): Should not be called."),{}}toDefinition(){return console.error("Multilingual:toDefinition(): Should not be called."),{}}};var x=i(17187).EventEmitter;const k=i(58459);var C=null;const $=class extends x{constructor(t){super({wildcard:!0,newListener:!1,maxListeners:0}),this.baseURL=null,this.numRetries=3,this._network=t,this.isRealTime=!1}init(t,e){return this.AB=t,C=this.AB.Config.siteConfig(),(e=e||{})&&(this.baseURL=e.baseURL||C.appbuilder.urlCoreServer,this.numRetries=e.networkNumRetries||C.appbuilder.networkNumRetries),Promise.resolve()}get(t,e){t.type=t.type||"GET";var i=t.data||t.params;if(i){var s=["string","number","boolean"],n=Object.keys(i).map((function(t){var e=i[t];return-1==s.indexOf(typeof e)&&(e=JSON.stringify(e)),t+"="+encodeURIComponent(e)})).join("&"),a="?";t.url.indexOf("?")>-1&&(a="&"),t.url=[t.url,n].join(a)}return this._request(t,e)}post(t,e){return t.type=t.type||"POST",this._request(t,e)}put(t,e){return t.type=t.type||"PUT",this._request(t,e)}delete(t,e){return t.type=t.type||"DELETE",this._request(t,e)}isNetworkConnected(){return this._network.isNetworkConnected()}salSend(t){return k(t.url,t).then((t=>t.data))}_request(t,e){if(t._retry=t._retry||0,t._retry>=this.numRetries){var i=new Error(`Too many retries (${this.numRetries}) for ${t.url}`);return i.code="E_TOMANYRETRIES",this.AB.notify.developer(i,{context:"NetworkRest:_request: Too Many Retries"}),e&&this._network.publishResponse(e,i),Promise.reject(i)}return new Promise(((i,s)=>{t.url=t.url||"/","/"==t.url[0]&&(t.url=this.baseURL+t.url),t.headers=t.headers||{},this.AB.Account.authToken&&(t.headers.Authorization=this.AB.Account.authToken),t.headers["Content-type"]="application/json";var n=this.AB.Tenant.id();n&&(t.headers["tenant-token"]=n),this.isNetworkConnected()?(t.method=t.method||t.type,t.timeout=6e3,t.data=t.data||t.params,delete t.params,this.salSend(t).then((t=>{var s=t;e&&this._network.publishResponse(e,null,s),i(s)})).catch((n=>{if("Request timeout"==n.statusText||n.message&&n.message.indexOf("disconnected")>-1)return this.AB.Analytics.log("NetworkRest._request():network connection error detected. Trying again"),t._retry++,void this._request(t).then((t=>{this.AB.warn("*** NetworkRest._request().then(): attempt resolved."),i(t)})).catch((t=>{this.AB.notify.developer(t,{message:"*** NetworkRest._request().catch(): retry failed:"}),s(t)}));403==n.status?this.emit("error.badAuth",n):n.status>=400&&n.status<500?this.emit("error.badRequest",n):n.status>=500&&this.emit("error.badServer",n);var a=null;if(n.responseText)try{a=JSON.parse(n.responseText)}catch(t){}if(a&&"error"==a.status)return 5==a.id||"E_REAUTH"==a.code?void this._network.emit("reauth"):(this.AB.notify.developer(a,{context:"NetworkRest:_request:Error returned from Server (req.ab.error())",data:a.data}),e&&this._network.publishResponse(e,a,null),s(a.data));var r=new Error(`${n.status} ${n.statusText||n.message}: ${t.method} ${t.url}`);return r.response=n.responseText,r.text=n.statusText,r.err=n,r.url=`${t.method} ${t.url}`,this.AB.notify.developer(r,{context:"NetworkRest:_request:Unknown Error returned from server"}),e&&this._network.publishResponse(e,r),s(r)}))):(this.AB.Analytics.log("NetworkRest:_request(): Network is offline. Queuing request."),this._network.queue(t,e).then((()=>{i({status:"queued"})})).catch(s))}))}resend(t,e){return this._request(t,e)}},S=["ab.datacollection.create","ab.datacollection.update","ab.datacollection.stale","ab.datacollection.delete","ab.inbox.create","ab.inbox.update"],I=class extends ${constructor(t){super(t),this.isRealTime=!0,S.forEach((t=>{io.socket.on(t,(e=>{if(t.indexOf("ab.datacollection")>-1&&e.data){let i=this.AB.objectByID(e.objectId);if(i){let s=i.model();if("ab.datacollection.delete"!=t){let i=this.AB.jobID();console.log(`${i} : ${t}:normalization begin`);let n=performance.now();s.normalizeData(e.data);let a=performance.now();console.log(`${i} : ${t}:normalization end:  ${a-n}ms`)}}}this.AB.emit(t,e)}))}))}isNetworkConnected(){return io.socket.isConnected()}salSend(t){return new Promise(((e,i)=>{t.method=t.method.toLowerCase(),io.socket.request(t,((t,s)=>{if(s.statusCode>=400){var n=s.error?s.error.toString():s.body,a=new Error(`Socket Error: ${n}`);a.status=s.statusCode,a.statusText=n,a.responseText=s.body,i(a)}else{if(t instanceof Error)return void i(t);"string"==typeof t&&(t=JSON.parse(t)),t.status&&"error"==t.status?i({status:s.statusCode,responseText:JSON.Stringify(t)}):e(t)}}))}))}};var A=i(17187).EventEmitter;const D=new class extends A{constructor(){super(),this.setMaxListeners(0),this.queueLock=null,this._config=null,this._network=null,this._queueCount=0}init(t){if(this.AB=t,this.queueLock=new this.AB.Lock,this._config=this.AB.Config.siteConfig(),this._config){switch(this._config.appbuilder.networkType){case"relay":break;case"socket":this._network=new I(this);break;default:this._network=new $(this)}return this._network.init(t)}return console.error("??? Why No site config ???"),io&&io.socket?io.socket.on("connected",(()=>{this.queueFlush(),this.idConnectionCheck&&(clearTimeout(this.idConnectionCheck),this.idConnectionCheck=null)})):(console.error("!!! Network.init() : Did not find io.socket"),window.addEventListener("online",(()=>this.queueFlush()))),Promise.resolve()}get isRealTime(){return this._network.isRealTime}get(...t){return this._network.get(...t).then((t=>this.normalizeData(t)))}post(...t){return this._network.post(...t).then((t=>this.normalizeData(t)))}put(...t){return this._network.put(...t).then((t=>this.normalizeData(t)))}delete(...t){return this._network.delete(...t).then((t=>this.normalizeData(t)))}_connectionCheck(){this.isNetworkConnected()?(this.queueFlush().catch((()=>{this.idConnectionCheck=setTimeout((()=>{this._connectionCheck()}),250)})),this.idConnectionCheck=null):this.idConnectionCheck=setTimeout((()=>{this._connectionCheck()}),250)}networkStatus(){return navigator.connection.type}isNetworkConnected(){return io&&io.socket&&io.socket.isConnected?io.socket.isConnected():"undefined"==typeof Connection?navigator.onLine:this.networkStatus()!=Connection.NONE}publishResponse(t,e,i){i&&(i=this.normalizeData(i)),this.emit(t.key,t.context,e,i)}normalizeData(t){return"error"===t.status?t:t.data||t}refQueue(){return"networkQueue"}queueCount(){return this._queueCount}queue(t,e){var i=this.refQueue();return new Promise(((s,n)=>{this.queueLock.acquire().then((()=>this.AB.Storage.get(i))).then((s=>((s=s||[]).push({data:t,jobResponse:e}),this.AB.log(`:::: ${s.length} request${s.length>1?"s":""} queued`),this._queueCount=s.length,this.AB.Storage.set(i,s)))).then((()=>{this.emit("queued"),this.idConnectionCheck||this._connectionCheck(),this.queueLock.release(),s()})).catch((t=>{this.AB.notify.developer(t,{message:"Error while queueing data"}),this.AB.Analytics.logError(t),n(t),this.queueLock.release()}))}))}queueFlush(){var t=this.refQueue();if(!this.isNetworkConnected()){var e=new Error("Not connected to the internet.");return e.code="E_NOTCONNECTED",Promise.reject(e)}return new Promise(((e,i)=>{this.queueLock.acquire().then((()=>this.AB.Storage.get(t))).then((t=>{t=t||[];var e=i=>{if(0==t.length)i();else{var s=t.shift(),n=s.data,a=s.jobResponse;this._network.resend(n,a).then((()=>{e(i)})).catch((t=>{t&&"E_TOMANYRETRIES"==t.code?i(t):e(i)}))}};return new Promise(((t,i)=>{e((e=>{e?i(e):t()}))}))})).then((()=>(this._queueCount=0,this.AB.Storage.set(t,[])))).then((()=>(this.emit("queue.synced"),this.queueLock.release()))).then((()=>{e()})).catch((t=>{this.AB.notify.developer(t,{message:"commAPI queueFlush error"}),this.AB.Analytics.logError(t),this.queueLock.release().then((()=>{i(t)}))}))}))}reset(){return Promise.resolve()}type(){return this._config.appbuilder.networkType}getTokens(){return{}}};var E=i(17187).EventEmitter;const j=new class extends E{constructor(){super(),this.tenantStorage=null}init(t){this.AB=t;var e=this.AB.Tenant.id();return e||(e="noAuth"),this.tenantStorage=this.AB.Webix.storage.prefix(e,this.AB.Webix.storage.local),Promise.resolve()}set(t,e){return Promise.resolve().then((()=>this.tenantStorage.put(t,e)))}get(t){return Promise.resolve().then((()=>this.tenantStorage.get(t)))}clear(t){return Promise.resolve().then((()=>this.tenantStorage.remove(t)))}clearAll(){return Promise.resolve().then((()=>this.tenantStorage.clear()))}};var V=i(17187).EventEmitter;const N=new class extends V{constructor(){super(),this.tenantStorage=null,this._config=null,this._storage=null}init(t){this.AB=t;var e=this.AB.Config.siteConfig();return e?(e.storage&&e.storage.encrypted?(console.error("TODO: Implement Encrypted Storage"),this._storage=j):this._storage=j,this._storage.init(t)):(console.error("??? Why No site config ???"),Promise.resolve())}set(...t){return this._storage.set(...t)}get(...t){return this._storage.get(...t)}clear(...t){return this._storage.clear(...t)}clearAll(...t){return this._storage.clearAll(...t)}};var T=i(15753),F=i.n(T),P=i(17187).EventEmitter;const B=new class extends P{constructor(){super(),this.text=!1,this._config=null,this.textClickToEnter=null}init(){var t=f.Z.tenantConfig();if(t){if("string"==typeof t.options||t.options instanceof String)try{t.options=JSON.parse(t.options)}catch(t){console.error(t)}this._config=t,this.textClickToEnter=t.options.textClickToEnter}return Promise.resolve()}id(){return this._config&&"??"!=this._config.id?this._config.id:null}setting(t,e){if(this._config)return e?void(this._config.options[t]=e):this._config.options[t]}},M={appListRowHeight:67,buttonWidthLarge:200,buttonWidthMedium:150,buttonWidthSmall:100,buttonWidthExtraSmall:50,tabWidthLarge:200,tabWidthMedium:120,tabWidthSmall:100,tabWidthExtraSmall:50,columnWidthXLarge:350,columnWidthLarge:250,columnWidthMedium:200,columnWidthSmall:150,columnWidthExtraSmall:100,xSmallSpacer:5,smallSpacer:10,mediumSpacer:25,largeSpacer:50,xLargeSpacer:100,xxLargeSpacer:200,xxxLargeSpacer:400,appListSpacerRowHeight:100,appListSpacerColMinWidth:100,appListSpacerColMaxWidth:200,objectWorkspaceColWidth:20,labelWidthSmall:50,labelWidthMedium:80,labelWidthLarge:120,labelWidthXLarge:150,labelWidthXXLarge:200,labelWidthXXXLarge:280,labelWidthCheckbox:0,hideMobile:!1},O={appListRowHeight:67,buttonWidthLarge:200,buttonWidthMedium:150,buttonWidthSmall:100,buttonWidthExtraSmall:50,tabWidthLarge:200,tabWidthMedium:120,tabWidthSmall:100,tabWidthExtraSmall:50,columnWidthLarge:250,columnWidthMedium:200,columnWidthSmall:150,columnWidthExtraSmall:100,xSmallSpacer:1,smallSpacer:1,mediumSpacer:10,largeSpacer:20,xLargeSpacer:50,xxLargeSpacer:100,xxxLargeSpacer:120,appListSpacerRowHeight:10,appListSpacerColMinWidth:1,appListSpacerColMaxWidth:1,objectWorkspaceColWidth:1,labelWidthSmall:50,labelWidthMedium:80,labelWidthLarge:120,labelWidthXLarge:120,labelWidthXXLarge:120,labelWidthCheckbox:0,hideMobile:!0},L={config:function(){return window.innerWidth<768?O:M},icons:["500px","address-book","address-book-o","address-card","address-card-o","adjust","adn","align-center","align-justify","align-left","align-right","amazon","ambulance","american-sign-language-interpreting","anchor","android","angellist","angle-double-down","angle-double-left","angle-double-right","angle-double-up","angle-down","angle-left","angle-right","angle-up","apple","archive","area-chart","arrow-circle-down","arrow-circle-left","arrow-circle-o-down","arrow-circle-o-left","arrow-circle-o-right","arrow-circle-o-up","arrow-circle-right","arrow-circle-up","arrow-down","arrow-left","arrow-right","arrow-up","arrows","arrows-alt","arrows-h","arrows-v","asl-interpreting","assistive-listening-systems","asterisk","at","audio-description","automobile","backward","balance-scale","ban","bandcamp","bank","bar-chart","bar-chart-o","barcode","bars","bath","bathtub","battery","battery-0","battery-1","battery-2","battery-3","battery-4","battery-empty","battery-full","battery-half","battery-quarter","battery-three-quarters","bed","beer","behance","behance-square","bell","bell-o","bell-slash","bell-slash-o","bicycle","binoculars","birthday-cake","bitbucket","bitbucket-square","bitcoin","black-tie","blind","bluetooth","bluetooth-b","bold","bolt","bomb","book","bookmark","bookmark-o","braille","briefcase","btc","bug","building","building-o","bullhorn","bullseye","bus","buysellads","cab","calculator","calendar","calendar-check-o","calendar-minus-o","calendar-o","calendar-plus-o","calendar-times-o","camera","camera-retro","car","caret-down","caret-left","caret-right","caret-square-o-down","caret-square-o-left","caret-square-o-right","caret-square-o-up","caret-up","cart-arrow-down","cart-plus","cc","cc-amex","cc-diners-club","cc-discover","cc-jcb","cc-mastercard","cc-paypal","cc-stripe","cc-visa","certificate","chain","chain-broken","check","check-circle","check-circle-o","check-square","check-square-o","chevron-circle-down","chevron-circle-left","chevron-circle-right","chevron-circle-up","chevron-down","chevron-left","chevron-right","chevron-up","child","chrome","circle","circle-o","circle-o-notch","circle-thin","clipboard","clock-o","clone","close","cloud","cloud-download","cloud-upload","cny","code","code-fork","codepen","codiepie","coffee","cog","cogs","columns","comment","comment-o","commenting","commenting-o","comments","comments-o","compass","compress","connectdevelop","contao","copy","copyright","creative-commons","credit-card","credit-card-alt","crop","crosshairs","css3","cube","cubes","cut","cutlery","dashboard","dashcube","database","deaf","deafness","dedent","delicious","desktop","deviantart","diamond","digg","dollar","dot-circle-o","download","dribbble","drivers-license","drivers-license-o","dropbox","drupal","edge","edit","eercast","eject","ellipsis-h","ellipsis-v","empire","envelope","envelope-o","envelope-open","envelope-open-o","envelope-square","envira","eraser","etsy","eur","euro","exchange","exclamation","exclamation-circle","exclamation-triangle","expand","expeditedssl","external-link","external-link-square","eye","eye-slash","eyedropper","fa","facebook","facebook-f","facebook-official","facebook-square","fast-backward","fast-forward","fax","feed","female","fighter-jet","file","file-archive-o","file-audio-o","file-code-o","file-excel-o","file-image-o","file-movie-o","file-o","file-pdf-o","file-photo-o","file-picture-o","file-powerpoint-o","file-sound-o","file-text","file-text-o","file-video-o","file-word-o","file-zip-o","files-o","film","filter","fire","fire-extinguisher","firefox","first-order","flag","flag-checkered","flag-o","flash","flask","flickr","floppy-o","folder","folder-o","folder-open","folder-open-o","font","font-awesome","fonticons","fort-awesome","forumbee","forward","foursquare","free-code-camp","frown-o","futbol-o","gamepad","gavel","gbp","ge","gear","gears","genderless","get-pocket","gg","gg-circle","gift","git","git-square","github","github-alt","github-square","gitlab","gittip","glass","glide","glide-g","globe","google","google-plus","google-plus-circle","google-plus-official","google-plus-square","google-wallet","graduation-cap","gratipay","grav","group","h-square","hacker-news","hand-grab-o","hand-lizard-o","hand-o-down","hand-o-left","hand-o-right","hand-o-up","hand-paper-o","hand-peace-o","hand-pointer-o","hand-rock-o","hand-scissors-o","hand-spock-o","hand-stop-o","handshake-o","hard-of-hearing","hashtag","hdd-o","header","headphones","heart","heart-o","heartbeat","history","home","hospital-o","hotel","hourglass","hourglass-1","hourglass-2","hourglass-3","hourglass-end","hourglass-half","hourglass-o","hourglass-start","houzz","html5","i-cursor","id-badge","id-card","id-card-o","ils","image","imdb","inbox","indent","industry","info","info-circle","inr","instagram","institution","internet-explorer","intersex","ioxhost","italic","joomla","jpy","jsfiddle","key","keyboard-o","krw","language","laptop","lastfm","lastfm-square","leaf","leanpub","legal","lemon-o","level-down","level-up","life-bouy","life-buoy","life-ring","life-saver","lightbulb-o","line-chart","link","linkedin","linkedin-square","linode","linux","list","list-alt","list-ol","list-ul","location-arrow","lock","long-arrow-down","long-arrow-left","long-arrow-right","long-arrow-up","low-vision","magic","magnet","mail-forward","mail-reply","mail-reply-all","male","map","map-marker","map-o","map-pin","map-signs","mars","mars-double","mars-stroke","mars-stroke-h","mars-stroke-v","maxcdn","meanpath","medium","medkit","meetup","meh-o","mercury","microchip","microphone","microphone-slash","minus","minus-circle","minus-square","minus-square-o","mixcloud","mobile","mobile-phone","modx","money","moon-o","mortar-board","motorcycle","mouse-pointer","music","navicon","neuter","newspaper-o","object-group","object-ungroup","odnoklassniki","odnoklassniki-square","opencart","openid","opera","optin-monster","outdent","pagelines","paint-brush","paper-plane","paper-plane-o","paperclip","paragraph","paste","pause","pause-circle","pause-circle-o","paw","paypal","pencil","pencil-square","pencil-square-o","percent","phone","phone-square","photo","picture-o","pie-chart","pied-piper","pied-piper-alt","pied-piper-pp","pinterest","pinterest-p","pinterest-square","plane","play","play-circle","play-circle-o","plug","plus","plus-circle","plus-square","plus-square-o","podcast","power-off","print","product-hunt","puzzle-piece","qq","qrcode","question","question-circle","question-circle-o","quora","quote-left","quote-right","ra","random","ravelry","rebel","recycle","reddit","reddit-alien","reddit-square","refresh","registered","remove","renren","reorder","repeat","reply","reply-all","resistance","retweet","rmb","road","rocket","rotate-left","rotate-right","rouble","rss","rss-square","rub","ruble","rupee","s15","safari","save","scissors","scribd","search","search-minus","search-plus","sellsy","send","send-o","server","share","share-alt","share-alt-square","share-square","share-square-o","shekel","sheqel","shield","ship","shirtsinbulk","shopping-bag","shopping-basket","shopping-cart","shower","sign-in","sign-language","sign-out","signal","signing","simplybuilt","sitemap","skyatlas","skype","slack","sliders","slideshare","smile-o","snapchat","snapchat-ghost","snapchat-square","snowflake-o","soccer-ball-o","sort","sort-alpha-asc","sort-alpha-desc","sort-amount-asc","sort-amount-desc","sort-asc","sort-desc","sort-down","sort-numeric-asc","sort-numeric-desc","sort-up","soundcloud","space-shuttle","spinner","spoon","spotify","square","square-o","stack-exchange","stack-overflow","star","star-half","star-half-empty","star-half-full","star-half-o","star-o","steam","steam-square","step-backward","step-forward","stethoscope","sticky-note","sticky-note-o","stop","stop-circle","stop-circle-o","street-view","strikethrough","stumbleupon","stumbleupon-circle","subscript","subway","suitcase","sun-o","superpowers","superscript","support","table","tablet","tachometer","tag","tags","tasks","taxi","telegram","television","tencent-weibo","terminal","text-height","text-width","th","th-large","th-list","themeisle","thermometer","thermometer-0","thermometer-1","thermometer-2","thermometer-3","thermometer-4","thermometer-empty","thermometer-full","thermometer-half","thermometer-quarter","thermometer-three-quarters","thumb-tack","thumbs-down","thumbs-o-down","thumbs-o-up","thumbs-up","ticket","times","times-circle","times-circle-o","times-rectangle","times-rectangle-o","tint","toggle-down","toggle-left","toggle-off","toggle-on","toggle-right","toggle-up","trademark","train","transgender","transgender-alt","trash","trash-o","tree","trello","tripadvisor","trophy","truck","try","tty","tumblr","tumblr-square","turkish-lira","tv","twitch","twitter","twitter-square","umbrella","underline","undo","universal-access","university","unlink","unlock","unlock-alt","unsorted","upload","usb","usd","user","user-circle","user-circle-o","user-md","user-o","user-plus","user-secret","user-times","users","vcard","vcard-o","venus","venus-double","venus-mars","viacoin","viadeo","viadeo-square","video-camera","vimeo","vimeo-square","vine","vk","volume-control-phone","volume-down","volume-off","volume-up","warning","wechat","weibo","weixin","whatsapp","wheelchair","wheelchair-alt","wifi","wikipedia-w","window-close","window-close-o","window-maximize","window-minimize","window-restore","windows","won","wordpress","wpbeginner","wpexplorer","wpforms","wrench","xing","xing-square","y-combinator","y-combinator-square","yahoo","yc","yc-square","yelp","yen","yoast","youtube","youtube-play","youtube-square"]};var R=i(93794);class z{constructor(t){this.AB=t,this.errors=[]}addError(t,e){this.errors.push({name:t,message:e})}pass(){return 0==this.errors.length}fail(){return this.errors.length>0}toValidationObject(){var t={error:"E_VALIDATION",invalidAttributes:{}},e=t.invalidAttributes;return this.errors.forEach((t=>{e[t.name]=e[t.name]||[],e[t.name].push(t)})),t}updateForm(t){var e=this.toValidationObject();this.AB.Validation.isFormValidationError(e,t)}updateGrid(t,e){var i=this.toValidationObject();this.AB.Validation.isGridValidationError(i,t,e)}}class H extends(n()){constructor(t){super(t),this.Config=f.Z,this.Account=m,this.Dialog=b,this.Multilingual=y,this.Network=D,this.Storage=N,this.Tenant=B,this.Webix=R,this.ClassUI=v.Z,this.Class.FilterComplex=p(),this.Class.ABViewManager=F(),this.Analytics={log:()=>{},logError:()=>{}},this.Lock=class{constructor(){}acquire(){return Promise.resolve()}release(){return Promise.resolve()}},this.UISettings=L,this.Validation={validator:()=>new z(this),errorSailsCleanup:function(t){return t&&(t.error&&"E_UNKNOWN"==t.error&&t.raw&&t.raw.length>0&&(t=t.raw[0]),t.err&&(t=t.err),t.data&&t.data.error&&"E_VALIDATION"==t.data.error&&(t=t.data)),t},isFormValidationError:function(t,e){var i=!1;if(t&&((t=this.errorSailsCleanup(t)).error&&"E_VALIDATION"==t.error||t.code&&"E_VALIDATION"==t.code)){var s=t.invalidAttributes;if(s){var n=!1;for(var a in s)if(e.elements[a]){var r=s[a],o=[];r.forEach((function(t){o.push(t.message)})),e.markInvalid(a,o.join(", ")),i||(e.elements[a].focus(),i=!0),n=!0}if(n)return!0}}return!1},isGridValidationError:function(t,e,i){if(t&&((t=this.errorSailsCleanup(t)).error&&"E_VALIDATION"==t.error||t.code&&"E_VALIDATION"==t.code)){var s=t.invalidAttributes;if(s){var n=!1;for(var a in s){i.addCellCss(e,a,"webix_invalid"),i.addCellCss(e,a,"webix_invalid_cell");var r=[];s[a].forEach((t=>{r.push(t.message)})),webix.alert({text:a+": "+r.join(", ")}),n=!0}if(i.refresh(e),i.clearSelection(),n)return!0}}return!1}},this.Definitions={},this.on("error",(t=>{console.error(t)})),this._plugins=[],this._pendingNetworkRequests={},this.Network.on("definition.create",((t,e,i)=>{var s=this._pendingNetworkRequests[t.uuid];if(e)return void s?.reject(e);var n={id:i.id,data:i};this.emit("ab.abdefinition.create",n);let a=this.definitionNew(i);s?.resolve(a)})),this.Network.on("definition.update",((t,e,i)=>{var s=this._pendingNetworkRequests[t.uuid];if(e)return e.toString().indexOf("Not Found")>-1?this.definitionCreate(t.values).then(s?.resolve).catch(s?.reject):void s?.reject(e);this._definitions[t.id]=i;var n={id:i.id,data:i};this.emit("ab.abdefinition.update",n),s?.resolve(i)})),this.Network.on("definition.delete",((t,e,i)=>{var s=this._pendingNetworkRequests[t.uuid];if(e)s?.reject(e);else{delete this._definitions[t.id];var n={id:t.id,data:i};this.emit("ab.abdefinition.delete",n),s?.resolve()}}));const e={toDate:(t="",e={})=>{if(!t)return;e.ignoreTime&&(t=t.replace(/T.*/,""));let i=e.format?l()(t,e.format):l()(t);return["YYYY-MM-DD","YYYY/MM/DD","DD/MM/YYYY","MM/DD/YYYY","DD-MM-YYYY","MM-DD-YYYY"].forEach((e=>{i&&i.isValid()||(i=l()(t,e))})),new Date(i)},toDateFormat:(t,e)=>{if(!t)return"";let i=l()(t);return e.localeCode&&i.locale(e.localeCode),i.format(e.format)},subtractDate:(t,e,i)=>l()(t).subtract(e,i).toDate(),addDate:(t,e,i)=>l()(t).add(e,i).toDate()};(Object.keys(e)||[]).forEach((t=>{this.rules[t]=e[t]}))}async init(){var t=[];t.push(this.Account.init(this)),t.push(this.Multilingual.init(this)),t.push(this.Network.init(this)),t.push(this.Tenant.init(this)),await Promise.all(t),await this.Storage.init(this);var e=await this.Storage.get("local_settings");return this._localSettings=e||{},this.on("ab.abdefinition.create",(t=>{if("string"==typeof t.data.json)try{t.data.json=JSON.parse(t.data.json)}catch(t){console.log(t)}this._definitions[t.id]=t.data,this.definitionSync("created",t.id,t.data)})),this.on("ab.abdefinition.update",(t=>{if("string"==typeof t.data.json)try{t.data.json=JSON.parse(t.data.json)}catch(t){console.log(t)}this._definitions[t.id]=t.data,this.definitionSync("updated",t.id,t.data)})),this.on("ab.abdefinition.delete",(t=>{if("string"==typeof t.data.json)try{t.data.json=JSON.parse(t.data.json)}catch(t){console.log(t)}delete this._definitions[t.id],this.definitionSync("destroyed",t.id,t.data)})),super.init()}async definitionCreate(t){return void 0===t.id&&(t.id=this.uuid(),t.json.id=t.id),new Promise(((e,i)=>{var s=this.uuid();this._pendingNetworkRequests[s]={resolve:e,reject:i};var n={key:"definition.create",context:{uuid:s}};this.Network.post({url:"/definition/create",data:t},n).catch((e=>{var i="Error attempting to CREATE definitions";"E_NOPERM"==e.code&&(i="User Doesn't have permission to CREATE definitions"),this.notify.developer(e,{context:"ABFactory.definitionCreate()",message:i,def:t})}))}))}async definitionDestroy(t){return new Promise(((e,i)=>{var s=this.uuid();this._pendingNetworkRequests[s]={resolve:e,reject:i};var n={key:"definition.delete",context:{id:t,uuid:s}};this.Network.delete({url:`/definition/${t}`},n).catch((e=>{var i="Error attempting to DESTROY definitions";"E_NOPERM"==e.code&&(i="User Doesn't have permission to DELETE definitions"),this.notify.developer(e,{context:"ABFactory.definitionDestroy()",message:i,id:t})}))}))}async definitionUpdate(t,e){return new Promise(((i,s)=>{var n=this.uuid();this._pendingNetworkRequests[n]={resolve:i,reject:s};var a={key:"definition.update",context:{id:t,uuid:n,values:e}};this.Network.put({url:`/definition/${t}`,data:e},a).catch((t=>{var e="Error attempting to UPDATE definitions";"E_NOPERM"==t.code&&(e="User Doesn't have permission to UPDATE definitions"),this.notify.developer(t,{context:"ABFactory.definitionUpdate()",message:e})}))}))}notify(t,e,i){const s=new d.s;"builder"==t&&s.setLevel("warning"),s.setTag("domain",t),s.setContext("info",i),u.Tb(e,s),console.error(e),console.error(i)}plugins(){return this._plugins}pluginLoad(t){this._plugins.push(t)}alert(t){R.alert(t)}cloneDeep(t){return r().cloneDeep(t)}error(t,...e){var i={message:`ABFactory[${this.Tenant.id()}]:${t.toString()}`};console.error(i.message),t instanceof Error&&(i.error=t,console.error(t)),e&&e.length>0&&e.forEach((t=>{if(t instanceof Error&&(i.error=t,console.error(t)),"object"==typeof t)for(var e in t)i[e]=t[e],console.error(e,t[e])})),this.emit("error",i)}jobID(){return(0,h.x0)()}Label(){return(...t)=>this.Multilingual.label(...t)}localSettings(t,e){return void 0===e?this._localSettings[t]:(this._localSettings[t]=e,this.Storage.set("local_settings",this._localSettings))}log(t,...e){console.log(t),e.forEach((t=>{console.log(t)}))}isUUID(t){return RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$","i").test(t)}merge(...t){return r().merge(...t)}orderBy(...t){return r().orderBy(...t)}uniq(...t){return r().uniq(...t)}kebabCase(...t){return r().kebabCase(...t)}sumBy(...t){return r().sumBy(...t)}meanBy(...t){return r().meanBy(...t)}maxBy(...t){return r().maxBy(...t)}minBy(...t){return r().minBy(...t)}uuid(){return(0,c.Z)()}warn(t,...e){console.warn(t),e.forEach((t=>{console.warn(t)}))}isString(...t){return r().isString(t)}}const q=H},69885:(t,e,i)=>{const s=i(44312);var n=i(97069);t.exports=class extends n{constructor(t,e){super(["label","description"],e),t.json=t.json||{},this.id=t.id,this.type=t.type||"application",this.json=t.json,"string"==typeof this.json&&(this.json=JSON.parse(this.json)),this.json.versionData=t.json?.versionData||{versionNumber:"1.0.0",changeLog:{"1.0.0":{author:"N/A",version:"1.0.0",keepVersion:0,commitMessage:"Initial Version",timestamp:(new Date).toISOString()}}},"string"==typeof this.json.versionData&&(this.json.versionData=JSON.parse(this.json.versionData)),this.name=t.name||this.json.name||"",this.icon=t.icon||"fa-rocket",this.isSystemObject=function(t){return void 0!==t&&""!==t&&"false"!==t&&"0"!==t&&("true"===t||"1"===t||t)}(t.isSystemObject),this.roleAccess=t.roleAccess||[],Array.isArray(this.roleAccess)||(this.roleAccess=[this.roleAccess]),this.roleAccess=this.roleAccess.filter((t=>t)),this.isAccessManaged=JSON.parse(t.isAccessManaged||!1),this.accessManagers=t.accessManagers,"string"==typeof this.accessManagers&&(this.accessManagers=JSON.parse(this.accessManagers)),this.isTranslationManaged=JSON.parse(t.isTranslationManaged||!1),this.translationManagers=t.translationManagers,"string"==typeof this.translationManagers&&(this.translationManagers=JSON.parse(this.translationManagers)),this.isTutorialManaged=JSON.parse(t.isTutorialManaged||!1),this.tutorialManagers=t.tutorialManagers,"string"==typeof this.tutorialManagers&&(this.tutorialManagers=JSON.parse(this.tutorialManagers)),this.hintIDs=t.json.hintIDs||[],this.objectIDs=t.json.objectIDs||[],this.queryIDs=t.json.queryIDs||[],this.datacollectionIDs=t.json.datacollectionIDs||[];let i=[];(t.json.pageIDs||[]).forEach((t=>{var e=this.AB.definitionByID(t);e?i.push(this.pageNew(e)):this.emit("warning",`App[${this.id}] is referenceing an unknown Page[${t}]`,{appID:this.id,pageID:t})})),this._pages=i,(t.json.processIDs||[]).forEach((t=>{this.AB.processByID(t)||this.emit("warning","Application is referencing an unknown process.",{appID:this.id,processID:t})})),this.processIDs=t.json.processIDs||[],t.json.objectListSettings=t.json.objectListSettings||{},this.objectListSettings=this.objectListSettings||{},this.objectListSettings.isOpen=JSON.parse(t.json.objectListSettings.isOpen||!1),this.objectListSettings.searchText=t.json.objectListSettings.searchText||"",this.objectListSettings.sortDirection=t.json.objectListSettings.sortDirection||"asc",this.objectListSettings.isGroup=JSON.parse(t.json.objectListSettings.isGroup||!1),t.translations=t.translations||t.json.translations,super.fromValues(t)}isAccessibleForRoles(t){var e=!1;return this.isAccessManaged?(parseInt(this.accessManagers.useRole)&&(t||[]).forEach((t=>{this.accessManagers.role.indexOf(t.uuid||t)>-1&&(e=!0)})),e||((this.pages()||[]).forEach((i=>{i.isAccessibleForRoles(t)&&(e=!0)})),e)):((t||[]).forEach((t=>{this.roleAccess.indexOf(t.uuid||t)>-1&&(e=!0)})),e)}toObj(){let t=this.json.versionData;return this.json=super.toObj(),this.json.name=this.name,this.json.versionData=t,this.json.objectIDs=this.objectIDs,this.json.objectListSettings=this.objectListSettings,this.json.hintIDs=this.hintIDs,this.json.queryIDs=this.queryIDs,this.json.datacollectionIDs=this.datacollectionIDs,this.json.pageIDs=(this._pages||[]).map((t=>t.id)),this.json.processIDs=this.processIDs||[],{id:this.id,type:this.type||"application",name:this.name,icon:this.icon,isSystemObject:this.isSystemObject,json:this.json,roleAccess:this.roleAccess,translations:this.json.translations,isAccessManaged:this.isAccessManaged,isTranslationManaged:this.isTranslationManaged,isTutorialManaged:this.isTutorialManaged,accessManagers:this.accessManagers,translationManagers:this.translationManagers,tutorialManagers:this.tutorialManagers}}mobileApps(t=(()=>!0)){return(this._mobileApps||[]).filter(t)}datacollectionsExcluded(t=(()=>!0)){return this.AB.datacollections((t=>-1==this.datacollectionIDs.indexOf(t.id))).filter(t)}datacollectionsIncluded(t=(()=>!0),e){const i=e??((t,e)=>t.label.localeCompare(e.label));return this.AB.datacollections((t=>this.datacollectionIDs.indexOf(t.id)>-1)).filter(t).sort(i)}objectsExcluded(t=(()=>!0)){return this.AB.objects((t=>-1==this.objectIDs.indexOf(t.id))).filter(t)}objectsIncluded(t=(()=>!0),e){const i=e??((t,e)=>t.label.localeCompare(e.label));return this.AB.objects((t=>this.objectIDs.indexOf(t.id)>-1)).filter(t).sort(i)}hintsExcluded(t=(()=>!0)){return this.AB.hints((t=>-1==this.hintIDs.indexOf(t.id))).filter(t)}hintsIncluded(t=(()=>!0),e){const i=e??((t,e)=>t.label.localeCompare(e.label));return this.AB.hints((t=>this.hintIDs.indexOf(t.id)>-1)).filter(t).sort(i)}connectedObjects(t){if(console.error("ABApplicationCore.connectedObjects(): who is calling this?"),""==t)return[];var e=this.AB.objectByID(t).connectFields(),i={};e.forEach((t=>{i[t.settings.linkObject]=this.AB.objectByID(t.settings.linkObject)}));var s=[];return Object.keys(i).forEach((function(t){s.push({id:this[t].id,value:this[t].label})}),i),s}connectedFields(t,e){console.error("!!! Who is calling this?");var i=this.AB.objectByID(t).connectFields((t=>t.settings.linkObject==e)),s=[];return i.forEach((t=>{s.push({id:t.columnName,value:t.label})})),s}pages(t=(()=>!0),e=!1){var i=[];return!this._pages||this._pages.length<1||(t&&e?(i=this._pages.filter(t)).length<1&&this._pages.forEach((s=>{var n=s.pages(t,e);n&&n.length>0&&(i=n)})):i=(this._pages||[]).filter(t)),i}processes(t=(()=>!0)){return this.AB.processes((t=>this.processIDs.indexOf(t.id)>-1)).filter(t)}hasProcess(t){return!(!t||!t.id)&&this.processIDs.indexOf(t.id)>-1}views(t){var e=[],i=[],s=[];return(!this._pages||this._pages.length<1)&&(!this._views||this._views.length<1)||(t?(this._views&&(i=this._views.filter(t)).length<1&&this._views.forEach((e=>{var s=e.views(t,!0);s&&s.length>0&&(i=s)})),i.length?e=i:(e=this._pages.filter(t)).length<1&&function i(s){s._pages&&s._pages.length&&s._pages.forEach((s=>{var n=s.views(t,!0);if(n&&n.length>0&&(e=n),e.length<1){var a=s.pages(t,!0);a&&a.length>0&&(e=a),e.length<1&&i(s)}}))}(this)):(this._views&&(i=this._views).length&&i.forEach((t=>{var e=t.views((()=>!0),!0);e&&e.length&&(i=i.concat(e))})),this._pages&&(s=this._pages).length&&s.forEach((t=>{var e=t.views((()=>!0),!0);e&&e.length&&(i=i.concat(e));var n=t.pages((()=>!0),!0);n&&n.length&&(s=s.concat(n),n.forEach((t=>{var e=t.views((()=>!0),!0);e&&e.length&&(i=i.concat(e))})))})),e=e.concat(s,i))),e}viewAll(t=(()=>!0)){return s.allViews(t)}queriesExcluded(t=(()=>!0)){return this.AB.queries((t=>-1==this.queryIDs.indexOf(t.id))).filter(t)}queriesIncluded(t=(()=>!0),e){const i=e??((t,e)=>t.label.localeCompare(e.label));return this.AB.queries((t=>this.queryIDs.indexOf(t.id)>-1)).filter(t).sort(i)}urlResolve(t){var e=t.split("/"),i=(e,s)=>{if(0==s.length)return e;var n=s.shift();if("#"==n)return i(this,s);if(Array.isArray(e))return e=e.filter((function(t){return t.id==n}))[0],i(e,s);if(e&&e[n])return i(e[n],s);if("_objects"==n){console.error(new Error("REFACTOR: old objectBy url reference:"));var a=s.shift();return i(this.AB.objectByID(a),s)}return console.error("!!! failed to lookup url:"+t),null};return i(this,e)}urlPointer(t){return t?"#/"+this.id+"/":"#/"}urlObject(t){return this.urlPointer(t)+"_objects/"}urlPage(t){return this.urlPointer(t)+"_pages/"}urlQuery(t){return this.urlPointer(t)+"_queries/"}get objectlistIsOpen(){return this.objectListSettings.isOpen}set objectlistIsOpen(t){this.objectListSettings.isOpen=t}get objectlistSearchText(){return this.objectListSettings.searchText}set objectlistSearchText(t){this.objectListSettings.searchText=t}get objectlistSortDirection(){return this.objectListSettings.sortDirection}set objectlistSortDirection(t){this.objectListSettings.sortDirection=t}get objectlistIsGroup(){return this.objectListSettings.isGroup}set objectlistIsGroup(t){this.objectListSettings.isGroup=t}pageNew(t){return t.key="page",s.newView(t,this,null)}pageByID(t){return this.pages((e=>e.id==t))[0]}viewNew(t,e,i){return s.newView(t,e,i)}cloneDeep(){throw new Error("ABApplicationCore.cloneDeep(): Depreciated!  Use AB.cloneDeep() instead.")}}},6980:(t,e,i)=>{const s=i(97069);var n={id:"uuid",label:"",object:{},query:{},settings:{datasourceID:"",linkDatacollectionID:"",linkFieldID:"",followDatacollectionID:"",objectWorkspace:{filterConditions:{glue:"and",rules:[]},sortFields:[]},loadAll:!1,populate:!0,isQuery:!1,fixSelect:"",syncType:1}};t.exports=class extends s{constructor(t,e){super(["label"],e),t=t||{},this.fromValues(t),this.__dataCollection=this._dataCollectionNew([]),this.refreshFilterConditions(),this.__bindComponentIds=[],this.__flexComponentIds=[],this._dataStatus=this.dataStatusFlag.notInitial,this.__filterCond=null}static contextKey(){return"datacollection"}fromValues(t){if(this.id=t.id,this.name=t.name||null,this.type=t.type||"datacollection",t.settings=t.settings||{},this.settings=this.settings||{},this.settings.linkDatacollectionID=t.settings.linkDatacollectionID||n.settings.linkDatacollectionID,this.settings.linkFieldID=t.settings.linkFieldID||n.settings.linkFieldID,this.settings.followDatacollectionID=t.settings.followDatacollectionID||n.settings.followDatacollectionID,this.settings.objectWorkspace=t.settings.objectWorkspace||{filterConditions:n.settings.objectWorkspace.filterConditions,sortFields:n.settings.objectWorkspace.sortFields},this.settings.fixSelect=t.settings.fixSelect,this.settings.loadAll=JSON.parse(t.settings.loadAll||n.settings.loadAll),this.settings.isQuery=JSON.parse(t.settings.isQuery||n.settings.isQuery),this.settings.populate=null!=t.settings.populate?t.settings.populate:1!=t.settings.preventPopulate&&"1"!=t.settings.preventPopulate&&n.settings.populate,this.settings.syncType=parseInt(t.settings.syncType||n.settings.syncType),this.__datasource=null,this.settings.datasourceID=t.settings.datasourceID||n.settings.datasourceID,this.settings.datasourceID){var e=this.AB.objectByID(this.settings.datasourceID);e||(e=this.AB.queryByID(this.settings.datasourceID)),e?(this.__datasource=e,this.settings.isQuery="query"===e.type,this.settings.isQuery&&this.__datasource.isGroup&&(this.__treeCollection||(this.__treeCollection=this._treeCollectionNew()),this.__isGroup=!0)):console.error(`ABDataCollection[${this.name}][${this.id}] unable to find datasource [${this.settings.datasourceID}]`)}super.fromValues(t)}toObj(){var t=super.toObj();return{id:this.id,name:this.name||this.label,type:this.type||"datacollection",settings:this.AB.cloneDeep(this.settings||{}),translations:t.translations}}async save(){return this.id||(this.label=this.label||this.name),await super.save(),this}destroy(){var t=()=>new Promise(((t,e)=>{const i=this.AB.applications();var s=[];return i.filter((t=>t.datacollectionsIncluded((t=>t.id==this.id)))).forEach((t=>{s.push(t.datacollectionRemove(this))})),Promise.all(s).then(t).catch(e)}));return Promise.resolve().then((()=>t())).then((()=>super.destroy())).then((()=>{this.emit("destroyed")}))}get $dc(){return this.__dataCollection}get datasource(){if(!this.__datasource){if(this.id&&this.name){var t=new Error(`DataCollection[${this.name}][${this.id}] missing reference datasource`);this.AB.notify("builder",t,{datacollection:this.toObj()})}return null}var e=this.AB.objectByID(this.__datasource.id);return e||(e=this.AB.queryByID(this.__datasource.id)),e}set datasource(t){this.__datasource=t,this.refreshFilterConditions()}get sourceType(){return this.settings.isQuery?"query":"object"}get datacollectionLink(){return this.AB?this.AB.datacollectionByID(this.settings.linkDatacollectionID):null}get fieldLink(){let t=this.datasource;return t?t.fieldByID(this.settings.linkFieldID):null}get model(){let t=this.datasource;return t?t.model():null}get dataStatusFlag(){return{notInitial:0,initializing:1,initialized:2}}get dataStatus(){return this._dataStatus}setCursor(t){if(this.settings.fixSelect&&("_FirstRecordDefault"!=this.settings.fixSelect||this.settings.fixSelect==t))return;if(this.__treeCollection){this.setCursorTree(t);let e=this.__treeCollection.getCursor();if(e){let i=this.__treeCollection.getItem(e);i&&(t=i._itemId)}}let e=this.__dataCollection;e&&(null==t?e.setCursor(null):e.getCursor()==t?this.emit("changeCursor",this.getCursor()):e.exists(t)&&e.setCursor(t))}setCursorTree(t){let e=this.__treeCollection;if(e&&e.getCursor()!=t)if(e.find({id:t},!0))e.setCursor(t);else{let i=e.find({_itemId:t,$parent:0},!0);i?e.setCursor(i.id):e.setCursor(null)}}getCursor(t=!1){if(t&&this.__treeCollection){let t=this.__treeCollection.getCursor();if(t){let e=this.__treeCollection.getItem(t);this.__treeCollection.filter((t=>t._itemId==e._itemId));let i=this.__treeCollection.serialize()[0]||null;return this.refreshLinkCursor(),i}}let e=this.__dataCollection;if(null==e)return null;let i=e.getCursor();return e.getItem(i)}getFirstRecord(){var t=this.__dataCollection;if(null==t)return null;var e=t.getFirstId();return t.getItem(e)}getNextRecord(t){var e=this.__dataCollection;if(null==e)return null;var i=e.getNextId(t.id);return e.getItem(i)}refreshLinkCursor(){let t,e=this.datacollectionLink;e&&(t=e.getCursor());let i=e=>null==t||this.isParentFilterValid(e);this.__dataCollection&&this.__dataCollection.filter(i),this.__treeCollection&&this.__treeCollection.filter(i)}setStaticCursor(){if(this.settings.fixSelect)if("_CurrentUser"==this.settings.fixSelect){var t=this.currentUserUsername(),e=this.datasource.fields((t=>"user"==t.key)),i=this.__dataCollection.find((i=>{var s=!1;return e.forEach((e=>{s||null==i[e.columnName]||(i[e.columnName].filter?s=i[e.columnName].filter((e=>e.id==t)).length>0:i[e.columnName]==t&&(s=!0))})),s}),!0);i&&(this.__dataCollection.setCursor(i.id),this.setCursorTree(i.id))}else if("_FirstRecord"==this.settings.fixSelect||"_FirstRecordDefault"==this.settings.fixSelect){let t=this.__dataCollection.getCursor();if(!t||t&&!this.__dataCollection.exists(t)){let t=this.__dataCollection.getFirstId();this.__dataCollection.setCursor(t||null),this.setCursorTree(t)}}else this.__dataCollection.setCursor(this.settings.fixSelect),this.setCursorTree(this.settings.fixSelect);if(this.isCursorFollow){const t=this.__dataCollection.getFirstId();this.setCursor(t||null),this.setCursorTree(t||null)}}filterCondition(t=null){this.__filterCond=t}init(){if(this.initialized)return;this.initialized=!0,this.__dataCollection.___AD.onAfterCursorChange||(this.__dataCollection.___AD.onAfterCursorChange=this.__dataCollection.attachEvent("onAfterCursorChange",(()=>{var t=this.getCursor();this.emit("changeCursor",t)})));let t=(t,e,i="id")=>Array.isArray(t)?t.filter((t=>(t[i]||t)==e)).length>0:t&&(t[i]||t)==e;this.on("ab.datacollection.create",(e=>{if(this.isCursorFollow)return;let i=this.datasource;if(!i)return;if(!e||!e.data)return;let s=!1,n=[];Promise.resolve().then((()=>new Promise(((t,a)=>{if(i instanceof this.AB.Class.ABObjectQuery){let r=i.objects((t=>t.id==e.objectId))||[];if(s=r.length>0,!s)return t();let o={glue:"or",rules:[]};r.forEach((t=>{let s=e.data[`${t.PK()}`];s&&o.rules.push({key:`${t.alias||i.objectAlias(t.id)}.${t.PK()}`,rule:"equals",value:s})})),i.model().findAll({where:o}).then((e=>{n=e.data||[],n.forEach((t=>{delete t.id})),t()})).catch(a)}else s=i.id==e.objectId,n=[e.data],t()})))).then((()=>{if(s&&(i.model(),(n||[]).forEach((t=>{this.isValidData(t)&&(this.__dataCollection.exists(t[`${i.PK()}`])||this.__reloadWheres?!this.__dataCollection.exists(t[`${i.PK()}`])&&this.__reloadWheres&&this.isParentFilterValid(t)&&this.__bindComponentIds.concat(this.__flexComponentIds).forEach((t=>{if($$(t+"_reloadView"))return!1;var e=0,i=$$(t).getParentView();$$(t).getParentView().index?e=$$(t).getParentView().index($$(t)):$$(t).getParentView().getParentView().index&&(i=$$(t).getParentView().getParentView(),e=$$(t).getParentView().getParentView().index($$(t).getParentView()));var s=this;if(i.addView){var n=this.AB.Label();i.addView({id:t+"_reloadView",view:"button",value:n("New data available. Click to reload."),css:"webix_primary webix_warn",click:function(t,e){s.reloadData(),$$(t).getParentView().removeView(t)}},e)}})):(this.__dataCollection.add(t,0),this.emit("create",t)))})),this.__treeCollection&&this.parseTreeCollection({data:n})),!(i instanceof this.AB.Class.ABObjectQuery)){let s=this.datasource.connectFields((t=>t.datasourceLink&&t.datasourceLink.id==e.objectId));if(n=n[0],n&&s&&s.length>0){let e=s[0].object.PK();n.id||"id"==e||(n.id=n[e]),this.__dataCollection.find({}).forEach((a=>{let r={};s.forEach((i=>{var s={};i&&i.fieldLink&&(s=n[i.fieldLink.relationName()]||{});let o=a[i.relationName()]||{},l=t(s,a.id,e);Array.isArray(o)&&o.filter((t=>t==n.id||t.id==n.id||t[e]==n.id)).length<1&&l?(o.push(n),r[i.relationName()]=o,r[i.columnName]=r[i.relationName()].map((t=>t.id||t[e]||t))):Array.isArray(o)||o==n.id&&o.id==n.id&&o[e]==n.id||!l||(r[i.relationName()]=n,r[i.columnName]=n.id||n)})),Object.keys(r).length>0&&(i.model(),this.__dataCollection.updateItem(a.id,r),this.__treeCollection&&this.__treeCollection.updateItem(a.id,r),this.emit("update",this.__dataCollection.getItem(a.id)))}))}}this.refreshLinkCursor(),this.setStaticCursor()}))})),this.on("ab.datacollection.update",(e=>{let i=this.datasource;if(!i)return;let s=e.data;if(!s)return;if(this.isCursorFollow&&this.getCursor()?.id!=(s[i.PK()]??s.id))return;let n=!1,a=!1,r=[],o=[],l={};if(i instanceof this.AB.Class.ABObjectQuery){let t=i.objects((t=>t.id==e.objectId))||[];n=t.length>0,n&&((t||[]).forEach((t=>{r=r.concat(this.__dataCollection.find((e=>e[`${this.datasource.objectAlias(t.id)}.${t.PK()}`]==(s[t.PK()]||s.id))).map((t=>t.id))||[]),this.__treeCollection&&(o=o.concat(this.__treeCollection.find((e=>e[`${this.datasource.objectAlias(t.id)}.${t.PK()}`]==(s[t.PK()]||s.id))).map((t=>t.id))||[]))})),a=r.length>0,l=this._queryUpdateData(t,s))}else n=i.id==e.objectId,n&&(s.id||"id"==i.PK()||(s.id=s[i.PK()]),r.push(s.id),a=this.__dataCollection.exists(s.id),l=s);if(n)if(a)if(this.isValidData(l)){this.__dataCollection&&(r=this.AB.uniq(r),r.forEach((t=>{this.__dataCollection.updateItem(t,l)}))),this.__treeCollection&&(o=this.AB.uniq(o),o.forEach((t=>{this.__treeCollection.updateItem(t,l)}))),this.emit("update",l);let t=this.getCursor();t&&t.id==l.id&&this.emit("changeCursor",t)}else r.forEach((t=>{let e=this.getCursor();e&&e.id==t&&this.emit("changeCursor",null),this.__dataCollection.remove(t),this.emit("delete",t)}));else this.isValidData(l)&&(this.__dataCollection.add(l,0),this.__treeCollection&&this.parseTreeCollection({data:[l]}),this.emit("create",l));let h=i.connectFields((t=>t.datasourceLink&&t.datasourceLink.id==e.objectId));if(i instanceof this.AB.Class.ABObject&&h&&h.length>0){let e=h[0].object.PK();s.id||"id"==e||(s.id=s[e]),this.__dataCollection.count()>0&&this.__dataCollection.find({}).forEach((i=>{let n={id:i.id};if(h.forEach((a=>{if(!a)return;let r={},o=i[a.relationName()]||{};a.fieldLink&&(r=s[a.fieldLink.relationName()]||{});let l=t(r,i.id,e);Array.isArray(o)&&o.filter((t=>t==s.id||t.id==s.id||t[e]==s.id)).length>0&&!l?(n[a.relationName()]=o.filter((t=>(t.id||t[e]||t)!=s.id)),n[a.columnName]=n[a.relationName()].map((t=>t.id||t[e]||t))):Array.isArray(o)||o!=s.id&&o.id!=s.id&&o[e]!=s.id||l||(n[a.relationName()]=null,n[a.columnName]=null),Array.isArray(o)&&l?(o.filter((t=>t==s.id||t.id==s.id||t[e]==s.id)).length>0?o.forEach(((t,i)=>{t!=s.id&&t.id!=s.id&&t[e]!=s.id||(o[i]=s)})):o.push(s),n[a.relationName()]=o,n[a.columnName]=n[a.relationName()].map((t=>t.id||t[e]||t))):Array.isArray(o)||o==s.id&&o.id==s.id&&o[e]==s.id||!l||(n[a.relationName()]=s,n[a.columnName]=s.id||s)})),Object.keys(n).length>0){if(this.__treeCollection?.exists(i.id)){const t=Object.assign(this.__treeCollection.getItem(i.id),n);this.__treeCollection.updateItem(i.id,t)}if(this.__dataCollection?.exists(i.id)){const t=Object.assign(this.__dataCollection.getItem(i.id),n);this.__dataCollection.updateItem(i.id,t),this.emit("update",this.__dataCollection.getItem(i.id))}}}))}this.refreshLinkCursor(),this.setStaticCursor()})),this.on("ab.datacollection.stale",(t=>{if(this.datasource&&this.model&&this.datasource.id==t.objectId){var e=t.data;if(e){var i=this.model.object.PK();if(e[i]||(i="id"),!this.isCursorFollow||this.getCursor()?.[i]==(e[i]??e.id)){if(e&&this.__dataCollection.exists(e[i])){var s={where:{}};s.where[i]=e[i],this.model.staleRefresh(s).then((t=>{if(Array.isArray(t.data)&&t.data.length){if(!this.datasource)return;this.__dataCollection.exists(e[i])&&this.__dataCollection.updateItem(e[i],t.data[0]);var s=this.getCursor();s&&s[i]==e[i]&&this.emit("changeCursor",s)}else this.getCursor()==e[i]&&this.emit("changeCursor",null),this.__dataCollection.remove(e[i]),this.emit("delete",e[i])}))}this.refreshLinkCursor(),this.setStaticCursor()}}}})),this.on("ab.datacollection.delete",(t=>{let e=this.datasource;if(!e)return;let i=t.data,s=!1,n=[],a=[];if(this.isCursorFollow&&this.getCursor()?.id!=i)return;if(e instanceof this.AB.Class.ABObjectQuery){let r=e.objects((e=>e.id==t.objectId))||[];s=r.length>0,s&&(r||[]).forEach((t=>{n=this.__dataCollection.find((e=>e[`${t.alias}.${t.PK()}`]==i)).map((t=>t.id))||[],this.__treeCollection&&(a=this.__treeCollection.find((e=>e[`${t.alias}.${t.PK()}`]==i)).map((t=>t.id))||[])}))}else s=e.id==t.objectId,s&&n.push(i);if(s){var r=this.getCursor();n.forEach((t=>{r&&r[e.PK()]==t&&this.emit("changeCursor",null),this.__dataCollection.exists(t)&&this.__dataCollection.remove(t)})),this.__treeCollection&&a.forEach((t=>{this.__treeCollection.exists(t)&&this.__treeCollection.remove(t)})),n[0]&&this.emit("delete",n[0])}let o=e.connectFields((e=>e.datasourceLink&&e.datasourceLink.id==t.objectId));if(e instanceof this.AB.Class.ABObject&&o&&o.length>0){let t=o[0].object.PK();this.__dataCollection.find({}).forEach((e=>{let s={};o.forEach((n=>{let a=e[n.relationName()];null!=a&&(Array.isArray(a)?(s[n.relationName()]=a.filter((e=>(e.id||e[t]||e)!=i)),s[n.columnName]=s[n.relationName()].map((e=>e.id||e[t]||e))):a!=i&&a.id!=i&&a[t]!=i||(s[n.relationName()]=null,s[n.columnName]=null))})),Object.keys(s).length>0&&(this.__dataCollection.updateItem(e.id,s),this.__treeCollection&&this.__treeCollection.updateItem(e.id,s),this.emit("update",this.__dataCollection.getItem(e.id)))}))}}));let e=this.datacollectionLink;e&&this.settings.loadAll&&this.eventAdd({emitter:e,eventName:"changeCursor",listener:()=>{this.refreshLinkCursor(),this.setStaticCursor()}});const i=this.datacollectionFollow;i&&this.eventAdd({emitter:i,eventName:"changeCursor",listener:()=>{this.clearAll(),this.loadData()}})}waitForDataCollectionToInitialize(t,e){return new Promise(((e,i)=>{switch(t.dataStatus){case t.dataStatusFlag.notInitial:t.loadData().catch(i);case t.dataStatusFlag.initializing:this.eventAdd({emitter:t,eventName:"initializedData",listener:()=>{e()}});break;case t.dataStatusFlag.initialized:default:e()}}))}loadData(t,e){this._dataStatus==this.dataStatusFlag.notInitial&&(this._dataStatus=this.dataStatusFlag.initializing,this.emit("initializingData",{}));var i=this.datasource;if(null==i)return this._dataStatus=this.dataStatusFlag.initialized,Promise.resolve([]);var s=i.model();if(null==s)return this._dataStatus=this.dataStatusFlag.initialized,Promise.resolve([]);var n=this.settings.objectWorkspace.sortFields||[];let a=this.AB.cloneDeep(this.settings.objectWorkspace.filterConditions??null);this.__reloadWheres&&(a=this.__reloadWheres);const r={glue:"and",rules:[]};this.__filterCond&&r.rules.push(this.__filterCond);const o=this.datacollectionLink,l=this.fieldLink;if(!this.settings.loadAll&&o&&l){const t=o?.getCursor()?.id;t&&r.rules.push({alias:l.alias,key:l.id,rule:l.alias?"contains":"equals",value:l.getRelationValue(o.__dataCollection.getItem(t))})}else if(this.datacollectionFollow){const i=this.datacollectionFollow.getCursor();let s=this.datasource.PK();this.datacollectionFollow.settings.isQuery&&(s="BASE_OBJECT."+s),i?(t=0,e=null,a={glue:"and",rules:[{key:this.datasource.PK(),rule:"equals",value:i[s]}]}):a={glue:"and",rules:[{key:this.datasource.PK(),rule:"equals",value:"NO RESULT ROW"}]}}r.rules.length&&(r.rules.unshift(a),a=r),a?.rules?.filter&&(a.rules=a.rules.filter((t=>t)));var h={where:a||{},skip:t||0,sort:n,populate:this.settings.populate??!this.settings.preventPopulate};return null!=e&&(h.limit=e),this.settings.loadAll&&!this.isCursorFollow&&delete h.limit,Promise.resolve().then((()=>{let t=this.datacollectionLink;return t?this.waitForDataCollectionToInitialize(t):Promise.resolve()})).then((()=>new Promise(((t,e)=>{if(null==a||null==a.rules||!a.rules.length)return t();var i=[];a.rules.forEach((t=>{if("in_data_collection"==t.rule||"not_in_data_collection"==t.rule){var e=this.AB.datacollectionByID(t.value);e&&i.push(this.waitForDataCollectionToInitialize(e))}})),Promise.all(i).then((()=>{t()})).catch(e)})))).then((()=>new Promise(((t,e)=>{this._pendingLoadDataResolve={resolve:t,reject:e},this.platformFind(s,h).catch((t=>{e(t)}))}))))}platformFind(t,e){return t.findAll(e).then((t=>this.processIncomingData(t)))}async queuedParse(t,e){const i=t?.data||t;if(!i?.length)return e?.(),Promise.resolve();const s=t.total_count;let n;if(i.length>250){let t=this.__dataCollection.count(),e=i.splice(250);n={data:e,pos:t+i.length,total_count:s}}const a={data:i,pos:t.pos,total_count:s};return this.__dataCollection.parse(a),new Promise((t=>{setTimeout((async()=>{await this.queuedParse(n),e?.(),t()}),15)}))}processIncomingData(t){return Promise.resolve().then((()=>{this.__totalCount=t.total_count,this.__dataCollection.find({}).length||this.__dataCollection.clearAll(),this.__throttleIncoming&&clearTimeout(this.__throttleIncoming),this.__throttleIncoming=setTimeout((async()=>{await this.queuedParse(t),this.__dataCollection.load((async()=>(this.settings.loadAll&&setTimeout((()=>{this.refreshLinkCursor()}),250),{data:[],pos:t.pos,total_count:t.total_count}))),this.parseTreeCollection(t),this.datacollectionLink?(this.refreshLinkCursor(),this.setStaticCursor()):this.setStaticCursor(),this._pendingLoadDataResolve&&(this._pendingLoadDataResolve.resolve(),this._pendingLoadDataResolve=null),this.settings.loadAll&&this.emit("loadData",{}),this._dataStatus!=this.dataStatusFlag.initialized&&(this._dataStatus=this.dataStatusFlag.initialized,this.emit("initializedData",{}))}),100)}))}reloadData(t,e){return Promise.resolve().then((()=>(this.reloadTimer&&(clearTimeout(this.reloadTimer),delete this.reloadTimer),this.reloadPromise||(this.reloadPromise=new Promise(((t,e)=>{this.reloadPromise__resolve=t,this.reloadPromise__reject=e}))),this.reloadTimer=setTimeout((()=>(this.clearAll(),this.loadData(t,e).then((()=>{this.reloadPromise&&(this.reloadPromise__resolve(),delete this.reloadPromise,delete this.reloadPromise__resolve,delete this.reloadPromise__reject),clearTimeout(this.reloadTimer),delete this.reloadTimer})).catch((t=>{this.reloadPromise&&(this.reloadPromise__reject(t),delete this.reloadPromise,delete this.reloadPromise__resolve,delete this.reloadPromise__reject),clearTimeout(this.reloadTimer),delete this.reloadTimer})))),50),this.reloadPromise)))}reloadWheres(t){this.__reloadWheres=t}getData(t){var e=this.__dataCollection;return e?e.find((e=>{let i=!0;return this.datacollectionLink&&this.settings.loadAll&&i&&(i=this.isParentFilterValid(e)),i&&t&&(i=t(e)),i})):[]}isParentFilterValid(t){if(null==t)return!1;var e=this.datacollectionLink;if(null==e)return!0;const i=e.datasource;if(null==i)return!0;var s=this.fieldLink;if(null==s)return!0;var n=e.getCursor();if(null==n)return!0;var a=t[s.relationName()];if(null==a){if(!t[s.columnName])return!1;a=t[s.columnName]}let r=s.object.PK();return a.filter?a.filter((t=>(t[r]||t.id||t)==(n[i.PK()]||n.id||n))).length>0:(a[r]||a.id||a)==(n[i.PK()]||n.id||n)}clearAll(){this.__dataCollection&&this.__dataCollection.clearAll(),this.__treeCollection&&this.__treeCollection.clearAll(),this._dataStatus=this.dataStatusFlag.notInitial}get totalCount(){return this.__totalCount||0}bind(){console.error("Platform.ABDataCollection.bind() Not implemented")}unbind(){console.error("Platform.ABDataCollection.unbind() Not implemented")}removeComponent(t){let e=this.__bindComponentIds.indexOf(t);this.__bindComponentIds.splice(e,1)}refreshFilterConditions(t=null){if(null==this.__filterDatasource&&(this.__filterDatasource=this.AB.filterComplexNew(`${this.id}_filterDatasource`)),this.datasource){let t;this.__filterDatasource.fieldsLoad(this.datasource.fields()),this.datasource instanceof this.AB.Class.ABObjectQuery&&(t=this.datasource.where),t?this.__filterDatasource.setValue(t):this.__filterDatasource.setValue({})}else this.__filterDatasource.fieldsLoad([]),this.__filterDatasource.setValue(n.settings.objectWorkspace.filterConditions);if(null==this.__filterDatacollection&&(this.__filterDatacollection=this.AB.filterComplexNew(`${this.id}_filterDatacollection`)),this.__filterDatacollection.fieldsLoad(this.datasource?this.datasource.fields():[]),t&&(this.settings.objectWorkspace.filterConditions=t),this.settings&&this.settings.objectWorkspace&&this.settings.objectWorkspace.filterConditions?this.__filterDatacollection.setValue(this.settings.objectWorkspace.filterConditions):this.__filterDatacollection.setValue(n.settings.objectWorkspace.filterConditions),null==this.__filterScope&&(this.__filterScope=this.AB.filterComplexNew(`${this.id}_filterScope`)),this.datasource){let t=(this.userScopes||[]).filter((t=>!t.allowAll&&(t.objectIds||[]).indexOf(this.datasource.id)>-1));if(t&&t.length>0){this.__filterScope.fieldsLoad(this.datasource.fields()||[]);let e=[];t.filter((t=>t.filter&&t.filter.rules&&t.filter.rules.length)).forEach((t=>{let i=(t.filter.rules||[]).filter((t=>this.datasource.fields((e=>e.id==t.key)).length>0));e=e.concat(i)}));let i={glue:"or",rules:e};this.__filterScope.setValue(i)}}}get isGroup(){return this.__isGroup||!1}get syncTypeFlag(){return{server:1,client:2}}get syncType(){return this.settings.syncType||n.syncType}_dataCollectionNew(){var t=new Error("the platform.ABDataCollection._dataCollectionNew() is expected to return a proper DataCollection!");return console.error(t),null}_treeCollectionNew(){return console.error("the platform.ABDataCollection._treeCollectionNew() is expected to return a proper TreeCollection!"),null}parseTreeCollection(t={}){t==={}&&console.log("Platform.ABDataCollection.parseTreeCollection() missing!")}_queryUpdateData(t,e){let i={};return Object.keys(e).forEach((s=>{t.forEach((t=>{let n=this.datasource.objectAlias(t.id);i[`${n}.${s}`]=e[s],"translations"==s&&e.translations&&e.translations.length&&(i.translations=[],e.translations.forEach((t=>{let e={};Object.keys(t).forEach((i=>{"language_code"==i?e.language_code=t.language_code:e[`${n}.${i}`]=t[i]})),i.translations.push(e)})))}))})),i}isValidData(t){let e=!0;return this.__filterDatasource&&(e=e&&this.__filterDatasource.isValid(t)),this.__filterDatacollection&&(e=e&&this.__filterDatacollection.isValid(t)),e&&this.__filterScope&&(e=e&&this.__filterScope.isValid(t)),e}clone(t){t=t||this.toObj();var e=new this.constructor(t,this.AB);e.__datasource=this.__datasource,e._dataStatus=this._dataStatus,e.__filterDatacollection.setValue(t.settings.objectWorkspace.filterConditions),(()=>{e.__dataCollection&&e.__dataCollection.parse(this.__dataCollection.find({}).filter((t=>e.__filterDatacollection.isValid(t)))),e.__treeCollection&&e.__treeCollection.parse(this.__treeCollection.find({}).filter((t=>e.__filterDatacollection.isValid(t))))})(),e.setStaticCursor();var i=this.getCursor();return i&&(i.id&&(i=i.id),e.setCursor(i)),e}filteredClone(t){var e=this.toObj();return t?.rules?.length&&(e.settings.objectWorkspace.filterConditions?.rules?.length?e.settings.objectWorkspace.filterConditions.rules=e.settings.objectWorkspace.filterConditions.rules.concat(t.rules):e.settings.objectWorkspace.filterConditions=t),this.clone(e)}eventAdd(t){if(!t||!t.emitter||!t.listener)return;this.__events=this.__events||[];let e=this.__events.find((e=>e.emitter==t.emitter&&e.eventName==t.eventName));(!e||e.length<1)&&(this.__events.push({emitter:t.emitter,eventName:t.eventName,listener:t.listener}),t.emitter.on(t.eventName,t.listener))}eventClear(){this.__events&&this.__events.length>0&&this.__events.forEach((t=>{t.emitter.removeListener(t.eventName,t.listener)}))}get userScopes(){return[]}get isCursorFollow(){return this.settings.followDatacollectionID&&(!this.settings.linkDatacollectionID||!this.settings.linkFieldID)}get datacollectionFollow(){return this.isCursorFollow?(this.AB??AB).datacollectionByID(this.settings.followDatacollectionID):null}}},40052:t=>{t.exports=class{constructor(t,e){this.AB=e,this.fromValues(t)}fromValues(t){t.id&&(this.id=t.id),this.name=t?.name||t?.json?.name||t?.json?.label||t?.json?.translations?.[0]?.label||"",this.name||this.AB.notify.builder(new Error("Attributes for definition had no 'name'"),{context:"ABDefinitionCore.fromValues()",attributes:t}),this.type=t.type||t?.json?.type||"",this.json=t.json||null}toObj(){return{id:this.id,name:this.name,type:this.type,json:this.json}}destroy(){return this.AB.definitionDestroy(this.id)}async save(){return this.id?this.AB.definitionUpdate(this.id,this.toObj()):this.AB.definitionCreate(this.toObj())}}},35095:(t,e,i)=>{const s=i(51827),n=i(65741),a=i(8030),r=i(69594),o=i(5437),l=i(67826),h=i(54509),c=i(41557),d=i(25311),u=i(11579),_=i(88447),p=i(92699),f=i(68836),g=i(67692),m=i(30144),v=i(52719),b=i(53874),w=i(81621),y=i(48717),x=i(41688),k=i(21021),C=i(97069),$=i(73686);t.exports=class extends ${constructor(t){if(super(),this.setMaxListeners(0),this._definitions=t||{},Array.isArray(t)){var e={};t.forEach((t=>{e[t.id]=t})),this._definitions=e}this._allApplications=[],this._allObjects=[],this._allHints=[],this._allProcesses=[],this._allQueries=[],this._allSteps=[],this._allDatacollections=[],this.Class={ABApplication:s,ABComponent:a,ABDefinition:n,ABFieldManager:r,ABIndex:o,ABMLClass:C,ABObject:l,ABObjectExternal:h,ABObjectImport:c,ABObjectQuery:_,ABProcessParticipant:g,ABProcessTaskManager:v,ABViewDetailItem:w,ABViewFormItem:y},this.rules={isUUID:function(t){return RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$","i").test(t)},nameFilter:function(t){return String(t).replace(/[^a-z0-9_.]/gi,"")},toApplicationNameFormat:function(t){return"AB_"+this.nameFilter(t)},toFieldRelationFormat:function(t){return this.nameFilter(t)+"__relation"},toJunctionTableFK:function(t,e){var i=t+"_"+e;return i.length>64&&(i=i.substring(0,64)),i},toJunctionTableNameFormat:function(t,e,i,s){return(t=this.toApplicationNameFormat(t)).length>17&&(t=t.substring(0,17)),e.length>15&&(e=e.substring(0,15)),i.length>15&&(i=i.substring(0,15)),(s=this.nameFilter(s)).length>14&&(s=s.substring(0,14)),"{appName}_{sourceName}_{targetName}_{colName}".replace("{appName}",t).replace("{sourceName}",e).replace("{targetName}",i).replace("{colName}",s)},toObjectNameFormat:function(t){return`AB_${this.nameFilter(t)}`}},this.notify.builder=(...t)=>{this.notify("builder",...t)},this.notify.developer=(...t)=>{this.notify("developer",...t)}}definitionClean(t){if("string"==typeof t.json)try{t.json=JSON.parse(t.json)}catch(e){console.log(e),console.error(` Error on definition id[${t.id}]`)}}init(){let t=Object.keys(this._definitions).map((t=>this._definitions[t]));return t.forEach((t=>{this.definitionClean(t)})),["object","query","datacollection","process","hint","step","application"].forEach((e=>{t.filter((t=>t.type==e)).forEach((t=>{let{keyList:e,keyFn:i}=this.objectKeysByDef(t);e&&this[e].push(this[i](t.json))}))})),this.emit("init.objects_ready"),Promise.resolve()}objectKeysByDef(t){switch(t.type){case"application":return{keyList:"_allApplications",keyFn:"applicationNew"};case"datacollection":return{keyList:"_allDatacollections",keyFn:"datacollectionNew"};case"hint":return{keyList:"_allHints",keyFn:"hintNew"};case"steps":return{keyList:"_allSteps",keyFn:"stepNew"};case"object":return{keyList:"_allObjects",keyFn:"objectNew"};case"process":return{keyList:"_allProcesses",keyFn:"processNew"};case"query":return{keyList:"_allQueries",keyFn:"queryNew"};default:return{keyList:null,keyFn:null}}}definitionByID(t,e=!1){return this._definitions[t]?e?this._definitions[t]:this._definitions[t].json:null}definitionNew(t){return new n(t,this)}definitionsParse(t=[]){return Array.isArray(t)||(t=[t]),t.forEach((t=>{this.definitionClean(t),this._definitions[t.id]=t})),t.forEach((t=>{this.definitionSync("updated",t.id,t)})),Promise.resolve()}definitionSync(t,e,i){var s,{keyList:n,keyFn:a}=this.objectKeysByDef(i);if(n)switch(t){case"created":this[n].push(this[a](i.json)),this.emit("definition.created",i.json);break;case"updated":s=this[n].find((t=>t.id==e)),this[n]=this[n].filter((t=>t.id!=e)),this[n].push(this[a](i.json)),s?s.emit("definition.updated",i.json):this.emit("definition.updated",i.json);break;case"destroyed":(s=this[n].find((t=>t.id==e)))&&(this[n]=this[n].filter((t=>t.id!=e)),s.emit("definition.deleted",i.json),this.emit("definition.deleted",i.json))}}applications(t=(()=>!0)){return(this._allApplications||[]).filter(t)}applicationByID(t){return this.applications((e=>e.id==t))[0]}applicationNew(t){return new s(t,this)}datacollections(t=(()=>!0)){return(this._allDatacollections||[]).filter(t)}datacollectionByID(t){return t?this.datacollections((e=>e.id==t||e.name==t||e.label==t))[0]:null}datacollectionNew(t){var e=new u(t,this);return e.on("destroyed",(()=>{this._allDatacollections=this._allDatacollections.filter((t=>t.id!=e.id))})),e}fieldNew(t,e){return r.newField(t,e)}indexNew(t,e){return new o(t,e)}Label(){return(t,e,i=[])=>{var s=t;return e&&(Array.isArray(e)?i=e:s=e),i.forEach(((t,e)=>{var i=`{${e}}`;s=s.replaceAll(i,t)})),s}}objects(t=(()=>!0)){return(this._allObjects||[]).filter(t)}objectByID(t){return this.objects((e=>e.id==t||e.name==t||e.label==t))[0]}objectNew(t){return 1==t.isExternal?new h(t,this):1==t.isImported?new c(t,this):1==t.isAPI?new d(t,this):new l(t,this)}objectFile(){return this.objectByID("4a9d89c9-f4eb-41af-91e4-909eff389f3e")}objectLanguage(){return this.objectByID("d84cd351-d96c-490f-9afb-2a0b880ca0ec")}objectProcessForm(){return this.objectByID("d36ae4c8-edef-48d8-bd9c-79a0edcaa067")}objectProcessInstance(){return this.objectByID("2ba85be0-78db-4eda-ba43-c2c4e3831849")}objectRole(){return this.objectByID("c33692f3-26b7-4af3-a02e-139fb519296d")}objectScope(){return this.objectByID("af10e37c-9b3a-4dc6-a52a-85d52320b659")}objectToken(){return this.objectByID("08826ac7-4b33-4745-a3d7-f7831ca4ff59")}objectUser(){return this.objectByID("228e3d91-5e42-49ec-b37c-59323ae433a1")}hints(t=(()=>!0)){return(this._allHints||[]).filter(t)}hintID(t){return this.hints((e=>e.id==t||e.name==t||e.label==t))[0]}hintNew(t){return new p(t,this)}steps(t=(()=>!0)){return(this._allSteps||[]).filter(t)}stepID(t){return this.steps((e=>e.id==t||e.name==t||e.label==t))[0]}stepNew(t,e){var i=this.definitionByID(t);return new b(i||{settings:{hint:e}},this)}processes(t=(()=>!0)){return(this._allProcesses||[]).filter(t)}processByID(t){return this.processes((e=>e.id==t||e.name==t||e.label==t))[0]}processNew(t){return new f(t,this)}processElementNew(t,e){var i=this.definitionByID(t);if(i)switch(i.type){case g.defaults().type:return new g(i,e,this);case m.defaults().type:return new m(i,e,this);default:return v.newTask(i,e,this)}return null}processElementNewForModelDefinition(t,e){var i=null;switch(t.type){case"bpmn:Participant":i=new g({},e,this);break;case"bpmn:Lane":i=new m({},e,this);break;default:var s=v.definitionForElement(t);s&&(i=v.newTask(s,e,this))}return i&&i.fromElement(t),i}queries(t=(()=>!0)){return(this._allQueries||[]).filter(t)}queryByID(t){return this.queries((e=>e.id==t||e.name==t||e.label==t))[0]}queryNew(t){return new _(t,this)}rowfilterNew(t,e){return t&&console.error("!! Who is calling this with an App?"),new x(t||this._App,e,this)}filterComplexNew(t,e={}){return new k(t,this,e)}viewNewDetatched(t){return this._mockApp||(this._mockApp=this.applicationNew({})),this._mockApp.viewNew(t,this._mockApp)}notify(){console.error("ABFactory.notify() is expected to be overwritten by the platform!")}_notifyInfo(t){var e={};return t&&Object.keys(t).forEach((i=>{switch(i){case"field":e.objectID=t[i].object?.id,e.objectName=t[i].object?.name,e.fieldID=t[i].id,e.fieldName=t[i].label||t[i].name;break;case"object":e.objectID=t[i].id,e.objectName=t[i].name;break;case"datacollection":e.datacollectionID=t[i].id,e.datacollectionName=t[i].label||t[i].name;var s=t[i].datasource;s&&(e.datacollectionDSID=s.id,e.datacollectionDSName=s.name);break;case"process":e.processID=t[i].id,e.processName=t[i].label||t[i].name;break;case"req":e.req={jobID:t[i].jobID,tenantID:t[i]._tenantID,user:t[i]._user};break;case"task":t[i].process&&(e.processID=t[i].process.id,e.processName=t[i].process.label||t[i].process.name),e.taskID=t[i].id,e.taskName=t[i].label||t[i].name;break;case"view":t[i].application&&(e.applicationID=t[i].application.id,e.applicationName=t[i].application.label||t[i].application.name),e.viewID=t[i].id,e.viewName=t[i].label||t[i].name,e.viewKey=t[i].key;break;default:e[i]=t[i]}})),e}}},69594:(t,e,i)=>{var s={};[i(98134),i(74384),i(41812),i(90176),i(21747),i(77280),i(69319),i(60779),i(39137),i(42597),i(70780),i(29333),i(66589),i(43088),i(27238),i(58439),i(79579),i(31797),i(89142),i(87038)].forEach((t=>{s[t.defaults().key]=t})),t.exports=class{static allFields(){var t=[];for(var e in s)t.push(s[e]);return t}static fieldByKey(t){return s[t]}static newField(t,e){if(!t.key)throw console.log("-------"),console.log("values:"),console.error(t),console.log(),console.error("object:"),console.error(e),console.log("-------"),new Error(`ABFieldManager.newField(): Unknown Field Key [${t.name}][${t.key}] for object[${e.name}]`);try{return new s[t.key](t,e)}catch(e){console.log("Error",e),console.log("Available fields",s),console.log("Requested field",t.key)}}}},12295:(t,e,i)=>{var s=i(97069);i(57043),t.exports=class extends s{constructor(t,e){super(["name","description"],e),this.fromValues(t)}fromValues(t){let e=t?.settings.hasOwnProperty("active")?t?.settings?.active:"1";this.id=t?.id||"",this.name=t?.name||"New Tutorial",this.description=t?.description||"",this.type=t?.type||"hint",this.settings={},this.settings.active=e,this.settings.transition=t?.settings?.transition,this.settings.showIntroStep=t?.settings?.showIntroStep,this.settings.view=t?.settings?.view||"",this.stepIDs=t?.stepIDs||[],this?._steps,this._steps={},(t?.stepIDs||[]).forEach((t=>{if(t){var e=this.AB.stepNew(t,this.id);e&&(this._steps[t]=e)}})),t&&super.fromValues(t),this.label||(this.label=this.name)}toObj(){this.label||(this.label=this.name);var t=super.toObj();return["type","settings","stepIDs","id","name"].forEach((e=>{t[e]=this[e]})),t}steps(t=(()=>!0)){return Object.keys(this._steps).map((t=>this._steps[t])).filter(t)}stepAdd(t){this._steps[t.id]=t}stepByID(t){return this._steps[t]??null}stepRemove(t){let e=this.stepIDs.indexOf(t);e>-1&&this.stepIDs.splice(e,1),delete this._steps[t]}}},25739:(t,e,i)=>{const s=i(97069);t.exports=class extends s{constructor(t,e){super(["label"],e.AB),this.object=e,this.fromValues(t)}fromValues(t){if(this.id=t.id,this.type="index",this.name=t.name,this.unique=JSON.parse(t.unique||!1),t.fieldIDs&&!Array.isArray(t.fieldIDs)&&(t.fieldIDs=[t.fieldIDs]),this._unknownFieldIDs=[],this.fields=(t.fieldIDs||[]).map((t=>{let e=this.object.fieldByID(t);if(!e){this._unknownFieldIDs.push(t);let e=new Error(`Index[${this.name}][${this.id}] is referencing an unknown field[${t}]`);this.AB.notify.developer(e,{index:this.id,field:t})}return e})).filter((t=>t)),0==this.fields.length){let e=new Error(`Index[${this.name}][${this.id}] is not referencing any fields`);this.AB.notify.developer(e,{index:this.id,attributeFieldIDs:t.fieldIDs||[]})}super.fromValues(t)}toObj(){let t=super.toObj();return t.id=this.id,t.type="index",t.name=this.name,t.unique=this.unique,this.fields&&!Array.isArray(this.fields)&&(this.fields=[this.fields]),t.fieldIDs=(this.fields||[]).map((t=>t.id||t)).filter((t=>t)),this._unknownFieldIDs.forEach((e=>{t.fieldIDs.push(e)})),t}get indexName(){return`${this.object.dbTableName()}_${this.name}`.replace(/ /g,"").substring(0,64)}get uniqueName(){return`${this.indexName.substring(0,57)}_unique`}}},17243:(t,e,i)=>{var s=i(73686);t.exports=class extends s{constructor(t,e){super(),this.mlFields=t||["label"],this.AB=e}fromValues(t){this.translations=t.translations,this.translations?this.translate():(this.mlFields||[]).forEach((e=>{t[e]&&(this[e]=t[e])}))}defaultTranslations(t,e){e=e||{};var i={language_code:"en"};return t.forEach((t=>{i[t]=e[t]||t})),[i]}languageDefault(){return"en"}toObj(){return this.unTranslate(),{translations:this.translations}}toDefinition(){return this.AB.definitionNew({id:this.id,name:this.name,type:this.type,json:this.toObj()})}translate(t,e,i,s=null){t||(t=this),e||(e=this),i||(i=this.mlFields||[]),e.translations||(e.translations=[]),"string"==typeof e.translations&&(e.translations=JSON.parse(e.translations));var n=s||this.languageDefault();if(i&&i.length>0){var a=null,r=!1;e.translations.forEach((function(e){a||(a=e),e.language_code==n&&(r=!0,i.forEach((function(i){null!=e[i]&&(t[i]=e[i]),t[i]=e[i]||""})))})),!r&&a&&i.forEach((function(e){null!=a[e]&&""!=a[e]?t[e]=`[${n}]${a[e]}`:t[e]=""}))}}unTranslate(t,e,i){t||(t=this),e||(e=this),i||(i=this.mlFields||[]),e.translations||(e.translations=[]);var s=this.languageDefault();if(i&&i.length>0){var n=!1;if(e.translations.forEach((function(e){e.language_code==s&&(i.forEach((function(i){null!=t[i]&&(e[i]=t[i])})),n=!0)})),!n){var a={};a.language_code=s,i.forEach((function(e){null!=t[e]&&(a[e]=t[e])})),e.translations.push(a)}}}}},71692:t=>{t.exports=class{constructor(t){this.object=t,this.AB=t.AB,this._where=null,this._sort=null,this._skip=null,this._limit=null,this.staleRefreshInProcess=!1,this.staleRefreshMap={},this.staleRefreshPending=[],this.staleRefreshTimerID=null,this.responseContext={key:"--",context:{}}}contextKey(t){this.responseContext.key=t||"--"}contextValues(t){this.responseContext.context=t||{}}prepareMultilingualData(t){var e=this.object.multilingualFields(),i=!1;e.length&&e.forEach((function(e){null!=t[e]&&(i=!0)})),i&&(null!=t.translations&&void 0!==t.translations&&""!=t.translations||(t.translations=[]),this.object.unTranslate(t,t,e))}request(t,e){return console.error("!!! ABModelCore.request() should be overridden by platform."),Promise.resolve()}urlParamsCreate(t){return{url:this.object.urlRest(),params:t}}urlParamsDelete(t){return{url:this.object.urlRestItem(t)}}urlParamsFind(t){return{url:this.object.urlRest(),params:t||{}}}urlParamsUpdate(t,e){return{url:this.object.urlRestItem(t),params:e}}count(t){t=t||{};var e={url:this.object.urlRestCount(),params:t};return this.request("get",e).then((t=>{resolve(t)})).catch((t=>{console.error(t)}))}staleRefresh(t){var e=this.object.PK(),i=t[e];return t.where&&(i=t.where[e]),new Promise(((s,n)=>{if(!i){var a=new Error("Model.staleRefresh(): could not resolve ."+e);return a.cond=t,void n(a)}var r={resolve:s,reject:n};r[e]=i,this.staleRefreshPending.push(r),this.staleRefreshInProcess||(this.staleRefreshTimerID&&clearTimeout(this.staleRefreshTimerID),this.staleRefreshTimerID=setTimeout((()=>{this.staleRefreshProcess()}),200))}))}staleRefreshProcess(){this.staleRefreshInProcess=!0;var t=this.staleRefreshPending;this.staleRefreshPending=[];var e=this.object.PK(),i={},s={where:{}};s.where[e]=[],console.log("Model.staleRefreshProcess(): buffered "+t.length+" requests"),t.forEach((t=>{i[t[e]]=i[t[e]]||[],i[t[e]].push(t)})),s.where[e]=Object.keys(i),this.findAll(s).then((t=>{Array.isArray(t.data)&&t.data.length&&t.data.forEach((t=>{i[t[e]]?(i[t[e]].forEach((e=>{(0,e.resolve)({data:[t]})})),delete i[t[e]]):console.error("Model.staleRefreshProcess(): returned entry was not in our responseHash:",t,i)}));var s=Object.keys(i);s.length>0&&console.warn("Model.staleRefreshProcess(): "+s.length+" entries with no responses. "),s.forEach((t=>{(0,i[t].resolve)({data:[]}),delete i[t]})),this.staleRefreshPending.length>0?this.staleRefreshProcess():this.staleRefreshInProcess=!1}))}findConnected(t,e){return void 0===e&&(Array.isArray(t)||"object"!=typeof t||(e=t,t=[])),"string"==typeof t&&(t=[t]),new Promise(((i,s)=>{if(!e.id)return void i(null);let n={};n[this.object.PK()]=e.id,this.findAll({where:n,populate:!0}).then((e=>{if(e.data&&Array.isArray(e.data)&&0!=e.data.length){var s=e.data[0];if(1==t.length){let e=s[t[0].replace(/[^a-z0-9\.]/gi,"")+"__relation"];return e?(Array.isArray(e)||(e=[e]),void i(e)):i([])}0==t.length&&this.object.fields((t=>t.settings.linkType)).forEach((e=>{t.push(e.columnName)}));var n={};t.forEach((t=>{n[t]=s[t.replace(/[^a-z0-9\.]/gi,"")+"__relation"]})),i(n)}else i([])})).catch((t=>{console.error("!!! error with findConnected() attempt:",t),s(t)}))}))}upsert(t){for(var e in this.prepareMultilingualData(t),t)null==t[e]&&delete t[e];var i={url:this.object.urlRest(),params:t};return this.request("put",i).then((t=>(this.normalizeData(t),t))).catch((t=>{console.error(t)}))}where(t){return this._where=t,this}sort(t){return this._sort=t,this}refresh(){return console.error("!!! Depreciated: where is this being called from?"),Promise.resolve()}normalizeData(t){t instanceof Array||(t=[t]);var e=this.object.connectFields(),i=this.object.multilingualFields(),s=this.object.fields((function(t){return"date"==t.key||"datetime"==t.key}))||[],n=this.object.fields((t=>"calculate"==t.key));t.forEach((t=>{null!=t&&(t.id||"id"==this.object.PK()||(t.id=t[this.object.PK()]),e.forEach((e=>{var i=e.relationName();if(null==t[i])return;"string"==typeof t[i]&&t[i].length>0&&(t[i]=JSON.parse(t[i])),Array.isArray(t[i])?t[i].forEach((t=>{t.translations&&"string"==typeof t.translations&&(t.translations=JSON.parse(t.translations))})):t[i].translations&&"string"==typeof t[i].translations&&(t[i].translations=JSON.parse(t[i].translations));let s=e.datasourceLink,n=s.PK();var a=s.multilingualFields();if(Array.isArray(t[i]))t[i].forEach((t=>{const i=e.getRelationValue(t);"id"!=n&&(t.id=i),a.length&&s.translate(t,t,a)}));else{const n=e.getRelationValue(t[i]);n&&(t[i].id=n),a.length&&s.translate(t[i],t[i],a)}if(!t[e.columnName])if("one"==e.linkType())t[i]?t[e.columnName]=e.getRelationValue(t[i]):t[e.columnName]=null;else if(t[i])if(Array.isArray(t[i]))try{t[e.columnName]=(t[i]||[]).map((t=>e.getRelationValue(t)))}catch(s){console.log("+++++++++++++++"),console.log(`ID:[${e.id}]`),console.log(`ColumnName:[${e.label}]`),console.log(`relationName:[${i}]`),console.log(`linkType:[${e.linkType()}]`),console.log("data:"),console.log(JSON.stringify(t[i])),console.log("+++++++++++++++")}else console.log("+++++++++++++++"),console.log(`ID:[${e.id}]`),console.log(`ColumnName:[${e.label}]`),console.log(`relationName:[${i}]`),console.log(`linkType:[${e.linkType()}]`),console.log("data:"),console.log(JSON.stringify(t[i])),console.log("+++++++++++++++"),t[e.columnName]=[e.getRelationValue(t[i])];else t[e.columnName]=[]})),i.length&&this.object.translate(t,t,i),s.forEach((e=>{t&&null!=t[e.columnName]&&"string"==typeof t[e.columnName]&&("date"==e.key?t[e.columnName]=this.AB.rules.toDate(t[e.columnName],{format:"MM/DD/YYYY",ignoreTime:!0}):t[e.columnName]=this.AB.rules.toDate(t[e.columnName]))})),n.forEach((e=>{t[e.columnName]=e.format(t)})))}))}}},37578:(t,e,i)=>{const s=i(67826),n=i(10353);t.exports=class extends s{constructor(t,e){super(t,e),this.isAPI=!0}fromValues(t){super.fromValues(t),this.url=t.url??"",this.request=t.request??{},this.request.headers=t.request?.headers??[],this.response=t.response??{},this.response.fields=t.response?.fields??[]}toObj(){var t=super.toObj();return t.isAPI=!0,t.url=this.url,t.request=this.request??{},t.request.headers=this.request?.headers??[],t.response=this.response??{},t.response.fields=this.response?.fields??[],t}model(){var t=new n(this);return t.contextKey(this.constructor.contextKey()),t.contextValues({id:this.id}),t}}},96937:(t,e,i)=>{var s=i(48912),n=i(97069);const a=(...t)=>AB.Multilingual.label(...t);t.exports=class t extends n{constructor(t,e){super(["label"],e),this.fromValues(t)}static contextKey(){return"object"}fromValues(t){this.id=t.id,this.type=t.type||"object",this.connName=t.connName||void 0,this.name=t.name||"",this.labelFormat=t.labelFormat||"",this.labelSettings=t.labelSettings||{},this.labelSettings.isNoLabelDisplay=parseInt(this.labelSettings.isNoLabelDisplay||0),this.isImported=parseInt(t.isImported||0),this.isExternal=parseInt(t.isExternal||0),this.tableName=t.tableName||"",this.tableName=this.tableName.replace(/[^a-zA-Z0-9_ ]/gi,""),this.primaryColumnName=t.primaryColumnName||"",this.transColumnName=t.transColumnName||"",this.urlPath=t.urlPath||"",this.isSystemObject=t.isSystemObject,void 0!==this.isSystemObject&&"false"!=this.isSystemObject||(this.isSystemObject=!1),this.createdInAppID=t.createdInAppID,void 0!==t.objectWorkspace&&(void 0===t.objectWorkspace.sortFields&&(t.objectWorkspace.sortFields=[]),void 0===t.objectWorkspace.filterConditions&&(t.objectWorkspace.filterConditions=[]),void 0===t.objectWorkspace.frozenColumnID&&(t.objectWorkspace.frozenColumnID=""),void 0===t.objectWorkspace.hiddenFields&&(t.objectWorkspace.hiddenFields=[])),this.objectWorkspace=t.objectWorkspace||{sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[]};var e=[];this.fieldIDs=t.fieldIDs||[],this.importedFieldIDs=t.importedFieldIDs||[],this._unknownFieldIDs=[],this.fieldIDs.forEach((t=>{if(t){var i=this.AB.definitionByID(t);if(i)e.push(this.AB.fieldNew(i,this));else{this._unknownFieldIDs.push(t);let e=new Error(`O[${this.name}] is referenceing an unknown field id[${t}]`);this.AB.notify.builder(e,{field:{id:t,object:{id:this.id,name:this.name}}})}}})),this._fields=e,this.importIndexes(t.indexIDs),super.fromValues(t)}importIndexes(t){this._unknownIndex=[];var e=[];(t||[]).forEach((t=>{var i=this.AB.definitionByID(t);if(i)e.push(this.AB.indexNew(i,this));else{this._unknownIndex.push(t);let e=new Error(`O[${this.name}] is referenceing an unknown index id[${t}]`);this.AB.notify.builder(e,{field:{id:t,object:{id:this.id,name:this.name}}})}})),this._indexes=e}toObj(){var t=super.toObj(),e=this.fields().map((t=>t.id));(this._unknownFieldIDs||[]).forEach((t=>{e.push(t)}));var i=this.indexes().map((t=>t.id));return(this._unknownIndex||[]).forEach((t=>{i.push(t)})),{id:this.id,type:this.type||"object",connName:this.connName,name:this.name,labelFormat:this.labelFormat,labelSettings:this.labelSettings||{},isImported:this.isImported,isExternal:this.isExternal,tableName:this.tableName,primaryColumnName:this.primaryColumnName,transColumnName:this.transColumnName,urlPath:this.urlPath,objectWorkspace:this.objectWorkspace,isSystemObject:this.isSystemObject,translations:t.translations,fieldIDs:e,importedFieldIDs:this.importedFieldIDs,indexIDs:i,createdInAppID:this.createdInAppID}}objectLinks(){return this.connectFields().map((t=>t.datasourceLink))}fields(t=(()=>!0)){return this._fields.filter(t)}fieldByID(t){return this.fields((e=>e?.id==t))[0]}connectFields(t=(()=>!0)){return this.fields((t=>t&&t.isConnection)).filter(t)}fieldImport(t){if(t&&(-1==this.importedFieldIDs.indexOf(t)&&this.importedFieldIDs.push(t),!this._fields.find((e=>e.id==t)))){var e=this.AB.definitionByID(t);if(e)this._fields.push(this.AB.fieldNew(e,this));else{this._unknownFieldIDs=this._unknownFieldIDs||[],this._unknownFieldIDs.push(t);let e=new Error(`O[${this.name}] is importing an unknown field id[${t}]`);this.AB.notify.builder(e,{field:{id:t,object:{id:this.id,name:this.name}}})}}}fieldNew(t){return this.AB.fieldNew(t,this)}fieldRemove(t){var e=this._fields.length;return this._fields=this.fields((function(e){return e.id!=t.id})),this.importedFieldIDs=this.importedFieldIDs.filter((e=>e!=t.id)),this._fields.length<e?this.save():Promise.resolve()}fieldReorder(t,e){let i=null,s=0;for(var n=0;n<this._fields.length;n++)if(this._fields[n].columnName==t){i=this._fields[n],this._fields.splice(n,1),s=n;break}for(var a=0;a<this._fields.length;a++)if(this._fields[a].columnName==e){s<=a&&a++,this._fields.splice(a,0,i);break}return this.save()}fieldSave(t){return this.fieldByID(t.id)?Promise.resolve():(this._fields.push(t),this.save())}fieldAdd(t){return this.fieldByID(t.id)?Promise.resolve():(this._fields.push(t),this.save())}imageFields(t=(()=>!0)){return this.fields((t=>t&&"image"==t.key)).filter(t)}multilingualFields(){return this.fields((t=>t&&t.isMultilingual)).map((t=>t.columnName))}indexes(t=(()=>!0)){return this._indexes.filter(t)}indexByID(t){return this.indexes((e=>e.id==t))[0]}indexRemove(t){var e=this._indexes.length;return this._indexes=this.indexes((function(e){return e.id!=t.id})),e!=this._indexes.length?this.save():Promise.resolve()}indexSave(t){return this.indexByID(t.id)?Promise.resolve():(this._indexes.push(t),this.save())}model(){var e=new s(this);return e.contextKey(t.contextKey()),e.contextValues({id:this.id}),e}urlRest(){return`/app_builder/model/${this.id}`}urlRestBatch(){return`/app_builder/batch/model/${this.id}`}urlRestItem(t){return`/app_builder/model/${this.id}/${t}`}urlRestLog(){return`/app_builder/object/${this.id}/track`}urlRestRefresh(){return`/app_builder/model/refreshobject/${this.id}`}urlRestCount(){return`/app_builder/model/count/${this.id}`}get workspaceSortFields(){if(this.workspaceViews){let t=this.workspaceViews.getCurrentView();return t?t.sortFields:null}return this.objectWorkspace.sortFields}set workspaceSortFields(t){if(this.workspaceViews){let e=this.workspaceViews.getCurrentView();e&&(e.sortFields=t)}else this.objectWorkspace.sortFields=t}get workspaceFilterConditions(){if(this.workspaceViews){let t=this.workspaceViews.getCurrentView();return t?t.filterConditions:null}return this.objectWorkspace.filterConditions}set workspaceFilterConditions(t){if(this.workspaceViews){let e=this.workspaceViews.getCurrentView();e&&(e.filterConditions=t)}else this.objectWorkspace.filterConditions=t}get workspaceFrozenColumnID(){return this.objectWorkspace.frozenColumnID}set workspaceFrozenColumnID(t){this.objectWorkspace.frozenColumnID=t}get workspaceHiddenFields(){return this.objectWorkspace.hiddenFields||[]}set workspaceHiddenFields(t){this.objectWorkspace.hiddenFields=t}get isReadOnly(){return this.isImported||this.isExternal}defaultValues(){var t={};return this.fields().forEach((e=>{e.defaultValue(t)})),t}isValidData(){return console.warn("Platform.ABObject.isValidData() missing"),!0}urlPointer(t){return console.error("Who is calling this?"),null==this.application?null:this.application.urlObject(t)+this.id}urlField(t){return console.error("Who is calling this?"),this.urlPointer(t)+"/_fields/"}PK(){return this.primaryColumnName||"uuid"}remoteCreate(t){console.log("object["+this.name+"] received a remoteCreate() with data:",t)}clone(){let t=JSON.parse(JSON.stringify(this));return["application","_fields"].forEach((e=>{t[e]=this[e]})),t}minRelationData(){var t=[this.PK()];this.multilingualFields().length>0&&t.push("translations");var e=(this.labelFormat||"").match(/\{[^}]+\}/g);return e&&e.forEach&&e.forEach((e=>{var i=e.replace("{","").replace("}",""),s=this.fieldByID(i);null!=s&&t.push(s.columnName)})),t=t.concat(this.fields((t=>"number"==t.key)).map((t=>t.columnName)))}displayData(t){if(null==t)return"";var e=this.multilingualFields();this.translate(t,t,e);var i=this.labelFormat||"";if(!i&&this.fields().length>0){var s=this.fields((t=>t.fieldUseAsLabel()))[0];if(s)i="{"+s.id+"}";else if(!i.trim()){let e=this.labelSettings||{};i=e&&e.isNoLabelDisplay?a(e.noLabelText||"[No Label]"):`${this.AB.rules.isUUID(t.id)?"ID: ":""}${t.id}`}}var n=i.match(/\{[^}]+\}/g);if(n&&n.forEach&&n.forEach((e=>{var s=e.replace("{","").replace("}",""),n=this.fieldByID(s);null!=n&&(i=i.replace(e,n.format(t)||""))})),!i.trim()){let e=this.labelSettings||{};i=e&&e.isNoLabelDisplay?a(e.noLabelText||"[No Label]"):`${this.AB.rules.isUUID(t.id)?"ID: ":""}${t.id}`}return i}}},40777:(t,e,i)=>{var s=i(67826),n=i(94371);t.exports=class extends s{constructor(t,e){super(t,e),this.isQuery=!0,this.__missingObject=this.__missingObject??[],this.__missingFields=this.__missingFields??[],this.__cantFilter=[],this.__duplicateFields=[],this.__linkProblems=[]}static contextKey(){return"query"}fromValues(t){super.fromValues(t),this.type="query",this.alias2Obj={},this.objectIDs=[],this.viewName=t.viewName||"",this.importJoins(t.joins||{}),this._fields=null,this.importFields(t.fields||[]),this.where=t.where||{},this.where&&!this.where.glue&&this.where.rules&&this.where.rules.length>0&&(this.where.glue="and"),this._objectWorkspaceViews=t.objectWorkspaceViews||{},this.settings=this.settings||{},t&&t.settings&&(this.settings.grouping=JSON.parse(t.settings.grouping||!1),this.settings.hidePrefix=JSON.parse(t.settings.hidePrefix||!1))}toObj(){var t=super.toObj();return t.viewName=this.viewName,t.joins=this.exportJoins(),t.fields=this.exportFields(),t.where=this.where,t.settings=this.settings,t}importFields(t){var e=[];(t||[]).forEach((t=>{if(null==t)return;let i=this.objectByAlias(t.alias);if(!i&&this.AB&&(i=this.AB.objectByID(t.objectID),i&&(this._objects=this._objects||{},this._objects[t.alias]=i)),!i)return this.__missingObject=this.__missingObject??[],void this.__missingObject.push(t);let s=i.fieldByID(t.fieldID);if(!s)return this.__missingFields=this.__missingFields??[],void this.__missingFields.push({objID:i.id,fieldID:t.fieldID,fieldInfo:t});this.canFilterField(s)||(this.__cantFilter=this.__cantFilter??[],this.__cantFilter.push({field:s,fieldInfo:t}));let n=e.filter((e=>e.alias==t.alias&&e.field.id==t.fieldID)).length<1;if(n||(this.__duplicateFields=this.__duplicateFields??[],this.__duplicateFields.push({fieldInfo:t})),s&&this.canFilterField(s)&&n){var a=s.toObj();let i=new s.constructor(a,s.object);i.alias=t.alias;let n=t.alias;Array.isArray(this.joins())&&(n=s.object.name),e.push({alias:n,field:i})}})),this._fields=e}exportFields(){var t=[];return this._fields.forEach((e=>{t.push({alias:e.alias,objectID:e.field.object.id,fieldID:e.field.id})})),(this.__missingObject||[]).forEach((e=>{t.push(e)})),(this.__cantFilter||[]).forEach((e=>{t.push(e.fieldInfo)})),t}fields(t=(()=>!0)){return t||(t=()=>!0),this._fields.map((t=>t.field)).filter(t)}joins(){return this._joins||{}}objects(t=(()=>!0)){return this.AB.objects((t=>this.objectIDs.indexOf(t.id)>-1)).filter(t)}objectAlias(t){let e=null;return Object.keys(this.alias2Obj||{}).forEach((i=>{e||this.alias2Obj[i]!=t||(e=i)})),e}objectBase(){return this._joins.objectID&&this.AB.objectByID(this._joins.objectID)||null}objectByAlias(t){var e=this.alias2Obj[t];return e?this.objects((t=>t.id==e))[0]:null}objectByID(t){return t?this.objects((e=>e.id==t))[0]:null}links(t=(()=>!0)){return(this._links||[]).filter(t)}importJoins(t){this._joins=this.AB.cloneDeep(t);var e={},i=[];let s=(t,i)=>{t&&(this.alias2Obj[i]=t.id,e[t.id]=t.id)},n=t=>{(t||[]).forEach((t=>{i.push(t)}))},a=(t,e)=>{t&&(this.__linkProblems=this.__linkProblems??[],(e||[]).forEach((e=>{var i=t.fieldByID(e.fieldID);if(i){var r=this.AB.objectByID(i.settings.linkObject);r?(s(r,e.alias),n(e.links),a(r,e.links)):this.__linkProblems.push({message:`could not resolve our linked field -> linkObject[${i.settings.linkObject}]`,data:{link:e}})}else this.__linkProblems.push({message:`could not resolve our linkField[${e.fieldID}]`,data:{link:e}})})))};var r=this.objectBase();r?(s(r,"BASE_OBJECT"),n(t.links),a(r,t.links),this._links=i,this.objectIDs=Object.keys(e)):this.__linkProblems.push({message:"could not resolve our base object",data:{objectID:this._joins?.objectID}})}exportJoins(){return this.AB.cloneDeep(this._joins||{})}model(){var t=new n(this);return t.contextKey(this.constructor.contextKey()),t.contextValues({id:this.id}),t}canFilterObject(t){return!!t&&this.objects((e=>e.id==t.id)).length>0}canFilterField(t){if(!t)return!1;let e=t.object;var i=t.datasourceLink;return this.canFilterObject(e)||this.canFilterObject(i)}urlPointer(t){return console.error("ABQueryCore.urlPointer(): Depreciated: Where is this being called?"),this.application.urlQuery(t)+this.id}get isGroup(){return this.settings.grouping||!1}get isReadOnly(){return!0}isDisabled(){return this.disabled||!1}get workspaceFilterConditions(){let t=super.workspaceFilterConditions;return null!=t&&null!=t.rules&&t.rules.length||(t=this.where),t}}},99183:(t,e,i)=>{var s=i(97069);const n=i(57043),a=i(86298);t.exports=class extends s{constructor(t,e){super(["label"],e),this.fromValues(t),this.elements().forEach((t=>{t.onProcessReady()}))}fromValues(t){this.id=t.id,this.name=t.name||"",this.type=t.type||"process",this.xmlDefinition=t.xmlDefinition||null;let e=this._elements||{};this._elements={},(t.elementIDs||[]).forEach((t=>{var i=this.AB.processElementNew(t,this);i?this._elements[t]=i:e[t]?this._elements[t]=e[t]:this.emit("warning",`P[${this.name}] is referencing an unknown process element id[${t}]`,{process:this.id,eID:t})})),this._connections=t.connections||{},super.fromValues(t),this.label||(this.label=this.name)}toObj(){this.label||(this.label=this.name);var t=super.toObj();for(var e in["id","name","xmlDefinition"].forEach((e=>{t[e]=this[e]})),t.elementIDs=[],this._elements)t.elementIDs.push(this._elements[e].id??this._elements[e].diagramID);return t.connections=this._connections,t}modelDefinition(){return this.xmlDefinition}modelNew(){this.xmlDefinition=`<?xml version="1.0" encoding="UTF-8"?>\n<bpmn2:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn2="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd" id="process-def-${this.id}" targetNamespace="http://bpmn.io/schema/bpmn">\n  <bpmn2:process id="Process_1" isExecutable="true">\n    <bpmn2:startEvent id="StartEvent_1"/>\n  </bpmn2:process>\n  <bpmndi:BPMNDiagram id="BPMNDiagram_1">\n    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1">\n      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">\n        <dc:Bounds height="36.0" width="36.0" x="412.0" y="240.0"/>\n      </bpmndi:BPMNShape>\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</bpmn2:definitions>`}modelUpdate(t){this.xmlDefinition=t}connections(t=(()=>!0)){var e=Object.keys(this._connections).map((t=>this._connections[t]));return this.process&&"SubProcess"===this.key&&(e=e.concat(this.process.connections())),e.filter(t)}connectionForDiagramID(t){return this.connections((e=>e.id==t))[0]}connectionsIncoming(t){return this.connections((e=>e.to==t))}connectionsOutgoing(t){return this.connections((e=>e.from==t))}connectionRemove(t){delete this._connections[t.id]}connectionSimplyElement(t){var e=t.businessObject,i=null;e.sourceRef&&(i=e.sourceRef.id);var s=null;return e.targetRef&&(s=e.targetRef.id),{id:t.id,type:t.type,from:i,to:s}}connectionUpsert(t){var e=this.connectionSimplyElement(t);e.from&&e.to&&t.parent?this._connections[e.id]=e:this.connectionRemove(t)}elements(t=(()=>!0)){return Object.keys(this._elements).map((t=>this._elements[t])).filter(t)}elementAdd(t){this._elements[t.id||t.diagramID]=t}elementByID(t){return this._elements[t]??null}elementForDiagramID(t){return this.elements((e=>e.diagramID==t))[0]}elementRemove(t){delete this._elements[t.id||t.diagramID]}isTriggeredBy(t){return null!=this.taskForTriggerKey(t)}connectionNextTask(t){var e=[];return this.connections((e=>e.from==t.diagramID)).forEach((t=>{var i=this.elements((e=>e.diagramID==t.to))[0];i&&e.push(i)})),e}connectionPreviousTask(t){var e=[];return this.connections((e=>e.to==t.diagramID)).forEach((t=>{var i=this.elements((e=>e.diagramID==t.from))[0];i&&e.push(i)})),e}processData(t,e){var i=this.allPreviousTasks(t),s=r(i,"processData",e,this);return s.length>0?s.length>1?s:s[0]:null}processDataFields(t){var e=this.allPreviousTasks(t),i=r(e,"processDataFields",null,this);return i.length>0?i:null}allPreviousConnectionsForConnection(t,e){this.connections((e=>e.to==t.from)).forEach((t=>{e[t.id]||(e[t.id]=t,this.allPreviousConnectionsForConnection(t,e))}))}allPreviousConnectionsForElement(t){var e=this.connections((e=>e.to==t.diagramID)),i={};return e.forEach((t=>{i[t.id]=t,this.allPreviousConnectionsForConnection(t,i)})),Object.keys(i).map((t=>i[t]))}allPreviousTasks(t){var e,i={};return this.allPreviousConnectionsForElement(t).forEach((t=>{(e=this.elementForDiagramID(t.to))&&(i[e.id]=e),(e=this.elementForDiagramID(t.from))&&(i[e.id]=e)})),Object.keys(i).map((t=>i[t])).filter((e=>e.id!=t.id))}processDataObjects(t){var e=this.connectionPreviousTask(t),i=r(e,"processDataObjects",null,this);return i.length>0?i:null}taskForTriggerKey(t){return this.elements((e=>e.triggerKey==t))[0]||null}};var r=(t,e,i,s,o,l)=>{if(void 0===o&&(o=[]),void 0===l&&(l=[]),0==t.length)return o;{const h=t.shift();if(-1==l.indexOf(h.diagramID)){l.push(h.diagramID);let r=null;h instanceof a||(r=h[e].apply(h,i)),null===r&&(r=[]),o=n(o,r),t=n(t,s.connectionPreviousTask(h))}return r(t,e,i,s,o,l)}}},399:(t,e,i)=>{var s=i(97069);i(57043),t.exports=class extends s{constructor(t,e){super(["name","text"],e),this.fromValues(t)}fromValues(t){this.id=t.id,this.name=t.name||"New Step",this.type=t.type||"step",this.text=t.text||"",this.settings=t.settings||{},this.settings.event=t?.settings?.event||"click",this.settings.el=t?.settings?.el||"",super.fromValues(t),this.label||(this.label=this.name)}toObj(){this.label||(this.label=this.name);var t=super.toObj();return["id","name","settings","type"].forEach((e=>{t[e]=this[e]})),t}}},15753:(t,e,i)=>{var s=[i(10902),i(20362),i(67373),i(17924),i(51939),i(71967),i(98104),i(1404),i(88016),i(37959),i(32715),i(4818),i(92471),i(80586),i(64411),i(4804),i(42774),i(38446),i(76145),i(6541),i(59285),i(37726),i(26239),i(20697),i(71227),i(12235),i(9403),i(87338),i(99258),i(41226),i(5670),i(80414),i(8990),i(77855),i(92885),i(69903),i(82011),i(73216),i(70704),i(15651),i(56339),i(46311),i(79662),i(16816),i(24655),i(87856),i(62941),i(38386),i(26114),i(48167),i(56222)],n={};s.forEach((t=>{t.default?.common&&(t=t.default),n[t.common().key]=t})),t.exports=class{static allViews(t=(()=>!0)){var e=[];for(var i in n){var s=n[i];t(s)&&e.push(s)}return e}static newView(t,e,i){if(i=i||null,"detailselectivity"==t.key&&(t.key="detailconnect"),t.key)return n[t.key]?new n[t.key](t,e,i):(console.error("!! View["+t.key+"] not yet defined.  Have an ABView instead:"),new n.view(t,e,i));var s=new Error(`Unknown view key [${t.key}]`);return console.error(s),console.error({error:s,values:t,application:e}),null}static viewClass(t){if(n[t])return n[t];console.error(`Unknown View Key[${t}]`)}}},50353:(t,e,i)=>{const s=i(8030);function n(t,e){if(!e)return null;if(!e.columnName)return null;const i=e.columnName;let s=null;if(i.indexOf(".")>-1){let e=i.split(".")[1];s=t[i]||t[e]}else s=t[i];if(null!=s&&!isNaN(s))return s;for(const i in t){const n=i.split(".")[1];n&&n==e.id&&(s=t[i])}return(null==s||"number"==typeof s&&isNaN(s))&&e.format&&(s=e.format(t)),s}t.exports=class extends s{constructor(t,e){t=t||"ab_filter_complex",void 0===e&&console.error("FilterComplexCore(): being called without an AB!"),super(null,t,e),this.Account={username:"??"},this._settings={},this.condition={},this._QueryFields=[],this._Fields,this._logic={callbacks:{onChange:()=>{}},removeHtmlTags:function(t){let e="";try{let i=document.createElement("div");i.innerHTML=t,e=i.textContent||i.innerText||""}catch(i){e=(t||"").replace(/(<([^>]+)>)/gi,"")}return e}}}init(t={}){this._settings=t}isValid(t,e=this.condition){if(e?.rules?.length&&null==t)return!1;if(!e?.rules?.length||null==t)return!0;let i="and"===e.glue;return e.rules.forEach((s=>{if(s?.rules?.length)return void(i="or"===e.glue?i||this.isValid(t,s):i&&this.isValid(t,s));if(!s.key||!s.rule)return;const a=(this._Fields||[]).filter((t=>t.id==s.key||t.columnName==s.key))[0];if(!a)return;let r=null,o=a.key;void 0===a.key&&("this_object"!=a.id?(a.key="connectField",o=a.key):o="this_object");let l=null;switch(l=a.relationName?function(t,e){let i="";if(t){let s=e.relationName();if(t[s])i=(e.indexField?t[s][e.indexField.columnName]:null)??(e.indexField2?t[s][e.indexField2.columnName]:null)??t[s].id??t[s];else{let s=n(t,e);null!=s&&(i=s)}}return i}(t,a):n(t,a),o){case"string":case"LongText":case"email":null==l&&(l=""),r=this.textValid(l,s.rule,s.value);break;case"date":case"datetime":r=this.dateValid(l,s.rule,s.value);break;case"number":case"calculate":case"formula":r=this.numberValid(l,s.rule,s.value);break;case"list":r=this.listValid(l,s.rule,s.value);break;case"boolean":r=this.booleanValid(l,s.rule,s.value);break;case"user":r=this.userValid(l,s.rule,s.value);break;case"connectField":case"connectObject":r=this.connectFieldValid(t,a,s.rule,s.value);break;case"this_object":r=this.thisObjectValid(t,s.rule,s.value)}i="and"===e.glue?i&&r:i||r})),i}textValid(t,e,i){let s=!1;t=t.trim().toLowerCase(),t=this._logic.removeHtmlTags(t);const n=(i=i.trim().toLowerCase().replace(/  +/g," ")).split(" ");switch(e){case"contains":n.forEach((e=>{0==s&&(s=t.indexOf(e)>-1)}));break;case"not_contains":s=!0,n.forEach((e=>{1==s&&(s=t.indexOf(e)<0)}));break;case"equals":n.forEach((e=>{0==s&&(s=t==e)}));break;case"not_equal":s=!0,n.forEach((e=>{1==s&&(s=t!=e)}));break;case"is_empty":s=""==t||null==t;break;case"is_not_empty":s=""!=t&&null!=t;break;default:s=this.queryFieldValid(t,e,i)}return s}dateValid(t,e,i){let s=!1;switch(t instanceof Date||(t=new Date(t)),i instanceof Date||(i=new Date(i)),e){case"less":s=t<i;break;case"greater":s=t>i;break;case"less_or_equal":s=t<=i;break;case"greater_or_equal":s=t>=i;break;default:s=this.queryFieldValid(t,e,i)}return s}numberValid(t,e,i){let s=!1;switch(t=Number(t),i=Number(i),e){case"equal":case"equals":s=t==i;break;case"not_equal":s=t!=i;break;case"less":s=t<i;break;case"greater":s=t>i;break;case"less_or_equal":s=t<=i;break;case"greater_or_equal":s=t>=i;break;default:s=this.queryFieldValid(t,e,i)}return s}listValid(t,e,i){let s=!1;switch(Array.isArray(i)||(i=[i]),e){case"equals":t&&(s=i.indexOf(t)>-1);break;case"not_equal":s=!t||i.indexOf(t)<0;break;default:s=this.queryFieldValid(t,e,i)}return s}booleanValid(t,e,i){let s=!1;return s="equals"===e?t==i:this.queryFieldValid(t,e,i),s}userValid(t,e,i){if(!t)return!1;let s=!1;switch(e){case"is_current_user":s=t==this.Account.username;break;case"is_not_current_user":s=t!=this.Account.username;break;case"contain_current_user":Array.isArray(t)||(t=[t]),s=t.filter((t=>(t.username||t)==this.Account.username)).length>0;break;case"not_contain_current_user":Array.isArray(t)||(t=[t]),s=t.filter((t=>(t.username||t)==this.Account.username)).length<1;break;case"equals":s=t.indexOf(i)>-1;break;case"not_equal":s=t.indexOf(i)<0;break;default:s=this.queryFieldValid(t,e,i)}return s}queryFieldValid(t,e,i){let s=!1;if(!i)return s;const n=i.split(":")[0],a=i.split(":")[1],r=this.AB.queries((t=>t.id==n))[0];if(!r)return s;if(!r.fields((t=>t.id==a))[0])return s;let o="{idBase}-query-field-{id}".replace("{idBase}",this.idBase).replace("{id}",r.id),l=new this.constructor(o,this.AB);switch(l.Account=this.Account,l.fieldsLoad(r.fields()),l.setValue(r.workspaceFilterConditions),e){case"in_query_field":s=l.isValid(t);break;case"not_in_query_field":s=!l.isValid(t)}return s}inQueryValid(t,e,i){let s=!1;if(!i||!this.AB)return s;let n=this.AB.queries((t=>t.id==i))[0];if(!n)return s;let a="{idBase}-query-{id}".replace("{idBase}",this.idBase).replace("{id}",n.id),r=new this.constructor(a,this.AB);switch(r.Account=this.Account,r.fieldsLoad(n.fields()),r.setValue(n.workspaceFilterConditions),e){case"in_query":s=r.isValid(t);break;case"not_in_query":s=!r.isValid(t)}return s}dataCollectionValid(t,e,i){let s=!1;if(!i)return s;let n=this.AB.datacollections((t=>t.id==i))[0];switch(e){case"in_data_collection":if(!n)return!1;s=n.getData((e=>e.id==t.id)).length>0;break;case"not_in_data_collection":if(!n)return!0;s=n.getData((e=>e.id==t.id)).length<1}return s}connectFieldValid(t,e,i,s){let a=e.relationName(),r="";if(t)if(t[a])r=((e.indexField?t[a][e.indexField.columnName]:null)??(e.indexField2?t[a][e.indexField2.columnName]:null)??t[a].id??t[a]).toString().toLowerCase();else{let i=n(t,e);null!=i&&(r=i)}"object"==typeof r&&(r=r[e.indexField.columnName]??r[e.indexField2.columnName]??r[e.columnName]??r);let o=(s||"").toLowerCase();switch(i){case"contains":return r.toString().indexOf(o)>-1;case"not_contains":return-1==r.toString().indexOf(o);case"equals":return r==o;case"not_equal":return r!=o;case"in_query":case"not_in_query":return this.inQueryValid(t[a],i,s);case"is_current_user":case"is_not_current_user":case"contain_current_user":case"not_contain_current_user":return this.userValid(r,i,s);case"is_empty":return null==t[a]||t[a].length<1||""==t[a];case"is_not_empty":return null!=t[a]&&(Array.isArray(t[a])&&t[a].length>0||""!=t[a]);case"in_data_collection":case"not_in_data_collection":return this.dataCollectionValid(r,i,s)}}thisObjectValid(t,e,i){let s=null,n=null,a=null,r=null;switch(e){case"in_query":case"not_in_query":return!!this._Object&&(s=this.AB.queries((t=>t.id==i))[0],!!s&&(n=s.objects((t=>t.id==this._Object.id)),n.length>1?(console.error("HEY!  Can't compare this_object to a query that has > 1 copy of that object!"),!0):(a=s.objectAlias(this._Object.id),r={},Object.keys(t).forEach((e=>{r[`${a}.${e}`]=t[e]})),this.inQueryValid(r,e,i))));case"in_data_collection":case"not_in_data_collection":return this.dataCollectionValid(t,e,i)}}processFieldsLoad(t=[]){t&&!Array.isArray(t)&&(t=[t]),this._ProcessFields=t,this.uiInit()}fieldsLoad(t=[],e=null){if(this._Fields=t.filter((t=>t&&t.fieldIsFilterable&&t.fieldIsFilterable())),this._QueryFields=this._Fields?this._Fields.filter((t=>t&&t.isConnection&&"user"!=t.key)):[],e){this._Object=e;let t={id:"this_object",label:e.label,key:"uuid"};e.viewName&&(t.alias="BASE_OBJECT"),this._Fields.unshift(t)}else delete this._Object}fieldsToQB(){return(this._Fields||[]).map((t=>{let e=t.label;this._settings.showObjectName&&t.object&&t.object.label&&(e=`${t.object.label}.${t.label}`);let i="text",s=[],n=[],a=!0;if(this._settings.isProcessParticipant)switch(t.key){case"connectObject":case"uuid":a=!1}else switch(t.key){case"boolean":s=s.concat(this.fieldsAddFiltersBoolean(t)),n=["boolean"];break;case"connectObject":s=this.fieldsAddFiltersConnectObject(t),t.settings.isCustomFK&&("one"==t.settings.linkType&&"many"==t.settings.linkViaType||"one"==t.settings.linkType&&"one"==t.settings.linkViaType&&t.settings.isSource)&&(s=this.fieldsAddFiltersString(t).concat(s)),a=!1,n=["connectObject"];break;case"date":case"datetime":i="date",s=s.concat(this.fieldsAddFiltersDate(t)),n=["date","datetime"];break;case"calculate":case"formula":case"number":i="number",s=s.concat(this.fieldsAddFiltersNumber(t)),n=["calculate","formula","number"];break;case"string":case"LongText":case"email":case"AutoIndex":s=s.concat(this.fieldsAddFiltersString(t)),n=["string","LongText","email","AutoIndex"];break;case"list":s=s.concat(this.fieldsAddFiltersList(t));break;case"user":s=s.concat(this.fieldsAddFiltersUser(t)),n=["user"];break;case"uuid":s=s.concat(this.fieldsAddFiltersThisObject(t)),a=!1}return s=s.concat(this.fieldsAddFiltersQuery(t,a)),this._settings.isRecordRule&&(s=s.concat(this.fieldsAddFiltersRecordRule(t))),(this._ProcessFields||[]).filter((e=>{if(!e)return!1;if(e.field)return n.includes(e.field.key);if(e.key){let i=e.key.split(".").pop();return i==t.id||i==t.key}})).length>0&&(s=s.concat(this.fieldsAddFiltersContext(t))),s=s.concat(this.fieldsAddFiltersCustom(t)),{id:t.id,value:e,type:i,conditions:s}}))}fieldsAddFiltersDate(t){let e={less:this.labels.component.beforeCondition,greater:this.labels.component.afterCondition,less_or_equal:this.labels.component.onOrBeforeCondition,greater_or_equal:this.labels.component.onOrAfterCondition,less_current:this.labels.component.beforeCurrentCondition,greater_current:this.labels.component.afterCurrentCondition,less_or_equal_current:this.labels.component.onOrBeforeCurrentCondition,greater_or_equal_current:this.labels.component.onOrAfterCurrentCondition,last_days:this.labels.component.onLastDaysCondition,next_days:this.labels.component.onNextDaysCondition},i=[];for(let t in e)i.push({id:t,value:e[t],batch:"datepicker",handler:(e,i)=>this.dateValid(e,t,i)});return i}fieldsAddFiltersString(t){let e={contains:{batch:"text",label:this.labels.component.containsCondition},not_contains:{batch:"text",label:this.labels.component.notContainsCondition},equals:{batch:"text",label:this.labels.component.isCondition},not_equal:{batch:"text",label:this.labels.component.isNotCondition},is_empty:{batch:"none",label:this.labels.component.isEmpty},is_not_empty:{batch:"none",label:this.labels.component.isNotEmpty}},i=[];for(let t in e)i.push({id:t,value:e[t].label,batch:e[t].batch,handler:(e,i)=>this.textValid(e,t,i)});return i}fieldsAddFiltersNumber(t){let e={equals:this.labels.component.equalCondition,not_equal:this.labels.component.notEqualCondition,less:this.labels.component.lessThanCondition,greater:this.labels.component.moreThanCondition,less_or_equal:this.labels.component.lessThanOrEqualCondition,greater_or_equal:this.labels.component.moreThanOrEqualCondition},i=[];for(let t in e)i.push({id:t,value:e[t],batch:"text",handler:(e,i)=>this.numberValid(e,t,i)});return i}fieldsAddFiltersList(t){let e={equals:this.labels.component.equalListCondition,not_equal:this.labels.component.notEqualListCondition},i=[];for(let t in e)i.push({id:t,value:e[t],batch:"list",handler:(e,i)=>this.listValid(e,t,i)});return i}fieldsAddFiltersBoolean(t){let e={equals:this.labels.component.equalListCondition},i=[];for(let t in e)i.push({id:t,value:e[t],batch:"boolean",handler:(e,i)=>this.booleanValid(e,t,i)});return i}fieldsAddFiltersUser(t){let e={is_current_user:{batch:"none",label:this.labels.component.isCurrentUserCondition},is_not_current_user:{batch:"none",label:this.labels.component.isNotCurrentUserCondition},contain_current_user:{batch:"none",label:this.labels.component.containsCurrentUserCondition},not_contain_current_user:{batch:"none",label:this.labels.component.notContainsCurrentUserCondition},equals:{batch:"user",label:this.labels.component.equalListCondition},not_equal:{batch:"user",label:this.labels.component.notEqualListCondition}},i=[];for(let t in e)i.push({id:t,value:e[t].label,batch:e[t].batch,handler:(e,i)=>this.userValid(e,t,i)});return i}fieldsAddFiltersConnectObject(t){const e={same_as_user:{batch:"user",label:this.labels.component.sameAsUser,handler:(t,e)=>this.userValid(t,"same_as_user",e)},not_same_as_user:{batch:"user",label:this.labels.component.notSameAsUser,handler:(t,e)=>this.userValid(t,"not_same_as_user",e)},in_data_collection:{batch:"datacollection",label:this.labels.component.inDataCollection,handler:(t,e)=>this.dataCollectionValid(t,"in_data_collection",e)},not_in_data_collection:{batch:"datacollection",label:this.labels.component.notInDataCollection,handler:(t,e)=>this.dataCollectionValid(t,"not_in_data_collection",e)}},i=[];for(let t in e)i.push({id:t,value:e[t].label,batch:e[t].batch,handler:e[t].handler});return i}fieldsAddFiltersQuery(t,e=!1){const i=e?{in_query_field:{label:this.labels.component.inQueryField,batch:"queryField"},not_in_query_field:{label:this.labels.component.notInQueryField,batch:"queryField"}}:{in_query:{label:this.labels.component.inQuery,batch:"query"},not_in_query:{label:this.labels.component.notInQuery,batch:"query"}},s=[];for(const t in i)s.push({id:t,value:i[t].label,batch:i[t].batch,handler:(e,i)=>this.queryFieldValid(e,t,i)});return s}fieldsAddFiltersThisObject(t){let e={in_data_collection:{batch:"datacollection",label:this.labels.component.inDataCollection},not_in_data_collection:{batch:"datacollection",label:this.labels.component.notInDataCollection}},i=[];for(let t in e)i.push({id:t,value:e[t].label,batch:e[t].batch,handler:(e,i)=>this.thisObjectValid(e,t,i)});return i}fieldsAddFiltersRecordRule(t){let e={same_as_field:this.labels.component.sameAsField,not_same_as_field:this.labels.component.notSameAsField},i=[];for(let t in e)i.push({id:t,value:e[t],batch:"recordRule",handler:(t,e)=>!0});return i}fieldsAddFiltersContext(t){let e={context_equals:{batch:"context",label:this.labels.component.equalsProcessValue,handler:(t,e)=>t==e},context_not_equal:{batch:"context",label:this.labels.component.notEqualsProcessValueCondition,handler:(t,e)=>t!=e},context_in:{batch:"context",label:this.labels.component.inProcessValueCondition,handler:(t,e)=>t.indexOf(e)>-1},context_not_in:{batch:"context",label:this.labels.component.notInProcessValueCondition,handler:(t,e)=>-1==t.indexOf(e)}},i=[];for(let t in e)i.push({id:t,value:e[t].label,batch:e[t].batch,handler:e[t].handler});return i}fieldsAddFiltersCustom(t){return((this._customOptions??{})[t.id||t]??{}).conditions??[]}queriesLoad(t=[]){this._Queries=t}queries(t=(()=>!0)){return(this._Queries??this.AB?.queries?.()??[]).filter((e=>t(e)))}setValue(t){this.condition=t||{},this.condition.rules=this.condition.rules||[]}getValue(){return void 0===this.condition.glue&&(this.condition.glue="and"),this.condition}isComplete(){let t=!0;const e=["is_current_user","is_not_current_user","contain_current_user","not_contain_current_user","same_as_user","not_same_as_user"],i=(s=[])=>{0!=t&&s.forEach((s=>{s?.rules&&Array.isArray(s?.rules)?i(s?.rules):t=t&&null!=s?.key&&""!=s?.key&&null!=s?.rule&&""!=s?.rule&&(null!=s?.value&&""!=s?.value||e.indexOf(s?.rule)>-1)}))};return i(this.condition?.rules),t}}},61584:(t,e,i)=>{const s=i(8030);function n(t,e,i=!0){if(!e)return null;if(!e.columnName)return null;t&&t[0]&&(t=t[0]);let s=e.id,n=e.columnName,a=null;if(n.indexOf(".")>-1){let e=n.split(".")[1];a=t[n]||t[e]||t[s]}else a=t[n]||t[s];if(a)return a;for(var r in t){var o=r.split(".")[1];!o||o!=s&&o!=n||(a=t[r])}return a&&Array.isArray(a)&&(a=a.filter((t=>null!=t)),i&&(a=a[0])),a}t.exports=class extends s{constructor(t,e,i){super(t,e=e||"ab_row_filter",i),this.Account={username:"??"},this._settings={},this.config_settings={},this._QueryFields=[],this._Fields;var s=this._logic={callbacks:{onChange:()=>{}},getValue:()=>this.config_settings,removeHtmlTags:function(t){let e="";try{let i=document.createElement("div");i.innerHTML=t,e=i.textContent||i.innerText||""}catch(i){e=(t||"").replace(/(<([^>]+)>)/gi,"")}return e},textValid:function(t,e,i,a){var r=!1,o=n(t,e);null==o&&(o=""),o=o.toString().trim().toLowerCase(),o=s.removeHtmlTags(o);var l=(a=a.toString().trim().toLowerCase().replace(/  +/g," ")).split(" ");switch(i){case"contains":l.forEach((t=>{0==r&&(r=o.indexOf(t)>-1)}));break;case"not_contains":r=!0,l.forEach((t=>{1==r&&(r=o.indexOf(t)<0)}));break;case"equals":l.forEach((t=>{0==r&&(r=o==t)}));break;case"not_equal":r=!0,l.forEach((t=>{1==r&&(r=o!=t)}));break;case"is_empty":r=null==o||""==o;break;case"is_not_empty":r=null!=o&&""!=o;break;default:r=s.queryValid(t,i,a)}return r},dateValid:function(t,e,i,a){var r=!1,o=n(t,e);switch(o instanceof Date||(o=new Date(o)),a instanceof Date||(a=new Date(a)),i){case"equals":r=o==a;break;case"not_equal":r=o!=a;break;case"less":r=o<a;break;case"greater":r=o>a;break;case"less_or_equal":r=o<=a;break;case"greater_or_equal":r=o>=a;break;default:r=s.queryValid(t,i,a)}return r},numberValid:function(t,e,i,a){var r=!1,o=n(t,e);switch(o=Number(o),a=Number(a),i){case"equals":r=o==a;break;case"not_equal":r=o!=a;break;case"less":r=o<a;break;case"greater":r=o>a;break;case"less_or_equal":r=o<=a;break;case"greater_or_equal":r=o>=a;break;default:r=s.queryValid(t,i,a)}return r},listValid:function(t,e,i,a){var r=!1,o=n(t,e);switch(o&&o.toLowerCase&&(o=o.toLowerCase()),a=a.toLowerCase(),Array.isArray(a)||(a=[a]),i){case"equals":o&&(r=a.indexOf(o)>-1);break;case"not_equal":r=!o||a.indexOf(o)<0;break;default:r=s.queryValid(t,i,a)}return r},booleanValid:function(t,e,i,a){var r=!1,o=n(t,e);switch(null==o&&(o=!1),i){case"equals":r=o==a;break;case"not_equal":r=o!=a;break;default:r=s.queryValid(t,i,a)}return r},userValid:(t,e,i,a)=>{var r=!1,o=n(t,e);switch(i){case"is_current_user":r=o==this.Account.username;break;case"is_not_current_user":r=o!=this.Account.username;break;case"contain_current_user":if(!o){r=!1;break}Array.isArray(o)||(o=[o]),r=(o||[]).filter((t=>!!t&&(t.username||t.id||t.text||t)==this.Account.username)).length>0;break;case"not_contain_current_user":if(!o){r=!1;break}Array.isArray(o)||(o=[o]),r=0==(o||[]).filter((t=>!!t&&(t.username||t.id||t.text||t)==this.Account.username)).length;break;case"equals":r=o.indexOf(a)>-1;break;case"not_equal":r=o.indexOf(a)<0;break;default:r=s.queryValid(t,i,a)}return r},queryValid:(t,i,s)=>{var n=!1;if(!this.AB||!s)return n;var a=s.split(":")[0],r=s.split(":")[1],o=this.queries((t=>t.id==a))[0];if(!o)return n;if(!o.fields((t=>t.id==r))[0])return n;let l="{idBase}-query-field-{id}".replace("{idBase}",e).replace("{id}",o.id),h=new this.constructor(this.App,l);switch(h.Account=this.Account,h.fieldsLoad(o.fields()),h.setValue(o.workspaceFilterConditions),i){case"in_query_field":n=h.isValid(t);break;case"not_in_query_field":n=!h.isValid(t)}return n},inQueryValid:(t,i,s,n)=>{let a=!1;if(i&&(t=t[i]||{}),!n||!this.AB)return a;let r=this.queries((t=>t.id==n))[0];if(!r)return a;let o="{idBase}-query-{id}".replace("{idBase}",e).replace("{id}",r.id),l=new this.constructor(this.App,o);switch(l.Account=this.Account,l.fieldsLoad(r.fields()),l.setValue(r.workspaceFilterConditions),s){case"in_query":a=l.isValid(t);break;case"not_in_query":a=!l.isValid(t)}return a},dataCollectionValid:(t,e,i,s)=>{var n=!1;if(!s||!this.AB)return n;e&&(t=t[e]||{});let a=this.AB.datacollectionByID(s);switch(i){case"in_data_collection":if(!a)return!1;n=a.getData((e=>(e.id||e.uuid)==(t.id||t.uuid))).length>0;break;case"not_in_data_collection":if(!a)return!0;n=a.getData((e=>(e.id||e.uuid)==(t.id||t.uuid))).length<1}return n},connectFieldValid:function(t,e,i,a){let r=e.relationName(),o="";if(t)if(t[r])o=(!!e.indexField&&t[r][e.indexField.columnName]||!!e.indexField2&&t[r][e.indexField2.columnName]||t[r].id||t[r]).toString().toLowerCase();else{let i=n(t,e);null!=i&&(o=i,"object"==typeof o&&(o=e.datasourceLink.displayData(o)))}let l=(a||"").toLowerCase();switch(i){case"contains":return o.toString().indexOf(l)>-1;case"not_contains":return-1==o.toString().indexOf(l);case"equals":return o==l;case"not_equal":return o!=l;case"in_query":case"not_in_query":return s.inQueryValid(t,r,i,a);case"is_current_user":case"is_not_current_user":case"contain_current_user":case"not_contain_current_user":return s.userValid(t,e,i,a);case"is_empty":return null==t[r]||t[r].length<1||""==t[r];case"is_not_empty":return null!=t[r]&&(Array.isArray(t[r])&&t[r].length>0||""!=t[r]);case"in_data_collection":case"not_in_data_collection":return s.dataCollectionValid(t,r,i,a)}},thisObjectValid:(t,e,i)=>{switch(e){case"in_query":case"not_in_query":if(!this.AB||!this._Object)return!1;var n=this.queries((t=>t.id==i))[0];if(!n)return!1;if(n.objects((t=>t.id==this._Object.id)).length>1)return console.error("HEY!  Can't compare this_object to a query that has > 1 copy of that object!"),!0;var a=n.objectAlias(this._Object.id),r={};return Object.keys(t).forEach((e=>{r[`${a}.${e}`]=t[e]})),s.inQueryValid(r,null,e,i);case"in_data_collection":case"not_in_data_collection":return s.dataCollectionValid(t,null,e,i)}}};this.getValue=s.getValue}init(t){t.showObjectName&&(this._settings.showObjectName=t.showObjectName)}isValid(t){var e=this.config_settings,i=this._logic;if(null==e||null==e.rules||0==e.rules.length)return!0;if(null==t)return!1;var s="and"===e.glue;return e.rules.forEach((n=>{if(n?.key&&n?.rule){var a=this._Fields.filter((t=>t.id==n.key))[0];if(a){var r,o=a.key;switch(void 0===a.key&&("this_object"!=a.id?(a.key="connectField",o=a.key):o="this_object"),o){case"string":case"LongText":case"email":r=i.textValid(t,a,n.rule,n.value);break;case"date":case"datetime":r=i.dateValid(t,a,n.rule,n.value);break;case"number":case"formula":r=i.numberValid(t,a,n.rule,n.value);break;case"list":r=i.listValid(t,a,n.rule,n.value);break;case"boolean":r=i.booleanValid(t,a,n.rule,n.value);break;case"user":r=i.userValid(t,a,n.rule,n.value);break;case"connectField":case"connectObject":r=i.connectFieldValid(t,a,n.rule,n.value);break;case"this_object":r=i.thisObjectValid(t,n.rule,n.value)}s="and"===e.glue?s&&r:s||r}}})),s}fieldsLoad(t=[],e=null){if(this._Fields=t.filter((t=>t?.fieldIsFilterable?.())),this._QueryFields=this._Fields?this._Fields.filter((t=>t&&t.isConnection&&"user"!=t.key)):[],e){this._Object=e;let t={id:"this_object",label:e.label};e.viewName&&(t.alias="BASE_OBJECT"),this._Fields.unshift(t)}else delete this._Object}queriesLoad(t=[]){this._Queries=t}queries(t=(()=>!0)){let e=[];return this.AB&&(e=e.concat(this.AB.queries(t))),this._Queries&&(e=e.concat((this._Queries||[]).filter((i=>t(i)&&e.filter((t=>t.id==i.id)).length<1)))),e}setValue(t){this.config_settings=t||{},this.config_settings.rules=this.config_settings.rules||[]}}},96552:(t,e,i)=>{const s=i(14403);function n(t,e){return e}const a={key:"AutoIndex",description:"Auto Increment Value",icon:"key",isFilterable:!0,isSortable:!0,menuName:"Auto Index",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["number"],compatibleMysqlTypes:["tinyint","smallint","mediumint","int","integer"]},r={prefix:"",delimiter:"none",displayLength:4,previewText:"0000"};t.exports=class extends s{constructor(t,e){super(t,e,a)}static defaults(){return a}static defaultValues(){return r}static getDelimiterSign(t){const e=this.delimiterList().filter((e=>e.id==t))[0];return e?e.sign:""}static delimiterList(){return[{id:"none",value:n(),sign:""},{id:"comma",value:n(),sign:", "},{id:"slash",value:n(),sign:"/"},{id:"space",value:n(),sign:" "},{id:"dash",value:n(),sign:"-"},{id:"colon",value:n(),sign:":"}]}static setValueToIndex(t,e,i,s){return t+this.getDelimiterSign(e)+("0000000000"+s).slice(-parseInt(i))}fromValues(t){super.fromValues(t),this.settings.displayLength=parseInt(this.settings.displayLength)}defaultValue(t){delete t[this.columnName]}format(t){if(!t?.[this.columnName])return"";try{return this.constructor.setValueToIndex(this.settings.prefix,this.settings.delimiter,this.settings.displayLength,t[this.columnName])}catch(t){return""}}}},43104:(t,e,i)=>{const s=i(14403),n={key:"boolean",description:"A single checkbox that can be checked or unchecked.",icon:"check-square-o",isFilterable:!0,isSortable:!1,menuName:"Checkbox",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["boolean"],compatibleMysqlTypes:["bool","boolean"]},a={default:0};t.exports=class extends s{constructor(t,e){super(t,e,n)}static defaults(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),null!=this.settings.default&&(this.settings.default=parseInt(this.settings.default))}defaultValue(t){null==t[this.columnName]&&null!=this.settings.default&&(t[this.columnName]=this.settings.default)}}},54562:(module,__unused_webpack_exports,__webpack_require__)=>{const ABField=__webpack_require__(14403);function L(t,e){return e}function AGE(t){if(!t)return 0;const e=new Date(t);if(!e)return 0;const i=(new Date-e)/31536e6;return i<1?Math.round(10*i)/10:Math.floor(i)}function YEAR(t){if(!t)return 0;const e=new Date(t);return e?e.getFullYear():0}function MONTH(t){if(!t)return 0;const e=new Date(t);return e?e.getMonth():0}function DAY(t){if(!t)return 0;const e=new Date(t);return e?e.getDate():0}function DATE(t){if(!t)return 0;const e=new Date(t);return e?Math.round(e.getTime()/864e5):0}function HOUR(t){if(!t)return 0;const e=new Date(t);return e?Math.round(e.getTime()/36e5):0}function MINUTE(t){if(!t)return 0;const e=new Date(t);return e?Math.round(e.getTime()/6e4):0}function MINUTE_TO_HOUR(t){const e=t/60,i=Math.floor(e),s=60*(e-i),n=Math.round(s);return parseFloat(`${i}.${n}`)}const ABFieldCalculateDefaults={key:"calculate",description:"Perform a calculation based upon existing values",icon:"calculator",isFilterable:t=>0==["MINUTE_TO_HOUR","DATE","HOUR","MINUTE"].filter((e=>t.settings.formula.includes(e))).length,isSortable:!1,menuName:"Calculate",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["number"],compatibleMysqlTypes:["tinyint","smallint","mediumint","int","integer","bigint","decimal","dec","numeric","fixed","float","real"]},defaultValues={formula:"",decimalSign:"none",decimalPlaces:0};module.exports=class ABFieldCalculateCore extends ABField{constructor(t,e){super(t,e,ABFieldCalculateDefaults)}static defaults(){return ABFieldCalculateDefaults}static defaultValues(){return defaultValues}static convertToJs(object,formula,rowData,place,alias=null){return formula?(formula=formula.replace(/\(CURRENT\)/g,"(new Date())"),object.fields().forEach((t=>{let e=t.columnName;if(e.indexOf(".")>-1&&(e=e.split(".")[1]),formula.indexOf("{"+e+"}")<0)return;const i=rowData[`${object.alias??alias}.${t.columnName}`]??rowData[t.columnName];if("number"==t.key){const t=`(${i||0})`;formula=formula.replace(new RegExp("{"+e+"}","g"),t)}else if("calculate"==t.key||"formula"==t.key){let i=t.format(rowData)||0;"string"==typeof i&&(i=i.replace(/[^-0-9.]/g,"")),i=`(${i})`,formula=formula.replace(new RegExp("{"+e+"}","g"),i)}else if("date"==t.key){const t=`"${i||""}"`;formula=formula.replace(new RegExp("{"+e+"}","g"),t)}else if("boolean"==t.key){const t=`(${i||0})`;formula=formula.replace(new RegExp("{"+e+"}","g"),t)}})),eval(formula).toFixed(place||0)):""}defaultValue(t){delete t[this.columnName]}format(t){let e=0;"none"!=this.settings.decimalSign&&(e=this.settings.decimalPlaces);try{let i=this.constructor.convertToJs(this.object,this.settings.formula,t,e,this.alias);switch("string"==typeof i&&(i=i.replace(/[^-0-9.]/g,"")),this.settings.decimalSign){case"comma":i=i.replace(".",",");break;case"space":i=i.replace("."," ")}return i}catch(t){return""}}}},83551:(t,e,i)=>{const s=i(14403),n={key:"combined",description:"Combined Value",icon:"key",isFilterable:!0,isSortable:!1,menuName:"Combined Field",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["text","mediumtext","longtext"]},a={combinedFields:"",delimiter:"plus"};t.exports=class extends s{constructor(t,e){super(t,e,n)}static defaults(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.delimiter=t.settings.delimiter||a.delimiter}defaultValue(t){delete t[this.columnName]}}},86932:(t,e,i)=>{var s=i(14403);const n={key:"connectObject",description:"Connect two data objects together",icon:"external-link",isFilterable:!0,isSortable:t=>["one:many","one:one"].indexOf(`${t?.settings?.linkType}:${t?.settings?.linkViaType}`)>-1,menuName:"Connect to another record",supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"]},a={linkObject:"",linkType:"one",linkViaType:"many",linkColumn:"",isSource:null,isCustomFK:0,indexField:"",indexField2:""};t.exports=class extends s{constructor(t,e,i=n){super(t,e,i),this.isConnection=!0}static defaults(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.isSource=parseInt(this.settings.isSource||0),this.settings.isCustomFK=parseInt(this.settings.isCustomFK||0)}defaultValue(){}isValidData(t,e){super.isValidData(t,e)}relationName(){if(this.columnName.indexOf(".")>-1){const t=this.columnName.split(".");return`${t[0]}.${this.AB.rules.toFieldRelationFormat(t[1])}`}return this.AB.rules.toFieldRelationFormat(this.columnName)}get datasourceLink(){const t=this.AB.objectByID(this.settings.linkObject);if(!t){const t=new Error(`ConnectField[${this.label}][${this.id}] unable to find linkObject[${this.settings.linkObject}]`);this.AB.notify.builder(t,{field:this,linkObject:this.settings.linkObject})}return t}get fieldLink(){const t=this.datasourceLink;if(!t)return null;const e=t.fieldByID(this.settings.linkColumn);if(!e){const t=new Error(`ConnectField[${this.label}][${this.id}] unable to find linkColumn[${this.settings.linkColumn}]`);this.AB.notify.builder(t,{field:this,linkColumn:this.settings.linkColumn})}return e}pullRelationValues(t){let e;const i=this.datasourceLink;let s=this.dataValue(t);if(s&&i){if("string"==typeof s)try{s=JSON.parse(s)}catch(t){e=s}e=s}return e}dataValue(t){if(null==t)return"";const e=`${this.object.name}.${this.relationName()}`;return t[this.relationName()]||t[e]||t[this.columnName]||""}format(t){const e=this.pullRelationValues(t),i=this.datasourceLink;return Array.isArray(e)?e.map((t=>null==t.text?i.displayData(t)||"":t.text||"")).join(", "):e?null==e.text?i.displayData(t)||"":e.text?e.text||"":void 0:""}linkType(){return this.settings.linkType}linkViaType(){return this.settings.linkViaType}isSource(){return this.settings.isSource}get indexField(){if(!this.settings.isCustomFK||!this.settings.indexField)return null;const t=`${this.settings.linkType}:${this.settings.linkViaType}`;if("one:many"===t)return this.datasourceLink.fieldByID(this.settings.indexField);if("one:one"===t)return this.settings.isSource?this.datasourceLink.fieldByID(this.settings.indexField):this.object.fieldByID(this.settings.indexField);if("many:one"===t)return this.object.fieldByID(this.settings.indexField);if("many:many"===t){let t=this.object.fieldByID(this.settings.indexField);return null==t&&(t=this.datasourceLink.fieldByID(this.settings.indexField)),t}return null}get indexField2(){if(!this.settings.isCustomFK||!this.settings.indexField2)return null;let t;return"many"==this.settings.linkType&&"many"==this.settings.linkViaType&&(t=this.object.fieldByID(this.settings.indexField2),null==t&&(t=this.datasourceLink.fieldByID(this.settings.indexField2))),t}getRelationValue(t,e={}){if(null==t)return;let i;const s=this.indexField,n=this.datasourceLink,a=`${this.settings.linkType}:${this.settings.linkViaType}`;if("many:many"===a){const t=this.indexField2;s&&s.object.id==n.id?i=s.columnName:t&&t.object.id==n.id&&(i=t.columnName)}else s&&("one:many"===a||"one:one"===a&&this.settings.isSource)?i=s.columnName:"many:one"===a?i=e.forUpdate?n.PK():s?s.columnName:this.fieldLink.columnName:n&&(i=n.PK());let r=t[i]||t[this.object?.PK()]||t.id||t;return"id"==i&&(r=parseInt(r)),r}}},98601:(t,e,i)=>{const s=i(97069);t.exports=class extends s{constructor(t,e,i){super(["label"],e.AB),this.defaults=i||{},this.object=e,this.fromValues(t)}static get reservedNames(){return["id","created_at","updated_at","properties","createdAt","updatedAt"]}static defaultValues(){return{}}fieldKey(){return this.defaults.key}fieldOrmTypes(){return this.defaults.compatibleOrmTypes?Array.isArray(this.defaults.compatibleOrmTypes)?this.defaults.compatibleOrmTypes:[this.defaults.compatibleOrmTypes]:[]}fieldMysqlTypes(){return this.defaults.compatibleMysqlTypes?Array.isArray(this.defaults.compatibleMysqlTypes)?this.defaults.compatibleMysqlTypes:[this.defaults.compatibleMysqlTypes]:[]}fieldIcon(){return this.defaults.icon}fieldMenuName(){return this.defaults.menuName}fieldDescription(){return this.defaults.description}fieldIsFilterable(){return null!=this.defaults.isFilterable?"function"==typeof this.defaults.isFilterable?this.defaults.isFilterable(this):this.defaults.isFilterable:1}fieldIsSortable(){return null!=this.defaults.isSortable?"function"==typeof this.defaults.isSortable?this.defaults.isSortable(this):this.defaults.isSortable:1}fieldUseAsLabel(){return null!=this.defaults.useAsLabel?"function"==typeof this.defaults.useAsLabel?this.defaults.useAsLabel(this):this.defaults.useAsLabel:1}fieldSupportRequire(){return!this.defaults.supportRequire||this.defaults.supportRequire}fieldSupportQuery(){return null==this.defaults.supportQuery||("function"==typeof this.defaults.supportQuery?this.defaults.supportQuery(this):this.defaults.supportQuery)}toObj(){const t=super.toObj();return{id:this.id,type:this.type||"field",key:this.key,icon:this.icon,isImported:this.isImported,columnName:this.columnName,settings:this.settings,translations:t.translations}}defaultCheck(t,e){let i=e;return void 0!==t&&(i=t),i}fromValues(t){this.id||(this.id=t.id),this.type,t.type,this.key=t.key||this.fieldKey(),this.icon=t.icon||this.fieldIcon(),t.settings=t.settings||{},this.label=t.label||t.settings.label||"?label?",this.columnName=t.columnName||"",this.isImported=t.isImported||0,this.settings=t.settings,this.settings.showIcon=this.defaultCheck(t.settings.showIcon,"1"),this.settings.required=this.defaultCheck(t.settings.required,"0"),this.settings.width=this.defaultCheck(t.settings.width,"0"),this.isImported=parseInt(this.isImported),this.settings.showIcon=parseInt(this.settings.showIcon),this.settings.required=parseInt(this.settings.required),this.settings.unique=parseInt(this.settings.unique||0),this.settings.width=parseInt(this.settings.width);const e=this.constructor.defaultValues()||{};for(const i in e)this.settings[i]=this.defaultCheck(t.settings[i],e[i]);super.fromValues(t),this.columnName=this.columnName||this.label,this.columnName=this.columnName.replace(/[^a-zA-Z0-9_ ]/gi,"")}urlPointer(){return this.object.urlField()+this.id}defaultValue(t){t[this.columnName]=""}isValidData(t,e){!this.settings.required||null!=t[this.columnName]&&""!=t[this.columnName]||0==t[this.columnName]||e.addError(this.columnName,"This is a required field.")}get isMultilingual(){return!1}dataValue(t){const e=`${this.alias||this.object.name}.${this.columnName}`;let i="";return null!=t?.[this.columnName]?i=t[this.columnName]:null!=t?.[e]&&(i=t[e]),i}format(t){return t?this.dataValue(t):""}toDefinition(){const t=super.toDefinition();return""==t.name&&(t.name=t.json.name||t.json.label||t.json.columnName),this.object&&this.object.name&&(t.name=`${this.object.name}->${t.name}`),t}}},96915:(t,e,i)=>{const s=i(14403);function n(t,e){return e}const a={key:"date",description:"Pick one from a calendar.",icon:"calendar",isFilterable:!0,isSortable:!0,menuName:"Date",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["date"],compatibleMysqlTypes:["date"]},r={dateFormat:2,defaultDate:1,defaultDateValue:null,validateCondition:"none",validateRangeUnit:"days",validateRangeBefore:0,validateRangeAfter:0,validateStartDate:null,validateEndDate:null};t.exports=class extends s{constructor(t,e,i=a){super(t,e,i)}static defaults(){return a}static defaultValues(){return r}fromValues(t){super.fromValues(t),this.settings.dateFormat=parseInt(this.settings.dateFormat),this.settings.defaultDate=parseInt(this.settings.defaultDate)}defaultValue(t){if(null!=t[this.columnName])return;let e;2==this.settings.defaultDate?e=new Date:3==this.settings.defaultDate&&this.settings.defaultDateValue&&(e=new Date(this.settings.defaultDateValue)),null!=e&&(t[this.columnName]=this.AB.rules.toDateFormat(e,{format:"YYYY-MM-DD"}))}isValidData(t,e){if(super.isValidData(t,e),t[this.columnName]){let i=t[this.columnName];if(i instanceof Date||(i=this.AB.rules.toDate(i)),"[object Date]"===Object.prototype.toString.call(i)&&isFinite(i)){let s=!0;if(this.settings&&this.settings.validateCondition){const t=this.settings.validateStartDate?new Date(this.settings.validateStartDate):null,a=this.settings.validateEndDate?new Date(this.settings.validateEndDate):null,r=this.getDateDisplay(t),o=this.getDateDisplay(a),l=this.AB.rules.subtractDate(new Date,this.settings.validateRangeBefore,this.settings.validateRangeUnit),h=this.AB.rules.addDate(new Date,this.settings.validateRangeAfter,this.settings.validateRangeUnit);switch(this.settings.validateCondition){case"dateRange":l<i&&i<h?s=!0:(s=!1,e.addError(this.columnName,n(0,[this.getDateDisplay(l),this.getDateDisplay(h)])));break;case"between":t<i&&i<a?s=!0:(s=!1,e.addError(this.columnName,n(0,[r,o])));break;case"notBetween":i<t&&a<i?s=!0:(s=!1,e.addError(this.columnName,n(0,[r,o])));break;case"=":s=i.getTime&&t.getTime&&i.getTime()==t.getTime(),s||e.addError(this.columnName,n(0,[r]));break;case"<>":s=i.getTime&&t.getTime&&i.getTime()!=t.getTime(),s||e.addError(this.columnName,n(0,[r]));break;case">":s=i.getTime&&t.getTime&&i.getTime()>t.getTime(),s||e.addError(this.columnName,n(0,[r]));break;case"<":s=i.getTime&&t.getTime&&i.getTime()<t.getTime(),s||e.addError(this.columnName,n(0,[r]));break;case">=":s=i.getTime&&t.getTime&&i.getTime()>=t.getTime(),s||e.addError(this.columnName,n(0,[r]));break;case"<=":s=i.getTime&&t.getTime&&i.getTime()<=t.getTime(),s||e.addError(this.columnName,n(0,[r]))}}s&&(t[this.columnName]=this.exportValue(i))}else e.addError(this.columnName,"Should be a Date!")}}format(t){const e=this.dataValue(t);if(""==e||null==e)return"";const i=this.AB.rules.toDate(e);return this.getDateDisplay(i)}getFormat(){let t="";switch(this.settings&&this.settings.dateFormat?this.settings.dateFormat:""){case 2:default:t="%d/%m/%Y";break;case 3:t="%m/%d/%Y";break;case 4:t="%M %d, %Y";break;case 5:t="%d %M, %Y"}return t}getDateDisplay(t){const e=this.getFormat();return this.dateToString(e,t)}exportValue(t){return t?this.AB.rules.toDateFormat(t,{format:"YYYY-MM-DD"}):""}dateToString(t,e){return e&&e.toString?e.toString():""}},t.exports.RegEx="^[0-9]{4}-[0-9]{2}-[0-9]{2}$"},6926:(t,e,i)=>{const s=i(96915),n={key:"datetime",description:"Pick one from date & time.",icon:"clock-o",isFilterable:!0,isSortable:!1,menuName:"Date & Time",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["datetime"],compatibleMysqlTypes:["datetime"]},a={timeFormat:2,defaultTime:1,defaultTimeValue:null};t.exports=class extends s{constructor(t,e){super(t,e,n)}static defaults(){return n}static defaultValues(){const t=super.defaultValues();return Object.assign(t,a)}fromValues(t){super.fromValues(t),this.settings.timeFormat=parseInt(this.settings.timeFormat),this.settings.defaultTime=parseInt(this.settings.defaultTime)}defaultValue(t){if(null!=t[this.columnName])return;let e;if(super.defaultValue(t),t[this.columnName]&&(e=this.AB.rules.toDate(t[this.columnName])),2==this.settings.defaultTime){const t=new Date;null==e&&(e=new Date),e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds())}else if(3==this.settings.defaultTime&&this.settings.defaultTimeValue){const t=new Date(this.settings.defaultTimeValue);null==e&&(e=new Date),e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds())}null!=e&&(t[this.columnName]=e.toISOString())}getFormat(){const t=this.getTimeFormat();return this.settings=this.settings||{},1==this.settings.dateFormat?t:`${super.getFormat()} ${t}`}format(t){const e=this.getFormat(),i=this.dataValue(t),s=this.AB.rules.toDate(i);return""==i||null==i?"":webix.Date.dateToStr(e)(s)}getTimeFormat(){switch(this.settings=this.settings||{},this.settings.timeFormat){case 2:return" %h:%i %A";case 3:return" %H:%i";default:return""}}exportValue(t){return t?.toISOString?.()??""}},t.exports.RegEx="^[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}$"},6945:(t,e,i)=>{const s=i(14403),n={key:"email",description:"Email fields are used to store email addresses.",icon:"envelope",isFilterable:!0,isSortable:!1,menuName:"Email",supportRequire:!0,supportUnique:!0,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"]},a={default:"",defaultCheckbox:0};t.exports=class extends s{constructor(t,e){super(t,e,n)}static defaults(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.default=t.settings.default||""}defaultValue(t){t[this.columnName]||this.settings.default&&(t[this.columnName]=this.settings.default)}isValidData(t,e){if(t[this.columnName]){const i=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;let s=t[this.columnName];s=String(s).toLowerCase(),i.test(s)||e.addError(this.columnName,"Invalid email")}}}},85019:(t,e,i)=>{const s=i(14403),n={key:"file",description:"Attach a File to this object.",icon:"file",isFilterable:!1,isSortable:!1,menuName:"File Attachment",supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"]},a={removeExistingData:0,fileSize:0,fileType:""};t.exports=class extends s{constructor(t,e){super(t,e,n)}static defaults(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.fileSize=parseInt(this.settings.fileSize),this.settings.limitFileSize=parseInt(this.settings.limitFileSize),this.settings.limitFileType=parseInt(this.settings.limitFileType),this.settings.removeExistingData=parseInt(this.settings.removeExistingData)}dataValue(t){const e=`${this.alias||this.object.name}.${this.columnName}`;let i=t[this.columnName]||t[e]||{};if("string"==typeof i)try{i=JSON.parse(i)}catch(t){}return i}defaultValue(t){t[this.columnName]="{}"}format(t){let e=this.dataValue(t);if(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(t){}return e&&e.filename||""}return""}requestParam(t){const e=super.requestParam(t);return"{}"==e?.[this.columnName]&&delete e[this.columnName],e}}},28725:(t,e,i)=>{const s=i(14403),n={key:"formula",description:"Perform a calculation by a formula type based upon existing values",icon:"circle-o-notch",isFilterable:!0,isSortable:!1,menuName:"Formula",supportQuery:t=>{const e=t.fieldLink;return null!=e&&"calculate"!==e.key},supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["number"],compatibleMysqlTypes:["tinyint","smallint","mediumint","int","integer","bigint","decimal","dec","numeric","fixed","float","real"]},a={field:"",objectLink:"",fieldLink:"",type:"sum",where:""};t.exports=class extends s{constructor(t,e){super(t,e,n)}static defaults(){return n}static defaultValues(){return a}defaultValue(t){delete t[this.columnName]}format(t,e=!1,i=!1){const s=this.fieldLink,n=t=>{if(s&&"calculate"!=s.key){const e={};return e[s.columnName]=t,s.format(e)}return t};if(null!=t[this.columnName]&&!e&&!i)return n(t[this.columnName]);if(null!=t[this.columnName]&&!e&&i)return t[this.columnName];if(!s)return 0;const a=this.fieldBase();if(!a)return 0;let r=t[a.relationName()]||t[a.columnName]||[];Array.isArray(r)||(r=[r]),r&&r.length&&this.settings&&this.settings.where&&this.settings.where.rules&&this.settings.where.rules.length&&(this.filterHelper.setValue(this.settings.where),r=r.filter((t=>this.filterHelper.isValid(t))));let o=[];switch(s.key){case"calculate":r.forEach((t=>{o.push(parseFloat(s.format(t)||0))}));break;case"number":o=r.map((t=>t[s.columnName]||0))}let l=0;const h=s.getDecimalSize();switch(this.settings.type){case"sum":if(o.length>0){const t=Math.pow(10,h);let e=0;o.forEach((i=>{e+=i*t||0})),l=e/t}break;case"average":if(o.length>0){const t=Math.pow(10,h);let e=0;o.forEach((i=>{e+=i*t||0})),l=e/t/o.length}break;case"max":l=Math.max(...o)||0;break;case"min":l=Math.min(...o)||0;break;case"count":l=o.length}return t[this.columnName]=l,"calculate"==s.key?l:n(l)}fieldBase(){return this.object.fieldByID(this.settings.field)}get fieldLink(){const t=this.AB.objectByID(this.settings.object);if(!t)return null;return t.fieldByID(this.settings.fieldLink)||null}get filterHelper(){return null==this._rowFilter&&(this._rowFilter=this.AB.filterComplexNew(`${this.id}_filterComplex`),this.fieldLink&&this.fieldLink.object&&(this._rowFilter.fieldsLoad(this.fieldLink.object.fields()),this._rowFilter.setValue(this.settings.where))),this._rowFilter}}},84342:(t,e,i)=>{const s=i(14403),n={key:"image",description:"Attach an image to this object.",icon:"file-image-o",isFilterable:!1,isSortable:!1,menuName:"Image Attachment",supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"]},a={useWidth:0,imageWidth:"",useHeight:0,imageHeight:"",removeExistingData:0,useDefaultImage:!1,defaultImageUrl:""};t.exports=class extends s{constructor(t,e){super(t,e,n)}static defaults(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.useWidth=parseInt(this.settings.useWidth),this.settings.useHeight=parseInt(this.settings.useHeight),this.settings.imageWidth=parseInt(this.settings.imageWidth),this.settings.imageHeight=parseInt(this.settings.imageHeight),this.settings.useDefaultImage=parseInt(this.settings.useDefaultImage),this.settings.removeExistingData=parseInt(this.settings.removeExistingData)}isValidData(t,e){super.isValidData(t,e)}}},76611:(t,e,i)=>{const s=i(14403),n={key:"json",description:"JSON value",icon:"font",isFilterable:!1,isSortable:!1,menuName:"JSON",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["json"],compatibleMysqlTypes:["json"]},a={};t.exports=class extends s{constructor(t,e){super(t,e,n)}static defaults(){return n}static defaultValues(){return a}defaultValue(t){}}},73291:(t,e,i)=>{const s=i(14403),n={key:"list",description:"Select list allows you to select predefined options below from a dropdown.",icon:"th-list",isFilterable:t=>!t.settings.isMultiple,isSortable:t=>!t.settings.isMultiple,menuName:"Select list",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"],hasColors:t=>!!t.settings.hasColors},a={isMultiple:0,hasColors:0,options:[],default:"none",multipleDefault:[]};t.exports=class extends s{constructor(t,e){super(t,e,n),this.pendingDeletions=[]}static defaults(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.options&&this.settings.options.length>0&&this.settings.options.forEach((t=>{this.translate(t,t,["text"])})),this.settings.isMultiple=parseInt(this.settings.isMultiple),this.settings.hasColors=parseInt(this.settings.hasColors)}toObj(){const t=super.toObj();return t.settings.options.forEach((t=>{this.unTranslate(t,t,["text"])})),t}defaultValue(t){if(1==this.settings.isMultiple){let e=[];this.settings.multipleDefault.forEach((t=>{this.settings.options.forEach((i=>{i.id==t.text&&e.push(i)}))})),t[this.columnName]=e||[]}else this.settings.default&&""!=this.settings.default&&(t[this.columnName]=this.settings.default)}isValidData(t,e){super.isValidData(t,e)}options(){return this.settings.options.map((t=>({id:t.id,text:t.text,hex:t.hex?t.hex:"",translations:t.translations?t.translations:""})))}format(t,e={}){let i=this.dataValue(t)||[];if("string"==typeof i)try{i=JSON.parse(i)}catch(t){}return Array.isArray(i)||(i=[i]),this.settings.options.filter((t=>i.filter((e=>(e.id||e)==t.id)).length>0)).map((t=>{let i=t.text;const s=e.languageCode||"en",n=(t.translations||[]).filter((t=>t.language_code==s))[0];return n&&(i=n.text),i})).join(", ")}}},37143:(t,e,i)=>{const s=i(14403),n={key:"LongText",description:"Multiple lines of text",icon:"align-right",isFilterable:!0,isSortable:!1,menuName:"Long text",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["longtext","mediumtext","text"],compatibleMysqlTypes:["text","mediumtext","longtext"],MAX_CHAR_LENGTH:5e3},a={default:"",supportMultilingual:0};t.exports=class extends s{constructor(t,e){super(t,e,n)}static defaults(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.default=t.settings.default||"",this.settings.supportMultilingual=t.settings.supportMultilingual+""||a.supportMultilingual,this.settings.supportMultilingual=parseInt(this.settings.supportMultilingual),this.settings.supportMultilingual?this.object&&this.object.translate(this.settings,this.settings,["default"]):this.settings.default=t.settings.default||""}toObj(){const t=super.toObj();return this.settings.supportMultilingual&&(this.object?this.object.unTranslate(t.settings,t.settings,["default"]):t.settings.default=this.settings.default),t}get isMultilingual(){return 1==this.settings.supportMultilingual}defaultValue(t){null==t[this.columnName]&&("string"==typeof this.settings.default?t[this.columnName]=this.settings.default:t[this.columnName]="")}isValidData(t,e){super.isValidData(t,e),t&&t[this.columnName]&&t[this.columnName].length>5e3&&e.addError(this.columnName,"should NOT be longer than 5000 characters")}}},49671:(t,e,i)=>{const s=i(14403),n={key:"number",description:"A Float or Integer Value",icon:"hashtag",isFilterable:!0,isSortable:!0,menuName:"Number",supportRequire:!0,supportUnique:!0,useAsLabel:!0,compatibleOrmTypes:["number"],compatibleMysqlTypes:["tinyint","smallint","mediumint","int","integer","bigint","decimal","dec","numeric","fixed","float","real"]},a={default:"",typeFormat:"none",typeDecimals:"none",typeDecimalPlaces:0,typeRounding:"none",typeThousands:"none",validation:0,validateMinimum:"",validateMaximum:""};let r=null;t.exports=class extends s{constructor(t,e){super(t,e,n),r||(r=this.AB.Label())}static defaults(){return n}static defaultValues(){return a}static formatList(t){return t&&!r&&(r=t),[{id:"none",value:r("None")},{id:"dollar",value:r("$"),sign:"$",position:"prefix"},{id:"yen",value:r(""),sign:"",position:"prefix"},{id:"pound",value:r(""),sign:"",position:"prefix"},{id:"euroBefore",value:r(" (before)"),sign:"",position:"prefix"},{id:"euroAfter",value:r(" (after)"),sign:"",position:"postfix"},{id:"percent",value:r("%"),sign:"%",position:"postfix"}]}static delimiterList(){return[{id:"none",value:r("None")},{id:"comma",value:r("Comma"),sign:","},{id:"period",value:r("Period"),sign:"."},{id:"space",value:r("Space"),sign:" "}]}fromValues(t){super.fromValues(t),this.settings.validation=parseInt(this.settings.validation)}defaultValue(t){""!=this.settings.default&&(t[this.columnName]=this.settings.default)}isValidData(t,e){if(super.isValidData(t,e),null!=t[this.columnName]&&""!=t[this.columnName]){let s=t[this.columnName];if("none"==this.settings.typeDecimals)s=parseInt(s);else{const t=parseInt(this.settings.typeDecimalPlaces)||2;s=parseFloat(parseFloat(s).toFixed(t))}if(i=s,!Number.isNaN(parseFloat(i))&&Number.isFinite(i)||e.addError(this.columnName,r("invalid number")),1==this.settings.validation&&null!=this.settings.validateMinimum&&this.settings.validateMinimum>s){const t=r("should be greater than {0}",[this.settings.validateMinimum]);e.addError(this.columnName,t)}if(1==this.settings.validation&&null!=this.settings.validateMaximum&&this.settings.validateMaximum<s){const t=r("should be less than {0}",[this.settings.validateMaximum]);e.addError(this.columnName,t)}}var i}format(t){if(null==t?.[this.columnName]||0!=t[this.columnName]&&""==t[this.columnName])return"";let e=t[this.columnName]||0;"string"==typeof e&&(e=e.replace(/,/g,"")),isNaN(parseFloat(e))&&(e=0);const i=this.constructor.formatList().filter((t=>t.id==this.settings.typeFormat))[0],s="none"!=this.settings.typeDecimalPlaces?parseInt(this.settings.typeDecimalPlaces):0;let n=this.constructor.delimiterList().filter((t=>t.id==this.settings.typeThousands))[0],a=this.constructor.delimiterList().filter((t=>t.id==this.settings.typeDecimals))[0],r="",o="";if(i&&i.sign)switch(i.position){case"prefix":r=i.sign;break;case"postfix":o=i.sign}if(a=a.sign||"",n=n.sign||"","roundDown"==this.settings.typeRounding){const t=Math.pow(10,s);e=Math.floor(e*t)/t}return`${r} ${this.formatNumber(e,{groupDelimiter:n,groupSize:3,decimalDelimiter:a,decimalSize:s})} ${o}`}formatNumber(t,e={}){if(""===t||null==t)return t;const i=(t=parseFloat(t))<0?"-":"",s=(t=Math.abs(t)).toString(),n=s.split(".")[0],a=s.split(".")[1];let r="";if(e.groupDelimiter){const t=3;let i=n.length;do{i-=t,r=`${i>0?n.substr(i,t):n.substr(0,t+i)}${r?e.groupDelimiter+r:""}`}while(i>0)}else r=n;let o="";return o=e.decimalDelimiter&&e.decimalSize?`${i}${r}${a?e.decimalDelimiter+a.toString().substr(0,e.decimalSize):""}`:`${i}${r}`,o}getDecimalSize(){return"none"!=this.settings.typeDecimalPlaces?parseInt(this.settings.typeDecimalPlaces):0}}},36756:(t,e,i)=>{const s=i(14403),n={key:"string",description:"short string value",icon:"font",isFilterable:!0,isSortable:!0,menuName:"Single line text",supportRequire:!0,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"],MAX_CHAR_LENGTH:255},a={default:"",supportMultilingual:0};t.exports=class extends s{constructor(t,e){super(t,e,n)}static defaults(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.default=t.settings.default||a.default,this.settings.supportMultilingual=t.settings.supportMultilingual+""||a.supportMultilingual,this.settings.supportMultilingual=parseInt(this.settings.supportMultilingual),this.settings.supportMultilingual?this.translate(this.settings,this.settings,["default"]):this.settings.default=t.settings.default||""}toObj(){const t=super.toObj();return this.settings.supportMultilingual?this.unTranslate(t.settings,t.settings,["default"]):t.settings.default=this.settings.default,t}defaultValue(t){t[this.columnName]||this.settings.default&&(this.settings.default.indexOf("{uuid}")>=0?t[this.columnName]=this.AB.uuid():t[this.columnName]=this.settings.default)}isValidData(t,e){super.isValidData(t,e);const i=this.AB.Label();t&&t[this.columnName]&&t[this.columnName].length>255&&e.addError(this.columnName,i("should NOT be longer than {0} characters",[255]))}get isMultilingual(){return 1==this.settings.supportMultilingual}}},18585:(module,__unused_webpack_exports,__webpack_require__)=>{const ABField=__webpack_require__(14403);function L(t,e){return e}const ABFieldTextFormulaDefaults={key:"TextFormula",description:"Text Formula",icon:"question",isFilterable:!1,isSortable:!1,menuName:"Text Formula",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["text","mediumtext","longtext"]},defaultValues={textFormula:""};function setValueToFormula(object,formulaString,rowData){if(!formulaString)return;const fieldRegExp=/{[^{}]+}/gm,matches_field_array=formulaString.match(fieldRegExp);return matches_field_array.forEach((element=>{const columnName=element.replace(/{|}|"/g,"");object.fields().forEach((field=>{if(field.columnName==columnName)if("AutoIndex"==field.key){const t=field.format(rowData)||0;formulaString=formulaString.replace(element,t)}else if("calculate"==field.key){const calVal=`(${field.format(rowData)||0})`;formulaString=formulaString.replace(element,eval(calVal))}else formulaString="date"==field.key?formulaString.replace(element,rowData[columnName]?field.exportValue(rowData[columnName]):""):formulaString.replace(element,rowData[columnName]?field.format(rowData):"")}))})),formulaString}function setBuildinValueToFormula(t,e){const i=e.match(/\w+\(.*?\)/gm);if(i){const s=getBuildInFunction();i.forEach((i=>{const n=i.split(/\(|\)/),a=n.length>2&&""!=n[2],r=n[0],o=n[1].split(",");let l=!1;for(let n=0;n<s.length;n++){let h=i;if(r==s[n].id){if(o.length==s[n].parameter_size){switch(r){case"left":h=getLeft(o[0],o[1]);break;case"right":h=getRight(o[0],o[1]);break;case"mid":h=getMid(o[0],o[1],o[2]);break;case"trim":h=getTrim(o[0]);break;case"trimLeft":h=getTrimLeft(o[0]);break;case"trimRight":h=getTrimRight(o[0]);break;case"length":h=getLength(o[0]);break;case"regexReplace":h=getRegExpReplace(o[0],o[1].trimLeft(),o[2].trimLeft());break;case"extractRegex":h=getExtractRegex(o[0],o[1].trimLeft());break;case"replace":h=getReplace(o[0],o[1].trimLeft(),o[2].trimLeft());break;case"lower":h=getLower(o[0]);break;case"upper":h=getUpper(o[0]);break;case"capitalize":h=getCapitalize(o[0]);break;case"random":h=getRandom(o[0]);break;case"numberToWords":h=getNumberToWords(o[0]);break;case"getDateDayOfWeekName":a&&(i+=")"),h=getDateDayOfWeekName(t,o[0]);break;case"getDateMonthOfYearName":a&&(i+=")"),h=getDateMonthOfYearName(t,o[0]);break;case"formatDate":h=getFormatDate(o[0],o[1].trimLeft())}return l=!0,void(e=e.replace(i,h))}h=r+"(Bad Parameter)",e=e.replace(i,h)}}}))}return e}function getBuildInFunction(){return[{id:"left",value:"left({COLUMN_NAME}, 1)",type:"build-in",parameter_size:2},{id:"right",value:"right({COLUMN_NAME}, 1)",type:"build-in",parameter_size:2},{id:"mid",value:"mid({COLUMN_NAME}, 1, 1)",type:"build-in",parameter_size:3},{id:"trim",value:"trim({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"trimLeft",value:"trimLeft({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"trimRight",value:"trimRight({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"length",value:"length({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"regexReplace",value:"regexReplace({COLUMN_NAME}, [*], REPLACE_VALUE)",type:"build-in",parameter_size:3},{id:"extractRegex",value:"extractRegex({COLUMN_NAME}, [*])",type:"build-in",parameter_size:2},{id:"replace",value:"replace({COLUMN_NAME}, SEARCH_VALUE, REPLACE_VALUE)",type:"build-in",parameter_size:3},{id:"lower",value:"lower({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"upper",value:"upper({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"capitalize",value:"capitalize({COLUMN_NAME})",type:"build-in",parameter_size:1},{id:"random",value:"random(1)",type:"build-in",parameter_size:1},{id:"numberToWords",value:"numberToWords({NUMBER_COLUMN} or 012...)",type:"build-in",parameter_size:1},{id:"getDateDayOfWeekName",value:"getDateDayOfWeekName({DATE_COLUMN})",type:"build-in",parameter_size:1},{id:"getDateMonthOfYearName",value:"getDateMonthOfYearName({DATE_COLUMN})",type:"build-in",parameter_size:1},{id:"formatDate",value:"formatDate({DATE_COLUMN}, OUTPUT_FORMAT)",type:"build-in",parameter_size:2}]}function getLeft(t,e){return t.substring(0,parseInt(e))}function getRight(t,e){const i=reverseString(t).substring(0,parseInt(e));return reverseString(i)}function reverseString(t){return t.split(" ").reverse().join(" ")}function getMid(t,e,i){return t.length<e?"mid(Bad Parameter)":t.substring(parseInt(e),parseInt(e)+parseInt(i))}function getTrim(t){return t.trim()}function getTrimLeft(t){return t.trimLeft()}function getTrimRight(t){return t.trimRight()}function getLength(t){return t.length}function getRegExpReplace(t,e,i){return t.replace(e,i)}function getExtractRegex(t,e){const i=t.match(e);return Array.isArray(i)?i[0]:i}function getReplace(t,e,i){return t.replace(e,i)}function getLower(t){return t.toLowerCase()}function getUpper(t){return t.toUpperCase()}function getCapitalize(t){return t.toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.substring(1))).join(" ")}function getRandom(t){return Math.floor(Math.random()*(t+1))}function getNumberToWords(t){const e=t.trim(",").toString();let i,s,n,a,r,o,l,h,c,d,u,_;if(0===parseInt(e))return"zero";for(i=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],s=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],n=["","thousand","million","billion","trillion","quadrillion","quintillion","sextillion","septillion","octillion","nonillion","decillion","undecillion","duodecillion","tredecillion","quatttuor-decillion","quindecillion","sexdecillion","septen-decillion","octodecillion","novemdecillion","vigintillion","centillion"],a=e.length,o=[];a>0;)r=a,o.push(e.slice(a=Math.max(0,a-3),r));if(l=o.length,l>n.length)return"";for(_=[],d=0;d<l;d++)h=parseInt(o[d]),h&&(c=o[d].split("").reverse().map(parseFloat),1===c[1]&&(c[0]+=10),(u=n[d])&&_.push(u),(u=i[c[0]])&&_.push(u),(u=s[c[1]])&&_.push(u),(c[0]||c[1])&&(c[2]||!d&&l)&&_.push(""),(u=i[c[2]])&&_.push(u+" hundred"));return _.reverse().join(" ")}function getDateDayOfWeekName(t,e){return t.rules.toDateFormat(e,{format:"dddd",localeCode:t.Account.language()})}function getDateMonthOfYearName(t,e){return t.rules.toDateFormat(e,{format:"MMMM",localeCode:t.Account.language()})}function getFormatDate(t,e){return new Date(t).toString(e)}module.exports=class extends ABField{constructor(t,e){super(t,e,ABFieldTextFormulaDefaults)}static defaults(){return ABFieldTextFormulaDefaults}static defaultValues(){return defaultValues}static getBuildInFunction(){return getBuildInFunction()}defaultValue(t){t[this.columnName]}isValidData(t,e){return super.isValid()}get isMultilingual(){return!1}format(t){try{if(!this.settings.textFormula)return"";let e=this.settings.textFormula;return e=setValueToFormula(this.object,e,t),e=setBuildinValueToFormula(this.AB,e),e}catch(t){return""}}}},98630:(t,e,i)=>{const s=i(87038),n={key:"tree",description:"Data tree allows you to build a hierarchical set of selectable data. (ex: Categories and sub-categories)",icon:"sitemap",isFilterable:!1,isSortable:!1,menuName:"Data Tree",supportRequire:!1,supportUnique:!1,useAsLabel:!1,compatibleOrmTypes:["string"],compatibleMysqlTypes:["text","mediumtext","longtext"]},a={options:[]};t.exports=class extends s{constructor(t,e){super(t,e,n)}static defaults(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.options&&this.settings.options.length>0&&this.settings.options.forEach((t=>{this.translate(t,t,["text"])}))}toObj(){const t=super.toObj();return t.settings.options&&t.settings.options.length>0&&t.settings.options.forEach((t=>{this.unTranslate(t,t,["text"])})),t}defaultValue(t){}isValidData(t,e){super.isValidData(t,e)}}},18665:(t,e,i)=>{const s=i(66589),n={key:"user",description:"Add users to a record.",icon:"user-o",isFilterable:!0,isSortable:t=>!t.settings.isMultiple,menuName:"User",supportRequire:!1,supportUnique:!1,useAsLabel:!0,compatibleOrmTypes:["string"],compatibleMysqlTypes:["char","varchar","tinytext"],USERNAME_FIELD_ID:"5760560b-c078-47ca-98bf-e18ac492a561"},a={editable:1,isMultiple:0,isCurrentUser:0,isShowProfileImage:0,isShowUsername:1};t.exports=class extends s{constructor(t,e){super(t,e,n)}static defaults(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.editable=parseInt(this.settings.editable),this.settings.isMultiple=parseInt(this.settings.isMultiple),this.settings.isCurrentUser=parseInt(this.settings.isCurrentUser),this.settings.isShowProfileImage=parseInt(this.settings.isShowProfileImage),this.settings.isShowUsername=parseInt(this.settings.isShowUsername)}format(t){let e=this.dataValue(t)||[];return e&&!Array.isArray(e)&&(e=[e]),e||(e=[]),e.map((t=>t.username||t)).join(", ")}}},62418:(t,e,i)=>{const s=i(67692),n={type:"process.lane"};t.exports=class extends s{constructor(t,e,i){super(t,e,i)}static defaults(){return n}fromValues(t){super.fromValues(t),this.type=t.type||n.type}}},52957:(t,e,i)=>{const s=i(97069),n={type:"process.participant"};t.exports=class extends s{constructor(t,e,i){super(["label"],i),this.process=e,this.processID||(this.processID=e.id),this.fromValues(t)}static defaults(){return n}fromValues(t){function e(t){return void 0!==t&&null!=t}this.id=t.id,this.name=t.name||"",this.type=t.type||n.type,this.key=t.key||n.type,this.processID=t.processID||null,this.diagramID=t.diagramID||"?diagramID?",this.laneIDs=t.laneIDs||[],this.stashed=!1,t.stashed&&""!=t.stashed&&(this.stashed=t.stashed),this.useRole=0,e(t.useRole)&&(this.useRole=parseInt(t.useRole)),this.role=0,e(t.role)&&(this.role=t.role),this.useAccount=0,e(t.useAccount)&&(this.useAccount=parseInt(t.useAccount)),this.account=0,e(t.account)&&(this.account=t.account),this.useField=0,e(t.useField)&&(this.useField=parseInt(t.useField)),this.userField=[],e(t.userField)&&(this.userField=t.userField),this.fields=[],e(t.fields)&&(this.fields=t.fields),super.fromValues(t),this.label||(this.label=this.name)}toObj(){!this.label&&this.name&&""!=this.name&&(this.label=this.name);var t=super.toObj();return["id","name","type","processID","diagramID","laneIDs","where","useRole","role","useAccount","account","useField","userField","fields","stashed"].forEach((e=>{t[e]=this[e]})),t}onProcessReady(){}}},52719:(t,e,i)=>{var s={},n={},a=[i(88556),i(19036),i(18872),i(95187),i(92845),i(80346),i(33618),i(79841),i(26088),i(87757),i(85811),i(34430),i(86298),i(68063),i(56031),i(82448),i(46732),i(12513),i(12038)];a.forEach((t=>{switch(s[t.defaults().key]=t,t.defaults().category){case"start":case"end":n[t.DiagramReplace().target.eventDefinitionType]=t.defaults();break;case"gateway":case"task":n[t.DiagramReplace().target.type]=t.defaults()}})),t.exports={allTasks:function(){var t=[];for(var e in s)t.push(s[e]);return t},newTask:function(t,e,i){if(t.key)return new s[t.key](t,e,i)},DiagramReplaceDefinitionsForType:function(t){return a.filter((e=>e.defaults().category==t)).map((t=>t.DiagramReplace()))},StartEvents:function(){return this.DiagramReplaceDefinitionsForType("start")},Gateways:function(){return this.DiagramReplaceDefinitionsForType("gateway")},Tasks:function(){return this.DiagramReplaceDefinitionsForType("task")},EndEvents:function(){return this.DiagramReplaceDefinitionsForType("end")},definitionForElement:function(t){var e=null;if(t.businessObject.eventDefinitions){var i=t.businessObject.eventDefinitions[0];i&&(e=i.$type)}return e||(e=t.type),n[e]}}},19929:(t,e,i)=>{var s=i(97069);t.exports=class extends s{constructor(t,e,i,s){super(["label"],i),this.defaults=s||{key:"core",icon:"core"},this.fromValues(t),this.process=e,this.processID||(this.processID=e.id),this.state=null}fromValues(t){this.id=t.id,this.name=t.name||"",this.type=t.type||"process.task.unknown",this.key=t.key||this.defaults.key||"?key?",this.processID=t.processID||null,this.diagramID=t.diagramID||"?diagramID?",this.laneDiagramID=t.laneDiagramID||"?laneID?",this.defaults&&this.defaults.settings&&this.defaults.settings.forEach((e=>{void 0===t[e]?this[e]=null:this[e]=t[e]})),super.fromValues(t),this.label||(this.label=this.name)}toObj(){!this.label&&this.name&&""!=this.name&&(this.label=this.name);var t=super.toObj();return["id","name","type","processID","diagramID","laneDiagramID","key"].forEach((e=>{t[e]=this[e]})),this.defaults&&this.defaults.settings&&this.defaults.settings.forEach((e=>{t[e]=this[e]})),t}errorConfig(t,e,i=[]){this.log(t,e);var s=new Error(`${this.type}: ${e}`),n={task:this};return Array.isArray(i)||(i=[i]),i.forEach((t=>{n[t]=this[t]})),this.AB.notify.builder(s,n),Promise.reject(s)}initState(t,e,i){if(e=e||{},i||(i=e,e={},this.defaults&&this.defaults.instanceValues&&this.defaults.instanceValues.forEach((t=>{e[t]=null}))),t.taskState=t.taskState||{},!t.taskState[this.diagramID]){for(var s in t.taskState[this.diagramID]={initialized:!0,status:"initialized"},e)t.taskState[this.diagramID][s]=e[s];for(var n in i)t.taskState[this.diagramID][n]=i[n]}}isEndTask(){return!1}log(t,...e){var i=`${this.diagramID} : ${this.name?this.name:this.key} : ${e.join(" ")}`;t.log.push(i)}myLane(){return this.process.elementForDiagramID(this.laneDiagramID)}myState(t){return t.context.taskState[this.diagramID]}nextTasks(t){var e=[],i=t.hashDiagramObjects[this.diagramID];if(!i){var s=new Error(`Configuration Error: Did not find my definition for dID[${this.diagramID}]`);return this.onError(t,s),null}var n=i["bpmn2:outgoing"];if(!n)return s=new Error(`Configuration Error: Did not find any outgoing flows for dID[${this.diagramID}]`),this.AB.notify.builder(s,{task:this}),this.onError(t,s),null;Array.isArray(n)||(n=[n]);var a=i=>{var s=t.hashDiagramObjects[i._text];if(s){var n=s._attributes.targetRef;n&&(Array.isArray(n)||(n=[n]),n.forEach((i=>{var s=this.process.elementForDiagramID(i);if(s)e&&e.push(s);else{var n=new Error(`Configuration Error: No ProcessTask instance for diagramID[${i}]`);this.AB.notify.builder(n,{task:this}),this.onError(t,n),e=null}})))}};return n.forEach((t=>{a(t)})),e}onError(t,e){if(e){var i=`${e.toString()}`;this.log(t,i)}this.myState(t).status="error"}processDataFields(){return null}processData(t,e){return null}processDataObjects(){return null}hashProcessDataValues(t){var e=this.process.processDataFields(this),i={};return e.forEach((e=>{i[e.key]=this.process.processData(this,[t,e.key])})),i}reset(t){var e=this.myState(t);e?"completed"!=e.status&&"error"!=e.status||(delete t.context.taskState[this.diagramID],this.initState(t.context),this.myState(t)._prevState=e,this.log(t," Reset() called. Running again. ")):this.initState(t.context)}stateCompleted(t){this.myState(t).status="completed"}stateUpdate(t,e){e=e||{};var i=this.myState(t);for(var s in e)i[s]=e[s]}wantToDoSomething(t){var e=this.myState(t);return e?"completed"!=e.status&&"error"!=e.status:(console.warn("ABProcessTaskCore:wantToDoSomething(): called without having initialized our state first.",t),this.initState(t.context),this.wantToDoSomething(t))}onProcessReady(){}get startElements(){return this.process.elements((t=>t&&t.defaults&&"start"===t.defaults.category))||[]}get previousElements(){return this.process.connectionPreviousTask(this)}get objectOfStartElement(){const t=this.startElements[0];return t?this.AB.objectByID(t.objectID):null}get objectOfPrevElement(){let t,e=this.previousElements[0];return e?(t="process.task.service.query"===e.type?e.qlObj?e.qlObj.objectID:null:e.objectID,this.AB.objectByID(t)):null}}},15197:(t,e,i)=>{const s=i(21073);var n={category:"end",fields:[],icon:"stop",key:"End"};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.task.end",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Terminate End Event",actionName:"replace-with-terminate-end",className:"bpmn-icon-end-event-terminate",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:TerminateEventDefinition"}}}initState(t,e){super.initState(t,{triggered:!1},e)}isEndTask(){return!0}nextTasks(t){return[]}}},32889:(t,e,i)=>{const s=i(21073);var n={category:"gateway",icon:"check-circle",instanceValues:[],key:"GatewayExclusive",settings:["conditions"]};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.gateway.exclusive",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Exclusive Gateway",actionName:"replace-with-exclusive-gateway",className:"bpmn-icon-gateway-xor",target:{type:"bpmn:ExclusiveGateway"}}}fromValues(t){super.fromValues(t),this.conditions=this.conditions||{}}}},52399:(t,e,i)=>{const s=i(21073);var n={category:"task",fields:["to","from","subject","message","toCustom","fromCustom","toUsers","fromUsers","toCustomFields","fromCustomFields"],icon:"email",key:"Email"};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.task.email",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Send Task",actionName:"replace-with-send-task",className:"bpmn-icon-send",target:{type:"bpmn:SendTask"}}}fromValues(t){super.fromValues(t),n.fields.forEach((e=>{this[e]=t[e]}))}toObj(){var t=super.toObj();return n.fields.forEach((e=>{t[e]=this[e]})),t}initState(t,e){var i={to:[],from:[],subject:this.subject,message:this.message};super.initState(t,i,e)}}},7912:(t,e,i)=>{const s=i(21073);var n={category:null,icon:"check-circle",instanceValues:[],key:"AccountingBatchProcessing",settings:["objectBatch","processBatchValue","fieldBatchEntries","fieldBatchFinancialPeriod","objectJE","fieldJEAccount","fieldJERC","fieldJEStatus","fieldJEStatusComplete","objectBR","fieldBRFinancialPeriod","fieldBRAccount","fieldBRRC","fieldBREntries"]};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.task.service.accounting.batchProcessing",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return null}}},20939:(t,e,i)=>{const s=i(21073);var n={category:null,icon:"check-circle",instanceValues:[],key:"AccountingFPClose",settings:["processFPValue","objectFP","objectGL","objectAcc","fieldFPStart","fieldFPOpen","fieldFPStatus","fieldFPActive","fieldGLStarting","fieldGLRunning","fieldGLAccount","fieldGLRc","fieldGLDebit","fieldGLCredit","fieldAccType","fieldAccAsset","fieldAccExpense","fieldAccLiabilities","fieldAccEquity","fieldAccIncome"]};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.task.service.accounting.fpClose",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return null}}},31166:(t,e,i)=>{const s=i(21073);var n={category:null,icon:"check-circle",instanceValues:[],key:"AccountingFPYearClose",settings:["processFPYearValue","objectFPYear","objectFPMonth","objectGL","objectAccount","valueFundBalances","valueNetIncome","fieldFPYearStart","fieldFPYearEnd","fieldFPYearStatus","fieldFPYearActive","fieldFPMonthStart","fieldFPMonthEnd","fieldGLStartBalance","fieldGLRunningBalance","fieldGLrc","fieldAccNumber","fieldAccType","fieldAccTypeIncome","fieldAccTypeExpense","fieldAccTypeEquity"]};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.task.service.accounting.fpYearClose",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return null}}},69814:(t,e,i)=>{const s=i(21073);let n={category:null,icon:"archive",instanceValues:[],key:"AccountingJEArchive",settings:["processBatchValue","objectBatch","objectBalance","objectJE","objectJEArchive","fieldBatchFiscalMonth","fieldJeAccount","fieldJeRC","fieldJeArchiveBalance","fieldBrFiscalMonth","fieldBrAccount","fieldBrRC","fieldsMatch"]};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.task.service.accounting.jeArchive",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return null}}},50689:(t,e,i)=>{const s=i(21073);let n={category:null,icon:"calculator",instanceValues:[],key:"Calculate",settings:["formulaText"]};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.task.service.calculate",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return null}processDataFields(){const t=`${this.label}->Value`;return this._fakeNum||(this._fakeObj=this.AB.objectNew({}),this._fakeNum=this.AB.fieldNew({key:"number",name:t,label:t},this._fakeObj)),{key:`${this.id}.value`,label:t,field:this._fakeNum}}}},69376:(t,e,i)=>{const s=i(21073);var n={category:"task",icon:"check-circle",instanceValues:[],key:"TaskService",settings:[]};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.task.service",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Service Task",actionName:"replace-with-service-task",className:"bpmn-icon-service",target:{type:"bpmn:ServiceTask"}}}}},98856:(t,e,i)=>{const s=i(21073),n={category:null,icon:"plus-circle",instanceValues:[],key:"GetResetPasswordUrl",settings:["email"]};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.task.service.getResetPasswordUrl",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return null}processDataFields(){return{key:`${this.id}.url`,label:`${this.label}->URL`}}}},24858:(t,e,i)=>{const s=i(21073);let n={category:null,icon:"plus-circle",instanceValues:[],key:"InsertRecord",settings:["objectID","fieldValues","isRepeat","repeatMode","repeatColumn"]};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.task.service.insertRecord",super(t,e,i,n),this.results=[]}static defaults(){return n}static DiagramReplace(){return null}fromValues(t){super.fromValues(t),this.isRepeat=JSON.parse(t.isRepeat||!1)}get startElement(){let t=null,e=this.process;for(;!t&&e;)t=e.elements((t=>"start"==t?.defaults?.category))[0],e=e.process;return t}get previousElement(){return this.process.connectionPreviousTask(this)[0]}get objectOfStartElement(){let t=this.startElement;return t?this.AB.objectByID(t.objectID):null}get objectOfPrevElement(){let t,e=this.previousElement;return e?(t="process.task.service.query"===e.type?e.qlObj?e.qlObj.objectID:null:e.objectID,this.AB.objectByID(t)):null}get fieldRepeat(){let t=this.objectOfStartElement;return t?t.fields((t=>t.id==this.repeatColumn))[0]:null}processDataFields(){return[{key:`${this.id}.[PK]`,label:`${this.label}-> Inserted record [PK]`,field:{id:this.id,object:{id:this.objectID},key:"InsertedRecord",columnName:"uuid"},object:this.objectID,set:!0}]}}},35002:(t,e,i)=>{const s=i(21073),n=i(46370),a={category:null,icon:"check-circle",instanceValues:[],key:"TaskServiceQuery",settings:["qlObj"]};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.task.service.query",super(t,e,i,a)}static defaults(){return a}static DiagramReplace(){return null}fromValues(t){super.fromValues(t),this._datasources=[],this.qlObj&&(this.qlObj=n.fromAttributes(this.qlObj,this,this.AB))}toObj(){const t=super.toObj();return this.qlObj&&(t.qlObj=this.qlObj.toObj()),t}registerDatasource(t){this._datasources.push(t)}processDataFields(){let t=null;return this._datasources.length>0&&(t=[],this._datasources.forEach((e=>{const i=e.processDataField(this.id,this.label);i&&t.push(i)}))),t}processData(t,e){const i=e.split(".");return i[0]===this.id?this.myState(t)[i[1]]:null}}},36146:(t,e,i)=>{const s=i(21073);let n={category:"task",icon:"object-group",instanceValues:[],key:"SubProcess",settings:["isEnable","parameterId","connectionAttrs","elementIDs","loopType"]};const a={};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.task.service.subProcess",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Sub Process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}}}fromValues(t){super.fromValues(t),this.isEnable=null==this.isEnable||JSON.parse(this.isEnable);let e=this._elements||{};this._unknownElementIDs=[],this._elements={},(t.elementIDs||[]).forEach((t=>{let i=this.AB.processElementNew(t,this);i?this._elements[t]=i:e[t]?this._elements[t]=e[t]:this._unknownElementIDs.push(t)})),this._unknownElementIDs.forEach((t=>{let e=`Process[${this.processID}] Task[${this.label}] is referencing an unknown element id:[${t}]`;if(!a[e]){let i=new Error(e);this.AB.notify.builder(i,{processTask:this.id,eID:t}),a[e]=!0}})),this._connections=t.connectionAttrs||{}}toObj(){let t=super.toObj();t.elementIDs=[];for(let e in this._elements)t.elementIDs.push(this._elements[e].id);return t.connectionAttrs=this._connections,t}processDataFields(t){if(null==this.parameterId)return[];let e=this.process.processDataFields(this)||[],i=e.filter((t=>t.key===this.parameterId))[0],s=e.filter((t=>"InsertedRecord"===(t?.field?.key??t?.field)));if(null==i)return[];let n=[];i.field&&"connectObject"==i.field.key&&i.field.datasourceLink&&i.field.datasourceLink.fields?(n.push({key:`${this.id}.uuid`,label:`${this.label}->Repeat Data.ID`,object:i.field.datasourceLink}),i.field.datasourceLink.fields().forEach((t=>{n.push({key:`${this.id}.${t.id}`,label:`${this.label}->Repeat Data.${t.label}`,field:t,object:t.object})}))):n.push({key:i.field?`${this.id}.${i.field.id}`:`${this.id}.subProcess`,label:`${this.label}->Repeat Data`,field:i.field,object:i.object}),s.forEach((t=>{n.push({key:`${t.key||t.id}`,label:`Parent Process Data->${t.label}`,field:t.field,object:t.object})}));let a=this.process.processDataFields.call(this,t);return a&&a.length>0&&(n=n.concat(a)),n}processData(t,e){let i,s=e[0],n=e[1];if(s&&n?.startsWith?.(this.id)){let t=n.split(".")[1],e=this.myState(s),a=e?e.data:null;if(i=a,a&&t){let e=(this.process.processDataFields(this)||[]).filter((t=>t.key==this.parameterId))[0];"connectObject"==e?.field?.key&&(Array.isArray(a)||(a=[a]),i=a.map((i=>{if("uuid"==t||"id"==t)return i.uuid||i.id||i;if(e.field.datasourceLink){let s=e.field.datasourceLink.fields((e=>e.id==t))[0];return s?i[s.columnName]:i}})))}}return Array.isArray(i)&&(i=i.filter((t=>null!=t))),null!=i&&i.length||(i=this.process.processData.call(this,t,e)),null!=i&&i.length||(i=this.process.processData(this,e)),i}allPreviousTasks(...t){return this.process.allPreviousTasks.call(this,...t)}allPreviousConnectionsForElement(...t){return this.process.allPreviousConnectionsForElement.call(this,...t)}allPreviousConnectionsForConnection(...t){return this.process.allPreviousConnectionsForConnection.call(this,...t)}connections(t){return this.process.connections.call(this,t)}connectionForDiagramID(t){if(t)return this.process.connectionForDiagramID.call(this,t)}connectionsIncoming(t){if(t)return this.process.connectionsIncoming.call(this,t)}connectionsOutgoing(t){if(t)return this.process.connectionsOutgoing.call(this,t)}connectionRemove(t){t&&this.process.connectionRemove.call(this,t)}connectionSimplyElement(t){if(t)return this.process.connectionSimplyElement.call(this,t)}connectionUpsert(t){t&&this.process.connectionUpsert.call(this,t)}connectionPreviousTask(t){if(t)return this.process.connectionPreviousTask.call(this,t)}elements(t=(()=>!0)){return this.process.elements.call(this,t)}elementAdd(t){t&&this.process.elementAdd.call(this,t)}elementForDiagramID(t){return t?this.process.elementForDiagramID.call(this,t):null}elementRemove(t){t&&this.process.elementRemove.call(this,t)}}},42501:(t,e,i)=>{const s=i(21073),n=i(69319);var a={category:null,icon:"check-circle",instanceValues:["userFormID","userFormResponse"],key:"Approval",settings:["who","toUsers","formBuilder"]};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.task.user.approval",super(t,e,i,a)}static defaults(){return a}static DiagramReplace(){return null}fromValues(t){super.fromValues(t),function t(e){e&&Object.keys(e).forEach((i=>{"false"==e[i]?e[i]=!1:"true"==e[i]?e[i]=!0:"object"==typeof e[i]&&t(e[i])}))}(this.formBuilder)}preProcessFormIOComponents(){var t=this.process.processDataFields(this);return t&&this.formBuilder&&this.formBuilder.components&&this.formBuilder.components.forEach((e=>{e.abFieldID?t.filter((t=>{if(t.field?.id==e.abFieldID&&(e.label=t.field.label,e.key=t.key,e.data?.values&&t.field.settings.options)){var i=[];t.field.settings.options.forEach((t=>{i.push({label:t.text,value:t.id})})),e.data.values=i}})):e.components&&e.components.length&&(e.key=e.path,e.components.forEach((i=>{if(i.abFieldID){var s=t.filter((t=>t.key==e.path))[0];if(!s)return;s.object.fields().filter((t=>{if(t?.id==i.abFieldID&&(i.label=t.label,i.key=t.columnName,i.data?.values&&t.settings.options)){var e=[];t.settings.options.forEach((t=>{e.push({label:t.text,value:t.id})})),i.data.values=e}}))}})))})),this.formBuilder}processDataFields(){var t=[];this.formBuilder.components.forEach((e=>{"button"==e.type&&"event"==e.action&&e.event&&t.push({id:e.event,text:e.label})}));var e=this.diagramID,i=this.AB.objectNew({}),s=new n({id:`${e}.userFormResponse`,label:`${this.label}->Response`,columnName:`${e}.userFormResponse`,settings:{options:t}},i);return[{key:`${e}.userFormResponse`,label:`${this.label}->Response`,field:s,object:null}]}processData(t,e){if(e){var i=e.split(".");if(i[0]==this.diagramID)return this.myState(t)[i[1]]}return null}}},96493:(t,e,i)=>{const s=i(21073);var n={category:"task",icon:"user",instanceValues:[],key:"TaskUser",settings:[]};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"process.task.user",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"User Task",actionName:"replace-with-user-task",className:"bpmn-icon-user",target:{type:"bpmn:UserTask"}}}initState(t,e){super.initState(t,{roles:[],ui:null},e)}}},39483:(t,e,i)=>{const s=i(21073),n={category:null,icon:"plus-circle",instanceValues:["userFormID","userFormResponse"],key:"External",settings:["who","toUsers","url"]},a={who:0,toUsers:null,url:""};t.exports=class extends s{constructor(t,e,i){for(const e in a)t[e]=t[e]??a[e];super(Object.assign({type:"process.task.service.external"},t),e,i,n)}static defaults(){return n}static DiagramReplace(){return null}processDataFields(){return[{key:`${this.id}.userFormResponse`,label:`${this.label}->Response`}]}}},41600:(t,e,i)=>{const s=i(21073);var n={category:"start",fields:[],icon:"key",key:"Trigger"};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"trigger",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Signal Start Event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}}fromValues(t){super.fromValues(t),this.triggerKey=t.triggerKey||"triggerKey.??"}toObj(){var t=super.toObj();return t.triggerKey=this.triggerKey,t}}},55364:(t,e,i)=>{const s=i(46732);var n={category:"start",fields:["objectID","lifecycleKey"],icon:"key",key:"TriggerLifecycle"};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"trigger",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Object Lifecycle Trigger",actionName:"replace-with-signal-lifecycle-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"ab:SignalLifecycle"}}}fromValues(t){super.fromValues(t),this.objectID=t.objectID||"objID.??",this.lifecycleKey=t.lifecycleKey||"lifecycle.key??"}toObj(){var t=super.toObj();return t.objectID=this.objectID,t.lifecycleKey=this.lifecycleKey,t}processDataFields(){var t=null;if(this.objectID){t=[];var e=this.AB.objectByID(this.objectID);if(e){var i=this.diagramID;e.fields().forEach((s=>{t.push({key:`${i}.${s.id}`,label:`${this.label}->${e.label}->${s.label}`,field:s,object:e})})),t.push({key:`${i}.uuid`,label:`${this.label}->${e.label}`,field:null,object:e})}else{var s=new Error(`ABProcessTriggerLifecycleCore.processDataFields():TaskID[${this.id}]: could not find referenced object by ID [${this.objectID}]`);this.AB.notify.builder(s,{task:this.id,objID:this.objectID})}}return t}processData(t,e){var i=e.split(".");if(i[0]==this.diagramID){var s=this.myState(t);if(s.data){var n;if(n=this.AB.objectByID(this.objectID).fields((t=>t.id==i[1]))[0])return i[2]?n[i[2]].call(n,s.data):-1!=["calculate","TextFormula"].indexOf(n.key)?n.format(s.data):("connectObject"==n.key||"user"==n.key)&&s.data[n.relationName()]||s.data[n.columnName];if("uuid"==i[1])return s.data.uuid;if(n=this.AB.objectByID(this.objectID).fields((t=>t.id==i[1]))[0])return i[2]?n[i[2]].call(n,s.data):s.data[n.columnName]}}return null}processDataObjects(){var t=null;return this.objectID&&(t=[this.AB.objectByID(this.objectID)]),t}}},97535:(t,e,i)=>{const s=i(46732);var n={category:"start",fields:["repeatEvery","repeatTime","repeatDaily","repeatWeekly","repeatMonthly","isEnabled"],icon:"clock-o",key:"TimerStartEvent",repeatEvery:"daily",repeatTime:"01:00",repeatDaily:"day",repeatWeekly:"FRI",repeatMonthly:"last",isEnabled:!0};t.exports=class extends s{constructor(t,e,i){t.type=t.type||"trigger",super(t,e,i,n)}static defaults(){return n}static DiagramReplace(){return{label:"Timer Start Event",actionName:"replace-with-signal-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"ab:SignalTriggerTimer"}}}fromValues(t){if(super.fromValues(t),this.repeatEvery=t.repeatEvery||n.repeatEvery,this.repeatDaily=t.repeatDaily||n.repeatDaily,this.repeatWeekly=t.repeatWeekly||n.repeatWeekly,this.repeatMonthly=t.repeatMonthly||n.repeatMonthly,t.repeatTime){let e=t.repeatTime.split(":"),i=new Date;i.setUTCHours(e[0]),i.setUTCMinutes(e[1]),this.repeatTime=`${i.getHours()}:${i.getMinutes()}`}else this.repeatTime=n.repeatTime;void 0!==t.isEnabled?this.isEnabled=JSON.parse(t.isEnabled):this.isEnabled=n.isEnabled}toObj(){var t=super.toObj();return t.repeatEvery=this.repeatEvery,t.repeatDaily=this.repeatDaily,t.repeatWeekly=this.repeatWeekly,t.repeatMonthly=this.repeatMonthly,t.repeatTime=this.repeatTime,t.repeatTime&&t.repeatTime instanceof Date&&(t.repeatTime=`${t.repeatTime.getUTCHours()}:${t.repeatTime.getMinutes()}`),t.isEnabled=this.isEnabled,t}getCronExpression(){let t,e,i,s=this.repeatTime.split(":"),n=s[1],a=s[0];switch(this.repeatEvery){case"daily":t="*",e="*",i="weekday"==this.repeatDaily?"1-5":"*";break;case"weekly":t="*",e="*",i=this.repeatWeekly;break;case"monthly":t=this.repeatMonthly,e="*",i="*"}return`* ${n} ${a} ${t} ${e} ${i} *`}}},52983:(t,e,i)=>{var s=i(73686);t.exports=class extends s{constructor(t,e,i,s,n){super(),Array.isArray(e)||(e=[e]),this.parameterDefinitions=e,this.object=i?i.object:null,i&&i.objectOut&&(this.object=i.objectOut),this.prevOP=i,this.task=s,this.AB=n,this.next=null,this.fromAttributes(t)}initObject(t){}fromAttributes(t){if(this.key=this.constructor.key??null,this.params=t.params??{},this.objectID=t.objectID||null,this.objectID&&(this.object=this.objectLookup(this.objectID)),this.initObject(t),this.objectID&&!this.object&&this.AB.notify.developer(new Error(`ABQLCore.fromAttributes(): unable to initialize ABObject [${this.objectID}]`),{attributes:t,objectID:this.objectID}),t.next){let e=null;if((this.NextQLOps??this.constructor.NextQLOps).forEach((i=>{i.key===t.next.key&&(e=i)})),e){const i=new e(t.next,this,this.task,this.AB);this.next=i}}}objectLookup(t){return this.AB.objects((e=>{const i=`"${e.label}"`;return e.id===t||0===i.indexOf(t)}))[0]}availableProcessDataFieldsHash(){const t=this.task.process.processDataFields(this.task)??[],e={};return t.forEach((t=>{t.field?e[t.field.id]=t:e[t.key]=t})),e}paramChanged(t){}toObj(){const t={key:this.constructor.key,params:this.params,objectID:this.object?.id??null};return this.next&&(t.next=this.next.toObj()),t}}},85111:(t,e,i)=>{const s=i(15430),n=i(88409),a=[{type:"objectConditions",name:"cond"}];class r extends s{constructor(t,e,i,s){super(t,a,e,i,s)}}r.key="find",r.label="find",r.NextQLOps=n,t.exports=r},98162:(t,e,i)=>{const s={fromAttributes:function(t,e,i){if(!t)return null;const n=[];return s.QLOps.forEach((e=>{e.key===t.key&&n.push(e)})),1===n.length?new n[0](t,e,i):null},QLOps:[i(54157)]};t.exports=s},37505:(t,e,i)=>{const s=i(15430),n=[i(63408)],a=[{type:"objectName",name:"name"}];class r extends s{constructor(t,e,i){super(t,a,null,e,i)}initObject(t){if(!this.object&&this.params){const t=this.parameterDefinitions.find((t=>"objectName"===t.type));t&&(this.objectID=this.params[t.name],this.object=this.objectLookup(this.objectID)),this.object||this.warningMessage("has no object set.",{objectID:this.objectID})}}toObj(){const t=super.toObj();if(!t.objectID&&this.params){const e=this.parameterDefinitions.find((t=>"objectName"===t.type));e&&(t.objectID=this.params[e.name])}return t}}r.key="object",r.label="object",r.NextQLOps=n,t.exports=r},26569:(t,e,i)=>{const s=i(465),n=i(47027),a=i(25851);t.exports=[s,n,a]},29215:(t,e,i)=>{const s=i(5926),n=i(465),a=i(47027);class r extends s{get NextQLOps(){let t=[];const e=this.field??this.object.fieldByID(this.fieldID)??null;switch(e?.key){case"connectObject":if("many"===e.settings.linkType){t=i(88409);break}t=this.prevOP.constructor.NextQLOps.filter((t=>t.key===this.constructor.key||t.key===n.key));break;case"user":if("many"===e.settings.linkType||e.settings.isMultiple){t=i(88409);break}t=this.prevOP.constructor.NextQLOps.filter((t=>t.key===this.constructor.key||t.key===n.key||t.key===a.key));break;default:t=this.prevOP.constructor.NextQLOps.filter((t=>t.key===a.key))}return t}}r.key="row_pluck",r.label="Read the value from the field",r.NextQLOps=[],t.exports=r},32569:(t,e,i)=>{const s=i(67478);class n extends s{}n.key="row_save",n.label="Save the value as",n.NextQLOps=[],t.exports=n},60354:(t,e,i)=>{const s=i(15430),n=[{type:"objectValues",name:"values"}];class a extends s{constructor(t,e,i,s){super(t,n,e,i,s),this.constructor.NextQLOps=e.constructor.NextQLOps}}a.key="update",a.label="Update this record",a.NextQLOps=[],t.exports=a},88409:(t,e,i)=>{t.exports=[i(88593),i(5926),i(67478)]},80219:(t,e,i)=>{const s=i(15430),n=i(26569);class a extends s{constructor(t,e,i,s){super(t,[],e,i,s)}}a.key="first",a.label="Select the first record",a.NextQLOps=n,t.exports=a},60512:(t,e,i)=>{const s=i(15430),n=[{type:"objectFields",name:"fieldID"}];class a extends s{constructor(t,e,i,s){super(t,n,e,i,s)}fromAttributes(t){this.constructor.NextQLOps=this.prevOP.constructor.NextQLOps,this.fieldID=t.fieldID,this.field=this.object?.fieldByID(this.fieldID),t.objectOutID&&(this.objectOut=this.objectLookup(t.objectOutID)),super.fromAttributes(t)}toObj(){const t=super.toObj();if(this.fieldID)t.fieldID=this.fieldID,this.objectOut&&(t.objectOutID=this.objectOut.id);else{t.fieldID=this.params.field||null;const e=this.object.fieldByID(t.fieldID);e?.isConnection&&(t.objectOutID=e.datasourceLink.id)}return t}}a.key="set_pluck",a.label="Read the value from the field",a.NextQLOps=[],t.exports=a},74178:(t,e,i)=>{const s=i(15430),n=[{type:"taskParam",name:"task_param"}];class a extends s{constructor(t,e,i,s){super(t,n,e,i,s),this.taskParam&&(i.registerDatasource(this),this.registered=!0)}fromAttributes(t){this.constructor.NextQLOps=this.prevOP.constructor.NextQLOps,super.fromAttributes(t),this.taskParam=t.taskParam||this.params.task_param}toObj(){const t=super.toObj();return t.taskParam=this.taskParam||this.params.task_param,t}processDataField(t,e){let i=null;return"connectObject"!==this.prevOP?.field?.key&&(i=this?.prevOP?.field),{key:`${t}.${this.taskParam||this.params.task_param}`,label:`${e}->${this.taskParam||this.params.task_param}`,field:i,object:this.object,set:!0}}}a.key="set_save",a.label="Save the value as",a.NextQLOps=[],t.exports=a},50792:(t,e,i)=>{const s=i(11895),n={key:"csvExporter",icon:"download",labelKey:"CSV Exporter"},a={dataviewID:null,where:null,buttonLabel:"Export CSV",filename:"exportCSV",hasHeader:!0,width:150};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),"string"==typeof t.settings.hasHeader&&(this.settings.hasHeader=JSON.parse(t.settings.hasHeader)),null==this.settings.hasHeader&&(this.settings.hasHeader=a.hasHeader),this.settings.width=parseInt(t.settings.width||a.width)}}},17876:(t,e,i)=>{const s=i(11895),n=i(26204),a={key:"csvImporter",icon:"upload",labelKey:"CSV Importer"},r={dataviewID:null,availableFieldIds:[],buttonLabel:"Upload CSV",width:0,recordRules:[]};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return r}fromValues(t){super.fromValues(t),this.settings.width=parseInt(this.settings.width||r.width)}get RecordRule(){let t=this.datacollection?.datasource;if(t)return null==this._recordRule&&(this._recordRule=new n),this._recordRule.formLoad(this),this._recordRule.fromSettings(this.settings.recordRules),this._recordRule.objectLoad(t),this._recordRule}doRecordRulesPre(t){t&&!Array.isArray(t)&&(t=[t]),t.forEach((t=>{this.RecordRule?.processPre({data:t.data||t,form:this})}))}doRecordRules(t){if(t&&!Array.isArray(t)&&(t=[t]),!this.RecordRule)return Promise.resolve();let e=[];return t.forEach((t=>{e.push(this.RecordRule.process({data:t.data||t,form:this}))})),Promise.all(e)}}},96483:(t,e,i)=>{const s=i(11895),n={dataviewID:null,field:null,width:460,height:275,showLabel:!0,hideItem:!1,hideButton:!1,navigationType:"corner",filterByCursor:!1,detailsPage:null,detailsTab:null,editPage:null,editTab:null},a={key:"carousel",icon:"clone",labelKey:"Carousel"};function r(t,e){void 0!==t.settings[e]?t.settings[e]=parseInt(t.settings[e]):t.settings[e]=n[e]}function o(t,e){try{t.settings[e]=JSON.parse(t.settings[e])}catch(i){t.settings[e]=n[e]}}t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t),r(this,"width"),r(this,"height"),o(this,"showLabel"),o(this,"hideItem"),o(this,"hideButton"),this.settings.navigationType=this.settings.navigationType||n.navigationType,o(this,"filterByCursor")}componentList(){return[]}get imageField(){let t=this.datacollection;if(!t)return null;let e=t.datasource;return e?e.fieldByID(this.settings.field):null}}},46202:(t,e,i)=>{const s=i(39564),n={areaType:"area",isLegend:1,chartHeight:200,labelFontSize:12,stepValue:20,maxValue:100},a={key:"area",icon:"area-chart",labelKey:"Area"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t),this.settings.areaType=this.settings.areaType||n.areaType,this.settings.isLegend=parseInt(this.settings.isLegend??n.isLegend),this.settings.chartHeight=parseInt(this.settings.chartHeight??n.chartHeight),this.settings.labelFontSize=parseInt(this.settings.labelFontSize??n.labelFontSize),this.settings.stepValue=parseInt(this.settings.stepValue??n.stepValue),this.settings.maxValue=parseInt(this.settings.maxValue??n.maxValue),this.translate(this,this,["areaLabel"])}componentList(){return[]}}},53253:(t,e,i)=>{const s=i(39564),n={barType:"bar",barPreset:"column",isLegend:1,height:200,labelFontSize:12,stepValue:20,maxValue:100},a={key:"bar",icon:"bar-chart",labelKey:"Bar"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t),this.settings.barType=this.settings.barType||n.barType,this.settings.barPreset=this.settings.barPreset||n.barPreset,this.settings.isLegend=parseInt(this.settings.isLegend??n.isLegend),this.settings.height=parseInt(this.settings.height??n.height),this.settings.labelFontSize=parseInt(this.settings.labelFontSize??n.labelFontSize),this.settings.stepValue=parseInt(this.settings.stepValue??n.stepValue),this.settings.maxValue=parseInt(this.settings.maxValue??n.maxValue),this.translate(this,this,["barLabel"])}componentList(){return[]}}},31311:(t,e,i)=>{const s=i(32715),n={dataviewID:"",columnValue:"",columnLabel:"",columnValue2:"",isPercentage:1,showLabel:1,labelPosition:"left",labelWidth:120,height:200,multipleSeries:0},a={key:"chart",icon:"bar-chart",labelKey:"Chart"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t),this.settings.dataviewID=this.settings.dataviewID??n.dataviewID,this.settings.columnValue=this.settings.columnValue??n.columnValue,this.settings.columnLabel=this.settings.columnLabel??n.columnLabel,this.settings.columnValue2=this.settings.columnValue2??n.columnValue2,this.settings.isPercentage=parseInt(this.settings.isPercentage??n.isPercentage),this.settings.showLabel=parseInt(this.settings.showLabel??n.showLabel),this.settings.labelPosition=this.settings.labelPosition||n.labelPosition,this.settings.labelWidth=parseInt(this.settings.labelWidth??n.labelWidth),this.settings.height=parseInt(this.settings.height??n.height),this.settings.multipleSeries=parseInt(this.settings.multipleSeries??n.multipleSeries),this.translate(this,this,["chartLabel"])}componentList(){const t=["label","pie","bar","line","area"];return this.application.viewAll((e=>t.indexOf(e.common().key)>-1))}labelField(){const t=this.datacollection;if(!t)return null;const e=t.datasource;return e?e.fieldByID(this.settings.columnLabel):null}valueField(){const t=this.datacollection;if(!t)return null;const e=t.datasource;return e?e.fieldByID(this.settings.columnValue):null}valueField2(){const t=this.datacollection;if(!t)return null;const e=t.datasource;return e?e.fieldByID(this.settings.columnValue2):null}}},59875:(t,e,i)=>{const s=i(39564),n={lineType:"line",linePreset:"plot",isLegend:1,chartHeight:200,labelFontSize:12,stepValue:20,maxValue:100},a={key:"line",icon:"line-chart",labelKey:"Line"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t),this.settings.lineType=this.settings.lineType||n.lineType,this.settings.linePreset=this.settings.linePreset||n.linePreset,this.settings.isLegend=parseInt(this.settings.isLegend??n.isLegend),this.settings.chartHeight=parseInt(this.settings.chartHeight??n.chartHeight),this.settings.labelFontSize=parseInt(this.settings.labelFontSize??n.labelFontSize),this.settings.stepValue=parseInt(this.settings.stepValue??n.stepValue),this.settings.maxValue=parseInt(this.settings.maxValue??n.maxValue),this.translate(this,this,["lineLabel"])}componentList(){return[]}}},12118:(t,e,i)=>{const s=i(39564),n={pieType:"pie",isLegend:1,height:200,innerFontSize:12,labelFontSize:12},a={key:"pie",icon:"pie-chart",labelKey:"Pie"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t),this.settings.pieType=this.settings.pieType||n.pieType,this.settings.isLegend=parseInt(this.settings.isLegend??n.isLegend),this.settings.height=parseInt(this.settings.height??n.height),this.settings.innerFontSize=parseInt(this.settings.innerFontSize??n.innerFontSize),this.settings.labelFontSize=parseInt(this.settings.labelFontSize??n.labelFontSize),this.translate(this,this,["pieLabel"])}componentList(){return[]}}},42194:(t,e,i)=>{const s=i(11895),n={dataviewID:null,columnUser:null,columnComment:null,columnDate:null,height:300,label:""},a={key:"comment",icon:"comments",labelKey:"Comment"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t),this.settings.height=parseInt(this.settings.height||0)}componentList(){return[]}getCurrentUserId(){const t=this.getUsers(),e=this.AB.Account.username();if(t)return t.findIndex((t=>t.value===e))+1}getUsers(){return this.AB.Account.userList().map((t=>({id:t.username,value:t.username,image:t.image_id})))}getUserField(){var t=this.datacollection;if(!t)return null;var e=t.datasource;return e?e.fieldByID(this.settings.columnUser):null}getCommentField(){var t=this.datacollection;if(!t)return null;var e=t.datasource;return e?e.fieldByID(this.settings.columnComment):null}getDateField(){var t=this.datacollection;if(!t)return null;var e=t.datasource;return e?e.fieldByID(this.settings.columnDate):null}getUserData(){let t=this.AB.objectUser().fieldByID("6383ce19-b344-44ee-87e6-decced7361f8");var e=this.getUsers(),i=[];if(e)return e.forEach(((e,s)=>{var n="";e.image&&(n=t.urlImage(e.image));var a={id:s+1,value:e.value,image:n};i.push(a)})),i}model(){let t=this.datacollection;return t&&t.model||null}}},10962:(t,e,i)=>{const s=i(32715),n={dataviewID:null,filterConditions:{}},a={key:"conditionalcontainer",icon:"shield",labelKey:"Conditional Container"};t.exports=class extends s{constructor(t,e,i,n){super(t,e,i,n||a);const r=(...t)=>this.AB.Multilingual.label(...t);if(this.views((t=>t instanceof s)).length<2){this._views=[];const t=e.viewNew({key:s.common().key,label:r("If"),name:"If",settings:{removable:!1}},e,this);this._views.push(t);const i=e.viewNew({key:s.common().key,label:r("Else"),name:"Else",settings:{removable:!1}},e,this);this._views.push(i)}}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},3578:(t,e,i)=>{const s=i(11895),n={dataviewID:null,field:null},a={key:"connect-data-filter",icon:"filter",labelKey:"Connected Data Filter"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s??a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},45132:(t,e,i)=>{const s=i(10902),n={key:"viewcontainer",icon:"braille",labelKey:"Container"},a={columns:1,gravity:1,movable:!0,removable:!0};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.columns=parseInt(this.settings.columns||a.columns),void 0!==this.settings.gravity&&this.settings.gravity.map((function(t){return parseInt(t)})),null!=this.settings.removable?this.settings.removable=JSON.parse(this.settings.removable):this.settings.removable=a.removable,null!=this.settings.movable?this.settings.movable=JSON.parse(this.settings.movable):this.settings.movable=a.movable}viewsSortByPosition(){return this.views().sort(((t,e)=>t.position.y==e.position.y?t.position.x-e.position.x:t.position.y-e.position.y))}}},45974:(t,e,i)=>{var s=i(97069);const n={key:"view",icon:"window-maximize",labelKey:"ab.components.view",tabicon:""},a={label:""};t.exports=class extends s{constructor(t,e,i,s){super(["label"],e.AB),this.__events=[],this.defaults=s||n,this.application=e,this.parent=i||null,this.warningsSilent=!1,this.__missingViews=[],this.fromValues(t)}static common(){return n}static defaultValues(){return a}static newInstance(t,e){return t.viewNew({key:this.common().key},t,e)}viewKey(){return this.defaults.key}viewIcon(){return this.defaults.icon}tabIcon(){return this.defaults.tabicon}toObj(){var t=super.toObj(),e={id:this.id,type:this.type||"view",key:this.key,icon:this.icon,tabicon:this.tabicon,name:this.name,settings:this.AB.cloneDeep(this.settings||{}),accessLevels:this.accessLevels,translations:t.translations};return e.viewIDs=(this._views||[]).map((t=>t.id)).filter((t=>t)),e.viewIDs=e.viewIDs.concat(this.__missingViews),this.position&&(e.position=this.position),e.isRoot=this.isRoot(),e}fromValues(t){if(this.id=t.id,this.type=t.type||"view",this.key=t.key||this.viewKey(),this.icon=t.icon||this.viewIcon(),this.tabicon=t.tabicon||this.tabIcon(),this.name=t.name,t.settings=t.settings||{},this.label=t.label||t.settings.label||"?label?",this.settings=t.settings||{},this.settings.height=parseInt(this.settings.height||0),this.accessLevels=t.accessLevels||{},super.fromValues(t),!this.name&&Array.isArray(this.translations))for(var e=0;e<this.translations.length;e++)if(0==e&&(this.name=this.translations[e].label),"en"==this.translations[e].language_code){this.name=this.translations[e].label;break}"?label?"==this.label&&this.parent&&(this.label=this.parent.label+"."+this.defaults.key);var i=[];this.__missingViews=this.__missingViews||[],(t.viewIDs||[]).forEach((t=>{var e=this.AB.definitionByID(t);e?i.push(this.application.viewNew(e,this.application,this)):this.__missingViews.push(t)})),this._views=i,this.position=t.position||{},null!=this.position.x&&(this.position.x=parseInt(this.position.x)),null!=this.position.y&&(this.position.y=parseInt(this.position.y)),this.position.dx=parseInt(this.position.dx||1),this.position.dy=parseInt(this.position.dy||1)}isRoot(){return null==this.parent||this.parent==this.application}allParents(){var t=[],e=this;for(t.unshift(e);!e.isRoot()&&e.parent;)t.unshift(e.parent),e=e.parent;return t}isAccessibleForRoles(t){var e=!1,i=Object.keys(this.accessLevels)||[];return(t||[]).forEach((t=>{i.indexOf(t.uuid||t)>-1&&(e=!0)})),e}getUserAccess(){var t=0;if(this.application.isAccessManaged){var e=!1;1==parseInt(this.application.accessManagers.useRole)&&this.AB.Account.roles().forEach((i=>{this.application.accessManagers.role.indexOf(i.id||i.uuid)>-1&&(e=!0,t=2)})),e||1!=parseInt(this.application.accessManagers.useAccount)||this.application.accessManagers.account.indexOf(this.AB.Account.uuid()+"")>-1&&(e=!0,t=2),this.accessLevels&&Object.keys(this.accessLevels).length>0&&!e&&this.AB.Account.roles().forEach((e=>{var i=this.accessLevels[e.id||e.uuid];i&&parseInt(i)>t&&(t=parseInt(i))}))}else t=2;return t}parentFormComponent(){for(var t=null,e=this;"form"!=e.key&&!e.isRoot()&&e.parent;)e=e.parent;return"form"==e.key&&(t=e),t}parentDetailComponent(){for(var t=null,e=this;"detail"!=e.key&&!e.isRoot()&&e.parent;)e=e.parent;return"detail"==e.key&&(t=e),t}pageParent(t){if(null==t&&(t=()=>!0),this.isRoot())return this;for(var e=this.parent;e&&("page"!=e.key||!t(e));)e=e.parent;return e}pageRoot(){for(var t=this.pageParent();!t.isRoot();)t=t.pageParent();return t}urlPointer(){return this.parent?this.parent.urlView()+this.id:this.application.urlPage()+this.id}urlView(){return this.urlPointer()+"/_views/"}get datacollection(){let t=(this.settings||{}).dataviewID;if(!t){if(["form","grid","line","area","bar","gantt","kanban"].indexOf(this.key)>-1){if("form"==this.key&&this._currentObject)return null;if(this.warningsSilent)return null;var e=new Error(`ABViewCore:get datacollection(): View[${this.key}] didn't define a dataviewID.`);this.AB.notify.builder(e,{view:this,settings:this.settings})}else-1==["button","label","page","tab","viewcontainer"].indexOf(this.key)&&console.warn(`TODO: figure out which ABView* require a .dataviewID: ${this.key}?`);return null}var i=this.AB.datacollectionByID(t);if(!i){var s=new Error(`View[${this.label}][${this.id}] is unable to find associated DataCollection`);this.AB.notify.builder(s,{view:this,dataviewID:t})}return i}updateAccessLevels(t,e){return 0==parseInt(e)?this.accessLevels[t]&&delete this.accessLevels[t]:this.accessLevels[t]=e,this.save(!1,!1)}views(t=(()=>!0),e=!1){var i=[];return!this._views||this._views.length<1||(t&&e?(i=i.concat(this._views.filter(t)),this._views.forEach((s=>{var n=s.views(t,e);n&&n.length>0&&(i=i.concat(n))}))):i=this._views.filter(t)),i}viewNew(t,e,i){return this.application.viewNew(t,e||this.application,i||this)}viewDestroy(t){return console.error("DEPRECIATED: where is this called?"),this.viewRemove(t)}viewRemove(t){var e=this._views.length;return this._views=this.views((function(e){return e.id!=t.id})),this._views.length<e?this.save():Promise.resolve()}viewInsert(t){return this.views((function(e){return e.id==t.id})).length>0?Promise.resolve():(this._views.push(t),this.save())}viewReorder(t,e){var i=this._views.findIndex((e=>e.id==t));if(!(i<0))return this._views.splice(e,0,this._views.splice(i,1)[0]),this.save(!0)}destroy(){return this.eventClear(!0),Promise.resolve().then((()=>{var t=[],e=this.views();return this._views=[],e.forEach((e=>{t.push(e.destroy())})),Promise.all(t)})).then((()=>{if(this.parent&&!this.pages)return this.parent.viewRemove(this)})).then((()=>super.destroy())).then((()=>{this.emit("destroyed")}))}save(){return Promise.resolve().then((()=>super.save())).then((()=>{if(this.parent&&!this.pages)return this.parent.viewInsert(this)})).then((()=>this))}eventAdd(t){if(t&&t.emitter&&t.listener){var e=this.__events.find((e=>e.emitter==t.emitter&&e.eventName==t.eventName));(!e||e.length<1)&&(this.__events.push({emitter:t.emitter,eventName:t.eventName,listener:t.listener}),t.emitter.on(t.eventName,t.listener))}}eventClear(t){t&&this.views().forEach((e=>{e.eventClear(t)})),this.__events&&this.__events.length>0&&this.__events.forEach((t=>{t.emitter.removeListener(t.eventName,t.listener)}))}clone(t,e,i={}){t=t||{};let s=this.toObj();["pages","views"].forEach((t=>{delete s[t]})),this.copyUpdateProperyList&&(this.copyUpdateProperyList()||[]).forEach((e=>{s&&s.settings&&(s.settings[e]=t[s.settings[e]])}));let n=this.viewNew(s,this.application,e);return n.id=null==e?null:t[n.id]||this.AB.uuid(),this.pages&&!i.ignoreSubPages&&(n._pages=[],this.pages().forEach((e=>{let s=e.clone(t,n,i);s.parent=n,n._pages.push(s)}))),this.views&&!i.ignoreSubViews&&(n._views=[],this.views().forEach((e=>{let s=e.clone(t,n,i);n._views.push(s)}))),n}copy(t,e,i={}){t=t||{};let s=this.toObj();["pageIDs","viewIDs"].forEach((t=>{delete s[t]})),this.copyUpdateProperyList&&(this.copyUpdateProperyList()||[]).forEach((e=>{s&&s.settings&&(s.settings[e]=t[s.settings[e]])}));let n=this.application.viewNew(s,this.application,e);return n.parent=e||this.parent,n.id=null==e?null:t[n.id]||this.AB.uuid(),"page"==this.key&&(n.name=i?.newName||`${n.name}_copied_${this.AB.uuid().slice(0,3)}`,n.label=i?.newName||`${n.label} (copied)`),Promise.resolve().then((()=>{var e=[];return this._pages&&!i.ignoreSubPages&&(n._pages=[],this.pages().forEach((s=>{s.isRoot()&&this.application._pages.push({id:t[s.id]}),e.push(s.copy(t,n,i).then((e=>{e.parent=n,this.application._pages=this.application._pages.filter((e=>e.id!=t[s.id])),n._pages.push(e)})))}))),Promise.all(e)})).then((()=>{var e=[];return this._views&&!i.ignoreSubViews&&(n._views=[],this.views().forEach((s=>{e.push(s.copy(t,n,i).then((t=>{n._views.filter((e=>e.id==t.id)).length<1&&n._views.push(t)})))}))),Promise.all(e)})).then((()=>n.save())).then((()=>n))}}},10801:(t,e,i)=>{const s=i(11895),n={dataviewID:null,field:null,viewType:"advanced",showFilter:1,showSort:1},a={key:"data-filter",icon:"filter",labelKey:"Data Filter"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s??a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t)}componentList(){return[]}}},37446:(t,e,i)=>{const s=i(80414),n={xCount:1,detailsPage:"",detailsTab:"",editPage:"",editTab:""},a={key:"dataview",icon:"th",labelKey:"Data view"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t),this.settings.xCount=parseInt(this.settings.xCount||n.xCount),this.settings.detailsPage=this.settings.detailsPage||n.detailsPage,this.settings.editPage=this.settings.editPage||n.editPage,this.settings.detailsTab=this.settings.detailsTab||n.detailsTab,this.settings.editTab=this.settings.editTab||n.editTab}parentDetailComponent(){let t=null,e=this;for(;"dataview"!=e.key&&!e.isRoot()&&e.parent;)e=e.parent;return"dataview"==e.key&&(t=e),t}}},24044:(t,e,i)=>{const s=i(81621),n={},a={key:"detailcheckbox",icon:"check-square-o",labelKey:"ab.components.detail.checkbox"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s??a)}static common(){return a}static defaultValues(){return n}}},16497:(t,e,i)=>{const s=i(81621),n={formView:""},a={key:"detailconnect",icon:"list-ul",labelKey:"ab.components.detail.connect"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s??a)}static common(){return a}static defaultValues(){return n}}},12407:(t,e,i)=>{const s=i(32715),n={key:"detail",icon:"file-text-o",labelKey:"Detail"},a={dataviewID:null,showLabel:!0,labelPosition:"left",labelWidth:120,height:0};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s??n)}static common(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.labelPosition=this.settings.labelPosition||a.labelPosition,this.settings.showLabel=JSON.parse(null!=this.settings.showLabel?this.settings.showLabel:a.showLabel),this.settings.labelWidth=parseInt(this.settings.labelWidth||a.labelWidth),this.settings.height=parseInt(this.settings.height??a.height)}componentList(){let t=["label","text"];return this.application.viewAll().filter((e=>t.indexOf(e.common().key)>-1))}addFieldToDetail(t,e){if(null==t)return;let i=t.detailComponent().newInstance(this.application,this);return null!=i?(i.settings=i.settings??{},i.settings.fieldId=t.id,i.settings.labelWidth=this.settings.labelWidth||a.labelWidth,i.settings.alias=t.alias,i.position.y=e,this._views.push(i),i):void 0}}},78276:(t,e,i)=>{const s=i(81621),n={},a={key:"detailcustom",icon:"dot-circle-o",labelKey:"ab.components.detail.custom"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s??a)}static common(){return a}static defaultValues(){return n}}},81597:(t,e,i)=>{const s=i(81621),n={height:80,width:120},a={key:"detailimage",icon:"image",labelKey:"ab.components.detail.image"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s??a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t),this.settings.height=parseInt(this.settings.height||n.height),this.settings.width=parseInt(this.settings.width??n.width)}}},12326:(t,e,i)=>{const s=i(11895);t.exports=class extends s{detailComponent(){let t=null,e=this;for(;!e.isRoot()&&e.parent&&"detail"!=e.key&&"dataview"!=e.key;)e=e.parent;return"detail"!=e.key&&"dataview"!=e.key||(t=e),t}field(){let t=this.detailComponent();if(null==t)return null;let e=t.datacollection;if(null==e)return null;let i=e.datasource;if(null==i)return null;let s=i.fields((t=>t.id==this.settings.fieldId))[0];return s&&this.settings.alias&&(s.alias=this.settings.alias),s}getCurrentData(){let t=this.detailComponent();if(!t)return null;let e=t.datacollection;if(!e)return null;let i=this.field();if(!i)return null;let s=e.getCursor();return s?s[i.columnName]:null}componentList(){return[]}get datacollection(){return null}}},89207:(t,e,i)=>{const s=i(81621),n={height:0},a={key:"detailtext",icon:"etsy",labelKey:"ab.components.detail.text"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s??a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t),this.settings.height=parseInt(this.settings.height||n.height)}}},7716:(t,e,i)=>{const s=i(81621),n={},a={key:"detailtree",icon:"sitemap",labelKey:"ab.components.detail.tree"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s??a)}static common(){return a}static defaultValues(){return n}}},24107:(t,e,i)=>{const s=i(11895),n={buttonlabel:"Download DOCX",dataviewID:null,width:0,filename:"",filelabel:"output.docx",language:"en",toolbarBackground:"ab-background-default",buttonPosition:"left"},a={key:"docxBuilder",icon:"file-word-o",labelKey:"DOCX Builder"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}toObj(){this.unTranslate(this,this,["filelabel","buttonlabel"]);let t=super.toObj();return t.viewIDs=[],t}fromValues(t){super.fromValues(t),this.settings.width=parseInt(this.settings.width||n.width),this.translate(this,this,["filelabel","buttonlabel"])}uploadUrl(){const t=this.datacollection.datasource,e=t?t.fields()[0]:null;return`/file/upload/${t?.id}/${e?.id}/1`}downloadUrl(){return`/file/${this.settings.filename}`}get languageCode(){return this.settings.language||n.language}get datacollections(){let t=(this.settings||{}).dataviewID;if(!t)return[];let e=t.split(",")||[];return this.AB.datacollections((t=>e.indexOf(t.id)>-1))||[]}}},32609:(t,e,i)=>{const s=i(10902),n={includeSave:!0,saveLabel:"",includeCancel:!1,cancelLabel:"",includeReset:!1,resetLabel:"",afterCancel:null,alignment:"right",isDefault:!1},a={key:"button",icon:"square",labelKey:"ab.components.button"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}toObj(){let t=[];return this.settings.saveLabel&&t.push("saveLabel"),this.settings.cancelLabel&&t.push("cancelLabel"),this.settings.resetLabel&&t.push("resetLabel"),this.unTranslate(this.settings,this.settings,t),super.toObj()}get datacollection(){return null}fromValues(t){super.fromValues(t);let e=[];this.settings.saveLabel&&e.push("saveLabel"),this.settings.cancelLabel&&e.push("cancelLabel"),this.settings.resetLabel&&e.push("resetLabel"),this.unTranslate(this.settings,this.settings,e),this.settings.includeSave=JSON.parse(this.settings.includeSave||n.includeSave),this.settings.includeCancel=JSON.parse(this.settings.includeCancel||n.includeCancel),this.settings.includeReset=JSON.parse(this.settings.includeReset||n.includeReset),this.settings.isDefault=JSON.parse(this.settings.isDefault||n.isDefault)}componentList(){return[]}}},18489:(t,e,i)=>{const s=i(48717),n={},a={key:"checkbox",icon:"check-square-o",labelKey:"ab.components.checkbox"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},24703:(t,e,i)=>{const s=i(48717),n={formView:"",filterConditions:{glue:"and",rules:[]},sortFields:[],popupWidth:700,popupHeight:450},a={key:"connect",icon:"list-ul",labelKey:"Connect"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t),this.settings.filterConditions=this.settings.filterConditions||n.filterConditions}componentList(){return[]}}},36980:(t,e,i)=>{const s=i(32715),n=i(48717),a=i(26204),r=i(51567),o={key:"form",icon:"list-alt",labelKey:"Form"},l={dataviewID:null,showLabel:!0,labelPosition:"left",labelWidth:120,height:200,clearOnLoad:!1,clearOnSave:!1,displayRules:[],editForm:"none",recordRules:[],submitRules:[]};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||o)}static common(){return o}static defaultValues(){return l}fromValues(t){super.fromValues(t),this.settings.labelPosition=this.settings.labelPosition||l.labelPosition,this.settings.showLabel=JSON.parse(null!=this.settings.showLabel?this.settings.showLabel:l.showLabel),this.settings.clearOnLoad=JSON.parse(null!=this.settings.clearOnLoad?this.settings.clearOnLoad:l.clearOnLoad),this.settings.clearOnSave=JSON.parse(null!=this.settings.clearOnSave?this.settings.clearOnSave:l.clearOnSave),this.settings.labelWidth=parseInt(null==this.settings.labelWidth?l.labelWidth:this.settings.labelWidth),this.settings.height=parseInt(null==this.settings.height?l.height:this.settings.height)}objectLoad(t){this._currentObject=t}componentList(){var t=["label","layout","button","text"];return this.application.viewAll().filter((e=>t.indexOf(e.common().key)>-1))}fieldComponents(t){const e=t=>{let i=[];return t.forEach((t=>{null!=t&&(i.push(t),t._views?.length&&(i=i.concat(e(t._views))))})),i};return this._views?.length?(null==t&&(t=t=>t instanceof n),e(this._views).filter(t)):[]}addFieldToForm(t,e){if(null!=t){var i=t.formComponent();if(null!=i){var s=i.newInstance(this.application,this);if(null!=s)return s.settings=s.settings||{},s.settings.fieldId=t.id,null!=e&&(s.position.y=e),this._views.push(s),s}}}get RecordRule(){let t=this.datacollection.datasource;return null==this._recordRule&&(this._recordRule=new a),this._recordRule.formLoad(this),this._recordRule.fromSettings(this.settings.recordRules),this._recordRule.objectLoad(t),this._recordRule}doRecordRulesPre(t){return this.RecordRule.processPre({data:t,form:this})}doRecordRules(t){return t&&!this.datacollection.datasource.isValidData(t).pass()?(console.error("Updated data is invalid.",{rowData:t}),Promise.reject(new Error("Updated data is invalid."))):this.RecordRule.process({data:t,form:this})}doSubmitRules(t){var e=this.datacollection.datasource,i=new r;return i.formLoad(this),i.fromSettings(this.settings.submitRules),i.objectLoad(e),i.process({data:t,form:this})}}},21984:(t,e,i)=>{const s=i(48717),n={},a={key:"fieldcustom",icon:"object-group",labelKey:"ab.components.custom"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},86237:(t,e,i)=>{const s=i(48717),n={timepicker:!1},a={key:"datepicker",icon:"calendar",labelKey:"ab.components.datepicker"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},49510:(t,e,i)=>{const s=i(10902),n={required:0,disable:0};t.exports=class extends s{static defaultValues(){return n}get datacollection(){let t=this.parentFormComponent();if(null==t)return null;let e=t.datacollection;return null==e?null:e}field(){if(this.settings.objectId){let t=this.AB.objectByID(this.settings.objectId);return t?t.fieldByID(this.settings.fieldId):null}{let t,e=this.parentFormComponent();if(null==e)return null;if(e._currentObject)t=e._currentObject;else{let i=e.datacollection;if(null==i)return null;t=i.datasource}return null==t?null:t.fieldByID(this.settings.fieldId)}}}},59396:(t,e,i)=>{const s=i(48717),n={type:"string"},a={key:"json",icon:"brackets-curly",labelKey:"ab.components.json"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},84909:(t,e,i)=>{const s=i(48717),n={isStepper:0},a={key:"numberbox",icon:"hashtag",labelKey:"ab.components.number"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}toObj(){this.unTranslate(this,this,["label","formLabel"]);var t=super.toObj();return t.views=[],t}fromValues(t){super.fromValues(t),this.settings.isStepper=this.settings.isStepper||n.isStepper,this.settings.isStepper=parseInt(this.settings.isStepper)}componentList(){return[]}}},83569:(t,e,i)=>{const s=i(79662),n={},a={key:"fieldreadonly",icon:"calculator",labelKey:"ab.components.readonly"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},71172:(t,e,i)=>{const s=i(48717),n={type:"multicombo"},a={key:"selectmultiple",icon:"list-ul",labelKey:"ab.components.selectmultiple"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},54098:(t,e,i)=>{const s=i(48717),n={type:"richselect"},a={key:"selectsingle",icon:"list-ul",labelKey:"ab.components.selectsingle"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},87209:(t,e,i)=>{const s=i(48717),n={type:"single"},a={key:"textbox",icon:"i-cursor",labelKey:"ab.components.textbox"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},80926:(t,e,i)=>{const s=i(79662),n={},a={key:"formtree",icon:"sitemap",labelKey:"ab.components.tree"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}}},66959:(t,e,i)=>{const s=i(11895),n={dataviewID:"",titleFieldID:"",startDateFieldID:"",endDateFieldID:"",durationFieldID:"",progressFieldID:"",notesFieldID:""},a={key:"gantt",icon:"tasks",labelKey:"Gantt"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t),Object.keys(n).forEach((t=>{this.settings[t]=this.settings[t]||n[t]}))}componentList(){return[]}}},12268:(t,e,i)=>{const s=i(11895),n={label:"",dataviewID:"",padding:17,showToolbar:1,isEditable:0,massUpdate:0,allowDelete:0,isSortable:1,isExportable:0,detailsPage:"",detailsTab:"",editPage:"",editTab:"",trackView:0,frozenColumnID:"",hiddenFields:[],summaryColumns:[],countColumns:[],objectWorkspace:{frozenColumnID:"",hiddenFields:[],summaryColumns:[],countColumns:[]},gridFilter:{filterOption:1,userFilterPosition:"toolbar",isGlobalToolbar:1},height:0,hideHeader:0,labelAsField:0,hideButtons:0,groupBy:"",columnConfig:[],saveLocal:1},a={key:"grid",icon:"table",labelKey:"Grid"};function r(t,e){void 0!==t[e]?t[e]=t[e]||n[e]:t[e]=n[e]}function o(t,e){try{t[e]=JSON.parse(t[e])}catch(i){t[e]=n[e]}}t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t),r(this.settings,"dataviewID"),o(this.settings,"padding"),o(this.settings,"showToolbar"),o(this.settings,"isEditable"),o(this.settings,"massUpdate"),o(this.settings,"allowDelete"),o(this.settings,"isSortable"),o(this.settings,"isExportable"),o(this.settings,"hideHeader"),o(this.settings,"labelAsField"),o(this.settings,"hideButtons"),o(this.settings,"columnConfig"),o(this.settings,"saveLocal"),this.settings.gridFilter=this.settings.gridFilter||n.gridFilter;try{this.settings.gridFilter.filterOption=JSON.parse(this.settings.gridFilter.filterOption)}catch(t){this.settings.gridFilter.filterOption=n.gridFilter.filterOption}try{this.settings.gridFilter.isGlobalToolbar=JSON.parse(this.settings.gridFilter.isGlobalToolbar)}catch(t){this.settings.gridFilter.isGlobalToolbar=n.gridFilter.isGlobalToolbar}r(this.settings,"detailsPage"),r(this.settings,"editPage"),r(this.settings,"detailsTab"),r(this.settings,"editTab"),o(this.settings,"trackView");var e=["sortFields","filterConditions","frozenColumnID","hiddenFields","summaryColumns","countColumns"];this.settings.objectWorkspace&&e.forEach((t=>{this.settings[t]||(this.settings[t]=this.settings.objectWorkspace[t])})),e.forEach((t=>{r(this.settings,t)})),this._views=[]}componentList(){return[]}removeField(t,e){let i=!1;if(this.settings?.frozenColumnID==t.columnName&&(this.settings.frozenColumnID="",i=!0),this.settings.hiddenFields?.length){let e=this.settings.hiddenFields.indexOf(t.columnName);e>-1&&(this.settings.hiddenFields.splice(e,1),i=!0)}if(this.settings.summaryColumns?.length){let e=this.settings.summaryColumns.indexOf(t.id);e>-1&&(this.settings.summaryColumns.splice(e,1),i=!0)}if(this.settings.countColumns?.length){let e=this.settings.countColumns.indexOf(t.id);e>-1&&(this.settings.countColumns.splice(e,1),i=!0)}e(null,i)}copyUpdateProperyList(){return["detailsPage","detailsTab","editPage","editTab"]}}},27950:(t,e,i)=>{const s=i(11895),n={filename:"",width:200,height:100},a={key:"image",icon:"picture-o",labelKey:"Image"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}get datacollection(){return null}fromValues(t){super.fromValues(t),this.settings.width=parseInt(this.settings.width||n.width),this.settings.height=parseInt(this.settings.height||n.height)}}},77907:(t,e,i)=>{const s=i(11895),n={dataviewID:null,editFields:[],verticalGroupingField:"",horizontalGroupingField:"",ownerField:"",template:""},a={key:"kanban",icon:"columns",labelKey:"Kanban"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}fromValues(t){super.fromValues(t),this.settings.template||(this.settings.template={id:`${this.id}_template`,key:"text"},this.settings.template.text=this.settings.textTemplate),this.TextTemplate=this.AB.viewNewDetatched(this.settings.template)}toObj(){var t=super.toObj();return t.settings.template=this.TextTemplate.toObj(),t.settings.template.id=`${this.id}_template`,t}static common(){return a}static defaultValues(){return n}}},55759:(t,e,i)=>{const s=i(11895),n={text:"",format:0,alignment:"left"},a={key:"label",icon:"font",labelKey:"Label"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}toObj(){this.unTranslate(this,this,["label","text"]);var t=super.toObj();return t.viewIDs=[],t}fromValues(t){super.fromValues(t),this.text=t.text||t.settings.text||"*text",this.settings.format=this.settings.format||n.format,this.settings.alignment=this.settings.alignment||n.alignment,this._views=[],this.settings.format=parseInt(this.settings.format),this.translate(this,this,["label","text"])}componentList(){return[]}formatNormal(){this.settings.format=0}formatTitle(){this.settings.format=1}formatDescription(){this.settings.format=2}}},96897:(t,e,i)=>{const s=i(32715),n=i(11895),a={label:"",numColumns:1},r={key:"layout",icon:"columns",labelKey:"Layout"};t.exports=class extends n{constructor(t,e,i,s){super(t,e,i,s||r)}static common(){return r}static defaultValues(){return a}addColumn(){this._views.push(this.application.viewNew({key:s.common().key},this.application,this))}componentList(t){return t?[]:this.parent?this.parent.componentList(!1):[]}get datacollection(){return null}}},76589:(t,e,i)=>{const s=i(11895),n={dataviewID:null,field:null,height:0},a={key:"list",icon:"list-ul",labelKey:"List"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}componentList(){return[]}field(){var t=this.datacollection;if(!t)return null;var e=t.datasource;return e?e.fieldByID(this.settings.field):null}}},42579:(t,e,i)=>{const s=i(11895),n={orientation:"x",buttonStyle:"ab-menu-default",menuAlignment:"ab-menu-left",menuInToolbar:1,menuPadding:10,menuTheme:"bg_gray",menuPosition:"left",menuTextLeft:"",menuTextRight:"",menuTextCenter:"",pages:[],order:[]},a={key:"menu",icon:"th-large",labelKey:"Menu"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}toObj(){this.unTranslate(this,this,["menuTextLeft","menuTextCenter","menuTextRight"]),this.settings.pages&&this.settings.pages.forEach((t=>{this.unTranslate(t,t,["aliasname"])}));var t=super.toObj();return t.viewIDs=[],t}fromValues(t){super.fromValues(t),this.translate(this,this,["menuTextLeft","menuTextCenter","menuTextRight"]),this.settings.pages=this.settings.pages||n.pages;for(var e=0;e<this.settings.pages.length;e++){var i=this.settings.pages[e];i instanceof Object?(i.isChecked=JSON.parse(i.isChecked||!1),this.translate(i,i,["aliasname"])):"string"==typeof i&&(this.settings.pages[e]={pageId:i,isChecked:!0})}}componentList(){return[]}ClearPagesInView(t){t&&t.count()>1&&t.find({}).forEach((e=>{t.remove(e.id)}))}get datacollection(){return null}AddPagesToView(t,e){t&&e&&(e||[]).forEach((e=>{if(e.isChecked){let s=this.application.pages((t=>t.id==e.pageId),!0)[0];if(!s)return;if(0==s.getUserAccess())return;if(e.tabId){let t=this.application.views((t=>t.id==e.tabId),!0)[0];if(!t)return;if(0==t.getUserAccess())return}let n=this.getAliasname(e);var i;if(null==(i=e.parent&&"0"!=e.parent?t.getSubMenu(e.parent):t)&&(t.getMenuItem(e.parent).submenu=[],t.refresh(e.parent),i=t.getSubMenu(e.parent)),i.exists(e.tabId||e.pageId))return;i.add({id:e.tabId||e.pageId,value:n,type:e.type,pageId:e.pageId,icon:e.icon?"fa fa-fw fa-"+e.icon:""},e.position?parseInt(e.position):0)}}))}getAliasname(t){var e=this.AB.Multilingual.currentLanguage(),i=t.translations.filter((t=>t.language_code==e)),s="";if(i.length&&(i[0].aliasname?s=i[0].aliasname:i[0].label&&(s=i[0].label)),!s&&t.aliasname&&(s=t.aliasname),!s||!s.replace(/\[.{2,}\]/g,"")){var n;n=t.pageId?t.pageId:this.getParentPageId(t);var a=this.application.pages((t=>t.id==n),!0)[0];if(a)if("tab"==t.type||"viewcontainer"==t.key){var r=a.views((e=>e.id==t.tabId||e.id==t.id),!0)[0];r&&(s=r.label)}else s=a.label}return s}getParentPageId(t){return"page"!=t.key?this.getParentPageId(t.parent):t.id}copy(t,e){return super.copy(t,e).then((e=>((e.settings.pages||[]).forEach(((i,s)=>{let n=e.settings.pages[s];"string"==typeof n?e.settings.pages[s]=t[n]:(n.pageId=t[n.pageId],n.tabId=t[n.tabId])})),e.save().then((()=>e)))))}}},42658:(t,e,i)=>{const s=i(11895),n=i(51567),a={dataviewID:null,fieldID:null,submitRules:[]},r={key:"pdfImporter",icon:"file-pdf-o",labelKey:"PDF Importer"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||r)}static common(){return r}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.dataviewID=this.settings.dataviewID??a.dataviewID,this.settings.fieldID=this.settings.fieldID??a.fieldID}toObj(){var t=super.toObj();return t.settings=t.settings??{},t}componentList(){return[]}doSubmitRules(t){const e=this.datacollection.datasource,i=new n;i.formLoad(this),i.fromSettings(this.settings.submitRules),i.objectLoad(e),t&&!Array.isArray(t)&&(t=[t]),t?.forEach((t=>{i.process({data:t,form:this})}))}}},72094:(t,e,i)=>{const s=i(32715),n={key:"page",icon:"file"},a={type:"page",popupWidth:700,popupHeight:450,pageWidth:null,fixedPageWidth:0,pageBackground:"ab-background-default"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||n),this.parent=null}static common(){return n}static defaultValues(){return a}static getPageActionKey(t){return["opstools","AB_"+String(t.application.name).replace(/[^a-z0-9]/gi,""),String(t.name).replace(/[^a-z0-9]/gi,"").toLowerCase(),"view"].join(".")}toObj(){var t=super.toObj();return t.name=this.name,t.myAppID=this.myAppID,"popup"==this.settings.type&&(t.icon="clone"),this.label&&"?label?"!=this.label||(t.label=t.name),t.pageIDs=(this._pages||[]).map((t=>t.id)),t}fromValues(t){super.fromValues(t),"popup"==t.settings.type&&(this.icon="clone"),this.label&&"?label?"!=this.label||(this.label=this.name),this.myAppID=t.myAppID,!this.myAppID&&this.application&&(this.myAppID=this.application.id);var e=[];(t.pageIDs||[]).forEach((t=>{var i=this.AB.definitionByID(t);i?e.push(this.pageNew(i)):this.AB.error(`App[${this.application.name}][${this.application.id}]->Page[${this.name}][${this.id}] referenced an unknown Page[${t}]`)})),this._pages=e,this.settings.columns=this.settings.columns||1,this.settings.gravity=this.settings.gravity||[1]}destroy(){return Promise.resolve().then((()=>{var t=[],e=this.pages();return this._pages=[],e.forEach((e=>{t.push(e.destroy())})),Promise.all(t)})).then((()=>(this.parent||this.application).pageRemove(this))).then((()=>super.destroy()))}save(){return Promise.resolve().then((()=>super.save())).then((()=>(this.parent||this.application).pageInsert(this))).then((()=>this))}pages(t=(()=>!0),e=!1){var i=[];return t&&e?this._pages&&this._pages.length>0&&(i=this._pages.filter(t)).length<1&&this._pages.forEach((s=>{var n=s.pages(t,e);n&&n.length>0&&(i=n)})):i=this._pages.filter(t),i}pageInsert(t){return this.pages((e=>e.id===t.id)).length>0?Promise.resolve():(this._pages.push(t),this.save())}pageNew(t){t.key=n.key;var e=this.application.viewNew(t,this.application,null);return e.parent=this,e}pageRemove(t){var e=this._pages.length;return this._pages=this.pages((function(e){return e.id!=t.id})),this._pages.length<e?this.save():Promise.resolve()}urlPage(){return this.urlPointer()+"/_pages/"}urlPointer(){return this.parent?this.parent.urlPage()+this.id:this.application.urlPage()+this.id}updateIcon(t){return"popup"==t.settings.type?t.icon="clone":t.icon=n.icon,t}clone(t,e){if(null==t){t={};let e=i=>{t[i.id]||(t[i.id]=this.AB.uuid()),i.pages&&i.pages().forEach((t=>e(t))),i.views&&i.views().forEach((t=>e(t)))};e(this)}let i=super.clone(t,e);return i.name=null,i}copy(t,e,i){if(null==t){t={};let e=i=>{t[i.id]||(t[i.id]=this.AB.uuid()),i.pages&&i.pages().forEach((t=>e(t))),i.views&&i.views().forEach((t=>e(t)))};e(this)}return super.copy(t,e,i)}}},57766:(t,e,i)=>{const s=i(11895),n={dataviewID:null,removeMissed:0,totalColumn:0,separateLabel:0,min:0,max:0,height:0},a={key:"pivot",icon:"cube",labelKey:"Pivot"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t),this.settings.removeMissed=JSON.parse(this.settings.removeMissed||n.removeMissed),this.settings.totalColumn=JSON.parse(this.settings.totalColumn||n.totalColumn),this.settings.separateLabel=JSON.parse(this.settings.separateLabel||n.separateLabel),this.settings.min=JSON.parse(this.settings.min||n.min),this.settings.max=JSON.parse(this.settings.max||n.max),this.settings.structure&&"string"==typeof this.settings.structure&&(this.settings.structure=JSON.parse(this.settings.structure)),this.settings.height=parseInt(this.settings.height||n.height)}toObj(){var t=super.toObj();return t.views=[],t.settings=t.settings||{},this.settings.structure&&(t.settings.structure=JSON.stringify(this.settings.structure)),t}componentList(){return[]}}},35154:(t,e,i)=>{const s=i(11895),n={dataviewID:"",dataviewFields:{name:"",text:"",queries:""},datacollectionIDs:[],editMode:0,hideCommonTab:0,hideDataTab:0,hideViewTab:0},a={key:"reportsManager",icon:"wpforms",labelKey:"Reports Manager"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a)}static common(){return a}static defaultValues(){return n}fromValues(t){super.fromValues(t);const e={};Object.keys(n).forEach((t=>{if("object"==typeof n[t]&&!Array.isArray(n[t]))return e[t]={},void Object.keys(n[t]).forEach((i=>{e[t][i]=this.settings[t]?.[i]??n[t][i]}));e[t]=this.settings[t]??n[t]})),this.settings=e}toObj(){var t=super.toObj();return t.settings=t.settings||{},t}componentList(){return[]}}},91899:(t,e,i)=>{const s=i(11895),n={readonly:0,dataviewID:"",dataviewFields:{name:"",start:"",end:"",allDay:"",repeat:"",calendar:"",color:"",sectionID:"",unitID:"",notes:"",originID:""},calendarDataviewID:"",calendarDataviewFields:{title:"",color:"",active:""},timeline:{day:1,week:1,month:1,year:1,agenda:1,timeline:1,units:1},timelineSectionList:"",unitList:"",export:{excel:0,csv:0,pdf:0}},a={key:"scheduler",icon:"calendar",labelKey:"Scheduler"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a),this._object=null}static common(){return a}static defaultValues(){return n}toObj(){this.unTranslate(this,this,["scheduler"]);const t=super.toObj();return t.views=[],t}fromValues(t){super.fromValues(t),this.settings=this.settings||{},this.settings.dataviewFields=this.settings.dataviewFields||{},this.settings.calendarDataviewFields=this.settings.calendarDataviewFields||{},this.settings.timeline=this.settings.timeline||{},this.settings.export=this.settings.export||{};const e={};Object.keys(n).forEach((t=>{if("object"==typeof n[t])return e[t]={},void Object.keys(n[t]).forEach((i=>{e[t][i]=this.settings[t][i]??n[t][i]}));e[t]=this.settings[t]??n[t]})),this.settings=e,this.scheduler=t.scheduler||n.scheduler,this.translate(this,this,["scheduler"])}componentList(){return[]}}},56463:(t,e,i)=>{const s=i(11895),n=i(32715),a={height:0,minWidth:0,stackTabs:0,darkTheme:0,sidebarWidth:200,sidebarPos:"left",iconOnTop:0,hintID:null},r={key:"tab",icon:"window-maximize",labelKey:"Tab"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||r)}static common(){return r}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.height=parseInt(this.settings.height),this.settings.minWidth=parseInt(this.settings.minWidth||0),this.settings.stackTabs=parseInt(this.settings.stackTabs),this.settings.darkTheme=parseInt(this.settings.darkTheme),this.settings.sidebarWidth=parseInt(this.settings.sidebarWidth),this.settings.sidebarPos=this.settings.sidebarPos,this.settings.iconOnTop=parseInt(this.settings.iconOnTop)}addTab(t,e){return this.application.viewNew({key:n.common().key,label:t,tabicon:e},this.application,this).save()}componentList(){return[]}}},55239:(t,e,i)=>{const s=i(11895),n={text:"",height:0,dataviewID:null},a={key:"text",icon:"font",labelKey:"Text"};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||a),this._object=null}static common(){return a}static defaultValues(){return n}toObj(){this.unTranslate(this,this,["text"]);var t=super.toObj();return t.views=[],t}fromValues(t){super.fromValues(t),this.settings=this.settings||{},this.settings.height=parseInt(this.settings.height||n.height),this.text=t.text||n.text,this.translate(this,this,["text"])}componentList(){return[]}get datacollection(){return"dataview"==this.parent?.key?this.AB.datacollectionByID(this.parent.settings.dataviewID):this.AB.datacollectionByID(this.settings.dataviewID)}fieldKey(t){let e=t.label||"";return e=e.replace(/\(/g,"\\("),e=e.replace(/\)/g,"\\)"),e}displayText(t,e){var i=this.text,s=this.datacollection,n=s?.datasource??this._object;if(!n)return(t=>t.replace(/{(.*?)}/g,""))(i);const a=t||s.getCursor()||{};return n.fields().forEach((t=>{let e=this.fieldKey(t);var s=new RegExp("{"+e+"}","g"),n=t.format(a);if("image"==t.key){var r=n;n=t.urlImage(r),!r&&t.settings.defaultImageUrl&&t.settings.useDefaultImage?n=t.urlImage(t.settings.defaultImageUrl):i=i.replace("img","img onerror='this.parentNode.removeChild(this);' ")}i=i.replace(s,n)})),i=i.replace(/{PK}/g,a[n.PK()])}objectLoad(t){this._object=t}}},29436:(t,e,i)=>{const s=i(10902),n={key:"viewwidget",icon:"circle-o-notch ",labelKey:"ab.components.widget"},a={columnSpan:1,rowSpan:1};t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s||n)}static common(){return n}static defaultValues(){return a}fromValues(t){super.fromValues(t),this.settings.columnSpan=parseInt(this.settings.columnSpan||a.columnSpan),this.settings.rowSpan=parseInt(this.settings.rowSpan||a.rowSpan)}}},51827:(t,e,i)=>{i(96486);const s=i(69885),n=i(26239);i(44312),t.exports=class extends s{constructor(t,e){super(t,e),this._handler_page_updated=t=>{var e=this._pages.find((e=>e.id===t.id));e&&(this._pages=this._pages.filter((t=>t.id!=e.id)),this._pages.push(e.refreshInstance()))},this._pages.forEach((t=>{t.on("definition.updated",this._handler_page_updated)}))}static applications(){return console.error("ABApplication.applicationForID(): Depreciated. Who is doing this?"),null}static applicationForID(){var t=new Error("ABApplication.applicationForID(): Depreciated. Who is doing this?");return console.error(t),null}static definitionForID(){var t=new Error("ABApplication.definitionForID(): Depreciated. Who is doing this?");return console.error(t),null}areaKey(){return this.AB.kebabCase(`ab-${this.name}`)}refreshInstance(){var t=this.AB.applicationByID(this.id);return this._pages.forEach((t=>{t.removeListener("definition.updated",this._handler_page_updated)})),t}async _listInsert(t,e){-1!=this[e].indexOf(t.id)||(this[e].push(t.id),await this.save())}async _listRemove(t,e){var i=this[e].length;this[e]=this[e].filter((e=>e!=t.id)),i!=this[e].length&&await this.save()}datacollectionInsert(t){return this._listInsert(t,"datacollectionIDs")}datacollectionRemove(t){return this._listRemove(t,"datacollectionIDs")}objectInsert(t){return this._listInsert(t,"objectIDs")}objectRemove(t){return this._listRemove(t,"objectIDs")}processInsert(t){return this._listInsert(t,"processIDs")}processRemove(t){return this._listRemove(t,"processIDs")}queryInsert(t){return this._listInsert(t,"queryIDs")}queryRemove(t){return this._listRemove(t,"queryIDs")}exportIDs(t){if(!(t.indexOf(this.id)>-1)){t.push(this.id),this.objectsIncluded().forEach((e=>{e.exportIDs(t)})),this.hintsIncluded().forEach((e=>{e.exportIDs(t)})),this.queriesIncluded().forEach((e=>{e.exportIDs(t)})),this.datacollectionIDs.forEach((e=>{if(!(t.indexOf(e)>-1)){var i=this.AB.definitionByID(e);if(i&&(t.push(e),i.settings.datasourceID)){var s=this.AB.objectByID(i.settings.datasourceID);s&&s.exportIDs(t)}}})),this.processes().forEach((e=>{e.exportIDs(t)}));var e=i=>{t.indexOf(i.id)>-1||(t.push(i.id),(i.pageIDs||[]).forEach((t=>{var i=this.AB.definitionByID(t);i&&e(i)})),(i.viewIDs||[]).forEach((t=>{var i=this.AB.definitionByID(t);i&&e(i)})))};(this._pages.map((t=>t.id))||[]).forEach((t=>{var i=this.AB.definitionByID(t);i&&e(i)})),t=this.AB.uniq(t)}}pageNew(t){return new n(t,this)}async pageInsert(t){if(!this._pages.filter((e=>e.id==t.id))[0])return this._pages.push(t),this.save()}async pageRemove(t){var e=this._pages.length;if(this._pages=this.pages((function(e){return e.id!=t.id})),this._pages.length<e)return this.save()}save(){return this.name!=this.label&&(this.name=this.label),super.save()}warningsEval(){super.warningsEval();var t={objectIDs:"object",queryIDs:"query",datacollectionIDs:"datacollection"};Object.keys(t).forEach((e=>{this[e].forEach((i=>{this.AB.definitionByID(i)||this.warningsMessage(` is referencing a missing ${t[e]}`,{appID:this.id,id:i})}))})),0!=this.roleAccess.length||this.isAccessManaged||this.warningsMessage(" has no Role assigned, and is unaccessible.");var e=this.AB.Account.rolesAll().map((t=>t.id));this.roleAccess.forEach((t=>{-1==e.indexOf(t)&&this.warningsMessage(`Specified Role Access [${t}] does not exist in this system`,{role:t})})),this.pages().forEach((t=>{t.warningsEval()}))}warningsAll(){var t=[].concat(this._warnings);return["objectsIncluded","queriesIncluded","datacollectionsIncluded","processes","pages","views"].forEach((e=>{this[e]().forEach((e=>{t=t.concat(e.warningsAll())}))})),t}warningsMessage(t,e={}){let i=`Application[${this.label}]: ${t}`;this._warnings.push({message:i,data:e})}}},8030:(t,e,i)=>{const s=i(73686),n=i(12864);let a=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{constructor(t,e,i){super(),t&&t.AB&&(this.AB=t.AB),i&&(this.AB=i),t||(i._App?t=i._App:(t={uuid:i.Webix.uid(),AB:i,actions:{},config:i.UISettings.config(),custom:null,icons:i.UISettings.icons,Label:a,labels:{add:a("Add"),create:a("Create"),delete:a("Delete"),edit:a("Edit"),export:a("Export"),formName:a("Name"),import:a("Import"),rename:a("Rename"),ok:a("Ok"),cancel:a("Cancel"),save:a("Save"),yes:a("Yes"),no:a("No"),none:a("None"),close:a("Close"),default:a("Default"),defaultPlaceholder:a("Enter default value"),disable:a("Disable"),required:a("Required"),unique:a("Unique"),invalidMessage:{required:a("This field is required")},createErrorMessage:a("System could not create <b>{0}</b>."),createSuccessMessage:a("<b>{0}</b> is created."),updateErrorMessage:a("System could not update <b>{0}</b>."),updateSucessMessage:a("<b>{0}</b> is updated."),deleteErrorMessage:a("System could not delete <b>{0}</b>."),deleteSuccessMessage:a("<b>{0}</b> is deleted."),renameErrorMessage:a("System could not rename <b>{0}</b>."),renameSuccessMessage:a("<b>{0}</b> is renamed."),dataFieldHeaderLabel:a("Section Title"),dataFieldHeaderLabelPlaceholder:a("Section Name"),dataFieldLabel:a("Label"),dataFieldLabelPlaceholder:a("Label"),dataFieldColumnName:a("Field Name"),dataFieldColumnNamePlaceholder:a("Database field name"),dataFieldShowIcon:a("show icon?"),componentDropZone:a("add widgets here")},unique:function(t){return`${t}${this.uuid}`}},i._App=t)),t.custom||(i.custom?t.custom=i.custom:(new n).initComponents(t)),this.App=t,this.idBase=e||"?idbase?"}actions(t){if(console.error("!!! REFACTOR out .actions()"),t)for(var e in t)this.App.actions[e]=t[e]}Label(){return(...t)=>this.AB.Multilingual.label(...t)}unique(t){return this.App.unique(`${this.idBase}_${t}`)}}},11579:(t,e,i)=>{const s=i(88447),n=i(6980);t.exports=class extends n{constructor(t,e){super(t,e),this.setMaxListeners(0)}async save(){return this.id||(this.label=this.label||this.name),await super.save(),this.AB.emit("ab.datacollection.update",{datacollectionId:this.id}),this}isValid(){var t=this.AB.Validation.validator(),e=this.AB.Label();return 0==this.AB.datacollections((t=>t.id!=this.id&&t.name.toLowerCase()==this.name.toLowerCase())).length||t.addError("name",e('Name must be unique ("{0}" already in use)',[this.name])),t}currentUserUsername(){return this.AB.Account.username()}init(){this.initialized||(super.init(),this.AB.on("ab.datacollection.create",(t=>{this.emit("ab.datacollection.create",t)})),this.AB.on("ab.datacollection.update",(t=>{this.emit("ab.datacollection.update",t)})),this.AB.on("ab.datacollection.stale",(t=>{this.emit("ab.datacollection.stale",t)})),this.AB.on("ab.datacollection.delete",(t=>{this.emit("ab.datacollection.delete",t)})),this.bindParentDc())}bindParentDc(){let t=this.datacollectionLink,e=this.fieldLink;if(!this.settings.loadAll&&t&&e){let i=this.__dataCollection;i.bind(t.__dataCollection,e.id),i.define("dataFeed",((t,e)=>{let i=!1;this?.datacollectionLink?.getCursor()?.id==t&&(i=!0),i&&this.reloadData(0,20)}))}}loadData(t,e=20){return super.loadData(t,e).catch((t=>{if(this.hideProgressOfComponents(),this.emit("loadData",{}),t)throw t}))}processIncomingData(t){return t.data&&!Array.isArray(t.data)&&(t.data=[t.data]),super.processIncomingData(t).then((()=>{this.hideProgressOfComponents()}))}attachFlexlayout(t){this.__dataCollection,this.__flexComponentIds.indexOf(t.config.id)>-1||this.__flexComponentIds.push(t.config.id)}bind(t){var e=this.__dataCollection;-1===this.__bindComponentIds.indexOf(t.config.id)&&this.__bindComponentIds.push(t.config.id),$$(t.config.id).data?.find?.({}).length>0||("datatable"==t.config.view||"dataview"==t.config.view||"treetable"==t.config.view||"kanban"==t.config.view?e?(0!=e.count()||this._dataStatus!=this.dataStatusFlag.notInitial&&this._dataStatus!=this.dataStatusFlag.initializing||!t.showProgress||t.showProgress({type:"icon"}),t.define("datafetch",20),t.define("datathrottle",500),"treetable"==t.config.view?this.datasource&&this.datasource.isGroup&&this.__treeCollection?(t.define("data",this.__treeCollection),t.refresh()):(t.define("data",[]),t.parse(e.find({}))):t.data.sync(e),this.settings.loadAll||(t.___AD=t.___AD||{},t.___AD.onDataRequestEvent||(t.___AD.onDataRequestEvent=t.attachEvent("onDataRequest",((i,s)=>(t.showProgress&&t.showProgress({type:"icon"}),e.loadNext(s,i),!1)))))):t.data.unsync():t.bind&&(e?t.bind(e):t.unbind(),t.refresh&&t.refresh()))}unbind(t){t&&(t.detachEvent("onDataRequest"),t.___AD&&(t.___AD.onDataRequestEvent&&delete t.___AD.onDataRequestEvent,t.___AD.onDcLoadData&&(this.off&&this.off("loadData",t.___AD.onDcLoadData),delete t.___AD.onDcLoadData)),t.data&&t.data.unsync&&(t.data.unsync(),t.define("data",[])),t.unbind&&t.unbind(),t.refresh&&t.refresh(),this.__bindComponentIds=(this.__bindComponentIds||[]).filter((e=>e!=t.config.id)))}hideProgressOfComponents(){this.__bindComponentIds.forEach((t=>{$$(t)&&$$(t).hideProgress&&$$(t).hideProgress()}))}_dataCollectionNew(t){let e=new webix.DataCollection({data:t||[]});return this._extendCollection(e),e}_treeCollectionNew(){let t=new webix.TreeCollection;return this._extendCollection(t),t}_extendCollection(t){webix.extend(t,webix.SelectionModel),t.___AD=t.___AD||{},this.settings.loadAll||(t.___AD.onDataRequestEvent||(t.___AD.onDataRequestEvent=t.attachEvent("onDataRequest",((t,e)=>(t<0&&(t=0),this.loadData(t,e),!1)))),t.___AD.onAfterLoadEvent||(t.___AD.onAfterLoadEvent=t.attachEvent("onAfterLoad",(()=>{this.emit("loadData",{})})))),t.addCss=function(){},t.removeCss=function(){},t.render=function(){},t.___AD.onAfterLoad||(t.___AD.onAfterLoad=t.attachEvent("onAfterLoad",(()=>{this.hideProgressOfComponents()})))}parseTreeCollection(t={}){if(!(this.__datasource instanceof s&&this.__datasource.isGroup&&this.__treeCollection))return;let e=(i={},s=null)=>{let n=i.alias;(t.data||[]).forEach((t=>{let e=t[`${n}.uuid`]||t[`${n}.id`];if(!e)return;let i=[],a=t[`${s}.uuid`]||t[`${s}.id`];if(a&&(i=this.__treeCollection.find((t=>t._alias==s&&t._dataId==a)).map((t=>t.id))),this.__treeCollection.find((t=>t._alias==n&&t._dataId==e&&(0==i.length||i.indexOf(t.$parent)>-1)),!0))return;let r={};r._alias=n,r._dataId=e,r._itemId=t.id,Object.keys(t).forEach((e=>{0==e.indexOf(`${n}.`)&&(r[e]=t[e])})),t.translations&&(r.translations=t.translations),i.length>0?i.forEach((t=>{this.__treeCollection.add(r,null,t)})):this.__treeCollection.add(r,null)})),(i.links||[]).forEach((t=>{e(t,n)}))};(this.__bindComponentIds||[]).forEach((t=>{let e=$$(t);e&&e.showProgress&&e.showProgress({type:"icon"}),e.data&&e.data.unsync&&e.data.unsync()})),e(this.__datasource.joins()),(this.__bindComponentIds||[]).forEach((t=>{let e=$$(t);e&&e.hideProgress&&e.hideProgress(),e.define("data",this.__treeCollection)}))}warningsEval(){super.warningsEval(),this.datasource?this.linkDatacollectionID&&(this.AB.datacollectionById(this.linkDatacollectionID)||this.warningsMessage(`can't resolve linkDatacollectionID[${this.linkDatacollectionID}]`)):this.warningsMessage("doesn't have a datasource.")}warningsMessage(t,e={}){let i=`Datacollection[${this.label}]: ${t}`;this._warnings.push({message:i,data:e})}get userScopes(){return this.AB.Account.scopes()}}},65741:(t,e,i)=>{var s=i(40052);t.exports=class extends s{}},73686:(t,e,i)=>{var s=i(17187).EventEmitter;t.exports=class extends s{constructor(){super()}}},92699:(t,e,i)=>{const s=i(12295);let n=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{constructor(t,e){super(t,e)}destroy(t){var e=this.steps(),i=[];e.forEach((t=>{i.push(t.destroy())}));let s=t.hintIDs.indexOf(this.id);s>-1&&(t.hintIDs.splice(s,1),t.save());let a=t.views((t=>t.id==this.settings.view))[0];return a&&(delete a.settings.hintID,a.save()),Promise.all(i).then((()=>new Promise(((t,e)=>{this.toDefinition().destroy().then((()=>{webix.message({text:n("Tutorial Deleted"),type:"success",expire:3e3}),t()})).catch((t=>{e(t)}))}))))}save(){return this.toDefinition().save().then((t=>(this.id||(this.id=t.id),this)))}isValid(){return!0}warningsAll(){}createHintUI(){if($$(this.id))return;let t=[],e=0;if(webix.storage.cookie.get(this.id)?.hide)return;let i=`<label class="dontShow">\n                        <input onclick="webix.storage.cookie.put(this.dataset.hintId, {'hide': this.checked});" data-hint-id="${this.id}" type="checkbox"> \n                        ${n("Don't show this again.")}\n                     </label>`;this.stepIDs.forEach((s=>{e++;let n={};n.id=this._steps[s].id,n.el=this._steps[s].settings.el,n.event=this._steps[s].settings.event,n.title=this._steps[s].name,n.text=this._steps[s].text+i,this.stepIDs[e]&&(n.nextEl=this._steps[this.stepIDs[e]].settings.el,n.nextEl&&(n.hintId=this.id,n.eventEl="button",n.next=function(t){let e=this.nextEl,i=document.querySelector(e);return i&&i.checkVisibility()||document.querySelector(this.el).click(),!1})),n.el&&t.push(n)}));let s={view:"hint",id:this.id,steps:t,on:{onNext:t=>{setTimeout((()=>{const t=document.querySelectorAll("input[data-hint-id='"+this.id+"']");let e=webix.storage.cookie.get(this.id);t.forEach((t=>{t.checked=e?.hide||!1}))}),100)},onPrevious:t=>{setTimeout((()=>{const t=document.querySelectorAll("input[data-hint-id='"+this.id+"']");let e=webix.storage.cookie.get(this.id);t.forEach((t=>{t.checked=e?.hide||!1}))}),100)}}};webix.delay((()=>{webix.ui(s).start()}),null,null,2e3)}}},5437:(t,e,i)=>{const s=i(25739);t.exports=class extends s{save(){return super.save().then((()=>this.object.indexSave(this))).then((()=>this.migrateCreate()))}destroy(){return new Promise(((t,e)=>{this.id?this.migrateDrop().then((()=>super.destroy())).then((()=>this.object.indexRemove(this))).then(t).catch(e):t()}))}warningsEval(){super.warningsEval(),(this._unknownFieldIDs||[]).forEach((t=>{this.warningsMessage(`is referencing an unknown field id[${t}]`)})),0==this.fields.length&&this.warningsMessage("is not referencing any fields")}warningsMessage(t,e={}){let i=`Index[${this.label}]: ${t}`;this._warnings.push({message:i,data:e})}migrateCreate(){return this.AB.Network.post({url:`/definition/migrate/object/${this.object.id}/index/${this.id}`})}migrateDrop(){return this.AB.Network.delete({url:`/definition/migrate/object/${this.object.id}/index/${this.id}`})}}},97069:(t,e,i)=>{var s=i(17243);t.exports=class extends s{constructor(t,e){super(t,e),this._warnings=[]}warnings(){return this._warnings}warningsEval(){this._warnings=[]}warningsAll(){return this.warnings()}languageDefault(){return this.AB.Account.language()||"en"}async destroy(){var t=this.toDefinition();return t.id?t.destroy().catch((e=>{if(e.toString().indexOf("No record found")>-1)return console.log(`ABMLClass.destroy(): could not find record for id[${t.id}]`),void console.log(t);throw e})):Promise.resolve()}async save(){var t=this.toDefinition();t.name=t.name||this.name||this.label||"name";var e=await t.save();this.id||(this.id=e.id)}}},48912:(t,e,i)=>{const s=i(71692);function n(t){t&&t.data&&"READONLY"==t.data.error&&webix.alert({title:"Your action is blocked",ok:"Ok",text:t.data.message||"",type:"alert-warning"})}t.exports=class extends s{constructor(t){super(t),this.handler_create=(...t)=>{this.handler_common("ab.datacollection.create",...t)},this.handler_delete=(...t)=>{this.handler_common("ab.datacollection.update",...t)},this.handler_findAll=(...t)=>{this.handler_common(null,...t)},this.handler_logs=(t,e,i)=>{e?t.reject?.(e):t.resolve?.(i)},this.handler_update=(...t)=>{this.handler_common("ab.datacollection.update",...t)},this.handler_common=(t,e,i,s)=>{if(i)return void e.reject?.(i);let n=this.AB.jobID();console.log(`${n} : normalization begin`);let a=performance.now();t?-1==t.indexOf("delete")&&this.normalizeData(s):this.normalizeData(s.data);let r=performance.now();console.log(`${n} : normalization end:  ${r-a}ms`),e.resolve?.(s),t&&function(t,e,i){"socket"!=t.AB.Network.type()&&t.AB.emit(e,{objectId:t.object.id,data:i})}(this,t,s)}}prepareMultilingualData(t){var e=this.object.multilingualFields(),i=!1;e.length&&e.forEach((function(e){null!=t[e]&&(i=!0)})),i&&(null!=t.translations&&void 0!==t.translations&&""!=t.translations||(t.translations=[]),this.object.unTranslate(t,t,e))}request(t,e){return this.AB.Network[t](e)}batchCreate(t){return t.batch.map((t=>this.prepareMultilingualData(t.data))),new Promise(((e,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,((t,s,n)=>{s?i(s):(this.normalizeData(n),e(n))})),this.AB.Network.post({url:this.object.urlRestBatch(),params:t},{key:s,context:{}}).catch(i)}))}create(t){return this.prepareMultilingualData(t),this.object.fields().forEach((e=>{void 0===t[e.columnName]&&e.defaultValue(t)})),new Promise(((e,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,this.handler_create),this.AB.Network.post({url:this.object.urlRest(),params:t},{key:s,context:{resolve:e,reject:i}}).catch((t=>{n(t),i(t)}))}))}delete(t){return new Promise(((e,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,this.handler_delete),this.AB.Network.delete({url:this.object.urlRestItem(t)},{key:s,context:{resolve:e,reject:i}}).catch((t=>{n(t),i(t)}))}))}async findAll(t){return t=t||{},new Promise(((e,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,this.handler_findAll),this.AB.Network.get({url:this.object.urlRest(),params:t},{key:s,context:{resolve:e,reject:i}}).catch((e=>{e&&e.code&&("ER_PARSE_ERROR"===e.code?this.AB.notify.developer(e,{message:"AppBuilder:ABModel:findAll(): Parse Error with provided condition",condition:t}):this.AB.notify.developer(e,{message:"AppBuilder:ABModel:findAll(): Unknown Error with provided condition",condition:t})),i(e)}))}))}loadInto(t){this._limit&&(t.define("datafetch",this._limit),t.define("datathrottle",250),t.___AD=t.___AD||{},t.___AD.onDataRequestEvent&&t.detachEvent(t.___AD.onDataRequestEvent),t.___AD.onDataRequestEvent=t.attachEvent("onDataRequest",((e,i)=>{var s={where:this._where,sort:this._sort,limit:i,skip:e};return t.showProgress&&t.showProgress({type:"icon"}),this.findAll(s).then((e=>{t.parse(e),t.hideProgress&&t.hideProgress()})),!1})),t.refresh());var e={};this._where&&(e.where=this._where),this._sort&&(e.sort=this._sort),null!=this._limit&&(e.limit=this._limit),null!=this._skip&&(e.skip=this._skip),t.showProgress&&t.showProgress({type:"icon"}),this.findAll(e).then((e=>{t.parse(e),t.hideProgress&&t.hideProgress()})).catch((t=>{console.error("!!!!!",t)}))}logs(t){return new Promise(((e,i)=>{var s=this.AB.jobID();this.AB.Network.once(s,this.handler_logs),this.AB.Network.get({url:this.object.urlRestLog(),params:t},{key:s,context:{resolve:e,reject:i}}).catch((e=>{e&&e.code&&this.AB.notify.developer(e,{context:"AppBuilder:ABModel:logs(): Error",options:t}),i(e)}))}))}limit(t){return this._limit=t,this}skip(t){return this._skip=t,this}update(t,e){for(var i in this.prepareMultilingualData(e),e)null==e[i]&&delete e[i];return new Promise(((i,s)=>{var a=this.AB.jobID();this.AB.Network.once(a,this.handler_update),this.AB.Network.put({url:this.object.urlRestItem(t),params:e},{key:a,context:{resolve:i,reject:s}}).catch((t=>{n(t),s(t)}))}))}batchUpdate({rowIds:t,values:e}){return new Promise(((i,s)=>{var n=this.AB.jobID();this.AB.Network.once(n,((t,e)=>{e?s(e):i(!0)})),this.AB.Network.put({url:this.object.urlRestBatch(),params:{rowIds:t,values:e}},{key:n,context:{}}).catch(s)}))}}},10353:(t,e,i)=>{const s=i(48912);t.exports=class extends s{batchCreate(t){var e=new Error("ABObjectQuery.ABModelAPI.batchCreate() should not be called.");return Promise.reject(e)}create(t){var e=new Error("ABObjectQuery.ABModelAPI.create() should not be called.");return Promise.reject(e)}delete(t){var e=new Error("ABObjectQuery.ABModelAPI.delete() should not be called.");return Promise.reject(e)}update(t,e){var i=new Error("ABObjectQuery.ABModelAPI.update() should not be called.");return Promise.reject(i)}batchUpdate({rowIds:t,values:e}){var i=new Error("ABObjectQuery.ABModelAPI.batchUpdate() should not be called.");return Promise.reject(i)}}},94371:(t,e,i)=>{const s=i(48912);t.exports=class extends s{batchCreate(t){var e=new Error("ABObjectQuery.ABModelQuery.batchCreate() should not be called.");return Promise.reject(e)}create(t){var e=new Error("ABObjectQuery.ABModelQuery.create() should not be called.");return Promise.reject(e)}delete(t){var e=new Error("ABObjectQuery.ABModelQuery.delete() should not be called.");return Promise.reject(e)}update(t,e){var i=new Error("ABObjectQuery.ABModelQuery.update() should not be called.");return Promise.reject(i)}batchUpdate({rowIds:t,values:e}){var i=new Error("ABObjectQuery.ABModelQuery.batchUpdate() should not be called.");return Promise.reject(i)}}},67826:(t,e,i)=>{const s=i(96937),n=i(23847);let a=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{constructor(t,e){super(t,e),this.workspaceViews=new n(t,this,e),this.fields().forEach((t=>{t.on("definition.updated",(t=>{var e=this.AB.definitionByID(t.id);if(e){var i=this.AB.fieldNew(e,this),s=[];this.fields().forEach((e=>{e.id!==t.id?s.push(e):s.push(i)})),this._fields=s}}))})),this._pendingNetworkRequests={},this._handler_object_migrate=(t,e,i)=>{var s=this._pendingNetworkRequests?.[t.uuid];e?s?.reject(e):s?.resolve(i)},this.AB.Network.on("object.migrate",this._handler_object_migrate)}refreshInstance(){var t=this.AB.objectByID(this.id);return this._pendingNetworkRequests&&(this.AB.Network.removeListener("object.migrate",this._handler_object_migrate),t._pendingNetworkRequests=this._pendingNetworkRequests,this._pendingNetworkRequests=null),t}fromValues(t){super.fromValues(t),this.workspaceViews&&this.workspaceViews.fromObj(t)}isValid(){var t=this.AB.Validation.validator();return 0==this.AB.objects((t=>t.id!=this.id&&t.name.toLowerCase()==this.name.toLowerCase())).length||t.addError("name",a('Object name must be unique ("{0}" already in use)',[this.name])),t}isValidData(t){var e=this.AB.Validation.validator();return this.fields().forEach((i=>{t.hasOwnProperty(i.columnName)&&i.isValidData(t,e)})),e}async destroy(){try{if(await(()=>{var t=[];return this.AB.applications().forEach((e=>{t.push(e.objectRemove(this))})),Promise.all(t)})(),await(()=>new Promise((t=>{this.AB.queries((t=>t.objects((t=>t.id==this.id)).length>0)).forEach((t=>{t.disabled=!0})),t()})))(),this.isImported)return Promise.resolve();await this.migrateDrop();var t=[];if("object"==this.type){var e=this.fields();this._fields=[],e.forEach((e=>{t.push(e.destroy())}))}await Promise.all(t),await super.destroy(),this.emit("destroyed")}catch(t){this.AB.notify.developer(t,{context:"ABObject.destroy(): error destroying object."})}}async save(){var t=!1;this.id||(this.label=this.label||this.name,t=!0);try{return await super.save(),t&&await this.migrateCreate(),this}catch(t){throw this.AB.notify.developer(t,{context:"ABObject.save()",obj:this.toObj()}),t}}toObj(){var t=super.toObj();return t.objectWorkspaceViews=this.workspaceViews.toObj(),t}migrateCreate(){return new Promise(((t,e)=>{var i=this.AB.uuid();this._pendingNetworkRequests[i]={resolve:t,reject:e};var s={key:"object.migrate",context:{uuid:i,id:this.id}};this.AB.Network.post({url:`/definition/migrate/object/${this.id}`},s)}))}migrateDrop(){return new Promise(((t,e)=>{var i=this.AB.uuid();this._pendingNetworkRequests[i]={resolve:t,reject:e};var s={key:"object.migrate",context:{uuid:i,id:this.id}};this.AB.Network.delete({url:`/definition/migrate/object/${this.id}`},s)}))}columnResize(t,e){for(var i=null,s=0;s<this._fields.length;s++)if(this._fields[s].columnName==t){i=this._fields[s].id;break}var n=this.AB.localSettings(i);return(n=n||{}).width=e,this.AB.localSettings(i,n)}columnHeaders(t,e,i,s,n){i=i||[],s=s||[];var a=[];return this.fields().forEach((n=>{var r=n.columnHeader({isObjectWorkspace:t,editable:e});e&&(r.validationRules=n.settings.validationRules),r.alias=n.alias||void 0,r.fieldID=n.id,0!=n.settings.width&&(r.width=n.settings.width);var o=this.AB.localSettings(n.id);o&&o.width&&(!r.width||o.width>r.width)&&(r.width=o.width),r.width||(r.adjust=!0),i.indexOf(n.id)>-1?"calculate"==n.key||"formula"==n.key?r.footer={content:"totalColumn",field:n}:r.footer={content:"summColumn"}:s.indexOf(n.id)>-1&&(r.footer={content:"countColumn"}),a.push(r)})),a}customDisplays(t,e,i,s,n){if(!t||!t.getFirstId)return;let a=[];if(i.eachColumn((t=>{let e=this.fields((e=>e.columnName==t))[0];e&&a.push(e)})),null!=s)s.forEach((s=>{let r=t.getItem(s);r&&a.forEach((t=>{let s=i.getItemNode({row:r.id,column:t.columnName});t.customDisplay(r,e,s,{editable:n})}))}));else{let s=t.getFirstId();for(;s;){var r=t.getItem(s);r&&a.forEach((t=>{var s=i.getItemNode({row:r.id,column:t.columnName});t.customDisplay(r,e,s,{editable:n})})),s=t.getNextId(s)}}}displayData(t){if(null==t)return"";var e=this.multilingualFields();this.translate(t,t,e);var i=this.labelFormat||"";if(!i&&this.fields().length>0){var s=this.fields((t=>t.fieldUseAsLabel()))[0];i=s?`{${s.id}}`:`${this.AB.isUUID(t.id)?"ID: ":""}${t.id}`}var n=i.match(/\{[^}]+\}/g);if(n&&n.forEach&&n.forEach((e=>{var s=e.replace("{","").replace("}",""),n=this.fieldByID(s);null!=n&&(i=i.replace(e,n.format(t)||""))})),!i.trim()){let e=this.labelSettings||{};i=e&&e.isNoLabelDisplay?a(e.noLabelText||"[No Label]"):`${this.AB.isUUID(t.id)?"ID: ":""}${t.id}`}return i}currentView(){return this.workspaceViews.getCurrentView()}warningsAll(){var t=super.warningsAll();return this.fields().forEach((e=>{t=t.concat(e.warnings())})),this.indexes().forEach((e=>{t=t.concat(e.warnings())})),t.filter((t=>t))}warningsEval(){super.warningsEval();let t=this.fields();0==t.length&&this.warningsMessage("has no fields"),(this._unknownFieldIDs||[]).forEach((t=>{this.warningsMessage(`is referencing an unknown field id[${t}]`)})),(this._unknownIndex||[]).forEach((t=>{this.warningsMessage(`is referencing an unknown index id[${t}]`)})),t.forEach((t=>{t.warningsEval()})),this.indexes().forEach((t=>{t.warningsEval()}))}warningsMessage(t,e={}){let i=`Object[${this.label}]: ${t}`;this._warnings.push({message:i,data:e})}isUuid(t){return console.error("ABObject.isUuid(): is depreciated.  directly reference AB.Rules.isUUID() instead."),this.AB.isUUID(t)}}},25311:(t,e,i)=>{const s=i(37578);t.exports=class extends s{constructor(t,e){super(t,e)}importFields(t){super.importFields(t),this._fields.forEach((t=>{t.field.columnName=`${t.alias}.${t.field.columnName}`}))}}},54509:(t,e,i)=>{const s=i(67826);t.exports=class extends s{}},41557:(t,e,i)=>{const s=i(67826);t.exports=class extends s{}},88447:(t,e,i)=>{const s=i(40777);var n=null;"undefined"!=typeof io?io.socket.on("ab.query.update",(function(t){n?n.emit("ab.query.update",{queryId:t.queryId,data:t.data}):(console.error("ABObjectQuery:: received io.socket msg before ABFactory is defined"),console.error("TODO: move this to ABFactory!"))})):console.error("TODO: install socket.io client for sails updates."),t.exports=class extends s{constructor(t,e){super(t,e),n||(n=e),this.AB.on("ab.query.update",(t=>{this.id==t.queryId&&this.fromValues(t.data)})),this.conditionScan(this.where)}importFields(t){super.importFields(t),this._fields.forEach((t=>{t.field.columnName=`${t.alias}.${t.field.columnName}`}))}columnResize(t,e,i){let s=this.fields((e=>e.columnName==t))[0];return s?(s.settings.width=e,this.save()):Promise.resolve()}columnHeaders(t,e,i,s,n){var a=super.columnHeaders(t,e,i,s,n);return a.forEach((t=>{let e=this.objectByAlias(t.alias);if(!e)return;let i=e.fieldByID(t.fieldID);if(!i)return;let s="";if(s=Array.isArray(this.joins())?i.object.name:t.alias,t.id=`${s}.${i.columnName}`,this.settings&&this.settings.hidePrefix?t.header=`${i.label||""}`:t.header=`${i.object.label||""}.${i.label||""}`,i.settings&&i.settings.showIcon&&(t.header=`<span class="webix_icon fa fa-${i.fieldIcon()}"></span>${t.header}`),this.isGroup){let e=t.template;t.template=(i,s)=>i[t.id]?s.icon(i,s)+(e?e(i,s,i[t.id]):i[t.id]):""}t.adjust=!0,t.minWidth=220})),a}conditionScan(t){t&&(t.glue?(t.rules||[]).forEach((t=>{this.conditionScan(t)})):(this.fieldByID(t.key)||"this_object"==t.key||this.warningsMessage("condition does not reference one of our fields",{rule:t}),this._conditionCheck||(this._conditionCheck=this.AB.filterComplexNew(`${this.id}_conditionCheck`)),this._conditionCheck.isConditionComplete(t)||this.warningsMessage("incomplete condition definition",{rule:t})))}warningsEval(){super.warningsEval(),this.conditionScan(this.where),this.__missingObject.forEach((t=>{this.warningsMessage(`IMPORT FIELDS: could not resolve object[${t.objectID}] for fieldSetting ${JSON.stringify(t)}`,{fieldInfo:t})})),this.__missingFields.forEach((t=>{this.warningsMessage(`IMPORT FIELDS: Object[${t.objID}] could not find field[${t.fieldID}] for fieldSetting ${JSON.stringify(t.fieldInfo)}`,{object:t.objID,fieldInfo:t.fieldInfo})})),this.__cantFilter.forEach((t=>{this.warningsMessage(`Field[${t.field.id}] referenced in fieldSetting[${JSON.stringify(t.fieldInfo)}] did not pass .canFilterField`,{field:t.field.toObj(),fieldInfo:t.fieldInfo})})),this.__duplicateFields.forEach((t=>{this.warningsMessage(`Field[${t.fieldInfo.fieldID}] referenced in fieldSetting[${JSON.stringify(t.fieldInfo)}] is a duplicate`,{fieldInfo:t.fieldInfo})})),this.__linkProblems.forEach((t=>{this.warningsMessage(t.message,t.data)}))}warningsMessage(t,e={}){let i=`Query[${this.label}]: ${t}`;this._warnings.push({message:i,data:e})}isUuid(t){return console.error("ABObject.isUuid(): is depreciated.  directly reference AB.Rules.isUUID() instead."),this.AB.isUUID(t)}}},68836:(t,e,i)=>{const s=i(99183);t.exports=class extends s{constructor(t,e){super(t,e),this._unknownShapes=[],this.AB.on("ab.abprocess.update",(t=>{this.id==t.objectId&&this.fromValues(t.data)}))}destroy(){var t=this.elements(),e=[];return t.forEach((t=>{e.push(t.destroy())})),Promise.all(e).then((()=>new Promise(((t,e)=>{this.toDefinition().destroy().then((()=>{t()})).then((()=>{console.error("TODO: ABProcess.destroy(): refactor to .emit('destroyed') and let containing Apps self remove.");var t=this.AB.applications().find((t=>t.hasProcess(this)));t.length>0&&t.forEach((t=>{t.processRemove(this)}))})).catch((t=>{e(t)}))}))))}save(){var t=[];return this.elements().forEach((e=>{t.push(e.save())})),Promise.all(t).then((()=>this.toDefinition().save().then((t=>{this.id||(this.id=t.id);var e={};let i=this._elements;Object.keys(this._elements).forEach((t=>{e[this._elements[t].id]=this._elements[t]})),this._elements=e;let s=!1;if(Object.keys(e).forEach((t=>{i[t]||(s=!0)})),s)return this.save()}))))}isValid(){var t=this.AB.Validation.validator();return 0==this.AB.processes((t=>t.name.toLowerCase()==this.name.toLowerCase())).length||t.addError("name",((...t)=>AB.Multilingual.label(...t))('Process name must be unique ("{0}" already in use)',[this.name])),t}elementNewForModelDefinition(t){var e=this.AB.processElementNewForModelDefinition(t,this);return e&&this.elementAdd(e),e}unknownShape(t){this.unknownShapeRemove(t),this._unknownShapes.push(t)}unknownShapeRemove(t){this._unknownShapes=this._unknownShapes.filter((e=>e.id!=t.id))}warningsAll(){var t=[].concat(this._warnings);if(this.elements().forEach((e=>{e.warningsEval(),t=t.concat(e.warnings())})),0==this.elements().length&&t.push({message:"No process Tasks defined.",data:{}}),!this._DOMParser)if(window.DOMParser)this._DOMParser=function(t){return(new window.DOMParser).parseFromString(t,"text/xml")};else{if(void 0===window.ActiveXObject||!new window.ActiveXObject("Microsoft.XMLDOM"))throw new Error("No XML parser found");this._DOMParser=function(t){var e=new window.ActiveXObject("Microsoft.XMLDOM");return e.async="false",e.loadXML(t),e}}let e=this._DOMParser(this.xmlDefinition);return["bpmn2:startEvent","bpmn2:task","bpmn2:endEvent"].forEach((t=>{let i=e.getElementsByTagName(t);for(let t=0;t<i.length;t++)i[t],this.elementForDiagramID(i[t].id)||this.unknownShape(i[t])})),this._unknownShapes.length&&t.push({message:"Generic Tasks still undefined.",data:{}}),t}}},53874:(t,e,i)=>{const s=i(399);t.exports=class extends s{constructor(t,e){super(t,e)}destroy(){return new Promise(((t,e)=>{this.toDefinition().destroy().then((()=>{t()})).catch((t=>{e(t)}))}))}save(){return this.toDefinition().save().then((t=>(this.id||(this.id=t.id),this)))}isValid(){return!0}warningsAll(){}}},44312:(t,e,i)=>{const s=i(15753);t.exports=class extends s{}},26580:t=>{var e=null;t.exports=class{constructor(t){e||(e=t,t.Label&&(e=t.Label))}getSeparateItems(){return[{id:",",value:e("Comma (,)")},{id:"\t",value:e("Tab (&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)")},{id:";",value:e("Semicolon (;)")},{id:"s",value:e("Space ( )")}]}validateFile(t){if(!t||!t.file||!t.file.type)return!1;let e=t.file.type.toLowerCase();return"text/csv"==e||"application/vnd.ms-excel"==e}getDataRows(t,e){return this.validateFile(t)?new Promise(((i,s)=>{let n=new window.FileReader;n.onload=t=>{let s=[];(n.result.split(/\r\n|\n|\r/).filter((t=>t&&t.length>0))||[]).forEach((t=>{let i=[];i=","==e?(t=t.replace(/,,/g,", ,")).match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g):t.split(e),s.push(i.map((t=>this.reformat(t))))})),i(s)},n.readAsText(t.file)})):Promise.reject()}getGuessDataType(t,e){for(var i,s=1;s<=10;s++){var n=t[s];if(!n)break;if(null!=(i=n[e])&&i.length>0)break}return null==i||""==i?"string":0==i||1==i||1==i||0==i||"checked"==i||"unchecked"==i?"boolean":isNaN(i)?Date.parse(i)?"date":i.length>100?"LongText":"string":"number"}reformat(t){return t?t.trim().replace(/"/g,"").replace(/'/g,""):""}}},21021:(t,e,i)=>{const s=i(50353);let n=(...t)=>AB.Multilingual.label(...t);function a(t,e=[]){if(t){if(t.key){const i=e.filter((e=>e.id==t.key))[0];t.field=i?.id,t.condition={type:t.rule,filter:t.value},Array.isArray(t.value)?t.includes=t.value:t.includes=(t.value??"").split(","),"date"!=i?.key&&"datetime"!=i?.key||(t.condition.filter=t.condition.filter?AB.rules.toDate(t.condition.filter):null,t.includes=t.includes.map((t=>AB.rules.toDate(t)))),delete t.key,delete t.rule,delete t.value}t.rules&&t.rules.length&&(t.rules??[]).forEach((t=>{a(t,e)}))}}function r(t,e=[]){if(t){if(t.field){let i=e.filter((e=>e.id==t.field))[0];t.key=i?.id??t.field,t.condition=t.condition??{},t.rule=t.condition.type;let s=t.includes.map((t=>t instanceof Date?t.toISOString():t))??[];t.condition.filter&&(t.condition.filter instanceof Date?s.indexOf(t.condition.filter.toISOString())<0&&s.push(t.condition.filter):s.indexOf(t.condition.filter)<0&&s.push(t.condition.filter)),t.value=s.map((t=>!i||"date"!=i.key&&"datetime"!=i.key?t:i.exportValue(new Date(t)))).join(","),delete t.field,delete t.type,delete t.includes,delete t.condition}t.rules&&t.rules.length&&(t.rules??[]).forEach((t=>{r(t,e)}))}}t.exports=class extends s{constructor(t,e,i={}){super(t=t??"ab_filterComplex",e),this._options=i??{},this._initComplete=!1,this.observing=!1,this.labels={common:(e._App??{}).labels,component:{and:n("And"),or:n("Or"),thisObject:n("This Object"),inQuery:n("In Query"),notInQuery:n("Not In Query"),inQueryField:n("By Query Field"),notInQueryField:n("Not By Query Field"),inQueryFieldQueryPlaceholder:n("Choose a Query"),inQueryFieldFieldPlaceholder:n("Choose a Field"),sameAsUser:n("Same As User"),notSameAsUser:n("Not Same As User"),sameAsField:n("Same As Field"),notSameAsField:n("Not Field"),inDataCollection:n("In Data Collection"),notInDataCollection:n("Not In Data Collection"),containsCondition:n("contains"),notContainsCondition:n("doesn't contain"),isCondition:n("is"),isNotCondition:n("is not"),isEmpty:n("is empty"),isNotEmpty:n("is not empty"),beforeCondition:n("is before"),afterCondition:n("is after"),onOrBeforeCondition:n("is on or before"),onOrAfterCondition:n("is on or after"),beforeCurrentCondition:n("is before current date"),afterCurrentCondition:n("is after current date"),onOrBeforeCurrentCondition:n("is on or before current date"),onOrAfterCurrentCondition:n("is on or after current date"),onLastDaysCondition:n("last ... days"),onNextDaysCondition:n("next ... days"),equalCondition:n(":"),notEqualCondition:n(""),lessThanCondition:n("<"),moreThanCondition:n(">"),lessThanOrEqualCondition:n(""),moreThanOrEqualCondition:n(""),equalListCondition:n("equals"),notEqualListCondition:n("does not equal"),checkedCondition:n("is checked"),notCheckedCondition:n("is not checked"),isCurrentUserCondition:n("is current user"),isNotCurrentUserCondition:n("is not current user"),containsCurrentUserCondition:n("contains current user"),notContainsCurrentUserCondition:n("does not contain current user"),contextDefaultOption:n("choose option"),equalsProcessValue:n("equals process value"),notEqualsProcessValueCondition:n("not equals process value"),inProcessValueCondition:n("in process value"),notInProcessValueCondition:n("not in process value")}};let s=this.ids={popup:this.unique(`${t}_popup`),querybuilder:this.unique(`${t}_querybuilder`),save:this.unique(`${t}_save`)};this.Account.username=this.AB.Account.username(),this._settings.recordRuleFieldOptions=[],this.ui={rows:[{view:"layout",type:"clean",borderless:this._options.borderless??!0,rows:[{id:s.querybuilder,view:"query",data:()=>[],fields:[],disabled:!0,height:this._options.height}]},{id:s.save,view:"button",css:"webix_primary",value:n("Save"),hidden:this._options.isSaveHidden??!1,click:()=>{this.myPopup&&this.myPopup.hide(),this.emit("save",this.getValue())}}]}}init(t){if(this._initComplete)return;super.init(t);const e=$$(this.ids.querybuilder);if(e){if(!this.observing){this.__blockOnChange=!0,e.getState().$observe("value",(t=>{if(this.__blockOnChange)return!1;this.emit("changed",this.getValue())})),this.__blockOnChange=!1;let t=this.condition;this.condition=t,this.observing=!0}this._initComplete=!0}}isValid(t,e=this.condition){let i=()=>!0,s=$$(this.ids.querybuilder);return s?(i=s.getFilterFunction(),i(t)):super.isValid(t,e)}isConditionComplete(t){if(!t)return!1;let e=!0;if(t.glue)(t.rules??[]).forEach((t=>{e=e&&this.isConditionComplete(t)}));else if(t.key&&""!=t.key||(e=!1),t.rule&&""!=t.rule||(e=!1),e)switch(t.rule){case"is_current_user":case"is_not_current_user":case"contain_current_user":case"not_contain_current_user":case"same_as_user":case"not_same_as_user":case"less_current":case"greater_current":case"less_or_equal_current":case"greater_or_equal_current":case"is_empty":case"is_not_empty":break;default:t.value&&""!=t.value||(e=!1)}return e}setValue(t){super.setValue(t),this.condition=t;const e=$$(this.ids.querybuilder);if(e){if(!t)return void e.define("value",{glue:"and",rules:[]});let i=this.AB.cloneDeep(t);a(i,this._Fields),this.__blockOnChange=!0,e.define("value",i),this.__blockOnChange=!1}}getValue(){if($$(this.ids.querybuilder)){let t=this.AB.cloneDeep($$(this.ids.querybuilder).getState().value??{});r(t,this._Fields),this.condition=t}return super.getValue()}fieldsLoad(t=[],e=null){super.fieldsLoad(t,e),this.uiInit()}toShortHand(){return"Add Filters"}uiInit(){this.uiQueryCustomValue();let t=$$(this.ids.querybuilder);if(t){for(;t.config.fields.length>0;)t.config.fields.pop();(this.fieldsToQB()??[]).forEach((e=>{t.config.fields.push(e)})),t.config.fields.length?t.enable():(this.setValue(""),t.disable())}}uiQueryCustomValue(){const t=$$(this.ids.querybuilder);t&&(t.$app.require("jet-views","filter").prototype.CreateFilter=(t,e,i,s,n)=>{let a=this.uiValue(t),r={id:n.config.id,view:"filter",localId:"filter",conditions:s,field:t,mode:e,template:function(s){let n=s[t],a=i??("date"==e?webix.i18n.dateFormatStr:null);return a&&(n=a(n)),n},inputs:a,margin:6};return webix.ui(r,n)})}uiValue(t){let e;if("this_object"==t)return[].concat(this.uiQueryValue("this_object")).concat(this.uiDataCollectionValue("this_object")).concat(this.uiCustomValue("this_object")).concat(this.uiContextValue("this_object","uuid"));let i=(this._Fields??[]).filter((e=>e.id==t))[0];switch(i?.key){case"boolean":e=this.uiBooleanValue(i);break;case"connectObject":e=[].concat(this.uiQueryValue(i)).concat(this.uiUserValue(i)).concat(this.uiDataCollectionValue(i)).concat(this.uiContextValue(i)).concat(this.uiNoneValue());break;case"date":case"datetime":e=["datepicker","daterangepicker"];break;case"list":e=this.uiListValue(i);break;case"user":e=[].concat(this.uiNoneValue()).concat(this.uiUserValue(i));break;case"string":case"LongText":case"email":e=this.uiNoneValue()}const s=`${i?.settings?.linkType}:${i?.settings?.linkViaType}`;return i?.settings?.isCustomFK&&("one:many"==s||"one:one"==s&&i?.settings?.isSource)?e=(e??[]).concat(this.uiTextValue(i)):"connectObject"!=i?.key?e=(e??[]).concat(this.uiTextValue(i)).concat(this.uiQueryFieldValue(i)).concat(this.uiContextValue(i)):t.indexOf("uuid")>-1&&(e=this.uiContextValue(null,t)),this._settings.isRecordRule&&(e=(e??[]).concat(this.uiRecordRuleValue(i))),e=(e??[]).concat(this.uiCustomValue(i)),e}uiNoneValue(){return[{batch:"none",borderless:!0,view:"template",template:""}]}uiBooleanValue(t){return[{batch:"boolean",view:"checkbox"}]}uiTextValue(t){return[{batch:"text",view:"text",on:{onAfterRender:function(){(this.queryView((function(t){return!t.getParentView()}),"parent")??this).$view.style.zIndex=202}}}]}uiQueryValue(t){let e=[],i=this._QueryFields?.filter((e=>e.id==t.id)).length>0;return"this_object"==t&&this._Object?e=this.queries((t=>t.canFilterObject(this._Object))):i&&(e=this.queries((e=>(this._Object?this._Object.id:"")!=e.id&&e.canFilterObject(t.datasourceLink)))),e?.forEach((t=>{e.push({id:t.id,value:t.label})})),[{batch:"query",view:"combo",options:e??[]}]}uiListValue(t){return[{batch:"list",view:"combo",options:t?.settings?.options?.map((function(t){return{id:t.id,value:t.text}}))}]}uiUserValue(t){return[{batch:"user",view:"combo",options:this.AB.Account.userList().map((t=>({id:t.username,value:t.username})))}]}uiDataCollectionValue(t){let e;return e="this_object"==t&&this._Object?this._Object.id:t?.settings?.linkObject,[{batch:"datacollection",view:"combo",options:e?this.AB.datacollections((t=>t?.datasource?.id==e)).map((t=>({id:t.id,value:t.label}))):[]}]}uiQueryFieldValue(t){return[{batch:"queryField",view:"combo",placeholder:this.labels.component.inQueryFieldQueryPlaceholder,options:this.queries((t=>null==this._Object||t.id!=this._Object.id)).map((t=>({id:t.id,value:t.label})))}]}uiRecordRuleValue(t){return[{batch:"recordRule",view:"select",options:this._settings.recordRuleFieldOptions??[]}]}uiContextValue(t,e=null){const i=(this._ProcessFields??[]).filter((i=>{if(!i)return!1;let s=!1;if("this_object"===t)s=this._Object.id===i.object?.id&&!i.field;else switch(t.key){case"boolean":s=["boolean"].includes(i.field?.key);break;case"connectObject":if(s=t.settings.linkObject===(i.field?.object.id??i.object.id),!t.settings.isCustomFK){s=s&&!i.field;break}s=s&&(t.settings.indexField||t.settings.indexField2)===i.field?.id;break;case"date":case"datetime":s=["date","datetime"].includes(i.field?.key);break;case"calculate":case"formula":case"number":s=["calculate","formula","number"].includes(i.field?.key);break;case"string":case"LongText":case"email":case"AutoIndex":case"list":s=["string","LongText","email","AutoIndex","list"].includes(i.field?.key);break;case"user":s=["user"].includes(i.field?.key);break;default:if(i.key){const n=i.key.split(".").pop();s=n===t.id||n===t.key||n===e||i.key===e}}return s})).map((t=>({id:t.key,value:n("context({0})",[t.label])})));return i?[{batch:"context",view:"select",options:[{id:"empty",value:this.labels.component.contextDefaultOption},...i]}]:[]}uiCustomValue(t){return t?((this._customOptions??{})[t.id??t]??{}).values??[]:[]}popUp(...t){const e=Object.assign({},this.condition);if(this.myPopup)this.myPopup.show(...t);else{let i={id:this.ids.popup,view:"popup",height:400,width:800,body:this.ui};$$(this.ids.popup)?$$(this.ids.popup).show(...t):(this.myPopup=webix.ui(i),this.init(this._settings),this._Fields&&this.fieldsLoad(this._Fields,this._Object),e&&this.setValue(e),this.myPopup.show(...t))}}addCustomOption(t,e={}){this._customOptions=this._customOptions??{},this._customOptions[t]=e}}},41688:(t,e,i)=>{const s=i(61584);let n=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{constructor(t,e,i){super(t,e,i),console.error("TODO: Switch RowFilter => FilterComplex");let s=this.ids={component:this.unique(`${e}_rowFilter`),filterForm:this.unique(`${e}_rowFilter_form`),addNewFilter:this.unique(`${e}_rowFilter_addNewFilter`),glue:this.unique(`${e}_rowFilter_glue`),field:this.unique(`${e}_rowFilter_field`),rule:this.unique(`${e}_rowFilter_rule`),inputValue:this.unique(`${e}_rowFilter_inputValue`),queryCombo:this.unique(`${e}_rowFilter_queryCombo`),queryFieldCombo:this.unique(`${e}_rowFilter_queryFieldCombo`),queryFieldComboQuery:this.unique(`${e}_rowFilter_queryFieldComboQuery`),queryFieldComboField:this.unique(`${e}_rowFilter_queryFieldComboField`),fieldMatch:this.unique(`${e}_rowFilter_fieldMatchCombo`),dataCollection:this.unique(`${e}_rowFilter_dataCollection`),listOptions:this.unique(`${e}_rowFilter_listOptions`),datePicker:this.unique(`${e}_rowFilter_datePicker`)};var a;this.queryFieldOptions=[{value:n("By Query Field"),id:"in_query_field"},{value:n("Not In Query"),id:"not_in_query_field"}],this.recordRuleOptions=[],this.recordRuleFieldOptions=[];let r=this._logic||{};r.getFieldList=()=>(this._Fields||[]).map((t=>{let e=t.label;return this._settings.showObjectName&&t.object&&(e=t.object.label+"."+t.label),{id:t.id,value:e,alias:t.alias||void 0}})),r.getFilterUI=()=>{let t=this,e=this.config_settings||{};return{id:"f"+webix.uid(),isolate:!0,cols:[{view:"combo",id:s.glue,width:80,value:e.glue||"and",options:[{value:n("And"),id:"and"},{value:n("Or"),id:"or"}],on:{onChange:function(t,e){r.selectCombineCondition(t)}}},{view:"combo",id:s.field,suggest:{on:{onBeforeShow:function(){this.define("width",400),this.resize()}},data:r.getFieldList()},on:{onChange:function(t){var e=this.getParentView();r.selectField(t,e)}}},{id:s.rule,width:220,cells:[{},{batch:"query",view:"combo",value:"in_query",options:[{value:n("In Query"),id:"in_query"},{value:n("Not In Query"),id:"not_in_query"},{value:n("contains"),id:"contains"},{value:n("doesn't contain"),id:"not_contains"},{value:n("is"),id:"equals"},{value:n("is not"),id:"not_equal"},{value:n("is empty"),id:"is_empty"},{value:n("is not empty"),id:"is_not_empty"},{value:n("Same As User"),id:"same_as_user"},{value:n("Not Same As User"),id:"not_same_as_user"},{value:n("In Data Collection"),id:"in_data_collection"},{value:n("Not In Data Collection"),id:"not_in_data_collection"}].concat(t.recordRuleOptions),on:{onChange:function(t,e){var i=this.getParentView().getParentView();r.onChangeRule(t,i),r.onChange()}}},{batch:"date",view:"combo",value:"less",options:[{value:n("equals"),id:"equals"},{value:n("does not equal"),id:"not_equal"},{value:n("is before"),id:"less"},{value:n("is after"),id:"greater"},{value:n("is on or before"),id:"less_or_equal"},{value:n("is on or after"),id:"greater_or_equal"},{value:n("is before current date"),id:"less_current"},{value:n("is after current date"),id:"greater_current"},{value:n("is on or before current date"),id:"less_or_equal_current"},{value:n("is on or after current date"),id:"greater_or_equal_current"},{value:n("last ... days"),id:"last_days"},{value:n("next ... days"),id:"next_days"}].concat(t.queryFieldOptions).concat(t.recordRuleOptions),on:{onChange:function(t){var e=this.getParentView().getParentView();r.onChangeRule(t,e),r.onChange()}}},{batch:"number",view:"combo",value:"equals",options:[{value:n(":"),id:"equals"},{value:n(""),id:"not_equal"},{value:n("<"),id:"less"},{value:n(">"),id:"greater"},{value:n(""),id:"less_or_equal"},{value:n(""),id:"greater_or_equal"}].concat(t.queryFieldOptions).concat(t.recordRuleOptions),on:{onChange:function(t){var e=this.getParentView().getParentView();r.onChangeRule(t,e),r.onChange()}}},{batch:"list",view:"combo",value:"equals",options:[{value:n("equals"),id:"equals"},{value:n("does not equal"),id:"not_equal"},{value:n("Same As User"),id:"same_as_user"},{value:n("Not Same As User"),id:"not_same_as_user"}].concat(t.queryFieldOptions).concat(t.recordRuleOptions),on:{onChange:function(t,e){var i=this.getParentView().getParentView();r.onChangeRule(t,i),r.onChange()}}},{batch:"boolean",view:"combo",value:"equals",options:[{value:n("equals"),id:"equals"},{value:n("does not equal"),id:"not_equal"}].concat(t.queryFieldOptions).concat(t.recordRuleOptions),on:{onChange:function(t){var e=this.getParentView().getParentView();r.onChangeRule(t,e),r.onChange()}}},{batch:"user",view:"combo",value:"is_current_user",options:[{value:n("is current user"),id:"is_current_user"},{value:n("is not current user"),id:"is_not_current_user"},{value:n("contains current user"),id:"contain_current_user"},{value:n("does not contain current user"),id:"not_contain_current_user"},{value:n("equals"),id:"equals"},{value:n("does not equal"),id:"not_equal"}].concat(t.queryFieldOptions).concat(t.recordRuleOptions),on:{onChange:function(t){var e=this.getParentView().getParentView();r.onChangeRule(t,e),r.onChange()}}},{batch:"string",view:"combo",value:"contains",options:[{value:n("contains"),id:"contains"},{value:n("doesn't contain"),id:"not_contains"},{value:n("is"),id:"equals"},{value:n("is not"),id:"not_equal"}].concat(t.queryFieldOptions).concat(t.recordRuleOptions),on:{onChange:function(t){var e=this.getParentView().getParentView();r.onChangeRule(t,e),r.onChange()}}},{batch:"email",view:"combo",value:"contains",options:[{value:n("contains"),id:"contains"},{value:n("doesn't contain"),id:"not_contains"},{value:n("is"),id:"equals"},{value:n("is not"),id:"not_equal"}].concat(t.queryFieldOptions).concat(t.recordRuleOptions),on:{onChange:function(t){var e=this.getParentView().getParentView();r.onChangeRule(t,e),r.onChange()}}}]},{id:s.inputValue,isolate:!0,cells:[{batch:"empty"},{id:s.queryCombo,batch:"query",view:"combo",options:[],on:{onChange:r.onChange}},{id:s.queryFieldCombo,batch:"queryField",rows:[{id:s.queryFieldComboQuery,view:"combo",options:[],placeholder:n("Choose a Query"),on:{onChange:function(t){var e=this.getParentView().getParentView().getParentView();r.onChangeQueryFieldCombo(t,e),r.onChange()}}},{id:s.queryFieldComboField,view:"combo",options:[],placeholder:n("Choose a Field"),on:{onChange:r.onChange}}]},{id:s.fieldMatch,batch:"fieldMatch",view:"combo",options:[],on:{onChange:r.onChange}},{id:s.dataCollection,batch:"dataCollection",view:"richselect",options:[],on:{onChange:r.onChange}},{batch:"date",id:s.datePicker,view:"datepicker",on:{onChange:function(){r.onChange()}}},{batch:"number",view:"text",validate:webix.rules.isNumber,on:{onTimedKeyPress:function(){this.validate()&&r.onChange()}}},{batch:"list",id:s.listOptions,view:"combo",options:[],on:{onChange:function(){r.onChange()}}},{batch:"boolean",view:"checkbox",on:{onChange:function(){r.onChange()}}},{batch:"user",view:"combo",options:this.AB.Account.userList().map((t=>({id:t.username,value:t.username}))),on:{onChange:function(){r.onChange()}}},{batch:"string",view:"text",on:{onTimedKeyPress:function(){r.onChange()}}},{batch:"email",view:"text",on:{onTimedKeyPress:function(){r.onChange()}}}]},{view:"button",css:"webix_primary",icon:"fa fa-plus",type:"icon",autowidth:!0,click:function(){var t=this.getFormView().index(this.getParentView());r.addNewFilter(t+1)}},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",autowidth:!0,click:function(){var t=this.getParentView();r.removeNewFilter(t)}}]}},r.getAddButtonUI=()=>({view:"button",id:s.addNewFilter,css:"webix_primary",type:"form",label:n("Add a filter"),click:()=>{r.addNewFilter()}}),r.addNewFilter=(t,e)=>{var i,n=r.getFilterUI(),a=$$(s.filterForm);return a&&(i=a.addView(n,t),r.toggleAddNewButton(),e&&r.selectField(e,$$(i),!0)),i},r.removeNewFilter=function(t){$$(s.filterForm).removeView(t),r.toggleAddNewButton(),r.onChange()},r.toggleAddNewButton=function(){$$(s.filterForm)&&($$(s.filterForm).getChildViews().length<1?($$(s.filterForm).hide(),$$(s.addNewFilter).show()):($$(s.filterForm).show(),$$(s.addNewFilter).hide()))},r.selectCombineCondition=(t,e)=>{this.config_settings.glue=t,$$(s.filterForm).getChildViews().forEach((e=>{e.$$&&e.$$(s.glue)&&e.$$(s.glue).setValue(t)})),e||r.onChange()},r.selectField=(t,e,i)=>{if(!this._Fields)return;var n=this._Fields.filter((e=>e.id==t))[0];if(!n)return;a=n.key,"this_object"==n.id?a="query":"LongText"==a||"combined"==a?a="string":"formula"==n.key&&(a="number");var o=this._QueryFields.filter((t=>t.id==n.id)).length>0;o&&(a="query"),e.$$(s.rule).showBatch(a),e.$$(s.inputValue).showBatch(a);let l=[],h=[];if("this_object"==n.id&&this._Object?h=this.queries((t=>t.canFilterObject(this._Object))):o&&(h=this.queries((t=>(this._Object?this._Object.id:"")!=t.id&&t.canFilterObject(n.datasourceLink)))),h.forEach((t=>{l.push({id:t.id,value:t.label})})),e.$$(s.inputValue).$$(s.queryCombo).define("options",l),e.$$(s.inputValue).$$(s.queryCombo).refresh(),"list"==n.key){let t=n.settings.options.map((function(t){return{id:t.id,value:t.text}}));e.$$(s.inputValue).$$(s.listOptions).define("options",t),e.$$(s.inputValue).$$(s.listOptions).refresh()}else"date"==n.key&&(e.$$(s.inputValue).$$(s.datePicker).define("format",n.getFormat()),e.$$(s.inputValue).$$(s.datePicker).refresh());var c=e.$$(s.rule).getActiveId(),d=e.$$(s.rule).queryView({id:c});if(d&&d.getList){let t=(d.getList().config.data||[])[0];t&&d.setValue(t.id)}i||r.onChange()},r.onChangeRule=(t,e,i=!1)=>{switch(t){case"contains":case"not_contains":case"equals":case"not_equal":"query"==a&&e.$$(s.inputValue).showBatch("string");break;case"is_current_user":case"is_not_current_user":case"contain_current_user":case"not_contain_current_user":case"same_as_user":case"not_same_as_user":case"less_current":case"greater_current":case"less_or_equal_current":case"greater_or_equal_current":case"is_empty":case"is_not_empty":e.$$(s.inputValue).showBatch("empty"),r.onChange();break;case"last_days":case"next_days":e.$$(s.inputValue).showBatch("number");break;case"in_query_field":case"not_in_query_field":var n=[];this.queries((t=>null==this._Object||t.id!=this._Object.id)).forEach((t=>{n.push({id:t.id,value:t.label})})),e.$$(s.inputValue).$$(s.queryFieldComboQuery).define("options",n),e.$$(s.inputValue).$$(s.queryFieldComboQuery).refresh(),e.$$(s.inputValue).showBatch("queryField");break;case"same_as_field":case"not_same_as_field":e.$$(s.inputValue).$$(s.fieldMatch).define("options",this.recordRuleFieldOptions),e.$$(s.inputValue).$$(s.fieldMatch).refresh(),e.$$(s.inputValue).showBatch("fieldMatch");break;case"in_data_collection":case"not_in_data_collection":{let t,i=[],n=e.$$(s.field).getValue();if("this_object"==n&&this._Object)t=this._Object.id;else{let e=this._Fields.filter((t=>t.id==n))[0];e&&(t=e.settings.linkObject)}this._Application&&t&&this._Application.datacollections((e=>e.datasource&&e.datasource.id==t)).forEach((t=>{i.push({id:t.id,value:t.label})})),e.$$(s.inputValue).$$(s.dataCollection).define("options",i),e.$$(s.inputValue).$$(s.dataCollection).refresh(),e.$$(s.inputValue).showBatch("dataCollection");break}default:e.$$(s.inputValue).showBatch(a),i&&r.onChange()}},r.onChangeQueryFieldCombo=(t,e)=>{let i=[],n=this.queries((e=>e.id==t))[0];n&&(n.fields((t=>!t.isConnection)).forEach((t=>{i.push({id:t.id,value:t.object.label+"."+t.label})})),e.$$(s.inputValue).$$(s.queryFieldComboField).define("options",i),e.$$(s.inputValue).$$(s.queryFieldComboField).refresh())},r.onChange=()=>(this.__blockOnChange||(r.getValue(),console.warn("convert RowFilter.callback.onChange() to .emit()"),r.callbacks.onChange(),this.emit("change")),!1),r.blockOnChange=()=>{this.__blockOnChange=!0},r.unblockOnChange=()=>{this.__blockOnChange=!1},r.getValue=()=>{let t={glue:"and",rules:[]};var e=$$(s.filterForm);return e&&e.getChildViews().forEach(((e,i)=>{0==i&&(t.glue=e.$$(s.glue).getValue());var n=e.$$(s.field);if(n){var a=n.getValue();if(a){var r,o=e.$$(s.field).getPopup().config.body.data.filter((t=>t.id==a))[0];o&&(r=o.alias||void 0);var l=null,h=e.$$(s.rule).getActiveId(),c=e.$$(s.rule).queryView({id:h});c&&c.getValue&&(l=c.getValue());var d=null,u=e.$$(s.inputValue).getActiveId(),_=e.$$(s.inputValue).queryView({id:u});if(_&&_.getValue)d=_.getValue();else if(_&&_.getChildViews()){var p=[];_.getChildViews().forEach((t=>{p.push($$(t).getValue())})),d=p.join(":")}if(d instanceof Date){let t=this._Fields.filter((t=>t.id==a))[0];d=t?t.exportValue(d):d.toISOString()}t.rules.push({alias:r||void 0,key:a,rule:l,value:d})}}})),this.config_settings=t,this.config_settings},this.ui={id:s.component,rows:[{view:"form",id:s.filterForm,hidden:!0,elements:[]},r.getAddButtonUI()]}}init(t={}){for(var e in super.init(t),this._logic.callbacks)this._logic.callbacks[e]=t[e]||this._logic.callbacks[e];t.showObjectName&&(this._settings.showObjectName=t.showObjectName),t.isRecordRule&&(this.recordRuleOptions=[{value:n("Same As Field"),id:"same_as_field"},{value:n("Not Field"),id:"not_same_as_field"}],this.recordRuleFieldOptions=t.fieldOptions)}setValue(t){t=t||{},super.setValue(t);let e=this.ids,i=this._logic;i.blockOnChange();let s=this.AB.cloneDeep(t);s.rules=s.rules||[];var n=$$(e.filterForm);n&&webix.ui([],n),0==s.rules.length&&i.toggleAddNewButton(),s.rules.forEach((t=>{var n=i.addNewFilter(),a=$$(n);if(null!=a){var r=this._Fields.filter((e=>e.id==t.key))[0];a.$$(e.glue).define("value",s.glue),a.$$(e.glue).refresh(),a.$$(e.field).define("value",t.key),a.$$(e.field).refresh(),i.selectField(t.key,a,!0);var o=a.$$(e.rule).getActiveId(),l=a.$$(e.rule).queryView({id:o});l&&l.setValue&&(l.define("value",t.rule),l.refresh()),a.blockEvent(),i.onChangeRule(t.rule,a),a.unblockEvent();var h=a.$$(e.inputValue).getActiveId(),c=a.$$(e.inputValue).queryView({id:h});if(c&&c.setValue)r&&"date"==r.key&&t.value&&("less"==t.rule||"greater"==t.rule||"less_or_equal"==t.rule||"greater_or_equal"==t.rule)?c.define("value",new Date(t.value)):c.define("value",t.value),c.refresh();else if(c&&c.getChildViews()){let e=(t.value||"").split(":"),s=0;c.getChildViews().forEach((t=>{$$(t).blockEvent(),$$(t).setValue(e[s]),0==s&&i.onChangeQueryFieldCombo(e[s],a),$$(t).unblockEvent(),s++}))}r&&"user"==r.key&&(a.blockEvent(),i.onChangeRule(t.rule,a),a.blockEvent())}})),i.unblockOnChange()}isComplete(){return this._completeConditions||(this._completeConditions=this.AB.filterComplexNew(`${this.ids.component}_iscomplete`)),this._completeConditions.isConditionComplete(this.getValue())}}},82021:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var s=i(32735);const n=i(70704);let a=null;class r extends s.Z{constructor(t,e){super(t,{form:`${t}_rowUpdaterForm`,addNew:`${t}_rowUpdaterAddNew`,field:`${t}_rowUpdaterField`}),this.idBase=t,this._Object=null,this._mockFormWidget=null,this.AB=e,a||(a=(...t)=>this.AB.Multilingual.label(...t))}uiItem(){const t=this;return{rows:[{view:"layout",isolate:!0,cols:[{view:"label",width:40,label:a("Set")},{view:"combo",id:this.ids.field,options:this.getFieldList(!0),on:{onChange:async function(e){const i=this.getParentView();await t.selectField(e,i)}}},{view:"label",width:40,label:a("To")},{view:"segmented",value:"custom",height:40,maxWidth:160,options:[{id:"custom",value:a("Custom")},{id:"process",value:a("Process")}],hidden:null==this._extendedOptions||!this._extendedOptions.length,on:{onChange:function(e){const i=this.getParentView();t.toggleCustomProcessOption(i,"process"==e)}}},{},{hidden:!0},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",autowidth:!0,click:function(){const e=this.getParentView().getParentView();t.removeItem(e)}}]}]}}ui(){return{rows:[{view:"form",id:this.ids.form,hidden:!0,borderless:!0,elements:[]},{view:"button",id:this.ids.addNew,icon:"fa fa-plus",type:"iconButton",label:a("Add field to edit"),click:()=>{this.addItem()}}]}}init(t){const e=$$(this.ids.form);return e&&t.Webix.extend(e,t.Webix.ProgressBar),Promise.resolve()}addItem(t){const e=$$(this.ids.form);if(this.getFieldList(!0).length<1)return;const i=this.uiItem(),s=e.addView(i,t);return this.toggleForm(),s}getFieldList(t){let e=(this._Object.fields()||[]).map((t=>({id:t.id,value:t.label})));return t&&$$(this.ids.form).getChildViews().forEach((t=>{if(!t||!t.$$)return;const i=t.$$(this.ids.field);if(!i)return;const s=i.getValue();s&&(e=e.filter((t=>t.id!=s)))})),e}getValue(){const t=[],e=$$(this.ids.form);return e&&e.getChildViews().forEach((e=>{const i=e.getChildViews()[0];if(!i||!i.$$)return;const s=i.$$(this.ids.field);if(!s)return;const n=s.getValue();if(!n)return;let a=i.getChildViews()[4];a=this._pullInputElement(a);const r=i.getChildViews()[5];if(!a&&!r)return;const o=this._Object.fieldByID(n),l={fieldId:n};if(a&&a.isVisible())if("connectObject"===o.key||"user"===o.key)l.value=o.getValue(a);else if("date"===o.key||"datetime"===o.key)if(1==(a.getChildViews()[0]??a).getValue())l.value="ab-current-date";else{const t=a.getChildViews()[1]??a;l.value=o.getValue(t)}else l.value=o.getValue(a);else r&&r.isVisible()&&(l.isProcessValue=!0,l.value=r.getValue());t.push(l)})),t}objectLoad(t){this._Object=t,this._mockApp=this.AB.applicationNew({}),this._mockFormWidget=new n({settings:{showLabel:!1,labelWidth:0}},this._mockApp),this._mockFormWidget.objectLoad(t),this.setValue(null)}removeItem(t){$$(this.ids.form).removeView(t),this.toggleForm()}async selectField(t,e){const i=this._Object.fieldByID(t);if(!i)return void this.AB.notify.builder(new Error(`could not find field for id[${t}]`),{context:"RowUpdater.selectField() could not find a field",fieldID:t});const s=i.formComponent().newInstance(this._mockApp,this._mockFormWidget).component(this.AB._App,this.idBase),n=e.getChildViews();let r="function"==typeof s.ui?s.ui():s.ui;switch(e.removeView(n[5]),this._extendedOptions?.length?e.addView({view:"richselect",options:this._extendedOptions,hidden:!0},5):e.addView({hidden:!0},5),await this.busy(),i.key){case"connectObject":case"user":r=r.rows[0].rows[0],r.suggest.body.data=(await i.getOptions()).map((t=>({id:i.getRelationValue(t),value:t.text})))??[],"user"===i.key&&r.suggest.body.data.unshift({id:"ab-current-user",value:"ab-current-user"});break;case"date":case"datetime":r={view:"layout",rows:[{view:"checkbox",labelWidth:0,labelRight:a("Current Date/Time"),on:{onChange:function(t){const e=this.getParentView();if(!e)return;const i=e.getChildViews()[1];i&&(t?i.hide():i.show())}}},r]}}e.removeView(n[4]),e.addView(r,4),s.init(),i.customDisplay&&i.customDisplay({},this.AB._App,n[4].$view),this.toggleCustomProcessOption(e,"process"===n[3].getValue()),$$(e).adjust(),e.getFormView().adjust(),this.ready()}setValue(t){const e=$$(this.ids.form);e&&(webix.ui([],e),(t=t||[]).length<1||(t.forEach((async t=>{const e=$$(this.addItem()).getChildViews()[0];e.queryView({view:"segmented"},"self").setValue(t.isProcessValue?"process":"custom");const i=e.$$(this.ids.field);i.define("value",t.fieldId),i.refresh(),await this.selectField(t.fieldId,e);const s=this._Object.fieldByID(t.fieldId);if(!s)return;if(t.isProcessValue)return void e.getChildViews()[5].setValue?.(t.value);let n=e.getChildViews()[4];n=this._pullInputElement(n);const a={};a[s.columnName]=t.value?.value??t.value,s.setValue(n,a),"date"!=s.key&&"datetime"!=s.key||"ab-current-date"!=a[s.columnName]||"checkbox"!=n.config.view||n.setValue(!0)})),this.toggleForm()))}toggleForm(){const t=$$(this.ids.form);if(t){const e=t.getChildViews();e&&e.length?t.show():t.hide(),t.adjust()}}setExtendedOptions(t){this._extendedOptions=t}toggleCustomProcessOption(t,e){const i=t.getChildViews()[4],s=t.getChildViews()[5];e?(i.hide(),s.show()):(i.show(),s.hide())}async busy(){$$(this.ids.addNew).disable();const t=$$(this.ids.form);t&&(t.showProgress||await this.init(this.AB),t.showProgress({type:"icon"}))}ready(){$$(this.ids.addNew).enable(),$$(this.ids.form).hideProgress()}_pullInputElement(t){return!t?.getValue&&t?.getChildViews?t.getChildViews().filter((t=>t.getValue))[0]??t:t}}const o=r},14403:(t,e,i)=>{const s=i(98601),n=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{constructor(t,e,i){super(t,e,i),this.AB.on("ab.abdefinition.update",(t=>{t.id==this.id&&this.emit("definition.updated",this)}))}static editorValues(t){const e={label:t.label,columnName:t.columnName,settings:t};return delete t.label,delete t.columnName,e}addValidation(t,e){this.object.application.App;const i=this.AB.filterComplexNew(`${this.id}_field_validation_rules`);$$(t.filterComplex).addView({view:"form",css:"abValidationForm",cols:[{rows:[{view:"text",name:"invalidMessage",labelWidth:this.AB.UISettings.config().labelWidthLarge,value:e&&e.invalidMessage?e.invalidMessage:"",label:n("Invalid Message")},i.ui]},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",autowidth:!0,click:function(){const e=this.getParentView();$$(t.filterComplex).removeView(e)}}]}),$$(i.ids.save).hide(),i.fieldsLoad(this.object.fields()),e&&e.rules&&i.setValue(e.rules)}isValid(){const t=this.AB.Validation.validator();return 0==this.object.fields((t=>t.id!=this.id&&t.columnName.toLowerCase()==this.columnName.toLowerCase())).length||t.addError("columnName",n("Field columnName must be unique ({0} already used in this Object)",[this.columnName])),t}async destroy(){this.id&&(await this.migrateDrop(),await super.destroy(),await this.object.fieldRemove(this))}async save(){let t=!1;if(this.id||(t=!0),!t&&this.settings.required&&this.settings.default){const t=this.object.model(),e=await t.findAll({where:{glue:"and",rules:[{key:this.id,rule:"is_null"}]}}),i=[];e.data.forEach((e=>{e[this.columnName]||(e[this.columnName]=this.settings.default),i.push(t.update(e.id,e))})),await Promise.all(i)}if(await super.save(),await this.object.fieldAdd(this),!this.isConnection){const e=t?this.migrateCreate():this.migrateUpdate();await e}return this}migrateCreate(){return this.AB.Network.post({url:`/definition/migrate/object/${this.object.id}/field/${this.id}`})}migrateUpdate(){return this.AB.Network.put({url:`/definition/migrate/object/${this.object.id}/field/${this.id}`})}migrateDrop(){return this.AB.Network.delete({url:`/definition/migrate/object/${this.object.id}/field/${this.id}`})}columnHeader(t){t=t||{};const e={id:this.columnName,header:this.label};return t.isObjectWorkspace&&this.settings.showIcon&&(e.header=`<span class="webix_icon fa fa-${this.fieldIcon()}"></span>${e.header}`),e}customDisplay(t,e,i,s){}customEdit(t,e,i){return!0}getValue(t,e){return t.getValue()}setValue(t,e,i){if(!t)return;let s;s=null!=e&&null!=e[this.columnName]||null==i?e&&null!=e[this.columnName]?e[this.columnName]:e:i,t.setValue(s)}formComponent(t){return{common:()=>({key:t}),newInstance:(t,e)=>{t=t??this.AB._mockApp;const i=this.formComponent().common();return i.settings=i.settings||{},i.settings.objectId=this.object.id,i.settings.fieldId=this.id,t.viewNew(i,t,e)}}}detailComponent(){return{common:()=>({icon:"square"}),newInstance:(t,e)=>{t=t??this.AB._mockApp;const i=this.detailComponent().common();return i.settings=i.settings||{},i.settings.objectId=this.object.id,i.settings.fieldId=this.id,t.viewNew(i,t,e)}}}getSettings(){return Object.assign({},this.settings)}warningsMessage(t,e={}){let i=`${this.fieldKey()}[${this.label}]: ${t}`;this._warnings.push({message:i,data:e})}}},79579:(t,e,i)=>{const s=i(96552);t.exports=class extends s{isValid(){return super.isValid()}columnHeader(t){const e=super.columnHeader(t);return e.editor=null,e.css="textCell",e.template=t=>t.$group?"":this.format(t),e}formComponent(){return super.formComponent("fieldreadonly")}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailtext"}),t}}},77280:(t,e,i)=>{const s=i(43104);t.exports=class extends s{constructor(t,e){super(t,e)}isValid(){return super.isValid()}columnHeader(t){t=t||{};const e=super.columnHeader(t);return e.editor="template",e.css="center",e.template=(e,i,s,n)=>e.$group?e[this.columnName]:t.editable?'<div class="ab-boolean-display">'+i.checkbox(e,i,s,n)+"</div>":s?"<div class='webix_icon fa fa-check-square-o'></div>":"<div class='webix_icon fa fa-square-o'></div>",e}formComponent(){return super.formComponent("checkbox")}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailcheckbox"}),t}}},43088:(t,e,i)=>{const s=i(54562);t.exports=class extends s{constructor(t,e){super(t,e)}isValid(){return super.isValid()}columnHeader(t){const e=super.columnHeader(t);return e.editor=null,e.css="textCell",e.template=t=>t.$group?t[this.columnName]:this.format(t),e}formComponent(){return super.formComponent("fieldreadonly")}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailtext"}),t}}},89142:(t,e,i)=>{const s=i(83551);t.exports=class extends s{constructor(t,e){super(t,e)}isValid(){return super.isValid()}columnHeader(t){const e=super.columnHeader(t);return e.editor=null,e.css="textCell",e.template=t=>t.$group?"":this.format(t),e}formComponent(){return super.formComponent("fieldreadonly")}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailtext"}),t}warningsEval(){super.warningsEval(),(this.settings.combinedFields.split(",")||[]).forEach((t=>{this.object.fieldByID(t)||this.warningsMessage(`dependent field[${t}] not found.`,{fieldID:t,combinedFields:this.settings.combinedFields})}))}}},66589:(t,e,i)=>{const s=i(86932);t.exports=class extends s{constructor(t,e,i){super(t,e,i)}async destroy(){if(!this.id)return Promise.resolve();if(await super.destroy(),!this.datasourceLink)return Promise.resolve();const t=this.fieldLink;return t?t.destroy():Promise.resolve()}pullRelationValues(t){let e=[];const i=super.pullRelationValues(t),s=this.datasourceLink;return i&&s&&(Array.isArray(i)?e=i.map((function(t){return t&&(t.text=t.text||s.displayData(t),t.value=t.text),t})):i.id||i.uuid?(e=i,e.text=e.text||s.displayData(e),e.value=e.text):"string"==typeof i&&(e={text:i})),e}columnHeader(t){t=t||{};const e=super.columnHeader(t),i=this;i.AB._App,null==t.filters&&(t.filters={});var s="many"==this.settings.linkType;return e.editor=s?"multiselect":"combo",e.editFormat=t=>this.editFormat(t),e.editParse=t=>this.editParse(t),e.template=e=>{var s=i.pullRelationValues(e),n=[];if(n.push('<div class="badgeContainer">'),s&&Array.isArray(s)&&s.length)s.forEach((t=>{n.push(`<div class='webix_multicombo_value'><span>${t.value}</span>\x3c!-- span data-uuid="${t.id}" class="webix_multicombo_delete" role="button" aria-label="Remove item"></span --\x3e</div>`)})),s.length>1&&n.push(`<span class="webix_badge selectivityBadge">${s.length}</span>`);else{if(!s.value)return"";{let e="";t.editable&&(e='<span class="webix_multicombo_delete clear-combo-value" role="button" aria-label="Remove item"></span>'),n.push(`<div class='webix_multicombo_value'>${e}<span class="ellip">${s.value}</span></div>`)}}return n.push("</div>"),n.join("")},e.suggest={on:{onBeforeShow:function(){i.openOptions(this)}},filter:({value:t},e)=>(t??"").toLowerCase().includes((e??"").toLowerCase())},s&&(e.suggest.view="checksuggest",e.suggest.button=!0),e}openOptions(t){const e=t.getList();"one"!=this.settings.linkViaType&&(e?.find({})??[]).length||(["create","update"].forEach((t=>{this[`_dc_${t}_event`]||(this[`_dc_${t}_event`]=this.AB.on(`ab.datacollection.${t}`,(t=>{this.datasourceLink.id==t.objectId&&e.clearAll()})))})),this.getAndPopulateOptions(t,null,this))}customEdit(t,e){}formComponent(){return super.formComponent("connect")}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailconnect"}),t}getOptions(t,e,i,s){const n=s;return new Promise(((a,r)=>{let o=!1;const l=t=>{t=t.filter((t=>{if(t.text.toLowerCase().includes(e.toLowerCase()))return!0})),o?this.emit("option.data",t):(o=!0,a(t))},h=this.AB.cloneDeep(t||{});if(i=i||[],h.glue||(h.glue="and"),h.rules||(h.rules=[]),e=e||"",!this.settings.linkObject)return[];const c=this.datasourceLink;if(null==c)throw new Error("No linked object");const d=this.fieldLink;if(null==d)throw new Error("No linked column");const u=c.model();"many"==this.settings.linkType&&"one"==this.settings.linkViaType&&1!=s?.config?.showAllOptions?h.rules.push({key:d.id,rule:"is_null"}):"one"==this.settings.linkType&&"one"==this.settings.linkViaType&&1!=s?.config?.showAllOptions&&(1==this.settings.isSource?h.rules.push({key:d.id,rule:"have_no_relation"}):h.rules.push({key:d.id,rule:"is_null"})),this.getStorageID(h),Promise.resolve().then((async()=>!1)).then((async t=>{if(t)return this._options=t,l(this._options);let e=function(){return new Promise(((t,e)=>{t({data:[]})}))};if("one"==this?.settings?.linkViaType&&(this?.linkViaOneValues||n?.config?.value)){let t="";"multicombo"!=n?.config?.view&&"combo"!=n?.config?.view||!this?.linkViaOneValues?n?.config?.value&&(t=Array.isArray(n.config.value)?n?.config?.value.join():n?.config?.value):t=this?.linkViaOneValues;let i={},s=[];i.glue="or",i.rules=[],t.split(",").forEach((t=>{i.rules.push({key:"uuid",rule:"equals",value:t})})),e=function(){return u.findAll({where:i,sort:s,populate:!1})}}try{const t=await Promise.all([u.findAll({where:h,sort:i,populate:!1}),e()]),s=t[1].data.concat(t[0].data);return this._options=s.data||s||[],(this._options||[]).forEach((t=>{t.text=c.displayData(t),t.value=t.text})),l(this._options)}catch(t){throw this.AB.notify.developer(t,{context:"ABFieldConnect:getOptions(): unable to retrieve options from server",field:this.toObj(),where:h}),o=!0,t}}))}))}getStorageID(t){return`${this.id}-${JSON.stringify(t)}`}async clearStorage(t){const e=this.getStorageID(t);await this.AB.Storage.set(e,null)}editFormat(t){if(!t)return"";let e=[];if(Array.isArray(t))t.forEach((t=>{if("object"==typeof t)e.push(t.id);else{let i=this.getItemFromVal(t);i&&i.id?e.push(i.id):e.push(t)}}));else if("object"==typeof t)e.push(t.id);else{let i=this.getItemFromVal(t);i&&i.id?e.push(i.id):e.push(val)}return e.join()}editParse(t){if("many"==this.settings.linkType){if(t){let e=[];return t.split(",").forEach((t=>{e.push(this.getItemFromVal(t))})),e}return[]}return this.getItemFromVal(t)}getAndPopulateOptions(t,e,i,s){const n=t;"one"==this?.settings?.linkViaType&&n.getValue()&&!i.linkViaOneValues&&(i.linkViaOneValues=n.getValue());const a=e?.filters?Object.assign({},e.filters):{glue:"and",rules:[]};if(e?.filterByConnectValues){const t=(e,s,n=0)=>{const a=s.filter((t=>t?.depth===n));return[...e.rules.map((e=>{if(e.glue)return{glue:e.glue,rules:t(e,s,n+1)};const r=a.filter((t=>t.key===e.key&&t.value===e.value))[0];if(!r)return e;const o=r?.filterValue?.config.id?$$(r.filterValue.config.id):null;if(!o)throw Error("Some parent field's view components don't exist");const l=r?.filterValue?o.getValue()??"":"";let h="";return l&&(h=r.filterColumn&&i.object.fieldByID(r.filterValue.config.dataFieldId).getItemFromVal(l)?i.object.fieldByID(r.filterValue.config.dataFieldId).getItemFromVal(l)[r.filterColumn]:l),{key:e.key,rule:"equals",value:h}}))]};a.rules=t(a,e.filterByConnectValues)}const r=t=>{n.$destructed?this.removeListener("option.data",r):this.populateOptions(n,t,i,s,!0)};return this.removeListener("option.data",r).once("option.data",r),new Promise(((t,r)=>{this.getOptions(a,"",e?.sort??"",n).then((e=>{this.populateOptions(n,e,i,s,!0),t(e)}))}))}populateOptions(t,e,i,s,n){null==t||t.$destructed||(t.blockEvent(),t.getList().clearAll(),t.getList().define("data",e),n&&this.populateOptionsDataCy(t,i,s),t.getValue&&t.getValue()&&t.setValue(t.getValue()),t.unblockEvent())}populateOptionsDataCy(t,e,i){if(!t?.$destructed&&t?.getList){if(!t.getPopup)return;var s=t.getPopup();if(!s)return;t.getList().data.each((t=>{if(t){var n=s.$view.querySelector("[webix_l_id='"+t.id+"']");n&&n.setAttribute("data-cy",`${e.key} options ${t.id} ${e.id} ${i?.id}`)}}))}}getItemFromVal(t){let e,i=this._options||[];if(i.length>0){for(let s=0;s<i.length;s++){if(this.indexField&&i[s][this.indexField.object.PK()]==t){e=i[s];break}if(this.indexField2&&i[s][this.indexField2.object.PK()]==t){e=i[s];break}if(i[s].id==t||i[s].value==t||i[s][this.indexField?.columnName??""]==t||i[s][this.indexField2?.columnName??""]==t){e=i[s];break}}return e}return""}getValue(t){if("many"==this.settings.linkType){let e=[];return t.getValue()&&t.getValue().split(",").forEach((i=>{e.push(t.getList().getItem(i))})),e}return t.getValue()?t.getList().getItem(t.getValue()):""}setValue(t,e){if(!t)return;let i=this.pullRelationValues(e);if(t.getList&&0==t.getList().count()){"one"===this.settings.linkType||Array.isArray(i)||(i=[i]);const e=t.getList();e.define("data",i),e.refresh()}t.setValue(Array.isArray(i)?i.map((t=>t.id??t.uuid??t)).join(","):i.id??i.uuid??i)}pullRecordRelationValues(t){var e=[],i=t,s=this.datasourceLink;return i&&s&&(Array.isArray(i)?e=i.map((function(t){return t&&(t.text=t.text||s.displayData(t),t.value=t.text),t})):(i.id||i.uuid)&&((e=i).text=e.text||s.displayData(e),e.value=e.text)),e}warningsEval(){super.warningsEval(),this.fieldLink||this.warningsMessage(`is unable to find linked field[${this.settings.linkColumn}]`,{linkColumn:this.settings.linkColumn}),this.datasourceLink||this.warningsMessage(`is unable to find linked object[${this.settings.linkObject}]`,{linkObject:this.settings.linkObject})}}},90176:(t,e,i)=>{const s=i(96915);t.exports=class extends s{constructor(t,e){super(t,e)}isValid(){return super.isValid()}columnHeader(t){const e=super.columnHeader(t);return e.editor="th"==this.AB.Account?._config?.languageCode?"thaidate":"date",e.editable=!0,e.template=t=>t.$group?t[this.columnName]:this.format(t),e.format=t=>{const e={};return e[this.columnName]=t,this.format(e)},e.editFormat=t=>""==t||null==t?"":this.AB.rules.toDate(t),e}formComponent(){const t=super.formComponent("datepicker");return t.common=()=>({key:"datepicker"}),t}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailtext"}),t}dateToString(t,e){return webix.Date.dateToStr(t)(e)}format(t){if(!window.webixLocale)return super.format(t);const e=this.dataValue(t);if(""==e||null==e)return"";const i=this.AB.rules.toDate(e);return this.settings.dateFormat>=4?webix.i18n.longDateFormatStr(i):webix.i18n.dateFormatStr(i)}}},21747:(t,e,i)=>{const s=i(6926);t.exports=class extends s{constructor(t,e){super(t,e)}columnHeader(t){const e=super.columnHeader(t);return 1==this.settings.dateFormat?e.editor="time":e.editor="th"==this.AB.Account?._config?.languageCode?"thaidatetime":"datetime",e.editable=!0,e.template=t=>t.$group?t[this.columnName]:this.format(t),e.format=t=>{const e={};return e[this.columnName]=t,this.format(e)},e.editFormat=t=>""==t||null==t?"":this.AB.rules.toDate(t),e}formComponent(){const t=super.formComponent("datepicker");return t.common=()=>({key:"datepicker"}),t}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailtext"}),t}format(t){if(!window.webixLocale)return super.format(t);const e=this.dataValue(t);if(""==e||null==e)return"";const i=this.AB.rules.toDate(e),s=this.settings.dateFormat,n=webix.Date.dateToStr(this.getTimeFormat());return s>=4?`${webix.i18n.longDateFormatStr(i)} ${n(i)}`:`${webix.i18n.dateFormatStr(i)} ${n(i)}`}}},39137:(t,e,i)=>{const s=i(6945);t.exports=class extends s{columnHeader(t){const e=super.columnHeader(t);return e.editor="text",e}formComponent(){const t=super.formComponent();return t.common=()=>({key:"textbox",settings:{type:"single"}}),t}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailtext"}),t}}},42597:(t,e,i)=>{const s=i(85019),n=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{constructor(t,e){super(t,e)}isValid(){return super.isValid()}async destroy(){return new Promise(((t,e)=>{this.id?webix.confirm({title:n("Keep Files?"),message:n("Do you want to keep the files referenced by {0}?",[this.label]),callback:async i=>{this.settings.removeExistingData=i?0:1;try{await this.save(),webix.alert({title:"!! TODO !!",text:"Tell a Developer to actually pay attention to this!"}),await super.destroy(),t()}catch(t){e(t)}}}):t()}))}columnHeader(t){t=t||{};const e=super.columnHeader(t);e.editor=!1;const i=t.editable;return e.template=t=>t.$group?this.dataValue(t):['<div class="ab-file-data-field" style="float: left;">','<div class="webix_view ab-file-holder">','<div class="webix_template">',this.fileTemplate(t,i),"</div>","</div>","</div>"].join(""),e}customDisplay(t,e,i,s){if(!i)return;s=s||{};let a=[],r=0;this.settings.limitFileType&&this.settings.fileType&&(a=this.settings.fileType.split(",")),this.settings.limitFileSize&&this.settings.fileSize&&(r=this.settings.fileSize);const o=i.querySelector(".ab-file-holder");if(o){o.innerHTML="";const e=webix.ui({view:"template",container:o,template:this.fileTemplate(t,s.editable),borderless:!0,width:160,height:60});if(webix.extend(e,webix.ProgressBar),!s.editable){const t=o.querySelector(".delete-image");return void(t&&(t.style.display="none"))}const l=this.urlUpload(!0),h=webix.ui({view:"uploader",apiOnly:!0,upload:l,inputName:"file",multiple:!1,on:{onBeforeFileAdd:function(t){i.classList.remove("webix_invalid"),i.classList.remove("webix_invalid_cell");const s=a;if(s&&""!=s){const e=t.type.toLowerCase();if(-1==s.indexOf(e))return webix.message(n("Only [{0}] files are supported",[s.join(", ")])),!1}if(r>0){const e=1e6*r;if(t.size>e)return webix.message(n("Maximum file size is {0}MB",[r])),!1}e.showProgress({type:"icon",delay:2e3})},onFileUpload:async(s,n)=>{e.hideProgress();const a={};if(a[this.columnName]={},a[this.columnName].uuid=n.data.uuid,a[this.columnName].filename=s.name,t.id)try{await this.object.model().update(t.id,a),$$(i)&&$$(i).updateItem&&$$(i).updateItem(t.id,a)}catch(e){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(e,{context:"ABFieldFile.onFileUpload(): Error updating our entry.",row:t,values:a})}this.setValue($$(i),a)},onFileUploadError:(t,i)=>{this.AB.notify.developer(new Error("Error loading file"),{message:"Error loading file",response:i}),e.hideProgress()}}});h.addDropZone(e.$view),i.dataset.uploaderId=h.config.id,i.addEventListener("click",(t=>{t.target.className.indexOf("delete-image")>-1&&(this.deleteFile=!0)}))}}customEdit(t,e,i){if(1==this.deleteFile)delete this.deleteFile,webix.confirm({title:"",text:n("Are you sure you want to remove this file?"),callback:async e=>{if(!!e){const e={};if(e[this.columnName]={},t.id)try{await this.object.model().update(t.id,e),$$(i)&&$$(i).updateItem&&$$(i).updateItem(t.id,e)}catch(s){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(s,{message:"Error updating our entry.",row:t,values:e})}else this.setValue($$(i),e)}}});else{const e=this.dataValue(t);if(!e||!e.uuid){const e=i.dataset.uploaderId,s=$$(e);s&&s.fileDialog&&s.fileDialog({rowid:t.id})}}return!1}formComponent(){return super.formComponent("fieldcustom")}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailcustom"}),t}fileTemplate(t,e){let i="",s="display:none;",a="",r="",o="";const l=this.dataValue(t);return l&&(r=l.uuid,o=l.filename),r&&o&&(i="display:none;",s="",a="/file/"+r),[`<div class="file-data-field-icon" style="text-align: center; height: inherit; display: table-cell; vertical-align: middle; border: 2px dotted #CCC; background: #FFF; border-radius: 10px; font-size: 11px; line-height: 13px; padding: 0 10px; ${i}"><i class="fa fa-file fa-2x" style="opacity: 0.6; font-size: 32px; margin-top: 3px; margin-bottom: 5px;"></i>${e?`<br/>${n("Drag and drop or click here")}`:""}</div>`,`<div class="file-data-field-name" style=" width:100%; height:100%; position:relative; "><a target="_blank" href="${a}">${o||""}</a>${e?`<a style="${s}" class="ab-delete-photo" href="javascript:void(0);"><i class="fa fa-times delete-image"></i></a>`:""}</div>`].join("")}getValue(t,e){const i=t.$view.querySelector(".file-data-field-name"),s=i.querySelector("a");return{uuid:i.getAttribute("file-uuid"),filename:s.innerHTML}}setValue(t,e){if(!t)return;const i=t.$view;if(!i)return;let s=null;e&&(s=this.dataValue(e));const n=i.querySelector(".file-data-field-icon");n&&(n.style.display=s&&s.uuid?"none":"block");const a=i.querySelector(".file-data-field-name");if(a){const t=a.querySelector(".ab-delete-photo");t&&(t.style.display=s&&s.uuid?"block":"none"),a.style.display=s&&s.uuid?"block":"none",s&&s.uuid?a.setAttribute("file-uuid",s.uuid):a.removeAttribute("file-uuid");const e=a.querySelector("a"),i="/file/"+(s?s.uuid:"");e.href=i,e.innerHTML=s?s.filename:""}}urlUpload(t=!0){return`/file/upload/${this.object.id}/${this.id}/${t?"1":"0"}`}urlFile(t){return`/file/${t}`}}},58439:(t,e,i)=>{const s=i(28725);t.exports=class extends s{columnHeader(t){const e=super.columnHeader(t);return e.editor=null,e.css="textCell",e.template=t=>t.$group?t[this.columnName]:this.format(t),e}formComponent(){return super.formComponent("fieldreadonly")}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailtext"}),t}}},70780:(t,e,i)=>{const s=i(84342),n=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{constructor(t,e){super(t,e)}async destroy(){return new Promise(((t,e)=>{this.id?webix.confirm({title:n("Keep Images?"),message:n("Do you want to keep the images referenced by {0}?",[this.label]),callback:async i=>{this.settings.removeExistingData=i?0:1;try{await this.save(),webix.alert({title:"!! TODO !!",text:"ABFieldImage.destroy(): Tell a Developer to actually pay attention to this!"}),await super.destroy(),t()}catch(t){e(t)}}}):t()}))}idCustomContainer(t,e){return e?`${this.columnName.replace(/ /g,"_")}-${e}-image`:`${this.columnName.replace(/ /g,"_")}-${t.id}-image`}columnHeader(t){t=t||{};const e=super.columnHeader(t),i=this;e.editor=!1;let s="100%",n="100%",a="100%",r="100%";if(i.settings.useWidth){e.width=i.settings.imageWidth||100;const t=i.settings.useHeight&&i.settings.imageHeight?i.settings.imageHeight+20:80;s=`${t}px`,a=`${i.settings.imageWidth||100}px`,n=i.settings.useHeight&&i.settings.imageHeight?i.settings.imageHeight:80,n=`${n}px`,r=i.settings.useHeight&&i.settings.imageHeight?i.settings.imageHeight:60,r=`${r}px`}else t.width&&(e.width=t.width||100,a=`${t.width||100}px`,n=t.width,n=`${n}px`,r=t.width,r=`${r}px`);i.settings.useHeight&&i.settings.imageHeight&&"NaN"!=i.settings.imageHeight&&(e.height=i.settings.imageHeight||0,s=parseInt(e.height)+20,s=`${s}px`,n=parseInt(e.height),n=`${n}px`,r=parseInt(e.height),r=`${r}px`);const o=t.editable;return e.template=t=>t.$group?t[this.columnName]:[`<div class="ab-image-data-field" style="float: left; width: ${a}; height: ${s}">`,`<div class="webix_view ab-image-holder" style="width: ${a}; height: ${n}">`,'<div class="webix_template">',this.imageTemplate(t,{editable:o,height:r,width:a}),"</div>","</div>","</div>"].join(""),e}customDisplay(t,e,i,s){if(!i)return;s=s||{};const a=i.querySelector(".ab-image-holder");if(a){a.innerHTML="";let e=0;this.settings.useHeight&&(e=parseInt(this.settings.imageHeight)||e);let r=0;this.settings.useWidth&&(r=parseInt(this.settings.imageWidth)||r),s.height&&(e=s.height),s.width&&(r=s.width);const o=webix.ui({view:"template",css:"ab-image-holder",container:a,template:this.imageTemplate(t,{editable:s.editable,height:e?e+"px":0,width:r?r+"px":0}),borderless:!0,height:e,width:r});if(webix.extend(o,webix.ProgressBar),!s.editable){const t=a.querySelector(".delete-image");return void(t&&(t.style.display="none"))}const l=this.urlUpload(),h=webix.ui({view:"uploader",apiOnly:!0,upload:l,inputName:"file",multiple:!1,on:{onBeforeFileAdd:function(t){i.classList.remove("webix_invalid"),i.classList.remove("webix_invalid_cell");const e=["jpg","jpeg","bmp","png","gif","webp"],s=t.type.toLowerCase();if(-1==e.indexOf(s))return webix.message(n("Only [{0}] images are supported",[e.join(", ")])),!1;o.showProgress({type:"icon",delay:2e3})},onFileUpload:async(e,s)=>{o.hideProgress(),this.showImage(s.data.uuid,i);const n={};if(n[this.columnName]=s.data.uuid,t.id)try{if(await this.object.model().update(t.id,n),$$(i)&&$$(i).getItem&&$$(i).getItem(t.id))$$(i).updateItem(t.id,n);else{const e=document.querySelector(".webix_dtable");$$(e)&&$$(e).getItem(t.id)&&$$(e).updateItem(t.id,n)}}catch(e){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(e,{context:"ABFieldImage.onFileUpload(): model.update(): error updating our entry",field:this,row:t,values:n})}this.setValue($$(i),n)},onFileUploadError:(t,e)=>{this.AB.notify.developer(new Error("Error uploading image"),{context:"ABFieldImage. uploader. onFileUploadError():",field:this,response:e}),o.hideProgress()}}});h.addDropZone(o.$view),i.dataset.uploaderId=h.config.id,"webix_cell"==i.className&&i.addEventListener("click",(t=>{t.target.className.indexOf("delete-image")>-1&&(this.deleteImage=!0)}))}}customEdit(t,e,i,s,a){if(a&&a.target.className.indexOf("delete-image")>-1||this.deleteImage)delete this.deleteImage,t.removeDefaultImage||(t.removeDefaultImage=[]),t.removeDefaultImage[this.columnName]=!0,webix.confirm({title:n("Are you sure you want to remove this image?"),callback:async e=>{if(!!e){const e={};e[this.columnName]="";try{await this.object.model().update(t.id,e),$$(i)&&$$(i).updateItem&&$$(i).updateItem(t.id,e),this.setValue($$(i),e)}catch(s){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(s,{context:"ABFieldImage: customEdit(): Error updating our entry",field:this,row:t,values:e})}}}});else{const e=i.dataset.uploaderId,s=$$(e);s&&s.fileDialog&&s.fileDialog({rowid:t.id})}return!1}formComponent(){return super.formComponent("fieldcustom")}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailimage"}),t}imageTemplate(t,e){(e=e||{}).height=e.height||"100%",e.width=e.width||"100%";let i="",s="display:none;",a="",r="",o=!1;t[this.columnName]&&(r=t[this.columnName]),t.removeDefaultImage&&t.removeDefaultImage[this.columnName]&&(o=t.removeDefaultImage[this.columnName]),r?(i="display:none;",s="",a=`background-image:url('${this.urlImage(r)}');`):this.settings.useDefaultImage&&!o&&(i="display:none;",s="",a=`background-image:url('${this.urlImage(this.settings.defaultImageUrl)}');`);let l=[`<div class="image-data-field-icon" style="${i}">#drag#</div><div class="image-data-field-image" style="${s} width:${e.width}; height:${e.height}; ${a}">#remove#</div>`].join("");return l=l.replace("#drag#",e.editable?`<div>${n("Drag and drop or click here")}</div>`:""),l=l.replace("#remove#",e.editable?`<a style="${s}" class="ab-delete-photo" href="javascript:void(0);"><i class="fa fa-times delete-image"></i></a>`:""),l}showImage(t,e){const i=e.querySelector(".ab-image-holder");if(i){i.querySelector(".image-data-field-icon").style.display="none";const e=i.querySelector(".image-data-field-image");e.style.display="",e.style.backgroundImage=`url('${this.urlImage(t)}')`,e.setAttribute("image-uuid",t)}}getValue(t,e){return t.$view.querySelector(".image-data-field-image").getAttribute("image-uuid")}setValue(t,e){if(!t)return;const i=t.$view;if(!i)return;let s=null;e&&(s=this.dataValue(e));const n=i.querySelector(".image-data-field-icon");n&&(n.style.display=s?"none":"");const a=i.querySelector(".image-data-field-image");if(a){const t=a.querySelector(".ab-delete-photo");t&&(t.style.display=s?"block":"none"),a.style.display=s?"block":"none",s?(a.style.backgroundImage=`url('${this.urlImage(s)}')`,a.setAttribute("image-uuid",s)):a.removeAttribute("image-uuid")}}toBase64(t){return new Promise(((e,i)=>{if(!t[this.columnName])return e(null);const s=new Image;s.crossOrigin="Anonymous",s.onerror=function(t){i(t)},s.onload=function(){const t=document.createElement("canvas");t.width=s.width,t.height=s.height,t.getContext("2d").drawImage(s,0,0);const i={data:t.toDataURL(),width:s.width,height:s.height};e(i)},s.src=this.urlImage(t[this.columnName])}))}urlImage(t){return`/file/${t}`}urlUpload(t=!0){return`/file/upload/${this.object.id}/${this.id}/${t?"1":"0"}`}}},31797:(t,e,i)=>{const s=i(76611);t.exports=class extends s{columnHeader(t){const e=super.columnHeader(t);return e.editor="text",e.css="textCell",e.template=()=>"",e}formComponent(){const t=super.formComponent();return t.common=()=>({key:"json",settings:{type:"string"}}),t}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailtext"}),t}setValue(t,e){super.setValue(t,e,""),t.config.value=e[this.columnName]}}},69319:(t,e,i)=>{const s=i(73291);t.exports=class extends s{constructor(t,e){super(t,e)}save(){return super.save().then((()=>{if(this.pendingDeletions.length){const t=this.object.model();if(1==this.settings.isMultiple)return new Promise(((e,i)=>{let s=0,n=0;t.findAll({}).then((i=>{(i=i.data||i).forEach((i=>{if(Array.isArray(i[this.columnName])){let a=i[this.columnName].filter((t=>-1==this.pendingDeletions.indexOf(t.id)));if(a.length!=i[this.columnName].length){n++,0==a.length&&(a="");const r={};r[this.columnName]=a,t.update(i.id,r).then((()=>{s++,s>=n&&e()}))}}})),0==n&&e()})).catch(i)}));{const e={};return e[this.columnName]=this.pendingDeletions,new Promise(((i,s)=>{let n=0;t.findAll(e).then((e=>{e=e.data||e;const s={};s[this.columnName]="",e.forEach((a=>{t.update(a.id,s).then((()=>{n++,n>=e.length&&i()}))})),0==e.length&&i()})).catch(s)}))}}}))}isValid(){return super.isValid()}columnHeader(t){t=t||{};const e=super.columnHeader(t);return this.AB._App,t.editable&&((...t)=>{AB.Multilingual.label(...t)})("Select item"),t.editable&&this.settings.required,e.editFormat=t=>this.editFormat(t),e.editParse=t=>this.editParse(t),e.template=e=>{let i=e[this.columnName];if(null==i)return"";this.settings.isMultiple&&(i=function(t,e={}){let i=[];return null!=e[t.columnName]&&(i=e[t.columnName],"string"==typeof i&&(i=JSON.parse(i)),t.settings&&(i=(t.settings.options||[]).filter((t=>(i||[]).filter((e=>(t.id||t)==(e.id||e))).length>0)))),i}(this,e));var s=[];s.push('<div class="badgeContainer">');let n="",a="";if(i&&Array.isArray(i)&&i.length)i.forEach((t=>{this.settings.hasColors&&t.hex&&(n="hascustomcolor",a=`background: ${t.hex};`),t.text&&s.push(`<div style="${a}" class='webix_multicombo_value ${n}'><span>${t.text}</span>\x3c!-- span data-uuid="${t.id}" class="webix_multicombo_delete" role="button" aria-label="Remove item"></span --\x3e</div>`)})),i.length>1&&s.push(`<span class="webix_badge selectivityBadge">${i.length}</span>`);else{if(!i)return"";{let e=i;if("string"==typeof i&&(e=this.getItemFromVal(i)),!e)return"";if(this.settings.hasColors&&e.hex&&(n="hascustomcolor",a=`background: ${e.hex};`),e.text){let i="";t.editable&&!this.settings.required&&(i='<span class="webix_multicombo_delete clear-combo-value" role="button" aria-label="Remove item"></span>'),s.push(`<div style="${a}" class='webix_multicombo_value ${n}'>${i}<span class="ellip">${e.text}</span></div>`)}}}return s.push("</div>"),s.join("")},e.editor=this.settings.isMultiple?"multiselect":"combo",e.suggest={button:!0,data:this.settings.options.map((function(t){return{id:t.id,value:t.text,hex:t.hex}}))},this.settings.isMultiple&&(e.suggest.view="checksuggest"),e}customDisplay(t,e,i,s){if(i&&(s=s||{},i.querySelector)){var n=i.querySelector(".selectivity-single-selected-item-remove");n&&n.addEventListener("click",(e=>{e.stopPropagation();var s={};s[this.columnName]="",this.object.model().update(t.id,s).then((()=>{$$(i)?.updateItem?.(t.id,s)})).catch((e=>{i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(e,{message:"Error updating our entry.",row:t,values:"",field:this.toObj()})}))}))}}formComponent(){const t=super.formComponent();return t.common=()=>({key:this.settings.isMultiple?"selectmultiple":"selectsingle",settings:{options:this.settings.options.map((function(t){return{id:t.id,value:t.text,hex:t.hex}}))}}),t}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:(this.settings.isMultiple,"detailtext")}),t}editFormat(t){if(!t)return"";let e=[];if(Array.isArray(t))t.forEach((t=>{if("object"==typeof t)e.push(t.id);else{let i=this.getItemFromVal(t);e.push(i.id)}}));else if("object"==typeof t)e.push(t.id);else{let i=this.getItemFromVal(t);i&&i.id&&e.push(i.id)}return e.join()}editParse(t){if(this.settings.isMultiple){let e=[];return t.split(",").forEach((t=>{e.push(this.getItemFromVal(t))})),e}return t}getItemFromVal(t){let e,i=this.options();return i.length>1?(i.forEach((i=>{if(i.id==t)return e=i,!1})),e):""}getValue(t,e){return this.editParse(t.getValue())}getSelectedOptions(t,e={}){let i=[];return null!=e[this.columnName]?i=e[this.columnName]:e&&(Array.isArray(e)?i=e:i.push(e)),i.length&&("string"==typeof i&&(i=JSON.parse(i)),this.settings&&(i=(this.settings.options||[]).filter((t=>(i||[]).filter((e=>(t.id||t)==(e.id||e))).length>0)))),i}setValue(t,e){t&&(this.settings.isMultiple||super.setValue(t,e))}}},74384:(t,e,i)=>{const s=i(37143);t.exports=class extends s{constructor(t,e){super(t,e)}isValid(){return super.isValid()}columnHeader(t){const e=super.columnHeader(t);return e.editor="text",e.template=(t,e,i,s,n)=>(i||"").toString().replace(/[<]/g,"&lt;"),e}formComponent(){const t=super.formComponent();return t.common=()=>({key:"textbox",settings:{type:"multiple"}}),t}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailtext"}),t}setValue(t,e){super.setValue(t,e,"")}}},41812:(t,e,i)=>{const s=i(49671);let n=!1;t.exports=class extends s{constructor(t,e){n||(webix.editors.number=webix.extend({},webix.editors.text),n=!0),super(t,e)}columnHeader(t){const e=super.columnHeader(t);return e.editor="number",e.format=t=>{const e={};return e[this.columnName]=t,this.format(e)},e}formComponent(){return super.formComponent("numberbox")}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailtext"}),t}}},87038:(t,e,i)=>{const s=i(14403),n={allowClear:!0,removeOnly:!1,readOnly:!1,showDropdown:!0,placeholder:"",multiple:!1},a={key:"selectivity"};t.exports=class extends s{constructor(t,e,i=a){super(t,e,i)}static defaults(){return{key:"selectivity",icon:"bars",menuName:"",description:""}}selectivityRender(t,e,i,s){if(null==t)return;const a=e.dataCy||"";t.setAttribute("data-cy",a),e=e||{};for(const t in n)null===e[t]?e[t]=null:e[t]=e[t]||n[t];if(e.multiple&&e.items&&e.data&&e.data.length?(e.data.forEach((function(t){e.items.map((function(e){e.id==t.id&&(t.hex=e.hex)}))})),e.data=this.prepareData(e.data,e.multiple)):null==e.data||""==e.data?e.data=this.prepareData([],e.multiple):e.data=this.prepareData(e.data,e.multiple),e.field=this.id,null!=t.selectivity)return void t.selectivity.setOptions(e);let r;if(e.element=t,e.multiple?(e.isUsers?e.templates={multipleSelectedItem:function(t){return`<span class="selectivity-multiple-selected-item ${t.highlighted?" highlighted":""}"\n\t\t\t\t\t\t\t\tstyle="background-color: #eee !important; color: #666 !important; box-shadow: inset 0px 1px 1px #333;"\n\t\t\t\t\t\t\t\tdata-item-id="${t.uuid}" data-field-id="${e.field}">\n\t\t\t\t\t\t\t\t<i class="fa fa-user" style="color: #666; opacity: 0.6;"></i> \n                        ${e.additionalText?e.additionalText(t):""}\n\t\t\t\t\t\t\t\t${e.isLabelHidden?"":t.text}\n\t\t\t\t\t\t\t\t${t.removable?' <a class="selectivity-multiple-selected-item-remove" style="color: #333;"><i class="fa fa-remove"></i></a>':""}\n\t\t\t\t\t\t\t</span>`}}:e.templates={multipleSelectedItem:function(t){return`<span class="selectivity-multiple-selected-item ${t.highlighted?" highlighted":""}"\n\t\t\t\t\t\t\t\tstyle="background-color: ${t.hex} !important;"\n\t\t\t\t\t\t\t\tdata-item-id="${t.uuid}" data-field-id="${e.field}">\n                        ${e.editPage?' <a class="selectivity-multiple-selected-item-edit"><i class="fa fa-edit"></i></a>':""}\n                        ${e.additionalText?e.additionalText(t):""}\n                        ${e.isLabelHidden?"":t.text}\n                        ${t.removable?' <a class="selectivity-multiple-selected-item-remove"><i class="fa fa-remove"></i></a>':""}\n\t\t\t\t\t\t\t</span>`}},r=new Selectivity.Inputs.Multiple(e),t.selectivity=r,this.selectivitySetBadge(t,i,s)):(e.templates={singleSelectedItem:function(t){return`<span class="selectivity-single-selected-item" data-item-id="${t.uuid}" data-field-id="${e.field}">\n\t\t\t\t\t\t\t${e.editPage?'<a class="selectivity-single-selected-item-edit"><i class="fa fa-edit"></i></a>':""}\n                     ${e.additionalText?e.additionalText(t):""}\n                     ${e.isLabelHidden?"":t.text}\n                     ${t.removable?'<a class="selectivity-single-selected-item-remove"><i class="fa fa-remove"></i></a>':""}\n\t\t\t\t\t\t</span>`}},r=new Selectivity.Inputs.Single(e),t.selectivity=r),e.editPage){const e=()=>{const t=this,e=document.querySelectorAll(".selectivity-single-selected-item-edit, .selectivity-multiple-selected-item-edit");for(let i=0;i<e.length;i++){const s=e[i];s&&!s.__hasClickEvent&&(s.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault();const i=this.parentElement;if(!i)return;const s=i.getAttribute("data-item-id");if(!s)return;const n=i.getAttribute("data-field-id");if(!n)return;const a=t.object.fieldByID(n);a&&a.emit("editPage",s)}),!0),s.__hasClickEvent=!0)}};setTimeout((()=>{e(),t.addEventListener("change",(()=>{e()}))}),500)}if(e.readOnly){const e=t.getElementsByClassName("selectivity-caret");for(let t=0;t<e.length;t++){const i=e[t];i&&i.parentNode.removeChild(i)}}this.selectivitySettings=e}selectivityGet(t){return t&&t.selectivity?this.selectivitySettings&&this.selectivitySettings.multiple?t.selectivity.getData()||[]:t.selectivity.getData()||null:this.selectivitySettings&&this.selectivitySettings.multiple?[]:null}selectivitySet(t,e){t&&t.selectivity&&(e=this.prepareData(e,t.selectivity.options.multiple),Array.isArray(e)&&e[0]||e&&e.id?t.selectivity.setData(e):t.selectivity.clear())}selectivityDestroy(t){t&&t.selectivity&&(t.selectivity.destroy(),delete t.selectivity)}prepareData(t,e=!0){if(!t&&e)return[];if(e&&t&&Array.isArray(t)&&0==t.length)return[];if(!e&&t&&Array.isArray(t)&&0==t.length)return null;if(!t&&!e)return null;if("string"==typeof t&&t.length>0)try{t=JSON.parse(t)}catch(e){t={id:t,text:t}}return!e&&Array.isArray(t)?t=t[0]:e&&!Array.isArray(t)&&(t=[t]),e?t.forEach((t=>{!t.id&&t.uuid&&(t.id=t.uuid)})):!t.id&&t.uuid&&(t.id=t.uuid),null==t&&e&&(t=[]),t}selectivitySetBadge(t){if(t.clientHeight&&t.clientHeight-t.parentElement.clientHeight>5){let e=0,i=[];if(t&&t.selectivity&&(i=t.selectivity.getValue()||[]),e=i.length,e>1){const i=t.querySelector(".webix_badge.selectivityBadge");if(null!=i)i.innerHTML=e;else{const i=document.createElement("A");i.href="javascript:void(0);";const s=document.createElement("SPAN"),n=document.createTextNode(e);s.classList.add("webix_badge","selectivityBadge"),s.appendChild(n),i.appendChild(s),t.appendChild(i)}}}}}},98134:(t,e,i)=>{const s=i(36756);t.exports=class extends s{columnHeader(t){const e=super.columnHeader(t);return e.editor="text",e.css="textCell",e.template=(t,e,i)=>t.$group?"":(i||"").toString().replace(/[<]/g,"&lt;"),e}defaultValue(t){t[this.columnName]||this.settings.default&&(this.settings.default.indexOf("{uuid}")>=0?t[this.columnName]=this.AB.uuid():t[this.columnName]=this.settings.default)}isValidData(t,e){if(super.isValidData(t,e),t&&t[this.columnName]){const i=this.constructor.defaults().MAX_CHAR_LENGTH;if(t[this.columnName].length>i){const t=this.AB.Label();e.addError(this.columnName,t("should NOT be longer than {0} characters",[i]))}}}get isMultilingual(){return 1==this.settings.supportMultilingual}formComponent(){const t=super.formComponent();return t.common=()=>({key:"textbox",settings:{type:"single"}}),t}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailtext"}),t}setValue(t,e){super.setValue(t,e,"")}}},27238:(t,e,i)=>{const s=i(18585);t.exports=class extends s{columnHeader(t){const e=super.columnHeader(t);return e.editor=null,e.css="textCell",e.template=t=>t.$group?"":this.format(t),e}customDisplay(){}formComponent(){return null}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailtext"}),t}}},60779:(t,e,i)=>{const s=i(98630),n=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{idCustomContainer(t){return`${this.columnName.replace(/ /g,"_")}-${t.id}-tree`}columnHeader(t){t=t||{};const e=super.columnHeader(t),i=this;let s="",a="";t.isForm&&(s=" form-entry",a="<span style='color: #CCC; padding: 0 5px;'>"+n("Select items")+"</span>");const r=t.width;return e.template=t=>{if(t.$group)return t[i.columnName];const e=[];let n=this.AB.cloneDeep(i.settings.options);n=new webix.TreeCollection({data:n});let o=t;null!=t[i.columnName]&&(o=t[i.columnName]),n.data.each((function(t){if(void 0!==o.indexOf&&-1!=o.indexOf(t.id)){let i="",s=t.id;for(;this.getParentId(s);)n.data.each((function(t){n.data.getParentId(s)==t.id&&(i=t.text+": "+i)})),s=this.getParentId(s);i+=t.text,e.push(i)}}));let l="";return l+="<div class='list-data-values'>",0==e.length?l+=a:e.forEach((function(t){l+='<span class="selectivity-multiple-selected-item rendered" style="background-color:#4CAF50 !important;">'+t+"</span>"})),l+="</div>",r?'<div style="margin-left: '+r+'px;" class="list-data-values'+s+'">'+l+"</div>":'<div class="list-data-values'+s+'">'+l+"</div>"},e}customDisplay(t,e,i,s){if(!i)return;const a=this;if((s=s||{}).isForm){if(!t||0==t.length)return void(i.innerHTML="<div class='list-data-values form-entry'><span style='color: #CCC; padding: 0 5px;'>"+n("Select items")+"</span></div>");const e=[];s=this.AB.cloneDeep(a.settings.options),s=new webix.TreeCollection({data:s});let r=t;null!=t[a.columnName]&&(r=t[a.columnName]),s.data.each((function(t){if(void 0!==r.indexOf&&-1!=r.indexOf(t.id)){let i="",n=t.id;for(;this.getParentId(n);)s.data.each((function(t){s.data.getParentId(n)==t.id&&(i=t.text+": "+i)})),n=this.getParentId(n);i+=t.text,e.push(i)}}));const o="#4CAF50";let l="";l+="<div class='list-data-values form-entry'>",e.forEach((function(t){l+='<span class="selectivity-multiple-selected-item rendered" style="background-color:'+o+' !important;">'+t+"</span>"})),l+="</div>",i.innerHTML=l}a.setBadge(i,e,t)}customEdit(t,e,i,s){const n=e.unique(this.idCustomContainer(t)),a=`${n}-popup`,r=`${n}-tree`,o=$$(i),l=this,h=s;let c={},d=!0;function u(t,e){c=function(t,e){let i={};return void 0!==t&&void 0!==t.columnName&&void 0!==e[t.columnName]&&(i=e[t.columnName]),i}(t,e);const i=$$(r);i.blockEvent();const s=t.AB.cloneDeep(t.settings.options);i.clearAll(),i.parse(s),i.refresh(),i.uncheckAll(),i.openAll(),null!=c&&c.length&&c.forEach((function(t){i.exists(t)&&(i.checkItem(t),i.getItemNode(t).classList.add("selected"))})),i.unblockEvent()}return $$(a)?($$(a).show(),u(this,t)):webix.ui({id:a,view:"popup",width:500,height:400,on:{onShow:()=>{1==d&&u(this,t),d=!1}},body:{id:r,view:"tree",css:"ab-data-tree",template:function(t,e){return"<label>"+e.checkbox(t,e)+"&nbsp;"+t.text+"</label>"},on:{onItemCheck:async function(e,s,n){const a=this.getItemNode(e),c=this;if(1==s?a.classList.add("selected"):a.classList.remove("selected"),this.getParentId(e)){c.blockEvent();let t=e;for(;this.getParentId(t);)t=this.getParentId(t),t!=e&&c.uncheckItem(t);this.data.eachSubItem(t,(function(t){t.id!=e&&c.uncheckItem(t.id)})),c.unblockEvent()}else c.blockEvent(),this.data.eachSubItem(e,(function(t){t.id!=e&&c.uncheckItem(t.id)})),c.unblockEvent();const d={};if(d[l.columnName]=$$(r).getChecked(),t.id){0==d[l.columnName].length&&(d[l.columnName]="");try{await l.object.model().update(t.id,d),o&&o.updateItem&&o.updateItem(t.id,d)}catch(e){i.classList.add("webix_invalid"),i.classList.add("webix_invalid_cell"),this.AB.notify.developer(e,{message:"Error updating our entry.",row:t,values:d})}}else{const t={};t[l.columnName]=$$(r).getChecked(),l.setValue($$(h.ui.id),t)}}}}}).show(i,{x:-7}),!1}setBadge(t,e){const i=this;if((t=t.querySelector(".list-data-values")).scrollHeight-t.parentElement.clientHeight>5){let s=0;if(s=e[i.columnName]&&e[i.columnName].length?e[i.columnName].length:0,s>1){const e=t.querySelector(".webix_badge.selectivityBadge");if(null!=e)e.innerHTML=s;else{const e=document.createElement("A");e.href="javascript:void(0);",e.addEventListener("click",(function(t){t.stopPropagation()}));const i=document.createElement("SPAN"),n=document.createTextNode(s);i.classList.add("webix_badge","selectivityBadge"),i.appendChild(n),e.appendChild(i),t.appendChild(e)}}}}formComponent(){return super.formComponent("formtree")}detailComponent(){const t=super.detailComponent();return t.common=()=>({key:"detailtree"}),t}getValue(t,e){let i={};return i=t.getValues(),i}setValue(t,e){if(!t)return!1;const i=e[this.columnName]||[];t.setValues(i);const s=t.$view.querySelector(".list-data-values");if(!s)return!1;this.customDisplay(i,this.App,s,{editable:!0,isForm:!0}),setTimeout((function(){let e=33;s.scrollHeight>33&&(e=s.scrollHeight),t.config.height=e+5,t.resize()}),200)}}},29333:(t,e,i)=>{const s=i(86932),n=i(18665);t.exports=class extends n{constructor(t,e,i){super(t,e,i)}async save(){if(null==this.id){const t=this.AB.objectUser(),e=n.defaults();this.settings.linkObject=t.id,this.settings.isCustomFK=1,this.settings.isMultiple?(this.settings.indexField2=e.USERNAME_FIELD_ID,this.settings.linkType="many",this.settings.linkViaType="many",this.settings.isSource=1):(this.settings.indexField=e.USERNAME_FIELD_ID,this.settings.linkType="one",this.settings.linkViaType="many",this.settings.isSource=1);const i=t.fieldNew({key:s.defaults().key,columnName:`${this.object.name}_${this.label}`,label:this.object.label,settings:{showIcon:this.settings.showIcon,linkObject:this.object.id,linkType:this.settings.linkViaType,linkViaType:this.settings.linkType,isCustomFK:this.settings.isCustomFK,indexField:this.settings.indexField,indexField2:this.settings.indexField2,isSource:0}});let a=await this.toDefinition().save();this.id=a.id,i.settings.linkColumn=this.id;let r=await i.toDefinition().save();return i.id=r.id,this.settings.linkColumn=i.id,await this.toDefinition().save(),await this.object.fieldAdd(this),await t.fieldAdd(i),await this.migrateCreate(),await i.migrateCreate(),this}return super.save()}columnHeader(t){return t=this.setDisplayOptions(t),super.columnHeader(t)}setDisplayOptions(t){return(t=t||{}).editable=null==this.settings.editable||this.settings.editable,t.isLabelHidden=null!=this.settings.isShowUsername&&!this.settings.isShowUsername,t.additionalText=t=>this.settings.isShowProfileImage?t.image_id?`<img src='/file/${t.image_id}' style='border-radius:100%; object-fit: cover; margin: 0 5px 0 -10px;' width='28' height='28' />`:'<i style="opacity: 0.6;" class="fa fa-user"></i> ':"",t}defaultValue(t){this.settings.isCurrentUser&&(this.settings.isMultiple?t[this.columnName]=[{id:this.AB.Account.username(),text:this.AB.Account.username()}]:t[this.columnName]=this.AB.Account.username())}getValue(t){let e=super.getValue(t);return e&&("string"==typeof e?e=e.replace(/ab-current-user/g,this.AB.Account.username()):Array.isArray(e)&&(e=e.map((t=>(t.username??t.uuid??t.id??t)?.replace(/ab-current-user/g,this.AB.Account.username()))))),e}setValue(t,e){let i=e[this.columnName];"ab-current-user"==i&&(i=this.AB.Account.username()),e[this.columnName]=i,super.setValue(t,e)}getUsers(){return this.AB.Account.userList().map((t=>{const e={id:t.username,image:t.image_id};return this.settings.isMultiple?e.text=t.username:e.value=t.username,e}))}}},30144:(t,e,i)=>{var s=i(62418);t.exports=class extends s{transferParticipantWhereToMe(t){var e=this.process.elementForDiagramID(t);e&&!this.stashed&&e.stashed&&["stashed","useRole","role","useAccount","account"].forEach((t=>{var i=this[t];this[t]=e[t],e[t]=i}))}fromElement(t){this.diagramID=t.id||this.diagramID,t.children&&t.children.length>0?t.parent&&"bpmn:Participant"==t.parent.type&&this.transferParticipantWhereToMe(t.parent.id):t.parent&&t.parent.children&&t.parent.children.length>0&&t.parent.children.forEach((e=>{if("bpmn:Lane"!=e.type&&e.businessObject.lanes&&e.businessObject.lanes.length>0&&e.businessObject.lanes.find((t=>t.id==this.diagramID))){this.transferParticipantWhereToMe(t.parent.id);var i=this.process.elementForDiagramID(e.id);i&&i.setLane(this)}})),this.onChange(t)}onChange(t){t.businessObject.name&&""!=t.businessObject.name&&(this.label=t.businessObject.name)}}},67692:(t,e,i)=>{var s=i(52957);t.exports=class extends s{fromElement(t){this.diagramID=t.id||this.diagramID,this.onChange(t)}onChange(t){if(t.businessObject.name&&""!=t.businessObject.name&&(this.label=t.businessObject.name),t.children){var e=[];t.children.forEach((t=>{"bpmn:Lane"==t.type&&e.push(t.id)})),this.laneIDs=e}}diagramProperties(){return[{id:this.diagramID,def:{name:this.name}}]}}},21073:(t,e,i)=>{const s=i(19929);t.exports=class extends s{destroy(){return super.destroy().then((()=>this.process.elementRemove(this)))}isValid(){return!0}findLane(t,e){t?t.lanes&&t.lanes.length>0?e(null,t.lanes[0]):"bpmn:Participant"==t.$type?e(null,t):(t=t.$parent,this.findLane(t,e)):e(null,null)}setLane(t){this.laneDiagramID=t.diagramID}fromElement(t){this.diagramID=t.id||this.diagramID,this.onChange(t)}onChange(t){t.businessObject.name&&""!=t.businessObject.name&&(this.label=t.businessObject.name);var e=t.businessObject;this.findLane(e,((e,i)=>{i?this.laneDiagramID=i.id:t.parent&&"bpmn:Participant"==t.parent.type?this.laneDiagramID=t.parent.id:this.laneDiagramID=null}))}diagramProperties(){const t=this.warnings();return[{id:this.diagramID,def:{name:this.name},warn:t.length?t:null}]}propertiesShow(t){var e={id:t,view:"label",label:"this task has not implement properties yet..."};webix.ui(e,$$(t)),$$(t).show()}propertiesStash(t){}property(t){if($$(t))return $$(t).getValue()}switchTo(t,e){this.process.elementRemove(this),this.process.elementAdd(t),t.propertiesShow(e),this.emit("switchTo",t)}warningsEval(){super.warningsEval(),this.onProcessReady(),this.isEndTask()||this.process.connectionsOutgoing(this.diagramID).length<1&&this.warningMessage("should have another task after this one")}warningMessage(t,e={}){let i=`${this.defaults.key}[${this.label?this.label:this.name}]: ${t}`;this._warnings.push({message:i,data:e})}}},88556:(t,e,i)=>{const s=i(15197);t.exports=class extends s{}},19036:(t,e,i)=>{const s=i(32889);t.exports=class extends s{diagramProperties(){var t=super.diagramProperties();return this.process.connectionsOutgoing(this.diagramID).forEach((e=>{t.push({id:e.id,def:{name:this.conditions[e.id]?.label??""}})})),t}warningsEval(){super.warningsEval();const t=this.process.connectionsOutgoing(this.diagramID);t.length<2&&this.warningMessage("should have multiple outgoing connections");let e=0;t.forEach((t=>{0==(this.conditions[t.id]?.filterValue.rules?.length??0)&&e++})),e>1&&this.warningMessage("should not have more than 1 unfiltered connection.")}}},18872:(t,e,i)=>{const s=i(52399);t.exports=class extends s{warningsEval(){super.warningsEval(),this.subject||this.warningMessage("is missing a subject"),this.message||this.warningMessage("is missing a message"),this.verifySetting("to"),this.verifySetting("from"),this.verifyNextLane("to"),"0"==this.from&&(this.myLane()||this.warningMessage("can not resolve the lane participant for [.from] field.")),this.verifyRoleAccount("to","toUsers"),this.verifyRoleAccount("from","fromUsers")}verifySetting(t){""==this[t]&&this.warningMessage(`does not have a [${t}] setting.`)}verifyNextLane(t){if("0"===this[t]){let e=this.process.connectionNextTask(this),i=!0;e.forEach((t=>{t.myLane()||(i=!1)})),i&&0!=e.length||this.warningMessage(`can not resolve next lane participant for [${t}] field.`)}}verifyRoleAccount(t,e){"1"==this[t]&&this[e]&&(this[e].useRole&&0==this[e].role.length&&this.warningMessage(`can not resolve [${t}] Role setting.`),this[e].useAccount&&0==this[e].account.length&&this.warningMessage(`can not resolve [${t}] Account setting.`))}}},95187:(t,e,i)=>{const s=i(69376);t.exports=class extends s{}},92845:(t,e,i)=>{const s=i(7912);let n=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{propertyIDs(t){return{name:`${t}_name`,processBatchValue:`${t}_processBatchValue`,objectBatch:`${t}_objectBatch`,fieldBatchEntries:`${t}_fieldBatchEntries`,fieldBatchFinancialPeriod:`${t}_fieldBatchFinancialPeriod`,objectJE:`${t}_objectJE`,fieldJEAccount:`${t}_fieldJEAccount`,fieldJERC:`${t}_fieldJERC`,fieldJEStatus:`${t}_fieldJEStatus`,fieldJEStatusComplete:`${t}_fieldJEStatusComplete`,objectBR:`${t}_objectBR`,fieldBRFinancialPeriod:`${t}_fieldBRFinancialPeriod`,fieldBRAccount:`${t}_fieldBRAccount`,fieldBRRC:`${t}_fieldBRRC`,fieldBREntries:`${t}_fieldBREntries`}}propertiesShow(t){var e=this.propertyIDs(t),i=[{id:0,value:n("Select a Process Value")}];(this.process.processDataFields(this)||[]).forEach((t=>{i.push({id:t.key,value:t.label})}));var s=this.AB.objects().map((t=>({id:t.id,value:t.label||t.name,object:t})));s.unshift({id:0,value:n("Select an Object")});var a={id:0,value:n("Select a Field")};function r(t){var e=[a];if(t){var i=s.find((e=>e.id==t));i&&i.object&&i.object.fields().forEach((t=>{e.push({id:t.id,value:t.label,field:t})}))}return e}function o(t,e,i){t.forEach((t=>{var i=$$(t);i&&(i.define("options",e),i.refresh(),i.show())}))}var l=r(this.objectBatch),h=[e.fieldBatchEntries,e.fieldBatchFinancialPeriod],c=r(this.objectJE),d=[e.fieldJEAccount,e.fieldJERC,e.fieldJEStatus];function u(t){var e=[{id:0,value:n("Select the Complete Value")}];return t&&t.options&&t.options().forEach((t=>{e.push({id:t.id,value:t.text})})),e}function _(t){var i,n,a=$$(e.objectJE).getValue(),r=s.find((t=>t.id==a));if(r&&r.object){var o=r.object.fieldByID(t);o&&o.options&&(i=p=u(o),(n=$$(e.fieldJEStatusComplete))&&(n.define("options",i),n.refresh(),n.show()))}}var p=u(),f=r(this.objectBR),g=[e.fieldBRFinancialPeriod,e.fieldBRAccount,e.fieldBRRC,e.fieldBREntries],m={id:t,view:"form",elements:[{id:e.name,view:"text",label:n("Name"),name:"name",value:this.name},{id:e.processBatchValue,view:"select",label:n("Process Batch Value"),value:this.processBatchValue,name:"processBatchValue",options:i},{id:e.objectBatch,view:"select",label:n("Batch Object"),value:this.objectBatch,name:"objectBatch",options:s,on:{onChange(t,e){t!=e&&(l=r(t),o(h,l))}}},{id:e.fieldBatchEntries,view:"select",label:n("Batch->JE[]"),value:this.fieldBatchEntries,name:"fieldBatchEntries",options:l,hidden:!0},{id:e.fieldBatchFinancialPeriod,view:"select",label:n("Batch->FinancialPeriod"),value:this.fieldBatchFinancialPeriod,name:"fieldBatchFinancialPeriod",options:l,hidden:!0},{id:e.objectJE,view:"select",label:n("Journal Entry Object"),value:this.objectJE,name:"objectJE",options:s,on:{onChange(t,e){t!=e&&(c=r(t),o(d,c))}}},{id:e.fieldJEAccount,view:"select",label:n("JE->Account"),value:this.fieldJEAccount,name:"fieldJEAccount",options:c,hidden:!0},{id:e.fieldJERC,view:"select",label:n("JE->RC"),value:this.fieldJERC,name:"fieldJERC",options:c,hidden:!0},{id:e.fieldJEStatus,view:"select",label:n("JE->Status"),value:this.fieldJEStatus,name:"fieldJEStatus",options:c,hidden:!0,on:{onChange(t,e){t!=e&&_(t)}}},{id:e.fieldJEStatusComplete,view:"select",label:n("JE->Status->Complete"),value:this.fieldJEStatusComplete,name:"fieldJEStatusComplete",options:p,hidden:!0},{id:e.objectBR,view:"select",label:n("Balance Record"),value:this.objectBR,name:"objectBR",options:s,on:{onChange(t,e){t!=e&&(f=r(t),o(g,f))}}},{id:e.fieldBRFinancialPeriod,view:"select",label:n("BR->FP"),value:this.fieldBRFinancialPeriod,name:"fieldBRFinancialPeriod",options:f,hidden:!0},{id:e.fieldBRAccount,view:"select",label:n("BR->Account"),value:this.fieldBRAccount,name:"fieldBRAccount",options:f,hidden:!0},{id:e.fieldBRRC,view:"select",label:n("BR->RC"),value:this.fieldBRRC,name:"fieldBRRC",options:f,hidden:!0},{id:e.fieldBREntries,view:"select",label:n("BR->Entries"),value:this.fieldBREntries,name:"fieldBREntries",options:f,hidden:!0}]};webix.ui(m,$$(t)),this.objectBatch&&0!=this.objectBatch&&o(h,l),this.objectJE&&0!=this.objectJE&&o(d,c),this.fieldJEStatus&&_(this.fieldJEStatus),this.objectBR&&0!=this.objectBR&&o(g,f),$$(t).show()}propertiesStash(t){var e=this.propertyIDs(t);this.name=this.property(e.name),this.defaults.settings.forEach((t=>{this[t]=this.property(e[t])}))}}},80346:(t,e,i)=>{const s=i(20939);let n=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{propertyIDs(t){return{name:`${t}_name`,processFPValue:`${t}_processFPValue`,objectFP:`${t}_objectFP`,objectGL:`${t}_objectGL`,objectAcc:`${t}_objectAcc`,fieldFPStart:`${t}_fieldFPStart`,fieldFPOpen:`${t}_fieldFPOpen`,fieldFPStatus:`${t}_fieldFPStatus`,fieldFPActive:`${t}_fieldFPActive`,fieldGLStarting:`${t}_fieldGLStarting`,fieldGLRunning:`${t}_fieldGLRunning`,fieldGLAccount:`${t}_fieldGLAccount`,fieldGLRc:`${t}_fieldGLRc`,fieldGLDebit:`${t}fieldGLDebit`,fieldGLCredit:`${t}_fieldGLCredit`,fieldAccType:`${t}_fieldAccType`,fieldAccAsset:`${t}_fieldAccAsset`,fieldAccExpense:`${t}_fieldAccExpense`,fieldAccLiabilities:`${t}_fieldAccLiabilities`,fieldAccEquity:`${t}_fieldAccEquity`,fieldAccIncome:`${t}_fieldAccIncome`}}propertiesShow(t){var e=this.propertyIDs(t),i=[{id:0,value:n("Select a Process Value")}];(this.process.processDataFields(this)||[]).forEach((t=>{i.push({id:t.key,value:t.label})}));var s=this.AB.objects().map((t=>({id:t.id,value:t.label||t.name,object:t})));s.unshift({id:0,value:n("Select an Object")});let a=t=>{let e=[{id:0,value:n("Select a Field")}];if(t){var i=s.find((e=>e.id==t));i&&i.object&&i.object.fields().forEach((t=>{e.push({id:t.id,value:t.label,field:t})}))}return e},r=t=>{let e=[],i=this.AB.objectByID(this.objectFP);if(!i)return e;let s=i.fieldByID(t);return s&&s.settings&&s.settings.options?(e=(s.settings.options||[]).map((t=>({id:t.id,value:t.text}))),e):e},o=(t,e)=>{let i=[],s=this.AB.objectByID(t);if(!s)return i;let n=s.fieldByID(e);return n&&n.settings&&n.settings.options?(i=(n.settings.options||[]).map((t=>({id:t.id,value:t.text}))),i):i},l=a(this.objectFP),h=a(this.objectGL),c=a(this.objectAcc),d=r(this.fieldFPStatus),u=o(this.objectAcc,this.fieldAccType);var _={id:t,view:"form",elementsConfig:{labelWidth:200},elements:[{id:e.name,view:"text",label:n("Name"),name:"name",value:this.name},{id:e.processFPValue,view:"select",label:n("Process Fiscal Period Value"),value:this.processFPValue,name:"processFPValue",options:i},{id:e.objectFP,view:"select",label:n("FP Object"),value:this.objectFP,name:"objectFP",options:s,on:{onChange(t,i){t!=i&&(l=a(t),(t=>{[e.fieldFPStart,e.fieldFPOpen,e.fieldFPStatus].forEach((e=>{$$(e).define("options",t),$$(e).refresh()}))})(l))}}},{id:e.objectGL,view:"select",label:n("GL Object"),value:this.objectGL,name:"objectGL",options:s,on:{onChange(t,i){t!=i&&(h=a(t),(t=>{[e.fieldGLRunning,e.fieldGLAccount,e.fieldGLRc,e.fieldGLDebit,e.fieldGLCredit].forEach((e=>{$$(e).define("options",t),$$(e).refresh()}))})(h))}}},{id:e.objectAcc,view:"select",label:n("Account Object"),value:this.objectAcc,name:"objectAcc",options:s,on:{onChange(t,i){t!=i&&(c=a(t),(t=>{$$(e.fieldAccType).define("options",t),$$(e.fieldAccType).refresh()})(c))}}},{id:e.fieldFPStart,view:"select",label:n("FP -> Start"),value:this.fieldFPStart,name:"fieldFPStart",options:l},{id:e.fieldFPOpen,view:"select",label:n("FP -> Open"),value:this.fieldFPOpen,name:"fieldFPOpen",options:l},{id:e.fieldFPStatus,view:"select",label:n("FP -> Status"),value:this.fieldFPStatus,name:"fieldFPStatus",options:l,on:{onChange(t,i){var s;t!=i&&(d=r(t),s=d,$$(e.fieldFPActive).define("options",s),$$(e.fieldFPActive).refresh())}}},{id:e.fieldFPActive,view:"select",label:n("FP -> Active"),value:this.fieldFPActive,name:"fieldFPActive",options:d},{id:e.fieldGLStarting,view:"select",label:n("GL -> Starting BL"),value:this.fieldGLStarting,name:"fieldGLStarting",options:h},{id:e.fieldGLRunning,view:"select",label:n("GL -> Running BL"),value:this.fieldGLRunning,name:"fieldGLRunning",options:h},{id:e.fieldGLAccount,view:"select",label:n("GL -> Account"),value:this.fieldGLAccount,name:"fieldGLAccount",options:h},{id:e.fieldGLRc,view:"select",label:n("GL -> RC"),value:this.fieldGLRc,name:"fieldGLRc",options:h},{id:e.fieldGLDebit,view:"select",label:n("GL -> Debit"),value:this.fieldGLDebit,name:"fieldGLDebit",options:h},{id:e.fieldGLCredit,view:"select",label:n("GL -> Credit"),value:this.fieldGLCredit,name:"fieldGLCredit",options:h},{id:e.fieldAccType,view:"select",label:n("Acc -> Type"),value:this.fieldAccType,name:"fieldAccType",options:c,on:{onChange:(t,i)=>{t!=i&&(u=o(this.objectAcc||$$(e.objectAcc).getValue(),t),(t=>{[e.fieldAccAsset,e.fieldAccExpense,e.fieldAccLiabilities,e.fieldAccEquity,e.fieldAccIncome].forEach((e=>{$$(e).define("options",t),$$(e).refresh()}))})(u))}}},{id:e.fieldAccAsset,view:"select",label:n("Acc -> Asset"),value:this.fieldAccAsset,name:"fieldAccAsset",options:u},{id:e.fieldAccExpense,view:"select",label:n("Acc -> Expense"),value:this.fieldAccExpense,name:"fieldAccExpense",options:u},{id:e.fieldAccLiabilities,view:"select",label:n("Acc -> Liabilities"),value:this.fieldAccLiabilities,name:"fieldAccLiabilities",options:u},{id:e.fieldAccEquity,view:"select",label:n("Acc -> Equity"),value:this.fieldAccEquity,name:"fieldAccEquity",options:u},{id:e.fieldAccIncome,view:"select",label:n("Acc -> Income"),value:this.fieldAccIncome,name:"fieldAccIncome",options:u}]};webix.ui(_,$$(t)),$$(t).show()}propertiesStash(t){var e=this.propertyIDs(t);this.name=this.property(e.name),this.defaults.settings.forEach((t=>{this[t]=this.property(e[t])}))}}},33618:(t,e,i)=>{const s=i(31166);let n=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{propertyIDs(t){return{name:`${t}_name`,processFPYearValue:`${t}_processFPYearValue`,objectFPYear:`${t}_objectFPYear`,objectFPMonth:`${t}_objectFPMonth`,objectGL:`${t}_objectGL`,objectAccount:`${t}_objectAccount`,valueFundBalances:`${t}_valueFundBalances`,valueNetIncome:`${t}_valueNetIncome`,fieldFPYearStart:`${t}_fieldFPYearStart`,fieldFPYearEnd:`${t}_fieldFPYearEnd`,fieldFPYearStatus:`${t}_fieldFPYearStatus`,fieldFPYearActive:`${t}_fieldFPYearActive`,fieldFPMonthStart:`${t}_fieldFPMonthStart`,fieldFPMonthEnd:`${t}_fieldFPMonthEnd`,fieldGLStartBalance:`${t}_fieldGLStartBalance`,fieldGLRunningBalance:`${t}_fieldGLRunningBalance`,fieldGLrc:`${t}_fieldGLrc`,fieldAccNumber:`${t}_fieldAccNumber`,fieldAccType:`${t}_fieldAccType`,fieldAccTypeIncome:`${t}_fieldAccTypeIncome`,fieldAccTypeExpense:`${t}_fieldAccTypeExpense`,fieldAccTypeEquity:`${t}_fieldAccTypeEquity`}}propertiesShow(t){var e=this.propertyIDs(t),i=[{id:0,value:n("Select a Process Value")}];(this.process.processDataFields(this)||[]).forEach((t=>{i.push({id:t.key,value:t.label})}));var s=this.AB.objects().map((t=>({id:t.id,value:t.label||t.name,object:t})));s.unshift({id:0,value:n("Select an Object")});let a=(t,e)=>{let i=[{id:0,value:n("Select a Field")}];if(t){var a=s.find((e=>e.id==t));a&&a.object&&a.object.fields((t=>t.key==e)).forEach((t=>{i.push({id:t.id,value:t.label,field:t})}))}return i},r=(t,e)=>{let i=[],s=this.AB.objectByID(t);if(!s)return i;let n=s.fieldByID(e);return n&&n.settings&&n.settings.options?(i=(n.settings.options||[]).map((t=>({id:t.id,value:t.text}))),i):i},o=a(this.objectFPYear,"date"),l=a(this.objectFPYear,"list"),h=r(this.objectFPYear,this.fieldFPYearStatus),c=a(this.objectFPMonth,"date"),d=a(this.objectGL,"number"),u=a(this.objectGL,"connectObject"),_=a(this.objectAccount,"number"),p=a(this.objectAccount,"list"),f=r(this.objectAccount,this.fieldAccType);var g={id:t,view:"form",elementsConfig:{labelWidth:200},elements:[{id:e.name,view:"text",label:n("Name"),name:"name",value:this.name},{id:e.processFPYearValue,view:"select",label:n("Process Fiscal Period Year Value"),value:this.processFPYearValue,name:"processFPYearValue",options:i},{id:e.objectFPYear,view:"select",label:n("FP Year Object"),value:this.objectFPYear,name:"objectFPYear",options:s,on:{onChange:(t,i)=>{var s;t!=i&&(o=a(t,"date"),s=o,[e.fieldFPYearStart,e.fieldFPYearEnd].forEach((t=>{$$(t).define("options",s),$$(t).refresh()})),p=a(t,"list"),(t=>{$$(e.fieldFPYearStatus).define("options",t),$$(e.fieldFPYearStatus).refresh()})(p))}}},{id:e.objectFPMonth,view:"select",label:n("FP Month Object"),value:this.objectFPMonth,name:"objectFPMonth",options:s,on:{onChange:(t,i)=>{var s;t!=i&&(c=a(t,"date"),s=c,[e.fieldFPMonthStart,e.fieldFPMonthEnd].forEach((t=>{$$(t).define("options",s),$$(t).refresh()})))}}},{id:e.objectGL,view:"select",label:n("Balance Object"),value:this.objectGL,name:"objectGL",options:s,on:{onChange:(t,i)=>{var s,n;t!=i&&(d=a(t,"number"),n=d,[e.fieldGLStartBalance,e.fieldGLRunningBalance].forEach((t=>{$$(t).define("options",n),$$(t).refresh()})),u=a(t,"connectObject"),s=u,$$(e.fieldGLrc).define("options",s),$$(e.fieldGLrc).refresh())}}},{id:e.objectAccount,view:"select",label:n("Account Object"),value:this.objectAccount,name:"objectAccount",options:s,on:{onChange:(t,i)=>{var s;t!=i&&(p=a(t,"list"),s=p,$$(e.fieldAccType).define("options",s),$$(e.fieldAccType).refresh(),_=a(t,"number"),(t=>{$$(e.fieldAccNumber).define("options",t),$$(e.fieldAccNumber).refresh()})(_))}}},{id:e.valueFundBalances,view:"text",label:n("Fund Balances Code"),value:this.valueFundBalances,name:"valueFundBalances"},{id:e.valueNetIncome,view:"text",label:n("Net Income Code"),value:this.valueNetIncome,name:"valueNetIncome"},{id:e.fieldFPYearStart,view:"select",label:n("FP Year -> Start"),value:this.fieldFPYearStart,name:"fieldFPYearStart",options:o},{id:e.fieldFPYearEnd,view:"select",label:n("FP Year -> End"),value:this.fieldFPYearEnd,name:"fieldFPYearEnd",options:o},{id:e.fieldFPYearStatus,view:"select",label:n("FP Year -> Status"),value:this.fieldFPYearStatus,name:"fieldFPYearStatus",options:l,on:{onChange:(t,i)=>{t!=i&&(h=r(this.objectFPYear||$$(e.objectFPYear).getValue(),t),(t=>{$$(e.fieldFPYearActive).define("options",t),$$(e.fieldFPYearActive).refresh()})(h))}}},{id:e.fieldFPYearActive,view:"select",label:n("FP Year -> Active"),value:this.fieldFPYearActive,name:"fieldFPYearActive",options:h},{id:e.fieldFPMonthStart,view:"select",label:n("FP Month -> Start"),value:this.fieldFPMonthStart,name:"fieldFPMonthStart",options:c},{id:e.fieldFPMonthEnd,view:"select",label:n("FP Month -> End"),value:this.fieldFPMonthEnd,name:"fieldFPMonthEnd",options:c},{id:e.fieldGLStartBalance,view:"select",label:n("GL -> Start Balance"),value:this.fieldGLStartBalance,name:"fieldGLStartBalance",options:d},{id:e.fieldGLRunningBalance,view:"select",label:n("GL -> Running Balance"),value:this.fieldGLRunningBalance,name:"fieldGLRunningBalance",options:d},{id:e.fieldGLrc,view:"select",label:n("GL -> RC"),value:this.fieldGLrc,name:"fieldGLrc",options:u},{id:e.fieldAccNumber,view:"select",label:n("Acc -> Account Number"),value:this.fieldAccNumber,name:"fieldAccNumber",options:_},{id:e.fieldAccType,view:"select",label:n("Acc -> Type"),value:this.fieldAccType,name:"fieldAccType",options:p,on:{onChange:(t,i)=>{t!=i&&(f=r(this.objectAccount||$$(e.objectAccount).getValue(),t),(t=>{[e.fieldAccTypeIncome,e.fieldAccTypeExpense,e.fieldAccTypeEquity].forEach((e=>{$$(e).define("options",t),$$(e).refresh()}))})(f))}}},{id:e.fieldAccTypeIncome,view:"select",label:n("Acc -> Income"),value:this.fieldAccTypeIncome,name:"fieldAccTypeIncome",options:f},{id:e.fieldAccTypeExpense,view:"select",label:n("Acc -> Expense"),value:this.fieldAccTypeExpense,name:"fieldAccTypeExpense",options:f},{id:e.fieldAccTypeEquity,view:"select",label:n("Acc -> Equity"),value:this.fieldAccTypeEquity,name:"fieldAccTypeEquity",options:f}]};webix.ui(g,$$(t)),$$(t).show()}propertiesStash(t){var e=this.propertyIDs(t);this.name=this.property(e.name),this.defaults.settings.forEach((t=>{this[t]=this.property(e[t])}))}}},79841:(t,e,i)=>{const s=i(69814);let n=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{propertyIDs(t){return{name:`${t}_name`,processBatchValue:`${t}_processBatchValue`,objectBatch:`${t}_objectBatch`,objectBalance:`${t}_objectBalance`,objectJE:`${t}_objectJE`,objectJEArchive:`${t}_objectJEArchive`,fieldBatchFiscalMonth:`${t}_fieldBatchFiscalMonth`,fieldJeAccount:`${t}_fieldJeAccount`,fieldJeRC:`${t}_fieldJeRC`,fieldJeArchiveBalance:`${t}_fieldJeArchiveBalance`,fieldBrFiscalMonth:`${t}_fieldBrFiscalMonth`,fieldBrAccount:`${t}_fieldBrAccount`,fieldBrRC:`${t}_fieldBrRC`,fieldsMatch:`${t}_fieldsMatch`}}propertiesShow(t){let e=this.propertyIDs(t),i=[{id:0,value:n("Select a Process Value")}];(this.process.processDataFields(this)||[]).forEach((t=>{i.push({id:t.key,value:t.label})}));let s=this.AB.objects().map((t=>({id:t.id,value:t.label||t.name,object:t})));s.unshift({id:0,value:n("Select an Object")});let a=t=>{let e=this.AB.objectByID(t);if(!e)return[];let i=e.fields((t=>t.isConnection)).map((t=>({id:t.id,value:t.label})));return i.unshift({id:0,value:n("Select a Field")}),i},r=(t,e)=>{t.forEach((t=>{var i=$$(t);i&&(i.define("options",e),i.refresh(),i.show())}))},o=()=>{let t=$$(e.fieldsMatch);if(!t)return;webix.ui([],t);let i=this.AB.objectByID(this.objectJE);if(!i)return;let s=this.AB.objectByID(this.objectJEArchive);s&&(s.fields().forEach((e=>{let s=[];s=e.isConnection?i.fields((t=>t.isConnection&&t.settings&&e.settings&&t.settings.linkObject==e.settings.linkObject&&t.settings.linkType==e.settings.linkType&&t.settings.linkViaType==e.settings.linkViaType&&t.settings.isCustomFK==e.settings.isCustomFK)):i.fields((t=>t.key==e.key)),s=s.map((t=>({id:t.id,value:t.label}))),t.addView({view:"select",name:e.id,label:e.label,options:s})})),t.setValues(this.fieldsMatch||{}))},l=a(this.objectBatch),h=a(this.objectBalance),c=a(this.objectJE),d=a(this.objectJEArchive),u={id:t,view:"form",elementsConfig:{labelWidth:180},elements:[{id:e.name,view:"text",label:n("Name"),name:"name",value:this.name},{id:e.processBatchValue,view:"select",label:n("Process Batch Value"),value:this.processBatchValue,name:"processBatchValue",options:i},{id:e.objectBatch,view:"select",label:n("Batch Object"),value:this.objectBatch,name:"objectBatch",options:s,on:{onChange:t=>{this.objectBatch=t,(t=>{let i=a(t);r([e.fieldBatchFiscalMonth],i)})(t)}}},{id:e.fieldBatchFiscalMonth,view:"select",label:n("Batch -> Fiscal Month"),value:this.fieldBatchFiscalMonth,name:"fieldBatchFiscalMonth",options:l},{id:e.objectBalance,view:"select",label:n("BR Object"),value:this.objectBalance,name:"objectBalance",options:s,on:{onChange:t=>{this.objectBalance=t,(t=>{let i=a(t);r([e.fieldBrAccount,e.fieldBrFiscalMonth,e.fieldBrRC],i)})(t)}}},{id:e.fieldBrFiscalMonth,view:"select",label:n("BR -> Fiscal Month"),value:this.fieldBrFiscalMonth,name:"fieldBrFiscalMonth",options:h},{id:e.fieldBrAccount,view:"select",label:n("BR -> Account"),value:this.fieldBrAccount,name:"fieldBrAccount",options:h},{id:e.fieldBrRC,view:"select",label:n("BR -> RC"),value:this.fieldBrRC,name:"fieldBrRC",options:h},{id:e.objectJE,view:"select",label:n("JE Object"),value:this.objectJE,name:"objectJE",options:s,on:{onChange:t=>{this.objectJE=t,(t=>{let i=a(t);r([e.fieldJeAccount,e.fieldJeRC],i)})(t),o()}}},{id:e.fieldJeAccount,view:"select",label:n("JE -> Account"),value:this.fieldJeAccount,name:"fieldJeAccount",options:c},{id:e.fieldJeRC,view:"select",label:n("JE -> RC"),value:this.fieldJeRC,name:"fieldJeRC",options:c},{id:e.objectJEArchive,view:"select",label:n("JE Archive Object"),value:this.objectJEArchive,name:"objectJEArchive",options:s,on:{onChange:t=>{this.objectJEArchive=t,(t=>{let i=a(t);r([e.fieldJeArchiveBalance],i)})(t),o()}}},{id:e.fieldJeArchiveBalance,view:"select",label:n("JE Archive -> BR"),value:this.fieldJeArchiveBalance,name:"fieldJeArchiveBalance",options:d},{view:"fieldset",label:"Fields Matching",body:{id:e.fieldsMatch,view:"form",borderless:!0,elements:[]}}]};webix.ui(u,$$(t)),$$(t).show(),o()}propertiesStash(t){let e=this.propertyIDs(t);this.name=this.property(e.name),this.defaults.settings.forEach((t=>{this[t]="fieldsMatch"===t?$$(e.fieldsMatch).getValues():this.property(e[t])}))}}},26088:(t,e,i)=>{const s=i(50689);t.exports=class extends s{warningsEval(){if(super.warningsEval(),this.formulaText||this.warningMessage("is missing a formula."),this.formulaText){const t={};(this.process.processDataFields(this)||[]).forEach((e=>{t[`{${e.label}}`]=e}));let e=new RegExp("{[^}]*}","g");(this.formulaText.match(e)||[]).forEach((e=>{t[e]||this.warningMessage(`could not resolve process value [${e}]`)}))}}}},34430:(t,e,i)=>{const s=i(98856);t.exports=class extends s{warningsEval(){super.warningsEval(),this.email||this.warningMessage("is missing the email address."),0==(this.process.processDataFields(this)??[]).filter((t=>"email"==t.field?.key)).map((t=>({id:t.key,value:t.label}))).length&&this.warningMessage("has no previous tasks exporting email fields.")}}},87757:(t,e,i)=>{const s=i(24858);t.exports=class extends s{warningsEval(){super.warningsEval(),this.objectID||this.warningMessage("has no Object set.");const t=Object.keys(this.fieldValues||{})||[];if(0==t.length)this.warningMessage("has no fields set");else{let e=!1;t.forEach((t=>{"0"!=this.fieldValues[t]?.set&&null!=this.fieldValues[t]?.value&&(e=!0)})),e||this.warningMessage("has no fields set")}}}},85811:(t,e,i)=>{const s=i(35002),n=i(46370);t.exports=class extends s{constructor(t,e,i){super(t,e,i),this.attributes=t}ABQLManager(){return n}warnings(){let t=[];return this.qlObj&&(t=t.concat(this.qlObj.warnings())),t.forEach((t=>{t?.message&&this.warningMessage(t.message)})),super.warnings().filter((t=>t))}warningsEval(){super.warningsEval(),this.qlObj?this.qlObj.warningsEval():this.warningMessage("has no Query defined."),this.name||this.warningMessage("does not have a name.",{attributes:this.attributes});let t=!1,e=this.qlObj;for(;e;)"row_save"===e.key||"set_save"===e.key?(t=!0,e=null):e=e.next;t||this.warningMessage("requires at least one Save operation.")}}},86298:(t,e,i)=>{const s=i(36146);t.exports=class extends s{diagramProperties(t){let e=super.diagramProperties();return e=e||[{}],e[0].def=e[0].def||{},null!=this.parameterId&&(e[0].def=e[0].def||{},e[0].def.loopCharacteristics=t.get("moddle").create("bpmn:MultiInstanceLoopCharacteristics"),e[0].def.loopCharacteristics.isSequential=!0),e}onChange(t){let e=t.loopCharacteristics||t.businessObject.loopCharacteristics||{};switch(e.$type){case"bpmn:MultiInstanceLoopCharacteristics":this.loopType=e.isSequential?"sequential":"parallel";break;case"bpmn:StandardLoopCharacteristics":this.loopType="looping"}}destroy(){return this.process.destroy.call(this)}save(){return this.process.save.call(this)}elementNewForModelDefinition(t){let e=this.AB.processElementNewForModelDefinition(t,this);return e&&this.elementAdd(e),e}warningsEval(){super.warningsEval(),(this._unknownElementIDs||[]).forEach((t=>{this.warningMessage(`is referencing an unknown process element id[${t}]`,{process:this.id,eID:t})}))}}},68063:(t,e,i)=>{const s=i(96493);t.exports=class extends s{}},56031:(t,e,i)=>{const s=i(42501);t.exports=class extends s{}},82448:(t,e,i)=>{const s=i(39483);t.exports=class extends s{}},46732:(t,e,i)=>{const s=i(41600);t.exports=class extends s{}},12513:(t,e,i)=>{const s=i(55364);t.exports=class extends s{}},12038:(t,e,i)=>{const s=i(97535);t.exports=class extends s{save(){return Promise.resolve().then((()=>super.save())).then((t=>this.AB.Network.put({url:(this.isEnabled?"/process/timer/#id#/start":"/process/timer/#id#/stop").replace("#id#",this.id)})))}}},15430:(t,e,i)=>{const s=i(52983),n=i(82021).Z,a=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{constructor(t,e,i,s,n){super(t,e,i,s,n),this.on("warning",((t,e)=>{this._warnings.push({message:t,data:e})}))}parseRow(t,e){this.parameterDefinitions.forEach((t=>{const i=this.uiID(e);this.ids=this.toIDs(i),this.params=this.params??{};let s=null;switch(t.type){case"objectFields":this.params[t.name]=$$(this.ids.objectfields).getValue();break;case"objectName":this.params[t.name]=$$(this.ids.objectname).getValue();break;case"objectConditions":case"objectValues":if(s=$$(this.ids.condition),s){const e=s.getValue();e&&""!==e&&(this.params[t.name]=JSON.parse(e))}break;case"taskParam":this.params[t.name]=$$(this.ids.taskparam).getValue()}}))}toIDs(t){return{condition:`${t}_condition`,objectfields:`${t}_objectfields`,objectname:`${t}_objname`,popup:`${t}_popup`,select:`${t}_select`,shorthand:`${t}_shorthand`,taskparam:`${t}_taskparam`,spacer:`${t}_spacer`}}uiAddParamForDef(t,e,i){if(!i.cols){if(!i.rows)throw new Error("provided ui is not able to add a parameter!");for(let s=0;s<i.rows.length;s++)if(i.rows[s].cols){this.uiAddParamForDef(t,e,i.rows[s]);break}return}const s=this.uiParamUI(t,e);s&&(1===this.parameterDefinitions.length?(i.cols.pop(),i.cols.push(s)):i.cols.length<3?i.cols.push({rows:[s]}):i.cols[2].rows.push(s))}uiAddNext(t,e){const i=this.uiNextRow(t);this.next?(this.next.uiAddParams(t,i),e.rows.push(i),this.next.uiAddNext(t,e)):e.rows.push(i)}uiAddParams(t,e){this.parameterDefinitions.forEach((i=>{this.uiAddParamForDef(i,t,e)}))}uiID(t){return this.prevOP?`${this.prevOP.uiID(t)}_${this.constructor.key}`:`${t}_${this.constructor.key}`}uiNextRow(t){const e=this.constructor.NextQLOps.map((t=>({id:t.key,value:t.label})));e.unshift({id:0,value:a("choose next operation")});const i=this.uiID(t),s=this.toIDs(i);return{cols:[{id:s.select,view:"select",value:this.next?this.next.constructor.key:0,options:e,on:{onChange:(e,i)=>{const n=()=>{const t=$$(s.select);t.blockEvent(),t.setValue(i),t.unblockEvent()};if(e===i)return;const r=this.constructor.NextQLOps.find((t=>t.key===e));if(!r)return void n();const o=$$(s.select).getParentView(),l=o.getParentView(),h=()=>{if(r){const e=new r({},this,this.task,this.AB);this.next=e,e.viewAddParams(t,o),e.viewAddNext(t,l)}},c=l.getChildViews();c.length-1>c.indexOf(o)?webix.confirm({title:a("continue?"),text:a("changing this rule will reset any following rules."),ok:a("Yes"),cancel:a("No"),callback:t=>{if(t){let t=c.length-1;for(;c[t].config.id!==o.config.id;)l.removeView(c[t]),t--;const e=o.getChildViews();let i=e.length;for(;i>1;)o.removeView(e[i-1]),i--;h()}else n()}}):h()}}},{id:s.spacer}]}}uiNextRowSelectorRefresh(t){const e=$$(this.ids.select);if(!e)return;const i=this.uiNextRow(t),s=i.cols.filter((t=>t.id==e.config.id))[0]??i.cols[1];s&&AB.Webix.ui(s,e)}uiParamUI(t,e){const i=AB.Config.uiSettings();let s=this.uiID(e);this.ids=this.toIDs(s);let r=null,o=null,l=null,h=null,c=null,d=null,u=null,_=null,p=null;switch(t.type){case"objectFields":this.object&&(o=this.object.fields().map((t=>({id:t.id,value:t.label,icon:`fa fa-${t.icon}`})))),o.unshift({id:"_PK",value:"[PK]"}),!this.fieldID&&o.length>0&&(this.params[t.name]=o[0].id,this.paramChanged(t,e)),r={id:this.ids.objectfields,view:"richselect",label:a("Field"),labelWidth:70,value:this.fieldID,options:o,on:{onChange:(i,s)=>{i!==this.params[t.name]&&(this.params[t.name]=i,this.paramChanged(t,e))}}};break;case"objectName":o=this.AB.objects().map((t=>({id:t.id,value:t.label}))),!this.objectID&&o.length>0&&(this.objectID=o[0].id,this.params[t.name]=this.objectID,this.paramChanged(t)),r={id:this.ids.objectname,view:"select",label:a("Data Source"),labelWidth:i.labelWidthLarge,value:this.objectID,options:o,on:{onChange:e=>{this.params=this.params??{},e!==this.params[t.name]&&(this.params[t.name]=e,this.paramChanged(t))}}};break;case"objectConditions":if(l=this.AB.filterComplexNew(e),h=this.availableProcessDataFieldsHash(),this.object){l.fieldsLoad(this.object.fields(),this.object);const t=Object.keys(h).map((t=>h[t]));l.processFieldsLoad(t)}l.on("save",(e=>{this.params=this.params??{},this.params[t.name]=e;const i=$$(this.ids.shorthand);i.define({label:l.toShortHand()}),i.refresh();const s=$$(this.ids.condition);s.define({value:JSON.stringify(this.params[t.name])}),s.refresh()})),c="",this.params&&this.params[t.name]&&(l.setValue(this.params[t.name]),c=JSON.stringify(this.params[t.name])),d=l.toShortHand(),r={rows:[{id:this.ids.shorthand,view:"button",label:d,on:{onItemClick:()=>{l.popUp($$(this.ids.shorthand),null,{pos:"center"})}}},{id:this.ids.condition,view:"text",value:c,hidden:!0}]};break;case"objectValues":u="",_=new n(s,this.AB),this.object&&_.objectLoad(this.object),_.setExtendedOptions((this.task.process.processDataFields(this.task)??[]).map((t=>({id:t.key,value:t.label})))),this.params&&this.params[t.name]&&(_.setValue(this.params[t.name]),u=JSON.stringify(this.params[t.name])),p=()=>{const e={id:this.ids.popup,view:"popup",position:"center",minWidth:700,modal:!0,resize:!0,body:{rows:[{height:30,borderless:!0,cols:[{fillspace:!0},{view:"button",value:"X",width:30,click:()=>{$$(this.ids.popup).hide()}}]},_.ui(),{view:"button",value:a("Save"),css:"webix_primary",click:()=>{this.params=this.params??{},this.params[t.name]=_.getValue();const e=$$(this.ids.shorthand);e.define({badge:this.params[t.name].length}),e.refresh();const i=$$(this.ids.condition);i.define({value:JSON.stringify(this.params[t.name])}),i.refresh(),$$(this.ids.popup).hide()}}]}};this._myPopup=webix.ui(e),this._myPopup.show(),this.params&&this.params[t.name]&&_.setValue(this.params[t.name])},r={rows:[{id:this.ids.shorthand,view:"button",label:a("Update Popout"),badge:this.params[t.name]?.length,on:{onItemClick:()=>{p()}}},{id:this.ids.condition,view:"text",value:u,hidden:!0}]};break;case"taskParam":r={id:this.ids.taskparam,view:"text",label:a("Variable"),labelWidth:70,value:this.params[t.name],placeholder:a("Enter parameter name"),on:{onChange:(i,s)=>{i!==this.params[t.name]&&(this.params[t.name]=i,this.paramChanged(t,e))}}}}return r}viewAddNext(t,e){const i=this.uiNextRow(t);e.addView(i)}viewAddParams(t,e){const i=[];this.parameterDefinitions.forEach((e=>{i.push(this.uiParamUI(e,t))}));let s=null;s=i.length>1?{rows:i}:i.pop(),s&&(e.removeView(e.getChildViews()[1]),e.addView(s))}warnings(){let t=this._warnings||[];return this.next&&(t=t.concat(this.next.warnings()).filter((t=>t))),this.AB.uniq(t)}warningsEval(){this._warnings=[],this.next&&this.next.warningsEval()}warningMessage(t){this._warnings=this._warnings||[],this._warnings.push({message:`${this.key}: ${t}`})}}},63408:(t,e,i)=>{const s=i(85111);t.exports=class extends s{}},46370:(t,e,i)=>{const s=i(98162),n=i(54157),a={fromAttributes:s.fromAttributes,ids:t=>({root:`${t}_root`,select:`${t}_root_select`,options:`${t}_root_options`}),builder:(t,e,i)=>({ui:s=>{t=t??new n({},e,i);const r={rows:[{id:a.ids(s).root,cols:[]}]};return t.uiAddParams(s,r),t.uiAddNext(s,r),r},init:t=>{}}),parse:(t,e,i)=>{const r=a.ids(t),o=$$(r.root);if(!o)return void console.warn("ABQLManager.parse(): unable to find root element");const l=o.getParentView().getChildViews(),h=(s,a,r)=>{if(0===s.length)return null;const o=s.shift(),l=o.getChildViews();let c=l.shift();for(;!c?.getValue;)c=l.shift();const d=c.getValue(),u=a.find((t=>t.key===d||t.key===n.key));if(u){let n=null;n=r?new u({},r,e,i):new u({},e,i),n.parseRow(o,t),!n.object&&r&&(n.object=r.object,n.objectID=n.object?.id??null);const a=h(s,n.constructor.NextQLOps,n);return n.next=a,n}return null};return h(l,s.QLOps,null)}};t.exports=a},54157:(t,e,i)=>{const s=i(37505);t.exports=class extends s{paramChanged(t){"name"===t.name&&(this.objectID=this.params[t.name],this.object=this.objectLookup(this.objectID),this.next&&(this.next.object=this.object))}parseRow(t,e){super.parseRow(t,e),this.params.name&&(this.objectID=this.params.name,this.object=this.objectLookup(this.params.name))}warningsEval(){super.warningsEval(),this.object||this.warningMessage("has no object set.",{objectID:this.objectID})}}},25851:(t,e,i)=>{const s=i(29215);t.exports=class extends s{paramChanged(t,e){super.paramChanged(t),"fieldID"===t.name&&this.uiNextRowSelectorRefresh(e)}}},47027:(t,e,i)=>{const s=i(32569);t.exports=class extends s{paramChanged(t,e){super.paramChanged(t)}}},465:(t,e,i)=>{const s=i(60354);t.exports=class extends s{}},88593:(t,e,i)=>{const s=i(80219);t.exports=class extends s{}},5926:(t,e,i)=>{const s=i(60512);t.exports=class extends s{paramChanged(t){"fieldID"===t.name&&(this.fieldID=this.params[t.name],this.field=this.object.fieldByID(this.fieldID),this.field&&"connectObject"===this.field.key&&(this.objectOut=this.field.datasourceLink,this.objectOutID=this.objectOut.id,this.next&&(this.next.object=this.objectOut)))}parseRow(t,e){super.parseRow(t,e),this.fieldID=this.params.fieldID,this.AB.objects((t=>{if(!this.field){const e=t.fieldByID(this.fieldID);e&&(this.field=e)}})),this.field&&(this.object=this.field.object,this.field&&"connectObject"===this.field.key&&(this.objectOut=this.field.datasourceLink,this.objectOutID=this.objectOut.id))}}},67478:(t,e,i)=>{const s=i(74178);t.exports=class extends s{paramChanged(t){"task_param"===t.name&&(this.taskParam=this.params[t.name])}parseRow(t,e){super.parseRow(t,e),this.taskParam=this.params.task_param,this.registered||(this.task.registerDatasource(this),this.registered=!0)}warningsEval(){super.warningsEval(),this.taskParam&&""!==this.taskParam||this.warningMessage("requires a name to save our data as.")}}},10902:(t,e,i)=>{const s=i(45974),n=i(26086).Z;t.exports=class extends s{component(){return new n(this)}componentList(t){var e=["view","page","formpanel","viewcontainer","detailcheckbox","detailcustom","detailconnect","detailimage","detailselectivity","detailtext","detailtree","button","checkbox","connect","datepicker","fieldcustom","textbox","numberbox","selectsingle","selectmultiple","formtree","fieldreadonly","pie","bar","line","area","report","reportPage","reportPanel"];return this.application.viewAll().filter((t=>-1==e.indexOf(t.common().key)))}changePage(t){this.emit("changePage",t)}warningsAll(){var t=super.warningsAll();return this.views().forEach((e=>{t=t.concat(e.warningsAll())})),(this.pages?.()||[]).forEach((e=>{t=t.concat(e.warningsAll())})),t.filter((t=>t))}warningsEval(){super.warningsEval();let t=this.views();(this.__missingViews||[]).forEach((t=>{this.warningsMessage(`references unknown View[${t}]`)})),t.forEach((t=>{t.warningsEval()})),this.settings.dataviewID&&(this.datacollections||this.datacollection||this.warningsMessage(`references unknown dataviewID[${this.settings.dataviewID}]`))}warningsMessage(t,e={}){let i=`${this.key}[${this.name}]: ${t}`;this._warnings.push({message:i,data:e})}}},4818:(t,e,i)=>{const s=i(50792),n=i(99902);t.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},92471:(t,e,i)=>{const s=i(17876),n=i(99593);t.exports=class extends s{component(t){return new n(this,t)}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`),this.settings.availableFieldIds?.length||this.warningsMessage("has no fields set for matching import data")}}},20362:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>l});var s=i(26086);class n extends s.Z{constructor(t,e,i){super(t,e||`ABViewCarousel_${t.id}`,Object.assign({carousel:""},i)),this._handler_doOnShow=()=>{this.onShow()},this._handler_doReload=()=>{},this._handler_doFilter=(t,e)=>{const i=this.datacollection;i&&(i.filterCondition(e),i.reloadData())},this._handler_busy=()=>{this.busy()},this._handler_ready=()=>{this.ready()}}ui(){const t=this.ids,e=this.view;this.filterUI=e.filterHelper,this.linkPage=e.linkPageHelper.component();const i={},s=this.settings;0===s.width&&Object.assign(i,{width:1});const n=super.ui([{borderless:!0,cols:[i,{borderless:!0,rows:[this.filterUI.ui(),{id:t.carousel,view:"carousel",cols:[],width:s.width,height:s.height,navigation:{items:!s.hideItem,buttons:!s.hideButton,type:s.navigationType},on:{onShow:()=>{const e=$$(t.carousel).getActiveIndex();this.switchImage(e)}}}]},i]}]);return delete n.type,n}async init(t){await super.init(t);const e=this.datacollection;if(!e)return void t.notify.builder(`Datacollection is ${e}`,{message:"This is an invalid datacollection"});const i=e.datasource;if(!i)return void t.notify.developer(`Object is ${e}`,{message:"This is an invalid object"});e.removeListener("loadData",this._handler_doOnShow),e.on("loadData",this._handler_doOnShow),e.removeListener("update",this._handler_doReload),e.on("update",this._handler_doReload),e.removeListener("delete",this._handler_doReload),e.on("delete",this._handler_doReload),e.removeListener("create",this._handler_doReload),e.on("create",this._handler_doReload),e.removeListener("initializingData",this._handler_busy),e.on("initializingData",this._handler_busy),e.removeListener("initializedData",this._handler_ready),e.on("initializedData",this._handler_ready),this.settings.filterByCursor&&(e.removeListener("changeCursor",this._handler_doOnShow),e.on("changeCursor",this._handler_doOnShow));const s=this.view;s.filterHelper.objectLoad(i),s.filterHelper.viewLoad(this),this.filterUI.init(this.AB),this.filterUI.removeListener("filter.data",this._handler_doFilter),this.filterUI.on("filter.data",this._handler_doFilter),this.linkPage.init({view:s,datacollection:e});const n=$$(this.ids.carousel)?.$view;n&&(n.setAttribute("data-cy",`${s.key} ${s.id}`),n.querySelector(".webix_nav_button_prev")?.firstElementChild?.setAttribute("data-cy",`${s.key} button previous ${s.id}`),n.querySelector(".webix_nav_button_next")?.firstElementChild?.setAttribute("data-cy",`${s.key} button next ${s.id}`))}detatch(){const t=this.datacollection;t&&(t.removeListener("loadData",this._handler_doOnShow),this._handler_doReload&&(t.removeListener("update",this._handler_doReload),t.removeListener("delete",this._handler_doReload),t.removeListener("create",this._handler_doReload)),t.removeListener("initializingData",this._handler_busy),t.removeListener("initializedData",this._handler_ready),this.settings.filterByCursor&&t.removeListener("changeCursor",this._handler_doOnShow),this.filterUI.removeListener("filter.data",this._handler_doOnShow))}myTemplate(t){if(t?.src){const e=this.settings;return['<div class="ab-carousel-image-container">',`<img src="${t.src}" class="content" ondragstart="return false" />`,e.showLabel?`<div class="ab-carousel-image-title">${t.label||""}</div>`:"",'<div class="ab-carousel-image-icon">',e.detailsPage||e.detailsTab?`<span ab-row-id="${t.id}" class="ab-carousel-detail webix_icon fa fa-eye"></span>`:"",e.editPage||e.editTab?`<span ab-row-id="${t.id}" class="ab-carousel-edit webix_icon fa fa-pencil"></span>`:"",'<span class="webix_icon ab-carousel-fullscreen fa fa-arrows-alt"></span>','<span style="display: none;" class="webix_icon ab-carousel-exit-fullscreen fa fa-times"></span>',"</div>","</div>"].join("")}return""}busy(){const t=$$(this.ids.carousel);t?.disable(),t?.showProgress?.({type:"icon"})}ready(){const t=$$(this.ids.carousel);t?.enable(),t?.hideProgress?.()}async switchImage(t){const e=this.datacollection;if(e&&t>=this._imageCount-1&&e.totalCount>this._rowCount){this.busy();try{await e.loadData(this._rowCount||0)}catch(t){this.AB.notify.developer(t,{message:"ABViewCarousel:switchImage():Error when load data from a Data collection"})}this.ready()}}onShow(t=this.filterUI.getFilter()){const e=this.ids,i=this.datacollection;if(!i)return;const s=i.datasource;if(!s)return;const n=this.view.imageField;if(!n)return;if(i.dataStatus==i.dataStatusFlag.notInitial)return void i.loadData();const a=this.settings;let r=i.getData(t);if(a.filterByCursor){const t=i.getCursor();t&&(r=r.filter((e=>(e[s.PK()]||e.id||e)===(t[s.PK()]||t.id||t))))}const o=[];r.forEach((t=>{const e=t[n.columnName];if(e){const i={id:t.id,src:`/file/${e}`};a.showLabel&&(i.label=s.displayData(t)),o.push({css:"image",borderless:!0,template:(...t)=>this.myTemplate(...t),data:i})}}));const l=this.AB;n.settings.defaultImageUrl&&o.unshift({css:"image",template:(...t)=>this.myTemplate(...t),data:{id:l.uuid(),src:`/file/${n.settings.defaultImageUrl}`,label:this.label("Default image")}}),o.length<1&&o.push({rows:[{view:"label",align:"center",height:a.height,label:"<div style='display: block; font-size: 180px; background-color: #666; color: transparent; text-shadow: 0px 1px 1px rgba(255,255,255,0.5); -webkit-background-clip: text; -moz-background-clip: text; background-clip: text;' class='fa fa-picture-o'></div>"},{view:"label",align:"center",label:this.label("No image")}]}),this._rowCount=r.length,this._imageCount=o.length;const h=$$(e.carousel),c=l.Webix;if(h){c.ui(o,h),c.extend(h,c.ProgressBar);const t=a.editPage,i=a.detailsPage;h.$view.onclick=s=>{if(s.target.className)if(s.target.className.indexOf("ab-carousel-edit")>-1){c.html.removeCss(h.getNode(),"fullscreen"),c.fullscreen.exit();let e=s.target.getAttribute("ab-row-id");this.linkPage.changePage(t,e)}else if(s.target.className.indexOf("ab-carousel-detail")>-1){c.html.removeCss(h.getNode(),"fullscreen"),c.fullscreen.exit();let t=s.target.getAttribute("ab-row-id");this.linkPage.changePage(i,t)}else s.target.className.indexOf("ab-carousel-fullscreen")>-1&&(h.define("css","fullscreen"),c.fullscreen.set(e.carousel,{head:{view:"toolbar",css:"webix_dark",elements:[{},{view:"icon",icon:"fa fa-times",click:function(){c.html.removeCss(h.getNode(),"fullscreen"),c.fullscreen.exit()}}]}}))}}}showFilterPopup(t){this.filterUI.showPopup(t)}}var a=i(84204),r=i(95782);const o=i(96483);class l extends o{constructor(t,e,i,s){super(t,e,i,s)}fromValues(t){super.fromValues(t),this.filterHelper.fromSettings(this.settings.filter)}component(){var t=this.datacollection;return t&&(this.filterHelper.objectLoad(t.datasource),this.filterHelper.fromSettings(this.settings.filter)),new n(this)}get idBase(){return`ABViewCarousel_${this.id}`}get filterHelper(){return null==this.__filterHelper&&(this.__filterHelper=new a.Z(this.AB,this.idBase)),this.__filterHelper}get linkPageHelper(){return null==this.__linkPageHelper&&(this.__linkPageHelper=new r.Z),this.__linkPageHelper}warningsEval(){super.warningsEval(),this.imageField||this.warningsMessage(`can't resolve image field[${this.settings.field}]`)}}},67373:(t,e,i)=>{const s=i(31311),n=i(39370);t.exports=class extends s{component(){return new n(this)}fromValues(t){super.fromValues(t),this.refreshData()}getDCChart(){return this._dcChart||(this._dcChart=new webix.DataCollection),this._dcChart}refreshData(){const t=this.datacollection;if(null==t)return this.dcChart;const e=this.labelField(),i=this.valueField(),s=this.valueField2();if(!e||!i)return this.dcChart;const n=i.columnName;let a="";this.settings.multipleSeries&&s&&(a=s.columnName);const r=["#ee4339","#ee9336","#eed236","#d3ee36","#a7ee70","#58dccd","#36abee","#476cee","#a244ea","#e33fc7"],o=t.getData();let l=[],h={},c=0,d=0,u=o.length;o.forEach((t=>{const s=e.format(t)||t.id;let r=parseFloat(t[n]||0),o=null;switch(this.settings.multipleSeries&&(o=parseFloat(t[a])||0),i.key){case"formula":r=i.format(t);break;case"calculate":r=parseFloat(i.constructor.convertToJs(i.object,i.settings.formula,t,i.settings.decimalPlaces))}if(null==h[s]){let i=s;if(e.isConnection){let s=e.pullRelationValues(t);null!=s&&(i=Array.isArray(s)?s.map((t=>t.text||"")).join(", "):s.text)}this.settings.multipleSeries?h[s]={label:i||t.id,value:0,value2:0}:h[s]={label:i||t.id,value:0}}h[s].value+=r,c+=r,this.settings.multipleSeries&&(h[s].value2+=o,d+=o)}));let _=0;for(const t in h){let e=h[t].value;if(!(e<=0)){if(this.settings.isPercentage&&(e=e/c*100,e=Math.round(100*e)/100,e+=" %"),this.settings.multipleSeries){let i=h[t].value2;if(i<=0)continue;this.settings.isPercentage&&(i=i/d*100,i=Math.round(100*i)/100,i+=" %"),l.push({label:h[t].label,value:e,value2:i,color:r[_%r.length],count:u})}else l.push({label:h[t].label,value:e,color:r[_%r.length],count:u});_+=1}}const p=this.getDCChart();p.clearAll(),p.parse(l)}warningsEval(){super.warningsEval(),this.labelField()||this.warningsMessage(`can't resolve label field[${this.settings.columnLabel}]`),this.valueField()||this.warningsMessage(`can't resolve value field[${this.settings.columnValue}]`)}}},17924:(t,e,i)=>{const s=i(46202),n=i(68579);t.exports=class extends s{component(){return new n(this)}}},51939:(t,e,i)=>{const s=i(53253),n=i(82912);t.exports=class extends s{component(){return new n(this)}}},39564:(t,e,i)=>{const s=i(11895),n=i(6537);t.exports=class extends s{component(){return new n(this)}get datacollection(){return this.parent.datacollection}}},71967:(t,e,i)=>{const s=i(59875),n=i(84214);t.exports=class extends s{component(){return new n(this)}}},98104:(t,e,i)=>{const s=i(12118),n=i(51197);t.exports=class extends s{component(){return new n(this)}}},1404:(t,e,i)=>{const s=i(42194),n=i(90700);t.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval();let t=this.getUserField();t||this.warningsMessage(`can't resolve user field[${this.settings.columnUser}]`),t=this.getCommentField(),t||this.warningsMessage(`can't resolve comment field[${this.settings.columnComment}]`),t=this.getDateField(),t||this.warningsMessage(`can't resolve date field[${this.settings.columnDate}]`)}}},88016:(t,e,i)=>{const s=i(10962),n=i(49919);t.exports=class extends s{component(){return new n(this)}async save(){const t=this.views().find((t=>"If"===t.name)),e=this.views().find((t=>"Else"===t.name)),i=[];t&&i.push(t.save()),e&&i.push(e.save()),await Promise.all(i),await super.save()}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`),this.settings.filterConditions&&0!=this.settings.filterConditions?.rules?.length||this.warningsMessage("has no filter conditions set")}}},37959:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>o});var s=i(3578),n=i.n(s),a=i(26086);class r extends a.Z{constructor(t,e,i){super(t,e||`ABViewConnectDataFilter_${t.id}`,Object.assign({filter:"",reset:""},i)),this.field=null}ui(){const t=this.ids,e=super.ui([{type:"space",borderless:!0,cols:[{view:"icon",icon:"fa fa-filter",align:"left",disabled:!0},{view:"combo",id:t.filter,labelWidth:this.AB.UISettings.config().labelWidthXLarge,disabled:!0,on:{onChange:t=>this.applyConnectFilter(t)}},{view:"icon",id:t.reset,icon:"fa fa-times",align:"left",disabled:!0,tooltip:this.label("Renmove this filter"),on:{onItemClick:()=>this.resetConnectFilter()}}]}]);return delete e.type,e}async init(t){await super.init(t);const e=this.datacollection;if(!e)return;const i=e.datasource;if(!i)return;const[s]=i.fields((t=>t.columnName===this.settings.field));if(!s)return void this.AB.notify.developer(`Cannot find field "${this.settings.field}" in ${i.name}`,{context:"ABViewConnectDataFilterComponent.init()",data:{settings:this.settings}});this.field=s;const n=this.ids,a=webix.ui({view:"suggest",filter:({value:t},e)=>t.toLowerCase().includes(e.toLowerCase()),on:{onShow:()=>{s.populateOptionsDataCy($$(n.filter),s,{})}}});s.getAndPopulateOptions(a,null,s);const r=$$(n.filter);r.define("suggest",a),r.define("label",`${this.label("Filter by")} ${s.label}`),r.enable(),r.refresh()}resetConnectFilter(){const t=this.ids,e=this.datacollection;e.filterCondition({glue:"and",rules:[]}),e.reloadData();const i=$$(t.filter);i.blockEvent(),i.setValue(),i.unblockEvent(),$$(t.reset).disable()}applyConnectFilter(t){const e={key:this.field.id,rule:"equals",value:t},i=this.datacollection;i.filterCondition({glue:"and",rules:[e]}),i.reloadData(),$$(this.ids.reset).enable()}}class o extends(n()){component(){return new r(this)}}},32715:(t,e,i)=>{const s=i(45132),n=i(60626);t.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval(),0==this.views().length&&this.warningsMessage("has no content")}}},80586:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>d});var s=i(10801),n=i.n(s),a=i(26086),r=i(60732),o=i(84204),l=i(96486),h=i.n(l);class c extends a.Z{constructor(t,e,i){super(t,e||`ABViewDataFilter_${t.id}`,Object.assign({filter:"",reset:"",sortButton:"",filterButton:"",globalSearchToolbar:""},i)),this._handler_filterData=(t,e)=>{this.callbackFilterData(t,e)},this.field=null;const s=this.AB;this.PopupSortComponent=new r.Z(`ABViewDataFilter_Sort_Popup_${this.settings.dataviewID}`),this.PopupSortComponent.init(s),this.PopupSortComponent.on("changed",(t=>{this.callbackSortData(t)})),this.filterHelper=new o.Z(this.AB,`ABViewDataFilter_Filter_Popup_${this.settings.dataviewID}`),this.filterHelper.settings={filterOption:1,userFilterPosition:"toolbar",isGlobalToolbar:1},this.filterHelper.init(s),this.detatch(),this.filterHelper.on("filter.data",this._handler_filterData)}advancedUI(){const t=this.ids.component;return[{css:"bg_gray",maxHeight:60,rows:[{},{cols:[{width:18},{view:"button",type:"icon",icon:"fa fa-filter",width:40,id:this.ids.filterButton,css:`webix_primary abFilterButton${this.settings.dataviewID}`,click:(t,e)=>{this.toolbarFilter($$(this.ids.filterButton).$view)},on:{onAfterRender:function(){this.getInputNode().setAttribute("data-cy",`${t} filter button`)}}},{view:"button",type:"icon",icon:"fa fa-sort",width:40,id:this.ids.sortButton,css:`webix_primary abSortButton${this.settings.dataviewID}`,click:(t,e)=>{this.openSort($$(this.ids.sortButton).$view)},on:{onAfterRender:function(){this.getInputNode().setAttribute("data-cy",`${t} sort button`)}}},{id:this.ids.globalSearchToolbar,view:"search",placeholder:this.label("Search.."),css:`abGlobalSearchField${this.settings.dataviewID}`,width:0,attributes:{"data-cy":`${this.ids.component} global search`,datacollection:this.settings.dataviewID},on:{onTimedKeyPress:()=>{const t=$$(this.ids.globalSearchToolbar).getValue();this.datacollection.settings.objectWorkspace.searchText=t,this.filterHelper.externalSearchText(t)}}},{width:18}]},{}]}]}connectedFieldUI(){return[{css:"bg_gray",maxHeight:60,cols:[{width:18},{rows:[{},{view:"abslayout",cells:[{css:"bg_gray",view:"combo",id:this.ids.filter,labelWidth:0,relative:!0,disabled:!0,on:{onChange:t=>this.applyConnectFilter(t)}},{view:"icon",id:this.ids.reset,icon:"fa fa-times",right:24,top:7,width:24,height:24,hidden:!0,tooltip:this.label("Remove this filter"),on:{onItemClick:()=>$$(this.ids.filter).setValue()}}]},{}]},{width:18}]}]}ui(){if("advanced"==this.settings.viewType){if(!this?.settings?.dataviewID)return{height:1}}else if(!this?.settings?.dataviewID||!this?.settings?.field)return{height:1};const t="advanced"==this.settings.viewType?this.advancedUI():this.connectedFieldUI(),e=super.ui(t);return delete e.type,e}async init(t){await super.init(t);const e=this.datacollection;if(!e)return;const i=e.datasource;if(i)if("advanced"==this.settings.viewType)this.settings.showSort?(this.PopupSortComponent.objectLoad(i),this.PopupSortComponent.setSettings(e?.settings?.objectWorkspace?.sortFields)):$$(this.ids.sortButton).hide(),this.settings.showFilter?this.filterHelper.objectLoad(i):$$(this.ids.filterButton).hide();else if("connected"==this.settings.viewType){const[t]=i.fields((t=>t.columnName===this.settings.field));if(!t)return void this.AB.notify.developer(`Cannot find field "${this.settings.field}" in ${i.name}`,{context:"ABViewDataFilterComponent.init()",data:{settings:this.settings}});this.field=t;const e=this.ids,s=webix.ui({view:"suggest",filter:({value:t},e)=>t.toLowerCase().includes(e.toLowerCase()),on:{onShow:()=>{t.populateOptionsDataCy($$(e.filter),t,{})}},showAllOptions:!0});t.getAndPopulateOptions(s,null,t);const n=$$(e.filter);n.define("suggest",s),n.define("placeholder",`${this.label("Filter by")} ${t.label}`),n.enable(),n.refresh()}}onShow(){super.onShow(),this.updateUI()}applyConnectFilter(t){let e=[];t?($$(this.ids.reset).show(),e=[{key:this.field.id,rule:"equals",value:t}]):$$(this.ids.reset).hide();const i=this.datacollection;i.filterCondition({glue:"and",rules:e}),i.reloadData()}openSort(t){this.PopupSortComponent.show(t)}async callbackSortData(t=[]){const e=this.datacollection;h().isEqual(e?.settings?.objectWorkspace?.sortFields,t)||(e.settings.objectWorkspace.sortFields=t,await this.datacollection.reloadData()),this.updateUI()}callbackFilterData(t,e=[]){const i=this.datacollection;h().isEqual(i?.__filterCond,e)||(i.filterCondition(e),i.reloadData(),this.updateUI())}toolbarFilter(t){this.filterHelper.showPopup(t)}updateUI(){const t=this.datacollection;if(!t)return;var e=document.getElementsByClassName(`abFilterButton${this.settings.dataviewID}`);const i=this.filterHelper.filterRules();let s=i?.rules?.length>0?i?.rules?.length:null;for(let t of e)$$(t).define("badge",s),$$(t).refresh();var n=document.getElementsByClassName(`abSortButton${this.settings.dataviewID}`);const a=t.settings.objectWorkspace.sortFields;let r=a?.length>0?a?.length:null;for(let t of n)$$(t).define("badge",r),$$(t).refresh();var o=document.getElementsByClassName(`abGlobalSearchField${this.settings.dataviewID}`);const l=t.settings.objectWorkspace.searchText;if(null!=l)for(let t of o){var h=document.activeElement;h?.attributes?.datacollection?.value==this.settings.dataviewID&&h==t.getElementsByTagName("input")[0]||$$(t).setValue(l)}}detatch(){this.filterHelper.removeListener("filter.data",this._handler_filterData)}}class d extends(n()){component(){return new c(this)}warningsEval(){super.warningsEval();let t=this.datacollection;if(t){if("connected"==this.settings.viewType){const e=t.datasource,[i]=e.fields((t=>t.columnName===this.settings.field));i||this.warningsMessage("can't resolve field reference")}}else this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},64411:(t,e,i)=>{const s=i(37446),n=i(10488),a=s.defaultValues();t.exports=class extends s{fromValues(t){super.fromValues(t),this.settings.detailsPage=this.settings.detailsPage??a.detailsPage,this.settings.editPage=this.settings.editPage??a.editPage,this.settings.detailsTab=this.settings.detailsTab??a.detailsTab,this.settings.editTab=this.settings.editTab??a.editTab}component(){return new n(this)}}},80414:(t,e,i)=>{const s=i(12407),n=i(15879);t.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},8990:(t,e,i)=>{const s=i(24044),n=i(43620);t.exports=class extends s{component(){return new n(this)}}},77855:(t,e,i)=>{const s=i(16497),n=i(95751).Z,a=i(76766);t.exports=class extends s{fromValues(t){super.fromValues(t),this.addPageTool.fromSettings(this.settings)}component(){return new a(this)}get addPageTool(){return null==this.__addPageTool&&(this.__addPageTool=new n),this.__addPageTool}}},92885:(t,e,i)=>{const s=i(78276),n=i(4989);t.exports=class extends s{component(){return new n(this)}}},69903:(t,e,i)=>{const s=i(81597),n=i(56333);t.exports=class extends s{component(){return new n(this)}}},81621:(t,e,i)=>{const s=i(12326),n=i(21269);t.exports=class extends s{component(){return new n(this)}}},82011:(t,e,i)=>{const s=i(89207),n=i(63567);t.exports=class extends s{component(){return new n(this)}}},73216:(t,e,i)=>{const s=i(7716),n=i(1620);t.exports=class extends s{component(){return new n(this)}}},4804:(t,e,i)=>{const s=i(24107),n=i(28458);t.exports=class extends s{component(){return new n(this)}letUserDownload(t,e){const i=window.URL.createObjectURL(t),s=document.createElement("a");s.href=i,s.download=e,document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(i)}warningsEval(){super.warningsEval(),this.datacollections||this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`),this.settings.filename||this.warningsMessage("is missing a DOCX template file")}}},70704:(t,e,i)=>{const s=i(36980),n=i(61463),a=i(15651),r=i(79662),o=i(46311),l=i(16816),h=i(38386),c=(i(48167),i(24655)),d=(...t)=>AB.Multilingual.label(...t),u=s.defaultValues();t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s),this._callbacks={onBeforeSaveData:()=>!0}}superComponent(){return null==this._superComponent&&(this._superComponent=super.component()),this._superComponent}component(){return new n(this)}refreshDefaultButton(t){let e=this.views((t=>t instanceof a&&t.settings.isDefault))[0];null==e?(e=a.newInstance(this.application,this),e.settings.isDefault=!0):this._views=this.views((t=>!(t instanceof a||t.settings.isDefault)));let i=this.views().map((t=>(t.position.y||0)+1));i.push(this._views.length||0),i.push($$(t.fields).length||0);let s=Math.max(...i);return e.position.y=s,this._views.push(e),e}getFormValues(t,e,i,s){const n=["id"];t.getValues((function(t){n.push(t.config.name)}));const a=t.getValues(),d={};n.forEach((t=>{d[t]=a[t]})),this.fieldComponents((t=>t instanceof r||t instanceof o||t instanceof l||t instanceof h||t instanceof c&&"filter"==t.settings.type)).forEach((t=>{const e=this.viewComponents[t.id];if(null==e)return;const i=t.field();if(i){const t=e.getValue??e.logic.getValue;t&&(d[i.columnName]=t.call(e,d))}})),e.connectFields().forEach((t=>{-1==n.indexOf(t.columnName)&&d[t.columnName]&&(delete d[t.columnName],delete d[t.relationName()])}));for(const t in d)null!=d[t]&&0!=d[t].length||(d[t]="");let u;if(s&&(u=s.getCursor()),u){const t=s.datasource;e.connectFields().forEach((e=>{const i=this.fieldComponents((t=>t?.field?.()?.id===e?.id));if(t.id==e.settings.linkObject&&i.length<1&&void 0===d[e.columnName]){const i=e.indexField?e.indexField.columnName:t.PK();d[e.columnName]={},d[e.columnName][i]=u[i]??u.id}}))}const _=Object.assign(i.getCursor()??{},d);return e.fields((t=>"calculate"==t.key||"formula"==t.key)).forEach((t=>{if(null==d[t.columnName]){let e=!0;"formula"==t.key&&t.settings?.where?.rules?.length>0&&(e=!1),d[t.columnName]=t.format(_,e)}})),d}validateData(t,e,i){let s=!0,n="";const a=this.fieldComponents((t=>1==t?.field?.().settings?.required||1==t?.settings?.required)).map((t=>t.field()));let r;if(s&&(r=e.isValidData(i),s=r.pass()),t.validate(),a.forEach((e=>{if(!e)return;const a=i[e.columnName];if(""==a||null==a||a.length<1){t.markInvalid(e.columnName,d("This is a required field.")),n+=`<li>${d("Missing Required Field")} ${e.columnName}</li>`,s=!1;const i=t.elements[e.columnName];if(i){i.$height<56&&(i.define("height",60),i.resize());const t=i.$view.getElementsByClassName("webix_inp_bottom_label")[0];t?.style["margin-left"]||(t.style.marginLeft=`${this.settings.labelWidth??u.labelWidth}px`)}}})),!s){const e=t.queryView({view:"button",type:"form"});r?.errors?.length?(r.errors.forEach((e=>{t.markInvalid(e.name,e.message),n+=`<li>${e.name}: ${e.message}</li>`})),e?.disable()):e?.enable()}return n&&webix.alert({type:"alert-error",title:d("Problems Saving"),width:400,text:`<ul style='text-align:left'>${n}</ul>`}),s}async recordRulesReady(){return this.RecordRule.rulesReady()}async saveData(t){if(!this._callbacks?.onBeforeSaveData?.())return;if(!t||!t.validate())return;t.clearValidation();const e=this.datacollection;if(null==e)return;const i=e.datasource;if(null==i)return;const s=e.model;if(null==s)return;const n=this.getFormValues(t,i,e,e.datacollectionLink),a=e=>{const i=t.queryView({view:"button",type:"form"});if(e)if(e.invalidAttributes)for(const i in e.invalidAttributes){let s=e.invalidAttributes[i];s&&s[0]&&(s=s[0]),t.markInvalid(i,s.message)}else e.sqlMessage?webix.message({text:e.sqlMessage,type:"error"}):(webix.message({text:d("System could not save your data"),type:"error"}),this.AB.notify.developer(e,{message:"Could not save your data",view:this.toObj()}));i?.enable(),t?.hideProgress?.()};if(await this.recordRulesReady(),this.doRecordRulesPre(n),!this.validateData(t,i,n))return;let r;t.showProgress?.({type:"icon"});try{r=n.id?await s.update(n.id,n):await s.create(n)}catch(t){throw a(t.data),t}try{await this.doRecordRules(r)}catch(t){this.AB.notify.developer(t,{message:"Error processing Record Rules.",view:this.toObj(),newFormVals:r})}try{this.doSubmitRules(r)}catch(t){this.AB.notify.developer(err,{message:"Error processing Submit Rules.",view:this.toObj(),newFormVals:r})}return(i=>{e&&(this.settings.clearOnSave?(e.setCursor(null),t.clear()):i&&i.id&&e.setCursor(i.id)),t.hideProgress?.(),i&&this.emit("saved",i)})(r),r}focusOnFirst(){let t="";this.views().forEach((e=>{"textbox"!=e.key&&"numberbox"!=e.key||0==e.position.y&&(t=e.id)}));let e=this.viewComponents[t];e&&$$(e.ui.id)&&$$(e.ui.id).focus()}get viewComponents(){return this.superComponent().viewComponents}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`),this.settings.recordRules,this.settings.submitRules}}},15651:(t,e,i)=>{const s=i(32609),n=i(56202);t.exports=class extends s{component(){return new n(this)}}},56339:(t,e,i)=>{const s=i(18489),n=i(29118);t.exports=class extends s{component(){return new n(this)}}},46311:(t,e,i)=>{const s=i(24703),n=i(13783),a=i(95751).Z,r=i(77025).Z,o=s.defaultValues();i(43947),t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s),this.__filterComponent=this.AB.filterComplexNew(`${this.id}__filterComponent`),this.__filterComponent.fieldsLoad(this.datasource?this.datasource.fields():[],this.datasource?this.datasource:null),this.__filterComponent.setValue(this.settings.filterConditions??o.filterConditions)}fromValues(t){super.fromValues(t),this.addPageTool.fromSettings(this.settings),this.editPageTool.fromSettings(this.settings)}static get addPageProperty(){return a.propertyComponent(this.App,this.idBase)}static get editPageProperty(){return r.propertyComponent(this.App,this.idBase)}component(){return new n(this)}get addPageTool(){return null==this.__addPageTool&&(this.__addPageTool=new a),this.__addPageTool}get editPageTool(){return null==this.__editPageTool&&(this.__editPageTool=new r),this.__editPageTool}}},79662:(t,e,i)=>{const s=i(21984),n=i(23622);t.exports=class extends s{component(){return new n(this)}}},16816:(t,e,i)=>{const s=i(86237),n=i(52668);t.exports=class extends s{component(){return new n(this)}}},48717:(t,e,i)=>{const s=i(49510),n=i(15796);s.defaultValues(),t.exports=class extends s{static get componentUI(){return n}component(){return new n(this)}parentFormUniqueID(t){var e=this.parentFormComponent();return t+(e?e.uniqueInstanceID:webix.uid())}}},24655:(t,e,i)=>{const s=i(59396),n=i(75727);t.exports=class extends s{component(){return new n(this)}}},87856:(t,e,i)=>{const s=i(84909),n=i(54194);t.exports=class extends s{component(){return new n(this)}}},62941:(t,e,i)=>{const s=i(83569),n=i(19215);t.exports=class extends s{component(){return new n(this)}}},38386:(t,e,i)=>{const s=i(71172),n=i(38719);t.exports=class extends s{component(){return new n(this)}}},26114:(t,e,i)=>{const s=i(54098),n=i(36059);t.exports=class extends s{component(){return new n(this)}}},48167:(t,e,i)=>{const s=i(87209),n=i(60306);t.exports=class extends s{component(){return new n(this)}}},56222:(t,e,i)=>{const s=i(80926),n=i(8690);t.exports=class extends s{component(){return new n(this)}}},87338:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>r});var s=i(26086);class n extends s.Z{constructor(t,e,i){super(t,e||`ABViewGantt_${t.id}`,Object.assign({menu:"",gantt:""},i)),this._tempDC=null,this.TitleField=null,this.StartDateField=null,this.EndDateField=null,this.DurationField=null,this.ProgressField=null,this.NotesField=null,this.originalStartDate=null,this.originalEndDate=null,this.pendingAdds={};const s=this.ids.gantt;this.ganttElement={isExistsTask:t=>{const e=$$(s).getService("local");if(!e)return!1;const i=e.tasks();return!(!i||!i.exists)&&i.exists(t)},removeTask:t=>{if(!this.ganttElement.isExistsTask(t))return;const e=$$(s).getService("operations");return e?e.removeTask(t):void 0}}}ui(){const t=this.ids,e=this,{YEAR_SCALE:i,MONTH_SCALE:s,DAY_SCALE:n}=this.getConstantScales,a=super.ui([{cols:[{fillspace:!0},{view:"menu",id:t.menu,layout:"x",width:300,data:[{id:"day",value:this.label("Day")},{id:"week",value:this.label("Week")},{id:"month",value:this.label("Month")},{id:"year",value:this.label("Year")}],on:{onItemClick:t=>{this.setScale(t)}}}]},{id:t.gantt,view:"gantt",scales:[i,s,n],override:new Map([[gantt.services.Backend,class extends gantt.services.Backend{async tasks(){const t=e.CurrentDatacollection;return t?(t.getData()||[]).map(((t,i)=>e.convertFormat(t,i))):[]}links(){return Promise.resolve([])}async addTask(t,i,s){e.pendingAdds[t.id]||(e.pendingAdds[t.id]=e.taskAdd(t));const n=await e.pendingAdds[t.id];return delete e.pendingAdds[t.id],{id:(n||{}).id}}async updateTask(t,i){return await e.taskUpdate(i.id,i)}async removeTask(t){return await e.taskRemove(t)}}]])}]);return delete a.type,a}async init(t){await super.init(t);const e=$$(this.ids.menu);e&&e.showItem("day")}get CurrentDatacollection(){return super.CurrentDatacollection||this._tempDC}convertFormat(t={},e=null){const i={},s=this.StartDateField,n=this.EndDateField,a=this.DurationField;if(!s||!n&&!a)return i;const r=new Date;i.id=t.id||t.uuid,i.type="task",i.parent=0,i.open=!0;const o=this.TitleField,l=this.ProgressField,h=this.NotesField;return i.text=o?t[o.columnName]||"":this.CurrentObject.displayData(t),i.start_date=t[s.columnName]||r,i.progress=l?parseFloat(t[l.columnName]||0):0,h&&(i.details=t[h.columnName]||""),n&&(i.end_date=t[n.columnName]||r),a&&(i.duration=t[a.columnName]||1),i.end_date||i.duration||(i.end_date=r,i.duration=1),e&&(i.order=e),i}convertValues(t){const e={},i=this.TitleField,s=this.StartDateField,n=this.ProgressField,a=this.NotesField,r=this.EndDateField,o=this.DurationField;return i&&(e[i.columnName]=t.text||""),s&&(e[s.columnName]=t.start_date),n&&(e[n.columnName]=parseFloat(t.progress||0)),a&&(e[a.columnName]=t.details),r&&(e[r.columnName]=t.end_date),o&&(e[o.columnName]=t.duration),e}objectLoad(t){super.objectLoad(t);const e=this.settings;t&&(this.TitleField=t.fieldByID(e.titleFieldID),this.StartDateField=t.fieldByID(e.startDateFieldID),this.EndDateField=t.fieldByID(e.endDateFieldID),this.DurationField=t.fieldByID(e.durationFieldID),this.ProgressField=t.fieldByID(e.progressFieldID),this.NotesField=t.fieldByID(e.notesFieldID))}datacollectionLoad(t){super.datacollectionLoad(t);const e=this.CurrentDatacollection||t;e&&(this._tempDC=t,this.objectLoad(e.datasource),["create","update","delete","initializedData"].forEach((t=>{t in e._events&&-1!==this.__events.findIndex((e=>e.eventName===t))||("delete"===t?this.eventAdd({emitter:e,eventName:"delete",listener:t=>{this.ganttElement.isExistsTask(t)&&this.ganttElement.removeTask(t)}}):this.eventAdd({emitter:e,eventName:t,listener:()=>{this.initData()}}))})))}hide(){$$(this.ids.component)?.hide()}initData(){const t=$$(this.ids.gantt);if(!t)return;const e=t.getService("local");if(!e)return;const i=e.tasks();i&&setTimeout((()=>{i.clearAll();const t=this.CurrentDatacollection,s={data:t?(t.getData()||[]).map(((t,e)=>this.convertFormat(t,e))):[]};this.StartDateField&&(this.EndDateField||this.DurationField)&&i.parse(s);const n=e.getScales();this.originalStartDate=n.start,this.originalEndDate=n.end,this.sort()}),10)}get getConstantScales(){return{DAY_SCALE:{unit:"day",format:"%d"},WEEK_SCALE:{unit:"week",format:t=>{const e=webix.Date.dateToStr("%d %M"),i=webix.Date.weekStart(t),s=webix.Date.add(webix.Date.add(i,1,"week",!0),-1,"day",!0);return e(i)+" - "+e(s)}},MONTH_SCALE:{unit:"month",format:"%F"},YEAR_SCALE:{unit:"year",format:"%Y"}}}setScale(t){const e=$$(this.ids.gantt);if(!e)return;const i=e.getService("local");if(!i)return;const s=[],{YEAR_SCALE:n,MONTH_SCALE:a,WEEK_SCALE:r,DAY_SCALE:o}=this.getConstantScales;switch(t){case"day":s.push(n,a,o);break;case"week":s.push(n,a,r);break;case"month":s.push(n,a);break;case"year":s.push(n)}const l=this.AB.Webix,h=e.getService("local").getScales(),c=l.Date.add(this.originalStartDate,-1,t,!0),d=l.Date.add(this.originalEndDate,1,t,!0);i.setScales(c,d,h.precise,h.cellWidth,h.cellHeight,s),e.$app.refresh(),e.getState().$batch({top:0,left:0})}onShow(){super.onShow(),this.datacollectionLoad(this.datacollection),$$(this.ids.component)?.show()}sort(){}async taskAdd(t){const e=this.convertValues(t),i=this.AB;try{return await(this.CurrentObject?.model().create(e))}catch(t){throw i.Webix.alert({title:this.label("Error Saving Item"),ok:this.label("Okay"),text:this.label("Unable to save this item.")}),i.notify.developer(t,{context:"ABViewGantt:taskAdd(): Error Saving Item",patch:e}),t}}async taskRemove(t){const e=this.AB;try{return await this.CurrentObject.model().delete(t),{}}catch(i){throw e.Webix.alert({title:this.label("Error Removing Item"),ok:this.label("Okay"),text:this.label("Unable to remove this item.")}),e.notify.developer(i,{context:"ABViewGantt:taskRemove(): Error Removing Item",rowId:t}),i}}async taskUpdate(t,e){const i=this.convertValues(e),s=this.AB;try{return await this.CurrentObject.model().update(t,i),{}}catch(t){throw s.Webix.alert({title:this.label("Error Updating Item"),ok:this.label("Okay"),text:this.label("Unable to update this item.")}),s.notify.developer(t,{context:"ABViewGantt:taskUpdate(): Error Updating Item",patch:i}),t}}}const a=i(66959);class r extends a{constructor(t,e,i,s){super(t,e,i,s)}component(){return new n(this)}warningsEval(){super.warningsEval();let t=this.datacollection;if(t)if(this.settings.startDateFieldID){let e=t.datasource?.fieldByID(this.settings.startDateFieldID);e||this.warningsMessage(`can't lookup field: startDate[${this.settings.startDateFieldID}]`)}else this.warningsMessage("doesn't have a start date field set.");else this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},42774:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>p});var s=i(26086),n=i(32735);class a extends n.Z{constructor(t){super({popupExport:`${t=t||"abviewgridpopupExport"}_popupExport`,list:`${t}_popupExport_list`}),this._currentObject=null,this._dataCollection=null,this._grid=null,this._filename=null,this._hiddenFields=[]}ui(){var t=this;return{view:"popup",id:this.ids.popupExport,width:160,height:0,select:!1,hidden:!0,body:{id:this.ids.list,view:"list",autoheight:!0,data:[{name:"CSV",icon:"file-excel-o"},{name:"Excel",icon:"file-excel-o"},{name:"PDF",icon:"file-pdf-o"},{name:"PNG",icon:"file-image-o"}],template:"<div><i class='fa fa-#icon# webix_icon_btn' aria-hidden='true'></i> #name#</div>",on:{onItemClick:function(e){var i=this.getItem(e);t.export(i.name)}}}}}async init(t){t&&(this.AB=t),webix.ui(this.ui()),$$(this.ids.popupExport).resize()}dataCollectionLoad(t){this._dataCollection=t}objectLoad(t){this._currentObject=t}setHiddenFields(t=[]){this._hiddenFields=t??[]}setFilename(t){this._filename=t}setGridComponent(t){this._grid=t}show(t){$$(this.ids.popupExport).show(t)}async export(t){let e,i={},s=this._dataCollection,n=this._currentObject,a=this._grid,r=this._filename;!s||s.settings.loadAll&&s.dataStatus!=s.dataStatusFlag.notInitial||(await s.reloadData(0,null),s.settings.loadAll=!0),n&&n.fields().forEach((t=>{this._hiddenFields.indexOf(t.columnName)>-1||(i[t.columnName]={template:e=>t.format(e)})}));const o=a.data.find({appbuilder_select_item:1}).length<1,l=t=>o||1==t?.appbuilder_select_item;switch(t){case"CSV":webix.csv.delimiter.cols=",",e=webix.toCSV(a,{filename:r||(n?n.label:null),columns:i,filter:l});break;case"Excel":e=webix.toExcel(a,{filename:r||(n?n.label:null),name:r||(n?n.label:null),columns:i,filterHTML:!0,filter:l});break;case"PDF":e=webix.toPDF(a,{filename:r||(n?n.label:null),filterHTML:!0,filter:l});break;case"PNG":e=webix.toPNG(a,{filename:r||(n?n.label:null)})}try{await e,$$(this.ids.popupExport).hide()}catch(e){this.AB.notify.developer(e,{message:`ABViewGridPopupExport:export(): System could not export: ${t}`,exportType:t,columns:i,fileName:r})}}}var r=i(82021),o=null;class l extends n.Z{constructor(t,e){super({component:`${e=e||"abviewgridpopupMassUpdate"}_popupMassUpdate`,submit:`${e}_submitMassUpdate`}),this.CurrentObject=null,this.GridComponent=t,this.AB=t.AB,this.rowUpdater=new r.Z(e,this.AB),o||(o=(...t)=>this.AB.Multilingual.label(...t))}ui(){var t=this.ids;return{view:"popup",id:t.component,body:{width:500,rows:[this.rowUpdater.ui(),{height:15},{cols:[{},{view:"button",value:o("Cancel"),width:100,click:()=>{this.hide()}},{id:t.submit,css:"webix_primary",view:"button",label:o("Update"),type:"form",width:120,click:()=>{this.submit()}}]}]},on:{onShow:()=>{this.onShow()}}}}async init(t){return webix.ui(this.ui()),this.rowUpdater.init(t),Promise.resolve()}hide(){$$(this.ids.component).hide()}objectLoad(t,e){this.CurrentObject=t,this.rowUpdater.objectLoad(t),this.DataTable=e}onShow(){}show(t,e=null){null!=e?$$(this.ids.component).show(t,e):$$(this.ids.component).show(t)}submit(){let t=$$(this.ids.submit),e=this.rowUpdater.getValue()||[];if(t.disable(),!this.GridComponent)return void t.enable();if(e.length<1)return void t.enable();let i=this.GridComponent.getDataTable(),s=[];i.data.each((function(t){t&&t.hasOwnProperty("appbuilder_select_item")&&1==t.appbuilder_select_item&&s.push(t.id)}));let n={};e.forEach((t=>{let e=this.CurrentObject.fieldByID(t.fieldId);e&&(n[e.columnName]=t.value)})),s.length>0?webix.confirm({title:o("Updating Multiple Records"),text:o("Are you sure you want to update the selected records?"),callback:e=>{e?(i&&i.showProgress&&i.showProgress({type:"icon"}),this.CurrentObject.model().batchUpdate({rowIds:s,values:n}).then((()=>{t.enable(),this.hide(),i&&i.hideProgress&&i.hideProgress()})).catch((t=>{this.AB.notify.developer(t,{context:"ABViewGridPopupMassUpdate:submit(): Error during batchUpdate",rowIds:s,values:n})}))):t.enable()}}):(webix.alert({title:o("No Records Selected"),text:o("You need to select at least one record...did you drink your coffee today?")}),t.enable(),this.hide())}}var h=i(60732);class c extends s.Z{constructor(t,e,i){super(t,e||`ABViewGrid_${t.id}`,Object.assign({table:"",toolbar:"",buttonDeleteSelected:"",buttonFilter:"",buttonMassUpdate:"",buttonSort:"",buttonExport:"",globalSearchToolbar:"",datatable:""},i)),this._handler_filterData=(t,e)=>{this.callbackFilterData(t,e)},this.handler_select=(...t)=>{this.selectRow(...t)},this.detatch(),t.filterHelper.on("filter.data",this._handler_filterData),this.id=t.id,this.columnSplitLeft=0,this.columnSplitRight=0,this.validationError=!1,this.linkPage=t.linkPageHelper.component();const s=this.ids.table,n=this.AB;this.PopupExport=new a(s),this.PopupExport.init(n),this.PopupMassUpdateComponent=new l(this,s),this.PopupMassUpdateComponent.init(n),this.PopupSortDataTableComponent=new h.Z(s),this.PopupSortDataTableComponent.init(n),this.PopupSortDataTableComponent.on("changed",(t=>{this.callbackSortData(t)})),this.skippableColumns=["appbuilder_select_item","appbuilder_view_detail","appbuilder_view_track","appbuilder_view_edit","appbuilder_trash"],this.ignoreLocalSettings=!1,this._gridSettings=null,this._isDatacollectionLoaded=!1}get keyStorageSettings(){return"abviewgrid_settings"}detatch(){this.view.filterHelper.removeAllListeners("filter.data"),this.datacollection?.removeListener("changeCursor",this.handler_select)}getColumnIndex(t){let e=this.getDataTable().getColumnIndex(t);return this.settings.massUpdate||e++,e}uiDatatable(){const t=this.ids,e=this.settings,i=this;let s="datatable";(e.isTreeDatable||e.groupBy)&&(s="treetable");let n="cell";return e.isEditable||!e.detailsPage&&!e.editPage||(n="row"),{view:s,id:t.datatable,resizeColumn:{size:10},resizeRow:{size:10},prerender:!1,editable:e.isEditable,fixedRowHeight:!1,height:e.height||0,editaction:"custom",select:n,footer:e.summaryColumns.length>0||e.countColumns.length>0,tooltip:!0,dragColumn:!0,on:{onBeforeSelect:function(t,s){if(-1!=i.skippableColumns.indexOf(t.column))return!1;if(e.isEditable){const e=i.datacollection.datasource.fields((e=>e.columnName===t.column))[0];if(null==e)return!0;const s=this.getItemNode({row:t.row,column:t.column}),n=this.getItem(t.row);return e.customEdit(n,null,s)}return!(!e.detailsPage&&!e.editPage)&&void 0},onAfterSelect:(t,e)=>{this.settings.isEditable&&this.onAfterSelect(t,e)},onBeforeEditStart:function(t){if("appbuilder_select_item"==!this.getItem(t))return!1},onCheck:function(t,s,n){if("appbuilder_select_item"==s)i.toggleUpdateDelete();else if(e.isEditable){const e={value:n},a={row:t,column:s,config:null};i.onAfterEditStop(e,a)}else{this.getItemNode({row:t,column:s}).querySelector('input[type="checkbox"]').checked=1!=n}},onBeforeEditStop:function(t,e){},onAfterEditStop:(t,e,i)=>{0==this.validationError&&this.onAfterEditStop(t,e,i)},onValidationError:function(){this.validationError=!0},onValidationSuccess:function(){this.validationError=!1},onColumnResize:function(t,e,s,n){if(-1!=["appbuilder_view_detail","appbuilder_view_track","appbuilder_view_edit","appbuilder_trash"].indexOf(t)){this.blockEvent(),this.setColumnWidth(t,s),this.unblockEvent();const n=i.getLastColumn();t=n.id,(e=e<s?n.width+40:n.width-(e-40))<50&&(e=50),n.minWidth=e,this.setColumnWidth(t,e)}n&&i.onColumnResize(t,e,s,n)},onRowResize:t=>{},onBeforeColumnDrag:(t,e)=>!(-1!==this.skippableColumns.indexOf(t)),onBeforeColumnDrop:(t,e,i)=>!(-1!==this.skippableColumns.indexOf(e)),onAfterColumnDrop:(t,e,i)=>this.onAfterColumnDrop(t,e,i),onHeaderClick:(t,e,i)=>{this.onHeaderClick(t,e,i)}}}}uiFilter(){return this.view.filterHelper.ui()}uiToolbar(){const t=this.ids,e=this;return{view:"toolbar",id:t.toolbar,hidden:!0,css:"ab-data-toolbar",cols:[{view:"button",id:t.buttonMassUpdate,css:"webix_transparent",label:this.label("Edit"),icon:"fa fa-pencil-square-o",type:"icon",disabled:!0,autowidth:!0,click:function(){e.toolbarMassUpdate(this.$view)}},{view:"button",id:t.buttonDeleteSelected,css:"webix_transparent",label:this.label("Delete"),icon:"fa fa-trash",type:"icon",disabled:!0,autowidth:!0,click:function(){e.toolbarDeleteSelected(this.$view)}},{view:"button",id:t.buttonFilter,css:"webix_transparent",label:this.label("Filters"),icon:"fa fa-filter",type:"icon",autowidth:!0,click:function(){e.toolbarFilter(this.$view)}},{view:"button",id:t.buttonSort,css:"webix_transparent",label:this.label("Sort"),icon:"fa fa-sort",type:"icon",autowidth:!0,click:function(){e.toolbarSort(this.$view)}},{view:"button",id:t.buttonExport,css:"webix_transparent",label:this.label("Export"),icon:"fa fa-print",type:"icon",autowidth:!0,click:function(){e.toolbarExport(this.$view)}},{},{id:t.globalSearchToolbar,view:"search",placeholder:this.label("Search..."),on:{onTimedKeyPress:()=>{const e=$$(t.globalSearchToolbar).getValue();this.view.filterHelper.externalSearchText(e)}}}]}}ui(){const t={id:this.ids.table,type:"space",borderless:!0,rows:[{},{view:"label",label:this.label("Select an object to load."),inputWidth:200,align:"center"},{}]},e=this.settings;(this.datacollection||""!==e.dataviewID)&&(t.padding=e.padding,t.rows=[],e.showToolbar&&t.rows.push(this.uiToolbar()),this.settings.gridFilter.filterOption&&t.rows.push(this.uiFilter()),t.rows.push(this.uiDatatable()));const i=super.ui([t]);return delete i.type,i}async init(t,e=2){t&&await super.init(t);const i=this,s=this.ids,n=t.Webix;n.codebase="",n.cdn="/js/webix";const a=this.getDataTable();let r=null,o=null;if(!a)return;n.extend(a,n.ProgressBar),a.config.accessLevel=e,e<2&&a.define("editable",!1);const l=this.settings,h=t=>{const e=this.datacollection?.datasource;if(!e||!a.data)return;const i=[],s=a.getScrollState().y,n=a.config.rowHeight,r=(a.$view.querySelector(".webix_ss_body").clientHeight,Math.floor(s/n)),o=r+a.getVisibleCount();let h=0;a.data.order.each((t=>{null!=t&&r<=h&&h<=o&&i.push(t),h++}));let c=l.isEditable;a.config.accessLevel<2&&(c=!1),e.customDisplays(t,this.AB._App,a,i,c)};a.attachEvent("onAfterRender",(function(e){a.resize(),r&&clearTimeout(r),r=setTimeout((()=>{o&&clearTimeout(o),h(this.data)}),350),t.ClassUI.CYPRESS_REF(a),Object.keys(s).forEach((e=>{const i=$$(s[e]);i&&t.ClassUI.CYPRESS_REF(i)}))})),a.attachEvent("onScroll",(function(){o&&clearTimeout(o),r&&clearTimeout(r),o=setTimeout((()=>{h(this.data)}),1500)})),a.attachEvent("onAfterScroll",(function(){r&&clearTimeout(r),r=setTimeout((()=>{o&&clearTimeout(o),h(this.data)}),350)})),a.attachEvent("onItemClick",(function(t,e,s){const r=i.datacollection,o=r?.datasource;if(o)if(0===l.isEditable&&a.getItem(t),"auto"===e||e.target.className.indexOf("eye")>-1)i.changePage(r,t,l.detailsPage),i.toggleTab(l.detailsTab,this);else if(e.target.className.indexOf("pencil")>-1)i.changePage(r,t,l.editPage),i.toggleTab(l.editTab,this);else if(e.target.className.indexOf("track")>-1)i.emit("object.track",o,t.row);else if(e.target.className.indexOf("clear-combo-value")>-1){const e={};e[t.column]="",(async()=>{try{await o.model().update(t.row,e)}catch(e){i.AB.notify.developer(e,{context:"ABViewGridComponent.onItemClick",message:"Error updating item",obj:o.toObj(),id:t.row})}})()}else e.target.className.indexOf("trash")>-1?n.confirm({title:i.label("Delete data"),text:i.label("Do you want to delete this row?"),callback:function(e){return e&&(async()=>{try{(await o.model().delete(t.row)).numRows>0?(a.remove(t),a.clearSelection()):n.alert({text:i.label("No rows were effected.  This does not seem right.")})}catch(e){i.AB.notify.developer(e,{context:"ABViewGridComponent.onItemClick",message:"Error deleting item",obj:o.toObj(),id:t.row})}})(),a.clearSelection(),!0}}):l.detailsPage.length?(i.changePage(r,t,l.detailsPage),i.toggleTab(l.detailsTab,this)):l.editPage.length&&(i.changePage(r,t,l.editPage),i.toggleTab(l.editTab,this))})),l.showToolbar&&((l.massUpdate||l.isSortable||l.isExportable||l.gridFilter&&l.gridFilter.filterOption&&"toolbar"===l.gridFilter.userFilterPosition)&&$$(s.toolbar).show(),l.massUpdate||($$(s.buttonMassUpdate).hide(),$$(s.buttonDeleteSelected).hide()),l.allowDelete||$$(s.buttonDeleteSelected).hide(),l.gridFilter&&(1===l.gridFilter.filterOption&&"toolbar"===l.gridFilter.userFilterPosition||$$(s.buttonFilter).hide(),3===l.gridFilter.filterOption&&"single"===l.gridFilter.globalFilterPosition&&a.hide(),l.gridFilter.isGlobalToolbar?$$(s.globalSearchToolbar).show():$$(s.globalSearchToolbar).hide(),l.gridFilter.filterOption&&this.view.filterHelper.init(this.AB)),l.isSortable||$$(s.buttonSort).hide(),l.isExportable||$$(s.buttonExport).hide()),l.hideHeader&&this.hideHeader();const c=this.datacollection||this.AB.datacollectionByID(l.dataviewID);this._isDatacollectionLoaded||this.datacollectionLoad(c),this._gridSettings=this._gridSettings||await this.AB.Storage.get(this.keyStorageSettings)||{},c?.datasource&&(this.linkPage.init({view:this.view,datacollection:c}),this.refreshHeader())}busy(){this.getDataTable()?.showProgress?.({type:"icon"})}callbackFilterData(t,e=[]){const i=this.ids,s=$$(i.buttonFilter);if(s){const t=this.view.filterHelper.filterRules();s.define("badge",t?.rules?.length??0),s.refresh()}const n=this.datacollection;n.filterCondition(e),n.reloadData()}async callbackSortData(t=[]){const e=$$(this.ids.buttonSort);e.define("badge",t.length||null),e.refresh();const i=this.getDataTable();if(i.data.find({}).length<i.data.count())try{await this.datacollection.reloadData(0,0)}catch(t){this.AB.notify.developer(t,{context:"ABViewGrid:callbackSortData(): Error perform datacollection.reloadData()"})}setTimeout((()=>{i.sort(((t,e)=>this.PopupSortDataTableComponent.sort(t,e)))}),777)}changePage(t,e,i){const s=e?.row??null;t&&t.setCursor(s),this.linkPage&&this.linkPage.changePage(i,s),super.changePage(i)}columnConfig(t=[]){this.settings.columnConfig=t}datacollectionLoad(t){const e=this.datacollection;this.datacollection=t;const i=t?.datasource,s=this.getDataTable();s&&(this.__handler_dc_busy||(this.__handler_dc_busy=()=>{this.busy()},this.__handler_dc_ready=()=>{this.ready(),this.populateGroupData()},this.__handler_dc_loadData=()=>{this.populateGroupData()}),e&&(e.removeListener("initializingData",this.__handler_dc_busy),e.removeListener("initializedData",this.__handler_dc_ready),e.removeListener("loadData",this.__handler_dc_loadData)),t?(t.datacollectionLink&&t.fieldLink?t.bind(s,t.datacollectionLink,t.fieldLink):t.bind(s),t.removeListener("initializingData",this.__handler_dc_busy),t.on("initializingData",this.__handler_dc_busy),t.removeListener("initializedData",this.__handler_dc_ready),t.on("initializedData",this.__handler_dc_ready),t.removeListener("loadData",this.__handler_dc_loadData),t.on("loadData",this.__handler_dc_loadData),this.grouping(),this._isDatacollectionLoad=!0):s.unbind(),i&&(this.view.filterHelper.objectLoad(i),this.PopupMassUpdateComponent.objectLoad(i,this.getDataTable()),this.PopupSortDataTableComponent.objectLoad(i),this.PopupExport.objectLoad(i),this.PopupExport.dataCollectionLoad(t),this.PopupExport.setGridComponent(this.getDataTable()),this.PopupExport.setHiddenFields(this.settings.hiddenFields),this.PopupExport.setFilename(this.view.label)))}disableUpdateDelete(){$$(this.ids.buttonMassUpdate)?.disable(),$$(this.ids.buttonDeleteSelected)?.disable(),this.emit("selection.cleared")}enableUpdateDelete(){$$(this.ids.buttonMassUpdate)?.enable(),$$(this.ids.buttonDeleteSelected)?.enable(),this.emit("selection")}freezeDeleteColumn(){return this.getDataTable().define("rightSplit",this.columnSplitRight)}getDataTable(){return $$(this.ids.datatable)}getLastColumn(){const t=this.getDataTable();let e={};return t.eachColumn((i=>{const s=t.getColumnConfig(i);1===s.split&&(e=s)})),e}grouping(){if(!this.settings.groupBy)return;const t=this.getDataTable(),e={};this.datacollection.datasource.fields().forEach((t=>{switch(t.key){case"number":e[t.columnName]=[t.columnName,"sum"];break;case"calculate":case"formula":e[t.columnName]=[t.columnName,(e,i)=>{if(!i)return 0;let s=0;if(i.forEach((e=>{s+=1*t.format(e,!1,!0)})),t.fieldLink&&"calculate"!==t.fieldLink.key){const e={};return e[t.fieldLink.columnName]=s,t.fieldLink.format(e)}return s}];break;case"connectObject":e[t.columnName]=[t.columnName,(e,i)=>{if(!i||!i.length)return 0;let s=0;return i.forEach((e=>{const i=e[t.relationName()];i?.length?s+=i.length:i&&(s+=1)})),s}];break;default:e[t.columnName]=[t.columnName,function(t,e){if(!e||!e.length)return 0;let i=0;return e.forEach((e=>{t(e)&&(i+=1)})),i}]}}));let i=(this.settings.groupBy||"").split(",").map((t=>t.trim()));i=i.reverse(),i.forEach(((s,n)=>{const a=this.AB.cloneDeep(e);let r;n===i.length-1?r=s:(r=t=>{let e=t[s];for(let s=n+1;s<i.length;s++)e=`${t[i[s]]} - ${e}`;return e},i.forEach((t=>{t!==s&&(a[t]=[t])}))),t.data.group({by:r,map:a})}))}hideHeader(){const t=this.getDataTable();t.define("header",!1),t.refresh()}async onAfterColumnDrop(t,e,i){this.getDataTable(),this.datacollection.datasource;const s=this.settings,n=this.localSettings();let a=null,r=0;for(let e=0;e<n.length;e++)if(n[e].id==t){a=n[e],n.splice(e,1),r=e;break}for(let t=0;t<n.length;t++)if(n[t].id==e){r<=t&&t++,n.splice(t,0,a);break}this.localSettings(n),s.saveLocal&&this.localSettingsSave(),this.emit("column.order",n.map((t=>t.fieldID))),this.refreshHeader()}async onAfterEditStop(t,e,i){const s=this.getDataTable();if(!t.old&&""===t.value||""===t.old&&""===t.value)return s.clearSelection(),!1;if(e.config)switch(e.config.editor){case"number":t.value=parseFloat(t.value);break;case"datetime":t.value=t.value.getTime(),t&&t.old&&t.old.getTime&&(t.old=t.old.getTime())}if(t.value!==t.old){const i=s.getItem(e.row);i[e.column]=t.value,s.removeCellCss(i.id,e.column,"webix_invalid"),s.removeCellCss(i.id,e.column,"webix_invalid_cell");const n=this.datacollection.datasource,a=n.isValidData(i);if(a.pass()){const a=this.AB;try{await n.model().update(i.id,i),s.exists(e.row)&&(s.updateItem(e.row,i),s.clearSelection(),s.refresh(e.row))}catch(r){a.notify.developer(r,{context:"ABViewGrid:onAfterEditStop(): Error saving item",item:i,editor:e,state:t,object:n.toObj()}),s.clearSelection(),a.Validation.isGridValidationError(r,e.row,s)}}else a.updateGrid(e.row,s)}else s.clearSelection();return!1}onAfterSelect(t){this.getDataTable()?.editCell(t.row,t.column)}async onColumnResize(t,e,i,s){let n=!1;const a=this.AB;e<30&&(e=30,n=!0,a.Webix.message({type:"info",text:this.label("minimum column width is {0}",[30]),expire:1e3}));const r=this.localSettings();if(r){const i=r.find((e=>e.id==t));i&&(i.width=e,delete i.adjust)}this.localSettings(r),this.settings.saveLocal&&await this.localSettingsSave(),n&&this.refreshHeader(),this.freezeDeleteColumn(),this.emit("column.resize",t,e,i)}onHeaderClick(t,e,i){if(-1!==this.skippableColumns.indexOf(t.column))return!1;const s=this.datacollection.datasource.fields((e=>e.columnName===t.column))[0];return this.emit("column.header.clicked",i,s),!1}onShow(){super.onShow(),this.getDataTable()?.adjust();const t=this.datacollection;t&&this.eventAdd({emitter:t,eventName:"changeCursor",listener:this.handler_select.bind(this)})}ready(){const t=this.datacollection;this.isCustomGroup&&t?.dataStatus!=t?.dataStatusFlag.initialized||this.getDataTable()?.hideProgress?.()}refreshHeader(t=this.ignoreLocal){const e=this.datacollection.datasource;if(!e)return;const i=this.ids,s=$$(i.datatable);if(!s)return;const n=s.config.accessLevel;s.define("leftSplit",0),s.define("rightSplit",0);let a=0;e.imageFields().forEach((t=>{const e=t.getSettings();e.useHeight&&e.imageHeight>a&&(a=e.imageHeight)})),a&&s.define("rowHeight",a);const r=this.settings;let o=r.isEditable;s.config.accessLevel<2&&(o=!1);const l=e.columnHeaders(!0,o,[],[],[]);let h=this.localSettings();const c=this.AB;h&&!t||(h=c.cloneDeep(this.settings.columnConfig)),0===h.length&&(h=l);const d=l.map((t=>t.fieldID));h=h.filter((t=>d.indexOf(t.fieldID)>-1)),h.forEach((t=>{const i=l.find((e=>e.fieldID===t.fieldID));Object.keys(i).forEach((e=>{"function"!=typeof i[e]&&"suggest"!==e||(t[e]=i[e])}));const s=e.fieldByID(t.fieldID);s&&(r.hiddenFields.indexOf(s.columnName)>-1&&(t.hidden=!0),r.summaryColumns.indexOf(s.id)>-1?"calculate"==s.key||"formula"==s.key?t.footer={content:"totalColumn",field:s}:t.footer={content:"summColumn"}:r.countColumns.indexOf(s.id)>-1&&(t.footer={content:"countColumn"}))}));let u=this.localSettings();u&&!t||(this.localSettings(h),u=h),h=c.cloneDeep(u);const _=[],p=[];if(h.forEach((t=>{if(t.fillspace=!1,t.validationRules&&("string"==typeof t.validationRules&&(t.validationRules=JSON.parse(t.validationRules)),t.validationRules.length)){const e=[];t.validationRules.forEach((i=>{const s=c.filterComplexNew(t.id);e.push(s.ui),_.push({filter:s,view:s.ids.querybuilder,columnName:t.id,validationRules:i.rules,invalidMessage:i.invalidMessage})}));const s=i.rules+"_"+t.id;p.push(s),c.Webix.ui({view:"popup",css:"ab-rules-popup",id:s,body:{rows:e}})}if(r.groupBy&&(r.groupBy||"").indexOf(t.id)>-1){const i=e.fieldByID(t.fieldID);i&&(t.template=(t,e)=>{if(t.$group){const s=c.cloneDeep(t);return s[i.columnName]=s.value,e.treetable(t,e)+i.format(s)}return i.format(t)})}})),_.length){const t=[];_.forEach((i=>{i.filter.fieldsLoad(e.fields()),i.filter.setValue(i.validationRules),Array.isArray(t[i.columnName])||(t[i.columnName]=[]),t[i.columnName].push({filters:$$(i.view).getFilterHelper(),values:s.getSelectedItem(),invalidMessage:i.invalidMessage})}));const i={};s.$view.complexValidations=t,Object.keys(t).forEach((t=>{i[t]=(i,n)=>{let a=!0,r="";return s.$view.complexValidations[t].forEach((t=>{const i={};(e.fields()||[]).forEach((t=>{i[t.id]=n[t.columnName]})),n.uuid&&(i.this_object=n.uuid),t.filters(i)||(a=!1,r=t.invalidMessage)})),a||c.Webix.message({type:"error",text:r}),a}})),s.define("rules",i),s.config.rulePops=p,s.refresh()}else s.config.rulePops&&s.config.rulePops.forEach((t=>{$$(t)&&$$(t).destructor()})),s.define("rules",{}),s.refresh();const f=[];r.labelAsField&&(h.unshift({id:"appbuilder_label_field",header:"Label",fillspace:!0,template:t=>e.displayData(t)}),f.push("appbuilder_label_field")),r.massUpdate&&2===n?(h.unshift({id:"appbuilder_select_item",header:{content:"masterCheckbox",contentId:"mch"},width:40,template:"<div class='singleSelect'>{common.checkbox()}</div>",css:{"text-align":"center"}}),this.columnSplitLeft=1,f.push("appbuilder_select_item")):this.columnSplitLeft=0,""===r.detailsPage||r.hideButtons||(h.push({id:"appbuilder_view_detail",header:"",width:40,template:(t,e)=>"<div class='detailsView'><span class='webix_icon fa fa-eye'></span></div>",css:{"text-align":"center"}}),f.push("appbuilder_view_detail")),0!==r.trackView&&2===n&&(h.push({id:"appbuilder_view_track",header:"",width:40,template:"<div class='track'><span class='track fa fa-history'></span></div>",css:{"text-align":"center",cursor:"pointer"}}),f.push("appbuilder_view_track")),""===r.editPage||r.hideButtons||2!==n||(h.push({id:"appbuilder_view_edit",header:"",width:40,template:"<div class='edit'>{common.editIcon()}</div>",css:{"text-align":"center"}}),f.push("appbuilder_view_edit")),r.allowDelete&&2===n&&(h.push({id:"appbuilder_trash",header:"",width:40,template:"<div class='trash'>{common.trashIcon()}</div>",css:{"text-align":"center"}}),f.push("appbuilder_trash"));let g=null;for(let t=h.length-1;t>=0;t--)if(!g){const e=h[t];if(!e.hidden&&-1===f.indexOf(e.id)){g=e;break}}g&&(g.fillspace=!0,g.minWidth=g.width,g.width=150),s.refreshColumns(h),this.columnSplitRight=f.length,f.indexOf("appbuilder_select_item")>-1&&(this.columnSplitRight-=1),this.columnSplitRight<0&&(this.columnSplitRight=0);const m=r.frozenColumnID;""!=m?s.define("leftSplit",s.getColumnIndex(m)+1):s.define("leftSplit",this.columnSplitLeft),this.freezeDeleteColumn(),s.refreshColumns()}async localSettingsSave(){const t=this.AB,e=await t.Storage.get(this.keyStorageSettings)||{},i=this._gridSettings;e[this.settingsID()]=i[this.settingsID()]?i[this.settingsID()]:[];for(const t in e)e[t].forEach((t=>{t?.footer?.field&&delete t.footer.field}));await t.Storage.set(this.keyStorageSettings,e)}localSettings(t=null){const e=this._gridSettings;if(!t)return e[this.settingsID()];e[this.settingsID()]=t}selectRow(t){const e=this.getDataTable();e&&(t?t?.id&&e.exists(t.id)?e.select(t.id,!1):e.select(null,!1):e.unselect())}settingsID(){const t=this.datacollection.datasource;return`${this.id}-${t?t.id:"0"}`}toggleTab(t,e){const i=e.getTopParentView().queryView({id:t})||$$(t);if(!i)return;const s=i.getParentView().getParentView();if(!s)return;s.setValue&&s.setValue(t);const n=s.queryView({view:"scrollview"},"parent");n&&this.toggleTab(n,e)}toggleUpdateDelete(){const t=this.getDataTable();let e=0;t.data.each((t=>{void 0!==t&&Object.prototype.hasOwnProperty.call(t,"appbuilder_select_item")&&1===t.appbuilder_select_item&&e++})),e>0?this.enableUpdateDelete():this.disableUpdateDelete()}toolbarDeleteSelected(t){const e=this.getDataTable(),i=this.datacollection.datasource,s=[];e.data.each((t=>{void 0!==t&&Object.prototype.hasOwnProperty.call(t,"appbuilder_select_item")&&1===t.appbuilder_select_item&&s.push((()=>i.model().delete(t.id)))}));const n=this.AB.Webix;s.length>0?n.confirm({title:this.label("Delete Multiple Records"),text:this.label("Are you sure you want to delete the selected records?"),callback:async t=>{t&&(await Promise.all(s.map((t=>t()))),this.disableUpdateDelete())}}):n.alert({title:this.label("No Records Selected"),text:this.label("You need to select at least one record...did you drink your coffee today?")})}toolbarFilter(t){this.view.filterHelper.showPopup(t)}toolbarSort(t){this.PopupSortDataTableComponent.show(t)}toolbarExport(t){this.PopupExport.show(t)}toolbarMassUpdate(t){this.PopupMassUpdateComponent.show(t)}toolTip(t,e){const i=this.datacollection.datasource,s=i.imageFields().map((t=>t.columnName));let n="";const a=e.column.id.replace(" ","");if(Array.isArray(t[a]))t[a].forEach((function(t){t.text&&(n+=t.text+"<br/>")}));else if(void 0!==t[a+"__relation"]&&"number"==typeof t[a])n=t[a+"__relation"].text;else if(void 0!==t[a+"__relation"]){let e=t[a+"__relation"];Array.isArray(e)||(e=[e]),(e||[]).forEach((function(t){t&&(n+=t.text+"<br/>")}))}else if(-1!==s.indexOf(a)){if(!t[a])return"";n=`<img style='max-width: 500px; max-height: 500px;' src='/file/${t[a]}' />`}else"date"===e.column.editor?n=e.column.format(t[a]):"richselect"===e.column.editor?i.fields().forEach((e=>{e.columnName===a&&e.settings.options&&e.settings.options.forEach((e=>{e.id===t[a]&&(n=e.text)}))})):n=t[a];return n||""}toolTipOnBeforeRender(t){t.style.visibility="hidden"}toolTipOnAfterRender(t){"IMG"===t.firstChild?.nodeName?setTimeout((()=>{const e=parseInt(t.style.top.replace("px",""))+500,i=parseInt(t.style.left.replace("px",""))+500;if(e>window.innerHeight){const i=e-window.innerHeight,s=parseInt(t.style.top.replace("px",""))-i;t.style.top=s+"px"}if(i>window.innerWidth){const e=i-window.innerWidth,s=parseInt(t.style.left.replace("px",""))-e;t.style.left=s+"px"}t.style.visibility="visible"}),250):t.style.visibility="visible"}get isCustomGroup(){const t=this.datacollection?.datasource;return"treetable"===this.getDataTable()?.config?.view&&!t?.isGroup}populateGroupData(){if(!this.isCustomGroup)return;this.busy();const t=this.datacollection,e=this.getDataTable();e.clearAll(),e.parse(t.getData()||[]),this.grouping(),this.ready()}}var d=i(84204);const u=i(12268),_=i(95782).Z;class p extends u{fromValues(t){super.fromValues(t),this.filterHelper.fromSettings(this.settings.gridFilter)}propertyGroupByList(t,e){let i=e||[];"string"==typeof i&&(i=i.split(","));let s=$$(t.groupBy).getList().data.find({});$$(t.groupByList).clearAll(),i.forEach((e=>{let i=s.filter((t=>t.id==e))[0];i&&$$(t.groupByList).add(i)}))}component(){return new c(this)}get filterHelper(){return null==this.__filterHelper&&(this.__filterHelper=new d.Z(this.AB,`${this.id}_filterHelper`)),this.__filterHelper}get linkPageHelper(){return null==this.__linkPageHelper&&(this.__linkPageHelper=new _),this.__linkPageHelper}warningsEval(){super.warningsEval();let t=this.warningsSilent;this.warningsSilent=!0;let e=this.datacollection;this.warningsSilent=t,e||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},60732:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var s=i(32735),n=null;class a extends s.Z{constructor(t){super({component:`${t=t||"abviewgridpopupSortFields"}_popupSort`,list:`${t}_popupSort_list`,form:`${t}_popupSort_form`}),this.CurrentObject=null,this._blockOnChange=!1,this._settings=null,n||(n=(...t)=>this.AB.Multilingual.label(...t))}uiForm(){const t=this.ids.component;return{view:"form",id:this.ids.form,borderless:!0,elements:[{view:"button",type:"form",css:"webix_primary",value:n("Add new sort"),on:{onItemClick:()=>{this.clickAddNewSort(),this.triggerOnChange()},onAfterRender:function(){this.getInputNode().setAttribute("data-cy",`${t} add sort button`)}}}]}}ui(){return{view:"popup",id:this.ids.component,width:600,body:this.uiForm()}}async init(t){t&&(this.AB=t),$$(this.ids.component)||webix.ui(this.ui())}clickAddNewSort(t,e){var i=this,s=$$(this.ids.form),a=s.getChildViews().length-1,r=this.getFieldList(!0);s.addView({id:"sort"+webix.uid(),cols:[{view:"combo",width:220,options:r,on:{onChange:function(t){i.onChangeCombo(t,this)}}},{view:"segmented",width:200,options:[{id:"",value:n("Please select field")}],on:{onChange:()=>{this.triggerOnChange()}}},{view:"button",css:"webix_danger",icon:"fa fa-trash",type:"icon",width:30,on:{onItemClick:function(){s.removeView(this.getParentView()),i.refreshFieldList(!0),i.triggerOnChange()}}}]},a),t&&s.getChildViews()[a].getChildViews()[0].setValue(t),e&&s.getChildViews()[a].getChildViews()[1].setValue(e)}getFieldList(t){var e=$$(this.ids.form),i=[],s=this.CurrentObject.fields();if(0==s.length)return i;if(s.forEach((t=>{t.fieldIsSortable()&&i.push({id:t.id,value:t.label})})),t){var n=e.getChildViews();n.length>1&&n.forEach((function(t,e){if(n.length-1<=e)return!1;var s=t.getChildViews()[0].getValue();s&&(i=i.filter((t=>t.id!=s)))}))}return i}objectLoad(t){this.CurrentObject=t}setSettings(t){this._settings=this.AB.cloneDeep(t)}getSettings(){var t=$$(this.ids.form),e=[],i=t.getChildViews();return i.length>1&&i.forEach((function(t,s){if(i.length-1<=s)return!1;var n=t.getChildViews()[0].getValue(),a=t.getChildViews()[1].getValue();e.push({key:n,dir:a})})),e}onChangeCombo(t,e){var i,s=this.CurrentObject.fields(),a=e.getParentView().getChildViews()[1],r=null;if(i=s.find((e=>e.id==t))){switch(i.key){case"date":r=[{id:"asc",value:n("Before -> After")},{id:"desc",value:n("After -> Before")}];break;case"number":r=[{id:"asc",value:n("1 -> 9")},{id:"desc",value:n("9 -> 1")}];break;default:r=[{id:"asc",value:n("A -> Z")},{id:"desc",value:n("Z -> A")}]}a.define("options",r),a.refresh(),this.refreshFieldList(),this.triggerOnChange()}}onShow(t,e){var i=$$(this.ids.form);webix.ui(this.uiForm(),i);var s=this._settings;s&&s.forEach&&s.forEach((t=>{this.clickAddNewSort(t.key,t.dir)})),null!=s&&0!=s.length||this.clickAddNewSort(),$$(this.ids.component).show(t,e)}refreshFieldList(t){var e=$$(this.ids.form),i=this.getFieldList(!1),s=[],n=[],a=e.getChildViews();a.length>1&&a.forEach((function(t,e){if(a.length-1<=e)return!1;var r=t.getChildViews()[0].getValue(),o=i.find((t=>t.id==r));o?s.push(o):n.push(t)})),t||n.forEach((function(t){e.removeView(t)})),(a=e.getChildViews()).length>1&&a.forEach((function(t,e){if(a.length-1<=e)return!1;var n=t.getChildViews()[0].getValue(),r=i.filter((function(t){return t.id==n})),o=s.filter((function(t){return!Array.isArray(r)||-1===r.indexOf(t)})),l=i.filter((function(t){return!Array.isArray(o)||-1===o.indexOf(t)}));t.getChildViews()[0].define("options",l),t.getChildViews()[0].refresh()}))}triggerOnChange(){this._blockOnChange||(this._settings=this.getSettings(),this.emit("changed",this._settings))}blockOnChange(){this._blockOnChange=!0}unblockOnChange(){this._blockOnChange=!1}show(t,e,i){this.blockOnChange(),this.onShow(t,i||null),e&&this.clickAddNewSort(e),this.unblockOnChange()}sort(t,e){let i=0;const s=$$(this.ids.form).getChildViews();return s.length>1&&s.forEach(((n,a)=>{if(s.length-1<=a||0!=i)return;const r=n.getChildViews()[0].getValue(),o=n.getChildViews()[1].getValue(),l=this.CurrentObject.fieldByID(r);if(!l)return;const h=l.columnName;let c=t[h],d=e[h];Array.isArray(c)&&(c=(c||[]).map((function(t){return t.text||t})).join(" ")),Array.isArray(d)&&(d=(d??[]).map((t=>t.text||t)).join(" ")),c!=d&&(i="asc"==o?c>d?1:-1:c<d?1:-1)})),i}}},38446:(t,e,i)=>{const s=i(27950),n=i(50778);t.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval(),this.settings.filename||this.warningsMessage("has no image set")}}},99258:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>r});const s=i(77907),n=i(54394),a=i(95782).Z;class r extends s{component(){return new n(this)}get linkPageHelper(){return this.__linkPageHelper=this.__linkPageHelper||new a}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},95341:(t,e,i)=>{const s=i(26086).Z,n=i(70704),a=i(15651);var r=null;t.exports=class extends s{constructor(t,e,i){super(e=e||`${t.view?.id}_formSidePanel`,{form:""}),r||(r=(...t)=>this.AB.Multilingual.label(...t)),this.AB=t.AB,this.CurrentObjectID=null,this.editFields=i,this._mockApp=this.AB.applicationNew({})}get CurrentObject(){return this.AB.objectByID(this.CurrentObjectID)}ui(){var t=this.ids;return{id:t.component,width:300,hidden:!0,rows:[{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:r("Edit Record")},{view:"icon",icon:"wxi-close",align:"right",click:()=>{this.hide()}}]},{view:"scrollview",body:{rows:[{id:t.form,view:"form",borderless:!0,rows:[]}]}}]}}async init(t){this.AB=t}get CurrentObject(){return this.AB.objectByID(this.CurrentObjectID)}objectLoad(t){this.CurrentObjectID=t.id}hide(){$$(this.ids.component)?.hide(),this.emit("close")}show(t){$$(this.ids.component)?.show(),this.refreshForm(t)}isVisible(){return $$(this.ids.component)?.isVisible()??!1}refreshForm(t){var e=this.ids;let i=$$(e.form),s=this.CurrentObject;if(!s||!i)return;t=t||{};let r={id:`${this.ids.component}_sideform`,key:n.common().key,settings:{columns:1,labelPosition:"top",showLabel:1,clearOnLoad:0,clearOnSave:0,labelWidth:120,height:0}},o=this.AB.viewNewDetatched(r);o.objectLoad(s),s.fields().forEach(((t,e)=>{(!this.editFields||this.editFields.indexOf(t.id)>-1)&&o.addFieldToForm(t,e)})),o._views.push(new a({settings:{includeSave:!0,includeCancel:!1,includeReset:!1},position:{y:s.fields().length}},this._mockApp,o)),o._views.forEach(((t,e)=>t.id=`${o.id}_${t.key}_${e}`));let l=o.component(this.AB._App);webix.ui(l.ui().rows.concat({}),i),webix.extend(i,webix.ProgressBar),l.init(this.AB,2,{onBeforeSaveData:()=>{var t=o.getFormValues(i,s);return!!o.validateData(i,s,t)&&(i?.showProgress({type:"icon"}),t.id?s.model().update(t.id,t).then((t=>{this.emit("update",t),i?.hideProgress({type:"icon"})})).catch((e=>{this.AB.notify.developer(e,{context:"ABViewKanbanFormSidePanel:onBeforeSaveData():update(): Error updating value",formVals:t}),i?.hideProgress({type:"icon"})})):s.model().create(t).then((t=>{this.emit("add",t),i?.hideProgress({type:"icon"})})).catch((e=>{this.AB.notify.developer(e,{context:"ABViewKanbanFormSidePanel:onBeforeSaveData():.create(): Error creating value",formVals:t}),i?.hideProgress({type:"icon"})})),!1)}},2),i.clear(),i.parse(t),l.onShow(t)}}},76145:(t,e,i)=>{const s=i(55759),n=i(39146);t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s)}component(){return new n(this)}warningsEval(){super.warningsEval(),this.text||this.warningsMessage("has no text value set.")}}},6541:(t,e,i)=>{const s=i(96897),n=i(67675);t.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval(),0==this._views.length&&this.warningsMessage("has no columns set.")}}},59285:(t,e,i)=>{const s=i(76589),n=i(11363);t.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},37726:(t,e,i)=>{const s=i(42579),n=i(60586);t.exports=class extends s{component(){return new n(this)}}},20697:(t,e,i)=>{const s=i(42658),n=i(68906);t.exports=class extends s{component(){return new n(this)}}},26239:(t,e,i)=>{const s=i(72094),n=s.defaultValues();t.exports=class extends s{component(t=!1){var e=super.component();if(e._ui=e.ui(),e.ui=()=>({view:"scrollview",borderless:!0,css:this.settings.pageBackground||n.pageBackground,body:e._ui}),t){var i=e;e={ui:e.ui(),init:(t,e)=>(e=e??this.getUserAccess(),i.init(this.AB,e,t)),onShow:(...t)=>i.onShow?.(...t)}}return e}warningsEval(){super.warningsEval(),0==this.views().length&&this.warningsMessage("has no sub views"),(this.pages()||[]).forEach((t=>{t.warningsEval()}))}}},71227:(t,e,i)=>{const s=i(57766),n=i(5292);t.exports=class extends s{constructor(t,e,i,s){super(t,e,i,s)}component(){return new n(this)}warningsEval(){super.warningsEval(),this.datacollection||this.warningsMessage(`can't resolve it's datacollection[${this.settings.dataviewID}]`)}}},41226:(t,e,i)=>{const s=i(35154),n=i(28931);t.exports=class extends s{component(){return new n(this)}}},5670:(t,e,i)=>{const s=i(91899),n=i(93865);t.exports=class extends s{component(){return new n(this)}warningsEval(){super.warningsEval()}}},12235:(t,e,i)=>{const s=i(56463),n=i(59252);t.exports=class extends s{component(t=!1){let e=new n(this);if(t){const t=e;e={ui:t.ui(),init:(e,i)=>t.init(this.AB),onShow:(...e)=>t.onShow?.(...e)}}return e}warningsEval(){super.warningsEval(),0==this.views().length&&this.warningsMessage("has no tabs set")}}},9403:(t,e,i)=>{const s=i(55239),n=i(47637);t.exports=class extends s{component(t){return new n(this,t)}}},11895:(t,e,i)=>{const s=i(29436);s.defaultValues(),t.exports=class extends s{component(t){let e=super.component(t);return e.onShow=t=>{let e=this.datacollection;e&&e.dataStatus==e.dataStatusFlag.notInitial&&e.loadData()},e}}},99902:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABCSVExporter_${t.id}`,Object.assign({button:"",buttonFilter:"",filterComplex:""},i)),this.clientFilter=null}ui(){const t=this.ids,e=this.settings,i=this.view.constructor.defaultValues(),s=super.ui([{view:"layout",type:"clean",borderless:!0,cols:[{id:t.buttonFilter,view:"button",css:"webix_transparent",type:"icon",icon:"fa fa-filter",borderless:!0,width:50,label:"",click:()=>{this.showFilterPopup()}},{id:t.button,view:"button",css:"webix_primary",type:"icon",icon:"fa fa-download",borderless:!0,width:e.width||i.width,label:e.buttonLabel??i.buttonLabel,click:()=>{this.downloadCsvFile()}},{fillspace:!0}]}]);return delete s.type,s}async init(t){if(await super.init(t),!this.clientFilter){const e=t.filterComplexNew(this.ids.filterComplex),i=this.datacollection;if(i){const t=i.datasource;e.fieldsLoad(t?.fields?.()??[])}e.init(),e.on("change",(t=>{this.onFilterChange(t)})),this.clientFilter=e}}downloadCsvFile(){let t=`/appbuilder/csv-export/${this.view.id}`;const e=this.clientFilter.getValue();if((e?.rules||[]).length){let i=JSON.stringify(e);i=encodeURIComponent(i),t=`${t}?where=${i}`}window.open(t)}showFilterPopup(){const t=$$(this.ids.buttonFilter);this.clientFilter.popUp(t?t.$view:null)}onFilterChange(){const t=$$(this.ids.buttonFilter);if(!t)return;const e=this.clientFilter.getValue();t.define("badge",(e.rules||[]).length||null),t.refresh()}}},99593:(t,e,i)=>{const s=i(26086).Z,n=i(26580);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABCSVImporter_${t.id}`,Object.assign({button:"",popup:"",form:"",uploader:"",uploadFileList:"",separatedBy:"",headerOnFirstLine:"",columnList:"",search:"",datatable:"",statusMessage:"",progressBar:"",linkedDataButton:"",importButton:"",rules:""},i)),this.csvImporter=new n(((...t)=>this.label(...t))),this.validationError=!1,this._dataRows=null,this._csvFileInfo=null}ui(){const t=this.settings,e=this.view.constructor.defaultValues(),i=super.ui([{cols:[{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-upload",label:this.label(t.buttonLabel||e.buttonLabel),width:t.width||e.width,click:()=>{this.showPopup()}},{fillspace:!0}]}]);return delete i.type,i}uiConfig(){const t=this.ids;return{id:t.form,view:"form",type:"clean",borderless:!0,minWidth:400,gravity:1,elements:[{rows:[{id:t.uploader,view:"uploader",name:"csvFile",css:"webix_primary",value:this.label("Choose a CSV file"),accept:"text/csv",multiple:!1,autosend:!1,link:t.uploadFileList,on:{onBeforeFileAdd:t=>(this._csvFileInfo=t,this.loadCsvFile())}},{id:t.uploadFileList,name:"uploadedFile",view:"list",type:"uploader",autoheight:!0,borderless:!0,onClick:{webix_remove_upload:(t,e)=>{this.removeCsvFile(e)}}},{padding:10,rows:[{id:t.separatedBy,view:"richselect",name:"separatedBy",label:this.label("Separated by"),labelWidth:140,options:this.csvImporter.getSeparateItems(),value:",",on:{onChange:()=>{this.loadCsvFile()}}},{id:t.headerOnFirstLine,view:"checkbox",name:"headerOnFirstLine",label:this.label("Header on first line"),labelWidth:140,disabled:!0,value:!0,on:{onChange:()=>{this.populateColumnList()}}}]},{type:"space",rows:[{view:"scrollview",minHeight:300,body:{padding:10,id:t.columnList,rows:[]}}]}]}]}}uiRecordsView(){const t=this.ids;return{gravity:2,rows:[{view:"toolbar",css:"bg_gray",cols:[{width:5},{id:t.search,view:"search",value:"",label:"",placeholder:this.label("Search records..."),keyPressTimeout:200,on:{onTimedKeyPress:()=>{this.search($$(t.search).getValue())}}},{width:2}]},{id:t.datatable,view:"datatable",resizeColumn:!0,editable:!0,editaction:"dblclick",css:"ab-csv-importer",borderless:!1,tooltip:t=>t._errorMsg?t._errorMsg:"No validation errors",minWidth:650,columns:[],on:{onValidationError:(e,i,s)=>{let n="";Object.keys(s).forEach((t=>{this.$view.complexValidations[t].forEach((t=>{n+=t.invalidMessage+"</br>"}))}));const a=$$(t.datatable);a.blockEvent(),a.updateItem(e,{_status:"invalid",_errorMsg:n}),a.unblockEvent(),this.validationError=!0},onValidationSuccess:(e,i,s)=>{const n=$$(t.datatable);n.blockEvent(),n.updateItem(e,{_status:"valid",_errorMsg:""}),n.unblockEvent(),this.validationError=!1},onCheck:()=>{const e=$$(t.datatable).find({_included:!0}),i=$$(t.importButton);i.setValue(this.labelImport(e)),this.overLimitAlert(e)?i.disable():i.enable()}}},{id:t.progressBar,height:6},{cols:[{id:t.linkedDataButton,view:"button",label:this.label("Linked Data"),type:"icon",icon:"fa fa-info",maxWidth:180,click:()=>{this.showLinkedData()}},{view:"button",name:"import",id:t.importButton,label:this.label("Import"),css:"webix_primary",disabled:!0,type:"icon",icon:"fa fa-upload",click:()=>{this.import()}}]}]}}uiPopup(){const t=this.ids;return{id:t.popup,view:"window",hidden:!0,position:"center",modal:!0,resize:!0,head:{view:"toolbar",css:"webix_dark",cols:[{},{view:"label",label:this.label("CSV Importer"),autowidth:!0},{},{view:"button",width:35,css:"webix_transparent",type:"icon",icon:"nomargin fa fa-times",click:()=>{this.hide()}}]},body:{type:"form",rows:[{type:"line",cols:[this.uiConfig(),{width:20},this.uiRecordsView(),{width:1}]},{id:t.statusMessage,view:"label",align:"right",hidden:!0},{hidden:!0,margin:5,cols:[{fillspace:!0},{view:"button",name:"cancel",value:this.label("Cancel"),css:"ab-cancel-button",autowidth:!0,click:()=>{this.hide()}}]}]}}}async init(t){await super.init(t);const e=this.ids,i=this.datacollection;i&&this.objectLoad(i.datasource);const s=t.Webix;s.ui(this.uiPopup());const n=$$(e.form);n&&s.extend(n,s.ProgressBar);const a=$$(e.progressBar);a&&s.extend(a,s.ProgressBar)}showPopup(){const t=this.ids;$$(t.popup)?.show(),this.formClear(),$$(t.uploader).fileDialog()}hide(){$$(this.ids.popup)?.hide()}formClear(){const t=this.ids;this._dataRows=null,this._csvFileInfo=null;const e=$$(t.form);e.clearValidation(),e.clear(),$$(t.separatedBy).setValue(","),this.AB.Webix.ui([],$$(t.columnList)),$$(t.headerOnFirstLine).disable(),$$(t.importButton).disable(),$$(t.search).setValue(""),$$(t.uploadFileList).clearAll(),$$(t.datatable).clearAll();const i=$$(t.statusMessage);i.setValue(""),i.hide()}search(t){const e=$$(this.ids.datatable);if(!e)return;t=(t||"").toLowerCase();const i=this.getMatchFields();e.filter((e=>{let s=!1;return(i||[]).forEach((i=>{s||(s=(e[`${i.columnIndex}`]||"").toString().toLowerCase().indexOf(t)>-1)})),s}))}statusTemplate(t){let e="";if(!t)return e;switch(t._status){case"in-progress":e="<span class='fa fa-refresh'></span>";break;case"invalid":e="<span class='fa fa-exclamation-triangle'></span>";break;case"valid":case"done":e="<span class='fa fa-check'></span>";break;case"fail":e="<span class='fa fa-remove'></span>"}return e}async loadCsvFile(){const t=this._csvFileInfo;if(!t)return!1;const e=this.csvImporter;if(!e.validateFile(t))return this.AB.Webix.alert({title:this.label("This file extension is not allowed"),text:this.label("Please only upload CSV files"),ok:this.label("Ok")}),!1;const i=this.ids,s=$$(i.form);s?.showProgress?.({type:"icon"});const n=$$(i.headerOnFirstLine),a=$$(i.importButton);n.enable(),a.enable(),this._dataRows=await e.getDataRows(t,$$(i.separatedBy).getValue());const r=this._dataRows;let o=r.length;return n.getValue()&&(o=r.length-1),a.setValue(this.labelImport(o)),this.populateColumnList(),s?.hideProgress?.(),!0}removeCsvFile(t){return $$(this.ids.uploadFileList).remove(t),this.formClear(),!0}populateColumnList(){const t=this,e=this.ids,i=this.AB.Webix,s=$$(e.columnList);i.ui([],s);const n=this._dataRows;if(!n)return;const a=n[0];if(!a)return;const r=[],o=[],l=this.CurrentObject;l&&o.push(...l.fields((t=>{if(this.settings.availableFieldIds?.length&&this.settings.availableFieldIds.indexOf(t.id)<0)return!1;const e=t.formComponent();if(!e)return!0;const i=e.common();return!i||"fieldreadonly"!=i.key})));const h=this.csvImporter;$$(e.headerOnFirstLine).getValue()?r.push(...a.map(((t,e)=>({id:e+1,value:t,key:h.getGuessDataType(n,e)})))):a.forEach(((t,e)=>{r.push({id:e+1,value:this.label("Column {0}",[e+1]),key:h.getGuessDataType(n,e)})})),r.unshift({id:"none",value:this.label("None")});const c=[],d=[];o.forEach((e=>{const i=r.filter((t=>t.key==e.key&&d.indexOf(t.id)<0))[0];let s="none";i&&(s=i.id,d.push(s));let n={view:"richselect",gravity:2,options:r,fieldId:e.id,abName:"columnIndex",value:s,on:{onChange:function(){t.toggleLinkFields(this),t.loadDataToGrid()}}};if("date"===e.key){const t=["/","-",".",","," "],e=[{value:this.label("1 to 31"),id:"D"},{value:this.label("01 to 31"),id:"DD"}],i=[{value:this.label("1 to 12"),id:"M"},{value:this.label("01 to 12"),id:"MM"}],s=[{value:this.label("00 to 99"),id:"YY"},{value:this.label("2000 to 2099"),id:"YYYY"}],a=[{value:this.label("D-M-Y"),id:1},{value:this.label("M-D-Y"),id:2},{value:this.label("Y-M-D"),id:3},{value:this.label("Y-D-M"),id:4}];n={gravity:2,rows:[n,{view:"richselect",label:this.label("Separator"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"separator",abName:"columnDateFormat",options:t,value:"/"},{view:"richselect",label:this.label("Day"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"day",abName:"columnDateFormat",options:e,value:"D"},{view:"richselect",label:this.label("Month"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"month",abName:"columnDateFormat",options:i,value:"M"},{view:"richselect",label:this.label("Year"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"year",abName:"columnDateFormat",options:s,value:"YY"},{view:"richselect",label:this.label("Order"),labelWidth:100,on:{onChange:()=>{this.loadDataToGrid()}},name:"order",abName:"columnDateFormat",options:a,value:1}]}}if(e.isConnection){let t=[];e.datasourceLink&&(t=e.datasourceLink.fields((t=>!t.isConnection)).map((t=>({id:t.id,value:t.label})))),n={gravity:2,rows:[n,{view:"richselect",label:"=",labelWidth:20,abName:"columnLinkData",hidden:!0,options:t,value:t[0]?t[0].id:null}]}}c.push({view:"layout",borderless:!0,cols:[{view:"template",gravity:1,borderless:!0,css:{"padding-top":10},template:`<span class="fa fa-${e.icon}"></span> ${e.label}`},n]})})),i.ui(c,s),this.loadDataToGrid()}toggleLinkFields(t){if(!t)return;const e=t.getParentView().queryView({abName:"columnLinkData"},"all")[0];e&&("none"===t.getValue()?e.hide():e.show())}overLimitAlert(t){return t.length>1e3&&(this.AB.Webix.alert({title:this.label("Too many records"),ok:this.label("Ok"),text:this.label("Due to browser limitations we only allow imports of {0} records. Please upload a new CSV or deselect records to import.",[1e3])}),!0)}loadDataToGrid(){const t=this.ids,e=$$(t.datatable),i=this.AB;if(!e)return;e.clearAll(),e.showProgress?.({type:"icon"});const s=this.getMatchFields(),n=[];n.push({id:"_status",header:"",template:this.statusTemplate,width:30}),n.push({id:"_included",header:{content:"masterCheckbox"},template:"{common.checkbox()}",width:30});const a=[],r=[];if((s||[]).forEach((e=>{let s=e.field.settings.validationRules;if(s&&"string"==typeof s&&(s=JSON.parse(s)),s?.length){const n=[];s.forEach((t=>{const s=i.filterComplexNew(`${e.field.id}_${i.Webix.uid()}`);n.push(s.ui),a.push({filter:s,view:s.ids.querybuilder,columnName:e.field.id,validationRules:t.rules,invalidMessage:t.invalidMessage,columnIndex:e.columnIndex})}));const o=`${t.rules}_${e.field.id}_${i.Webix.uid()}`;r.push(o),i.Webix.ui({view:"popup",css:"ab-rules-popup",id:o,body:{rows:n}})}const o="number"==e.field?.key?"number":"text";n.push({id:e.columnIndex,header:e.field.label,editor:o,template:(t,e,i)=>i.replace(/[<]/g,"&lt;"),minWidth:150,fillspace:!0})})),a.length){const t=[];a.forEach((i=>{i.filter.fieldsLoad(this.CurrentObject.fields()),i.filter.setValue(i.validationRules),Array.isArray(t[i.columnName])||(t[i.columnName]=[]),t[i.columnName].push({filters:$$(i.view).getFilterHelper(),values:e.getSelectedItem(),invalidMessage:i.invalidMessage,columnIndex:i.columnIndex})}));const i={};e.$view.complexValidations=t,Object.keys(t).forEach((t=>{i[t]=(i,n)=>{let a=!0;return e.$view.complexValidations[t].forEach((t=>{const e={};(s||[]).forEach((t=>{const i=n[t.columnIndex];"date"===t.field.key&&i.includes("Invalid date")&&(a=!1),e[t.field.id]=i})),t.filters(e)||(a=!1)})),a}})),e.define("rules",i),e.config.rulePops=r,e.refresh()}else e.config.rulePops&&e.config.rulePops.forEach((t=>{const e=$$(t);e&&e.destructor()})),e.define("rules",{}),e.refresh();const o=[];(this._dataRows||[]).forEach(((t,e)=>{const n={id:e+1};(s||[]).forEach((e=>{const s=t[e.columnIndex-1];if("date"===e.field.key){let t=i.rules.toDate(s,{format:e.format});t=i.rules.toDateFormat(t,{format:"YYYY-MM-DD"}),"Invalid date"===t&&(t=t+" - "+s),n[e.columnIndex]=t}else n[e.columnIndex]=s})),n._included=!0,o.push(n)})),$$(t.headerOnFirstLine).getValue()&&o.length>1&&o.shift();const l=$$(t.importButton);l.setValue(this.labelImport(o)),e.refreshColumns(n),e.parse(o),this.overLimitAlert(o)?l.disable():l.enable(),e.hideProgress?.()}refreshRemainingTimeText(t,e,i){const s=this.ids,n=(new Date-t)/i*(e-i);let a="";const r=(n/864e5).toFixed(0),o=(n/36e5).toFixed(0),l=(n/6e4).toFixed(0),h=(n/1e3).toFixed(0);if(a=h<1?"":h<60?this.label("Approximately {0} second(s) remaining",[h]):1==l?this.label("Approximately 1 minute {0} seconds remaining",[h-60]):l<60?this.label("Approximately {0} minutes remaining",[l]):o<24?this.label("Approximately {0} hour(s) remaining",[o]):this.label("Approximately {0} day(s) remaining",[r]),a)$$(s.importButton)?.setValue(a);else{const t=$$(s.datatable)?.find({_included:!0});$$(s.importButton)?.setValue(this.labelImport(t))}}getMatchFields(){const t=[],e=this.ids;return($$(e.columnList).queryView({abName:"columnIndex"},"all").filter((t=>"none"!=t.getValue()))||[]).forEach((e=>{const i=this.CurrentObject;if(!i)return;const s=i.fieldByID(e.config.fieldId);if(!s)return;const n={columnIndex:e.getValue(),field:s};if("date"===s.key){const t=e.getParentView().queryView({abName:"columnDateFormat"},"all");if(t){let e;switch(t.forEach((t=>{n[t.config.name]=t.getValue()})),n.order){case"1":e=n.day+n.separator+n.month+n.separator+n.year;break;case"2":e=n.month+n.separator+n.day+n.separator+n.year;break;case"3":e=n.year+n.separator+n.month+n.separator+n.day;break;case"4":e=n.year+n.separator+n.day+n.separator+n.month}n.format=e}}if(s.isConnection){const t=e.getParentView().queryView({abName:"columnLinkData"},"all")[0];if(t){const e=s.datasourceLink.fieldByID(t.getValue());n.searchField=e}}t.push(n)})),t}labelImport(t){let e=t;return Array.isArray(t)&&(e=t.length),this.label("Import {0} Records",[e])}async import(){const t=this.CurrentObject;if(!t)return;const e=this.ids,i=$$(e.importButton);i.disable();const s=$$(e.form),n=$$(e.progressBar);s.showProgress({type:"icon"}),n.showProgress({type:"top",position:1e-4});const a=this.getMatchFields(),r=t.model(),o=$$(e.datatable),l=o.find({_included:!0});let h=0;const c=()=>{h+=1,n.showProgress({type:"bottom",position:h/l.length})},d=(t,e)=>{o&&(o.addRowCss(t,"row-fail"),o.blockEvent(),o.updateItem(t,{_status:"fail",_errorMsg:e}),o.unblockEvent()),c(),console.error(e)},u=this.AB.Webix,_=(t,e=[])=>{if(o){const i=[];e.forEach((t=>{t?.name&&(a.filter((e=>e.field&&e.field.columnName==t.name))[0],i.push(t.name+": "+t.message))})),o.blockEvent(),o.updateItem(t,{_status:"invalid",_errorMsg:i.join("</br>")}),o.unblockEvent(),o.addRowCss(t,"webix_invalid")}},p=$$(e.statusMessage),f=()=>{i.enable(),s.hideProgress(),n.hideProgress(),p.setValue(""),p.hide();const t=o.find({_included:!0});i.setValue(this.labelImport(t)),this.emit("done")},g=[];let m=!0;if((l||[]).forEach(((e,i)=>{const s=this.getParentValues();a.forEach((t=>{if(t.field?.key)switch(t.field.key){case"number":if("number"!=typeof e[t.columnIndex]){s[t.field.columnName]=(e[t.columnIndex]||"").replace(/[^-0-9.]/gi,"");break}s[t.field.columnName]=e[t.columnIndex];break;default:s[t.field.columnName]=e[t.columnIndex]}}));let n=!1,r="";const l=t.isValidData(s);var h;n=l.pass(),r=l.errors,n?n=o.validate(e.id):(m=!1,_(e.id,r)),n?(h=e.id,o&&(o.removeRowCss(h,"webix_invalid"),o.blockEvent(),o.updateItem(h,{_status:"",_errorMsg:""}),o.unblockEvent()),g.push({id:e.id,data:s})):m=!1})),!m)return f(),void u.alert({title:this.label("Invalid Data"),ok:this.label("Ok"),text:this.label("The highlighted row has invalid data. Please edit in the window or update the CSV and try again.")});const v={},b=a.filter((t=>t&&t.field?.isConnection&&t.searchField));let w,y=0;try{const t=[];if((b||[]).forEach((e=>{const i=e.field,s=i.datasourceLink;if(!s)return;const n=s.model();if(!n)return;const a=i.indexField?i.indexField.columnName:i.object.PK();v[i.id]={},t.push((async()=>{try{const t=await n.findAll({where:{},populate:!1});(t.data||t||[]).forEach((t=>{v[i.id][t[e.searchField.columnName]]=t[a]}))}catch(t){console.error(t)}})())})),await Promise.all(t),g.forEach((t=>{const e=t.data;o.blockEvent(),o.updateItem(t.id,{_status:"in-progress",_errorMsg:""}),o.unblockEvent(),(b||[]).forEach((i=>{const s=i.field,n=s.indexField?s.indexField.columnName:s.object.PK(),a=v[s.id][e[s.columnName]];a||(_(t.id,[{name:s.columnName}]),m=!1),e[s.columnName]={},e[s.columnName][n]=a}))})),!m)return u.alert({title:this.label("Invalid Data"),ok:this.label("Ok"),text:this.label("The highlighted row has invalid data. Please edit in the window or update the CSV and try again.")}),void f();const e=[],s=(t,e,s,n)=>new Promise(((a,r)=>{s.doRecordRulesPre(e),(async()=>{try{const l=await t.batchCreate({batch:e}),h=l.errors;Object.keys(h).forEach((t=>{const e=h[t];e&&d(t,e.message||e.sqlMessage||e)}));const u=l.data,_=[];Object.keys(u).forEach((t=>{_.push(new Promise(((e,i)=>{(async()=>{try{await s.doRecordRules(u[t]),n=t,o&&(o.removeRowCss(n,"row-fail"),o.addRowCss(n,"row-pass"),o.blockEvent(),o.updateItem(n,{_status:"done",_errorMsg:""}),o.unblockEvent()),c(),e()}catch(e){d(t,e),i("that didn't work")}var n})()})))}));const p=async()=>{try{await Promise.all(_),e.forEach((t=>{y++,y%10==0&&this.refreshRemainingTimeText(w,g.length,y)})),y===n&&(f(),i.disable()),a()}catch(t){r(t)}};await p()}catch(t){console.error(t),r(t)}})()}));g.forEach((t=>{e.push({id:t.id,data:t.data})}));const n=[],a=e.length;let l=0;for(;e.length;)n[l]=e.splice(0,10),l++;const h=(t,e,i,n)=>new Promise(((a,o)=>{(async()=>{try{await s(r,t,i,n);const o=e.shift();o?.length?await h(o,e,i,n):a()}catch(t){o(t)}})()}));w=new Date;const p=n.shift();await h(p,n,this.view,a)}catch(t){u.alert({title:this.label("Error Creating Records"),ok:this.label("Ok"),text:this.label("One or more records failed upon creation.")}),f(),console.error(t)}}uiLinkedData(){const t=this.datacollection?.datacollectionLink,e=t?.getCursor();if(e)return{view:"window",modal:!0,resize:!1,head:{view:"toolbar",cols:[{},{view:"button",width:35,css:"webix_transparent",type:"icon",icon:"nomargin fa fa-times",click:()=>{this.hideLinkedData()}}]},body:{view:"property",id:"sets",editable:!1,width:400,height:200,elements:[{label:this.label("Linked Data"),type:"label"},{label:"ID",type:"text",value:e.uuid??e.id},{label:"Label",type:"text",value:t.datasource.displayData(e)}]}}}showLinkedData(){const t=this.uiLinkedData();this._info_popup=this.AB.Webix.ui(t),this._info_popup.show($$(this.ids.linkedDataButton).$view,{pos:"top"})}hideLinkedData(){this._info_popup?.hide()}getParentValues(){const t={},e=this.datacollection,i=this.CurrentObject,s=e?.datacollectionLink,n=[];let a,r;return s?.getCursor()&&(a=s.datasource,n.push(...i.fields((t=>t.isConnection&&t.settings.linkObject===a.id))),r=s.getCursor()),a&&n.length&&r&&n.forEach((e=>{const i=e.indexField?e.indexField.columnName:a.PK();t[e.columnName]=t[e.columnName]??{},t[e.columnName][i]=r[i]??r.id})),t}}},68579:(t,e,i)=>{const s=i(6537);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewChartArea_${t.id}`,i)}ui(){const t=this.settings;return super.ui({view:"chart",type:t.areaType,yAxis:{start:0,step:t.stepValue,end:t.maxValue},xAxis:{template:t.isLegend?`<div style='font-size:${t.labelFontSize}px;'>#label#</div>`:""},legend:t.isLegend?{template:`<div style='font-size:${t.labelFontSize}px;'>#label#</div>`,values:[]}:null,series:[{alpha:.7,value:"#value#",color:"#ee4339"},{alpha:.4,value:"#value2#",color:"#a7ee70"}],height:t.chartHeight})}async init(t){await super.init(t)}onShow(){super.onShow()}}},82912:(t,e,i)=>{const s=i(6537);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewChartBar_${t.id}`,i)}ui(){const t=this.settings;return super.ui({view:"chart",type:t.barType,preset:t.barPreset,value:"#value#",color:"#color#",yAxis:{start:0,step:t.stepValue,end:t.maxValue},xAxis:{template:t.isLegend?`<div style='font-size:${t.labelFontSize}px;'>#label#</div>`:""},legend:"bar"!==t.barType&&t.barType?t.isLegend?{template:`<div style='font-size:${t.labelFontSize}px;'>#label#</div>`,values:[]}:null:t.isLegend?`<div style='font-size:${t.labelFontSize}px;'>#label#</div>`:"",height:t.height})}async init(t){await super.init(t)}onShow(){super.onShow()}}},39370:(t,e,i)=>{const s=i(60626);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewChart_${t.id}`,i)}async init(t,e){await super.init(t,e);const i=$$(this.ids.component),s=this.AB.Webix;i&&s.extend(i,s.ProgressBar);const n=this.view,a=this.datacollection;if(a){const t=["changeCursor","create","update","delete","initializedData"];a.datacollectionLink&&!("changeCursor"in(a.datacollectionLink._events??[]))&&n.eventAdd({emitter:a.datacollectionLink,eventName:"changeCursor",listener:()=>{n.refreshData()}}),t.forEach((t=>{n.eventAdd({emitter:a,eventName:t,listener:()=>{n.refreshData()}})}))}n.refreshData()}onShow(){super.onShow()}}},6537:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewChartContainer_${t.id}`,Object.assign({chartContainer:""},i))}ui(t){const e=super.ui([Object.assign({id:this.ids.chartContainer},t??{})]);return delete e.type,e}async init(t){await super.init(t)}onShow(){super.onShow();const t=this.view;t._isShow=!0,this.refreshData(t.parent.getDCChart())}refreshData(t){const e=$$(this.ids.chartContainer),i=$$(this.ids.component);e?.data&&e.data.sync(t),setTimeout((()=>{i?.adjust(),e?.adjust()}),160)}}},84214:(t,e,i)=>{const s=i(6537);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewChartLine_${t.id}`,i)}ui(){const t=this.settings;return super.ui({view:"chart",type:t.lineType,preset:t.linePreset,value:"#value#",color:"#color#",yAxis:{start:0,step:t.stepValue,end:t.maxValue},xAxis:{template:t.isLegend?`<div style='font-size:${t.labelFontSize}px;'>#label#</div>`:""},legend:t.isLegend?{template:`<div style='font-size:${t.labelFontSize}px;'>#label#</div>`,values:[]}:null,height:t.chartHeight})}}},51197:(t,e,i)=>{const s=i(6537);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewChartPie_${t.id}`,i)}ui(){const t=this.settings;return super.ui({view:"chart",type:t.pieType,value:"#value#",color:"#color#",legend:t.isLegend?{width:this.view.parent.settings.labelWidth,template:`<div style='font-size: ${t.labelFontSize}px;'>#label#</div>`}:null,pieInnerText:`<div style='font-size: ${t.innerFontSize}px;'>#value#</div>`,shadow:1,height:t.height})}}},90700:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewComment_${t.id}`,Object.assign({comment:""},i))}ui(){const t=this.view,e=super.ui([{id:this.ids.comment,view:"comments",users:t.getUserData(),currentUser:t.getCurrentUserId(),height:this.settings.height,data:this.getCommentData(),on:{onBeforeAdd:(t,e,i)=>{this.addComment(e.text,new Date)},onAfterDelete:t=>{this.deleteComment(t)}}}]);return delete e.type,e}async init(t){await super.init(t);const e=this.view;e.__dvEvents=e.__dvEvents||{};const i=this.ids,s=$$(i.comment);if(s){const t=s.queryView({view:"list"});t&&(e.__dvEvents.onStoreUpdated||(e.__dvEvents.onStoreUpdated=t.data.attachEvent("onStoreUpdated",((t,e,i)=>{"update"===i&&this.updateComment(t,(e||{}).text)}))),webix.extend(t,webix.ProgressBar))}const n=this.datacollection;n&&(e.__dvEvents.create||(e.__dvEvents.create=n.on("create",(()=>this.refreshComment()))),e.__dvEvents.update||(e.__dvEvents.update=n.on("update",(()=>this.refreshComment()))),e.__dvEvents.delete||(e.__dvEvents.delete=n.on("delete",(()=>this.refreshComment()))),e.__dvEvents.loadData||(e.__dvEvents.loadData=n.on("loadData",(()=>this.refreshComment()))),s.refresh())}getCommentData(){const t=this.view,e=this.datacollection;if(!e)return null;const i=t.getUserField(),s=t.getCommentField(),n=t.getDateField();if(!i||!s)return null;const a=i.columnName,r=s.columnName,o=n?n.columnName:null,l=e.getData(),h=[];return l.forEach(((e,i)=>{if(e[r]){const i=t.getUserData().find((t=>t.value===e[a])),s={id:e.id,user_id:i?i.id:0,date:e[o]?new Date(e[o]):null,default_date:new Date(e.created_at),text:e[r]};h.push(s)}})),h.sort((function(t,e){return o?new Date(t.date).getTime()-new Date(e.date).getTime():new Date(t.default_date).getTime()-new Date(e.default_date).getTime()})),h}refreshComment(){const t=this.view;t.__refreshTimeout&&clearTimeout(t.__refreshTimeout),this.busy();const e=this.ids;t.__refreshTimeout=setTimeout((()=>{const i=$$(e.comment);if(!i)return;const s=i.queryView({view:"list"});s&&s.clearAll();const n=this.getCommentData();n&&i.parse(n),s&&s.scrollTo(0,Number.MAX_SAFE_INTEGER),delete t.__refreshTimeout,this.ready()}),90)}addComment(t,e){this.saveData(t,e)}async updateComment(t,e){const i=this.view,s=i.model();if(!s)return;const n=i.getCommentField();if(!n)return;const a={};return a[n.columnName]=e??"",await s.update(t,a)}async deleteComment(t){const e=this.view.model();if(e)return await e.delete(t)}busy(){const t=this.ids,e=$$(t.comment);if(!e)return;const i=e.queryView({view:"list"});i&&(i.disable(),i.showProgress&&i.showProgress({type:"icon"}))}ready(){const t=this.ids,e=$$(t.comment);if(!e)return;const i=e.queryView({view:"list"});i&&(i.enable(),i.hideProgress&&i.hideProgress())}async saveData(t,e){if(!t)return;const i=this.datacollection;if(!i)return;const s=this.view,n=s.model(),a=this.AB;if(!n)return void a.notify.builder({},{message:"ABViewComment.saveData(): could not pull a model to work with.",viewName:s.label});const r={},o=s.getUserField();o&&(r[o.columnName]=a.Account.username());const l=s.getCommentField();l&&(r[l.columnName]=t);const h=s.getDateField();h&&(r[h.columnName]=e);const c=i.datacollectionLink;if(c?.getCursor()){const t=c.datasource,e=i.fieldLink;t&&e&&(r[e.columnName]={},r[e.columnName][t.PK()]=c.getCursor().id)}return await n.create(r)}}},26086:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var s=i(32735);class n extends s.Z{constructor(t,e,i){super(e||`ABView_${t.id}`,i),this.view=t,this.settings=t.settings,this.AB=t.AB,this.datacollection=t.datacollections||t.datacollection,this.__events=[],this.CurrentObjectID=null,this.CurrentDatacollectionID=null}get CurrentObject(){return this.AB.objectByID(this.CurrentObjectID)}get CurrentDatacollection(){return this.AB.datacollectionByID(this.CurrentDatacollectionID)}ui(t=[]){const e={id:this.ids.component,view:"layout",type:"space",rows:t};return e.rows.length||(e.height=30),e}async init(t){this.AB=t}datacollectionLoad(t){this.CurrentDatacollectionID=t?.id}objectLoad(t){this.CurrentObjectID=t?.id}eventAdd(t){if(!t||!t.emitter||!t.listener)return;const e=this.__events;e.filter((e=>e.emitter===t.emitter&&e.eventName===t.eventName)).length||(e.push({emitter:t.emitter,eventName:t.eventName,listener:t.listener}),t.emitter.on(t.eventName,t.listener))}eventsClear(){this.__events.forEach((t=>{t.emitter.removeListener(t.eventName,t.listener)})),this.__events=[]}onShow(){if(this?.view?.settings?.hintID){let t=this.AB.hintID(this.view.settings.hintID);t.settings.active&&t.createHintUI()}const t=this.datacollection;t&&t.dataStatus===t.dataStatusFlag.notInitial&&t.loadData()}}},49919:(t,e,i)=>{const s=i(60626);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewConditionalContainer_${t.id}`,Object.assign({batch:""},i)),this._ifComponent=null,this._elseComponent=null,this.__filterComponent=t.AB.filterComplexNew(`${t.id}_filterComponent`),this.populateFilterComponent()}ui(){const t={id:this.ids.batch,view:"multiview",cells:[{batch:"wait",view:"layout",rows:[{view:"label",label:this.label("Please wait...")}]}]},e=super.ui([t]);return t.cells.push(Object.assign({batch:"if"},this.ifComponent.ui()),Object.assign({batch:"else"},this.elseComponent.ui())),delete e.type,e}async init(t,e){await super.init(t,e),await Promise.all([this.ifComponent.init(t,e),this.elseComponent.init(t,e)]),this.populateFilterComponent();const i=this.datacollection;if(i){const t=this.view;t.eventAdd({emitter:i,eventName:"loadData",listener:()=>this.displayView()}),t.eventAdd({emitter:i,eventName:"initializedData",listener:()=>this.displayView()}),t.eventAdd({emitter:i,eventName:"changeCursor",listener:(...t)=>this.displayView(...t)})}this.displayView()}onShow(){super.onShow(),this.populateFilterComponent(),this.displayView()}get ifComponent(){return this._ifComponent=this._ifComponent||this.view.views().find((t=>"If"===t?.name)).component()}get elseComponent(){return this._elseComponent=this._elseComponent||this.view.views().find((t=>"Else"===t?.name)).component()}displayView(t){const e=this.datacollection,i=this.ids,s=$$(i.batch);!e||(t||(t=e.getCursor()),t||e.dataStatus!==e.dataStatusFlag.notInitial&&e.dataStatus!==e.dataStatusFlag.initializing)?this.__filterComponent.isValid(t)?(s?.showBatch("if"),this.ifComponent?.onShow?.()):(s?.showBatch("else"),this.elseComponent?.onShow?.()):s?.showBatch("wait")}populateFilterComponent(){const t=this.datacollection,e=this.__filterComponent;t?.datasource?e.fieldsLoad(t.datasource.fields()):e.fieldsLoad([]),e.setValue(this.settings.filterConditions??this.view.constructor.defaultValues().filterConditions)}}},60626:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewContainer_${t.id}`,i),this.idBase=e,this.options=null,this.viewComponents={},this.viewComponentIDs={},this._handlerChangePage=e=>{t.changePage(e)}}ui(t){const e=this.view.viewsSortByPosition(),i=this.getElements(e),s=super.ui(t||i);return delete s.type,s}async init(t,e=0,i={}){await super.init(t),this.options=i;const s=[];$$(this.ids.component)?.define("css",`accessLevel-${e}`);const n=this.viewComponents;for(const a in n)(!n[a]??!this.view.views((t=>t.id===a)).length)||(e?s.push(n[a].init(t,e,i)):$$(this.viewComponentIDs[a])?.hide());await Promise.all(s)}getElements(t){const e=[],i={};let s,n;const a=this.settings,r=this.view.constructor.defaultValues();return t.forEach((t=>{let o;try{o=t.component(this.idBase),t.removeAllListeners("changePage")}catch(e){o=t.component(this.idBase);const i=o.ui;o.ui=(()=>i).bind(o)}if(this.viewComponents[t.id]=o,null==t.position.y||t.position.y!==s){s=t.position.y||e.length,n=0;const i={cols:[]},o=a.columns||r.columns;for(let t=0;t<o;t++)i.cols.push({gravity:a.gravity?.[t]?parseInt(a.gravity[t]):r.gravity});e.push(i)}const l=e.length-1,h=e[l],c=t.position.x??0,d=`${l}-${c}`;let u=1;i[d]&&console.error(`Component[${o?.ids?.component}] is overwriting component[${i[d].ids?.component}]. <-- Reorder them to fix.`),i[d]=o,h.cols[c]?.gravity&&(u=h.cols[c].gravity);const _=o.ui();this.viewComponentIDs[t.id]=_.id,_.gravity=u,h.cols[c]=_,this.eventAdd({emitter:t,eventName:"changePage",listener:this._handlerChangePage}),n++})),e}onShow(){super.onShow(),Object.values(this.viewComponents).forEach((t=>{t.onShow?.()}))}}},10488:(t,e,i)=>{const s=i(26086).Z,n=i(15879),a=i(95782).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewDataview_${t.id}`,Object.assign({dataview:""},i)),this.linkPage=null}ui(){this.initDetailComponent();const t=this.ids;return super.ui([{id:t.dataview,view:"dataview",scroll:"y",sizeToContent:!0,css:"borderless transparent",xCount:this.settings.xCount,template:t=>this.itemTemplate(t),on:{onAfterRender:()=>{this.applyClickEvent(),this.addCyAttribute()}}}])}async init(t){await super.init(t);const e=this.datacollection;if(!e)return;this.linkPage=this.linkPageHelper.component(),this.linkPage.init({view:this.view,datacollection:e});const i=this.ids,s=$$(i.dataview);t.Webix.extend(s,t.Webix.ProgressBar),e.bind(s)}onShow(){super.onShow();const t=$$(this.ids.dataview);t.resize();const e=this.getItemWidth();t.customize({width:e}),t.getTopParentView?.().resize?.()}initDetailComponent(){const t=this.getDetailUI();this._detail_ui=this.AB.Webix.ui(t),this.detailComponent.init(null,2)}getDetailUI(){const t=this.detailComponent,e=this.settings.editPage,i=this.settings.detailsPage,s=t.ui();return s.type="clean",s.css="ab-detail-view",(i||e)&&(s.css+=" ab-detail-hover ab-record-#itemId#",i&&(s.css+=" ab-detail-page"),e&&(s.css+=" ab-edit-page")),s}itemTemplate(t){const e=this.detailComponent,i=$$(this.ids.dataview),s=this._detail_ui;t&&Object.keys(t).length||(t=t??{},this.datacollection?.datasource?.fields().forEach((e=>{switch(e.key){case"string":case"LongText":t[e.columnName]="Lorem Ipsum";break;case"date":case"datetime":t[e.columnName]=new Date;break;case"number":t[e.columnName]=7}}))),e.displayData(t);const n=i.data.count()>0?i.type.width:(s.$width-20)/this.settings.xCount,a=i.data.count()>0?i.type.height:s.getChildViews()?.[0]?.$height,r=document.createElement("div");return r.appendChild(s.$view),s.define("width",n-24),s.define("height",a+15),s.adjust(),this.addCyItemAttributes(r,t),r.innerHTML.replace(/#itemId#/g,t.id)}getItemWidth(){const t=$$(this.ids.dataview);let e=t,i=e?.$width;for(;e;)"scrollview"!=e.config.view&&"layout"!=e.config.view||(i=e?.$width<i?e?.$width:i),e=e?.getParentView?.();if(i||(i=t?.getParentView?.().$width||window.innerWidth),window.innerWidth-18<=i){const t=this.getTabSidebar();t&&(i-=t.$width)}return Math.floor(i/this.settings.xCount)}getTabSidebar(){let t,e=$$(this.ids.dataview);for(;e&&!t;)t=(e.getChildViews?.()??[]).filter((t=>"sidebar"==t?.config?.view))[0],e=e?.getParentView?.();return t}applyClickEvent(){const t=this.settings.editPage,e=this.settings.detailsPage;if(!e&&!t)return;const i=$$(this.ids.dataview);i&&(i.$view.onclick=i=>{let s=!1,n=i.path??[];if(n.length||(n.push(i.target),n.push(i.target.parentNode)),t)for(let e of n)if(e.className&&e.className.indexOf("webix_accordionitem_header")>-1){s=!0,e.parentNode.parentNode.classList.forEach((e=>{if(e.indexOf("ab-record-")>-1){const i=e.replace("ab-record-","");this.linkPage.changePage(t,i)}}));break}if(e&&!s)for(let t of n)if(t.className&&t.className.indexOf("webix_accordionitem")>-1){t.parentNode.parentNode.classList.forEach((t=>{if(t.indexOf("ab-record-")>-1){const i=t.replace("ab-record-","");this.linkPage.changePage(e,i)}}));break}})}addCyAttribute(){const t=this.view,e=$$(this.ids.dataview),i=(t.name??"").replace(".dataview","");e.$view.setAttribute("data-cy",`dataview container ${i} ${t.id}`)}addCyItemAttributes(t,e){const i=this.view,s=e.uuid,n=(i.name??"").replace(".dataview","");t.querySelector(".webix_accordionitem_body")?.setAttribute("data-cy",`dataview item ${n} ${s} ${i.id}`),t.querySelector(".webix_accordionitem_button")?.setAttribute("data-cy",`dataview item button ${n} ${s} ${i.id}`)}get detailComponent(){return this._detailComponent=this._detailComponent??new n(this.view,`${this.ids.component}_detail_view`)}get linkPageHelper(){return this.__linkPageHelper=this.__linkPageHelper||new a}}},43620:(t,e,i)=>{const s=i(21269);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewDetailCheckbox_${t.id}`,i)}ui(){const t=this.view,e=t.field();return super.ui({on:{onAfterRender:()=>{const i=`detail checkbox ${e?.columnName} ${e?.id} ${t.parentDetailComponent()?.id??t.parent.id}`;$$(this.ids.detailItem)?.$view.setAttribute("data-cy",i)}}})}setValue(t){let e="";e=t&&JSON.parse(t)?'<span class="check webix_icon fa fa-check-square-o"></span>':'<span class="check webix_icon fa fa-square-o"></span>',super.setValue(e)}}},15879:(t,e,i)=>{i(88447);const s=i(60626);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewDetail_${t.id}`,i),this.idBase=e}ui(){return{type:"form",borderless:!0,rows:[{body:super.ui()}]}}onShow(){const t=this.view;try{const e=`Detail ${t.name?.split(".")[0]} ${t.id}`;$$(this.ids.component).$view.setAttribute("data-cy",e)}catch(t){console.warn("Problem setting data-cy",t)}const e=this.datacollection;if(e){const t=e.getCursor();t&&this.displayData(t),this.eventAdd({emitter:e,eventName:"changeCursor",listener:(...t)=>this.displayData(...t)}),this.eventAdd({emitter:e,eventName:"create",listener:t=>{e.getCursor()?.id===t.id&&this.displayData(t)}}),this.eventAdd({emitter:e,eventName:"update",listener:t=>{e.getCursor()?.id===t.id&&this.displayData(t)}})}super.onShow()}displayData(t={}){(this.view.views()||[]).sort(((t,e)=>t?.field?.()&&e?.field?.()?"formula"===t.field().key&&"calculate"===e.field().key?-1:"calculate"===t.field().key&&"formula"===e.field().key?1:0:0)).forEach((e=>{let i;if(e.field){const s=e.field();if(!s)return;switch(s.key){case"connectObject":case"user":i=s.pullRelationValues(t);break;case"list":if(i=t?.[s.columnName],!i){i="";break}if(0===s.settings.isMultiple){let t="";if(s.settings.options.forEach((e=>{e.id===i&&(t=e.text)})),s.settings.hasColors){let e="#66666",i="";s.settings.options.forEach((s=>{s.text===t&&(e=s.hex,i="hascustomcolor")})),t=`<span class="webix_multicombo_value ${i}" style="background-color: ${e} !important;"><span>${t}</span></span>`}i=t}else{const t=[];let e="";i.forEach((i=>{let n="",a="";s.settings.hasColors&&i.hex&&(n="hascustomcolor",a=`background: ${i.hex};`),s.settings.options.forEach((t=>{t.id===i.id&&(e=t.text)})),t.push(`<span class="webix_multicombo_value ${n}" style="${a}" optvalue="${i.id}"><span>${e}</span></span>`)})),i=t.join("")}break;case"file":if(i=t?.[s.columnName],!i){i="";break}break;case"formula":if(t){const e=!1;i=s.format(t,e)}break;default:i=s.format(t)}}const s=e.component(this.idBase);s?.setValue?.(i),s?.displayText?.(t)}))}}},76766:(t,e,i)=>{const s=i(21269);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewDetailConnect_${t.id}`,i)}ui(){const t=this.view,e=this.settings;return super.ui({on:{onAfterRender:()=>{const i=`detail connected ${t.field((t=>t.id===e.fieldId))?.columnName??""} ${e.fieldId} ${t.parentDetailComponent()?.id||t.parent.id}`;$$(this.ids.detailItem)?.$view.setAttribute("data-cy",i)}}})}setValue(t){const e=[];Array.isArray(t)?t.forEach((t=>{e.push(`<span class="webix_multicombo_value">${t.text}</span>`)})):e.push(`<span class="webix_multicombo_value">${t.text}</span>`),super.setValue(e.join(""))}}},4989:(t,e,i)=>{const s=i(21269);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewDetailCustom_${t.id}`,i)}ui(){const t=this.view,e=t.field();t.detailComponent();let i=e?e.columnHeader().template({}):"";return super.ui({minHeight:45,height:60,template:i,on:{onAfterRender:()=>{const i=`detail custom ${e?.columnName} ${e?.id} ${t.parentDetailComponent()?.id||t.parent.id}`;$$(this.ids.detailItem)?.$view.setAttribute("data-cy",i)}}})}onShow(){super.onShow;const t=this.view,e=t.field();if(!e)return;const i=$$(this.ids.detailItem);if(!i)return;const s=t.detailComponent().datacollection.getCursor()||{},n=i.$view;e.customDisplay(s,null,n,{editable:!1}),n.getElementsByClassName("webix_template")[1].removeAttribute("class")}setValue(t){const e=this.view.field();if(!e)return;const i=$$(this.ids.detailItem);if(!i)return;const s={};s[e.columnName]=t,e.setValue(i,s)}}},56333:(t,e,i)=>{const s=i(21269);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewDetailImage_${t.id}`,i)}ui(){const t=this.view,e=t.field(),i={on:{onAfterRender:()=>{const i=`detail image ${e?.columnName} ${e?.id} ${t.parentDetailComponent()?.id||t.parent.id}`;$$(this.ids.detailItem)?.$view.setAttribute("data-cy",i)}}},s=this.settings;return s.height&&(i.height=s.height),super.ui(i)}setValue(t){const e=this.view.field();if(!e)return void super.setValue("");const i=t||e.settings.defaultImageUrl;if(!i)return void super.setValue("");const s=e.urlImage(i),n=this.settings,a=['<div class="ab-image-data-field">',`<div style="float: left; background-size: cover; background-position: center center; background-image:url('${s}');  width: ${n.width||e.settings.imageWidth||200}px; height: ${n.height?`${n.height}px`:e.settings.imageHeight?`${e.settings.imageHeight}px`:"100%"}; position:relative;">`,`<a href="${s}" target="_blank" title="" class="fa fa-download ab-image-data-field-download"></a>`,"</div></div>"].join("");super.setValue(a)}}},21269:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewDetailItem_${t.id}`,Object.assign({detailItem:"",detailItemLabel:""},i))}ui(t={}){const e=this.view,i=e.detailComponent()?.settings??{},s=e.field(),n="top"==i.labelPosition,a=[];if(i.showLabel){const t=n?"<label style='display:block; text-align: left; line-height: 32px;' class='webix_inp_top_label'>#label#</label>":"<label style='display: inline-block; float: left; line-height: 32px; width:#width#px;'>#label#</label>",e={id:this.ids.detailItemLabel,view:"template",borderless:!0,height:38,template:t,data:{label:s?.label??""}};n||(e.width=i.labelWidth+24),a.push(e)}let r;1===s?.settings?.useHeight&&(r=parseInt(s.settings.imageHeight)||r);const o=Object.assign({id:this.ids.detailItem,view:"template",borderless:!0,autowidth:!0,height:r,isUsers:"user"===s?.key,template:n?"<div style='min-height: 38px'>#display#</div>":"<div class='ab-detail-component-holder'>#display#</div>",data:{display:""}},t);o.height&&0!=o.height||(delete o.height,o.autoheight=!0),a.push(o);const l={};"top"==i.labelPosition?l.rows=a:l.cols=a;const h=super.ui([l]);return delete h.type,h}setValue(t,e){const i=$$(e??this.ids.detailItem);if(!i)return;const s=this.view.field();"string"!==s?.key&&"LongText"!==s?.key?i.setValues({display:t}):i.setValues({display:t.replace(/[<]/g,"&lt;")})}}},63567:(t,e,i)=>{const s=i(21269);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewDetailText_${t.id}`,i)}ui(){const t=this.view.field(),e={css:"ab-text",on:{onAfterRender:()=>{const e=`detail text ${t?.columnName} ${t?.id} ${this.view.parentDetailComponent()?.id||this.view.parent.id}`;$$(this.ids.component)?.$view.setAttribute("data-cy",e)}}},i=this.settings;return i.height&&(e.height=i.height),super.ui(e)}}},1620:(t,e,i)=>{const s=i(21269);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewDetailTree_${t.id}`,i)}get className(){return"ab-detail-tree"}async init(t){await super.init(t),this.setValue(`<div class="${this.className}"></div>`)}getDomTree(){const t=$$(this.ids.detailItem);if(t)return t.$view.getElementsByClassName(this.className)[0]}setValue(t){const e=[];t&&!Array.isArray(t)&&e.push(t),setTimeout((()=>{const t=this.getDomTree();if(!t)return!1;const i=this.view.field(),s=[];void 0===i.settings.options.data&&(i.settings.options=new this.AB.Webix.TreeCollection({data:i.settings.options})),i.settings.options.data.each((function(t){if(-1!==e.indexOf(t.id)){let e="",n=t.id;for(;this.getParentId(n);)i.settings.options.data.each((function(t){i.settings.options.data.getParentId(n)===t.id&&(e=`${t.text}: ${e}`)})),n=this.getParentId(n);e+=t.text,s.push(e)}}));let n="<div class='list-data-values'>";s.forEach((function(t){n+=`<span class="selectivity-multiple-selected-item rendered" style="background-color: #4CAF50 !important;">${t}</span>`})),n+="</div>",t.innerHTML=n;let a=33;t.scrollHeight>33&&(a=t.scrollHeight);const r=$$(this.ids.detailItem);r.config.height=a,r.resize()}),50)}}},28458:(module,__unused_webpack_exports,__webpack_require__)=>{const Docxtemplater=__webpack_require__(49590),ImageModule=__webpack_require__(82824),JSZipUtils=__webpack_require__(45863),JSZip=__webpack_require__(31290),ABFieldConnect=__webpack_require__(66589),ABFieldImage=__webpack_require__(70780),ABObjectQuery=__webpack_require__(88447),ABViewComponent=__webpack_require__(26086).Z;module.exports=class ABViewDocxBuilderComponent extends ABViewComponent{constructor(t,e,i){super(t,e||`ABViewDocxBuilder_${t.id}`,Object.assign({downloadButton:"",noFileLabel:""},i))}ui(){const t=this.view,e=this.settings,i=t.constructor.defaultValues();let s=!1;0===(e.width??i.width)&&(s=!0);let n={type:"spacer",width:1},a={type:"spacer",width:1};switch(e.buttonPosition??i.buttonPosition){case"left":break;case"center":n={type:"spacer"},a={type:"spacer"};break;case"right":n={type:"spacer"}}const r=t.buttonlabel||e.buttonlabel||i.buttonlabel,o=this.ids,l=super.ui([{view:"toolbar",css:e.toolbarBackground??i.toolbarBackground,cols:[n,{id:o.downloadButton,view:"button",css:"webix_primary",type:"icon",icon:"fa fa-file-word-o",label:r,width:e.width||i.width,autowidth:s,click:()=>{this.renderFile()},on:{onAfterRender:()=>{const e=t.name?.replace(".docxBuilder",""),i=`docx download ${e} ${t.id}`;$$(o.downloadButton)?.$view.querySelector("button").setAttribute("data-cy",i)}}},{id:o.noFileLabel,view:"label",label:this.label("No template file")},{type:"spacer"},a]}]);return delete l.type,l}async init(t){await super.init(t);const e=this.ids,i=$$(e.downloadButton),s=$$(e.noFileLabel);this.view.settings.filename?(i.show(),s.hide()):(i.hide(),s.show())}async onShow(){super.onShow;const t=[];this.view.datacollections.forEach((e=>{e.dataStatus===e.dataStatusFlag.notInitial&&t.push(e.loadData())})),t.length>0&&this.busy(),await Promise.all(t),this.ready()}busy(){const t=$$(this.ids.downloadButton);t&&(t.disable(),t.define("icon","fa fa-refresh fa-spin"),t.refresh())}ready(){const t=$$(this.ids.downloadButton);t&&(t.enable(),t.define("icon","fa fa-file-word-o"),t.refresh())}async renderFile(){this.busy();const t=this.getReportData(),e=await this.downloadImages(),i=await this.downloadTemplateFile(),s=this.generateDocxFile(i,t,e),n=this.view;n.letUserDownload(s,n.filelabel),this.ready()}getReportData(){const t={},e=this.view.datacollections,i=e.length>1;return e.filter((t=>t?.datasource)).forEach((async e=>{const s=e.datasource,n=s.model(),a=e.getCursor(),r=[];let o={};o=a?{glue:"and",rules:[{key:s.PK(),rule:"equals",value:a[s.PK()]}]}:this.AB.merge(o,e.settings?.objectWorkspace?.filterConditions??{});const l=(await n.findAll({disableMinifyRelation:!0,populate:!0,skip:0,where:o})).data,h=s.multilingualFields();l.forEach((t=>{let e;s.fields().forEach((i=>{const n=[];s instanceof ABObjectQuery?("string"==typeof i.object.translations&&(i.object.translations=JSON.parse(i.object.translations)),"string"==typeof i.translations&&(i.translations=JSON.parse(i.translations)),(i.object.translations||[]).forEach((t=>{const e=(i.translations||[]).filter((e=>e.language_code===t.language_code))[0];if(!e)return;const s=t.label,a=e.label;n.push(`${s}.${a}`)}))):"string"==typeof i.translations&&(i.translations=JSON.parse(i.translations)),i.translations.forEach((t=>{n.push(t.label)})),e=Object.assign(e??{},this.setReportValues(t,i,n,h)??{}),e._object=s})),r.push(e)}));const c=r.length>1?r:r[0];i||Array.isArray(c)&&c.length>1?(e.translations||[]).forEach((e=>{t[e.label]=c})):Object.assign(t,c)})),t}setReportValues(t,e,i=[],s){const n={};let a=null;n.id=t.id,n[`${e.columnName}_ORIGIN`]=t[e.columnName];const r=this.view;if(s.length){const e=(s||[]).filter((e=>null!=t[e]));r.translate(t,t,e,r.languageCode)}return e instanceof ABFieldConnect?(a=t[e.columnName],a?.forEach&&a.forEach((t=>{t&&(e.datasourceLink&&e.datasourceLink.fields((t=>!t.isConnection)).forEach((e=>{t[`${e.columnName}_ORIGIN`]=t[e.columnName],t[e.columnName]=e.format(t,{languageCode:r.languageCode})})),t&&"object"==typeof t&&(t._object=e.datasourceLink))}))):a=e.format(t,{languageCode:r.languageCode}),i.forEach((t=>{a?n[t]=a:n[t]||(n[t]="")})),t.data?.length&&(n.data=n.data||[],(t.data||[]).forEach(((t,a)=>{n.data[a]=this.setReportValues(t,e,i,s)}))),n}async downloadImages(){const t={},e=[],i=(s,n=[])=>{n.forEach((n=>{const a=s.format(n);a&&!t[a]&&e.push(new Promise(((e,i)=>{const n=s.urlImage(a);JSZipUtils.getBinaryContent(n,((s,n)=>{if(s)return i(s);t[a]=n,e()}))}))),i(s,n.data||[])}))};return this.view.datacollections.filter((t=>t?.datasource)).forEach((t=>{const e=t.datasource;let s=t.getCursor();if(s){const e=t.getCursor(!0);s=[this.AB.merge({},s,e)]}else s=t.getData();e.fields((t=>t instanceof ABFieldImage)).forEach((t=>{i(t,s)}))})),await Promise.all(e),t}downloadTemplateFile(){const t=this.view.downloadUrl();return new Promise(((e,i)=>{JSZipUtils.getBinaryContent(t,((t,s)=>{if(t)return i(t);e(s)}))}))}generateDocxFile(contentFile,data,images){const summaries={},zip=new JSZip(contentFile),doc=new Docxtemplater,imageModule=new ImageModule({centered:!1,getImage:(t,e)=>images[t]||"",getSize:(t,e,i)=>{const s=[300,160],n=this.view,a=n.datacollection;if(a){let t=a.datasource;if(!t)return s;if(i.indexOf(".")>-1){const e=i.split(".");if(t=t.objects((t=>t.label===e[0]))[0],!t)return s;i=e[1]}const e=t.fields((t=>t.columnName===i))[0];return e?.settings?(e.settings.useWidth&&e.settings.imageWidth&&(s[0]=e.settings.imageWidth),e.settings.useHeight&&e.settings.imageHeight&&(s[1]=e.settings.imageHeight),s):s}{const t=n.datacollections;return t?(t.forEach((t=>{let e=t.datasource;if(!e)return!1;if(i.indexOf(".")>-1){let t=i.split(".");if(!e.objects)return!1;if(e=e.objects((e=>e.label===t[0]))[0],!e)return!1;i=t[1]}const n=e.fields((t=>t.columnName===i))[0];return!!n?.settings&&(n.settings.useWidth&&n.settings.imageWidth&&(s[0]=n.settings.imageWidth),n.settings.useHeight&&n.settings.imageHeight&&(s[1]=n.settings.imageHeight),!1)})),s):s}}});try{doc.attachModule(imageModule).loadZip(zip).setData(data).setOptions({parser:function(tag){return{get:function(scope,context){if(0===tag.indexOf("data|")){const t=(tag.split("|")[1]||"").trim();return(scope.data||[]).filter((function(e){return!!e[t]}))}if(tag.indexOf("|$sum?")>-1){const t=tag.split("|$sum?")[0],e=tag.split("|$sum?")[1];let i=scope[t];return"string"==typeof i&&(i=i.replace(/[^\d.]/g,"")),summaries[e]||(summaries[e]=0),summaries[e]+=parseFloat(i),scope[t]}if(0===tag.indexOf("$sum?")){const t=tag.replace("$sum?","");return summaries[t]||0}if(0===tag.indexOf("$")){const t=tag.replace("$","").split("|"),e=t[0].trim(),i=t[1].trim();if(!e||!i)return"";let s;const n=scope._object;if(n){const t=n.fields((t=>t.columnName===i))[0];if(t){const e=t.indexField;s=e?e.columnName:null}}let a=data[e];a&&!Array.isArray(a)&&(a=[a]);const r=t=>t[`${s}_ORIGIN`]||t[s]||t.id||t;return(a||[]).filter((function(t){let e=scope[i];return Array.isArray(e)?e.filter((e=>r(e)===r(t))).length>0:r(t)===r(e)}))}if(tag.indexOf("?")>-1){const result=scope,prop=tag.split("?")[0],condition=tag.split("?")[1];if(prop&&condition){let data=scope[prop];if(data)return Array.isArray(data)||(data=[data]),data.filter((d=>eval(condition.replace(/\./g,"d."))))}return result}return"."===tag?scope:scope[tag]}}}}).render()}catch(t){return t}const docxFile=doc.getZip().generate({type:"blob",mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});return docxFile}}},56202:(t,e,i)=>{const s=i(15796);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewFormButton_${t.id}`,i)}ui(){const t=this,e=this.view,i=e.parentFormComponent(),s=e.settings??{},n=s.alignment||e.constructor.defaultValues().alignment,a={cols:[]};return"center"!==n&&"right"!==n||a.cols.push({}),s.includeCancel&&a.cols.push({view:"button",autowidth:!0,value:s.cancelLabel||this.label("Cancel"),click:function(){t.onCancel(this)},on:{onAfterRender:function(){this.getInputNode().setAttribute("data-cy",`button cancel ${i.id}`)}}},{width:10}),s.includeReset&&a.cols.push({view:"button",autowidth:!0,value:s.resetLabel||this.label("Reset"),click:function(){t.onClear(this)},on:{onAfterRender:function(){this.getInputNode().setAttribute("data-cy",`button reset ${i.id}`)}}},{width:10}),s.includeSave&&a.cols.push({view:"button",type:"form",css:"webix_primary",autowidth:!0,value:s.saveLabel||this.label("Save"),click:function(){t.onSave(this)},on:{onAfterRender:function(){this.getInputNode().setAttribute("data-cy",`button save ${i.id}`)}}}),"center"!==n&&"left"!==n||a.cols.push({}),super.ui(a)}onCancel(t){const e=this.view,i=e.settings??{},s=e.parentFormComponent();if(s.datacollection?.setCursor(null),t?.getFormView?.().clear(),i.afterCancel)s.changePage(i.afterCancel);else{const t=t=>t.settings&&"popup"!=t.settings.type,e=this.pageParent();if(e){const i=e.pageParent(t)??e;i&&s.changePage(i.id)}}}onClear(t){const e=this.view.parentFormComponent().datacollection;e&&e.setCursor(null),t?.getFormView?.().clear()}onSave(t){if(!t)return void console.error("Require the button element");const e=this.view.parentFormComponent(),i=t.getFormView();t.disable?.(),e.saveData(i).then((()=>{t.enable?.(),e.focusOnFirst()})).catch((e=>{console.error(e),t.enable?.()}))}}},29118:(t,e,i)=>{const s=i(15796);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewFormCheckbox_${t.id}`,i)}ui(){return super.ui({view:"checkbox"})}}},61463:(t,e,i)=>{const s=i(26086).Z,n=i(48717),a=i(46311),r=i(79662),o=i(48167),l=i(24655),h=[];t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewForm_${t.id}`,Object.assign({form:"",layout:"",filterComplex:""},i)),this.timerId=null,this._showed=!1}ui(){const t=this.view,e=t.superComponent().ui().rows??[],i=this.uiValidationHolder(),s=super.ui([{id:this.ids.form,view:"form",abid:t.id,rows:e.concat(i)}]);return delete s.type,s}uiValidationHolder(){const t=[{hidden:!0,rows:[]}],e=this.view,i=this.datacollection?.datasource??e._currentObject;if(!i)return t;const s=[],n=e.fieldComponents();return i.fields((t=>t?.settings?.validationRules)).forEach((t=>{n.find((e=>t.id===e.settings.fieldId))&&("string"==typeof t.settings.validationRules&&(t.settings.validationRules=JSON.parse(t.settings.validationRules)),t.settings.validationRules.forEach(((e,i)=>{const n=this.AB.filterComplexNew(`${t.columnName}_${i}`);"function"==typeof n.ui?s.push(n.ui()):s.push(n.ui),h.push({filter:n,view:n.ids.querybuilder,columnName:t.columnName,validationRules:e.rules,invalidMessage:e.invalidMessage})})))})),t.rows=s,t}async init(t,e,i={}){await super.init(t),this.view.superComponent().init(t,e,i),this.initCallbacks(i),this.initEvents(),this.initValidationRules();const s=this.AB.Webix,n=$$(this.ids.form);n&&s.extend(n,s.ProgressBar),e<2&&n.disable()}initCallbacks(t={}){t?.clearOnLoad&&(this.view.settings.clearOnLoad=t.clearOnLoad());const e=this.view;t.onBeforeSaveData?e._callbacks.onBeforeSaveData=t.onBeforeSaveData:e._callbacks.onBeforeSaveData=()=>!0}initEvents(){const t=this.datacollection;if(!t)return;this.eventAdd({emitter:t,eventName:"changeCursor",listener:t=>{this.view.fieldComponents((t=>t instanceof a)).forEach((e=>{const i=e.field();if("one"==i?.settings?.linkViaType&&i?.linkViaOneValues&&(delete i.linkViaOneValues,t[i.columnName]))if(Array.isArray(t[i.columnName])){let e=[];t[i.columnName].forEach((t=>{e.push(t[i.object.PK()])})),i.linkViaOneValues=e.join()}else i.linkViaOneValues=t[i.columnName]})),this.displayData(t)}});const e=this.ids;this.eventAdd({emitter:t,eventName:"initializingData",listener:()=>{const t=$$(e.form);t&&(t.disable(),t.showProgress?.({type:"icon"}))}}),this.eventAdd({emitter:t,eventName:"initializedData",listener:()=>{const t=$$(e.form);t&&(t.enable(),t.hideProgress?.())}}),this.eventAdd({emitter:t,eventName:"ab.datacollection.update",listener:(e,i)=>{if(!i?.objectId)return;const s=t.datasource;if(s&&(s.id===i.objectId||s.fields((t=>t.settings.linkObject===i.objectId)).length>0)){const e=t.getCursor();e&&this.displayData(e)}}});const i=t.datacollectionLink;i&&this.eventAdd({emitter:i,eventName:"changeCursor",listener:t=>{this.displayParentData(t)}})}initValidationRules(){const t=this.datacollection;if(!t)return;if(!h.length)return;const e=[];h.forEach((i=>{i.filter.applicationLoad(t.datasource.application),i.filter.fieldsLoad(t.datasource.fields()),i.filter.setValue(i.validationRules),Array.isArray(e[i.columnName])||(e[i.columnName]=[]),e[i.columnName].push({filters:$$(i.view).getFilterHelper(),invalidMessage:i.invalidMessage})}));const i=this.ids;Object.keys(e).forEach((s=>{const n=$$(i.form).queryView({name:s});n.$view.complexValidations=e[s],n.define("validate",(function(e,s,n){const a=$$(i.form).queryView({name:n});let r=!0;return a.$view.complexValidations.forEach((e=>{const i=t.datasource,s=this.getValues(),n={};(i.fields()||[]).forEach((t=>{n[t.id]=s[t.columnName]})),s.uuid&&(n.this_object=s.uuid),e.filters(n)||(r=!1,a.define("invalidMessage",e.invalidMessage))})),r})),n.refresh()}))}async loadDcDataOfRecordRules(){const t=[];return(this.settings?.recordRules??[]).forEach((e=>{(e?.actionSettings?.valueRules?.fieldOperations??[]).forEach((e=>{if("exist"!==e.valueType)return;const i=this.AB.datacollectionByID(e.value);i?.dataStatus===i.dataStatusFlag.notInitial&&t.push(i.loadData())}))})),await Promise.all(t)}async onShow(t){this.saveButton?.disable(),this._showed=!0;const e=this.view.superComponent();await e.onShow();const i=$$(this.ids.form),s=this.datacollection;if(s){this.settings.clearOnLoad&&s.setCursor(null);const t=s.getCursor();i&&s.bind(i),await this.displayData(t)}else await this.displayData(t??{});this.focusOnFirst(),i&&i.adjust(),await this.loadDcDataOfRecordRules(),this.saveButton?.enable()}async displayData(t){if(this.timerId)return;this.timerId=await async function(t){return new Promise((t=>setTimeout(t,80)))}();const e=this.view,i=e.fieldComponents((t=>t instanceof r||t instanceof o&&"rich"===t.settings.type||t instanceof l&&"filter"===t.settings.type));if(t)i.forEach((i=>{const s=e.viewComponents[i.id];s&&(this._showed&&s?.onShow?.(),i?.field()?.setValue($$(s.ids.formItem),t),s?.refresh?.(t))}));else{i.forEach((t=>{const i=t.field();if(!i)return;const s=e.viewComponents[t.id];if(!s)return;this._showed&&s?.onShow?.();const n={};i.defaultValue(n),i.setValue($$(s.ids.formItem),n),s?.refresh?.(n)})),e.fieldComponents((t=>t instanceof n&&!(t instanceof r))).forEach((t=>{const i=t.field();if(!i)return;const s=e.viewComponents[t.id];if(!s)return;if("button"===t.key)return;const n=i.columnName,a={};i.defaultValue(a),$$(s.ids.formItem)?.setValue(a[n]??"")}));const t=this.datacollection.datacollectionLink;if(t){const e=t.getCursor();this.displayParentData(e)}}this.timerId=null}displayParentData(t){const e=this.datacollection;if(e.getCursor())return;const i=e.fieldLink;if(!i)return;const s=this.view,a=s.fieldComponents((t=>t instanceof n&&t.field()?.id===i.id))[0];if(!a)return;const r=s.viewComponents[a.id];if(!r)return;const o=$$(r.ids.formItem),l={};l[i.relationName()]=t,i.setValue(o,l)}detatch(){}focusOnFirst(){const t=this.view;let e=0,i="";t.views().forEach((t=>{"textbox"!==t.key&&"numberbox"!==t.key||t.position.y===e&&(e=t.position.y,i=t.id)}));const s=t.viewComponents[i];s&&$$(s.ids.formItem)&&$$(s.ids.formItem).focus()}get saveButton(){return $$(this.ids.form)?.queryView({view:"button",type:"form"})}}},13783:(t,e,i)=>{const s=i(15796);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewFormConnect_${t.id}`,Object.assign({popup:"",editpopup:""},i)),this.addPageComponent=null,this.editPageComponent=null}get field(){return this.view.field()}ui(){const t=this.field,e=this.view,i=e.parentFormComponent(),s=this.settings;if(!t)return console.error(`This field could not found : ${s.fieldId}`),super.ui({view:"label",label:""});const n="many"==t.settings.linkType,a=i?.settings||{},r=this.ids;let o={id:r.formItem,view:n?"multicombo":"combo",name:t.columnName,required:t?.settings?.required||parseInt(s?.required)||!1,dataFieldId:t.id,on:{onItemClick:(t,e)=>{if(e.target.classList.contains("editConnectedPage")&&e.target.dataset.itemId){const t=e.target.dataset.itemId;if(!t)return;this.goToEditPage(t)}},onChange:t=>{this._onChange(t)}}};a.showLabel&&(o.label=t.label,o.labelWidth=a.labelWidth,o.labelPosition=a.labelPosition),this.initAddEditTool(),o.suggest={button:!0,selectAll:!!n,body:{data:[],template:(e?.settings?.editForm?'<i data-item-id="#id#" class="fa fa-cog editConnectedPage"></i>':"")+"#value#"},on:{onShow:()=>{t.populateOptionsDataCy($$(r.formItem),t,i)}},filter:({value:t},e)=>t.toLowerCase().includes(e.toLowerCase())},o.onClick={customField:(e,i,n)=>{if(1===s.disable)return;const a={},o=$$(r.formItem);if(o){const e=o.$view;t.customEdit(a,e)}}};let l=this.addPageComponent?.ui;return l?(o.label="",o.labelWidth=0,l.on={onItemClick:()=>(this.addPageComponent?.onClick(i.datacollection),!1)},o={inputId:r.formItem,rows:[{cols:[{view:"label",label:t.label,width:a.labelWidth,align:"left"},l,o]}]},o=super.ui(o)):(o={inputId:r.formItem,rows:[o]},o=super.ui(o),delete o.rows[0].id),o}async _onChange(t){const e=this.ids,i=this.field,s=this.view;let n;Array.isArray(t)?(n=[],t.forEach((t=>{n.push(t.id||t)}))):(n=t,"object"!=typeof t&&(n=i.getItemFromVal(t)),n=n?.id?n.id:t);const a=$$(e.formItem);if("one"==this?.field?.settings?.linkViaType&&(this.busy(),await i.getAndPopulateOptions(a,s.options,i,s.parentFormComponent()),this.ready()),a){a.blockEvent();const t=n.join?n.join():n;a.setValue(t),a.unblockEvent()}}async init(t,e){await super.init(t);const i=$$(this.ids.formItem);i&&webix.extend(i,webix.ProgressBar),this.initAddEditTool()}initAddEditTool(){const t=this.view,e=t?.settings?.formView;e&&t&&!this.addPageComponent&&(this.addPageComponent=t.addPageTool.component(this.AB,`${t.id}_${e}`),this.addPageComponent.applicationLoad(t.application),this.addPageComponent.init({onSaveData:this.callbackSaveData.bind(this),onCancelClick:this.callbackCancel.bind(this),clearOnLoad:this.callbackClearOnLoad.bind(this)}));const i=t?.settings?.editForm;i&&t&&!this.editPageComponent&&(this.editPageComponent=t.editPageTool.component(this.AB,`${t.id}_${i}`),this.editPageComponent.applicationLoad(t.application),this.editPageComponent.init({onSaveData:this.callbackSaveData.bind(this),onCancelClick:this.callbackCancel.bind(this),clearOnLoad:this.callbackClearOnLoad.bind(this)}))}async callbackSaveData(t){if(null==t)return;Array.isArray(t)||(t=[t]);const e=this.ids,i=this.field,s=$$(e.formItem);if(!s)return;this.busy(),i.clearStorage(this.view.settings.filterConditions);const n=await i.getAndPopulateOptions(s,this.view.options,i,this.view.parentFormComponent());if(this.ready(),n.forEach((t=>{t.value=t.text})),s.getList().clearAll(),s.getList().define("data",n),"many"===i.settings.linkType){let e=s.getValue();t.forEach((t=>{-1===e.indexOf(t.id)&&(e=e?`${e},${t.id}`:t.id)})),s.setValue(e)}else s.setValue(t[0].id)}callbackCancel(){return $$(this.ids?.popup)?.close?.(),!1}callbackClearOnLoad(){return!0}getValue(t){return this.field.getValue($$(this.ids.formItem),t)}formBusy(t){t&&(t.disable?.(),t.showProgress?.({type:"icon"}))}formReady(t){t&&(t.enable?.(),t.hideProgress?.())}goToEditPage(t){const e=this.settings;if(!e.editForm)return;const i=this.view.application.urlResolve(e.editForm);i&&($$(this.ids.formItem).getFormView(),this.editPageComponent.onClick().then((()=>{const e=i.datacollection;e&&(e.setCursor(t),this.__editFormDcEvent=this.__editFormDcEvent||e.on("initializedData",(()=>{e.setCursor(t)})))})))}async onShow(){const t=this.ids,e=$$(t.formItem);if(!e)return;const i=this.field;if(!i)return;const s=e.$view;if(!s)return;const n=$$(s);if(!n)return;const a=this.settings;let r={glue:"and",rules:[]};if(a?.filterConditions?.rules?.length&&(r=this.AB.cloneDeep(this.view.settings.filterConditions)),!r?.rules?.length&&a?.objectWorkspace?.filterConditions?.rules?.length&&(r=this.AB.cloneDeep(a.objectWorkspace.filterConditions)),(a?.filterConnectedValue??"").indexOf(":")>-1){const t=a.filterConnectedValue.split(":"),e=t[0],i=t[1];r.rules.push({key:i,rule:"filterByConnectValue",value:e})}const o=(t,e=0)=>[...t.rules.filter((t=>"filterByConnectValue"===t.rule)).map((t=>{const i=Object.assign({},t);return i.depth=e,i}))].concat(...t.rules.filter((t=>t.glue)).map((t=>o(t,e+1)))),l=this.view,h=o(r).map((t=>{for(const e in l.parent.viewComponents){if(!(l.parent.viewComponents[e]instanceof this.constructor))continue;const i=$$(l.parent.viewComponents[e].ui().rows.find((t=>t.inputId))?.inputId);if(i?.config?.name===t.value){t.filterValue=i;break}}const e=this.AB,i=e.objectByID(a.objectId).fieldByID(a.fieldId),s=e.objectByID(i.settings.linkObject).fieldByID(t.key);return t.filterColumn=s?.settings?.isCustomFK?e.objectByID(s.settings.linkObject).fields((t=>t.id===s.settings.indexField||s.settings.indexField2))[0].columnName:null,t}));if(l.options={formView:a.formView,filters:r,sort:a.sortFields??a.objectWorkspace?.sortFields,editable:1!==a.disable,editPage:!(!a.editForm||"none"===a.editForm),filterByConnectValues:h},l.options.editable){const t=[];h.forEach((e=>{if(e.filterValue&&e.key){const s=$$(e.filterValue.config.id);let a=null;s?(i.getValue(s)||(a={id:e.filterValue.config.id,label:s.config.label}),s.attachEvent("onChange",(async t=>{s.getValue()?(n.define("disabled",!1),n.define("placeholder",this.label("Select items")),this.busy(),await i.getAndPopulateOptions(n,l.options,i,l.parentFormComponent()),this.ready()):(n.define("disabled",!0),n.define("placeholder",this.label("Must select item from '{0}' first.",[s.config.label]))),n.refresh()}),!1)):a={id:"perentElement",label:this.label("PARENT ELEMENT")},a&&t.findIndex((t=>t.id===a.id))<0&&t.push(a)}})),t.length&&!n.getValue()?(n.define("disabled",!0),n.define("placeholder",this.label("Must select item from '{0}' first.",[t.map((t=>t.label)).join(", ")]))):(n.define("disabled",!1),n.define("placeholder",this.label("Select items")))}else n.define("placeholder",""),n.define("disabled",!0);n.refresh(),this.busy(),await i.getAndPopulateOptions(e,l.options,i,l.parentFormComponent()),this.ready();const c=`${i.key} ${i.columnName} ${i.id} ${l.parent.id}`;s.setAttribute("data-cy",c),this._onChange(e.getValue())}busy(){const t=$$(this.ids.formItem);t?.disable(),t?.showProgress?.({type:"icon"})}ready(){const t=$$(this.ids.formItem);t?.enable(),t?.hideProgress?.()}}},23622:(t,e,i)=>{const s=i(15796),n=i(70780),a=i(56562);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewFormCustom_${t.id}`,i)}get new_width(){const t=this.view,e=t.parentFormComponent()?.settings??{},i=t.settings??{};let s=e.labelWidth;return i.formView?s+=40:e.showLabel&&"top"===e.labelPosition&&(s=0),s}ui(){const t=this.view,e=t.field(),i=t.parentFormComponent()?.settings??{},s=e?.settings??t.settings??{},r=e?.settings?.required||this.settings.required?"webix_required":"";let o="";i.showLabel&&(o="top"===i.labelPosition?`<label style="display:block; text-align: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;" class="webix_inp_top_label ${r}">#label#</label>`:`<label style="width: #width#px; display: inline-block; line-height: 32px; float: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;" class="${r}">#label#</label>`);let l=38;e instanceof n?s.useHeight?"top"===i.labelPosition?(l=parseInt(s.imageHeight)||80,l+=38):l=parseInt(s.imageHeight)||80:l="top"===i.labelPosition?118:80:i.showLabel&&"top"===i.labelPosition&&(l=80);const h=`<div class="customField ${i.labelPosition}">${"top"==i.labelPosition?"":o}#template#</div>`.replace(/#width#/g,i.labelWidth).replace(/#label#/g,e.label).replace(/#template#/g,e?.columnHeader({width:this.new_width,height:l,editable:!0}).template({})??"");return super.ui({view:"forminput",labelWidth:0,paddingY:0,paddingX:0,css:"ab-custom-field",body:{view:new a(this.AB._App).key,css:"customFieldCls",borderless:!0,template:h,height:l,onClick:{customField:(t,i,n)=>{if(1===s.disable)return;let a={};const r=this?.parentFormComponent?.()||this.view?.parentFormComponent?.();if(r){const t=r.datacollection;t&&(a=t.getCursor()||{})}let o=$$(n).getParentView().$view;e?.customEdit(a,this.AB_App,o,this.ids.formItem,t)}}}})}onShow(){const t=this.ids,e=$$(t.formItem);if(!e)return;const i=this.view,s=i.field(),a=e.$view,r=`${i.key} ${s.key} ${s.columnName} ${i.id} ${i.parent.id}`;a.setAttribute("data-cy",r);const o={formId:t.formItem,editable:1!==i.settings.disable};s instanceof n&&(o.height=s.settings.useHeight&&parseInt(s.settings.imageHeight)||80,o.width=s.settings.useWidth&&parseInt(s.settings.imageWidth)||this.new_width),s.customDisplay({},this.AB._App,a,o)}getValue(t){const e=this.view.field(),i=$$(this.ids.formItem);return e.getValue(i,t)}}},52668:(t,e,i)=>{const s=i(15796);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewFormDatepicker_${t.id}`,i)}ui(){const t=this,e=this.view.field(),i={view:"datepicker",suggest:{body:{view:"th"==this.AB.Account?._config?.languageCode?"thaicalendar":"calendar",on:{onAfterDateSelect:function(t){this.getParentView().setMasterValue({value:t})},onTodaySet:function(t){this.getParentView().setMasterValue({value:t})},onDateClear:function(t){this.getParentView().setMasterValue({value:t})}}},on:{onShow:function(){const e=this.getMasterValue(),i=t.view.field();if(!e||!i)return!0;const s={};s[i.columnName]=e;const n=t.getValue(s);this.getChildViews()[0].setValue(n)}}}};return e?(1===e.settings?.dateFormat&&(i.type="time"),"datetime"===e.key&&1!==e.settings?.timeFormat&&(i.timepicker=!0),i.editable=!0,!i.value||i.value instanceof Date||(i.value=new Date(i.value)),null===e||window.webixLocale||(i.format=e.getFormat()),super.ui(i)):i}getValue(t){const e=this.view.field(),i=t[e.columnName];if(!e||!i)return null;const s=this.AB.Webix.Date.strToDate(e.getFormat())(i);return"th"==this.AB.Account?._config?.languageCode&&s.setFullYear(s.getFullYear()-543),s}}},15796:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewFormItem_${t.id}`,Object.assign({formItem:""},i))}ui(t={}){const e=this.view,i=e.parentFormComponent(),s=e.field?.()||null,n=i?.settings||{},a={id:this.ids.formItem,labelPosition:n.labelPosition,labelWidth:n.labelWidth,label:""};if(s){a.name=s.columnName;const t={};s.defaultValue(t),t[s.columnName]&&(a.value=t[s.columnName]),n.showLabel&&(a.label=s.label),(s.settings.required||e.settings?.required)&&(a.required=1),1===e.settings?.disable&&(a.disabled=!0),a.on={onAfterRender(){if(this.getList){const t=this.getPopup();if(!t)return;this.getList().data.each((e=>{if(!e)return;const n=t.$view.querySelector(`[webix_l_id='${(e?.id??"").toString().replaceAll("'","\\'")}']`);n&&n.setAttribute("data-cy",`${s.key} options ${e.id} ${s.id} ${i?.id||"nf"}`)}))}this.getInputNode?.().setAttribute?.("data-cy",`${s.key} ${s.columnName} ${s.id} ${i?.id||"nf"}`)}},a.validate=(t,e,i)=>{const n=this.AB.Validation.validator();return s.isValidData(e,n),n.pass()}}const r=super.ui([Object.assign({},a,t)]);return delete r.type,r}}},75727:(t,e,i)=>{const s=i(15796);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewFormJson_${t.id}`,i),"filter"==this.settings.type&&(this.rowFilter=this.AB.filterComplexNew(`${t.id}_filterComplex`,{isSaveHidden:!0,height:300,borderless:!1,showObjectName:!0}))}getFilterField(t){if(t?.settings?.filterField&&t?.view?.parent?.viewComponents){let e="";for(const[i,s]of Object.entries(t.view.parent.viewComponents))s.settings.fieldId==t.settings.filterField&&(e=s);return e?.ids?.formItem?e.ids.formItem:""}return""}get getSystemObjects(){let t=this.AB.objects(),e=[];return t.forEach((t=>{e.push({id:t.id,label:t.label})})),e}refreshFilter(t){if(t){let e=[];t.forEach((t=>{let i=this.AB.objectByID(t).fields();i.length&&i.forEach((t=>{e.push(t)}))})),this.rowFilter.fieldsLoad(e),$$(this.ids.formItem).config.value&&this.rowFilter.setValue($$(this.ids.formItem).config.value)}else this.rowFilter.fieldsLoad([]),$$(this.ids.formItem).config.value&&this.rowFilter.setValue($$(this.ids.formItem).config.value)}getValue(){return this.rowFilter.getValue()}setValue(t){$$(this.ids.formItem).config.value=t}ui(){const t={};switch(this.settings.type||this.view.settings.type||this.view.constructor.defaultValues().type){case"string":t.view="textarea",t.disabled=!0,t.height=200,t.format={parse:function(t){try{t=JSON.parse(t)}catch(t){}return t},edit:function(t){try{t=JSON.stringify(t)}catch(t){}return t}};break;case"systemObject":t.view="multicombo",t.placeholder=this.label("Select one or more system objects"),t.button=!1,t.stringResult=!1,t.suggest={selectAll:!0,body:{data:this.getSystemObjects,template:webix.template("#label#")}};break;case"filter":t.view="forminput",t.css="ab-custom-field",t.body=this.rowFilter.ui}return super.ui(t)}init(){}onShow(){if(this.ui(),"filter"==this?.settings?.type){let t=this.getFilterField(this);if(!$$(t))return;$$(t).detachEvent("onChange"),$$(t).attachEvent("onChange",(t=>{this.refreshFilter(t)})),this.rowFilter.init({showObjectName:!0}),this.rowFilter.on("changed",(t=>{this.setValue(t)})),$$(this.ids.formItem).config.value?this.rowFilter.setValue($$(this.ids.formItem).config.value):this.rowFilter.setValue("")}}}},54194:(t,e,i)=>{const s=i(15796),n=i(84756);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewFormNumber_${t.id}`,i),this._numberTextInputKey=null}get numberTextInputKey(){return this._numberTextInputKey=this._numberTextInputKey||new n(this.AB._App).key}ui(){return super.ui({view:this.settings.isStepper?"counter":this.numberTextInputKey,type:"number",validate:t=>!isNaN(1*t)})}}},19215:(t,e,i)=>{const s=i(15796);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewFormReadonly_${t.id}`,Object.assign({template:""},i))}ui(){const t=this.view,e=t.field(),i={view:"forminput",labelWidth:0,paddingY:0,paddingX:0,readonly:!0,css:"ab-readonly-field",body:{id:this.ids.template,view:"label",borderless:!0,css:{"background-color":"#fff"},label:""}},s=t.parentFormComponent().settings||{};return 1==s.showLabel&&"top"==s.labelPosition?i.body.height=80:e.settings.useHeight?i.body.height=parseInt(e.settings.imageHeight)||38:i.body.height=38,super.ui(i)}async init(t){await super.init(t);const e=$$(this.ids.formItem);if(!e)return;const i=e.getFormView(),s=i?.getValues()??{};this.refresh(s),i?.attachEvent("onChange",((t,e)=>{const s=i?.getValues()??{};this.refresh(s)}))}onShow(){const t=$$(this.ids.formItem);if(!t)return;const e=t.getFormView()?.getValues()??{};this.refresh(e)}getValue(t){const e=this.view.field();return e?t[e.columnName]:null}refresh(t){const e=this.view,i=e.parentFormComponent(),s=e.field(),n=i.settings||{};let a="";n.showLabel&&(a="top"===n.labelPosition?`<label style="display:block; text-align: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;" class="webix_inp_top_label">${s.label}</label>`:`<label style="width: ${n.labelWidth}px; display: inline-block; line-height: 32px; float: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;">${s.label}</label>`);let r=n.labelWidth;this.settings.formView?r+=40:n.showLabel&&"top"===n.labelPosition&&(r=0);const o=`<div class="readonlyField">${a}#template#</div>`.replace(/#template#/g,s.columnHeader({width:r,editable:!0}).template(t));$$(this.ids.template)?.setHTML(o)}}},38719:(t,e,i)=>{const s=i(15796);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewFormSelectMultiple_${t.id}`,i)}ui(){const t=this.view,e=t.field(),i=this.settings,s=[];"user"===e?.key?s.push(...e.getUsers()):e&&s.push(...e.settings.options??i.options??[]);const n=this.ids,a={id:n.formItem,view:i.type||t.constructor.defaultValues().type,options:s.map((t=>({id:t.id,value:t.text,hex:t.hex})))};switch(a.view){case"multicombo":a.tagMode=!1,a.css="hideWebixMulticomboTag",a.tagTemplate=t=>{const i=[],s=$$(n.formItem)??$$(a.id);t.forEach((t=>{i.push(s.getList().getItem(t))}));let r=i;e.getSelectedOptions&&(r=e.getSelectedOptions(e,i));const o=[];return r.forEach((t=>{let i="",s="";e.settings.hasColors&&t.hex&&(i="hascustomcolor",s=`background: ${t.hex};`);const n=t.text?t.text:t.value;o.push(`<span class="webix_multicombo_value ${i}" style="${s}" optvalue="${t.id}"><span>${n}</span><span class="webix_multicombo_delete" role="button" aria-label="Remove item"></span></span>`)})),o.join("")};break;case"checkbox":a.options.push({id:"temp",value:this.label("Option")})}return super.ui(a)}getValue(t){const e=this.view.field(),i=$$(this.ids.formItem);return e.getValue(i,t)}}},36059:(t,e,i)=>{const s=i(15796);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewFormSelectSingle_${t.id}`,i)}ui(){const t=this.view,e=t.field(),i=t.settings,s=[];"user"===e?.key?s.push(...e.getUsers()):e?s.push(...e.settings.options??i.options??[]):s.push(...i.options??[]);const n={view:i.type||t.constructor.defaultValues().type};return e?.settings.hasColors?(n.css="combowithcolors",n.options={view:"suggest",body:{view:"list",data:s.map((t=>({id:t.id,value:t.text||t.value,hex:e.settings.hasColors?t.hex:""}))),template:function(t){const e=[];let i="",s="";return t.hex&&(i="hascustomcolor",s=`background: ${t.hex};`),e.push(`<span class="webix_multicombo_value ${i}" style="${s}" optvalue="${t.id}"><span>${t.value}</span></span>`),e.join("")}}}):n.options=s.map((t=>({id:t.id,value:t.text||t.value}))),"radio"===n.view&&n.options.length<1&&n.options.push({id:"temp",value:this.label("Option")}),super.ui(n)}}},60306:(t,e,i)=>{const s=i(15796);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewFormTextbox_${t.id}`,i)}ui(){const t={};switch(this.settings.type||this.view.settings.type||this.view.constructor.defaultValues().type){case"single":t.view="text";break;case"multiple":t.view="textarea",t.height=200;break;case"rich":t.view="forminput",t.height=200,t.css="ab-rich-text",t.body={view:"tinymce-editor",value:"",cdn:"/js/webix/extras/tinymce",config:{plugins:"link",menubar:"format edit",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | fontsizeselect | link"}}}return super.ui(t)}onShow(){const t=this.view.settings??{},e=this.ui().rows[0];let i=$$(e.id);if("rich"===t.type&&i){i=this.AB.Webix.ui(e,i);const t=this.view;i.getChildViews()[0].getEditor(!0).then((i=>{const s=`${t.key} rich ${e.name} ${t.id??""} ${t.parent?.id??""}`;i.contentAreaContainer.setAttribute("data-cy",s)}))}}}},8690:(t,e,i)=>{const s=i(15796);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewFormTree_${t.id}`,i)}ui(){const t=this.view,e=t.field(),i={};if(!e)return super.ui(i);const s=t.parentFormComponent().settings||{},n=1===e.settings.required?"webix_required":"";let a="";s.showLabel&&(a="top"===s.labelPosition?`<label style="display:block; text-align: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;" class="webix_inp_top_label ${n}">#label#</label>`:`<label style="width: #width#px; display: inline-block; line-height: 32px; float: left; margin: 0; padding:1px 7.5px 0 3px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;" class="${n}">#label#</label>`);let r=s.labelWidth;this.settings.formView&&(r+=40);const o=`${a}#template#`.replace(/#width#/g,s.labelWidth).replace(/#label#/g,e.label).replace(/#template#/g,e.columnHeader({width:r}).template);return i.view="template",i.css="webix_el_box",i.height=1===e.settings.useHeight?parseInt(e.settings.imageHeight):38,i.borderless=!0,i.template=`<div class="customField">${o}</div>`,i.onClick={customField:(t,i,s)=>{const n={},a=$$(this.ids.formItem).$view;n[e.columnName]=this.getValue(),e.customEdit(n,this.AB._App,a,this)}},super.ui(i)}getValue(t){let e=$$(this.ids.formItem).getValues();return Array.isArray(e)&&0===e.length&&(e=""),e}}},50778:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewImage_${t.id}`,Object.assign({image:""},i))}ui(){const t=this.settings,e=super.ui([{cols:[{id:this.ids.image,view:"template",template:"",height:t.height,width:t.width},{}]}]);return delete e.type,e}async init(t){await super.init(t);const e=$$(this.ids.image);if(!e)return;const i=this.settings;i.filename?e.define("template",`<img src="/file/${i.filename}" height="${i.height}" width="${i.width}">`):e.define("template",""),e.refresh()}}},54394:(t,e,i)=>{const s=i(26086).Z,n=i(95341);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewKanBan_${t.id}`,Object.assign({kanbanView:"",kanban:"",resizer:"",formSidePanel:""},i)),this.FormSide=new n(this,this.ids.formSidePanel,this.settings.editFields),this.CurrentVerticalField=null,this.CurrentHorizontalField=null,this.CurrentOwnerField=null,this.TextTemplate=t.TextTemplate,this._updatingOwnerRowId=null,this._ABFieldConnect=null,this._ABFieldUser=null,this._ABFieldList=null}get ABFieldConnect(){return this._ABFieldConnect=this._ABFieldConnect||this.AB.Class.ABFieldManager.fieldByKey("connectObject")}get ABFieldUser(){return this._ABFieldUser=this._ABFieldUser||this.AB.Class.ABFieldManager.fieldByKey("user")}get ABFieldList(){return this._ABFieldList=this._ABFieldList||this.AB.Class.ABFieldManager.fieldByKey("list")}ui(){const t=this.ids,e=this;this.linkPage=this.view.linkPageHelper.component();const i=super.ui([{id:t.kanbanView,cols:[{id:t.kanban,view:"kanban",cols:[],userList:{view:"menu",template:'<i class="fa fa-user"></i> #value#',width:150,on:{onSelectChange:function(){if(!e._updatingOwnerRowId)return;const t=this.getSelectedId(!1);t&&e.updateOwner(e._updatingOwnerRowId,t)}}},editor:!1,users:[],tags:[],data:[],on:{onListAfterSelect:(t,e)=>{this.CurrentDatacollection?.setCursor(t),this.emit("select",t);const i=this.settings.editPage;i&&this.linkPage.changePage(i,t);const s=this.settings.detailsPage;s&&this.linkPage.changePage(s,t)},onAfterStatusChange:(t,e)=>{this.updateStatus(t,e)},onAvatarClick:t=>{this._updatingOwnerRowId=t}}},{id:t.resizer,view:"resizer",css:"bg_gray",width:11,hidden:!0},this.FormSide.ui()]}]);return delete i.type,i}async init(t){await super.init(t);const e=this.AB.Webix;this.$kb&&e.extend(this.$kb,e.ProgressBar),this.FormSide.init(t),this.FormSide.on("add",(t=>{this.saveData(t)})),this.FormSide.on("update",(t=>{this.saveData(t)}));let i=this.view.datacollection;i&&this.datacollectionLoad(i),this.linkPage.init({view:this.view,datacollection:i}),this.show()}get $kb(){return this._kb=this._kb||$$(this.ids.kanban)}kanbanListTemplate(){return{icons:[{icon:"fa fa-trash-o",click:t=>{this.removeCard(t)}}],templateAvatar:t=>this.CurrentOwnerField&&t[this.CurrentOwnerField.columnName]?this.CurrentOwnerField.format(t):"<span class='webix_icon fa fa-user'></span>",templateBody:t=>this.TextTemplate.text?this.TextTemplate.displayText(t):this.CurrentObject?.displayData(t)}}hide(){$$(this.ids.kanbanView)?.hide()}async show(){const t=this.ids;$$(t.kanbanView)?.show(),this.FormSide.hide(),$$(t.resizer)?.hide();var e=this.CurrentObject;if(e||(e=this.datacollection?.datasource),!e)return;const i=e.fieldByID(this.settings.verticalGroupingField);if(!i)return;this.CurrentVerticalField=i;let s=[];const n=e.fieldByID(this.settings.horizontalGroupingField);this.CurrentHorizontalField=n,n&&n instanceof this.ABFieldConnect&&(s=await n.getOptions());const a=(i.settings.options||[]).map((t=>{if(i&&n){let e=[],a=[];return n instanceof this.ABFieldList?a=(n.settings.options||[]).map((t=>t)):n instanceof this.ABFieldUser?a=n.getUsers().map((t=>({id:t.id,text:t.text||t.value}))):n instanceof this.ABFieldConnect&&(a=s.map((({id:t,text:e})=>({id:t,text:e})))),a.push({id:null,text:this.label("Other")}),a.forEach((s=>{const a={};a[i.columnName]=t.id,a[n.columnName]=s.id,e.push({template:s.text,height:20,css:"progress_header"}),e.push({view:"kanbanlist",status:a,type:this.kanbanListTemplate()})})),{header:t.text,body:{margin:0,rows:e}}}if(i){const e={};return e[i.columnName]=t.id,{header:t.text,body:{view:"kanbanlist",status:e,type:this.kanbanListTemplate()}}}})),r=this.AB;r.Webix.ui(a,$$(t.kanban)),$$(t.kanban).reconstruct();const o=e.fieldByID(this.settings.ownerField);if(this.CurrentOwnerField=o,o){const e=$$(t.kanban).getUserList();if(e.clearAll(),o instanceof this.ABFieldUser){const t=r.Account.userList().map((t=>({id:t.username,value:t.username})));e.parse(t)}else if(o instanceof this.ABFieldConnect){const t=await o.getOptions();try{e.parse(t.map((t=>({id:t.id,value:t.text}))))}catch(e){console.error(e),console.warn(t)}}}}busy(){this.$kb?.showProgress?.({type:"icon"})}ready(){this.$kb?.hideProgress?.()}objectLoad(t){super.objectLoad(t),this.TextTemplate.objectLoad(t),this.FormSide.objectLoad(t)}datacollectionLoad(t){super.datacollectionLoad(t);const e=this.CurrentDatacollection||t;if(e){e.bind(this.$kb);const t=e.datasource;t&&this.objectLoad(t)}else this.$kb.unbind()}async updateStatus(t,e){if(!this.CurrentVerticalField)return;this.busy();let i={};e instanceof Object?i=e:i[this.CurrentVerticalField.columnName]=e;let s=!1;for(const t in i)i[t]||(i[t]="",s=!0);try{if(await(this.CurrentObject?.model().update(t,i)),this.ready(),s&&this.show(),this.FormSide.isVisible()){const e=$$(this.ids.kanban).getItem(t);this.FormSide.refresh(e)}}catch(e){this.AB.notify.developer(e,{context:"ABViewKanban:updateStatus(): Error saving item:",rowId:t,patch:i})}}async updateOwner(t,e){if(!this.CurrentOwnerField)return;this.busy();const i={};i[this.CurrentOwnerField.columnName]=e;try{const e=await(this.CurrentObject?.model().update(t,i));if(this.$kb?.updateItem(t,e),this.FormSide.isVisible()){const e=this.$kb.getItem(t);this.FormSide.refresh(e)}this.ready()}catch(i){this.AB.notify.developer(i,{context:"ABViewKanban:updateOwner(): Error saving item:",rowId:t,val:e}),this.ready()}}saveData(t){t.id&&this.$kb.exists(t.id)?this.$kb.updateItem(t.id,t):this.$kb.add(t)}unselect(){this.$kb&&this.$kb.eachList((t=>{t?.unselect?.()}))}addCard(){this.unselect(),this.FormSide.show(),$$(this.ids.resizer).show()}async removeCard(t){const e=this.AB,i=e.Webix;i.confirm({title:this.label("Remove card"),text:this.label("Do you want to delete this card?"),callback:async s=>{if(s){this.busy();try{(await(this.CurrentObject?.model().delete(t))).numRows>0?this.$kb.remove(t):i.alert({text:this.label("No rows were effected. This does not seem right.")})}catch(i){e.notify.developer(i,{message:"ABViewKanban:removeCard(): Error deleting item:",rowId:t})}this.ready()}}})}setFields(t){this.CurrentVerticalField=t.verticalGrouping,this.CurrentHorizontalField=t.horizontalGrouping,this.CurrentOwnerField=t.ownerField}}},39146:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewLabel_${t.id}`,i)}ui(){const t=this.view,e=super.ui([this.uiFormatting({view:"label",label:t.text||"*",align:this.settings.alignment,type:{height:"auto"}})]);return delete e.type,e}uiFormatting(t){switch(parseInt(this.settings.format)){case 0:t.css="ab-component-label ab-ellipses-text";break;case 1:t.css="ab-component-header ab-ellipses-text";break;case 2:t.css="ab-component-description ab-ellipses-text"}return t}}},67675:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewLayout_${t.id}`,i);const s=this.viewComponents??{};t.views().forEach((t=>{s[t.id]=t.component()})),this.viewComponents=s}ui(){const t=this.viewComponents,e=Object.keys(t).map((e=>t[e].ui())).filter((t=>t));0==e.length&&(e.push({}),e.push({view:"label",label:this.label("no content")}),e.push({}));const i=super.ui([{view:"layout",cols:e}]);return delete i.type,i}async init(t,e){await super.init(t);const i=this.view;i.views().forEach((s=>{this.viewComponents[s.id]?.init(t,e),i.eventAdd({emitter:s,eventName:"changePage",listener:t=>{i.changePage(t)}})}))}onShow(){this.view.views().forEach((t=>{this.viewComponents[t.id]?.onShow()}))}}},11363:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewList_${t.id}`,Object.assign({list:""},i))}ui(){const t=this.settings,e={id:this.ids.list,view:"dataview",type:{width:1e3,height:30},template:t=>{const e=this.view.field();return e?e.format(t):""}};0!==t.height?e.height=t.height:e.autoHeight=!0;const i=super.ui([e]);return delete i.type,i}async init(t){await super.init(t);const e=this.datacollection;e&&e.bind($$(this.ids.list))}}},60586:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewMenu_${t.id}`,Object.assign({menu:""},i))}ui(){const t=this.settings,e=super.ui([parseInt(t.menuInToolbar)?this.uiToolbar():this.uiMenu()]);return delete e.type,e}uiMenu(){const t=this.view,e=this.settings,i=t.constructor.defaultValues(),s=`${e.buttonStyle||i.buttonStyle} ${e.menuAlignment||i.menuAlignment} `;return{id:this.ids.menu,view:"menu",autoheight:!0,autowidth:!0,datatype:"json",css:s,layout:e.orientation||i.orientation,on:{onMenuItemClick:t=>{this.onClick(t)},onAfterRender:()=>{this.defineCypress()}},type:{subsign:!0}}}uiToolbar(){const t=this.settings,e=this.view,i=e.constructor.defaultValues(),s=this.uiMenu();let n=[],a=!1;const r=e.menuTextLeft??t.menuTextLeft,o=e.menuTextCenter??t.menuTextCenter,l=e.menuTextRight??t.menuTextRight;if("left"===t.menuPosition)a=!0,n.push(s);else if(r?.length){const t=15*r.length;n.push({view:"label",label:r,align:"left",width:t})}else n.push({view:"label",label:"",autowidth:!0});if("center"===t?.menuPosition)a=!0,n.push(s);else if(o?.length){const t=15*r.length;n.push({},{view:"label",label:o,align:"center",width:t},{})}else n.push({view:"label",label:"",autowidth:!0});if("right"===t?.menuPosition)a=!0,n.push(s);else if(l?.length){const t=15*r.length;n.push({view:"label",label:l,align:"right",width:t})}else n.push({view:"label",label:"",autowidth:!0});return!1===a&&(n=[s]),{view:"toolbar",css:t.menuTheme??i.menuTheme,padding:t.menuPadding?parseInt(t.menuPadding):i.menuPadding,elements:n}}async init(t){await super.init(t);const e=$$(this.ids.menu),i=this.view;if(e){const t=this.settings;i.ClearPagesInView(e),t.order?.length&&(i.AddPagesToView(e,t.order),e.refresh())}}onClick(t){const e=$$(this.ids.menu).getMenuItem(t),i=this.view;if("tab"===e.type){i.changePage(e.pageId);const t=i.application.pages((t=>t.id===e.pageId),!0)[0];if(!t)return;const s=t.views((t=>t.id===e.id),!0)[0];if(!s)return;const n=s.parent;if(!n)return;this.toggleParent(n);const a=setInterval((()=>{$$(s.id)&&$$(s.id).isVisible()?clearInterval(a):n.emit("changeTab",s.id)}),100)}else i.changePage(t)}toggleParent(t){if(!t.parent)return!1;const e=t.parent;if(!e?.parent)return!1;e.parent.emit("changeTab",e.id),this.toggleParent(e.parent)}defineCypress(){const t=$$(this.ids.menu);t&&t.data.each((e=>{const i=t.getItemNode(e.id);if(!i)return;const s=this.AB.definitionByID(e.id);i.setAttribute("data-cy",`menu-item ${s?.name} ${e.id} ${this.view.id}`)}))}}},68906:(t,e,i)=>{const s=i(99299),n=i(26086).Z;t.exports=class extends n{constructor(t,e,i){super(t,e||`ABViewPDFImporter_${t.id}`,Object.assign({fileUploader:"",uploadList:"",dataview:"",fullImagePopup:"",fullImageCarousel:"",fullImageSelectToggle:"",fullImageLabel:"",selectAll:"",unselectAll:"",submit:""},i))}ui(){const t=this.ids,e=this;return super.ui([{rows:[{cols:[{id:t.fileUploader,view:"uploader",name:"records",link:t.uploadList,label:this.label("Upload a PDF file"),inputWidth:200,width:210,accept:"application/pdf",multiple:!1,autosend:!1,type:"icon",icon:"fa fa-file-pdf-o",on:{onBeforeFileAdd:t=>(this._csvFileInfo=t,!!this._csvFileInfo&&(this.loadFile(),!0))}},{id:t.uploadList,view:"list",type:"uploader",autoheight:!0,borderless:!0,onClick:{webix_remove_upload:(t,e)=>{this.removeFile(e)}}},{width:10},{view:"button",type:"icon",icon:"fa fa-th-large",maxWidth:30,click:()=>{this.displayBig()}},{view:"button",type:"icon",icon:"fa fa-th",maxWidth:30,click:()=>{this.displaySmall()}}]},{height:10},{id:t.dataview,view:"dataview",borderless:!0,css:"pdf-data-view",multiselect:!1,select:!1,type:{template:t=>this.pageTemplate(t),width:"auto",height:"auto"},on:{onSelectChange:t=>{this.renderPageImages()},onItemClick:function(t,i,s){i?.target?.className?.includes?.("unselect-page")?e.unselect(t):i?.target?.className?.includes?.("select-page")?e.select(t):i?.target?.className?.includes?.("pdf-zoom")&&(e._fullImagePopup.show(),$$(e.ids.fullImageCarousel).setActiveIndex(parseInt(t??0)-1),e.refreshFullImage())}}},{height:10},{cols:[{id:t.selectAll,view:"button",type:"icon",icon:"fa fa-check-square-o",maxWidth:160,label:this.label("Select All"),click:()=>{this.selectAll()}},{id:t.unselectAll,view:"button",type:"icon",icon:"fa fa-square-o",maxWidth:160,label:this.label("Unselect All"),click:()=>{this.unselectAll()}},{fillspace:!0},{id:t.submit,view:"button",css:"webix_primary",type:"icon",icon:"fa fa-floppy-o",disabled:!0,maxWidth:180,label:this.label("Submit"),click:()=>{this.submit()}}]}]}])}uiPopup(){const t=this.ids;return{id:t.fullImagePopup,view:"window",modal:!0,position:"center",headHeight:25,head:{cols:[{fillspace:!0},{view:"button",type:"icon",icon:"fa fa-times",maxWidth:25,height:25,click:()=>{$$(t.fullImagePopup)?.hide()}}]},body:{rows:[{id:t.fullImageCarousel,view:"carousel",width:600,height:500,navigation:{items:!0,buttons:!0,type:"side"},cols:[],on:{onShow:()=>{this.refreshFullImage()}}},{view:"layout",cols:[{id:t.fullImageSelectToggle,view:"toggle",type:"icon",offIcon:"fa fa-square-o",onIcon:"fa fa-check-square-o",offLabel:this.label("Unselected"),onLabel:this.label("Selected"),width:130,on:{onChange:t=>{const e=$$(this.ids.fullImageCarousel).getActiveIndex()+1;t?this.select(e):this.unselect(e)}}},{fillspace:!0},{id:t.fullImageLabel,view:"label",width:120,label:`${this.label("Page Number")}: #`}]}]}}}async init(t){await super.init(t);const e=$$(this.ids.dataview);if(e&&this.AB.Webix.extend(e,webix.ProgressBar),!this._fullImagePopup){const t=this.uiPopup();this._fullImagePopup=this.AB.Webix.ui(t)}}async _readFileBuffer(){const t=this._csvFileInfo;if(!t||!t.file)return Promise.resolve(new ArrayBuffer(0));const e=new FileReader;return new Promise(((i,s)=>{e.onload=t=>{const e=t.target.result;i(e)},e.onerror=t=>{s(t)},e.readAsArrayBuffer(t.file)}))}async _toBlob(t,e){if(e)return new Promise(((i,s)=>{e.toBlob((e=>{const s=new File([e],`${t}.png`,{type:"image/png"});i(s)}),"image/png")}))}async _uploadImage(t){const e=$$(this.ids.fullImageCarousel),i=`${this.view.id}_temp_canvas`,s=document.getElementById(i)??document.createElement("canvas");s.id=i,s.width=e.config.width-20,await this.showPage(t,s);const n=await this._toBlob(t,s);return new Promise(((t,e)=>{const i=this.AB.Webix.ui({view:"uploader",apiOnly:!0,upload:this.field.urlUpload(),inputName:"file",multiple:!1,on:{onFileUpload:(e,s)=>{t(s?.data?.uuid),i.destructor()},onFileUploadError:(t,i)=>{e(i)}}});i.addFile(n,n.size)}))}_increaseProgressValue(){const t=$$(this.ids.dataview),e=2*(t.getSelectedId(!0)??[]).length;this._progressSteps=this._progressSteps??0,this._progressSteps++,t?.showProgress?.({type:"bottom",position:this._progressSteps/e})}async loadFile(){if(this.clearDataview(),!this._csvFileInfo)return;const t=await this._readFileBuffer();this._pdfDoc=await s.getDocument(t).promise;const e=this._pdfDoc.numPages,i=$$(this.ids.dataview),n=$$(this.ids.fullImageCarousel),a=[];for(let t=1;t<=e;t++)i.add({id:t,pageNumber:t}),a.push({template:t=>this.fullImageTemplate(t),data:{pageNumber:t}});this.renderPageImages(),n&&this.AB.Webix.ui(a,n),$$(this.ids.submit)?.enable()}removeFile(t){return $$(this.ids.uploadList)?.remove(t),delete this._pdfDoc,delete this._csvFileInfo,this.clearDataview(),$$(this.ids.submit)?.disable(),!0}pageTemplateId(t){return`pdf-importer-${this.view.id}-${t}`}pageTemplate(t){return`\n      <div>\n         <div class="pdf-data-view-item">\n            <div>\n            ${$$(this.ids.dataview).getSelectedId(!0).filter((e=>e==t.id)).length?'<i class="unselect-page fa fa-check-square-o"></i>':'<i class="select-page fa fa-square-o"></i>'}\n            </div>\n            <div style="width: 15px;">\n               ${t.pageNumber}\n            </div>\n         </div>\n         <div class="pdf-zoom pdf-data-view-image">\n            <canvas class="pdf-zoom" width="${this.pageItemWidth}" id="${this.pageTemplateId(t.pageNumber)}"></canvas>\n            <div class="pdf-zoom pdf-data-view-image-icon">\n               <i class="pdf-zoom fa fa-search-plus fa-4x"></i>\n            </div>\n         </div>\n      </div>\n      `}renderPageImages(){$$(this.ids.dataview)?.find({}).forEach((t=>{const e=document.querySelector(`#${this.pageTemplateId(t.pageNumber)}`);this.showPage(t.pageNumber,e)}))}async showPage(t,e){if(!this._pdfDoc)return;t=parseInt(t);const i=await this._pdfDoc.getPage(t),s=i.getViewport({scale:1}).width,n=e.width/s,a=i.getViewport({scale:n});return e.height=a.height,i.render({canvasContext:e.getContext("2d"),viewport:a}).promise}clearDataview(){const t=$$(this.ids.dataview),e=$$(this.ids.fullImageCarousel);t?.clearAll(),e&&this.AB.Webix.ui([{view:"label",align:"center",height:e.height,label:this.label("No image")}],e)}displaySmall(){this._isDisplayBig=!1,$$(this.ids.dataview)?.render(),this.renderPageImages()}displayBig(){this._isDisplayBig=!0,$$(this.ids.dataview)?.render(),this.renderPageImages()}get pageItemWidth(){return this._isDisplayBig?250:150}select(t){const e=$$(this.ids.dataview);let i=e.getSelectedId(!0);i.push(t),i=i.filter((t=>t)),i.length?e.select(i):e.unselectAll()}unselect(t){const e=$$(this.ids.dataview);let i=e.getSelectedId(!0);i=i.filter((e=>e&&e!=t)),i.length?e.select(i):e.unselectAll()}selectAll(){$$(this.ids.dataview)?.selectAll()}unselectAll(){$$(this.ids.dataview)?.unselectAll()}fullImageTemplateId(t){return`${this.pageTemplateId(t)}_full_size`}fullImageTemplate(t){return`<canvas width="${$$(this.ids.fullImageCarousel).config.width-20}" id="${this.fullImageTemplateId(t.pageNumber)}"></canvas>`}refreshFullImage(){const t=this.ids,e=$$(t.fullImageCarousel).getActiveIndex()+1,i=document.querySelector(`#${this.fullImageTemplateId(e)}`);this.showPage(e,i);const s=$$(t.dataview).getSelectedId(!0).filter((t=>t==e)).length>0;$$(t.fullImageSelectToggle).setValue(s),$$(t.fullImageLabel).setValue(`${this.label("Page Number")}: ${e}`)}get object(){return this.view.datacollection?.datasource}get field(){return this.object?.fields?.((t=>t.id==this.view.settings.fieldID))[0]}busy(){const t=this.ids,e=$$(t.fileUploader),i=$$(t.uploadList),s=$$(t.dataview),n=$$(t.submit),a=$$(t.selectAll),r=$$(t.unselectAll),o=$$(t.fullImageSelectToggle);e?.disable(),i?.disable(),n?.disable(),a?.disable(),r?.disable(),o?.disable(),s?.showProgress?.({type:"bottom",position:.001})}ready(){const t=this.ids,e=$$(t.fileUploader),i=$$(t.uploadList),s=$$(t.dataview),n=$$(t.submit),a=$$(t.selectAll),r=$$(t.unselectAll),o=$$(t.fullImageSelectToggle);e?.enable(),i?.enable(),n?.enable(),a?.enable(),r?.enable(),o?.enable(),s?.hideProgress?.(),delete this._progressSteps}async submit(){const t=this.field;if(!this._pdfDoc||!t)return;this.busy();const e=this.ids,i=$$(e.dataview).getSelectedId(!0)??[],s=t.object.model(),n=this.datacollection.datacollectionLink,a=[];for(let e=0;e<i.length;e++){const r=i[e];if(null==r||""==r)return;const o=await this._uploadImage(r);this._increaseProgressValue();const l=t.object.defaultValues();l[t.columnName]=o;const h=n?.getCursor();if(h){const e=n?.datasource;t.object.connectFields().forEach((t=>{if(e.id==t.settings.linkObject&&void 0===l[t.columnName]){const i=t.indexField?t.indexField.columnName:e.PK();l[t.columnName]={},l[t.columnName][i]=h[i]??h.id}}))}a.push(await s.create(l)),this._increaseProgressValue()}this.view.doSubmitRules(a),a&&this.view.emit("saved",a),this.ready()}}},5292:(t,e,i)=>{const s=i(26086).Z,n=i(43088),a=i(58439),r=i(41812);t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewPivot_${t.id}`,Object.assign({pivot:""},i))}ui(){const t=this,e=this.settings,i=super.ui([{id:this.ids.pivot,view:"pivot",readonly:!0,removeMissed:e.removeMissed,totalColumn:e.totalColumn,separateLabel:e.separateLabel,min:e.min,max:e.max,height:e.height,fields:this._getFields(),structure:e.structure??void 0,format:t=>{const i=e.decimalPlaces??2;return t&&"0"!=t?parseFloat(t).toFixed(i||0):t},override:new Map([[pivot.services.Backend,class extends pivot.services.Backend{async data(){const e=t.datacollection;if(!e)return webix.promise.resolve([]);const i=e.datasource;if(!i)return webix.promise.resolve([]);e.dataStatus===e.dataStatusFlag.notInitial&&await e.loadData();const s=e.getData().map((t=>{const e={};return i.fields().forEach((i=>{e[i.columnName]=i instanceof n||i instanceof a||i instanceof r?t[i.columnName]:i.format(t)})),e}));return webix.promise.resolve(s)}}]])}]);return delete i.type,i}_getFields(){const t=this.datacollection;if(!t)return[];const e=t.datasource;return e?e.fields().map((t=>{let e="text";switch(t.key){case"calculate":case"formula":case"number":e="number";break;case"date":case"datetime":e="date"}return{id:t.columnName,value:t.label,type:e}})):[]}}},28931:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewReportManager_${t.id}`,Object.assign({reportManager:""},i)),this.readonly=!1}ui(){const t=this,e=this.settings,i=this.AB,s=i.Webix,n=this.datacollection,a=n?.datasource.fieldByID(e.dataviewFields.name)?.columnName,r=n?.datasource.fieldByID(e.dataviewFields.text)?.columnName,o=n?.datasource.fieldByID(e.dataviewFields.queries)?.columnName,l=this.ids;class h extends reports.services.Backend{async getModules(){return null==n?[]:(await t.waitInitializingDCEvery(1e3,n),n.getData().map((t=>({id:t.id,name:t[a],text:JSON.stringify(t[r]),updated:t.updated_at}))))}async addModule(t){const e={};return e[a]=t.name,e[r]=t.text,{id:(await n.model.create(e)).id}}async updateModule(t,e){const i={};i[a]=e.name,i[r]=e.text;let s={};return s=await n.model.update(t,i),{id:s.id}}async deleteModule(t){return await n.model.delete(t),{id:t}}async getModels(){const s={};return(e.datacollectionIDs.length>0?e.datacollectionIDs:t.view.application.datacollectionIDs).forEach((e=>{const n=i.datacollectionByID(e);if(!n)return;if(!n.datasource)return;const a=t.getReportFields(n);s[n.id]={id:n.id,name:n.label,data:a,refs:[]}})),s}async getQueries(){const t=$$(l.reportManager).getState().moduleId||"";return""===t?[]:(await n.model.findAll({where:{uuid:t}})).data[0][o]||[]}async addQuery(t){const e=$$(l.reportManager).getState().moduleId||"";if(""===e)return{};const i=(await n.model.findAll({where:{uuid:e}})).data[0];if(null==i)return{};const a=[...i[o]||[]],r=s.uid();a.push(Object.assign({id:r},t));const h={};return h[o]=a.sort(((t,e)=>t.name<e.name?-1:t.name>e.name?1:0)),await n.model.update(e,h),{id:r}}async updateQuery(t,e){const i=$$(l.reportManager).getState().moduleId||"";if(""===i)return{};const s=(await n.model.findAll({where:{uuid:i}})).data[0];if(null==s)return{};const a=[...s[o]||[]],r=a.findIndex((e=>e.id===t));a[r]=Object.assign({id:t},e);const h={};return h[o]=a.sort(((t,e)=>t.name<e.name?-1:t.name>e.name?1:0)),await n.model.update(i,h),{id:t}}async deleteQuery(t){const e=$$(l.reportManager).getState().moduleId||"";if(""===e)return{};const i=(await n.model.findAll({where:{uuid:e}})).data[0];if(null==i)return{};const s=i[o]||[],a=s.findIndex((e=>e.id===t));if(a>=0){const t={};t[o]=s.filter(((t,e)=>e!==a)).sort(((t,e)=>t.name<e.name?-1:t.name>e.name?1:0)),await n.model.update(e,t)}return{id:t}}async getData(e){let n=[],a=[],r=[],o={},l=[];r.push(e.data),(e.joins||[]).forEach((t=>{r.push(t.sid),r.push(t.tid)})),r=i.uniq(r),r.forEach((e=>{a.push(new Promise(((i,s)=>{(async()=>{try{o[e]=await t.getData(e)||[],i()}catch(t){s(t)}})()})))})),r.forEach((e=>{const s=i.datacollectionByID(e);s&&(l=l.concat(t.getReportFields(s).map((t=>(t.id=`${e}.${t.id}`,t)))))})),await Promise.all(a),n=o[e.data]||[],e.joins?.length&&(e.joins||[]).forEach((t=>{const e=i.datacollectionByID(t.sid);if(!e)return;const s=e.datasource;if(!s)return;const a=i.datacollectionByID(t.tid);if(!a)return;const r=a.datasource;if(!r)return;const l=s.fieldByID(t.sf),h=r.fieldByID(t.tf);if(!l&&!h)return;const c=o[t.sid]||[],d=o[t.tid]||[];c.forEach((e=>{d.forEach((s=>{let a=e[l?`${t.sid}.${l.columnName}.id`:`${t.sid}.id`]||[],r=s[h?`${t.tid}.${h.columnName}.id`:`${t.tid}.id`]||[];if(Array.isArray(a)||(a=[a]),Array.isArray(r)||(r=[r]),a.filter((t=>r.indexOf(t)>-1))?.length){const a=n.filter((i=>i[`${t.sid}.id`]===e[`${t.sid}.id`]&&!i[`${t.tid}.id`]))||[];a?.length?(a||[]).forEach((t=>{for(const e in s)"id"!==e&&(t[e]=s[e])})):n.push(Object.assign(i.cloneDeep(e),i.cloneDeep(s)))}}))}))}));const h=JSON.parse(e.query||"{}");h?.rules?.length&&h.rules.forEach((t=>{t&&t.type&&t.condition&&"date"===t.type&&t.condition.filter&&("string"==typeof t.condition.filter&&(t.condition.filter=i.rules.toDate(t.condition.filter)),t.condition.filter.start&&"string"==typeof t.condition.filter.start&&(t.condition.filter.start=i.rules.toDate(t.condition.filter.start)),t.condition.filter.end&&"string"==typeof t.condition.filter.end&&(t.condition.filter.end=i.rules.toDate(t.condition.filter.end)))}));const c=s.ui({view:"query",fields:l,value:h}),d=new s.DataCollection;let u;d.parse(n);try{u=c.getFilterFunction()}catch(t){}return u&&d.filter(u),(e.sort||[]).forEach((t=>{t.id&&d.sort({as:"string",dir:t.mod||"asc",by:`#${t.id}#`})})),n=d.serialize(),c.destructor(),d.destructor(),e?.group?.length&&(n=_.groupBy(n,(t=>e.group.map((e=>{const i=e.split("."),n=i.length>2?`${i[1]}.${i[2]}`:e;if("date"===l.find((t=>t.id===n)).type){const a=s.i18n.dateFormatStr(t[n]),r=a.split("/");switch(i[0]){case"day":return t[e]=r[1],r[1];case"month":return t[e]=r[0],r[0];case"year":return t[e]=r[2],r[2];case"yearmonth":return t[e]=`${r[0]}/${r[2]}`,t[e];default:return t[e]=a,a}}return t[n]?.toString?.()})).join(""))),n=Object.values(n).map((t=>{const s={};return(e.columns||[]).forEach((e=>{const n=e.split(".")[0],a=e.replace(/sum.|avg.|count.|max.|min./g,"");switch(n){case"sum":s[e]=i.sumBy(t,a);break;case"avg":s[e]=i.meanBy(t,a);break;case"count":s[e]=(t||[]).length;break;case"max":s[e]=(i.maxBy(t,a)||{})[a]||"";break;case"min":s[e]=(i.minBy(t,a)||{})[a]||"";break;default:s[e]=t[0][e]}})),s}))),n}async getOptions(t){return[]}async getFieldData(t){return[]}}class c extends reports.services.Local{constructor(t){super(t),this._currentModuleID=""}getQueries(){const t=$$(l.reportManager).getState().moduleId;return this._currentModuleID!==t&&(this._currentModuleID=t,this._queries=null),super.getQueries()}}class d extends reports.views.editor{init(){if(super.init(),!t.readonly||1===e.editMode)return;const i=this.$$("tabbar");if(1===e.hideCommonTab){const e=()=>{i.callEvent("onChange",["data"]),i.disableOption("common"),t.removeListener("editMode.tabbar.query",e)};t.on("editMode.tabbar.query",e)}1===e.hideDataTab&&i.disableOption("other"),1===e.hideViewTab&&i.disableOption("structure"),this.on(this.app,"editMode.button.back",(()=>{this.Reset(!0)}))}Reset(i=!1){const s=this.AppState.moduleId;t.readonly&&!(1===e.editMode)&&null!=s&&!i||super.Reset(),this.Local.getModule(s)}TrackChanges(){super.TrackChanges(),e.hideCommonTab&&t.emit("editMode.tabbar.query")}}class u extends reports.views.toolbar{config(){const i=super.config();return t.readonly&&1!==e.editMode&&(i.elements[5].cols=i.elements[5].cols.map((i=>Object.assign(i,{hidden:t.readonly&&!(1===e.editMode)}))),i.elements[5].cols.push({},{view:"button",type:"icon",icon:"wxi-angle-double-left",label:t.label("Back"),localId:"forceReset",click:()=>this.app.callEvent("editMode.button.back",[])})),i}}class p extends reports.views["editor/common"]{config(){const e=super.config();return t.readonly?Object.assign({},e,{elements:e.elements.map(((t,e)=>Object.assign({hidden:!(e>=2&&e<5)},t)))}):e}ShowDeleteButton(){super.ShowDeleteButton(),t.readonly&&this.$$("delete").hide()}}class f extends reports.views["editor/data"]{config(){const e=super.config();return t.readonly&&(e.rows[0].rows[0].hidden=!0,e.rows[0].rows.unshift({label:"Filtering query",view:"label",width:120})),e}}class g extends reports.views.table{GetColumnConfig(e){let i={id:e.id,header:e.meta.header&&"none"!==e.meta.header?[e.meta.name||e.name,{content:"text"===e.header?"textFilter":"richSelectFilter"}]:e.meta.name||e.name,type:e.type,sort:"date",width:e.width||200};const n=t.AB.datacollectionByID(e.mid)?.datasource.fields((t=>t.columnName===e.name))[0];return"date"===e.type?i.format=t=>t?.getTime&&!isNaN(t.getTime())?"datetime"===n?.key?s.i18n.fullDateFormatStr(t):s.i18n.dateFormatStr(t):"":i=super.GetColumnConfig(e),i}async GetTableData(t){const e=await super.GetTableData(t),i=t.buckets;if(!i)return e;if(0===i.length)return e;const s=t.columns.map((t=>t.id)),n=t.buckets.filter((t=>s.includes(t.column)));return 0===n.length?e:[e[0].map((t=>{const e={};return n.forEach((i=>{const s=i.options;for(let n=0;n<s.length;n++)if(s[n].values?.includes(t[i.column])||n===s.length-1){e[i.column]=s[n].id;break}})),Object.assign({},t,e)})),e[1]]}}const m=super.ui([{id:l.reportManager,view:"reports",toolbar:!0,override:new Map([[reports.services.Backend,h],[reports.services.Local,c],[reports.views.editor,d],[reports.views.toolbar,u],[reports.views["editor/common"],p],[reports.views["editor/data"],f],[reports.views.table,g]])}]);return delete m.type,delete m.height,m}async init(t,e){this.AB=t,this.readonly=e<2;const i=$$(this.ids.reportManager).getState();i.readonly=this.readonly,i.mode=this.readonly&&1===this.settings.editMode?"edit":"list"}getReportFields(t){if(!t)return[];const e=t.datasource;if(!e)return[];const i=[];return e.fields().forEach((t=>{const e=t.columnHeader();if(t.isConnection){if(t.isSource()){const e=this.view.application.datacollectionsIncluded((e=>this.settings.datacollectionIDs.includes(e.id)&&e.settings.datasourceID===t.settings.linkObject));(e||[]).forEach((e=>{i.push({id:t.id,name:t.label,filter:!1,edit:!1,type:"reference",ref:e.id,key:!1,show:!1})}))}}else{let s="text";switch(t.key){case"boolean":case"number":case"date":s=t.key;break;case"datetime":s="date"}i.push({id:t.columnName,name:t.label,filter:t.fieldIsFilterable(),edit:!1,type:s,format:e.format,options:e.options,ref:"",key:!1,show:!0,abField:t})}})),i}async getData(t){const e=this.AB.datacollectionByID(t);if(!e)return[];const i=e.datasource;if(!i)return[];await this.waitInitializingDCEvery(1e3,e);const s=this.getReportFields(e),n=[];return(e.getData()||[]).forEach((t=>{const a={id:t.id};a[`${e.id}.id`]=t.id,i.fields().forEach((i=>{const n=i.columnName,r=`${e.id}.${n}`;if(i)if(i.isConnection){let e=i.datasourceLink.PK();Array.isArray(t[n])?a[`${r}.id`]=t[n].map((t=>t[e]||t.id||t)):t[n]&&(a[`${r}.id`]=t[n][e]||t[n].id||t[n])}else a[r]=i.format(t);else a[r]=t[n];const o=s.find((t=>t.id===n||t.id===i.id));if(o)switch(o.type){case"text":case"reference":a[r]=(a[r]||"").toString();break;case"number":a[r]=parseFloat((a[r]||0).toString().replace(/[^\d.-]/g,""));break;case"date":a[r]=t[n],a[r]?a[r]instanceof Date||(a[r]=this.AB.rules.toDate(t[n])):a[r]=""}})),n.push(a)})),n}async waitInitializingDCEvery(t,e){if(this.__isShowing&&null!=e)return e.dataStatus===e.dataStatusFlag.notInitial&&await e.loadData(),await new Promise((i=>{if(e.dataStatus===e.dataStatusFlag.initialized)return void i();const s=setInterval((()=>{e.dataStatus===e.dataStatusFlag.initialized&&(clearInterval(s),i())}),t)}))}async onShow(){super.onShow(),this.__isShowing=!0}}},93865:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewScheduler_${t.id}`,Object.assign({scheduler:""},i))}ui(){const t=this.ids,e=this.AB,i=this,s=this.AB.Webix,n=this.settings,a=this.datacollection,r=a?.datasource.fieldByID(n.dataviewFields.name)?.columnName,o=a?.datasource.fieldByID(n.dataviewFields.start)?.columnName,l=a?.datasource.fieldByID(n.dataviewFields.end)?.columnName,h=a?.datasource.fieldByID(n.dataviewFields.allDay)?.columnName,c=a?.datasource.fieldByID(n.dataviewFields.repeat)?.columnName,d=a?.datasource.fieldByID(n.dataviewFields.calendar)?.columnName,u=a?.datasource.fieldByID(n.dataviewFields.color)?.columnName,_=a?.datasource.fieldByID(n.dataviewFields.notes)?.columnName,p=a?.datasource.fieldByID(n.dataviewFields.originID)?.columnName,f=a?.datasource.fieldByID(n.dataviewFields.sectionID)?.columnName,g=a?.datasource.fieldByID(n.dataviewFields.unitID)?.columnName,m=e.datacollectionByID(this.settings.calendarDataviewID),v=m?.datasource.fieldByID(n.calendarDataviewFields.title)?.columnName,b=m?.datasource.fieldByID(n.calendarDataviewFields.color)?.columnName,w=m?.datasource.fieldByID(n.calendarDataviewFields.active)?.columnName,y=[];Object.keys(n.timeline).forEach((t=>{0!==n.timeline[t]&&y.push({id:`${t}`,value:`${t.charAt(0).toUpperCase()}${t.slice(1)}`})}));const x=super.ui([{padding:6,cols:[{view:"label",width:150,label:"Export events data to: "},{view:"button",width:100,value:this.label("Excel"),hidden:0===n.export.excel,click:()=>{s.toExcel(t.scheduler)}},{view:"button",width:100,value:this.label("CSV"),hidden:0===n.export.csv,click:()=>{s.toCSV(t.scheduler)}},{view:"button",width:100,value:this.label("PDF"),hidden:0===n.export.pdf,click:()=>{s.toPDF(t.scheduler,{autowidth:!0})}},{}]},{id:t.scheduler,view:"scheduler",date:new Date,readonly:1===n.readonly,timeline:1===n.timeline.timeline,override:new Map([[scheduler.services.Backend,class extends reports.services.Backend{async addCalendar(t){if(null==m)return{};const e={};return e[v]=t.text,e[b]=t.color,e[w]=t.active,{id:(await m.model.create(e)).id}}async addEvent(t){if(null==a)return{};const e={};return e[r]=t.text,e[o]=new Date(t.start_date),e[l]=new Date(t.end_date),e[h]=t.all_day,e[c]=t.recurring,e[d]=t.calendar,e[u]=t.color,e[f]=t.section||"No Section",e[g]=t.units||"No Unit",e[_]=t.details,e[p]=t.origin_id,{id:(await a.model.create(e)).id}}async calendars(){return null==m?[]:(i.__isShowing&&m.dataStatus===m.dataStatusFlag.notInitial&&await m.loadData(),m.getData().map((t=>({id:t.id,text:t[v],color:t[b],active:t[w]}))))}async events(t){if(null==a)return[];i.__isShowing&&a.dataStatus===a.dataStatusFlag.notInitial&&await a.loadData();const e=await this.units(),n=await this.sections();return a.getData().map((t=>{let i=e.find((e=>e.id===t[g]))?.id,a=n.find((e=>e.id===t[f]))?.id;return null!=a&&null!=i||(a=a||"No Section",i=i||"No Unit"),{id:t.id,text:t[r],start_date:s.Date.dateToStr("%Y-%m-%d %H:%i:%s")(t[o]),end_date:s.Date.dateToStr("%Y-%m-%d %H:%i:%s")(t[l]),all_day:t[h],recurring:t[c],calendar:t[d],color:t[u],section:a,units:i,details:t[_],origin_id:t[p]}}))}async removeCalendar(t){await m.model.delete(t)}async removeEvent(t){await a.model.delete(t)}async sections(){return[{text:"No Section",id:"No Section"}].concat(n.timelineSectionList.split(", ").map((t=>({id:t,text:t}))))}async units(){return[{id:"No Unit",value:"No Unit"}].concat(n.unitList.split(", ").map((t=>({id:t,value:t}))))}async updateCalendar(t,e){if(null==m)return{};const i={};i[v]=e.text,i[b]=e.color,i[w]=e.active,await m.model.update(t,i)}async updateEvent(t,e,i,s){if(null==a)return{};const n={};n[r]=e.text,n[o]=new Date(e.start_date),n[l]=new Date(e.end_date),n[h]=e.all_day,n[c]=e.recurring,n[d]=e.calendar,n[u]=e.color,n[f]=e.section||"No Section",n[g]=e.units||"No Unit",n[_]=e.details,n[p]=e.origin_id,await a.model.update(t,n)}}],[scheduler.views["bars/nav"],class extends scheduler.views["bars/nav"]{config(){const t=super.config();return t.width=160,t.options=y,t}}],[scheduler.views["bars/navpopup"],class extends scheduler.views["bars/navpopup"]{config(){const t=super.config(),e=y.map((t=>Object.assign({icon:`shi-${t.id}`},t)));return this.app.config.calendars?t.body.body.rows[0].data=e:t.body.data=e,t}}],[scheduler.views["modes/day/multiday"],class extends scheduler.views["modes/day/multiday"]{LimitData(t){super.LimitData(t||[])}}]])}]);return delete x.type,x}async onShow(){super.onShow(),this.__isShowing=!0}}},59252:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewTab_${t.id}`,Object.assign({tab:"",sidebar:"",expandMenu:"",collapseMenu:"",popupTabManager:"",popupTabManagerForm:"",popupTabManagerSaveButton:""},i)),this.viewComponents=this.viewComponents||t.views((t=>t.getUserAccess())).map((t=>({view:t})))}ui(){const t=this.ids,e=this.view,i=this.AB,s=i.Webix;let n=null;s.type(s.ui.tree,{baseType:"sideBar",name:"customIcons",icon:(t,e)=>t.icon.length?["<span class='webix_icon webix_sidebar_icon fa fa-fw fa-",t.icon,"'></span>"].join(""):["<span class='webix_icon webix_sidebar_icon sidebarCustomIcon'>",t.value.charAt(0).toUpperCase(),"</span>"].join("")});const a=this.viewComponents,r=this.settings;if(a.length>0)if(r.stackTabs){const s=a.map((t=>{const e=t.view;return{id:`${e.id}_menu`,value:e.label,icon:e.tabicon?e.tabicon:""}}));if(s.length){const o={id:t.collapseMenu,value:this.label("Collapse Menu"),icon:"chevron-circle-left"},l={id:t.expandMenu,value:this.label("Expand Menu"),icon:"chevron-circle-right",hidden:!0};let h=`${a[0].view.id}_menu`;const c=i.Storage,d={view:"sidebar",type:"customIcons",id:t.sidebar,height:r.height,width:r.sidebarWidth?r.sidebarWidth:0,scroll:!0,position:r.sidebarPos?r.sidebarPos:"left",css:r.darkTheme?"webix_dark":"",data:s.concat(o),on:{onItemClick:e=>{if(e===t.collapseMenu)setTimeout((()=>{const e=$$(t.sidebar);e.remove(t.collapseMenu),e.add(l),e.toggle(),e.select(h),c.set(`${t.tab}-state`,e.getState())}),0);else if(e===t.expandMenu)setTimeout((()=>{const e=$$(t.sidebar);e.remove(t.expandMenu),e.add(o),e.toggle(),e.select(h),c.set(`${t.tab}-state`,e.getState())}),0);else{h=e,e=e.replace("_menu","");let t=$$(e);if(t)t.show(!1,!1);else{let t=`ABViewTabComponent[${this.name}][${this.id}] could not resolve UI panel for provided menu [${h}].`;this.AB.notify("developer",t,{})}}},onSelectChange:()=>{_()},onAfterRender:()=>{_()}}},u={view:"multiview",id:t.tab,keepViews:!0,minWidth:r.minWidth,cells:a.map((t=>({id:t.view.id,view:"layout",rows:[]}))),on:{onViewChange:(t,e)=>{this.onShow(e)}}},_=function(){const i=$$(t.sidebar),s=i?.$view.querySelector(`[webix_tm_id="${t.collapseMenu}"]`);s&&s.setAttribute("data-cy",`tab-collapseMenu-${t.collapseMenu}`);const n=i?.$view.querySelector(`[webix_tm_id="${t.expandMenu}"]`);n&&n.setAttribute("data-cy",`tab-expandMenu-${t.expandMenu}`),e.views((t=>{const s=i.$view.querySelector(`[webix_tm_id="${t.id}_menu"]`);s&&s.setAttribute("data-cy",`tab-${t.name.replace(" ","")}-${t.id}-${e.id}`)}))};let p=[d,u];"right"===r.sidebarPos&&(p=[u,d]),n={cols:p}}else n={view:"spacer"}}else{const i=e.views((t=>{if(t.getUserAccess()>0)return t})).map((t=>{const e={id:t.id,view:"layout",rows:[]};let i="";return i=t.tabicon?r.iconOnTop?["<div class='ab-tabIconContainer'><span class='fa fa-lg fa-fw fa-",t.tabicon,"'></span><br/>",t.label,"</div>"].join(""):["<span class='fa fa-lg fa-fw fa-",t.tabicon,"'></span> ",t.label].join(""):t.label,{header:i,body:e}}));n=i.length?{rows:[{view:"tabview",id:t.tab,minWidth:r.minWidth,height:r.height,tabbar:{height:60,type:"bottom",css:r.darkTheme?"webix_dark":"",on:{onAfterRender:()=>{e.views((i=>{const s=$$(t.tab).$view.querySelector(`[button_id="${i.id}"]`);s&&s.setAttribute("data-cy",`tab ${i.name} ${i.id} ${e.id}`)}))}}},multiview:{on:{onViewChange:(t,e)=>{this.onShow(e)}}},cells:i}]}:{view:"spacer"}}else n={view:"spacer"};return n=super.ui([n]),delete n.type,n}async init(t){await super.init(t);const e=this.ids,i=$$(e.tab),s=this.AB,n=s.Webix;i&&n.extend(i,n.ProgressBar);const a=this.view;this.viewComponents.forEach((t=>{this.eventAdd({emitter:t.view,eventName:"changePage",listener:(...t)=>this.changePage(...t)})})),this.eventAdd({emitter:a,eventName:"changeTab",listener:(...t)=>this.changeTab(...t)});const r=$$(e.sidebar);if(!r)return;const o=await s.Storage.get(`${e.tab}-state`);if(!o)return;const l={id:e.collapseMenu,value:this.label("Collapse Menu"),icon:"chevron-circle-left"},h={id:e.expandMenu,value:this.label("Expand Menu"),icon:"chevron-circle-right",hidden:!0};r.setState(o);const c=r.getItem(e.collapseMenu)??null,d=r.getItem(e.expandMenu)??null;o.collapsed?c&&d&&r.add(h):c&&d&&r.add(l)}changePage(t){const e=$$(this.ids.tab);e?.blockEvent(),this.view.changePage(t),e?.unblockEvent()}changeTab(t){const e=this.view,i=$$(t);if(this.toggleParent(e.parent),this.settings.stackTabs)if(i.isVisible())$$(this.ids.tab).setValue(t);else{const t=setInterval((()=>{i.isVisible()&&clearInterval(t),i.show(!1,!1)}),200)}}toggleParent(t){const e=$$(t.id);"tab"!==t.key&&"viewcontainer"!==t.key||e?.show(!1,!1),t.parent&&this.toggleParent(t.parent)}onShow(t){const e=this.ids;let i=!1;const s=$$(e.sidebar);!t&&s&&(t=s.getSelectedId().replace("_menu",""));const n=this.view;this.viewComponents.forEach((a=>{const r=n.views((t=>t.id===a.view.id));let o=0;r.length&&(o=r[0].getUserAccess()),!t&&!i&&o>0&&(t=a.view.id,i=!0);const l=$$(e.tab),h=this.settings;if(!a?.component&&a?.view?.id===t){l?.showProgress&&l.showProgress({type:"icon"}),a.component=a.view.component();const t=$$(a.view.id),e=this.AB,i=e.Webix;h.stackTabs?i.ui({id:a.view.id,view:"scrollview",css:"ab-multiview-scrollview",body:a.component.ui()},t):i.ui({id:a.view.id,view:"scrollview",css:"ab-tabview-scrollview",body:a.component.ui()},t),o=a.view.getUserAccess(),a.component.init(e,o),setTimeout((()=>{l?.hideProgress?.()}),10)}a?.view?.id===t&&a?.component?.onShow&&a.component.onShow(),h.stackTabs&&a?.view?.id===t&&($$(t).show(!1,!1),s.select(`${t}_menu`))}))}}},47637:(t,e,i)=>{const s=i(26086).Z;t.exports=class extends s{constructor(t,e,i){super(t,e||`ABViewText_${t.id}`,Object.assign({text:""},i))}ui(){const t=this.ids,e=this.settings,i={id:t.text,view:"template",minHeight:10,css:"ab-custom-template",borderless:!0};e.height?i.height=e.height:i.autoheight=!0;const s=super.ui([i]);return delete s.type,s}displayText(t){const e=this.ids,i=this.view.displayText(t,e.text),s=$$(e.text);s&&(s.define("template",i),s.refresh())}onShow(){super.onShow();const t=this.datacollection,e=this.view;t&&"dataview"!==e.parent.key&&e.eventAdd({emitter:t,eventName:"changeCursor",listener:(...t)=>this.displayText(...t)}),this.displayText()}}},70557:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var s=i(32735);class n extends s.Z{static get default(){return{}}static propertyComponent(){let t={callbacks:{}};return{ui:{view:"template",template:"No UI"},init:e=>{for(var i in t.callbacks)t.callbacks[i]=e[i]||t.callbacks[i]},logic:t}}fromSettings(t){this.settings=t}toSettings(){return this.settings||{}}component(t,e){this.App=t,this.idBase=e;let i={callbacks:{}};return{ui:{view:"template",template:"No UI"},init:t=>{for(var e in i.callbacks)i.callbacks[e]=t[e]||i.callbacks[e]},logic:i}}}},95751:(t,e,i)=>{"use strict";i.d(e,{Z:()=>h});var s=i(70557),n=i(15651),a=i.n(n),r=i(20697),o=i.n(r);let l=(...t)=>AB.Multilingual.label(...t);class h extends s.Z{static get default(){return{formView:"none"}}static propertyComponent(t,e){let i={formView:`${e}_formView`},s={id:i.formView,name:"formView",view:"richselect",label:l("Add New Form"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,on:{onChange:(t,e)=>{t==l("No add new option")&&$$(i.formView).setValue(""),n.callbacks.onSave()}}},n={callbacks:{onSave:function(){console.warn("NO onSave()!")}},setSettings:(t,e={})=>{if(null==t)return;let s=[{id:"none",value:l("No add new option")}],n=t.pageRoot().pages((e=>e.views((e=>e&&"form"==e.key&&e.datacollection&&e.datacollection.datasource&&e.datacollection.datasource.id==t.field().settings.linkObject),!0).length),!0).map((t=>({id:t.id,value:t.label})));s=s.concat(n);let a=$$(i.formView);a&&(a.define("options",s),a.define("value",e.formView||this.default.formView),a.refresh())},getSettings:t=>{let e=t.settings||{};return e.formView=$$(i.formView).getValue(),e}};return{ui:s,init:t=>{for(let e in n.callbacks)n.callbacks[e]=t[e]||n.callbacks[e]},setSettings:n.setSettings,getSettings:n.getSettings}}fromSettings(t={}){this.settings=this.settings||{},this.settings.formView=t.formView||this.constructor.default.formView}getIds(t,e){return{popup:e._App.unique(`${t}_popup_add_new`),field:t.split("_")[1],button:e._App.unique(`${t}_popup_add_new_button`)}}component(t,e){let i=this.getIds(e,t),s="";if(this.settings.formView&&this.settings.formView!=this.constructor.default.formView){const t=`add new CR button ${this.settings.formView} ${i.field}`;s={id:i.button,view:"button",type:"icon",icon:"fa fa-plus",width:32,height:32,css:"webix_primary ab-connect-add-new-link",on:{onAfterRender:()=>{$$(i.button)?.$view.querySelector("button").setAttribute("data-cy",t)}}}}let n={callbacks:{onSaveData:t=>{$$(i.popup)&&$$(i.popup).close()},onCancel:()=>($$(i.popup)&&$$(i.popup).close(),!1),onClearOnLoad:()=>!0,clearOnLoad:()=>!0},applicationLoad:t=>{this._application=t},onClick:t=>{let e=this.settings.formView,i=this._application.pages((t=>t.id==e),!0)[0];return n.openFormPopup(i,t)},openFormPopup:(t,e)=>new Promise(((s,r)=>{if(null==this._application)return s();if($$(i.popup))return $$(i.popup).show(),s();let h=t.clone(null,null,{ignoreSubPages:!0});h.id=this._application.AB.uuid();let c=h.component(),d=c.ui();(h.views((t=>t instanceof a()||t instanceof o()),!0)??[]).forEach((t=>{(t instanceof a()?t.parent:t).on("saved",(t=>{n?.callbacks?.onSaveData(t),$$(i.popup)?$$(i.popup).close():this.getTopParentView().close()}))}));let u={view:"window",id:i.popup,modal:!0,position:"center",resize:!0,width:parseInt(this.settings.popupWidth)||700,height:parseInt(this.settings.popupHeight)+44||450,css:"ab-main-container",head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:t.label,css:"modal_title",align:"center"},{view:"button",label:l("Close"),autowidth:!0,align:"center",click:function(){this.getTopParentView().close()}}]},body:{view:"scrollview",scroll:!0,body:d}};webix.ui(u).show(),c.init(this._application.AB,3,{onSaveData:n.callbacks.onSaveData,onCancelClick:n.callbacks.onCancel,clearOnLoad:n.callbacks.clearOnLoad,onClearOnLoad:n.callbacks.onClearOnLoad}),c.onShow(),setTimeout((async()=>{n.setDefaultValue(e,h),s()}),100)})),setDefaultValue:(t,e)=>{if(!t)return;let i=t.datasource;if(!i)return;let s=t.getCursor();s&&e.views().forEach((t=>{t&&"form"==t.key&&t.views().forEach((e=>{if("connect"!=e.key||null==e.settings)return;let n=e.field();if(null==n)return;let a=n.datasourceLink;if(null==a||a.id!=i.id)return;let r={},o=n.relationName();if(r[o]={id:s.id},(i.indexes()||[]).forEach((t=>{(t.fields||[]).forEach((t=>{r[o][t.columnName]=s[t.columnName]}))})),s.text)r[o].text=s.text,r[o].value=r[o].text;else{let t={};t[o]=s,r[o].text=n.format(t),r[o].value=r[o].text}let l=t.viewComponents[e.id];if(!l)return;const h="function"==typeof l.ui?l.ui():l.ui,c=h?.inputId||h?.rows?.[0]?.inputId;c&&n.setValue($$(c),r)}))}))}};return{ui:s,init:t=>{for(let e in n.callbacks)n.callbacks[e]=t[e]||n.callbacks[e];if(s)for(let e in t)s.on[e]=t[e]},applicationLoad:n.applicationLoad,onClick:n.onClick,openFormPopup:n.openFormPopup}}}},77025:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var s=i(95751);let n=(...t)=>AB.Multilingual.label(...t);class a extends s.Z{static get default(){return{editForm:"none"}}static propertyComponent(t,e){let i={formEdit:`${e}_editForm`},s={id:i.formEdit,name:"editForm",view:"richselect",label:n("Edit Form"),labelWidth:this.AB.UISettings.config().labelWidthXLarge,on:{onChange:(t,e)=>{t==n("No add new option")&&$$(i.formEdit).setValue(""),a.callbacks.onSave()}}},a={callbacks:{onSave:function(){console.warn("NO onSave()!")},clearOnLoad:()=>!1},setSettings:(t,e={})=>{if(null==t)return;e.clearOnLoad=!1;let s=[{id:"none",value:n("No add new option")}];(t.pageRoot().pages((()=>!0),!0)||[]).forEach((e=>{e&&e.views((()=>!0),!0).forEach((i=>{i&&"form"==i.key&&i.datacollection&&i.datacollection.datasource&&i.datacollection.datasource.id==t.field().settings.linkObject&&s.push({id:i.urlPointer(),value:`${e.label} - ${i.label}`})}))}));let a=$$(i.formEdit);a&&(a.define("options",s),a.define("value",e.editForm||this.default.editForm),a.refresh())},getSettings:t=>{let e=t.settings||{},s=$$(i.formEdit),n=(s.getPopup().config.body.data||[]).filter((t=>t.id==s.getValue()))[0];return n&&(e.editForm=n.id),e}};return{ui:s,init:t=>{for(let e in a.callbacks)a.callbacks[e]=t[e]||a.callbacks[e]},setSettings:a.setSettings,getSettings:a.getSettings}}fromSettings(t={}){this.settings=this.settings||{},this.settings.editForm=t.editForm||this.constructor.default.editForm}component(t,e){this.getIds=function(t,e){return{popup:e._App.unique(`${t}_popup_edit_form`),field:t.split("_")[1]}};let i=super.component(t,e);return i.onClick=()=>{if(!this._application||!this.settings.editForm||this.settings.editForm==this.constructor.default.editForm)return Promise.resolve();let t=this._application.urlResolve(this.settings.editForm);if(!t)return Promise.resolve();let e=t.pageParent();return e?i.openFormPopup(e):Promise.resolve()},i}}},84204:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var s=i(70557);const n=i(97069);let a=(...t)=>AB.Multilingual.label(...t);class r extends n{constructor(){super(["label"],AB)}fromSettings(t){super.fromValues(t),this.filters=t.filters}toSettings(){let t=super.toObj();return t.filters=this.filters,t}}class o extends s.Z{constructor(t,e){super(e,{buttonAddfilter:"",filterPanel:"",globalFilterFormContainer:"",globalFilterForm:"",filterMenutoolbar:"",resetFilterButton:""}),this.AB=t,this.idBase=e,this.object=null,this.__externalSearchText=null,this.rowFilter=this.AB.filterComplexNew(`${this.ids.component}_filter`),this.rowFilterForm=this.AB.filterComplexNew(`${this.ids.component}_filter_form`),this._handler_rowFilterChanged=t=>{let e=t.rules||[];this.triggerCallback((t=>this.rowFilter.isValid(t)),e)},this._handler_rowFilterFormChanged=()=>{this.triggerCallback()},this.initialized=!1}static get default(){return{filterOption:1,userFilterPosition:"toolbar",isGlobalToolbar:1}}fromSettings(t){(t=t||{}).filterOption=void 0!==t.filterOption?t.filterOption:o.default.filterOption,t.isGlobalToolbar=void 0!==t.isGlobalToolbar?t.isGlobalToolbar:o.default.isGlobalToolbar,this.settings=t}objectLoad(t){this.object=t,this.rowFilter&&this.rowFilter.fieldsLoad(t.fields()),this.rowFilterForm&&this.rowFilterForm.fieldsLoad(t.fields())}viewLoad(t){this.view=t}ui(){var t=this,e=this.ids;return{id:e.filterPanel,type:"space",borderless:!0,padding:0,hidden:!0,rows:[{id:e.globalFilterFormContainer,hidden:!0,cols:[{id:e.globalFilterForm,view:"text",placeholder:a("Search or scan a barcode to see results"),on:{onTimedKeyPress:()=>{this.triggerCallback()}}},{view:"button",css:"webix_primary",width:28,type:"icon",icon:"fa fa-times",click:function(){var t=$$(e.globalFilterForm);t.setValue(""),t.focus(),t.callEvent("onTimedKeyPress")}}]},{id:e.buttonAddfilter,view:"button",css:"webix_primary",value:a("Add Filter"),click:()=>{this.rowFilterForm.popUp($$(e.buttonAddfilter).getNode(),{pos:"bottom"})}},{view:"toolbar",id:e.filterMenutoolbar,css:"ab-data-toolbar",hidden:!0,cols:[{view:"button",css:"webix_primary",id:e.resetFilterButton,label:a("Reset Filter"),icon:"fa fa-ban",type:"icon",autowidth:!0,click:function(){t.resetFilter()}}]}]}}async init(t){t&&(this.AB=t);var e=this.ids;switch(this.rowFilter.init(),this.rowFilter.removeListener("changed",this._handler_rowFilterChanged),this.rowFilter.on("changed",this._handler_rowFilterChanged),this.rowFilterForm.init(),this.rowFilterForm.removeListener("changed",this._handler_rowFilterFormChanged),this.rowFilterForm.on("changed",this._handler_rowFilterFormChanged),this.rowFilterForm.removeListener("save",this._handler_rowFilterFormChanged),this.rowFilterForm.on("save",this._handler_rowFilterFormChanged),$$(e.filterPanel)?.hide(),$$(e.buttonAddfilter)?.hide(),$$(e.filterMenutoolbar)?.hide(),$$(e.globalFilterFormContainer)?.hide(),this.settings.filterOption){case 0:break;case 1:switch(this.settings.userFilterPosition){case"form":$$(e.buttonAddfilter)?.show(),$$(e.filterPanel)?.show();break;case"toolbar":$$(e.filterPanel)?.hide()}break;case 2:$$(e.filterPanel)?.show();var i=$$(e.filterMenutoolbar);i&&(i.show(),this.settings?.queryRules&&(this.settings.queryRules||[]).forEach((t=>{let e=new r;e.fromSettings(t);var s={view:"button",css:"webix_primary",label:e.label,icon:"fa fa-filter",type:"icon",autowidth:!0,click:()=>{this.emit("filter.data",null,e.filters)}};i.addView(s)})));break;case 3:$$(e.globalFilterFormContainer)?.show(),$$(e.filterPanel)?.show()}}filterRules(){let t=null;switch(this.settings.userFilterPosition){case"form":t=this.rowFilterForm.getValue();break;case"toolbar":t=this.rowFilter.getValue()}return t}getFilter(){return null==this.__currentFilter&&(3==this.settings.filterOption&&"single"==this.settings.globalFilterPosition?this.__currentFilter=()=>!1:this.__currentFilter=()=>!0),this.__currentFilter}triggerCallback(){let t=this.searchText(this.__externalSearchText),e=this.filterRules(),i=0;e?.rules?.length?(i=e?.rules?.length,t&&(i++,e={glue:"and",rules:[e,t]})):e=t,this.emit("filter.data",null,e),0==i&&(i=!1);const s=$$(this.ids.buttonAddfilter);s&&(s.config.badge=i,s.refresh())}resetFilter(){this.triggerCallback((()=>!0),[])}externalSearchText(t=null){this.__externalSearchText=t,this.triggerCallback()}searchText(t){var e;if(!(e=t||($$(this.ids.globalFilterForm)?.getValue()??"").trim()))return null;let i=e.trim().toLowerCase().split(" ");var s=[],n=this.object?.fields()||[];return i.forEach((t=>{var e=[];n.forEach((i=>{if(i.fieldIsFilterable())switch(i.key){case"number":case"string":case"LongText":case"email":e.push({key:i.id,rule:"contains",value:t});break;case"list":i.options().forEach((s=>{s.text.indexOf(t)>-1&&e.push({key:i.id,rule:"equals",value:s.id})}))}})),e.length>0&&s.push({glue:"or",rules:e})})),s.length>0?{glue:"and",rules:s}:null}showPopup(t){this.rowFilter.popUp(t,null,{pos:"center"})}}},95782:(t,e,i)=>{"use strict";i.d(e,{Z:()=>r});var s=i(70557),n=i(26086);class a extends n.Z{constructor(t,e){super(e||"ABViewPropertyLinkPage_xxx",{}),this.linkPageHelper=t,this.AB=t.AB,this.view=null,this.datacollection=null}ui(){return{}}init(t){t.view&&(this.view=t.view),t.datacollection&&(this.datacollection=t.datacollection)}changePage(t,e){this.datacollection&&this.datacollection.setCursor(e),this.view&&this.view.changePage(t)}}class r extends s.Z{component(t=!1){let e=new a(this);if(t){var i=e;e={ui:i.ui(),init:(...t)=>i.init(...t),onShow:(...t)=>i.onShow?.(...t),changePage:(...t)=>i.changePage(...t)}}return e}}},60069:t=>{t.exports=class{constructor(t,e,i){this.defaultLabel=i||"default view",this.object=e,this.fromObj(t||{}),this.object.translate(this,this,["label"])}static type(){return"view"}fromObj(t){this.id=t.id||this.object.AB.uuid(),this.isDefaultView=JSON.parse(t.isDefaultView||!1),this.translations=t.translations||this.object.defaultTranslations(["label"],{label:this.defaultLabel})}toObj(){return this.object.unTranslate(this,this,["label"]),{id:this.id,translations:this.translations,isDefaultView:this.isDefaultView}}update(t){for(var e in t)this[e]=t[e]}}},23847:(t,e,i)=>{const s=i(67112),n=i(18318),a=i(23989);var r={};r[s.type()]=s,r[n.type()]=n,r[a.type()]=a;const o={currentViewID:void 0,list:[]};t.exports=class{constructor(t,e,i){this.object=e,this.AB=i,this.fromObj(t)}fromObj(t){if(t.objectWorkspaceViews=t.objectWorkspaceViews&&t.objectWorkspaceViews.list?t.objectWorkspaceViews:o,0===t.objectWorkspaceViews.list.filter((t=>t.isDefaultView)).length){void 0!==t.objectWorkspace&&(void 0===t.objectWorkspace.sortFields&&(t.objectWorkspace.sortFields=[]),void 0===t.objectWorkspace.filterConditions&&(t.objectWorkspace.filterConditions=[]),void 0===t.objectWorkspace.frozenColumnID&&(t.objectWorkspace.frozenColumnID=""),void 0===t.objectWorkspace.hiddenFields&&(t.objectWorkspace.hiddenFields=[]));var e=t.objectWorkspace||{sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[]};e.isDefaultView=!0;var i=new s(e,this.object);t.objectWorkspaceViews.list.unshift(i)}this.importViews(t.objectWorkspaceViews),this.currentViewID=t.objectWorkspaceViews.currentViewID,this.currentViewID||(this.currentViewID=this.list()[0].id)}toObj(){return{currentViewID:this.currentViewID,list:this.exportViews()}}list(t=(()=>!0)){return this._views.filter(t)}importViews(t){this._views=[],t.list.forEach((t=>{this.addView(t,!1)}))}exportViews(){var t=[];return this._views.forEach((e=>{t.push(e.toObj())})),t}setCurrentView(t){this.currentViewID=t}getCurrentView(){return this.list((t=>t.id==this.currentViewID))[0]}addView(t,e=!0){var i=new r[t.type](t,this.object);return this._views.push(i),e&&this.object.save(),i}removeView(t){var e=this._views.indexOf(t);this._views.splice(e,1),t.id===this.currentViewID&&(this.currentViewID=this._views[0].id),this.object.save()}updateView(t,e){var i;if(e.type===t.type)t.update(e),i=t;else{i=new r[e.type](e,this.object);var s=this._views.indexOf(t);this._views.splice(s,1,i),this.currentViewID===t.id&&(this.currentViewID=i.id)}return this.object.save(),i}}},88412:t=>{t.exports=class{constructor(t){this.elements=t.elements||function(){return[]},this.init=t.init||function(){},this.validate=t.validate||function(){return!0},this.values=t.values||function(){return{}},this.logic=t.logic||{}}}},23989:(t,e,i)=>{const s=i(60069),n=i(88412),a=i(28893),r=i(90176),o=i(41812),l=i(98134),h=i(74384);let c=(...t)=>AB.Multilingual.label(...t);var d={name:"Default Gantt",filterConditions:[],sortFields:[],title:"none",startDate:null,endDate:"none",duration:"none",progress:"none",notes:"none"};t.exports=class t extends s{constructor(t,e){super(t,e,"gantt")}static type(){return"gantt"}static icon(){return"fa fa-tasks"}static component(t,e){let i={title:t.unique(`${e}_popupGanttTitle`),startDate:t.unique(`${e}_popupGanttStartDate`),endDate:t.unique(`${e}_popupGanttEndDate`),duration:t.unique(`${e}_popupGanttDuration`),progress:t.unique(`${e}_popupGanttProgress`),notes:t.unique(`${e}_popupGanttNotes`)},s=(t,e)=>{let s=t.fields((t=>t instanceof r)).map((({id:t,label:e})=>({id:t,value:e})));$$(i.startDate).define("options",s),s.unshift({id:"none",value:c("Select a date field")}),$$(i.endDate).define("options",s);let n=t.fields((t=>t instanceof o)).map((({id:t,label:e})=>({id:t,value:e})));n.unshift({id:"none",value:c("Select a number field")}),$$(i.duration).define("options",n);let a=t.fields((t=>t instanceof o)).map((({id:t,label:e})=>({id:t,value:e})));a.unshift({id:"none",value:c("Select a number field")}),$$(i.progress).define("options",a);let u=t.fields((t=>t instanceof l||t instanceof h)).map((({id:t,label:e})=>({id:t,value:e})));u.unshift({id:"none",value:c("Select a string field")}),$$(i.title).define("options",u),$$(i.notes).define("options",u),e&&e.title&&($$(i.title).define("value",e.title),$$(i.title).refresh()),e&&e.startDate&&($$(i.startDate).define("value",e.startDate),$$(i.startDate).refresh()),e&&e.endDate&&($$(i.endDate).define("value",e.endDate||d.endDate),$$(i.endDate).refresh()),e&&e.duration&&($$(i.duration).define("value",e.duration||d.duration),$$(i.duration).refresh()),e&&e.progress&&($$(i.progress).define("value",e.progress),$$(i.progress).refresh()),e&&e.notes&&($$(i.notes).define("value",e.notes),$$(i.notes).refresh())};var u=new a(t,`${e}_gantt`);return new n({elements:()=>({batch:"gantt",rows:[{cols:[{id:i.title,view:"richselect",label:`<span class='webix_icon fa fa-calendar'></span> ${c("Title")}`,placeholder:c("Select a string field"),labelWidth:130,name:"title",options:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{u.show(null,l.defaults().key)}}]},{cols:[{id:i.startDate,view:"richselect",label:`<span class='webix_icon fa fa-calendar'></span> ${c("Start Date")}`,placeholder:c("Select a date field"),labelWidth:130,name:"startDate",required:!0,options:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{u.show(null,r.defaults().key)}}]},{cols:[{id:i.endDate,view:"richselect",label:`<span class='webix_icon fa fa-calendar'></span> ${c("End Date")}`,placeholder:c("Select a date field"),labelWidth:130,name:"endDate",options:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{u.show(null,r.defaults().key)}}]},{cols:[{id:i.duration,view:"richselect",label:`<span class='webix_icon fa fa-hashtag'></span> ${c("Duration")}`,placeholder:c("Select a number field"),labelWidth:130,name:"duration",options:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{u.show(null,o.defaults().key)}}]},{cols:[{id:i.progress,view:"richselect",label:`<span class='webix_icon fa fa-hashtag'></span> ${c("Progress")}`,placeholder:c("Select a number field"),labelWidth:130,name:"progress",required:!1,options:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{u.show(null,o.defaults().key)}}]},{cols:[{id:i.notes,view:"richselect",label:`<span class='webix_icon fa fa-align-right'></span> ${c("Notes")}`,placeholder:c("Select a string field"),labelWidth:130,name:"notes",required:!1,options:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{u.show(null,h.defaults().key)}}]}]}),init:(t,e)=>{t&&(s(t,e),u.applicationLoad(t.application),u.objectLoad(t),u.init({onSave:()=>{s(t,e)}}))},validate:function(t){let e=$$(i.endDate).getValue()||d.endDate,s=$$(i.duration).getValue()||d.duration;return e!=d.endDate||s!=d.duration||(t.markInvalid("endDate","Required"),t.markInvalid("duration","Required"),!1)},values:function(){let t={};return t.title=$$(i.title).getValue()||d.title,t.startDate=$$(i.startDate).getValue()||d.startDate,t.endDate=$$(i.endDate).getValue()||d.endDate,t.duration=$$(i.duration).getValue()||d.duration,t.progress=$$(i.progress).getValue()||d.progress,t.notes=$$(i.notes).getValue()||d.notes,t},logic:{}})}fromObj(e){for(var i in super.fromObj(e),d)this[i]=e[i]||d[i];this.type=t.type()}toObj(){var e=super.toObj();for(var i in d)e[i]=this[i];return e.type=t.type(),e}get titleField(){return this.object.object.fieldByID(this.title)}get startDateField(){return this.object.object.fieldByID(this.startDate)}get endDateField(){return this.object.object.fieldByID(this.endDate)}get durationField(){return this.object.object.fieldByID(this.duration)}get progressField(){return this.object.object.fieldByID(this.progress)}get notesField(){return this.object.object.fieldByID(this.notes)}}},67112:(t,e,i)=>{const s=i(60069);var n={name:"Default Grid",sortFields:[],filterConditions:[],frozenColumnID:"",hiddenFields:[]};t.exports=class t extends s{constructor(t,e){super(t,e,"grid")}static type(){return"grid"}static icon(){return"fa fa-table"}fromObj(e){for(var i in super.fromObj(e),n)this[i]=e[i]||n[i];this.type=t.type()}toObj(){var t=super.toObj();for(var e in n)t[e]=this[e];return t.type="grid",t}}},18318:(t,e,i)=>{const s=i(60069),n=i(88412),a=i(28893),r=i(66589),o=i(69319),l=i(29333);var h={name:"Default Kanban",filterConditions:[],sortFields:[],verticalGroupingField:null,horizontalGroupingField:null,ownerField:null};let c=(...t)=>AB.Multilingual.label(...t);t.exports=class t extends s{constructor(t,e){super(t,e,"kanban")}static type(){return"kanban"}static icon(){return"fa fa-columns"}static component(t,e){let i={vGroupInput:`${e}_popupAddViewVGroup`,hGroupInput:`${e}_popupAddViewHGroup`,ownerInput:`${e}_popupAddViewOwner`},s=(t,e,s={})=>{const n=(i,s,n=(t=>t.key===o.defaults().key),a)=>{if(null!=i&&null!=t){var r=t.fields().filter(n).map((({id:t,label:e})=>({id:t,value:e})));!a&&r.length&&r.unshift({id:0,value:c("None")}),i.define("options",r),e?e[s]?i.define("value",e[s]):!a&&r[0]&&i.define("value",r[0].id):1===r.filter((t=>t.id)).length&&i.define("value",r[0].id),i.refresh()}};n(s.vGroupInput||$$(i.vGroupInput),"verticalGroupingField",(t=>[o.defaults().key,l.defaults().key].includes(t.key)),!0),n(s.hGroupInput||$$(i.hGroupInput),"horizontalGroupingField",(t=>[r.defaults().key,o.defaults().key,l.defaults().key].includes(t.key)),!1),n(s.ownerInput||$$(i.ownerInput),"ownerField",(t=>t.key===l.defaults().key||t.key===r.defaults().key&&"one"==t.settings.linkType&&"many"==t.settings.linkViaType),!1)};var h=new a(t,`${e}_kanban`);return new n({elements:()=>({batch:"kanban",rows:[{cols:[{view:"richselect",label:`<span class='webix_icon fa fa-columns'></span> ${c("Vertical Grouping")}`,id:i.vGroupInput,placeholder:c("Select a field"),labelWidth:180,name:"vGroup",required:!0,options:[],on:{onChange:function(t){$$(i.vGroupInput).validate(),$$(i.hGroupInput).validate()}},invalidMessage:c("Required")},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{h.show(null,o.defaults().key)}}]},{cols:[{view:"richselect",label:`<span class='webix_icon fa fa-list'></span> ${c("Horizontal Grouping")}`,id:i.hGroupInput,placeholder:c("Select a field"),labelWidth:180,name:"hGroup",required:!1,options:[],invalidMessage:c("Cannot be the same as vertical grouping field"),validate:t=>{var e=$$(i.vGroupInput).getValue();return!e||!t||e!==t},on:{onChange:function(t){$$(i.hGroupInput).validate()}}},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{h.show(null,o.defaults().key)}}]},{cols:[{view:"richselect",label:`<span class='webix_icon fa fa-user-circle'></span> ${c("Card Owner")}`,placeholder:c("Select a user field"),id:i.ownerInput,labelWidth:180,name:"owner",options:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:"",width:20,click:()=>{h.show(null,r.defaults().key)}}]}]}),init:(t,e)=>{s(t,e),h.applicationLoad(t.application),h.objectLoad(t),h.init({onSave:()=>{s(t,e)}})},values:function(){let t={};return t.verticalGroupingField=$$(i.vGroupInput).getValue()||null,t.horizontalGroupingField=$$(i.hGroupInput).getValue()||null,t.ownerField=$$(i.ownerInput).getValue()||null,t},logic:{refreshOptions:s}})}fromObj(e){for(var i in super.fromObj(e),h)this[i]=e[i]||h[i];this.type=t.type()}toObj(){var e=super.toObj();for(var i in h)e[i]=this[i];return e.type=t.type(),e}getHorizontalGroupingField(){return this.object.object.fieldByID(this.horizontalGroupingField)}getVerticalGroupingField(){return this.object.object.fieldByID(this.verticalGroupingField)}getOwnerField(){return this.object.object.fieldByID(this.ownerField)}}},10679:t=>{t.exports=class{constructor(t){this.label=t,this.ui=null}cleanRules(t,e,i){void 0===i&&(i=!0),function t(s){if(s)if(s.glue&&s.rules)s.rules.forEach((e=>{t(e)}));else{var n=e.filter((t=>t.id==s.key))[0];if(n)switch(n.type){case"number":case"formula":"string"==typeof s.value&&(-1==s.value.indexOf(".")?s.value=parseInt(s.value):s.value=parseFloat(s.value));break;case"date":i?s.value instanceof Date&&(s.value=webix.i18n.dateFormatStr(s.value)):"string"==typeof s.value&&(s.value=new Date(s.value))}}}(t)}component(t,e){this.App=t,this.idBase=e;var i=t.Label,s=webix.uid(),n=t=>`${e}_${t}_${s}`,a=this.ids={component:n("qbObjectFieldConditions"),queryBuilder:n("qBuilder"),queryBuilderContainer:n("qBuilderContainer"),queryBuilderLayout:n("qBuilderLayout"),showQBButton:n("showQBButton")};this.ui={view:"layout",id:a.queryBuilderLayout,hidden:!0,type:"line",rows:[{id:a.showQBButton,cols:[{fillspace:!0},{view:"button",css:"webix_primary",name:"addqb",value:i("Add Custom Conditions"),autowidth:!0,click:function(){$$(a.queryBuilderContainer).show(),$$(a.showQBButton).hide()}},{fillspace:!0}]},{hidden:!0,id:a.queryBuilderContainer,cols:[{view:"querybuilder",id:a.queryBuilder,fields:this.conditionFields()}]}]},this.label&&this.ui.rows[1].cols.unshift({view:"label",css:"ab-text-bold",label:this.label,width:this.AB.UISettings.config().labelWidthLarge}),this.init=t=>{for(var e in t=t||{},r.callbacks)r.callbacks[e]=t[e]||r.callbacks[e]};var r=this._logic={callbacks:{onCancel:function(){console.warn("NO onCancel()!")},onSave:function(t){console.warn("NO onSave()!")}},cleanRules:(t,e,i)=>{this.cleanRules(t,e,i)},getValue:()=>{var t=null,e=$$(a.queryBuilder);return e&&(t=e.getValue()),t&&r.cleanRules(t[0],t[1],!0),t},setValue:t=>{t=t||[],Array.isArray(t)||(t=[t]),0==t.length&&t.push({}),t.length<2&&t.push(this.conditionFields()),r.cleanRules(t[0],t[1],!1);var e=$$(a.queryBuilder);e&&t[0]&&t[0].rules&&t[0].rules.length&&(e.setValue(t[0]),$$(a.queryBuilderContainer).show(),$$(a.showQBButton).hide())}};this.getValue=r.getValue,this.show=r.show,this.setValue=r.setValue}objectLoad(t){this.currentObject=t}conditionFields(){var t=["string","LongText","number","date","email","formula","calculate"],e=[];return this.currentObject&&this.currentObject.fields().forEach((i=>{if(-1!=t.indexOf(i.key)){let t=i.key;"formula"==i.key||"calculate"==i.key?t="number":"LongText"==i.key&&(t="string"),e.push({id:i.columnName,value:i.label,type:t})}})),e}process(t){return new Promise(((e,i)=>{var s=0,n=()=>{++s>=this.listRules.length&&e()};this.listRules.forEach((e=>{e.process(t).then((function(){n()})).catch((t=>{i(t)}))})),0==this.listRules.length&&e()}))}showQueryBuilderContainer(){$$(this.ids.queryBuilderLayout).show(),$$(this.ids.queryBuilderContainer).show(),$$(this.ids.showQBButton).hide()}}},12608:(t,e,i)=>{const s=i(10679);let n=(...t)=>AB.Multilingual.label(...t);t.exports=class{constructor(t){this.listActions=t||[],this.actionDropList=[],this.listActions.forEach((t=>{this.actionDropList.push({id:t.key,value:t.label})})),this.selectedAction=null,this.actionDropList.length>0&&(this.selectedAction=this.actionDropList[0].id),this.removable=!0,this.currentObject=null,this.objectQB=null,this.currentForm=null}component(t,e){this.App=t,this.idBase=e;var i=webix.uid(),s=t=>`${e}_${t}_${i}`,a=this.ids={component:s("component"),selectAction:s("chooseAction"),queryBuilder:s("queryBuilder"),valueDisplay:s("valueArea")};this.objectQB.label=n("When"),this.objectQB.component(this.App,this.idBase),this.ui=this._generateUI(),this.init=t=>{for(var e in r.callbacks)r.callbacks[e]=t[e]||r.callbacks[e];this.objectQB.init();var i=this.currentAction();if(i){i.component(this.App,this.idBase);var s=i.valueDisplay(a.valueDisplay);r.replaceValueDisplay(s),s.init()}};var r=this._logic={callbacks:{onDelete:function(){console.warn("NO onDelete()!")},onSave:function(t){console.warn("NO onSave()!")}},replaceValueDisplay:t=>{var e=$$(this.ids.valueDisplay);if(e){var i=e.getChildViews(),s=[];i.forEach((t=>{s.push(t)})),s.forEach((t=>{e.removeView(t)})),e.addView(t.ui)}},selectAction:(t,e)=>{t&&$$(this.ids.component).getChildViews().forEach((t=>{t.show()}));var i=this.getAction(e);i&&i.stashCondition(this.objectQB.getValue()),this.selectedAction=t;var s=this.currentAction();if(s){this.objectQB.setValue(s.condition()),s.component(this.App,this.idBase);var n=s.valueDisplay(a.valueDisplay);r.replaceValueDisplay(n),n.init()}}}}_generateUI(){return{id:this.ids.component,view:"layout",css:"ab-component-form-rules",padding:20,type:"line",rows:[{view:"template",css:"ab-component-form-rules-delete",template:'<i class="fa fa-trash ab-component-remove"></i>',height:30,borderless:!0,hidddatasourceen:0==this.removable,onClick:{"ab-component-remove":(t,e,i)=>{this._logic.callbacks.onDelete(this)}}},{id:this.ids.selectAction,view:"richselect",label:n("Action"),placeholder:n("Choose an action"),labelWidth:this.AB.UISettings.config().labelWidthLarge,options:this.actionDropList,on:{onChange:(t,e)=>{this._logic.selectAction(t,e)}}},{for:"values",hidden:!0,cells:[{view:"layout",cols:[{view:"label",label:n("Values"),css:"ab-text-bold",width:this.AB.UISettings.config().labelWidthLarge},{id:this.ids.valueDisplay,view:"layout",rows:[{label:n(" ABViewRule: This should be the Set Area"),css:"ab-text-bold",height:30}]}]}]},this.objectQB.ui]}}conditionFields(){var t=[],e=this.currentAction();return e&&(t=e.conditionFields()),t}currentAction(){return this.getAction(this.selectedAction)}getAction(t){return this.listActions.filter((e=>e.key==t))[0]}objectLoad(t){this.currentObject=t,this.listActions.forEach((e=>{e.objectLoad(t)}));var e=n("When");this.objectQB=new s(e),this.objectQB.objectLoad(t),this.ids&&(this.ui=this._generateUI())}formLoad(t){this.currentForm=t,this.listActions.forEach((e=>{e.formLoad(t)}))}processPre(t={}){if(!this.isValid(t.data))return;let e=this.currentAction();e&&e.processUpdateObject({},t.data)}process(t){var e=this.currentAction();return e?this.isValid(t.data)?e.process(t):new Promise(((t,e)=>{t()})):Promise.resolve()}fromSettings(t){if((t=t||{}).selectedAction){this.selectedAction=t.selectedAction;var e=this.currentAction();if(!e)return;e.stashCondition(t.queryRules||{}),this.ids&&$$(this.ids.selectAction).setValue(this.selectedAction),e.fromSettings(t.actionSettings)}}toSettings(){var t={};if(this.selectedAction){t.selectedAction=this.selectedAction,t.queryRules=this.objectQB.getValue();let e=this.currentAction();e&&(t.actionSettings=e.toSettings())}return t}qbFixAfterShow(){var t=this.currentAction();t&&this.objectQB&&(this.objectQB.setValue(t.condition()),t.qbFixAfterShow())}async isReady(){let t=this.currentAction();return t?t.isReady():Promise.resolve()}isValid(t={}){const e=this.currentObject.fields(),i=this.currentAction().condition()[0]??{},s=(t="")=>"number"==typeof t?t:parseFloat(t.replace(/[^-0-9.]/g,""));e.filter((t=>"number"==t.key||"calculate"==t.key||"formula"==t.key)).forEach((e=>{try{Array.isArray(i?.rules)&&i.rules.forEach((t=>{t.key!=e.id&&t.key!=e.columnName||(t.value=s(t.value))})),t[e.columnName]&&"string"==typeof t[e.columnName]&&(t[e.columnName]=s(t[e.columnName]))}catch(t){}}));const n=(this.AB??AB).filterComplexNew(`${this.idBase}_filter_complex`);return n.fieldsLoad(e,this.currentObject),n.setValue(i),n.init(),n.isValid(t)}get isPreProcess(){return this.currentAction().isPreProcess||!1}}},84496:t=>{t.exports=class{constructor(t,e,i){this.key="ABViewRuleAction",this.queryObject=null,this.currentForm=null,this.queryRules={},this.valueRules={},this.currentForm=i}component(t,e){this.App=t,this.idBase=e,this.label=((...t)=>AB.Multilingual.label(...t))("generic abviewruleaction"),this.ids={component:`${"component",t.unique(`${e}_component`)}_${webix.uid()}`},this._ui=null,this.init=t=>{for(var e in i.callbacks)i.callbacks[e]=t[e]||i.callbacks[e]};var i=this._logic={callbacks:{onDelete:function(){console.warn("NO onDelete()!")},onSave:function(t){console.warn("NO onSave()!")}}}}condition(){return[this.conditionRules(),this.conditionFields()]}stashCondition(t){Array.isArray(t)&&(t=t[0]),t&&("or"!=t.glue&&(t.glue="and"),this.queryRules=t)}conditionFields(){var t=["string","number","date","formula","calculate"],e=[];return this.queryObject&&this.queryObject.fields().forEach((i=>{-1!=t.indexOf(i.key)&&e.push({id:i.columnName,value:i.label,type:i.key})})),e}conditionRules(){return this.queryRules}objectLoad(t){this.queryObjectLoad(t)}queryObjectLoad(t){this.queryObject=t}formLoad(t){this.currentForm=t}process(t){return console.error("!!! ABViewRuleAction.process() should be overridden by its child class."),new Promise(((t,e)=>{e(new Error("ABViewRuleAction.process() should be overridden by its child class."))}))}valueDisplay(t){return this.valueDisplayComponent(t)}valueDisplayComponent(t){return this._ui={ui:{template:"ABViewRuleAction.valueDisplayComponent"},init:t=>{console.error("!!! ABViewRuleAction.valueDisplayComponent() should be overridden."),console.warn(" --\x3e passed in data:",t)}}}fromSettings(t){t=t??{},this.valueRules=t.valueRules??t}toSettings(){return{}}isReady(){return Promise.resolve()}qbFixAfterShow(){}}},97341:t=>{let e=(...t)=>AB.Multilingual.label(...t);t.exports=class{constructor(t){this.listRules=[],this.currentObject=null,(t=t||{}).labels=t.labels||{},t.labels.header=t.labels.header||"ab.components.form.ruleList",t.labels.headerDefault=t.labels.headerDefault||"*Rule List",this.childSettings=t}component(t,i){this.App=this.App||t,this.idBase=i,t=t||this.App,this.currentForm=null;var s=this.ids={component:`${i}_component`,rules:`${i}_rules`,rulesScrollview:`${i}_rulesScrollview`,action:`${i}_action`,when:`${i}_when`,values:`${i}_values`,set:`${i}_set`};this.ui={view:"window",id:s.component,modal:!0,position:"center",resize:!0,width:700,height:450,css:"ab-main-container",head:{view:"toolbar",css:"webix_dark",cols:[{view:"label",label:this.childSettings.labels.headerDefault},{view:"button",css:"webix_primary",icon:"fa fa-plus",type:"iconButton",label:e("Add new rule"),width:150,click:()=>{this.addRule(),console.log($$(s.rules).$height),$$(s.rulesScrollview).scrollTo(0,$$(s.rules).$height)}}]},body:{type:"form",rows:[{view:"scrollview",id:s.rulesScrollview,scroll:"xy",body:{view:"layout",id:s.rules,margin:20,padding:10,rows:[]}},{css:{"background-color":"#fff"},cols:[{fillspace:!0},{view:"button",name:"cancel",value:e("Cancel"),css:"ab-cancel-button",autowidth:!0,click:function(){n.buttonCancel()}},{view:"button",css:"webix_primary",name:"save",label:e("Save"),type:"form",autowidth:!0,click:function(){n.buttonSave()}},{fillspace:!0}]}]}},this.init=t=>{for(var e in n.callbacks)n.callbacks[e]=t[e]||n.callbacks[e];webix.ui(this.ui)};var n=this._logic={buttonCancel:function(){$$(s.component).hide()},buttonSave:()=>{var t=this.toSettings();n.callbacks.onSave(t),n.hide()},callbacks:{onCancel:function(){console.warn("NO onCancel()!")},onSave:function(t){console.warn("NO onSave()!")}},hide:function(){$$(s.component).hide()},show:function(){$$(s.component).show()}};this.show=n.show,this.setValue=n.setValue}addRule(t){var e=this.getRule();if(e){if(this.listRules.push(e),this.ids){var i=$$(this.ids.rules);i&&(e.component(this.App,this.idBase),i.addView(e.ui),e.init({onDelete:t=>{$$(this.ids.rules).removeView(e.ids.component);var i=this.listRules.indexOf(t);-1!==i&&this.listRules.splice(i,1)}}))}t&&e.fromSettings(t)}}fromSettings(t){this.listRules.forEach((t=>{this.ids&&this.ids.rules&&t&&t.ids&&t.ids.component&&$$(this.ids.rules).removeView(t.ids.component)})),this.listRules=[],t&&t.forEach((t=>{this.addRule(t)}))}objectLoad(t){this.currentObject=t,this.listRules.forEach((e=>{e.objectLoad(t)}))}processPre(t){(this.listRules||[]).filter((t=>1==t.isPreProcess)).forEach((e=>{e.processPre(t,t.data)}))}process(t){return new Promise(((e,i)=>{let s=(this.listRules||[]).filter((t=>!t.isPreProcess));var n=0;s.forEach((a=>{a.process(t).then((function(){++n>=s.length&&e()})).catch((t=>{i(t)}))})),0==s.length&&e()}))}toSettings(){var t=[];return this.listRules.forEach((e=>{t.push(e.toSettings())})),t}getRule(){return console.error("!!! ABViewRuleList.getRule() should be overridded by a child object."),null}formLoad(t){this.currentForm=t,this.App=this.App||t.App}rulesReady(){return Promise.resolve()}qbFixAfterShow(){this.listRules.forEach((t=>{t.qbFixAfterShow()}))}}},26204:(t,e,i)=>{const s=i(97341),n=i(12608),a=i(7318),r=i(37857),o=i(38135),l=i(4120);t.exports=class extends s{constructor(){super({labels:{header:"ab.components.form.recordRules",headerDefault:"*Record Rules"}})}getRule(){var t=[new a(this.App,`${this.idBase}_ruleActionUpdate`,this.currentForm),new r(this.App,`${this.idBase}_ruleActionInsert`,this.currentForm),new o(this.App,`${this.idBase}_ruleActionUpdateConnected`,this.currentForm),new l(this.App,`${this.idBase}_ruleActionRemoveConnected`,this.currentForm)],e=new n(t);return this.currentObject&&e.objectLoad(this.currentObject),e}async rulesReady(){var t=(this.listRules||[]).map((t=>t.isReady()));await Promise.all(t)}}},51567:(t,e,i)=>{const s=i(97341),n=i(12608),a=i(26220),r=i(14316),o=i(50924),l=i(97521),h=i(64151),c=i(8873);t.exports=class extends s{constructor(){super({labels:{header:"ab.component.form.submitRule",headerDefault:"*Submit Rules"}})}getRule(){var t=[new a(this.App,`${this.idBase}_ruleActionConfirmMessage`),new r(this.App,`${this.idBase}_ruleActionExistPage`),new o(this.App,`${this.idBase}_ruleActionParentPage`),new l(this.App,`${this.idBase}_ruleActionClosePopup`),new h(this.App,`${this.idBase}_ruleActionWebsite`),new c(this.App,`${this.idBase}_ruleActionEmail`)],e=new n(t);return e.objectLoad(this.currentObject),e.formLoad(this.currentForm),e}}},37857:(t,e,i)=>{const s=i(38135);t.exports=class extends s{constructor(t,e,i){super(t,e,i),this.key="ABViewRuleActionFormRecordRuleInsertConnected",this.label=((...t)=>AB.Multilingual.label(...t))("Insert Connected Object")}valueDisplayChooser(t){var e=super.valueDisplayChooser(t);return e._logic.showQBIfNeeded=function(){},e}queryBuilderDisplay(){return null}process(t){var e=this.connectedObject(),i=e.model(),s=this.selectedField(),n={};if(this.processUpdateObject({},n),!n.newRecords){let a=e.fieldByID(s.settings.linkColumn);return a?(n[a.columnName]=t.data.id,i.create(n)):Promise.reject("No connected object field")}{let a=e.fieldByID(s.settings.linkColumn);if(!a)return Promise.reject("No connected object field");n.newRecords.forEach((e=>(e[a.columnName]=t.data.id,i.create(e))))}}toSettings(){var t=super.toSettings();return delete t.qbCondition,t}}},4120:(t,e,i)=>{const s=i(38135);t.exports=class extends s{constructor(t,e,i){super(t,e,i),this.key="ABViewRuleActionFormRecordRuleRemoveConnected",this.label=((...t)=>AB.Multilingual.label(...t))("Remove Connected Record"),this.isUpdateValueDisabled=!0}process(t){let e=this.selectedField();return this._formData=t.data,new Promise(((i,s)=>{let n=t.form.datacollection;if(!n)return i();let a=n.model;if(!a)return i();let r={};r[e.columnName]="",a.update(t.data.id,r).then(i).catch((e=>{this.AB.notify.developer(e,{message:"!!! ABViewRuleActionFormRecordRuleUpdate.process(): update error:",data:t.data}),s(e)}))}))}}},7318:(t,e,i)=>{const s=i(45263);t.exports=class extends s{constructor(t,e,i){super(t,e,i),this.key="ABViewRuleActionFormRecordRuleUpdate",this.label=((...t)=>AB.Multilingual.label(...t))("Update Record")}get isPreProcess(){return!0}}},38135:(t,e,i)=>{const s=i(45263),n=i(66589),a=i(10679);let r=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{constructor(t,e,i){super(t,e,i),this.key="ABViewRuleActionFormRecordRuleUpdateConnected",this.label=r("Update Connected Record"),this.baseObject=null,this.selectedFieldID=null,this.fieldDropList=[],this.objectQB=null,this.qbCondition=null}objectLoad(t){this.queryObjectLoad(t),this.baseObject=t,this.connectedFieldList().forEach((t=>{this.fieldDropList.push({id:t.id,value:t.label})}))}connectedFieldList(){var t=n.defaults().key;return this.baseObject&&this.baseObject.fields?this.baseObject.fields((e=>e.key==t)):[]}connectedObject(){if(this.selectedFieldID){var t=this.selectedField();if(t)return t.datasourceLink}return null}selectedField(){return this.connectedFieldList().filter((t=>t.id==this.selectedFieldID))[0]}valueDisplayComponent(t){return null==this._uiChooser&&(this._uiChooser=this.valueDisplayChooser(t)),this._uiChooser}valueDisplayChooser(t){var e=webix.uid(),i=t=>t+"_"+e,s={component:i("updateConnectedValues"),updateForm:i("updateChooser"),selectConnectedField:i("updateSelect"),updateFieldsForm:i("updateForm")},n={id:s.component,view:"layout",css:"ab-component-form-rule",rows:[{id:s.selectConnectedField,view:"richselect",label:r("Select which connected object to update."),labelWidth:300,value:this.selectedField,options:this.fieldDropList,on:{onChange:(t,e)=>{a.selectAction(t,e)}}}]},a=this._logic={addDisplay:t=>{$$(s.component).addView(t)},removePreviousDisplays:()=>{var t=$$(s.component).getChildViews(),e=[];t.forEach((t=>{e.push(t)})),e.forEach((t=>{t.config.id!=s.selectConnectedField&&$$(s.component).removeView(t)}))},selectAction:(t,e)=>{a.removePreviousDisplays(),this.selectedFieldID=t;var i=this.connectedObject();if(i){if(this.updateObjectLoad(i),this.updateComponent=super.valueDisplayComponent(s.updateFieldsForm),a.showQBIfNeeded(),a.addDisplay(this.updateComponent.ui),this.updateComponent.init(),this.isUpdateValueDisabled){let t=$$(this.updateComponent.ui.id);t&&(t.disable(),t.hide())}}else this.AB.notify.builder(new Error("No connectedObject found."),{fieldID:this.selectedFieldID})},showQBIfNeeded:()=>{var t=this.queryBuilderDisplay();t.component(this.App,this.idBase),a.addDisplay(t.ui),t.init({})},fromSettings:t=>{$$(s.selectConnectedField).setValue(t.selectedFieldID),this.objectQB&&this.objectQB.setValue(this.qbCondition),this.updateComponent&&this.updateComponent.fromSettings(t)},toSettings:()=>{var t={fieldOperations:[]};return this.formRows.forEach((e=>{var i=e.toSettings();i&&t.fieldOperations.push(i)})),t}};return{ui:n,init:t=>{if(t=t||this.valueRules,this.selectedFieldID){var e=$$(s.selectConnectedField);e&&e.setValue(this.selectedFieldID)}},fromSettings:t=>{a.fromSettings(t)},toSettings:()=>a.toSettings(),_logic:a}}queryBuilderDisplay(){if(!this.objectQB){this.objectQB=new a(r("How to choose which object:"));var t=this.connectedObject();t&&this.objectQB.objectLoad(t)}return this.objectQB}process(t){this._formData=t.data;var e=this.connectedObject(),i=e.model(),s=this.selectedField(),n=null,a=i=>{this.baseObject.model().findConnected(s.columnName,t.data).then((t=>{if(t&&0!=t.length){var s=t.map((t=>t.id));n={glue:"and",rules:[{key:`${e.dbTableName()}.${e.PK()}`,rule:"in",value:s}]},Object.keys(this.qbCondition).length>0&&n.rules.push(this.qbCondition),i()}else i()})).catch(i)};return new Promise(((e,s)=>{var r=(e,s)=>{this.processUpdateObject({},e)?i.update(e.id,e).then((()=>{s()})).catch((e=>{this.AB.notify.developer(e,{message:"!!! ABViewRuleActionFormRecordRuleUpdateConnected.process(): update error:",data:t.data}),s(e)})):s()};a((t=>{t?s(t):null===n?e():i.findAll({where:n}).then((t=>{var i=0;t&&t.data&&(t=t.data),t.forEach((n=>{r(n,(n=>{if(n)return s(n);++i>=t.length&&e()}))})),0==t.length&&e()})).catch(s)}))}))}fromSettings(t){t=t||{},this.selectedFieldID=t.selectedFieldID||null,this.qbCondition=t.qbCondition||{},super.fromSettings(t),this._uiChooser&&this._logic.fromSettings(t)}toSettings(){var t=super.toSettings();t.selectedFieldID=this.selectedFieldID;var e=null;return this.objectQB&&(e=this.objectQB.getValue(),Array.isArray(e)&&(e=e[0]),e&&(e.glue=e.glue||"and")),t.qbCondition=e,this._uiChooser&&(t.valueRules=this._logic.toSettings()),t}qbFixAfterShow(){this.objectQB&&this.objectQB.setValue(this.qbCondition)}}},97521:(t,e,i)=>{const s=i(84496);t.exports=class extends s{constructor(t,e){super(),this.App=t,this.key="ABViewRuleActionFormSubmitRuleClosePopup",this.label=((...t)=>AB.Multilingual.label(...t))("Close the current popup"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(t){return this._ui={ui:{view:"layout",rows:[]},init:()=>{}},this._ui}process(t){return new Promise(((e,i)=>{let s=t.form;if(!s)return;let n=s.pageParent((t=>"popup"==t.settings.type));if(!n)return;let a=$$(n.id);a&&a.hide(),t.form.changePage(null),e()}))}}},26220:(t,e,i)=>{const s=i(84496);t.exports=class extends s{constructor(t,e){super(),this.App=t,this.key="ABViewRuleActionFormSubmitRuleConfirmMessage",this.label=((...t)=>AB.Multilingual.label(...t))("Show a confirmation message"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(t){var e={message:`${t}_message`};this._ui={ui:{id:e.message,view:"textarea",height:130},init:()=>{},_logic:i,fromSettings:t=>{i.fromSettings(t)},toSettings:()=>i.toSettings()};var i={fromSettings:t=>{t=t||{},$$(e.message).setValue(t.message||"")},toSettings:()=>({message:$$(e.message).getValue()||""})};return this._ui}process(t){return new Promise(((t,e)=>{var i=this.valueRules.message||"";webix.message({text:i,type:"info"}),t()}))}fromSettings(t){t=t||{},super.fromSettings(t),this._ui&&this._ui.fromSettings(t.valueRules)}toSettings(){var t=super.toSettings();return t.valueRules=this._ui.toSettings(),t}}},8873:(t,e,i)=>{const s=i(84496),n=i(66589),a=i(39137);let r=(...t)=>AB.Multilingual.label(...t);t.exports=class extends s{constructor(t,e){super(),this.App=t,this.key="ABViewRuleActionFormSubmitRuleEmail",this.label=r("Send a custom email"),this.queryObject=null,this.formRows=[]}valueDisplayComponent(t){var e={form:`${t}_form`,popup:`${t}_popup`,list:`${t}_fieldList`,toEmailsContainer:`${t}_toEmailsContainer`,toEmails:`${t}_toEmails`,message:`${t}_message`};this._ui={ui:{id:e.form,view:"form",width:450,elementsConfig:{labelPosition:"top",labelWidth:100},cols:[{width:330,rows:[{view:"text",name:"fromName",label:r("From Name")},{view:"text",name:"fromEmail",label:r("From Email"),validate:webix.rules.isEmail,on:{onChange:function(t,i){this.getValue()&&!this.validate()?$$(e.form).markInvalid("fromEmail","Email is invalid"):$$(e.form).markInvalid("fromEmail",!1)}}},{id:e.toEmailsContainer,view:"forminput",name:"toEmails",label:r("Send"),css:"ab-rich-text",width:320,body:{width:320,rows:[{height:25},{id:e.toEmails,width:320,view:"layout",rows:[]},{view:"button",css:"webix_primary",type:"icon",icon:"fa fa-plus",label:r("Add a recipient"),width:150,click:()=>{i.toEmailAdd()}}]}},{view:"text",name:"subject",label:r("Subject")},{view:"textarea",id:e.message,name:"message",label:r("Message"),width:320,height:400}]},{rows:[{view:"template",type:"header",template:"Fields"},{id:e.list,view:"list",width:120,css:{"background-color":"#fff !important;"},template:function(t,e){return i.fieldTemplate(t,e)},on:{onItemClick:function(t,e,s){var n=this.getItem(t);i.enterField(n)}}}]}]},init:()=>{this.queryObject&&($$(e.list).parse(this.queryObject.fields((t=>t.fieldUseAsLabel()))),$$(e.list).refresh()),i.refreshUI()},_logic:i,fromSettings:t=>{i.fromSettings(t)},toSettings:()=>i.toSettings()};var i={fromSettings:t=>{t=t||{},$$(e.form).setValues(t),(t.toEmails||[]).forEach((t=>{i.toEmailAdd({type:t.type,emailType:t.emailType,value:t.value})})),i.refreshUI()},toSettings:()=>{var t=$$(e.form).getValues()||{},i=[];return $$(e.toEmails).getChildViews().forEach((t=>{var e=t.queryView({name:"emailType"}).getValue(),s=t.queryView({name:e}).getValue();i.push({type:"to",emailType:e,value:s})})),{fromName:t.fromName,fromEmail:t.fromEmail,toEmails:i,subject:t.subject,message:t.message}},toEmailTemplate:t=>({width:320,cols:[{view:"richselect",name:"emailType",value:(t=t||{}).emailType||"email",width:150,options:[{id:"email",value:r("A custom email address")},{id:"field",value:r("An email field")},{id:"query",value:r("From query")}],on:{onChange:function(t,e){i.emailTypeChange(t,this)}}},{width:150,name:"emailValue",visibleBatch:t.emailType||"email",cols:[{view:"text",name:"email",batch:"email",value:"email"==t.emailType?t.value:"",validate:webix.rules.isEmail,width:150,on:{onChange:function(t,e){i.toEmailValidate()}}},{view:"richselect",name:"field",batch:"field",value:"field"==t.emailType?t.value:"",width:150,suggest:{on:{onBeforeShow:function(){this.define("width",300),this.resize()}},data:i.emailFieldOptions()}},{view:"richselect",name:"query",batch:"query",value:"query"==t.emailType?t.value:"",width:150,suggest:{on:{onBeforeShow:function(){this.define("width",300),this.resize()}},data:i.queryOptions()}}]},{view:"button",css:"webix_danger",type:"icon",icon:"fa fa-trash-o",width:32,click:function(){var t=this.getParentView();i.toEmailRemove(t)}}]}),toEmailAdd:t=>{var s=$$(e.toEmails).getChildViews().length;$$(e.toEmails).addView(i.toEmailTemplate(t),s),i.refreshUI()},emailTypeChange:(t,i)=>{var s=i.getParentView().queryView({name:"emailValue"});switch(t){case"field":s.showBatch("field");break;case"query":s.showBatch("query");break;default:s.showBatch("email")}$$(e.toEmailsContainer).adjust()},toEmailRemove:t=>{$$(e.toEmails).removeView(t),i.refreshUI()},toEmailValidate:()=>{var t=!0;$$(e.toEmails).getChildViews().forEach((e=>{let i=e.queryView({name:"email"});i.getValue()&&!i.validate()&&(t=!1)})),t?$$(e.form).markInvalid("toEmails",!1):$$(e.form).markInvalid("toEmails","Email is invalid")},fieldTemplate:(t,e)=>`<i class='fa fa-${t.icon} webix_icon_btn' aria-hidden='true'></i> ${t.label}`,emailFieldOptions:()=>{var t=[],e=[],i=(t,i)=>{var s=t.fields((t=>t instanceof a)).map((e=>{var s="",n="";return i?(s=`${i.id}|${e.urlPointer()}`,n=`${t.label}.${e.label} (${i.label})`):(s=`|${e.urlPointer()}`,n=`${t.label}.${e.label}`),{id:s,value:n}}));e=e.concat(s)};return i(this.queryObject),this.queryObject.connectFields().forEach((e=>{t.indexOf(e.id)>-1||(t.push(e.id),i(e.datasourceLink,e))})),e},queryOptions:()=>{var t=[];return this.currentForm.AB.datacollections((t=>{let e=t.datasource;return t.settings.isQuery&&e&&e.fields((t=>"email"==t.key)).length>0})).forEach((e=>{e.datasource&&e.datasource.fields((t=>"email"==t.key)).forEach((i=>{t.push({id:`${e.id}|${i.id}`,value:`${e.label}.${i.label}`})}))})),t},enterField:t=>{var e=webix.UIManager.getFocus(),i="";"text"==e.config.view&&"textarea"==e.config.view||(e.getValue&&(i=e.getValue()),e.setValue&&e.setValue(`${i}${t.label}`),webix.UIManager.setFocus(e))},refreshUI:()=>{$$(e.toEmailsContainer).adjust(),$$(e.message).adjust()}};return this._ui}process(t){if(!webix.rules.isEmail(this.valueRules.fromEmail))return Promise.resolve();var e=[];return Promise.resolve().then((()=>new Promise(((i,s)=>{var a=[];this.valueRules.toEmails.forEach((i=>{a.push(new Promise(((s,a)=>{if("field"==i.emailType){var r=i.value.split("|")[1],o=this.queryObject.application.urlResolve(r);if(o){if(o.object.id==this.queryObject.id){var l=t.data[o.columnName];l&&(e=e.concat(l))}else{let s=i.value.split("|")[0];this.queryObject.fields((t=>t instanceof n&&t.id==s)).forEach((i=>{var s=t.data[i.relationName()]||[];s&&!Array.isArray(s)&&(s=[s]),s.forEach((t=>{var i=t[o.columnName];i&&(e=e.concat(i))}))}))}s()}else s()}else if("query"==i.emailType){var h=i.value;if(!h)return s();var c=h.split("|")[0],d=h.split("|")[1],u=this.currentForm.AB.datacollectionByID(c);if(!u)return s();var _=u.datasource.fieldByID(d);if(!_)return s();u.getData().forEach((t=>{var i=t[_.columnName];i&&e.push(i)})),s()}else e.push(i.value),s()})))})),Promise.all(a).catch(s).then(i)})))).then((()=>new Promise(((i,s)=>{if(!(e=this.AB.uniq(e).filter((t=>t)))||e.length<1)return i();var n=this.valueRules.fromName,a=this.valueRules.subject,r=this.valueRules.message;this.queryObject.fields((t=>t.fieldUseAsLabel())).forEach((e=>{var i=new RegExp(`{${e.label}}`,"g"),s=e.format(t.data);n=n.replace(i,s),a=a.replace(i,s),r=r.replace(i,s)})),this.AB.Network.post({url:"/app_builder/email",params:{fromName:n,fromEmail:this.valueRules.fromEmail,subject:a,message:r,recipients:this.AB.uniq(e)}}).then((()=>{i()})).catch(s)}))))}fromSettings(t){t=t||{},super.fromSettings(t),this._ui&&this._ui.fromSettings(t.valueRules)}toSettings(){var t=super.toSettings();return t.valueRules=this._ui.toSettings(),t}}},14316:(t,e,i)=>{const s=i(84496);t.exports=class extends s{constructor(t,e){super(),this.App=t,this.key="ABViewRuleActionFormSubmitRuleExistPage",this.label=((...t)=>AB.Multilingual.label(...t))("Redirect to an existing page"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(t){var e={pagesAndTabs:`${t}_PagesAndTabs`};this._ui={ui:{id:e.pagesAndTabs,view:"richselect",options:[]},init:()=>{i.populateOptions()},_logic:i,fromSettings:t=>{i.fromSettings(t)},toSettings:()=>i.toSettings()};var i={populateOptions:()=>{var t=[],i=(e,s,n,a)=>{s=s||"";let r="fa fa-file-o";"tab"==n&&(r="fa fa-window-maximize");let o=e.pageParent();t.push({id:e.id,value:s+e.label,type:n,pageId:o?o.id:null,icon:r}),"page"!=n&&"tab"!=n||(e.pages&&e.pages().forEach((function(t){i(t,s+"-","page")})),e.views&&e.views((t=>"tab"==t.key)).forEach((t=>{t.views().forEach((t=>{i(t,s+"-","tab",e.id)}))})))};i(this.currentForm.pageRoot(),"","page"),$$(e.pagesAndTabs).define("options",t),$$(e.pagesAndTabs).refresh()},fromSettings:t=>{t=t||{},$$(e.pagesAndTabs).setValue(t.tabId||t.pageId||"")},toSettings:()=>{var t={},i=$$(e.pagesAndTabs).getValue(),s=$$(e.pagesAndTabs).getPopup().getList().config.data.filter((t=>t.id==i))[0];return s&&(t="tab"==s.type?{pageId:s.pageId,tabId:i}:{pageId:i}),t}};return this._ui}process(t){return new Promise(((e,i)=>{if(this.valueRules.pageId&&(t.form.changePage(this.valueRules.pageId),this.valueRules.tabId)){var s=t.form.application.pages((t=>t.id==this.valueRules.pageId),!0)[0];if(!s)return e();var n=s.views((t=>t.id==this.valueRules.tabId),!0)[0];if(!n)return e();var a=n.parent;if(!a)return e();var r=t=>{if(!t.parent)return!1;var e=t.parent;if(!e.parent)return!1;e.parent.emit("changeTab",e.id),r(e.parent)};r(a);let i=setInterval((function(){$$(n.id)&&$$(n.id).isVisible()?clearInterval(i):a.emit("changeTab",n.id)}),100)}e()}))}fromSettings(t){t=t||{},super.fromSettings(t),this._ui&&this._ui.fromSettings(t.valueRules)}toSettings(){var t=super.toSettings();return t.valueRules=this._ui.toSettings(),t}}},50924:(t,e,i)=>{const s=i(84496);t.exports=class extends s{constructor(t,e){super(),this.App=t,this.key="ABViewRuleActionFormSubmitRuleParentPage",this.label=((...t)=>AB.Multilingual.label(...t))("Redirect to the parent page"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(t){this._ui={ui:{view:"label",label:this.label},init:()=>{},_logic:e};var e={};return this._ui}process(t){return new Promise(((e,i)=>{var s=t.form.pageParent().pageParent();t.form.changePage(s.id),e()}))}}},64151:(t,e,i)=>{const s=i(84496);t.exports=class extends s{constructor(t,e){super(),this.App=t,this.key="ABViewRuleActionFormSubmitRuleWebsite",this.label=((...t)=>AB.Multilingual.label(...t))("Redirect to another website URL"),this.currentObject=null,this.formRows=[]}valueDisplayComponent(t){var e={website:`${t}_website`};this._ui={ui:{id:e.website,view:"text"},init:()=>{},_logic:i,fromSettings:t=>{i.fromSettings(t)},toSettings:()=>i.toSettings()};var i={fromSettings:t=>{t=t||{},$$(e.website).setValue(t.website||"")},toSettings:()=>({website:$$(e.website).getValue()||""})};return this._ui}process(t){return new Promise(((t,e)=>{this.valueRules.website&&window.open(`http://${this.valueRules.website.replace("http://","")}`,"_blank"),t()}))}fromSettings(t){t=t||{},super.fromSettings(t),this._ui&&this._ui.fromSettings(t.valueRules)}toSettings(){var t=super.toSettings();return t.valueRules=this._ui.toSettings(),t}}},45263:(t,e,i)=>{const s=i(84496);let n=(...t)=>AB.Multilingual.label(...t);var a={filterConditions:{glue:"and",rules:[]}};t.exports=class extends s{constructor(t,e,i){super(t,e,i),this.key="ABViewRuleActionFormRecordRuleUpdate",this.label=n("Update Record"),this.updateObject=null,this.formRows=[],this.stashRules={}}valueDisplayComponent(t){return null==this._uiUpdater&&(this._uiUpdater=this.valueDisplayList(t)),this._uiUpdater}valueDisplayList(t){var e=webix.uid(),i={updateForm:("updateForm",`${t}_updateForm_${e}`)},s={removeAddRow:()=>{var t=s.formGet();if(t){var e=t.getChildViews().filter((t=>t.queryView((function(t){return"field"==t.config.name&&!t.getValue()}))))[0];e&&t.removeView(e)}},addRow:e=>{var i=s.formGet();if(i){var n=i.getChildViews();if(!(null==e&&n.filter((t=>t.queryView((function(t){return"field"==t.config.name&&!t.getValue()})))).length>0)){var a=this.valueDisplayRow(t);i.addView(a.ui),a.init({onAdd:()=>{s.addRow()},onDelete:t=>{s.delRow(t)},data:e}),this.formRows.push(a)}}},delRow:t=>{this.formRows.forEach(((e,i)=>{e.ui.id==t&&this.formRows.splice(i,0)}));var e=s.formGet();e&&e.removeView($$(t))},formClear:()=>{var t=s.formGet();if(t){var e=t.getChildViews(),i=[];e.forEach((t=>{i.push(t)})),i.forEach((e=>{t.removeView(e)})),this.formRows=[]}},formGet:()=>$$(i.updateForm)||(this.currentForm.AB.notify.developer(new Error("no webix form"),{context:"ABViewRuleActionObjectUpdater:formGet  could not find webix form",id:i.updateForm}),null),setValues:t=>{(t=t||{}).fieldOperations=t.fieldOperations||[],s.formGet()&&(s.formClear(),t.fieldOperations.length>0&&t.fieldOperations.forEach((t=>{s.addRow(t)})),s.removeAddRow(),s.addRow())},fromSettings:t=>{var e=t.valueRules||t;s.setValues(e)},toSettings:()=>{var t={fieldOperations:[]};return this.formRows.forEach((e=>{e.toSettings()&&t.fieldOperations.push(e.toSettings())})),t}};return{ui:{view:"form",id:i.updateForm,elements:[]},init:t=>{t=t||this.valueRules,s.setValues(t)},fromSettings:t=>{s.fromSettings(t)},toSettings:()=>s.toSettings(),_logic:s}}valueDisplayRow(t){var e,i=webix.uid(),s=t=>t+"_"+i,r={row:s("row"),updateForm:s("updateFormRow"),field:s("field"),value:s("value"),selectDc:s("selectDc"),selectBy:s("selectBy"),queryField:s("queryField"),multiview:s("multiview"),buttonAdd:s("add"),buttonDelete:s("delete")},o={callbacks:{onAdd:()=>{},onDelete:()=>{}},buttonsToggle:()=>{$$(r.row).getChildViews()[0].getChildViews()[4].hide(),$$(r.row).getChildViews()[0].getChildViews()[5].show()},getFieldList:t=>{var e=[];if(this.updateObject&&(e=(this.updateObject.fields()||[]).map((t=>({id:t.id,value:t.label}))),t)){var i={};this.formRows.forEach((t=>{var e=$$(t.ui.id);if(e){var s=e.getChildViews()[0].getChildViews()[1];i[s.getValue()]=!0}})),e=e.filter((t=>!i[t.id]))}return e},isValid:()=>{var t=this.currentForm.AB.Validation.validator(),e=$$(r.row).getChildViews()[0].getChildViews()[3],i=e.getParentView().getParentView(),s=this.getUpdateObjectField($$(r.field).getValue());if(s){var a=s.getValue(e,{}),o={};return o[s.columnName]=a,s.isValidData(o,t),(""==a||null==a||Array.isArray(a)&&0==a.length)&&t.addError(s.columnName,n("A value is required")),i.clearValidation(),t.updateForm(i),t.pass()}var l=$$(r.row).getChildViews()[0].getChildViews()[1];return l.define("invalidMessage",n("A value is required")),l.define("invalid",!0),l.refresh(),!1},selectField:i=>{var s=this.getUpdateObjectField(i);if(s){var a,l=s.formComponent().newInstance(s.object.application).component(this.App),h=l.ui;h.id=r.value;var c=this.currentForm.AB.datacollections((t=>t.datasource)),d=[];c.forEach((t=>{d.push({id:t.id,value:t.label})}));var u=[{id:"select-one",value:n("Current selection")},{id:"filter-select-one",value:n("Select first after filter by...")}],_={type:"clean",rows:[{cols:[{id:r.selectDc,view:"combo",options:d,placeholder:n("Choose a data source"),on:{onChange:(t,e)=>{var i=this.currentForm.AB.datacollectionByID(t);if(!i||"query"!=i.sourceType&&s.isConnection)$$(r.queryField).hide();else{var n=[];i.datasource.fields().forEach((t=>{n.push({id:t.id,value:t.label})})),$$(r.queryField).define("options",n),$$(r.queryField).refresh(),$$(r.queryField).show()}}}},{id:r.queryField,view:"combo",hidden:!0,placeholder:n("Choose value from..."),options:[{id:1,value:"figure this out"}]}]},{id:r.selectBy,view:"combo",options:u,placeholder:n("Choose select option"),on:{onChange:(i,s)=>{var n=$$(r.row);if(n.removeView(n.getChildViews()[1]),"select-one"==i)n.addView({},1);else{var a=this.currentForm.datacollection.datasource.fields().map((function(t){return{id:t.id,value:t.label}}));(e=this.AB.filterComplexNew(`${t}_filter`)).init({isRecordRule:!0,recordRuleFieldOptions:a}),e.on("change",(t=>{o.onFilterChange(t)})),n.addView(e.ui,1);var l=$$(r.selectDc).getValue(),h=this.currentForm.AB.datacollectionByID(l);h&&o.populateFilters(h)}}}}]};if("user"==s.key&&(h.options=h.options||[],h.options.unshift({id:"ab-current-user",value:n("[Current User]")})),s.isConnection){var p=s.datasourceLink;c=c.filter((t=>t.datasource.id==p.id));var f=this.currentForm.AB.datacollections((t=>"query"==t.sourceType&&t.datasource&&t.datasource.canFilterObject(p)));c=c.concat(f),d=[],c.forEach((t=>{d.push({id:t.id,value:t.label})})),u.push({id:"filter-select-all",value:n("Select all after filter by...")}),a=_,l={init:function(){}}}else a={id:r.multiview,view:"multiview",cells:[{batch:"custom",rows:[h,{view:"label",label:`<a>${n("Or exists value")}</a>`,on:{onItemClick:function(){this.getParentView().getParentView().showBatch("exist")}}}]},{batch:"exist",rows:[_,{view:"label",label:`<a>${n("Or custom value")}</a>`,on:{onItemClick:function(){var t=this.getParentView().getParentView();$$(r.selectBy).setValue("select-one"),t.showBatch("custom")}}}]}]};var g=$$(r.row).getChildViews()[0];if(g.removeView(g.getChildViews()[3]),g.addView(a,3),l.init(),!s.isConnection&&s.customDisplay){var m=$$(h.id).$view;setTimeout((()=>{s.customDisplay(s,this.App,m,{editable:!0,isForm:!0})}),50)}g.getChildViews()[4].show(),i&&o.callbacks.onAdd()}},setValue:t=>{$$(r.field).setValue(t.fieldID);var e=this.getUpdateObjectField(t.fieldID);if(e){var i=()=>{$$(r.selectDc).setValue(t.value),t.queryField&&$$(r.queryField).setValue(t.queryField);var e=t.selectBy||"select-one";if($$(r.selectBy).setValue(e),"select-one"!=e){var i=t.value,s=this.currentForm.AB.datacollectionByID(i);s&&t.filterConditions&&o.populateFilters(s,t.filterConditions)}};e.isConnection?i():"exist"==t.valueType?($$(r.multiview).showBatch("exist"),i()):($$(r.multiview).showBatch("custom"),setTimeout((function(){var i={};i[e.columnName]=t.value,e.setValue($$(r.value),i)}),50))}},populateFilters:(t,i)=>{i=i||a.filterConditions,e.fieldsLoad(t.datasource?t.datasource.fields():[]),e.setValue(i)},toSettings:()=>{var t=$$(r.buttonDelete);if(t&&t.isVisible()){var i={};i.fieldID=$$(r.field).getValue();var s=$$(r.value),n=this.getUpdateObjectField(i.fieldID);return n.isConnection||"exist"==$$(r.multiview).config.visibleBatch?(i.value=$$(r.selectDc).getValue(),i.queryField=$$(r.queryField).getValue(),i.op="set",i.type=n.key,i.selectBy=$$(r.selectBy).getValue(),i.valueType="exist",e&&(i.filterConditions=e.getValue())):(i.value=n.getValue(s,{}),i.op="set",i.type=n.key,i.valueType="custom"),i}return null}};return{ui:{id:r.row,view:"layout",rows:[{cols:[{view:"label",width:this.currentForm.AB.Config.labelWidthSmall,label:n("Set")},{view:"combo",name:"field",placeholder:n("Choose a field"),id:r.field,height:32,options:o.getFieldList(!0),on:{onChange:function(t){o.selectField(t)}}},{view:"label",width:this.currentForm.AB.Config.labelWidthSmall,label:n("To")},{},{view:"button",css:"webix_danger",id:r.buttonDelete,icon:"fa fa-trash",type:"icon",width:30,hidden:!0,click:function(){o.callbacks.onDelete(r.row)}}]},{}]},init:t=>{for(var e in o.callbacks)o.callbacks[e]=t[e]||o.callbacks[e];t.data&&o.setValue(t.data)},toSettings:()=>o.toSettings(),_logic:o}}getUpdateObjectField(t){return this.queryObject?.fieldByID(t)??this.updateObject?.fieldByID(t)??this.currentForm.AB.fieldNew(this.currentForm.AB.definitionByID(t)??{},this.currentForm.AB.objectNew({}))}processUpdateObject(t,e){this._formData=e;var i=!1;return this.valueRules=this.valueRules||{},this.valueRules.fieldOperations=this.valueRules.fieldOperations||[],this.valueRules.fieldOperations.forEach((t=>{var s=this.getUpdateObjectField(t.fieldID);if(s){var n=t.value;if("ab-current-user"==n)n=this.currentForm.AB.Account.username();else if(s.isConnection||"exist"==t.valueType){const u=this.currentForm.AB.datacollectionByID(t.value);if(!u)return;var a=this.currentForm.AB.cloneDeep(t.filterConditions);a&&a.rules&&a.rules.filter((t=>"same_as_field"==t.rule||"not_same_as_field"==t.rule)).forEach((t=>{var e=this.currentForm.datacollection.datasource.fieldByID(t.value);e.isConnection?t.value=e.format(this._formData):t.value=this._formData[e.columnName],"not_same_as_field"==t.rule?t.rule="not equals":t.rule="equals"}));let _=u.filteredClone(a);switch(t.selectBy){case"select-one":default:switch((n=_.getCursor())&&("exist"==t.valueType?(l=_.datasource.fieldByID(t.queryField))&&(n=n[l.columnName]):n.id&&(n=n.id)),t.op){case"set":if(!n)break;s.isConnection?(e[s.columnName]={},e[s.columnName].id=n[s.datasourceLink.PK()],e[s.columnName][s.datasourceLink.PK()]=n[s.datasourceLink.PK()],s.settings.isCustomFK&&(s.indexField&&(e[s.columnName][s.indexField.columnName]=n[s.indexField.columnName]),s.indexField2&&(e[s.columnName][s.indexField2.columnName]=n[s.indexField2.columnName])),s.datasourceLink.fields((t=>"combined"==t.key||"AutoIndex"==t.key)).forEach((t=>{e[s.columnName][t.columnName]=n[t.columnName]}))):e[s.columnName]=n}break;case"filter-select-all":for(var r=[],o=_.getFirstRecord();o;){switch(_.sourceType){case"object":r.push(o.id);break;case"query":var l,h=o[(l=_.datasource.fieldByID(t.queryField)).columnName];void 0===h&&(h=o[l.relationName()],Array.isArray(h)?h=h.map((t=>t.id?t.id:t)):h.id&&(h=h.id)),r=this.currentForm.AB.uniq(r.concat(h))}o=_.getNextRecord(o)}if("set"===t.op)if("one"==s.linkType()){var c=[];r.forEach((t=>{var i=this.currentForm.AB.cloneDeep(e);i[s.columnName]=t,c.push(i)})),e.newRecords=c}else e[s.columnName]=r;break;case"filter-select-one":if(r=[],n=_.getFirstRecord())if("query"==_.sourceType||"exist"==t.valueType&&t.queryField)l=_.datasource.fieldByID(t.queryField),void 0===(h=n[l.columnName])&&(h=n[l.relationName()],Array.isArray(h)&&(h=h[0]),h.id&&(h=h.id)),n=h;else if("object"==_.sourceType){var d;s.indexField?d=s.indexField.columnName:s.indexField2&&(d=s.indexField2.columnName),d&&n[d]?n=n[d]:n.id&&(n=n.id)}"set"===t.op&&(e[s.columnName]=n)}i=!0}else"set"===t.op&&(e[s.columnName]=n),i=!0}})),i}process(t){return this._formData=t.data,new Promise(((e,i)=>{if(this.processUpdateObject({},t.data)){var s=t.form.datacollection;if(!s)return e();s.model.update(t.data.id,t.data).then(e).catch((e=>{this.currentForm.AB.notify.developer(e,{context:"ABViewRuleActionObjectUpdater:process  update error",id:t.data.id,data:t.data}),i(e)}))}else e()}))}objectLoad(t){super.objectLoad(t),this.updateObjectLoad(t)}updateObjectLoad(t){this.updateObject&&(this.stashRules[this.updateObject.id]=this.valueRules),this.updateObject=t,this._uiUpdater=null,this.valueRules=this.stashRules[this.updateObject.id]||{}}fromSettings(t){if(t=t||{},super.fromSettings(t),t.updateObjectURL){var e=this.currentForm.application.urlResolve(t.updateObjectURL);this.updateObject=e}this._uiUpdater&&this._uiUpdater.fromSettings(t)}toSettings(){var t=super.toSettings();return t.valueRules=this._uiUpdater.toSettings(),t.updateObjectURL=this.updateObject.urlPointer(),t}isReady(){var t=[];return(this.valueRules?.fieldOperations??[]).forEach((e=>{let i=this.getUpdateObjectField(e.fieldID);if(!i)return;if(!i.isConnection&&"exist"!==e.valueType)return;let s=this.currentForm.AB.datacollectionByID(e.value);s?.dataStatus!==s?.dataStatusFlag.initialized&&t.push(new Promise((t=>{s.on("initializedData",(()=>{t()}))})))})),Promise.all(t)}}},82824:t=>{t.exports=function t(e,i,s){function n(r,o){if(!i[r]){if(!e[r]){if(a)return a(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[r]={exports:{}};e[r][0].call(h.exports,(function(t){return n(e[r][1][t]||t)}),h,h.exports,t,e,i,s)}return i[r].exports}for(var a=void 0,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(t,e,i){"use strict";var s=t("docxtemplater").DocUtils;s.convertPixelsToEmus=function(t){return Math.round(9525*t)},e.exports=s},{docxtemplater:5}],2:[function(t,e,i){"use strict";var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=t("./docUtils"),a=/[^.]+\.([^.]+)/,r={getPrefix:function(t){return"docx"===t?"word":"ppt"},getFileTypeName:function(t){return"docx"===t?"document":"presentation"},getRelsFileName:function(t){return t.replace(/^.*?([a-zA-Z0-9]+)\.xml$/,"$1")+".xml.rels"},getRelsFilePath:function(t,e){return("pptx"===e?"ppt/slides":"word")+"/_rels/"+r.getRelsFileName(t)}};e.exports=function(){function t(e,i,s,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.fileName=i,this.prefix=r.getPrefix(n),this.zip=e,this.xmlDocuments=s,this.fileTypeName=r.getFileTypeName(n),this.mediaPrefix="pptx"===n?"../media":"media";var a=r.getRelsFilePath(i,n);this.relsDoc=s[a]||this.createEmptyRelsDoc(s,a)}return s(t,[{key:"createEmptyRelsDoc",value:function(t,e){var i=this.prefix+"/_rels/"+this.fileTypeName+".xml.rels",s=t[i];if(!s){var a=new Error("Could not copy from empty relsdoc");throw a.properties={mainRels:i,relsFileName:e,files:Object.keys(this.zip.files)},a}for(var r=n.str2xml(n.xml2str(s)),o=r.getElementsByTagName("Relationships")[0],l=o.getElementsByTagName("Relationship"),h=0,c=l.length;h<c;h++)o.removeChild(l[h]);return t[e]=r,r}},{key:"loadImageRels",value:function(){var t=this.relsDoc.getElementsByTagName("Relationship");return Array.prototype.reduce.call(t,(function(t,e){var i=e.getAttribute("Id");return/^rId[0-9]+$/.test(i)?Math.max(t,parseInt(i.substr(3),10)):t}),0)}},{key:"addExtensionRels",value:function(t,e){var i=this.xmlDocuments["[Content_Types].xml"],s=i.getElementsByTagName("Default");if(!Array.prototype.some.call(s,(function(t){return t.getAttribute("Extension")===e}))){var n=i.getElementsByTagName("Types")[0],a=i.createElement("Default");a.namespaceURI=null,a.setAttribute("ContentType",t),a.setAttribute("Extension",e),n.appendChild(a)}}},{key:"addImageRels",value:function(t,e,i){null==i&&(i=0);var s=0===i?t:t+"("+i+")",n=this.prefix+"/media/"+s;if(null!=this.zip.files[n])return this.addImageRels(t,e,i+1);var r={name:n,data:e,options:{binary:!0}};this.zip.file(r.name,r.data,r.options);var o=s.replace(a,"$1");this.addExtensionRels("image/"+o,o);var l=this.relsDoc.getElementsByTagName("Relationships")[0],h=this.relsDoc.createElement("Relationship");h.namespaceURI=null;var c=this.loadImageRels()+1;return h.setAttribute("Id","rId"+c),h.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/image"),h.setAttribute("Target",this.mediaPrefix+"/"+s),l.appendChild(h),c}}]),t}()},{"./docUtils":1}],3:[function(t,e,i){"use strict";e.exports={getImageXml:function(t,e){return('<w:drawing>\n\t\t<wp:inline distT="0" distB="0" distL="0" distR="0">\n\t\t\t<wp:extent cx="'+e[0]+'" cy="'+e[1]+'"/>\n\t\t\t<wp:effectExtent l="0" t="0" r="0" b="0"/>\n\t\t\t<wp:docPr id="2" name="Image 2" descr="image"/>\n\t\t\t<wp:cNvGraphicFramePr>\n\t\t\t\t<a:graphicFrameLocks xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" noChangeAspect="1"/>\n\t\t\t</wp:cNvGraphicFramePr>\n\t\t\t<a:graphic xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main">\n\t\t\t\t<a:graphicData uri="http://schemas.openxmlformats.org/drawingml/2006/picture">\n\t\t\t\t\t<pic:pic xmlns:pic="http://schemas.openxmlformats.org/drawingml/2006/picture">\n\t\t\t\t\t\t<pic:nvPicPr>\n\t\t\t\t\t\t\t<pic:cNvPr id="0" name="Picture 1" descr="image"/>\n\t\t\t\t\t\t\t<pic:cNvPicPr>\n\t\t\t\t\t\t\t\t<a:picLocks noChangeAspect="1" noChangeArrowheads="1"/>\n\t\t\t\t\t\t\t</pic:cNvPicPr>\n\t\t\t\t\t\t</pic:nvPicPr>\n\t\t\t\t\t\t<pic:blipFill>\n\t\t\t\t\t\t\t<a:blip r:embed="rId'+t+'">\n\t\t\t\t\t\t\t\t<a:extLst>\n\t\t\t\t\t\t\t\t\t<a:ext uri="{28A0092B-C50C-407E-A947-70E740481C1C}">\n\t\t\t\t\t\t\t\t\t\t<a14:useLocalDpi xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main" val="0"/>\n\t\t\t\t\t\t\t\t\t</a:ext>\n\t\t\t\t\t\t\t\t</a:extLst>\n\t\t\t\t\t\t\t</a:blip>\n\t\t\t\t\t\t\t<a:srcRect/>\n\t\t\t\t\t\t\t<a:stretch>\n\t\t\t\t\t\t\t\t<a:fillRect/>\n\t\t\t\t\t\t\t</a:stretch>\n\t\t\t\t\t\t</pic:blipFill>\n\t\t\t\t\t\t<pic:spPr bwMode="auto">\n\t\t\t\t\t\t\t<a:xfrm>\n\t\t\t\t\t\t\t\t<a:off x="0" y="0"/>\n\t\t\t\t\t\t\t\t<a:ext cx="'+e[0]+'" cy="'+e[1]+'"/>\n\t\t\t\t\t\t\t</a:xfrm>\n\t\t\t\t\t\t\t<a:prstGeom prst="rect">\n\t\t\t\t\t\t\t\t<a:avLst/>\n\t\t\t\t\t\t\t</a:prstGeom>\n\t\t\t\t\t\t\t<a:noFill/>\n\t\t\t\t\t\t\t<a:ln>\n\t\t\t\t\t\t\t\t<a:noFill/>\n\t\t\t\t\t\t\t</a:ln>\n\t\t\t\t\t\t</pic:spPr>\n\t\t\t\t\t</pic:pic>\n\t\t\t\t</a:graphicData>\n\t\t\t</a:graphic>\n\t\t</wp:inline>\n\t</w:drawing>\n\t\t').replace(/\t|\n/g,"")},getImageXmlCentered:function(t,e){return('<w:p>\n\t\t\t<w:pPr>\n\t\t\t\t<w:jc w:val="center"/>\n\t\t\t</w:pPr>\n\t\t\t<w:r>\n\t\t\t\t<w:rPr/>\n\t\t\t\t<w:drawing>\n\t\t\t\t\t<wp:inline distT="0" distB="0" distL="0" distR="0">\n\t\t\t\t\t<wp:extent cx="'+e[0]+'" cy="'+e[1]+'"/>\n\t\t\t\t\t<wp:docPr id="0" name="Picture" descr=""/>\n\t\t\t\t\t<a:graphic xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main">\n\t\t\t\t\t\t<a:graphicData uri="http://schemas.openxmlformats.org/drawingml/2006/picture">\n\t\t\t\t\t\t<pic:pic xmlns:pic="http://schemas.openxmlformats.org/drawingml/2006/picture">\n\t\t\t\t\t\t\t<pic:nvPicPr>\n\t\t\t\t\t\t\t<pic:cNvPr id="0" name="Picture" descr=""/>\n\t\t\t\t\t\t\t<pic:cNvPicPr>\n\t\t\t\t\t\t\t\t<a:picLocks noChangeAspect="1" noChangeArrowheads="1"/>\n\t\t\t\t\t\t\t</pic:cNvPicPr>\n\t\t\t\t\t\t\t</pic:nvPicPr>\n\t\t\t\t\t\t\t<pic:blipFill>\n\t\t\t\t\t\t\t<a:blip r:embed="rId'+t+'"/>\n\t\t\t\t\t\t\t<a:stretch>\n\t\t\t\t\t\t\t\t<a:fillRect/>\n\t\t\t\t\t\t\t</a:stretch>\n\t\t\t\t\t\t\t</pic:blipFill>\n\t\t\t\t\t\t\t<pic:spPr bwMode="auto">\n\t\t\t\t\t\t\t<a:xfrm>\n\t\t\t\t\t\t\t\t<a:off x="0" y="0"/>\n\t\t\t\t\t\t\t\t<a:ext cx="'+e[0]+'" cy="'+e[1]+'"/>\n\t\t\t\t\t\t\t</a:xfrm>\n\t\t\t\t\t\t\t<a:prstGeom prst="rect">\n\t\t\t\t\t\t\t\t<a:avLst/>\n\t\t\t\t\t\t\t</a:prstGeom>\n\t\t\t\t\t\t\t<a:noFill/>\n\t\t\t\t\t\t\t<a:ln w="9525">\n\t\t\t\t\t\t\t\t<a:noFill/>\n\t\t\t\t\t\t\t\t<a:miter lim="800000"/>\n\t\t\t\t\t\t\t\t<a:headEnd/>\n\t\t\t\t\t\t\t\t<a:tailEnd/>\n\t\t\t\t\t\t\t</a:ln>\n\t\t\t\t\t\t\t</pic:spPr>\n\t\t\t\t\t\t</pic:pic>\n\t\t\t\t\t\t</a:graphicData>\n\t\t\t\t\t</a:graphic>\n\t\t\t\t\t</wp:inline>\n\t\t\t\t</w:drawing>\n\t\t\t</w:r>\n\t\t</w:p>\n\t\t').replace(/\t|\n/g,"")},getPptxImageXml:function(t,e,i){return('<p:pic>\n\t\t\t<p:nvPicPr>\n\t\t\t\t<p:cNvPr id="6" name="Picture 2"/>\n\t\t\t\t<p:cNvPicPr>\n\t\t\t\t\t<a:picLocks noChangeAspect="1" noChangeArrowheads="1"/>\n\t\t\t\t</p:cNvPicPr>\n\t\t\t\t<p:nvPr/>\n\t\t\t</p:nvPicPr>\n\t\t\t<p:blipFill>\n\t\t\t\t<a:blip r:embed="rId'+t+'" cstate="print">\n\t\t\t\t\t<a:extLst>\n\t\t\t\t\t\t<a:ext uri="{28A0092B-C50C-407E-A947-70E740481C1C}">\n\t\t\t\t\t\t\t<a14:useLocalDpi xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main" val="0"/>\n\t\t\t\t\t\t</a:ext>\n\t\t\t\t\t</a:extLst>\n\t\t\t\t</a:blip>\n\t\t\t\t<a:srcRect/>\n\t\t\t\t<a:stretch>\n\t\t\t\t\t<a:fillRect/>\n\t\t\t\t</a:stretch>\n\t\t\t</p:blipFill>\n\t\t\t<p:spPr bwMode="auto">\n\t\t\t\t<a:xfrm>\n\t\t\t\t\t<a:off x="'+i.x+'" y="'+i.y+'"/>\n\t\t\t\t\t<a:ext cx="'+e[0]+'" cy="'+e[1]+'"/>\n\t\t\t\t</a:xfrm>\n\t\t\t\t<a:prstGeom prst="rect">\n\t\t\t\t\t<a:avLst/>\n\t\t\t\t</a:prstGeom>\n\t\t\t\t<a:noFill/>\n\t\t\t\t<a:ln>\n\t\t\t\t\t<a:noFill/>\n\t\t\t\t</a:ln>\n\t\t\t\t<a:effectLst/>\n\t\t\t\t<a:extLst>\n\t\t\t\t\t<a:ext uri="{909E8E84-426E-40DD-AFC4-6F175D3DCCD1}">\n\t\t\t\t\t\t<a14:hiddenFill xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main">\n\t\t\t\t\t\t\t<a:solidFill>\n\t\t\t\t\t\t\t\t<a:schemeClr val="accent1"/>\n\t\t\t\t\t\t\t</a:solidFill>\n\t\t\t\t\t\t</a14:hiddenFill>\n\t\t\t\t\t</a:ext>\n\t\t\t\t\t<a:ext uri="{91240B29-F687-4F45-9708-019B960494DF}">\n\t\t\t\t\t\t<a14:hiddenLine xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main" w="9525">\n\t\t\t\t\t\t\t<a:solidFill>\n\t\t\t\t\t\t\t\t<a:schemeClr val="tx1"/>\n\t\t\t\t\t\t\t</a:solidFill>\n\t\t\t\t\t\t\t<a:miter lim="800000"/>\n\t\t\t\t\t\t\t<a:headEnd/>\n\t\t\t\t\t\t\t<a:tailEnd/>\n\t\t\t\t\t\t</a14:hiddenLine>\n\t\t\t\t\t</a:ext>\n\t\t\t\t\t<a:ext uri="{AF507438-7753-43E0-B8FC-AC1667EBCBE1}">\n\t\t\t\t\t\t<a14:hiddenEffects xmlns:a14="http://schemas.microsoft.com/office/drawing/2010/main">\n\t\t\t\t\t\t\t<a:effectLst>\n\t\t\t\t\t\t\t\t<a:outerShdw dist="35921" dir="2700000" algn="ctr" rotWithShape="0">\n\t\t\t\t\t\t\t\t\t<a:schemeClr val="bg2"/>\n\t\t\t\t\t\t\t\t</a:outerShdw>\n\t\t\t\t\t\t\t</a:effectLst>\n\t\t\t\t\t\t</a14:hiddenEffects>\n\t\t\t\t\t</a:ext>\n\t\t\t\t</a:extLst>\n\t\t\t</p:spPr>\n\t\t</p:pic>\n\t\t').replace(/\t|\n/g,"")}}},{}],4:[function(t,e,i){"use strict";var s=t("./memoize"),n=t("xmldom").DOMParser,a=t("xmldom").XMLSerializer,r=t("./errors"),o={};o.defaults={nullGetter:function(t){return t.module?(t.module,""):"undefined"},parser:s((function(t){return s=function(e){return"."===t?e:e[t]},(i="get")in(e={})?Object.defineProperty(e,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[i]=s,e;var e,i,s})),fileType:"docx",delimiters:{start:"{",end:"}"}},o.mergeObjects=function(){for(var t={},e=void 0,i=void 0,s=0;s<arguments.length;s+=1){e=arguments[s],i=Object.keys(e);for(var n=0;n<i.length;n+=1)t[i[n]]=e[i[n]]}return t},o.xml2str=function(t){return(new a).serializeToString(t)},o.decodeUtf8=function(t){try{if(void 0===t)return;return decodeURIComponent(escape(o.convertSpaces(t)))}catch(i){var e=new Error("End");throw e.properties.data=t,e.properties.explanation="Could not decode string to UTF8",e}},o.encodeUtf8=function(t){return unescape(encodeURIComponent(t))},o.str2xml=function(t,e){return new n({errorHandler:e}).parseFromString(t,"text/xml")},o.charMap={"&":"&amp;","'":"&apos;","<":"&lt;",">":"&gt;"};var l=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;o.escapeRegExp=function(t){return t.replace(l,"\\$&")},o.charMapRegexes=Object.keys(o.charMap).map((function(t){var e=o.charMap[t];return{rstart:new RegExp(o.escapeRegExp(e),"g"),rend:new RegExp(o.escapeRegExp(t),"g"),start:e,end:t}})),o.wordToUtf8=function(t){for(var e=void 0,i=0,s=o.charMapRegexes.length;i<s;i++)e=o.charMapRegexes[i],t=t.replace(e.rstart,e.end);return t},o.utf8ToWord=function(t){"string"!=typeof t&&(t=t.toString());for(var e=void 0,i=0,s=o.charMapRegexes.length;i<s;i++)e=o.charMapRegexes[i],t=t.replace(e.rend,e.start);return t},o.cloneDeep=function(t){return JSON.parse(JSON.stringify(t))},o.concatArrays=function(t){return t.reduce((function(t,e){return Array.prototype.push.apply(t,e),t}),[])};var h=new RegExp(String.fromCharCode(160),"g");function c(t){var e=new r.XTTemplateError("No tag '"+t.element+"' was found at the "+t.position);throw e.properties={id:"no_xml_tag_found_at_"+t.position,explanation:"No tag '"+t.element+"' was found at the "+t.position,parsed:t.parsed,index:t.index,element:t.element},e}o.convertSpaces=function(t){return t.replace(h," ")},o.pregMatchAll=function(t,e){for(var i=[],s=void 0;null!=(s=t.exec(e));)i.push({array:s,offset:s.index});return i},o.sizeOfObject=function(t){return Object.keys(t).length},o.getRight=function(t,e,i){for(var s=i,n=t.length;s<n;s++)if(t[s].value==="</"+e+">")return s;c({position:"right",element:e,parsed:t,index:i})},o.getLeft=function(t,e,i){for(var s=t.slice(0,i),n=s.length-1;n>=0;n--){var a=s[n];if(0===a.value.indexOf("<"+e)&&-1!==[">"," "].indexOf(a.value[e.length+1]))return n}c({position:"left",element:e,parsed:t,index:i})},e.exports=o,o.traits=t("./traits"),o.moduleWrapper=t("./module-wrapper")},{"./errors":6,"./memoize":9,"./module-wrapper":11,"./traits":20,xmldom:23}],5:[function(t,e,i){"use strict";var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=t("./doc-utils"),r=a.moduleWrapper,o=function(){function t(){if(n(this,t),arguments.length>0)throw new Error("The constructor with parameters have been removed in docxtemplater 3.0, please check the upgrade guide.");this.compiled={},this.modules=[],this.setOptions({})}return s(t,[{key:"attachModule",value:function(t){return this.modules.push(r(t)),this}},{key:"setOptions",value:function(e){var i=this;return this.options=e,Object.keys(a.defaults).forEach((function(t){var e=a.defaults[t];i[t]=null!=i.options[t]?i.options[t]:e})),"docx"!==this.fileType&&"pptx"!==this.fileType||(this.fileTypeConfig=t.FileTypeConfig[this.fileType]),this.fileTypeConfig=this.options.fileTypeConfig||this.fileTypeConfig,this.options.xmlFileNames=[],this}},{key:"loadZip",value:function(t){if(t.loadAsync)throw new Error("Docxtemplater doesn't handle JSZip version >=3, see changelog");return this.zip=t,this}},{key:"compileFile",value:function(t){var e=this.createTemplateClass(t);e.parse(),this.compiled[t]=e}},{key:"compile",value:function(){this.templatedFiles=this.fileTypeConfig.getTemplatedFiles(this.zip)}},{key:"render",value:function(){var t=this;return this.modules=this.fileTypeConfig.baseModules.map((function(t){return t()})).concat(this.modules),this.options=this.modules.reduce((function(e,i){return i.optionsTransformer(e,t)}),this.options),this.xmlDocuments=this.options.xmlFileNames.reduce((function(e,i){var s=t.zip.files[i].asText();return e[i]=a.str2xml(s),e}),{}),this.modules.forEach((function(e){e.set({zip:t.zip,xmlDocuments:t.xmlDocuments,data:t.data})})),this.compile(),this.modules.forEach((function(e){e.set({compiled:t.compiled})})),this.templatedFiles.forEach((function(e){null!=t.zip.files[e]&&t.compileFile(e)})),this.mapper=this.modules.reduce((function(t,e){return e.getRenderedMap(t)}),{}),Object.keys(this.mapper).forEach((function(e){var i=t.mapper[e],s=i.from,n=t.compiled[s];n.setTags(i.data),n.render(),t.zip.file(e,n.content)})),Object.keys(this.xmlDocuments).forEach((function(e){t.zip.remove(e);var i=a.encodeUtf8(a.xml2str(t.xmlDocuments[e]));return t.zip.file(e,i,{})})),this}},{key:"setData",value:function(t){return this.data=t,this}},{key:"getZip",value:function(){return this.zip}},{key:"createTemplateClass",value:function(t){var e=this.zip.files[t].asText();return this.createTemplateClassFromContent(e,t)}},{key:"createTemplateClassFromContent",value:function(e,i){var s=this,n={filePath:i};return Object.keys(a.defaults).forEach((function(t){n[t]=s[t]})),n.fileTypeConfig=this.fileTypeConfig,n.modules=this.modules,new t.XmlTemplater(e,n)}},{key:"getFullText",value:function(t){return this.createTemplateClass(t||this.fileTypeConfig.textPath).getFullText()}},{key:"getTemplatedFiles",value:function(){return this.compile(),this.templatedFiles}}]),t}();o.DocUtils=t("./doc-utils"),o.Errors=t("./errors"),o.XmlTemplater=t("./xml-templater"),o.FileTypeConfig=t("./file-type-config"),o.XmlMatcher=t("./xml-matcher"),e.exports=o},{"./doc-utils":4,"./errors":6,"./file-type-config":7,"./xml-matcher":21,"./xml-templater":22}],6:[function(t,e,i){"use strict";function s(t){this.name="GenericError",this.message=t,this.stack=new Error(t).stack}function n(t){this.name="TemplateError",this.message=t,this.stack=new Error(t).stack}function a(t){this.name="ScopeParserError",this.message=t,this.stack=new Error(t).stack}function r(t){this.name="InternalError",this.properties={explanation:"InternalError"},this.message=t,this.stack=new Error(t).stack}s.prototype=Error.prototype,n.prototype=new s,a.prototype=new s,r.prototype=new s,e.exports={XTError:s,XTTemplateError:n,XTInternalError:r,XTScopeParserError:a}},{}],7:[function(t,e,i){"use strict";var s=t("./modules/loop"),n=t("./modules/space-preserve"),a=t("./modules/rawxml"),r=t("./modules/expand-pair-trait"),o=t("./modules/render"),l={getTemplatedFiles:function(t){return t.file(/ppt\/(slides|slideMasters)\/(slide|slideMaster)\d+\.xml/).map((function(t){return t.name})).concat(["ppt/presentation.xml"])},textPath:"ppt/slides/slide1.xml",tagsXmlTextArray:["a:t","m:t"],tagsXmlLexedArray:["p:sp","a:tc","a:tr","a:table","a:p","a:r"],tagRawXml:"p:sp",tagTextXml:"a:t",baseModules:[o,r,a,s]},h={getTemplatedFiles:function(t){return t.file(/word\/(header|footer)\d+\.xml/).map((function(t){return t.name})).concat(["word/document.xml"])},textPath:"word/document.xml",tagsXmlTextArray:["w:t","m:t"],tagsXmlLexedArray:["w:tc","w:tr","w:table","w:p","w:r"],tagRawXml:"w:p",tagTextXml:"w:t",baseModules:[o,n,r,a,s]};e.exports={docx:h,pptx:l}},{"./modules/expand-pair-trait":12,"./modules/loop":13,"./modules/rawxml":14,"./modules/render":15,"./modules/space-preserve":16}],8:[function(t,e,i){"use strict";var s=t("./errors"),n=t("./doc-utils");function a(t,e){return t[0]<=e.offset&&e.offset<t[1]}function r(t,e){if("tag"===t.type&&"start"===t.position&&t.text){if(e)throw new Error("Malformed xml : Already in text tag");return!0}if("tag"===t.type&&"end"===t.position&&t.text){if(!e)throw new Error("Malformed xml : Already not in text tag");return!1}return e}function o(t,e){return t.offset-e.offset}function l(t){var e=1;"/"===t[1]&&(e=2);var i=t.indexOf(" "),s=-1===i?t.length-1:i;return{tag:t.slice(e,s),position:1===e?"start":"end"}}function h(t){var e=new s.XTTemplateError("Unclosed tag");throw e.properties={xtag:t.xtag.split(" ")[0].substr(1),id:"unclosed_tag",context:t.xtag,explanation:"The tag beginning with '"+t.xtag.substr(0,10)+"' is unclosed"},e}function c(t,e){var i=!1,n={offset:0},a=void 0;t.forEach((function(t){a=e.substr(n.offset,t.offset-n.offset),("start"===t.position&&i||"end"===t.position&&!i)&&("start"===t.position?h({xtag:a}):function(t){var e=new s.XTTemplateError("Unopened tag");throw e.properties={xtag:t.xtag.split(" ")[0],id:"unopened_tag",context:t.xtag,explanation:"The tag beginning with '"+t.xtag.substr(0,10)+"' is unclosed"},e}({xtag:a})),i=!i,n=t}));var r=e.length;a=e.substr(n.offset,r-n.offset),i&&h({xtag:a})}function d(t,e,i){var s=[],n=-1;do{-1!==(n=t.indexOf(e,n+1))&&s.push({offset:n,position:i})}while(-1!==n);return s}function u(t){var e=this;this.innerContentParts=t,this.full="",this.parseDelimiters=function(t){e.full=e.innerContentParts.join("");var i=0;e.ranges=e.innerContentParts.map((function(t){return(i+=t.length)-t.length}));var s=n.concatArrays([d(e.full,t.start,"start"),d(e.full,t.end,"end")]).sort(o);c(s,e.full);var r={start:t.start.length,end:t.end.length},l=0,h=0;e.parsed=e.ranges.map((function(t,e){for(var i=[t,t+this.innerContentParts[e].length],n=this.innerContentParts[e],o=[];h<s.length&&a(i,s[h]);)o.push(s[h]),h++;var c=[],d=0;l>0&&(d=l,l=0),o.forEach((function(e){var i=n.substr(d,e.offset-t-d);i.length>0&&c.push({type:"content",value:i}),c.push({type:"delimiter",position:e.position}),d=e.offset-t+r[e.position]})),l=d-n.length;var u=n.substr(d);return u.length>0&&c.push({type:"content",value:u}),c}),e)}}e.exports={parse:function(t,e){var i=!1,s=[];t.forEach((function(t){(i=r(t,i))&&"content"===t.type&&s.push(t.value)}));var n=new u(s);n.parseDelimiters(e);var a=[],o=0;return t.forEach((function(t){i=r(t,i),"content"===t.type&&(t.position=i?"insidetag":"outsidetag"),i&&"content"===t.type?(Array.prototype.push.apply(a,n.parsed[o].map((function(t){return"content"===t.type&&(t.position="insidetag"),t}))),o++):a.push(t)})),a},xmlparse:function(t,e){var i=function(t,e,i){for(var s=0,a=t.length,r=n.concatArrays([e.map((function(t){return{tag:t,text:!0}})),i.map((function(t){return{tag:t,text:!1}}))]).reduce((function(t,e){return t[e.tag]=e.text,t}),{}),o=[];s<a&&-1!==(s=t.indexOf("<",s));){var h=s;s=t.indexOf(">",s);var c=t.slice(h,s+1),d=l(c),u=d.tag,_=d.position,p=r[u];null!=p&&o.push({type:"tag",position:_,text:p,offset:h,value:c})}return o}(t,e.text,e.other),s=0,a=i.reduce((function(e,i){var n=t.substr(s,i.offset-s);return n.length>0&&e.push({type:"content",value:n}),s=i.offset+i.value.length,delete i.offset,i.value.length>0&&e.push(i),e}),[]),r=t.substr(s);return r.length>0&&a.push({type:"content",value:r}),a}}},{"./doc-utils":4,"./errors":6}],9:[function(t,e,i){"use strict";e.exports=function(t){var e=JSON.stringify,i={};return function(){var s=e(arguments);return s in i?i[s]:i[s]=t.apply(this,arguments)}}},{}],10:[function(t,e,i){"use strict";function s(t,e){for(var i=-1,s=0,n=t.length;s<n;s++)e[s]>=t[s].length||(-1===i||t[s][e[s]].offset<t[i][e[i]].offset)&&(i=s);if(-1===i)throw new Error("minIndex negative");return i}e.exports=function(t){var e=t.reduce((function(t,e){return t+e.length}),0);t=t.filter((function(t){return t.length>0}));for(var i=new Array(e),n=t.map((function(){return 0})),a=0;a<=e-1;){var r=s(t,n);i[a]=t[r][n[r]],n[r]++,a++}return i}},{}],11:[function(t,e,i){"use strict";function s(){}function n(t){return t}e.exports=function(t){var e={set:s,parse:s,render:s,getTraits:s,optionsTransformer:n,getRenderedMap:n,postparse:n};if(Object.keys(e).every((function(e){return!t[e]})))throw new Error("This module cannot be wrapped, because it doesn't define any of the necessary functions");return Object.keys(e).forEach((function(i){t[i]=t[i]||e[i]})),t}},{}],12:[function(t,e,i){"use strict";var s=t("../mergesort"),n=t("../doc-utils"),a=t("../module-wrapper"),r=t("../traits").getExpandToDefault,o=t("../errors");function l(t){var e=t.tags,i=new o.XTTemplateError("Closing tag does not match opening tag");throw i.properties={id:"closing_tag_does_not_match_opening_tag",explanation:'The tag "'+e[0].value+'" is closed by the tag "'+e[1].value+'"',openingtag:e[0].value,closingtag:e[1].value},i}function h(t){switch(t.location){case"start":return 1;case"end":return-1;default:throw new Error("Location should be one of 'start' or 'end' (given : "+t.location+")")}}function c(t){if(0===t.length)return[];for(var e=1,i=t[0],s=1;s<t.length;s++){var n=t[s];if(0===(e+=h(n.part))){n.part.value!==i.part.value&&""!==n.part.value&&l({tags:[i.part,n.part]});var a=c(t.slice(s+1));return[[i,n]].concat(a)}}var r=i.part;!function(t){var e=t.location,i="start"===e?"unclosed":"unopened",s="start"===e?"Unclosed":"Unopened",n=new o.XTTemplateError(s+" loop"),a=t.part.value;throw n.properties={id:i+"_loop",explanation:"The loop with tag "+a+" is "+i,xtag:a},n}({part:r,location:r.location})}var d={name:"ExpandPairTrait",postparse:function(t,e){var i=e.getTraits,a=e.postparse,o=i("expandPair",t);o=o.map((function(t){return t||[]}));var l=c(o=s(o)),h=l.map((function(e){var i=e[0].part.expandTo;return"auto"===i&&(i=r(t.slice(e[0].offset,e[1].offset))),i?[n.getLeft(t,i,e[0].offset),n.getRight(t,i,e[1].offset)]:[e[0].offset,e[1].offset]})),d=0,u=void 0;return t.reduce((function(e,i,s){var n=d<l.length&&h[d][0]<=s,r=l[d],o=h[d];if(!n)return e.push(i),e;if(o[0]===s&&(u=[]),r[0].offset!==s&&r[1].offset!==s&&u.push(i),o[1]===s){var c=t[r[0].offset];delete c.location,delete c.expandTo,c.subparsed=a(u),e.push(c),d++}return e}),[])}};e.exports=function(){return a(d)}},{"../doc-utils":4,"../errors":6,"../mergesort":10,"../module-wrapper":11,"../traits":20}],13:[function(t,e,i){"use strict";var s=t("../doc-utils"),n=/^-([^\s]+)\s(.+)$/,a=t("../module-wrapper"),r="loop",o={name:"LoopModule",parse:function(t){var e=r,i="placeholder";return"#"===t[0]?{type:i,value:t.substr(1),expandTo:"auto",module:e,location:"start",inverted:!1}:"^"===t[0]?{type:i,value:t.substr(1),expandTo:"auto",module:e,location:"start",inverted:!0}:"/"===t[0]?{type:i,value:t.substr(1),module:e,location:"end"}:"-"===t[0]?{type:i,value:t.replace(n,"$2"),expandTo:t.replace(n,"$1"),module:e,location:"start",inverted:!1}:null},getTraits:function(t,e){if("expandPair"===t)return e.reduce((function(t,e,i){return"placeholder"===e.type&&e.module===r&&t.push({part:e,offset:i}),t}),[])},render:function(t,e){if("placeholder"===!t.type||t.module!==r)return null;var i=[];return e.scopeManager.loopOver(t.value,(function(n){var a=e.scopeManager.createSubScopeManager(n,t.value);i.push(e.render(s.mergeObjects({},e,{compiled:t.subparsed,tags:{},scopeManager:a})))}),t.inverted),{value:i.join("")}}};e.exports=function(){return a(o)}},{"../doc-utils":4,"../module-wrapper":11}],14:[function(t,e,i){"use strict";var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=t("../doc-utils"),a=t("../errors"),r="rawxml",o=t("../module-wrapper");function l(t){var e=t.part,i=t.left,s=t.right,n=t.postparsed,r=t.index,o=n.slice(i+1,s);return o.forEach((function(t,s){s!==r-i-1&&("placeholder"===t.type||"content"===t.type&&"insidetag"===t.position)&&function(t){var e=new a.XTTemplateError("Raw tag should be the only text in paragraph"),i=t.part.value;throw e.properties={id:"raw_xml_tag_should_be_only_text_in_paragraph",explanation:"The tag "+i,xtag:t.part.value,paragraphParts:t.paragraphParts},e}({paragraphParts:o,part:e})})),e}var h=function(){function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.name="RawXmlModule"}return s(t,[{key:"optionsTransformer",value:function(t,e){return this.fileTypeConfig=e.fileTypeConfig,t}},{key:"parse",value:function(t){return"@"!==t[0]?null:{type:"placeholder",value:t.substr(1),module:r}}},{key:"postparse",value:function(t){return n.traits.expandToOne(t,{moduleName:r,getInner:l,expandTo:this.fileTypeConfig.tagRawXml})}},{key:"render",value:function(t,e){if(t.module!==r)return null;var i=e.scopeManager.getValue(t.value);return null==i&&(i=e.nullGetter(t)),{value:i}}}]),t}();e.exports=function(){return o(new h)}},{"../doc-utils":4,"../errors":6,"../module-wrapper":11}],15:[function(t,e,i){"use strict";var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=t("../module-wrapper"),a=function(){function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.name="Render"}return s(t,[{key:"set",value:function(t){t.compiled&&(this.compiled=t.compiled),null!=t.data&&(this.data=t.data)}},{key:"getRenderedMap",value:function(t){var e=this;return Object.keys(this.compiled).reduce((function(t,i){return t[i]={from:i,data:e.data},t}),t)}}]),t}();e.exports=function(){return n(new a)}},{"../module-wrapper":11}],16:[function(t,e,i){"use strict";var s=t("../module-wrapper"),n={name:"SpacePreserveModule",postparse:function(t){var e=[],i=!1,s=t.reduce((function(t,s){return"tag"===s.type&&"start"===s.position&&s.text&&"<w:t>"===s.value&&(i=!0),i?("placeholder"!==s.type||s.module||(e[0].value='<w:t xml:space="preserve">'),e.push(s)):t.push(s),"tag"===s.type&&"end"===s.position&&s.text&&"</w:t>"===s.value&&(Array.prototype.push.apply(t,e),i=!1,e=[]),t}),[]);return Array.prototype.push.apply(s,e),s}};e.exports=function(){return s(n)}},{"../module-wrapper":11}],17:[function(t,e,i){"use strict";var s=t("./doc-utils"),n={postparse:function(t,e){function i(t,i){return e.map((function(e){return e.getTraits(t,i)}))}return function t(s){return e.reduce((function(e,s){return s.postparse(e,{postparse:t,getTraits:i})}),s)}(t)},parse:function(t,e){var i=!1,n=void 0,a=[];return t.reduce((function(t,r){return"delimiter"===r.type?(i="start"===r.position,"end"===r.position?(function(t,i){for(var s=void 0,n=0,a=e.length;n<a;n++)if(s=e[n].parse(t))return i.push(s),s;return null}(n=s.wordToUtf8(n),t)||t.push({type:"placeholder",value:n}),Array.prototype.push.apply(t,a),a=[],t):(n="",t)):i?("content"===r.type&&"insidetag"===r.position?n+=r.value:a.push(r),t):(t.push(r),t)}),[])}};e.exports=n},{"./doc-utils":4}],18:[function(t,e,i){"use strict";var s=t("./scope-manager"),n=t("./doc-utils");e.exports=function t(e){return e.render=t,e.modules=e.modules,e.scopeManager||(e.scopeManager=s.createBaseScopeManager(e)),e.compiled.map((function(t){var i=function(t,e){for(var i=void 0,s=0,n=e.modules.length;s<n;s++)if(i=e.modules[s].render(t,e))return i;return!1}(t,e);if(i)return i.value;if("placeholder"===t.type){var s=e.scopeManager.getValue(t.value);return null==s&&(s=e.nullGetter(t)),n.utf8ToWord(s)}if("content"===t.type||"tag"===t.type)return t.value;throw new Error('Unimplemented tag type "'+t.type+'"')})).join("")}},{"./doc-utils":4,"./scope-manager":19}],19:[function(t,e,i){"use strict";var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=t("./errors"),a=function(){function t(e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.scopePath=e.scopePath,this.scopeList=e.scopeList,this.parser=e.parser}return s(t,[{key:"loopOver",value:function(t,e,i){return i=i||!1,this.loopOverValue(this.getValue(t),e,i)}},{key:"functorIfInverted",value:function(t,e,i){t&&e(i)}},{key:"isValueFalsy",value:function(t,e){return null==t||!t||"[object Array]"===e&&0===t.length}},{key:"loopOverValue",value:function(t,e,i){var s=Object.prototype.toString.call(t),n=this.scopeList[this.num];if(this.isValueFalsy(t,s))return this.functorIfInverted(i,e,n);if("[object Array]"!==s)return"[object Object]"===s?this.functorIfInverted(!i,e,t):!0===t?this.functorIfInverted(!i,e,n):void 0;for(var a,r=0;r<t.length;r++)a=t[r],this.functorIfInverted(!i,e,a)}},{key:"getValue",value:function(t,e){this.num=null==e?this.scopeList.length-1:e;var i=void 0,s=void 0,a=void 0,r=this.scopeList[this.num];try{s=this.parser(t)}catch(e){throw(i=new n.XTScopeParserError("Scope parser compilation failed")).properties={id:"scopeparser_compilation_failed",tag:t,explanation:"The scope parser for the tag "+t+" failed to compile",rootError:e},i}try{a=s.get(r,{num:this.num,scopeList:this.scopeList})}catch(e){throw(i=new n.XTScopeParserError("Scope parser execution failed")).properties={id:"scopeparser_execution_failed",explanation:"The scope parser for the tag "+t+" failed to execute",scope:r,tag:t,rootError:e},i}return null==a&&this.num>0?this.getValue(t,this.num-1):a}},{key:"createSubScopeManager",value:function(e,i){var s={scopePath:this.scopePath.slice(0),scopeList:this.scopeList.slice(0)};return s.parser=this.parser,s.scopeList=this.scopeList.concat(e),s.scopePath=this.scopePath.concat(i),new t(s)}}]),t}();a.createBaseScopeManager=function(t){var e=t.parser,i=t.tags,s={parser:e,tags:i,scopePath:[]};return s.scopeList=[i],new a(s)},e.exports=a},{"./errors":6}],20:[function(t,e,i){"use strict";var s=t("./doc-utils"),n=t("./errors");function a(t,e){if(0===t.length)return!1;var i=t[t.length-1].tag.substr(1),s=e.substr(2,e.length-3);return 0===i.indexOf(s)}function r(t,e){return t.push({tag:e}),t}function o(t,e,i){var a=t.expandTo||i.expandTo,r=e.indexOf(t);if(!a)return e;var o=void 0,l=void 0;try{o=s.getRight(e,a,r),l=s.getLeft(e,a,r)}catch(e){!function(t){var e=new n.XTTemplateError("Raw tag not in paragraph"),i=t.part.value;throw e.properties={id:"raw_tag_outerxml_invalid",explanation:'The tag "'+i+'"',rootError:t.rootError,xtag:i},e}({part:t,rootError:e})}var h=e.slice(l,r),c=e.slice(r+1,o+1),d=i.getInner({index:r,part:t,leftParts:h,rightParts:c,left:l,right:o,postparsed:e});return"[object Array]"===Object.prototype.toString.call(d)&&(d=s.concatArrays(d)),s.concatArrays([e.slice(0,l),[d],e.slice(o+1)])}e.exports={expandToOne:function(t,e){return t.reduce((function(t,i){return"placeholder"===i.type&&i.module===e.moduleName&&t.push(i),t}),[]).forEach((function(i){t=o(i,t,e)})),t},getExpandToDefault:function(t){for(var e=function(t){for(var e,i=t.filter((function(t){return"tag"===t.type})).map((function(t){return t.value})),s=[],n=0;n<i.length;n++)"/"===(e=i[n])[1]?a(s,e)?s.pop():s=r(s,e):"/"!==e[e.length-1]&&(s=r(s,e));return s}(t),i=0;i<e.length;i++)if(0===e[i].tag.indexOf("<w:tc"))return"w:tr";return!1}}},{"./doc-utils":4,"./errors":6}],21:[function(t,e,i){"use strict";var s=t("./doc-utils");var n=t("./memoize")((function(t,e){var i={};i.content=t,i.tagsXmlArray=e,i.tagsXmlArrayJoined=i.tagsXmlArray.join("|");var n=new RegExp("(<(?:"+i.tagsXmlArrayJoined+")[^>]*>)([^<>]*)</(?:"+i.tagsXmlArrayJoined+")>","g");return i.matches=s.pregMatchAll(n,i.content),i.charactersAddedCumulative=i.matches.map((function(){return 0})),i.charactersAdded=i.matches.map((function(){return 0})),function(t){function e(){var e={array:Array.prototype.slice.call(arguments)};e.array.shift();var i=e.array[0]+e.array[1];e.array.unshift(i),e.array.pop();var s=e.array.pop();return e.offset=s,e.first=!0,t.matches.unshift(e),t.charactersAdded.unshift(0),t.charactersAddedCumulative.unshift(0)}-1===t.content.indexOf("<")&&-1===t.content.indexOf(">")&&t.content.replace(/^()([^<>]*)$/,e);var i=new RegExp("^()([^<]+)</(?:"+t.tagsXmlArrayJoined+")>");return t.content.replace(i,e),i=new RegExp("(<(?:"+t.tagsXmlArrayJoined+")[^>]*>)([^>]+)$"),t.content.replace(i,(function(){var e={array:Array.prototype.slice.call(arguments)};e.array.pop();var i=e.array.pop();return e.offset=i,e.last=!0,t.matches.push(e),t.charactersAdded.push(0),t.charactersAddedCumulative.push(0)})),t}(i)}));e.exports=function(t,e){return s.cloneDeep(n(t,e))}},{"./doc-utils":4,"./memoize":9}],22:[function(t,e,i){"use strict";var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=t("./doc-utils"),a=t("./scope-manager"),r=t("./xml-matcher"),o=t("./errors"),l=t("./lexer"),h=t("./parser.js"),c=t("./render.js");e.exports=function(){function t(e,i){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.fromJson(i),this.setModules({inspect:{filePath:this.filePath}}),this.load(e)}return s(t,[{key:"load",value:function(t){if("string"!=typeof t){var e=new o.XTInternalError("Content must be a string");throw e.properties.id="xmltemplater_content_must_be_string",e}this.content=t}},{key:"setTags",value:function(t){return this.tags=null!=t?t:{},this.scopeManager=a.createBaseScopeManager({tags:this.tags,parser:this.parser}),this}},{key:"fromJson",value:function(t){this.filePath=t.filePath,this.modules=t.modules,this.fileTypeConfig=t.fileTypeConfig,Object.keys(n.defaults).map((function(e){this[e]=null!=t[e]?t[e]:n.defaults[e]}),this)}},{key:"getFullText",value:function(){return t=this.content,e=this.fileTypeConfig.tagsXmlTextArray,i=r(t,e).matches.map((function(t){return t.array[2]})),n.wordToUtf8(n.convertSpaces(i.join("")));var t,e,i}},{key:"setModules",value:function(t){this.modules.forEach((function(e){e.set(t)}))}},{key:"parse",value:function(){return this.xmllexed=l.xmlparse(this.content,{text:this.fileTypeConfig.tagsXmlTextArray,other:this.fileTypeConfig.tagsXmlLexedArray}),this.setModules({inspect:{xmllexed:this.xmllexed}}),this.lexed=l.parse(this.xmllexed,this.delimiters),this.setModules({inspect:{lexed:this.lexed}}),this.parsed=h.parse(this.lexed,this.modules),this.setModules({inspect:{parsed:this.parsed}}),this.postparsed=h.postparse(this.parsed,this.modules),this}},{key:"render",value:function(){return this.setModules({inspect:{postparsed:this.postparsed}}),this.content=c({compiled:this.postparsed,tags:this.tags,modules:this.modules,parser:this.parser,nullGetter:this.nullGetter,filePath:this.filePath}),this.setModules({inspect:{content:this.content}}),this}}]),t}()},{"./doc-utils":4,"./errors":6,"./lexer":8,"./parser.js":17,"./render.js":18,"./scope-manager":19,"./xml-matcher":21}],23:[function(t,e,i){function s(t){this.options=t||{locator:{}}}function n(){this.cdata=!1}function a(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function r(t){if(t)return"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}function o(t,e,i){return"string"==typeof t?t.substr(e,i):t.length>=e+i||e?new java.lang.String(t,e,i)+"":t}function l(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}s.prototype.parseFromString=function(t,e){var i=this.options,s=new h,a=i.domBuilder||new n,o=i.errorHandler,l=i.locator,c=i.xmlns||{},d={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return l&&a.setDocumentLocator(l),s.errorHandler=function(t,e,i){if(!t){if(e instanceof n)return e;t=e}var s={},a=t instanceof Function;function o(e){var n=t[e];!n&&a&&(n=2==t.length?function(i){t(e,i)}:t),s[e]=n&&function(t){n("[xmldom "+e+"]\t"+t+r(i))}||function(){}}return i=i||{},o("warning"),o("error"),o("fatalError"),s}(o,a,l),s.domBuilder=i.domBuilder||a,/\/x?html?$/.test(e)&&(d.nbsp=" ",d.copy="",c[""]="http://www.w3.org/1999/xhtml"),c.xml=c.xml||"http://www.w3.org/XML/1998/namespace",t?s.parse(t,c,d):s.errorHandler.error("invalid doc source"),a.doc},n.prototype={startDocument:function(){this.doc=(new c).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,i,s){var n=this.doc,r=n.createElementNS(t,i||e),o=s.length;l(this,r),this.currentElement=r,this.locator&&a(this.locator,r);for(var h=0;h<o;h++){t=s.getURI(h);var c=s.getValue(h),d=(i=s.getQName(h),n.createAttributeNS(t,i));this.locator&&a(s.getLocator(h),d),d.value=d.nodeValue=c,r.setAttributeNode(d)}},endElement:function(t,e,i){var s=this.currentElement;s.tagName,this.currentElement=s.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var i=this.doc.createProcessingInstruction(t,e);this.locator&&a(this.locator,i),l(this,i)},ignorableWhitespace:function(t,e,i){},characters:function(t,e,i){if(t=o.apply(this,arguments)){if(this.cdata)var s=this.doc.createCDATASection(t);else s=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(s):/^\s*$/.test(t)&&this.doc.appendChild(s),this.locator&&a(this.locator,s)}},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,i){t=o.apply(this,arguments);var s=this.doc.createComment(t);this.locator&&a(this.locator,s),l(this,s)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,i){var s=this.doc.implementation;if(s&&s.createDocumentType){var n=s.createDocumentType(t,e,i);this.locator&&a(this.locator,n),l(this,n)}},warning:function(t){console.warn("[xmldom warning]\t"+t,r(this.locator))},error:function(t){console.error("[xmldom error]\t"+t,r(this.locator))},fatalError:function(t){throw console.error("[xmldom fatalError]\t"+t,r(this.locator)),t}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(t){n.prototype[t]=function(){return null}}));var h=t("./sax").XMLReader,c=i.DOMImplementation=t("./dom").DOMImplementation;i.XMLSerializer=t("./dom").XMLSerializer,i.DOMParser=s},{"./dom":24,"./sax":25}],24:[function(t,e,i){function s(t,e){for(var i in t)e[i]=t[i]}function n(t,e){var i=t.prototype;if(Object.create){var n=Object.create(e.prototype);i.__proto__=n}if(!(i instanceof e)){function a(){}a.prototype=e.prototype,s(i,a=new a),t.prototype=i=a}i.constructor!=t&&("function"!=typeof t&&console.error("unknow Class:"+t),i.constructor=t)}var a={},r=a.ELEMENT_NODE=1,o=a.ATTRIBUTE_NODE=2,l=a.TEXT_NODE=3,h=a.CDATA_SECTION_NODE=4,c=a.ENTITY_REFERENCE_NODE=5,d=a.ENTITY_NODE=6,u=a.PROCESSING_INSTRUCTION_NODE=7,_=a.COMMENT_NODE=8,p=a.DOCUMENT_NODE=9,f=a.DOCUMENT_TYPE_NODE=10,g=a.DOCUMENT_FRAGMENT_NODE=11,m=a.NOTATION_NODE=12,v={},b={},w=(v.INDEX_SIZE_ERR=(b[1]="Index size error",1),v.DOMSTRING_SIZE_ERR=(b[2]="DOMString size error",2),v.HIERARCHY_REQUEST_ERR=(b[3]="Hierarchy request error",3)),y=(v.WRONG_DOCUMENT_ERR=(b[4]="Wrong document",4),v.INVALID_CHARACTER_ERR=(b[5]="Invalid character",5),v.NO_DATA_ALLOWED_ERR=(b[6]="No data allowed",6),v.NO_MODIFICATION_ALLOWED_ERR=(b[7]="No modification allowed",7),v.NOT_FOUND_ERR=(b[8]="Not found",8)),x=(v.NOT_SUPPORTED_ERR=(b[9]="Not supported",9),v.INUSE_ATTRIBUTE_ERR=(b[10]="Attribute in use",10));function k(t,e){if(e instanceof Error)var i=e;else i=this,Error.call(this,b[t]),this.message=b[t],Error.captureStackTrace&&Error.captureStackTrace(this,k);return i.code=t,e&&(this.message=this.message+": "+e),i}function C(){}function $(t,e){this._node=t,this._refresh=e,S(this)}function S(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!=e){var i=t._refresh(t._node);nt(t,"length",i.length),s(i,t),t._inc=e}}function I(){}function A(t,e){for(var i=t.length;i--;)if(t[i]===e)return i}function D(t,e,i,s){if(s?e[A(e,s)]=i:e[e.length++]=i,t){i.ownerElement=t;var n=t.ownerDocument;n&&(s&&P(n,t,s),function(t,e,i){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&(e._nsMap[i.prefix?i.localName:""]=i.value)}(n,t,i))}}function E(t,e,i){var s=A(e,i);if(!(s>=0))throw k(y,new Error(t.tagName+"@"+i));for(var n=e.length-1;s<n;)e[s]=e[++s];if(e.length=n,t){var a=t.ownerDocument;a&&(P(a,t,i),i.ownerElement=null)}}function j(t){if(this._features={},t)for(var e in t)this._features=t[e]}function V(){}function N(t){return("<"==t?"&lt;":">"==t&&"&gt;")||"&"==t&&"&amp;"||'"'==t&&"&quot;"||"&#"+t.charCodeAt()+";"}function T(t,e){if(e(t))return!0;if(t=t.firstChild)do{if(T(t,e))return!0}while(t=t.nextSibling)}function F(){}function P(t,e,i,s){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&delete e._nsMap[i.prefix?i.localName:""]}function B(t,e,i){if(t&&t._inc){t._inc++;var s=e.childNodes;if(i)s[s.length++]=i;else{for(var n=e.firstChild,a=0;n;)s[a++]=n,n=n.nextSibling;s.length=a}}}function M(t,e){var i=e.previousSibling,s=e.nextSibling;return i?i.nextSibling=s:t.firstChild=s,s?s.previousSibling=i:t.lastChild=i,B(t.ownerDocument,t),e}function O(t,e,i){var s=e.parentNode;if(s&&s.removeChild(e),e.nodeType===g){var n=e.firstChild;if(null==n)return e;var a=e.lastChild}else n=a=e;var r=i?i.previousSibling:t.lastChild;n.previousSibling=r,a.nextSibling=i,r?r.nextSibling=n:t.firstChild=n,null==i?t.lastChild=a:i.previousSibling=a;do{n.parentNode=t}while(n!==a&&(n=n.nextSibling));return B(t.ownerDocument||t,t),e.nodeType==g&&(e.firstChild=e.lastChild=null),e}function L(){this._nsMap={}}function R(){}function z(){}function H(){}function q(){}function U(){}function W(){}function Y(){}function G(){}function K(){}function X(){}function J(){}function Z(){}function Q(t,e){var i=[],s=9==this.nodeType?this.documentElement:this,n=s.prefix,a=s.namespaceURI;if(a&&null==n&&null==(n=s.lookupPrefix(a)))var r=[{namespace:a,prefix:null}];return et(this,i,t,e,r),i.join("")}function tt(t,e,i){var s=t.prefix||"",n=t.namespaceURI;if(!s&&!n)return!1;if("xml"===s&&"http://www.w3.org/XML/1998/namespace"===n||"http://www.w3.org/2000/xmlns/"==n)return!1;for(var a=i.length;a--;){var r=i[a];if(r.prefix==s)return r.namespace!=n}return!0}function et(t,e,i,s,n){if(s){if(!(t=s(t)))return;if("string"==typeof t)return void e.push(t)}switch(t.nodeType){case r:n||(n=[]),n.length;var a=t.attributes,d=a.length,m=t.firstChild,v=t.tagName;i="http://www.w3.org/1999/xhtml"===t.namespaceURI||i,e.push("<",v);for(var b=0;b<d;b++)"xmlns"==(w=a.item(b)).prefix?n.push({prefix:w.localName,namespace:w.value}):"xmlns"==w.nodeName&&n.push({prefix:"",namespace:w.value});for(b=0;b<d;b++){var w;if(tt(w=a.item(b),0,n)){var y=w.prefix||"",x=w.namespaceURI,k=y?" xmlns:"+y:" xmlns";e.push(k,'="',x,'"'),n.push({prefix:y,namespace:x})}et(w,e,i,s,n)}if(tt(t,0,n)&&(y=t.prefix||"",x=t.namespaceURI,k=y?" xmlns:"+y:" xmlns",e.push(k,'="',x,'"'),n.push({prefix:y,namespace:x})),m||i&&!/^(?:meta|link|img|br|hr|input)$/i.test(v)){if(e.push(">"),i&&/^script$/i.test(v))for(;m;)m.data?e.push(m.data):et(m,e,i,s,n),m=m.nextSibling;else for(;m;)et(m,e,i,s,n),m=m.nextSibling;e.push("</",v,">")}else e.push("/>");return;case p:case g:for(m=t.firstChild;m;)et(m,e,i,s,n),m=m.nextSibling;return;case o:return e.push(" ",t.name,'="',t.value.replace(/[<&"]/g,N),'"');case l:return e.push(t.data.replace(/[<&]/g,N));case h:return e.push("<![CDATA[",t.data,"]]>");case _:return e.push("\x3c!--",t.data,"--\x3e");case f:var C=t.publicId,$=t.systemId;if(e.push("<!DOCTYPE ",t.name),C)e.push(' PUBLIC "',C),$&&"."!=$&&e.push('" "',$),e.push('">');else if($&&"."!=$)e.push(' SYSTEM "',$,'">');else{var S=t.internalSubset;S&&e.push(" [",S,"]"),e.push(">")}return;case u:return e.push("<?",t.target," ",t.data,"?>");case c:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function it(t,e,i){var s;switch(e.nodeType){case r:(s=e.cloneNode(!1)).ownerDocument=t;case g:break;case o:i=!0}if(s||(s=e.cloneNode(!1)),s.ownerDocument=t,s.parentNode=null,i)for(var n=e.firstChild;n;)s.appendChild(it(t,n,i)),n=n.nextSibling;return s}function st(t,e,i){var s=new e.constructor;for(var n in e){var a=e[n];"object"!=typeof a&&a!=s[n]&&(s[n]=a)}switch(e.childNodes&&(s.childNodes=new C),s.ownerDocument=t,s.nodeType){case r:var l=e.attributes,h=s.attributes=new I,c=l.length;h._ownerElement=s;for(var d=0;d<c;d++)s.setAttributeNode(st(t,l.item(d),!0));break;case o:i=!0}if(i)for(var u=e.firstChild;u;)s.appendChild(st(t,u,i)),u=u.nextSibling;return s}function nt(t,e,i){t[e]=i}v.INVALID_STATE_ERR=(b[11]="Invalid state",11),v.SYNTAX_ERR=(b[12]="Syntax error",12),v.INVALID_MODIFICATION_ERR=(b[13]="Invalid modification",13),v.NAMESPACE_ERR=(b[14]="Invalid namespace",14),v.INVALID_ACCESS_ERR=(b[15]="Invalid access",15),k.prototype=Error.prototype,s(v,k),C.prototype={length:0,item:function(t){return this[t]||null},toString:function(t,e){for(var i=[],s=0;s<this.length;s++)et(this[s],i,t,e);return i.join("")}},$.prototype.item=function(t){return S(this),this[t]},n($,C),I.prototype={length:0,item:C.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var i=this[e];if(i.nodeName==t)return i}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new k(x);var i=this.getNamedItem(t.nodeName);return D(this._ownerElement,this,t,i),i},setNamedItemNS:function(t){var e,i=t.ownerElement;if(i&&i!=this._ownerElement)throw new k(x);return e=this.getNamedItemNS(t.namespaceURI,t.localName),D(this._ownerElement,this,t,e),e},removeNamedItem:function(t){var e=this.getNamedItem(t);return E(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var i=this.getNamedItemNS(t,e);return E(this._ownerElement,this,i),i},getNamedItemNS:function(t,e){for(var i=this.length;i--;){var s=this[i];if(s.localName==e&&s.namespaceURI==t)return s}return null}},j.prototype={hasFeature:function(t,e){var i=this._features[t.toLowerCase()];return!(!i||e&&!(e in i))},createDocument:function(t,e,i){var s=new F;if(s.implementation=this,s.childNodes=new C,s.doctype=i,i&&s.appendChild(i),e){var n=s.createElementNS(t,e);s.appendChild(n)}return s},createDocumentType:function(t,e,i){var s=new W;return s.name=t,s.nodeName=t,s.publicId=e,s.systemId=i,s}},V.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return O(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return M(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(t){return st(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==l&&t.nodeType==l?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(t){for(var e=this;e;){var i=e._nsMap;if(i)for(var s in i)if(i[s]==t)return s;e=e.nodeType==o?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var i=e._nsMap;if(i&&t in i)return i[t];e=e.nodeType==o?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){return null==this.lookupPrefix(t)}},s(a,V),s(a,V.prototype),F.prototype={nodeName:"#document",nodeType:p,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType==g){for(var i=t.firstChild;i;){var s=i.nextSibling;this.insertBefore(i,e),i=s}return t}return null==this.documentElement&&t.nodeType==r&&(this.documentElement=t),O(this,t,e),t.ownerDocument=this,t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),M(this,t)},importNode:function(t,e){return it(this,t,e)},getElementById:function(t){var e=null;return T(this.documentElement,(function(i){if(i.nodeType==r&&i.getAttribute("id")==t)return e=i,!0})),e},createElement:function(t){var e=new L;return e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new C,(e.attributes=new I)._ownerElement=e,e},createDocumentFragment:function(){var t=new X;return t.ownerDocument=this,t.childNodes=new C,t},createTextNode:function(t){var e=new H;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new q;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new U;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var i=new J;return i.ownerDocument=this,i.tagName=i.target=t,i.nodeValue=i.data=e,i},createAttribute:function(t){var e=new R;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new K;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var i=new L,s=e.split(":"),n=i.attributes=new I;return i.childNodes=new C,i.ownerDocument=this,i.nodeName=e,i.tagName=e,i.namespaceURI=t,2==s.length?(i.prefix=s[0],i.localName=s[1]):i.localName=e,n._ownerElement=i,i},createAttributeNS:function(t,e){var i=new R,s=e.split(":");return i.ownerDocument=this,i.nodeName=e,i.name=e,i.namespaceURI=t,i.specified=!0,2==s.length?(i.prefix=s[0],i.localName=s[1]):i.localName=e,i}},n(F,V),L.prototype={nodeType:r,hasAttribute:function(t){return null!=this.getAttributeNode(t)},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var i=this.ownerDocument.createAttribute(t);i.value=i.nodeValue=""+e,this.setAttributeNode(i)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===g?this.insertBefore(t,null):function(t,e){var i=e.parentNode;if(i){var s=t.lastChild;i.removeChild(e),s=t.lastChild}return s=t.lastChild,e.parentNode=t,e.previousSibling=s,e.nextSibling=null,s?s.nextSibling=e:t.firstChild=e,t.lastChild=e,B(t.ownerDocument,t,e),e}(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var i=this.getAttributeNodeNS(t,e);i&&this.removeAttributeNode(i)},hasAttributeNS:function(t,e){return null!=this.getAttributeNodeNS(t,e)},getAttributeNS:function(t,e){var i=this.getAttributeNodeNS(t,e);return i&&i.value||""},setAttributeNS:function(t,e,i){var s=this.ownerDocument.createAttributeNS(t,e);s.value=s.nodeValue=""+i,this.setAttributeNode(s)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(t){return new $(this,(function(e){var i=[];return T(e,(function(s){s===e||s.nodeType!=r||"*"!==t&&s.tagName!=t||i.push(s)})),i}))},getElementsByTagNameNS:function(t,e){return new $(this,(function(i){var s=[];return T(i,(function(n){n===i||n.nodeType!==r||"*"!==t&&n.namespaceURI!==t||"*"!==e&&n.localName!=e||s.push(n)})),s}))}},F.prototype.getElementsByTagName=L.prototype.getElementsByTagName,F.prototype.getElementsByTagNameNS=L.prototype.getElementsByTagNameNS,n(L,V),R.prototype.nodeType=o,n(R,V),z.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(b[w])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,i){i=this.data.substring(0,t)+i+this.data.substring(t+e),this.nodeValue=this.data=i,this.length=i.length}},n(z,V),H.prototype={nodeName:"#text",nodeType:l,splitText:function(t){var e=this.data,i=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var s=this.ownerDocument.createTextNode(i);return this.parentNode&&this.parentNode.insertBefore(s,this.nextSibling),s}},n(H,z),q.prototype={nodeName:"#comment",nodeType:_},n(q,z),U.prototype={nodeName:"#cdata-section",nodeType:h},n(U,z),W.prototype.nodeType=f,n(W,V),Y.prototype.nodeType=m,n(Y,V),G.prototype.nodeType=d,n(G,V),K.prototype.nodeType=c,n(K,V),X.prototype.nodeName="#document-fragment",X.prototype.nodeType=g,n(X,V),J.prototype.nodeType=u,n(J,V),Z.prototype.serializeToString=function(t,e,i){return Q.call(t,e,i)},V.prototype.toString=Q;try{if(Object.defineProperty){function at(t){switch(t.nodeType){case r:case g:var e=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&e.push(at(t)),t=t.nextSibling;return e.join("");default:return t.nodeValue}}Object.defineProperty($.prototype,"length",{get:function(){return S(this),this.$$length}}),Object.defineProperty(V.prototype,"textContent",{get:function(){return at(this)},set:function(t){switch(this.nodeType){case r:case g:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),nt=function(t,e,i){t["$$"+e]=i}}}catch(rt){}i.DOMImplementation=j,i.XMLSerializer=Z},{}],25:[function(t,e,i){var s=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,n=new RegExp("[\\-\\.0-9"+s.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),a=new RegExp("^"+s.source+n.source+"*(?::"+s.source+n.source+"*)?$");function r(){}function o(t,e,i,s,n){function a(t){var e=t.slice(1,-1);return e in i?i[e]:"#"===e.charAt(0)?function(t){if(t>65535){var e=55296+((t-=65536)>>10),i=56320+(1023&t);return String.fromCharCode(e,i)}return String.fromCharCode(t)}(parseInt(e.substr(1).replace("x","0x"))):(n.error("entity not found:"+t),t)}function r(e){if(e>x){var i=t.substring(x,e).replace(/&#?\w+;/g,a);b&&o(x),s.characters(i,0,e-x),x=e}}function o(e,i){for(;e>=m&&(i=v.exec(t));)_=i.index,m=_+i[0].length,b.lineNumber++;b.columnNumber=e-_+1}for(var _=0,m=0,v=/.*(?:\r\n?|\n)|.*$/g,b=s.locator,w=[{currentNSMap:e}],y={},x=0;;){try{var k=t.indexOf("<",x);if(k<0){if(!t.substr(x).match(/^\s*$/)){var C=s.doc,$=C.createTextNode(t.substr(x));C.appendChild($),s.currentElement=$}return}switch(k>x&&r(k),t.charAt(k+1)){case"/":var S=t.indexOf(">",k+3),I=t.substring(k+2,S),A=w.pop();S<0?(I=t.substring(k+2).replace(/[\s<].*/,""),n.error("end tag name: "+I+" is not complete:"+A.tagName),S=k+1+I.length):I.match(/\s</)&&(I=I.replace(/[\s<].*/,""),n.error("end tag name: "+I+" maybe not complete"),S=k+1+I.length);var D=A.localNSMap,E=A.tagName==I;if(E||A.tagName&&A.tagName.toLowerCase()==I.toLowerCase()){if(s.endElement(A.uri,A.localName,I),D)for(var j in D)s.endPrefixMapping(j);E||n.fatalError("end tag name: "+I+" is not match the current start tagName:"+A.tagName)}else w.push(A);S++;break;case"?":b&&o(k),S=f(t,k,s);break;case"!":b&&o(k),S=p(t,k,s,n);break;default:b&&o(k);var V=new g,N=w[w.length-1].currentNSMap,T=(S=h(t,k,V,N,a,n),V.length);if(!V.closed&&u(t,S,V.tagName,y)&&(V.closed=!0,i.nbsp||n.warning("unclosed xml attribute")),b&&T){for(var F=l(b,{}),P=0;P<T;P++){var B=V[P];o(B.offset),B.locator=l(b,{})}s.locator=F,c(V,s,N)&&w.push(V),s.locator=b}else c(V,s,N)&&w.push(V);"http://www.w3.org/1999/xhtml"!==V.uri||V.closed?S++:S=d(t,S,V.tagName,a,s)}}catch(t){n.error("element parse error: "+t),S=-1}S>x?x=S:r(Math.max(k,x)+1)}}function l(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function h(t,e,i,s,n,a){for(var r,o=++e,l=0;;){var h=t.charAt(o);switch(h){case"=":if(1===l)r=t.slice(e,o),l=3;else{if(2!==l)throw new Error("attribute equal must after attrName");l=3}break;case"'":case'"':if(3===l||1===l){if(1===l&&(a.warning('attribute value must after "="'),r=t.slice(e,o)),e=o+1,!((o=t.indexOf(h,e))>0))throw new Error("attribute value no end '"+h+"' match");c=t.slice(e,o).replace(/&#?\w+;/g,n),i.add(r,c,e-1),l=5}else{if(4!=l)throw new Error('attribute value must after "="');c=t.slice(e,o).replace(/&#?\w+;/g,n),i.add(r,c,e),a.warning('attribute "'+r+'" missed start quot('+h+")!!"),e=o+1,l=5}break;case"/":switch(l){case 0:i.setTagName(t.slice(e,o));case 5:case 6:case 7:l=7,i.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return a.error("unexpected end of input"),0==l&&i.setTagName(t.slice(e,o)),o;case">":switch(l){case 0:i.setTagName(t.slice(e,o));case 5:case 6:case 7:break;case 4:case 1:"/"===(c=t.slice(e,o)).slice(-1)&&(i.closed=!0,c=c.slice(0,-1));case 2:2===l&&(c=r),4==l?(a.warning('attribute "'+c+'" missed quot(")!!'),i.add(r,c.replace(/&#?\w+;/g,n),e)):("http://www.w3.org/1999/xhtml"===s[""]&&c.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+c+'" missed value!! "'+c+'" instead!!'),i.add(c,c,e));break;case 3:throw new Error("attribute value missed!!")}return o;case"":h=" ";default:if(h<=" ")switch(l){case 0:i.setTagName(t.slice(e,o)),l=6;break;case 1:r=t.slice(e,o),l=2;break;case 4:var c=t.slice(e,o).replace(/&#?\w+;/g,n);a.warning('attribute "'+c+'" missed quot(")!!'),i.add(r,c,e);case 5:l=6}else switch(l){case 2:i.tagName,"http://www.w3.org/1999/xhtml"===s[""]&&r.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+r+'" missed value!! "'+r+'" instead2!!'),i.add(r,r,e),e=o,l=1;break;case 5:a.warning('attribute space is required"'+r+'"!!');case 6:l=1,e=o;break;case 3:l=4,e=o;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}o++}}function c(t,e,i){for(var s=t.tagName,n=null,a=t.length;a--;){var r=t[a],o=r.qName,l=r.value;if((u=o.indexOf(":"))>0)var h=r.prefix=o.slice(0,u),c=o.slice(u+1),d="xmlns"===h&&c;else c=o,h=null,d="xmlns"===o&&"";r.localName=c,!1!==d&&(null==n&&(n={},_(i,i={})),i[d]=n[d]=l,r.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(d,l))}for(a=t.length;a--;)(h=(r=t[a]).prefix)&&("xml"===h&&(r.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==h&&(r.uri=i[h||""]));var u;(u=s.indexOf(":"))>0?(h=t.prefix=s.slice(0,u),c=t.localName=s.slice(u+1)):(h=null,c=t.localName=s);var p=t.uri=i[h||""];if(e.startElement(p,c,s,t),!t.closed)return t.currentNSMap=i,t.localNSMap=n,!0;if(e.endElement(p,c,s),n)for(h in n)e.endPrefixMapping(h)}function d(t,e,i,s,n){if(/^(?:script|textarea)$/i.test(i)){var a=t.indexOf("</"+i+">",e),r=t.substring(e+1,a);if(/[&<]/.test(r))return/^script$/i.test(i)?(n.characters(r,0,r.length),a):(r=r.replace(/&#?\w+;/g,s),n.characters(r,0,r.length),a)}return e+1}function u(t,e,i,s){var n=s[i];return null==n&&((n=t.lastIndexOf("</"+i+">"))<e&&(n=t.lastIndexOf("</"+i)),s[i]=n),n<e}function _(t,e){for(var i in t)e[i]=t[i]}function p(t,e,i,s){if("-"===t.charAt(e+2))return"-"===t.charAt(e+3)?(n=t.indexOf("--\x3e",e+4))>e?(i.comment(t,e+4,n-e-4),n+3):(s.error("Unclosed comment"),-1):-1;if("CDATA["==t.substr(e+3,6)){var n=t.indexOf("]]>",e+9);return i.startCDATA(),i.characters(t,e+9,n-e-9),i.endCDATA(),n+3}var a=function(t,e){var i,s=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(n.lastIndex=e,n.exec(t);i=n.exec(t);)if(s.push(i),i[1])return s}(t,e),r=a.length;if(r>1&&/!doctype/i.test(a[0][0])){var o=a[1][0],l=r>3&&/^public$/i.test(a[2][0])&&a[3][0],h=r>4&&a[4][0],c=a[r-1];return i.startDTD(o,l&&l.replace(/^(['"])(.*?)\1$/,"$2"),h&&h.replace(/^(['"])(.*?)\1$/,"$2")),i.endDTD(),c.index+c[0].length}return-1}function f(t,e,i){var s=t.indexOf("?>",e);if(s){var n=t.substring(e,s).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return n?(n[0].length,i.processingInstruction(n[1],n[2]),s+2):-1}return-1}function g(t){}function m(t,e){return t.__proto__=e,t}r.prototype={parse:function(t,e,i){var s=this.domBuilder;s.startDocument(),_(e,e={}),o(t,e,i,s,this.errorHandler),s.endDocument()}},g.prototype={setTagName:function(t){if(!a.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},add:function(t,e,i){if(!a.test(t))throw new Error("invalid attribute:"+t);this[this.length++]={qName:t,value:e,offset:i}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}},m({},m.prototype)instanceof m||(m=function(t,e){function i(){}for(e in i.prototype=e,i=new i,t)i[e]=t[e];return i}),i.XMLReader=r},{}],"/src/js/index.js":[function(t,e,i){"use strict";var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=t("./templates"),a=t("docxtemplater").DocUtils,r=t("xmldom").DOMParser;var o=t("./imgManager"),l="open-xml-templating/docxtemplater-image-module";function h(t){return t.part}function c(t){var e=t.part,i=t.left,s=t.right,n=t.postparsed.slice(i+1,s).reduce((function(t,e){return t+e.value}),""),a=(new r).parseFromString("<xml>"+n+"</xml>"),o=a.getElementsByTagName("a:off"),l=a.getElementsByTagName("a:ext");return e.ext={cx:parseInt(l[0].getAttribute("cx"),10),cy:parseInt(l[0].getAttribute("cy"),10)},e.offset={x:parseInt(o[0].getAttribute("x"),10),y:parseInt(o[0].getAttribute("y"),10)},e}var d=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="ImageModule",this.options=e||{},this.imgManagers={},null==this.options.centered&&(this.options.centered=!1),null==this.options.getImage)throw new Error("You should pass getImage");if(null==this.options.getSize)throw new Error("You should pass getSize");this.imageNumber=1}return s(t,[{key:"optionsTransformer",value:function(t,e){var i=e.zip.file(/\.xml\.rels/).concat(e.zip.file(/\[Content_Types\].xml/)).map((function(t){return t.name}));return this.fileTypeConfig=e.fileTypeConfig,this.fileType=e.fileType,this.zip=e.zip,t.xmlFileNames=t.xmlFileNames.concat(i),t}},{key:"set",value:function(t){t.zip&&(this.zip=t.zip),t.xmlDocuments&&(this.xmlDocuments=t.xmlDocuments)}},{key:"parse",value:function(t){var e=l,i="placeholder";return"%%"===t.substring(0,2)?{type:i,value:t.substr(2),module:e,centered:!0}:"%"===t.substring(0,1)?{type:i,value:t.substr(1),module:e,centered:!1}:null}},{key:"postparse",value:function(t){var e=void 0,i=void 0;return"pptx"===this.fileType?(e="p:sp",i=c):(e=this.options.centered?"w:p":"w:t",i=h),a.traits.expandToOne(t,{moduleName:l,getInner:i,expandTo:e})}},{key:"render",value:function(t,e){this.imgManagers[e.filePath]=this.imgManagers[e.filePath]||new o(this.zip,e.filePath,this.xmlDocuments,this.fileType);var i=this.imgManagers[e.filePath];if("placeholder"===!t.type||t.module!==l)return null;try{var s=e.scopeManager.getValue(t.value);if(!s)throw new Error("tagValue is empty");var n=this.options.getImage(s,t.value),a=i.addImageRels(this.getNextImageName(),n),r=this.options.getSize(n,s,t.value);return this.getRenderedPart(t,a,r)}catch(t){return{value:this.fileTypeConfig.tagTextXml}}}},{key:"getRenderedPart",value:function(t,e,i){if((s=e)!=s)throw new Error("rId is NaN, aborting");var s,n=[a.convertPixelsToEmus(i[0]),a.convertPixelsToEmus(i[1])],r=this.options.centered||t.centered;return{value:"pptx"===this.fileType?this.getRenderedPartPptx(t,e,n,r):this.getRenderedPartDocx(e,n,r)}}},{key:"getRenderedPartPptx",value:function(t,e,i,s){var a={x:t.offset.x,y:t.offset.y},r=t.ext.cx,o=t.ext.cy,l=i[0],h=i[1];return s&&(a.x+=r/2-l/2,a.y+=o/2-h/2),n.getPptxImageXml(e,[l,h],a)}},{key:"getRenderedPartDocx",value:function(t,e,i){return i?n.getImageXmlCentered(t,e):n.getImageXml(t,e)}},{key:"getNextImageName",value:function(){var t="image_generated_"+this.imageNumber+".png";return this.imageNumber++,t}}]),t}();e.exports=d},{"./imgManager":2,"./templates":3,docxtemplater:5,xmldom:23}]},{},[])("/src/js/index.js")},49590:t=>{t.exports=function t(e,i,s){function n(r,o){if(!i[r]){if(!e[r]){if(a)return a(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[r]={exports:{}};e[r][0].call(h.exports,(function(t){return n(e[r][1][t]||t)}),h,h.exports,t,e,i,s)}return i[r].exports}for(var a=void 0,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(t,e,i){"use strict";var s=t("./memoize"),n=t("xmldom").DOMParser,a=t("xmldom").XMLSerializer,r=t("./errors"),o={};o.defaults={nullGetter:function(t){return t.module?(t.module,""):"undefined"},parser:s((function(t){return s=function(e){return"."===t?e:e[t]},(i="get")in(e={})?Object.defineProperty(e,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[i]=s,e;var e,i,s})),delimiters:{start:"{",end:"}"}},o.mergeObjects=function(){for(var t={},e=void 0,i=void 0,s=0;s<arguments.length;s+=1){e=arguments[s],i=Object.keys(e);for(var n=0;n<i.length;n+=1)t[i[n]]=e[i[n]]}return t},o.xml2str=function(t){return(new a).serializeToString(t)},o.decodeUtf8=function(t){try{if(void 0===t)return;return decodeURIComponent(escape(o.convertSpaces(t)))}catch(i){var e=new Error("End");throw e.properties.data=t,e.properties.explanation="Could not decode string to UTF8",e}},o.encodeUtf8=function(t){return unescape(encodeURIComponent(t))},o.str2xml=function(t,e){return new n({errorHandler:e}).parseFromString(t,"text/xml")},o.charMap={"&":"&amp;","'":"&apos;","<":"&lt;",">":"&gt;"};var l=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;o.escapeRegExp=function(t){return t.replace(l,"\\$&")},o.charMapRegexes=Object.keys(o.charMap).map((function(t){var e=o.charMap[t];return{rstart:new RegExp(o.escapeRegExp(e),"g"),rend:new RegExp(o.escapeRegExp(t),"g"),start:e,end:t}})),o.wordToUtf8=function(t){for(var e=void 0,i=0,s=o.charMapRegexes.length;i<s;i++)e=o.charMapRegexes[i],t=t.replace(e.rstart,e.end);return t},o.utf8ToWord=function(t){"string"!=typeof t&&(t=t.toString());for(var e=void 0,i=0,s=o.charMapRegexes.length;i<s;i++)e=o.charMapRegexes[i],t=t.replace(e.rend,e.start);return t},o.cloneDeep=function(t){return JSON.parse(JSON.stringify(t))},o.concatArrays=function(t){return t.reduce((function(t,e){return Array.prototype.push.apply(t,e),t}),[])};var h=new RegExp(String.fromCharCode(160),"g");function c(t){var e=new r.XTTemplateError("No tag '"+t.element+"' was found at the "+t.position);throw e.properties={id:"no_xml_tag_found_at_"+t.position,explanation:"No tag '"+t.element+"' was found at the "+t.position,parsed:t.parsed,index:t.index,element:t.element},e}o.convertSpaces=function(t){return t.replace(h," ")},o.pregMatchAll=function(t,e){for(var i=[],s=void 0;null!=(s=t.exec(e));)i.push({array:s,offset:s.index});return i},o.sizeOfObject=function(t){return Object.keys(t).length},o.getRight=function(t,e,i){for(var s=i,n=t.length;s<n;s++)if(t[s].value==="</"+e+">")return s;c({position:"right",element:e,parsed:t,index:i})},o.getLeft=function(t,e,i){for(var s=i;s>=0;s--){var n=t[s];if(0===n.value.indexOf("<"+e)&&-1!==[">"," "].indexOf(n.value[e.length+1]))return s}c({position:"left",element:e,parsed:t,index:i})},e.exports=o},{"./errors":2,"./memoize":5,xmldom:19}],2:[function(t,e,i){"use strict";function s(t){this.name="GenericError",this.message=t,this.stack=new Error(t).stack}function n(t){this.name="TemplateError",this.message=t,this.stack=new Error(t).stack}function a(t){this.name="ScopeParserError",this.message=t,this.stack=new Error(t).stack}function r(t){this.name="InternalError",this.properties={explanation:"InternalError"},this.message=t,this.stack=new Error(t).stack}s.prototype=Error.prototype,n.prototype=new s,a.prototype=new s,r.prototype=new s,e.exports={XTError:s,XTTemplateError:n,XTInternalError:r,XTScopeParserError:a}},{}],3:[function(t,e,i){"use strict";var s=t("./modules/loop"),n=t("./modules/space-preserve"),a=t("./modules/rawxml"),r=t("./modules/expand-pair-trait"),o=t("./modules/render"),l={getTemplatedFiles:function(t){return t.file(/ppt\/(slides|slideMasters)\/(slide|slideMaster)\d+\.xml/).map((function(t){return t.name})).concat(["ppt/presentation.xml"])},textPath:"ppt/slides/slide1.xml",tagsXmlTextArray:["a:t","m:t"],tagsXmlLexedArray:["p:sp","a:tc","a:tr","a:table","a:p","a:r"],tagRawXml:"p:sp",tagTextXml:"a:t",baseModules:[o,r,a,s]},h={getTemplatedFiles:function(t){return t.file(/word\/(header|footer)\d+\.xml/).map((function(t){return t.name})).concat(["word/document.xml"])},textPath:"word/document.xml",tagsXmlTextArray:["w:t","m:t"],tagsXmlLexedArray:["w:tc","w:tr","w:table","w:p","w:r"],tagRawXml:"w:p",tagTextXml:"w:t",baseModules:[o,n,r,a,s]};e.exports={docx:h,pptx:l}},{"./modules/expand-pair-trait":8,"./modules/loop":9,"./modules/rawxml":10,"./modules/render":11,"./modules/space-preserve":12}],4:[function(t,e,i){"use strict";var s=t("./errors"),n=t("./doc-utils");function a(t,e){return t[0]<=e.offset&&e.offset<t[1]}function r(t,e){if("tag"===t.type&&"start"===t.position&&t.text){if(e)throw new Error("Malformed xml : Already in text tag");return!0}if("tag"===t.type&&"end"===t.position&&t.text){if(!e)throw new Error("Malformed xml : Already not in text tag");return!1}return e}function o(t,e){return t.offset-e.offset}function l(t){var e=1;"/"===t[1]&&(e=2);var i=t.indexOf(" "),s=-1===i?t.length-1:i;return{tag:t.slice(e,s),position:1===e?"start":"end"}}function h(t){var e=new s.XTTemplateError("Unclosed tag");throw e.properties={xtag:t.xtag.split(" ")[0].substr(1),id:"unclosed_tag",context:t.xtag,explanation:"The tag beginning with '"+t.xtag.substr(0,10)+"' is unclosed"},e}function c(t,e){var i=!1,n={offset:0},a=void 0;t.forEach((function(t){a=e.substr(n.offset,t.offset-n.offset),("start"===t.position&&i||"end"===t.position&&!i)&&("start"===t.position?h({xtag:a}):function(t){var e=new s.XTTemplateError("Unopened tag");throw e.properties={xtag:t.xtag.split(" ")[0],id:"unopened_tag",context:t.xtag,explanation:"The tag beginning with '"+t.xtag.substr(0,10)+"' is unclosed"},e}({xtag:a})),i=!i,n=t}));var r=e.length;a=e.substr(n.offset,r-n.offset),i&&h({xtag:a})}function d(t,e,i){var s=[],n=-1;do{-1!==(n=t.indexOf(e,n+1))&&s.push({offset:n,position:i})}while(-1!==n);return s}function u(t){var e=this;this.innerContentParts=t,this.full="",this.parseDelimiters=function(t){e.full=e.innerContentParts.join("");var i=0;e.ranges=e.innerContentParts.map((function(t){return(i+=t.length)-t.length}));var s=n.concatArrays([d(e.full,t.start,"start"),d(e.full,t.end,"end")]).sort(o);c(s,e.full);var r={start:t.start.length,end:t.end.length},l=0,h=0;e.parsed=e.ranges.map((function(t,e){for(var i=[t,t+this.innerContentParts[e].length],n=this.innerContentParts[e],o=[];h<s.length&&a(i,s[h]);)o.push(s[h]),h++;var c=[],d=0;l>0&&(d=l,l=0),o.forEach((function(e){var i=n.substr(d,e.offset-t-d);i.length>0&&c.push({type:"content",value:i}),c.push({type:"delimiter",position:e.position}),d=e.offset-t+r[e.position]})),l=d-n.length;var u=n.substr(d);return u.length>0&&c.push({type:"content",value:u}),c}),e)}}e.exports={parse:function(t,e){var i=!1,s=[];t.forEach((function(t){(i=r(t,i))&&"content"===t.type&&s.push(t.value)}));var n=new u(s);n.parseDelimiters(e);var a=[],o=0;return t.forEach((function(t){i=r(t,i),"content"===t.type&&(t.position=i?"insidetag":"outsidetag"),i&&"content"===t.type?(Array.prototype.push.apply(a,n.parsed[o].map((function(t){return"content"===t.type&&(t.position="insidetag"),t}))),o++):a.push(t)})),a},xmlparse:function(t,e){var i=function(t,e,i){for(var s=0,a=t.length,r=n.concatArrays([e.map((function(t){return{tag:t,text:!0}})),i.map((function(t){return{tag:t,text:!1}}))]).reduce((function(t,e){return t[e.tag]=e.text,t}),{}),o=[];s<a&&-1!==(s=t.indexOf("<",s));){var h=s;s=t.indexOf(">",s);var c=t.slice(h,s+1),d=l(c),u=d.tag,_=d.position,p=r[u];null!=p&&o.push({type:"tag",position:_,text:p,offset:h,value:c})}return o}(t,e.text,e.other),s=0,a=i.reduce((function(e,i){var n=t.substr(s,i.offset-s);return n.length>0&&e.push({type:"content",value:n}),s=i.offset+i.value.length,delete i.offset,i.value.length>0&&e.push(i),e}),[]),r=t.substr(s);return r.length>0&&a.push({type:"content",value:r}),a}}},{"./doc-utils":1,"./errors":2}],5:[function(t,e,i){"use strict";e.exports=function(t){var e=JSON.stringify,i={};return function(){var s=e(arguments);return s in i?i[s]:i[s]=t.apply(this,arguments)}}},{}],6:[function(t,e,i){"use strict";function s(t,e){for(var i=-1,s=0,n=t.length;s<n;s++)e[s]>=t[s].length||(-1===i||t[s][e[s]].offset<t[i][e[i]].offset)&&(i=s);if(-1===i)throw new Error("minIndex negative");return i}e.exports=function(t){var e=t.reduce((function(t,e){return t+e.length}),0);t=t.filter((function(t){return t.length>0}));for(var i=new Array(e),n=t.map((function(){return 0})),a=0;a<=e-1;){var r=s(t,n);i[a]=t[r][n[r]],n[r]++,a++}return i}},{}],7:[function(t,e,i){"use strict";function s(){}function n(t){return t}e.exports=function(t){var e={set:s,parse:s,render:s,getTraits:s,optionsTransformer:n,getRenderedMap:n,postparse:n};if(Object.keys(e).every((function(e){return!t[e]})))throw new Error("This module cannot be wrapped, because it doesn't define any of the necessary functions");return Object.keys(e).forEach((function(i){t[i]=t[i]||e[i]})),t}},{}],8:[function(t,e,i){"use strict";var s=t("../mergesort"),n=t("../doc-utils"),a=t("../module-wrapper"),r=t("../traits").getExpandToDefault,o=t("../errors");function l(t){var e=t.tags,i=new o.XTTemplateError("Closing tag does not match opening tag");throw i.properties={id:"closing_tag_does_not_match_opening_tag",explanation:'The tag "'+e[0].value+'" is closed by the tag "'+e[1].value+'"',openingtag:e[0].value,closingtag:e[1].value},i}function h(t){switch(t.location){case"start":return 1;case"end":return-1;default:throw new Error("Location should be one of 'start' or 'end' (given : "+t.location+")")}}function c(t){if(0===t.length)return[];for(var e=1,i=t[0],s=1;s<t.length;s++){var n=t[s];if(0===(e+=h(n.part))){n.part.value!==i.part.value&&""!==n.part.value&&l({tags:[i.part,n.part]});var a=c(t.slice(s+1));return[[i,n]].concat(a)}}var r=i.part;!function(t){var e=t.location,i="start"===e?"unclosed":"unopened",s="start"===e?"Unclosed":"Unopened",n=new o.XTTemplateError(s+" loop"),a=t.part.value;throw n.properties={id:i+"_loop",explanation:"The loop with tag "+a+" is "+i,xtag:a},n}({part:r,location:r.location})}var d={name:"ExpandPairTrait",postparse:function(t,e){var i=e.getTraits,a=e.postparse,o=i("expandPair",t);o=o.map((function(t){return t||[]}));var l=c(o=s(o)),h=l.map((function(e){var i=e[0].part.expandTo;return"auto"===i&&(i=r(t.slice(e[0].offset,e[1].offset))),i?[n.getLeft(t,i,e[0].offset),n.getRight(t,i,e[1].offset)]:[e[0].offset,e[1].offset]})),d=0,u=void 0;return t.reduce((function(e,i,s){var n=d<l.length&&h[d][0]<=s,r=l[d],o=h[d];if(!n)return e.push(i),e;if(o[0]===s&&(u=[]),r[0].offset!==s&&r[1].offset!==s&&u.push(i),o[1]===s){var c=t[r[0].offset];delete c.location,delete c.expandTo,c.subparsed=a(u),e.push(c),d++}return e}),[])}};e.exports=function(){return a(d)}},{"../doc-utils":1,"../errors":2,"../mergesort":6,"../module-wrapper":7,"../traits":16}],9:[function(t,e,i){"use strict";var s=t("../doc-utils"),n=/^-([^\s]+)\s(.+)$/,a=t("../module-wrapper"),r="loop",o={name:"LoopModule",parse:function(t){var e=r,i="placeholder";return"#"===t[0]?{type:i,value:t.substr(1),expandTo:"auto",module:e,location:"start",inverted:!1}:"^"===t[0]?{type:i,value:t.substr(1),expandTo:"auto",module:e,location:"start",inverted:!0}:"/"===t[0]?{type:i,value:t.substr(1),module:e,location:"end"}:"-"===t[0]?{type:i,value:t.replace(n,"$2"),expandTo:t.replace(n,"$1"),module:e,location:"start",inverted:!1}:null},getTraits:function(t,e){if("expandPair"===t)return e.reduce((function(t,e,i){return"placeholder"===e.type&&e.module===r&&t.push({part:e,offset:i}),t}),[])},render:function(t,e){if("placeholder"===!t.type||t.module!==r)return null;var i=[];return e.scopeManager.loopOver(t.value,(function(n){var a=e.scopeManager.createSubScopeManager(n,t.value);i.push(e.render(s.mergeObjects({},e,{compiled:t.subparsed,tags:{},scopeManager:a})))}),t.inverted),{value:i.join("")}}};e.exports=function(){return a(o)}},{"../doc-utils":1,"../module-wrapper":7}],10:[function(t,e,i){"use strict";var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=t("../doc-utils"),a=t("../errors"),r="rawxml",o=t("../module-wrapper");function l(t){var e=t.part,i=t.left,s=t.right,n=t.postparsed,r=t.index,o=n.slice(i+1,s);return o.forEach((function(t,s){s!==r-i-1&&("placeholder"===t.type||"content"===t.type&&"insidetag"===t.position)&&function(t){var e=new a.XTTemplateError("Raw tag should be the only text in paragraph"),i=t.part.value;throw e.properties={id:"raw_xml_tag_should_be_only_text_in_paragraph",explanation:"The tag "+i,xtag:t.part.value,paragraphParts:t.paragraphParts},e}({paragraphParts:o,part:e})})),e}var h=function(){function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.name="RawXmlModule"}return s(t,[{key:"optionsTransformer",value:function(t,e){return this.fileTypeConfig=e.fileTypeConfig,t}},{key:"parse",value:function(t){return"@"!==t[0]?null:{type:"placeholder",value:t.substr(1),module:r}}},{key:"postparse",value:function(t){return n.traits.expandToOne(t,{moduleName:r,getInner:l,expandTo:this.fileTypeConfig.tagRawXml})}},{key:"render",value:function(t,e){if(t.module!==r)return null;var i=e.scopeManager.getValue(t.value);return null==i&&(i=e.nullGetter(t)),{value:i}}}]),t}();e.exports=function(){return o(new h)}},{"../doc-utils":1,"../errors":2,"../module-wrapper":7}],11:[function(t,e,i){"use strict";var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=t("../module-wrapper"),a=function(){function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.name="Render"}return s(t,[{key:"set",value:function(t){t.compiled&&(this.compiled=t.compiled),null!=t.data&&(this.data=t.data)}},{key:"getRenderedMap",value:function(t){var e=this;return Object.keys(this.compiled).reduce((function(t,i){return t[i]={from:i,data:e.data},t}),t)}}]),t}();e.exports=function(){return n(new a)}},{"../module-wrapper":7}],12:[function(t,e,i){"use strict";var s=t("../module-wrapper"),n={name:"SpacePreserveModule",postparse:function(t){var e=[],i=!1,s=t.reduce((function(t,s){return"tag"===s.type&&"start"===s.position&&s.text&&"<w:t>"===s.value&&(i=!0),i?("placeholder"!==s.type||s.module||(e[0].value='<w:t xml:space="preserve">'),e.push(s)):t.push(s),"tag"===s.type&&"end"===s.position&&s.text&&"</w:t>"===s.value&&(Array.prototype.push.apply(t,e),i=!1,e=[]),t}),[]);return Array.prototype.push.apply(s,e),s}};e.exports=function(){return s(n)}},{"../module-wrapper":7}],13:[function(t,e,i){"use strict";var s=t("./doc-utils"),n={postparse:function(t,e){function i(t,i){return e.map((function(e){return e.getTraits(t,i)}))}return function t(s){return e.reduce((function(e,s){return s.postparse(e,{postparse:t,getTraits:i})}),s)}(t)},parse:function(t,e){var i=!1,n=void 0,a=[];return t.reduce((function(t,r){return"delimiter"===r.type?(i="start"===r.position,"end"===r.position?(function(t,i){for(var s=void 0,n=0,a=e.length;n<a;n++)if(s=e[n].parse(t))return i.push(s),s;return null}(n=s.wordToUtf8(n),t)||t.push({type:"placeholder",value:n}),Array.prototype.push.apply(t,a),a=[],t):(n="",t)):i?("content"===r.type&&"insidetag"===r.position?n+=r.value:a.push(r),t):(t.push(r),t)}),[])}};e.exports=n},{"./doc-utils":1}],14:[function(t,e,i){"use strict";var s=t("./scope-manager"),n=t("./doc-utils");e.exports=function t(e){return e.render=t,e.modules=e.modules,e.scopeManager||(e.scopeManager=s.createBaseScopeManager(e)),e.compiled.map((function(t){var i=function(t,e){for(var i=void 0,s=0,n=e.modules.length;s<n;s++)if(i=e.modules[s].render(t,e))return i;return!1}(t,e);if(i)return i.value;if("placeholder"===t.type){var s=e.scopeManager.getValue(t.value);return null==s&&(s=e.nullGetter(t)),n.utf8ToWord(s)}if("content"===t.type||"tag"===t.type)return t.value;throw new Error('Unimplemented tag type "'+t.type+'"')})).join("")}},{"./doc-utils":1,"./scope-manager":15}],15:[function(t,e,i){"use strict";var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=t("./errors"),a=function(){function t(e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.scopePath=e.scopePath,this.scopeList=e.scopeList,this.parser=e.parser}return s(t,[{key:"loopOver",value:function(t,e,i){return i=i||!1,this.loopOverValue(this.getValue(t),e,i)}},{key:"functorIfInverted",value:function(t,e,i){t&&e(i)}},{key:"isValueFalsy",value:function(t,e){return null==t||!t||"[object Array]"===e&&0===t.length}},{key:"loopOverValue",value:function(t,e,i){var s=Object.prototype.toString.call(t),n=this.scopeList[this.num];if(this.isValueFalsy(t,s))return this.functorIfInverted(i,e,n);if("[object Array]"!==s)return"[object Object]"===s?this.functorIfInverted(!i,e,t):!0===t?this.functorIfInverted(!i,e,n):void 0;for(var a,r=0;r<t.length;r++)a=t[r],this.functorIfInverted(!i,e,a)}},{key:"getValue",value:function(t,e){this.num=null==e?this.scopeList.length-1:e;var i=void 0,s=void 0,a=void 0,r=this.scopeList[this.num];try{s=this.parser(t)}catch(e){throw(i=new n.XTScopeParserError("Scope parser compilation failed")).properties={id:"scopeparser_compilation_failed",tag:t,explanation:"The scope parser for the tag "+t+" failed to compile",rootError:e},i}try{a=s.get(r,{num:this.num,scopeList:this.scopeList})}catch(e){throw(i=new n.XTScopeParserError("Scope parser execution failed")).properties={id:"scopeparser_execution_failed",explanation:"The scope parser for the tag "+t+" failed to execute",scope:r,tag:t,rootError:e},i}return null==a&&this.num>0?this.getValue(t,this.num-1):a}},{key:"createSubScopeManager",value:function(e,i){var s={scopePath:this.scopePath.slice(0),scopeList:this.scopeList.slice(0)};return s.parser=this.parser,s.scopeList=this.scopeList.concat(e),s.scopePath=this.scopePath.concat(i),new t(s)}}]),t}();a.createBaseScopeManager=function(t){var e=t.parser,i=t.tags,s={parser:e,tags:i,scopePath:[]};return s.scopeList=[i],new a(s)},e.exports=a},{"./errors":2}],16:[function(t,e,i){"use strict";var s=t("./doc-utils"),n=t("./errors");function a(t,e){if(0===t.length)return!1;var i=t[t.length-1].tag.substr(1),s=e.substr(2,e.length-3);return 0===i.indexOf(s)}function r(t,e){return t.push({tag:e}),t}function o(t,e,i){var a=t.expandTo||i.expandTo,r=e.indexOf(t);if(!a)return e;var o=void 0,l=void 0;try{o=s.getRight(e,a,r),l=s.getLeft(e,a,r)}catch(i){throw i instanceof n.XTTemplateError&&function(t){var e=new n.XTTemplateError("Raw tag not in paragraph"),i=t.part.value;throw e.properties={id:"raw_tag_outerxml_invalid",explanation:'The tag "'+i+'"',rootError:t.rootError,xtag:i,postparsed:t.postparsed,expandTo:t.expandTo,index:t.index},e}({part:t,rootError:i,postparsed:e,expandTo:a,index:r}),i}var h=e.slice(l,r),c=e.slice(r+1,o+1),d=i.getInner({index:r,part:t,leftParts:h,rightParts:c,left:l,right:o,postparsed:e});return d.length||(d.expanded=[h,c],d=[d]),s.concatArrays([e.slice(0,l),d,e.slice(o+1)])}e.exports={expandToOne:function(t,e){return t.reduce((function(t,i){return"placeholder"===i.type&&i.module===e.moduleName&&t.push(i),t}),[]).forEach((function(i){t=o(i,t,e)})),t},getExpandToDefault:function(t){for(var e=function(t){for(var e,i=t.filter((function(t){return"tag"===t.type})).map((function(t){return t.value})),s=[],n=0;n<i.length;n++)"/"===(e=i[n])[1]?a(s,e)?s.pop():s=r(s,e):"/"!==e[e.length-1]&&(s=r(s,e));return s}(t),i=0;i<e.length;i++){var s=e[i];if(0===s.tag.indexOf("<w:tc"))return"w:tr";if(0===s.tag.indexOf("<a:tc"))return"a:tr"}return!1}}},{"./doc-utils":1,"./errors":2}],17:[function(t,e,i){"use strict";var s=t("./doc-utils");var n=t("./memoize")((function(t,e){var i={};i.content=t,i.tagsXmlArray=e,i.tagsXmlArrayJoined=i.tagsXmlArray.join("|");var n=new RegExp("(<(?:"+i.tagsXmlArrayJoined+")[^>]*>)([^<>]*)</(?:"+i.tagsXmlArrayJoined+")>","g");return i.matches=s.pregMatchAll(n,i.content),i.charactersAddedCumulative=i.matches.map((function(){return 0})),i.charactersAdded=i.matches.map((function(){return 0})),function(t){function e(){var e={array:Array.prototype.slice.call(arguments)};e.array.shift();var i=e.array[0]+e.array[1];e.array.unshift(i),e.array.pop();var s=e.array.pop();return e.offset=s,e.first=!0,t.matches.unshift(e),t.charactersAdded.unshift(0),t.charactersAddedCumulative.unshift(0)}-1===t.content.indexOf("<")&&-1===t.content.indexOf(">")&&t.content.replace(/^()([^<>]*)$/,e);var i=new RegExp("^()([^<]+)</(?:"+t.tagsXmlArrayJoined+")>");return t.content.replace(i,e),i=new RegExp("(<(?:"+t.tagsXmlArrayJoined+")[^>]*>)([^>]+)$"),t.content.replace(i,(function(){var e={array:Array.prototype.slice.call(arguments)};e.array.pop();var i=e.array.pop();return e.offset=i,e.last=!0,t.matches.push(e),t.charactersAdded.push(0),t.charactersAddedCumulative.push(0)})),t}(i)}));e.exports=function(t,e){return s.cloneDeep(n(t,e))}},{"./doc-utils":1,"./memoize":5}],18:[function(t,e,i){"use strict";var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=t("./doc-utils"),a=t("./scope-manager"),r=t("./xml-matcher"),o=t("./errors"),l=t("./lexer"),h=t("./parser.js"),c=t("./render.js");e.exports=function(){function t(e,i){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.fromJson(i),this.setModules({inspect:{filePath:this.filePath}}),this.load(e)}return s(t,[{key:"load",value:function(t){if("string"!=typeof t){var e=new o.XTInternalError("Content must be a string");throw e.properties.id="xmltemplater_content_must_be_string",e}this.content=t}},{key:"setTags",value:function(t){return this.tags=null!=t?t:{},this.scopeManager=a.createBaseScopeManager({tags:this.tags,parser:this.parser}),this}},{key:"fromJson",value:function(t){this.filePath=t.filePath,this.modules=t.modules,this.fileTypeConfig=t.fileTypeConfig,Object.keys(n.defaults).map((function(e){this[e]=null!=t[e]?t[e]:n.defaults[e]}),this)}},{key:"getFullText",value:function(){return t=this.content,e=this.fileTypeConfig.tagsXmlTextArray,i=r(t,e).matches.map((function(t){return t.array[2]})),n.wordToUtf8(n.convertSpaces(i.join("")));var t,e,i}},{key:"setModules",value:function(t){this.modules.forEach((function(e){e.set(t)}))}},{key:"parse",value:function(){return this.xmllexed=l.xmlparse(this.content,{text:this.fileTypeConfig.tagsXmlTextArray,other:this.fileTypeConfig.tagsXmlLexedArray}),this.setModules({inspect:{xmllexed:this.xmllexed}}),this.lexed=l.parse(this.xmllexed,this.delimiters),this.setModules({inspect:{lexed:this.lexed}}),this.parsed=h.parse(this.lexed,this.modules),this.setModules({inspect:{parsed:this.parsed}}),this.postparsed=h.postparse(this.parsed,this.modules),this}},{key:"render",value:function(t){return this.filePath=t,this.setModules({inspect:{postparsed:this.postparsed}}),this.content=c({compiled:this.postparsed,tags:this.tags,modules:this.modules,parser:this.parser,nullGetter:this.nullGetter,filePath:this.filePath}),this.setModules({inspect:{content:this.content}}),this}}]),t}()},{"./doc-utils":1,"./errors":2,"./lexer":4,"./parser.js":13,"./render.js":14,"./scope-manager":15,"./xml-matcher":17}],19:[function(t,e,i){function s(t){this.options=t||{locator:{}}}function n(){this.cdata=!1}function a(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function r(t){if(t)return"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}function o(t,e,i){return"string"==typeof t?t.substr(e,i):t.length>=e+i||e?new java.lang.String(t,e,i)+"":t}function l(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}s.prototype.parseFromString=function(t,e){var i=this.options,s=new h,a=i.domBuilder||new n,o=i.errorHandler,l=i.locator,c=i.xmlns||{},d={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return l&&a.setDocumentLocator(l),s.errorHandler=function(t,e,i){if(!t){if(e instanceof n)return e;t=e}var s={},a=t instanceof Function;function o(e){var n=t[e];!n&&a&&(n=2==t.length?function(i){t(e,i)}:t),s[e]=n&&function(t){n("[xmldom "+e+"]\t"+t+r(i))}||function(){}}return i=i||{},o("warning"),o("error"),o("fatalError"),s}(o,a,l),s.domBuilder=i.domBuilder||a,/\/x?html?$/.test(e)&&(d.nbsp=" ",d.copy="",c[""]="http://www.w3.org/1999/xhtml"),c.xml=c.xml||"http://www.w3.org/XML/1998/namespace",t?s.parse(t,c,d):s.errorHandler.error("invalid doc source"),a.doc},n.prototype={startDocument:function(){this.doc=(new c).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,i,s){var n=this.doc,r=n.createElementNS(t,i||e),o=s.length;l(this,r),this.currentElement=r,this.locator&&a(this.locator,r);for(var h=0;h<o;h++){t=s.getURI(h);var c=s.getValue(h),d=(i=s.getQName(h),n.createAttributeNS(t,i));this.locator&&a(s.getLocator(h),d),d.value=d.nodeValue=c,r.setAttributeNode(d)}},endElement:function(t,e,i){var s=this.currentElement;s.tagName,this.currentElement=s.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var i=this.doc.createProcessingInstruction(t,e);this.locator&&a(this.locator,i),l(this,i)},ignorableWhitespace:function(t,e,i){},characters:function(t,e,i){if(t=o.apply(this,arguments)){if(this.cdata)var s=this.doc.createCDATASection(t);else s=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(s):/^\s*$/.test(t)&&this.doc.appendChild(s),this.locator&&a(this.locator,s)}},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,i){t=o.apply(this,arguments);var s=this.doc.createComment(t);this.locator&&a(this.locator,s),l(this,s)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,i){var s=this.doc.implementation;if(s&&s.createDocumentType){var n=s.createDocumentType(t,e,i);this.locator&&a(this.locator,n),l(this,n)}},warning:function(t){console.warn("[xmldom warning]\t"+t,r(this.locator))},error:function(t){console.error("[xmldom error]\t"+t,r(this.locator))},fatalError:function(t){throw console.error("[xmldom fatalError]\t"+t,r(this.locator)),t}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(t){n.prototype[t]=function(){return null}}));var h=t("./sax").XMLReader,c=i.DOMImplementation=t("./dom").DOMImplementation;i.XMLSerializer=t("./dom").XMLSerializer,i.DOMParser=s},{"./dom":20,"./sax":21}],20:[function(t,e,i){function s(t,e){for(var i in t)e[i]=t[i]}function n(t,e){var i=t.prototype;if(Object.create){var n=Object.create(e.prototype);i.__proto__=n}if(!(i instanceof e)){function a(){}a.prototype=e.prototype,s(i,a=new a),t.prototype=i=a}i.constructor!=t&&("function"!=typeof t&&console.error("unknow Class:"+t),i.constructor=t)}var a={},r=a.ELEMENT_NODE=1,o=a.ATTRIBUTE_NODE=2,l=a.TEXT_NODE=3,h=a.CDATA_SECTION_NODE=4,c=a.ENTITY_REFERENCE_NODE=5,d=a.ENTITY_NODE=6,u=a.PROCESSING_INSTRUCTION_NODE=7,_=a.COMMENT_NODE=8,p=a.DOCUMENT_NODE=9,f=a.DOCUMENT_TYPE_NODE=10,g=a.DOCUMENT_FRAGMENT_NODE=11,m=a.NOTATION_NODE=12,v={},b={},w=(v.INDEX_SIZE_ERR=(b[1]="Index size error",1),v.DOMSTRING_SIZE_ERR=(b[2]="DOMString size error",2),v.HIERARCHY_REQUEST_ERR=(b[3]="Hierarchy request error",3)),y=(v.WRONG_DOCUMENT_ERR=(b[4]="Wrong document",4),v.INVALID_CHARACTER_ERR=(b[5]="Invalid character",5),v.NO_DATA_ALLOWED_ERR=(b[6]="No data allowed",6),v.NO_MODIFICATION_ALLOWED_ERR=(b[7]="No modification allowed",7),v.NOT_FOUND_ERR=(b[8]="Not found",8)),x=(v.NOT_SUPPORTED_ERR=(b[9]="Not supported",9),v.INUSE_ATTRIBUTE_ERR=(b[10]="Attribute in use",10));function k(t,e){if(e instanceof Error)var i=e;else i=this,Error.call(this,b[t]),this.message=b[t],Error.captureStackTrace&&Error.captureStackTrace(this,k);return i.code=t,e&&(this.message=this.message+": "+e),i}function C(){}function $(t,e){this._node=t,this._refresh=e,S(this)}function S(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!=e){var i=t._refresh(t._node);nt(t,"length",i.length),s(i,t),t._inc=e}}function I(){}function A(t,e){for(var i=t.length;i--;)if(t[i]===e)return i}function D(t,e,i,s){if(s?e[A(e,s)]=i:e[e.length++]=i,t){i.ownerElement=t;var n=t.ownerDocument;n&&(s&&P(n,t,s),function(t,e,i){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&(e._nsMap[i.prefix?i.localName:""]=i.value)}(n,t,i))}}function E(t,e,i){var s=A(e,i);if(!(s>=0))throw k(y,new Error(t.tagName+"@"+i));for(var n=e.length-1;s<n;)e[s]=e[++s];if(e.length=n,t){var a=t.ownerDocument;a&&(P(a,t,i),i.ownerElement=null)}}function j(t){if(this._features={},t)for(var e in t)this._features=t[e]}function V(){}function N(t){return("<"==t?"&lt;":">"==t&&"&gt;")||"&"==t&&"&amp;"||'"'==t&&"&quot;"||"&#"+t.charCodeAt()+";"}function T(t,e){if(e(t))return!0;if(t=t.firstChild)do{if(T(t,e))return!0}while(t=t.nextSibling)}function F(){}function P(t,e,i,s){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&delete e._nsMap[i.prefix?i.localName:""]}function B(t,e,i){if(t&&t._inc){t._inc++;var s=e.childNodes;if(i)s[s.length++]=i;else{for(var n=e.firstChild,a=0;n;)s[a++]=n,n=n.nextSibling;s.length=a}}}function M(t,e){var i=e.previousSibling,s=e.nextSibling;return i?i.nextSibling=s:t.firstChild=s,s?s.previousSibling=i:t.lastChild=i,B(t.ownerDocument,t),e}function O(t,e,i){var s=e.parentNode;if(s&&s.removeChild(e),e.nodeType===g){var n=e.firstChild;if(null==n)return e;var a=e.lastChild}else n=a=e;var r=i?i.previousSibling:t.lastChild;n.previousSibling=r,a.nextSibling=i,r?r.nextSibling=n:t.firstChild=n,null==i?t.lastChild=a:i.previousSibling=a;do{n.parentNode=t}while(n!==a&&(n=n.nextSibling));return B(t.ownerDocument||t,t),e.nodeType==g&&(e.firstChild=e.lastChild=null),e}function L(){this._nsMap={}}function R(){}function z(){}function H(){}function q(){}function U(){}function W(){}function Y(){}function G(){}function K(){}function X(){}function J(){}function Z(){}function Q(t,e){var i=[],s=9==this.nodeType?this.documentElement:this,n=s.prefix,a=s.namespaceURI;if(a&&null==n&&null==(n=s.lookupPrefix(a)))var r=[{namespace:a,prefix:null}];return et(this,i,t,e,r),i.join("")}function tt(t,e,i){var s=t.prefix||"",n=t.namespaceURI;if(!s&&!n)return!1;if("xml"===s&&"http://www.w3.org/XML/1998/namespace"===n||"http://www.w3.org/2000/xmlns/"==n)return!1;for(var a=i.length;a--;){var r=i[a];if(r.prefix==s)return r.namespace!=n}return!0}function et(t,e,i,s,n){if(s){if(!(t=s(t)))return;if("string"==typeof t)return void e.push(t)}switch(t.nodeType){case r:n||(n=[]),n.length;var a=t.attributes,d=a.length,m=t.firstChild,v=t.tagName;i="http://www.w3.org/1999/xhtml"===t.namespaceURI||i,e.push("<",v);for(var b=0;b<d;b++)"xmlns"==(w=a.item(b)).prefix?n.push({prefix:w.localName,namespace:w.value}):"xmlns"==w.nodeName&&n.push({prefix:"",namespace:w.value});for(b=0;b<d;b++){var w;if(tt(w=a.item(b),0,n)){var y=w.prefix||"",x=w.namespaceURI,k=y?" xmlns:"+y:" xmlns";e.push(k,'="',x,'"'),n.push({prefix:y,namespace:x})}et(w,e,i,s,n)}if(tt(t,0,n)&&(y=t.prefix||"",x=t.namespaceURI,k=y?" xmlns:"+y:" xmlns",e.push(k,'="',x,'"'),n.push({prefix:y,namespace:x})),m||i&&!/^(?:meta|link|img|br|hr|input)$/i.test(v)){if(e.push(">"),i&&/^script$/i.test(v))for(;m;)m.data?e.push(m.data):et(m,e,i,s,n),m=m.nextSibling;else for(;m;)et(m,e,i,s,n),m=m.nextSibling;e.push("</",v,">")}else e.push("/>");return;case p:case g:for(m=t.firstChild;m;)et(m,e,i,s,n),m=m.nextSibling;return;case o:return e.push(" ",t.name,'="',t.value.replace(/[<&"]/g,N),'"');case l:return e.push(t.data.replace(/[<&]/g,N));case h:return e.push("<![CDATA[",t.data,"]]>");case _:return e.push("\x3c!--",t.data,"--\x3e");case f:var C=t.publicId,$=t.systemId;if(e.push("<!DOCTYPE ",t.name),C)e.push(' PUBLIC "',C),$&&"."!=$&&e.push('" "',$),e.push('">');else if($&&"."!=$)e.push(' SYSTEM "',$,'">');else{var S=t.internalSubset;S&&e.push(" [",S,"]"),e.push(">")}return;case u:return e.push("<?",t.target," ",t.data,"?>");case c:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function it(t,e,i){var s;switch(e.nodeType){case r:(s=e.cloneNode(!1)).ownerDocument=t;case g:break;case o:i=!0}if(s||(s=e.cloneNode(!1)),s.ownerDocument=t,s.parentNode=null,i)for(var n=e.firstChild;n;)s.appendChild(it(t,n,i)),n=n.nextSibling;return s}function st(t,e,i){var s=new e.constructor;for(var n in e){var a=e[n];"object"!=typeof a&&a!=s[n]&&(s[n]=a)}switch(e.childNodes&&(s.childNodes=new C),s.ownerDocument=t,s.nodeType){case r:var l=e.attributes,h=s.attributes=new I,c=l.length;h._ownerElement=s;for(var d=0;d<c;d++)s.setAttributeNode(st(t,l.item(d),!0));break;case o:i=!0}if(i)for(var u=e.firstChild;u;)s.appendChild(st(t,u,i)),u=u.nextSibling;return s}function nt(t,e,i){t[e]=i}v.INVALID_STATE_ERR=(b[11]="Invalid state",11),v.SYNTAX_ERR=(b[12]="Syntax error",12),v.INVALID_MODIFICATION_ERR=(b[13]="Invalid modification",13),v.NAMESPACE_ERR=(b[14]="Invalid namespace",14),v.INVALID_ACCESS_ERR=(b[15]="Invalid access",15),k.prototype=Error.prototype,s(v,k),C.prototype={length:0,item:function(t){return this[t]||null},toString:function(t,e){for(var i=[],s=0;s<this.length;s++)et(this[s],i,t,e);return i.join("")}},$.prototype.item=function(t){return S(this),this[t]},n($,C),I.prototype={length:0,item:C.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var i=this[e];if(i.nodeName==t)return i}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new k(x);var i=this.getNamedItem(t.nodeName);return D(this._ownerElement,this,t,i),i},setNamedItemNS:function(t){var e,i=t.ownerElement;if(i&&i!=this._ownerElement)throw new k(x);return e=this.getNamedItemNS(t.namespaceURI,t.localName),D(this._ownerElement,this,t,e),e},removeNamedItem:function(t){var e=this.getNamedItem(t);return E(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var i=this.getNamedItemNS(t,e);return E(this._ownerElement,this,i),i},getNamedItemNS:function(t,e){for(var i=this.length;i--;){var s=this[i];if(s.localName==e&&s.namespaceURI==t)return s}return null}},j.prototype={hasFeature:function(t,e){var i=this._features[t.toLowerCase()];return!(!i||e&&!(e in i))},createDocument:function(t,e,i){var s=new F;if(s.implementation=this,s.childNodes=new C,s.doctype=i,i&&s.appendChild(i),e){var n=s.createElementNS(t,e);s.appendChild(n)}return s},createDocumentType:function(t,e,i){var s=new W;return s.name=t,s.nodeName=t,s.publicId=e,s.systemId=i,s}},V.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return O(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return M(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(t){return st(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==l&&t.nodeType==l?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(t){for(var e=this;e;){var i=e._nsMap;if(i)for(var s in i)if(i[s]==t)return s;e=e.nodeType==o?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var i=e._nsMap;if(i&&t in i)return i[t];e=e.nodeType==o?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){return null==this.lookupPrefix(t)}},s(a,V),s(a,V.prototype),F.prototype={nodeName:"#document",nodeType:p,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType==g){for(var i=t.firstChild;i;){var s=i.nextSibling;this.insertBefore(i,e),i=s}return t}return null==this.documentElement&&t.nodeType==r&&(this.documentElement=t),O(this,t,e),t.ownerDocument=this,t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),M(this,t)},importNode:function(t,e){return it(this,t,e)},getElementById:function(t){var e=null;return T(this.documentElement,(function(i){if(i.nodeType==r&&i.getAttribute("id")==t)return e=i,!0})),e},createElement:function(t){var e=new L;return e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new C,(e.attributes=new I)._ownerElement=e,e},createDocumentFragment:function(){var t=new X;return t.ownerDocument=this,t.childNodes=new C,t},createTextNode:function(t){var e=new H;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new q;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new U;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var i=new J;return i.ownerDocument=this,i.tagName=i.target=t,i.nodeValue=i.data=e,i},createAttribute:function(t){var e=new R;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new K;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var i=new L,s=e.split(":"),n=i.attributes=new I;return i.childNodes=new C,i.ownerDocument=this,i.nodeName=e,i.tagName=e,i.namespaceURI=t,2==s.length?(i.prefix=s[0],i.localName=s[1]):i.localName=e,n._ownerElement=i,i},createAttributeNS:function(t,e){var i=new R,s=e.split(":");return i.ownerDocument=this,i.nodeName=e,i.name=e,i.namespaceURI=t,i.specified=!0,2==s.length?(i.prefix=s[0],i.localName=s[1]):i.localName=e,i}},n(F,V),L.prototype={nodeType:r,hasAttribute:function(t){return null!=this.getAttributeNode(t)},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var i=this.ownerDocument.createAttribute(t);i.value=i.nodeValue=""+e,this.setAttributeNode(i)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===g?this.insertBefore(t,null):function(t,e){var i=e.parentNode;if(i){var s=t.lastChild;i.removeChild(e),s=t.lastChild}return s=t.lastChild,e.parentNode=t,e.previousSibling=s,e.nextSibling=null,s?s.nextSibling=e:t.firstChild=e,t.lastChild=e,B(t.ownerDocument,t,e),e}(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var i=this.getAttributeNodeNS(t,e);i&&this.removeAttributeNode(i)},hasAttributeNS:function(t,e){return null!=this.getAttributeNodeNS(t,e)},getAttributeNS:function(t,e){var i=this.getAttributeNodeNS(t,e);return i&&i.value||""},setAttributeNS:function(t,e,i){var s=this.ownerDocument.createAttributeNS(t,e);s.value=s.nodeValue=""+i,this.setAttributeNode(s)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(t){return new $(this,(function(e){var i=[];return T(e,(function(s){s===e||s.nodeType!=r||"*"!==t&&s.tagName!=t||i.push(s)})),i}))},getElementsByTagNameNS:function(t,e){return new $(this,(function(i){var s=[];return T(i,(function(n){n===i||n.nodeType!==r||"*"!==t&&n.namespaceURI!==t||"*"!==e&&n.localName!=e||s.push(n)})),s}))}},F.prototype.getElementsByTagName=L.prototype.getElementsByTagName,F.prototype.getElementsByTagNameNS=L.prototype.getElementsByTagNameNS,n(L,V),R.prototype.nodeType=o,n(R,V),z.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(b[w])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,i){i=this.data.substring(0,t)+i+this.data.substring(t+e),this.nodeValue=this.data=i,this.length=i.length}},n(z,V),H.prototype={nodeName:"#text",nodeType:l,splitText:function(t){var e=this.data,i=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var s=this.ownerDocument.createTextNode(i);return this.parentNode&&this.parentNode.insertBefore(s,this.nextSibling),s}},n(H,z),q.prototype={nodeName:"#comment",nodeType:_},n(q,z),U.prototype={nodeName:"#cdata-section",nodeType:h},n(U,z),W.prototype.nodeType=f,n(W,V),Y.prototype.nodeType=m,n(Y,V),G.prototype.nodeType=d,n(G,V),K.prototype.nodeType=c,n(K,V),X.prototype.nodeName="#document-fragment",X.prototype.nodeType=g,n(X,V),J.prototype.nodeType=u,n(J,V),Z.prototype.serializeToString=function(t,e,i){return Q.call(t,e,i)},V.prototype.toString=Q;try{if(Object.defineProperty){function at(t){switch(t.nodeType){case r:case g:var e=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&e.push(at(t)),t=t.nextSibling;return e.join("");default:return t.nodeValue}}Object.defineProperty($.prototype,"length",{get:function(){return S(this),this.$$length}}),Object.defineProperty(V.prototype,"textContent",{get:function(){return at(this)},set:function(t){switch(this.nodeType){case r:case g:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),nt=function(t,e,i){t["$$"+e]=i}}}catch(rt){}i.DOMImplementation=j,i.XMLSerializer=Z},{}],21:[function(t,e,i){var s=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,n=new RegExp("[\\-\\.0-9"+s.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),a=new RegExp("^"+s.source+n.source+"*(?::"+s.source+n.source+"*)?$");function r(){}function o(t,e,i,s,n){function a(t){var e=t.slice(1,-1);return e in i?i[e]:"#"===e.charAt(0)?function(t){if(t>65535){var e=55296+((t-=65536)>>10),i=56320+(1023&t);return String.fromCharCode(e,i)}return String.fromCharCode(t)}(parseInt(e.substr(1).replace("x","0x"))):(n.error("entity not found:"+t),t)}function r(e){if(e>x){var i=t.substring(x,e).replace(/&#?\w+;/g,a);b&&o(x),s.characters(i,0,e-x),x=e}}function o(e,i){for(;e>=m&&(i=v.exec(t));)_=i.index,m=_+i[0].length,b.lineNumber++;b.columnNumber=e-_+1}for(var _=0,m=0,v=/.*(?:\r\n?|\n)|.*$/g,b=s.locator,w=[{currentNSMap:e}],y={},x=0;;){try{var k=t.indexOf("<",x);if(k<0){if(!t.substr(x).match(/^\s*$/)){var C=s.doc,$=C.createTextNode(t.substr(x));C.appendChild($),s.currentElement=$}return}switch(k>x&&r(k),t.charAt(k+1)){case"/":var S=t.indexOf(">",k+3),I=t.substring(k+2,S),A=w.pop();S<0?(I=t.substring(k+2).replace(/[\s<].*/,""),n.error("end tag name: "+I+" is not complete:"+A.tagName),S=k+1+I.length):I.match(/\s</)&&(I=I.replace(/[\s<].*/,""),n.error("end tag name: "+I+" maybe not complete"),S=k+1+I.length);var D=A.localNSMap,E=A.tagName==I;if(E||A.tagName&&A.tagName.toLowerCase()==I.toLowerCase()){if(s.endElement(A.uri,A.localName,I),D)for(var j in D)s.endPrefixMapping(j);E||n.fatalError("end tag name: "+I+" is not match the current start tagName:"+A.tagName)}else w.push(A);S++;break;case"?":b&&o(k),S=f(t,k,s);break;case"!":b&&o(k),S=p(t,k,s,n);break;default:b&&o(k);var V=new g,N=w[w.length-1].currentNSMap,T=(S=h(t,k,V,N,a,n),V.length);if(!V.closed&&u(t,S,V.tagName,y)&&(V.closed=!0,i.nbsp||n.warning("unclosed xml attribute")),b&&T){for(var F=l(b,{}),P=0;P<T;P++){var B=V[P];o(B.offset),B.locator=l(b,{})}s.locator=F,c(V,s,N)&&w.push(V),s.locator=b}else c(V,s,N)&&w.push(V);"http://www.w3.org/1999/xhtml"!==V.uri||V.closed?S++:S=d(t,S,V.tagName,a,s)}}catch(t){n.error("element parse error: "+t),S=-1}S>x?x=S:r(Math.max(k,x)+1)}}function l(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function h(t,e,i,s,n,a){for(var r,o=++e,l=0;;){var h=t.charAt(o);switch(h){case"=":if(1===l)r=t.slice(e,o),l=3;else{if(2!==l)throw new Error("attribute equal must after attrName");l=3}break;case"'":case'"':if(3===l||1===l){if(1===l&&(a.warning('attribute value must after "="'),r=t.slice(e,o)),e=o+1,!((o=t.indexOf(h,e))>0))throw new Error("attribute value no end '"+h+"' match");c=t.slice(e,o).replace(/&#?\w+;/g,n),i.add(r,c,e-1),l=5}else{if(4!=l)throw new Error('attribute value must after "="');c=t.slice(e,o).replace(/&#?\w+;/g,n),i.add(r,c,e),a.warning('attribute "'+r+'" missed start quot('+h+")!!"),e=o+1,l=5}break;case"/":switch(l){case 0:i.setTagName(t.slice(e,o));case 5:case 6:case 7:l=7,i.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return a.error("unexpected end of input"),0==l&&i.setTagName(t.slice(e,o)),o;case">":switch(l){case 0:i.setTagName(t.slice(e,o));case 5:case 6:case 7:break;case 4:case 1:"/"===(c=t.slice(e,o)).slice(-1)&&(i.closed=!0,c=c.slice(0,-1));case 2:2===l&&(c=r),4==l?(a.warning('attribute "'+c+'" missed quot(")!!'),i.add(r,c.replace(/&#?\w+;/g,n),e)):("http://www.w3.org/1999/xhtml"===s[""]&&c.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+c+'" missed value!! "'+c+'" instead!!'),i.add(c,c,e));break;case 3:throw new Error("attribute value missed!!")}return o;case"":h=" ";default:if(h<=" ")switch(l){case 0:i.setTagName(t.slice(e,o)),l=6;break;case 1:r=t.slice(e,o),l=2;break;case 4:var c=t.slice(e,o).replace(/&#?\w+;/g,n);a.warning('attribute "'+c+'" missed quot(")!!'),i.add(r,c,e);case 5:l=6}else switch(l){case 2:i.tagName,"http://www.w3.org/1999/xhtml"===s[""]&&r.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+r+'" missed value!! "'+r+'" instead2!!'),i.add(r,r,e),e=o,l=1;break;case 5:a.warning('attribute space is required"'+r+'"!!');case 6:l=1,e=o;break;case 3:l=4,e=o;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}o++}}function c(t,e,i){for(var s=t.tagName,n=null,a=t.length;a--;){var r=t[a],o=r.qName,l=r.value;if((u=o.indexOf(":"))>0)var h=r.prefix=o.slice(0,u),c=o.slice(u+1),d="xmlns"===h&&c;else c=o,h=null,d="xmlns"===o&&"";r.localName=c,!1!==d&&(null==n&&(n={},_(i,i={})),i[d]=n[d]=l,r.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(d,l))}for(a=t.length;a--;)(h=(r=t[a]).prefix)&&("xml"===h&&(r.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==h&&(r.uri=i[h||""]));var u;(u=s.indexOf(":"))>0?(h=t.prefix=s.slice(0,u),c=t.localName=s.slice(u+1)):(h=null,c=t.localName=s);var p=t.uri=i[h||""];if(e.startElement(p,c,s,t),!t.closed)return t.currentNSMap=i,t.localNSMap=n,!0;if(e.endElement(p,c,s),n)for(h in n)e.endPrefixMapping(h)}function d(t,e,i,s,n){if(/^(?:script|textarea)$/i.test(i)){var a=t.indexOf("</"+i+">",e),r=t.substring(e+1,a);if(/[&<]/.test(r))return/^script$/i.test(i)?(n.characters(r,0,r.length),a):(r=r.replace(/&#?\w+;/g,s),n.characters(r,0,r.length),a)}return e+1}function u(t,e,i,s){var n=s[i];return null==n&&((n=t.lastIndexOf("</"+i+">"))<e&&(n=t.lastIndexOf("</"+i)),s[i]=n),n<e}function _(t,e){for(var i in t)e[i]=t[i]}function p(t,e,i,s){if("-"===t.charAt(e+2))return"-"===t.charAt(e+3)?(n=t.indexOf("--\x3e",e+4))>e?(i.comment(t,e+4,n-e-4),n+3):(s.error("Unclosed comment"),-1):-1;if("CDATA["==t.substr(e+3,6)){var n=t.indexOf("]]>",e+9);return i.startCDATA(),i.characters(t,e+9,n-e-9),i.endCDATA(),n+3}var a=function(t,e){var i,s=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(n.lastIndex=e,n.exec(t);i=n.exec(t);)if(s.push(i),i[1])return s}(t,e),r=a.length;if(r>1&&/!doctype/i.test(a[0][0])){var o=a[1][0],l=r>3&&/^public$/i.test(a[2][0])&&a[3][0],h=r>4&&a[4][0],c=a[r-1];return i.startDTD(o,l&&l.replace(/^(['"])(.*?)\1$/,"$2"),h&&h.replace(/^(['"])(.*?)\1$/,"$2")),i.endDTD(),c.index+c[0].length}return-1}function f(t,e,i){var s=t.indexOf("?>",e);if(s){var n=t.substring(e,s).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return n?(n[0].length,i.processingInstruction(n[1],n[2]),s+2):-1}return-1}function g(t){}function m(t,e){return t.__proto__=e,t}r.prototype={parse:function(t,e,i){var s=this.domBuilder;s.startDocument(),_(e,e={}),o(t,e,i,s,this.errorHandler),s.endDocument()}},g.prototype={setTagName:function(t){if(!a.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},add:function(t,e,i){if(!a.test(t))throw new Error("invalid attribute:"+t);this[this.length++]={qName:t,value:e,offset:i}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}},m({},m.prototype)instanceof m||(m=function(t,e){function i(){}for(e in i.prototype=e,i=new i,t)i[e]=t[e];return i}),i.XMLReader=r},{}],"/src/js/docxtemplater.js":[function(t,e,i){"use strict";var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=t("./doc-utils");a.traits=t("./traits"),a.moduleWrapper=t("./module-wrapper");var r=a.moduleWrapper,o=function(){function t(){if(n(this,t),arguments.length>0)throw new Error("The constructor with parameters have been removed in docxtemplater 3.0, please check the upgrade guide.");this.compiled={},this.modules=[],this.setOptions({})}return s(t,[{key:"attachModule",value:function(t){return this.modules.push(r(t)),this}},{key:"setOptions",value:function(t){var e=this;return this.options=t,Object.keys(a.defaults).forEach((function(t){var i=a.defaults[t];e[t]=null!=e.options[t]?e.options[t]:i})),this.zip&&this.updateFileTypeConfig(),this}},{key:"loadZip",value:function(t){if(t.loadAsync)throw new Error("Docxtemplater doesn't handle JSZip version >=3, see changelog");return this.zip=t,this.updateFileTypeConfig(),this}},{key:"compileFile",value:function(t){var e=this.createTemplateClass(t);e.parse(),this.compiled[t]=e}},{key:"compile",value:function(){return this.templatedFiles=this.fileTypeConfig.getTemplatedFiles(this.zip),this}},{key:"updateFileTypeConfig",value:function(){return this.fileType=this.zip.files["word/document.xml"]?"docx":"pptx",this.fileTypeConfig=this.options.fileTypeConfig||t.FileTypeConfig[this.fileType],this}},{key:"render",value:function(){var t=this;return this.options.xmlFileNames=[],this.modules=this.fileTypeConfig.baseModules.map((function(t){return t()})).concat(this.modules),this.options=this.modules.reduce((function(e,i){return i.optionsTransformer(e,t)}),this.options),this.xmlDocuments=this.options.xmlFileNames.reduce((function(e,i){var s=t.zip.files[i].asText();return e[i]=a.str2xml(s),e}),{}),this.modules.forEach((function(e){e.set({zip:t.zip,xmlDocuments:t.xmlDocuments,data:t.data})})),this.compile(),this.modules.forEach((function(e){e.set({compiled:t.compiled})})),this.templatedFiles.forEach((function(e){null!=t.zip.files[e]&&t.compileFile(e)})),this.mapper=this.modules.reduce((function(t,e){return e.getRenderedMap(t)}),{}),Object.keys(this.mapper).forEach((function(e){var i=t.mapper[e],s=i.from,n=t.compiled[s];n.setTags(i.data),n.render(e),t.zip.file(e,n.content)})),Object.keys(this.xmlDocuments).forEach((function(e){t.zip.remove(e);var i=a.xml2str(t.xmlDocuments[e]);return t.zip.file(e,i,{})})),this}},{key:"setData",value:function(t){return this.data=t,this}},{key:"getZip",value:function(){return this.zip}},{key:"createTemplateClass",value:function(t){var e=this.zip.files[t].asText();return this.createTemplateClassFromContent(e,t)}},{key:"createTemplateClassFromContent",value:function(e,i){var s=this,n={filePath:i};return Object.keys(a.defaults).forEach((function(t){n[t]=s[t]})),n.fileTypeConfig=this.fileTypeConfig,n.modules=this.modules,new t.XmlTemplater(e,n)}},{key:"getFullText",value:function(t){return this.createTemplateClass(t||this.fileTypeConfig.textPath).getFullText()}},{key:"getTemplatedFiles",value:function(){return this.compile(),this.templatedFiles}}]),t}();o.DocUtils=t("./doc-utils"),o.Errors=t("./errors"),o.XmlTemplater=t("./xml-templater"),o.FileTypeConfig=t("./file-type-config"),o.XmlMatcher=t("./xml-matcher"),e.exports=o},{"./doc-utils":1,"./errors":2,"./file-type-config":3,"./module-wrapper":7,"./traits":16,"./xml-matcher":17,"./xml-templater":18}]},{},[])("/src/js/docxtemplater.js")},31290:t=>{t.exports=function t(e,i,s){function n(r,o){if(!i[r]){if(!e[r]){if(a)return a(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[r]={exports:{}};e[r][0].call(h.exports,(function(t){return n(e[r][1][t]||t)}),h,h.exports,t,e,i,s)}return i[r].exports}for(var a=void 0,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(t,e,i){"use strict";function s(t){if(t){this.data=t,this.length=this.data.length,this.index=0,this.zero=0;for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}}var n=t("./dataReader");s.prototype=new n,s.prototype.byteAt=function(t){return this.data[this.zero+t]},s.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),i=t.charCodeAt(1),s=t.charCodeAt(2),n=t.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===e&&this.data[a+1]===i&&this.data[a+2]===s&&this.data[a+3]===n)return a-this.zero;return-1},s.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"./dataReader":6}],2:[function(t,e,i){"use strict";var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(t,e){for(var i,n,a,r,o,l,h,c="",d=0;d<t.length;)r=(i=t.charCodeAt(d++))>>2,o=(3&i)<<4|(n=t.charCodeAt(d++))>>4,l=(15&n)<<2|(a=t.charCodeAt(d++))>>6,h=63&a,isNaN(n)?l=h=64:isNaN(a)&&(h=64),c=c+s.charAt(r)+s.charAt(o)+s.charAt(l)+s.charAt(h);return c},i.decode=function(t,e){var i,n,a,r,o,l,h="",c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)i=s.indexOf(t.charAt(c++))<<2|(r=s.indexOf(t.charAt(c++)))>>4,n=(15&r)<<4|(o=s.indexOf(t.charAt(c++)))>>2,a=(3&o)<<6|(l=s.indexOf(t.charAt(c++))),h+=String.fromCharCode(i),64!=o&&(h+=String.fromCharCode(n)),64!=l&&(h+=String.fromCharCode(a));return h}},{}],3:[function(t,e,i){"use strict";function s(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}s.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},e.exports=s},{}],4:[function(t,e,i){"use strict";i.STORE={magic:"\0\0",compress:function(t,e){return t},uncompress:function(t){return t},compressInputType:null,uncompressInputType:null},i.DEFLATE=t("./flate")},{"./flate":9}],5:[function(t,e,i){"use strict";var s=t("./utils"),n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];e.exports=function(t,e){if(void 0===t||!t.length)return 0;var i="string"!==s.getTypeOf(t);void 0===e&&(e=0);var a=0;e^=-1;for(var r=0,o=t.length;r<o;r++)a=i?t[r]:t.charCodeAt(r),e=e>>>8^n[255&(e^a)];return-1^e}},{"./utils":22}],6:[function(t,e,i){"use strict";function s(t){this.data=null,this.length=0,this.index=0,this.zero=0}var n=t("./utils");s.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,i=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)i=(i<<8)+this.byteAt(e);return this.index+=t,i},readString:function(t){return n.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1)}},e.exports=s},{"./utils":22}],7:[function(t,e,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!1,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],8:[function(t,e,i){"use strict";var s=t("./utils");i.string2binary=function(t){return s.string2binary(t)},i.string2Uint8Array=function(t){return s.transformTo("uint8array",t)},i.uint8Array2String=function(t){return s.transformTo("string",t)},i.string2Blob=function(t){var e=s.transformTo("arraybuffer",t);return s.arrayBuffer2Blob(e)},i.arrayBuffer2Blob=function(t){return s.arrayBuffer2Blob(t)},i.transformTo=function(t,e){return s.transformTo(t,e)},i.getTypeOf=function(t){return s.getTypeOf(t)},i.checkSupport=function(t){return s.checkSupport(t)},i.MAX_VALUE_16BITS=s.MAX_VALUE_16BITS,i.MAX_VALUE_32BITS=s.MAX_VALUE_32BITS,i.pretty=function(t){return s.pretty(t)},i.findCompression=function(t){return s.findCompression(t)},i.isRegExp=function(t){return s.isRegExp(t)}},{"./utils":22}],9:[function(t,e,i){"use strict";var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=t("pako");i.uncompressInputType=s?"uint8array":"array",i.compressInputType=s?"uint8array":"array",i.magic="\b\0",i.compress=function(t,e){return n.deflateRaw(t,{level:e.level||-1})},i.uncompress=function(t){return n.inflateRaw(t)}},{pako:25}],10:[function(t,e,i){"use strict";function s(t,e){return this instanceof s?(this.files={},this.comment=null,this.root="",t&&this.load(t,e),void(this.clone=function(){var t=new s;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t})):new s(t,e)}var n=t("./base64");s.prototype=t("./object"),s.prototype.load=t("./load"),s.support=t("./support"),s.defaults=t("./defaults"),s.utils=t("./deprecatedPublicUtils"),s.base64={encode:function(t){return n.encode(t)},decode:function(t){return n.decode(t)}},s.compressions=t("./compressions"),e.exports=s},{"./base64":2,"./compressions":4,"./defaults":7,"./deprecatedPublicUtils":8,"./load":11,"./object":14,"./support":18}],11:[function(t,e,i){"use strict";var s=t("./base64"),n=t("./utf8"),a=t("./utils"),r=t("./zipEntries");e.exports=function(t,e){var i,o,l,h;for((e=a.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode})).base64&&(t=s.decode(t)),i=(o=new r(t,e)).files,l=0;l<i.length;l++)h=i[l],this.file(h.fileNameStr,h.decompressed,{binary:!0,optimizedBinaryString:!0,date:h.date,dir:h.dir,comment:h.fileCommentStr.length?h.fileCommentStr:null,unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions,createFolders:e.createFolders});return o.zipComment.length&&(this.comment=o.zipComment),this}},{"./base64":2,"./utf8":21,"./utils":22,"./zipEntries":23}],12:[function(t,e,i){(function(t){"use strict";e.exports=function(e,i){return new t(e,i)},e.exports.test=function(e){return t.isBuffer(e)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],13:[function(t,e,i){"use strict";function s(t){this.data=t,this.length=this.data.length,this.index=0,this.zero=0}var n=t("./uint8ArrayReader");s.prototype=new n,s.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"./uint8ArrayReader":19}],14:[function(t,e,i){"use strict";var s=t("./support"),n=t("./utils"),a=t("./crc32"),r=t("./signature"),o=t("./defaults"),l=t("./base64"),h=t("./compressions"),c=t("./compressedObject"),d=t("./nodeBuffer"),u=t("./utf8"),_=t("./stringWriter"),p=t("./uint8ArrayWriter"),f=function(t){if(t._data instanceof c&&(t._data=t._data.getContent(),t.options.binary=!0,t.options.base64=!1,"uint8array"===n.getTypeOf(t._data))){var e=t._data;t._data=new Uint8Array(e.length),0!==e.length&&t._data.set(e,0)}return t._data},g=function(t){var e=f(t);return"string"===n.getTypeOf(e)?!t.options.binary&&s.nodebuffer?d(e,"utf-8"):t.asBinary():e},m=function(t){var e=f(this);return null==e?"":(this.options.base64&&(e=l.decode(e)),e=t&&this.options.binary?S.utf8decode(e):n.transformTo("string",e),t||this.options.binary||(e=n.transformTo("string",S.utf8encode(e))),e)},v=function(t,e,i){this.name=t,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=e,this.options=i,this._initialMetadata={dir:i.dir,date:i.date}};v.prototype={asText:function(){return m.call(this,!0)},asBinary:function(){return m.call(this,!1)},asNodeBuffer:function(){var t=g(this);return n.transformTo("nodebuffer",t)},asUint8Array:function(){var t=g(this);return n.transformTo("uint8array",t)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var b=function(t,e){var i,s="";for(i=0;i<e;i++)s+=String.fromCharCode(255&t),t>>>=8;return s},w=function(t,e,i){var s,a=n.getTypeOf(e);if("string"==typeof(i=function(t){return!0!==(t=t||{}).base64||null!==t.binary&&void 0!==t.binary||(t.binary=!0),(t=n.extend(t,o)).date=t.date||new Date,null!==t.compression&&(t.compression=t.compression.toUpperCase()),t}(i)).unixPermissions&&(i.unixPermissions=parseInt(i.unixPermissions,8)),i.unixPermissions&&16384&i.unixPermissions&&(i.dir=!0),i.dosPermissions&&16&i.dosPermissions&&(i.dir=!0),i.dir&&(t=x(t)),i.createFolders&&(s=y(t))&&k.call(this,s,!0),i.dir||null==e)i.base64=!1,i.binary=!1,e=null,a=null;else if("string"===a)i.binary&&!i.base64&&!0!==i.optimizedBinaryString&&(e=n.string2binary(e));else{if(i.base64=!1,i.binary=!0,!(a||e instanceof c))throw new Error("The data of '"+t+"' is in an unsupported format !");"arraybuffer"===a&&(e=n.transformTo("uint8array",e))}var r=new v(t,e,i);return this.files[t]=r,r},y=function(t){"/"==t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return e>0?t.substring(0,e):""},x=function(t){return"/"!=t.slice(-1)&&(t+="/"),t},k=function(t,e){return e=void 0!==e&&e,t=x(t),this.files[t]||w.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]},C=function(t,e,i){var s,r=new c;return t._data instanceof c?(r.uncompressedSize=t._data.uncompressedSize,r.crc32=t._data.crc32,0===r.uncompressedSize||t.dir?(e=h.STORE,r.compressedContent="",r.crc32=0):t._data.compressionMethod===e.magic?r.compressedContent=t._data.getCompressedContent():(s=t._data.getContent(),r.compressedContent=e.compress(n.transformTo(e.compressInputType,s),i))):((s=g(t))&&0!==s.length&&!t.dir||(e=h.STORE,s=""),r.uncompressedSize=s.length,r.crc32=a(s),r.compressedContent=e.compress(n.transformTo(e.compressInputType,s),i)),r.compressedSize=r.compressedContent.length,r.compressionMethod=e.magic,r},$=function(t,e,i,s,o,l){var h,c,d,_,p=(i.compressedContent,l!==u.utf8encode),f=n.transformTo("string",l(e.name)),g=n.transformTo("string",u.utf8encode(e.name)),m=e.comment||"",v=n.transformTo("string",l(m)),w=n.transformTo("string",u.utf8encode(m)),y=g.length!==e.name.length,x=w.length!==m.length,k=e.options,C="",$="",S="";d=e._initialMetadata.dir!==e.dir?e.dir:k.dir,_=e._initialMetadata.date!==e.date?e.date:k.date;var I=0,A=0;d&&(I|=16),"UNIX"===o?(A=798,I|=function(t,e){var i=t;return t||(i=e?16893:33204),(65535&i)<<16}(e.unixPermissions,d)):(A=20,I|=function(t,e){return 63&(t||0)}(e.dosPermissions)),h=_.getHours(),h<<=6,h|=_.getMinutes(),h<<=5,h|=_.getSeconds()/2,c=_.getFullYear()-1980,c<<=4,c|=_.getMonth()+1,c<<=5,c|=_.getDate(),y&&($=b(1,1)+b(a(f),4)+g,C+="up"+b($.length,2)+$),x&&(S=b(1,1)+b(this.crc32(v),4)+w,C+="uc"+b(S.length,2)+S);var D="";return D+="\n\0",D+=p||!y&&!x?"\0\0":"\0\b",D+=i.compressionMethod,D+=b(h,2),D+=b(c,2),D+=b(i.crc32,4),D+=b(i.compressedSize,4),D+=b(i.uncompressedSize,4),D+=b(f.length,2),D+=b(C.length,2),{fileRecord:r.LOCAL_FILE_HEADER+D+f+C,dirRecord:r.CENTRAL_FILE_HEADER+b(A,2)+D+b(v.length,2)+"\0\0\0\0"+b(I,4)+b(s,4)+f+C+v,compressedObject:i}},S={load:function(t,e){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(t){var e,i,s,a,r=[];for(e in this.files)this.files.hasOwnProperty(e)&&(s=this.files[e],a=new v(s.name,s._data,n.extend(s.options)),i=e.slice(this.root.length,e.length),e.slice(0,this.root.length)===this.root&&t(i,a)&&r.push(a));return r},file:function(t,e,i){if(1===arguments.length){if(n.isRegExp(t)){var s=t;return this.filter((function(t,e){return!e.dir&&s.test(t)}))}return this.filter((function(e,i){return!i.dir&&e===t}))[0]||null}return t=this.root+t,w.call(this,t,e,i),this},folder:function(t){if(!t)return this;if(n.isRegExp(t))return this.filter((function(e,i){return i.dir&&t.test(e)}));var e=this.root+t,i=k.call(this,e),s=this.clone();return s.root=i.name,s},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!=t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var i=this.filter((function(e,i){return i.name.slice(0,t.length)===t})),s=0;s<i.length;s++)delete this.files[i[s].name];return this},generate:function(t){t=n.extend(t||{},{base64:!0,compression:"STORE",compressionOptions:null,type:"base64",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:u.utf8encode}),n.checkSupport(t.type),"darwin"!==t.platform&&"freebsd"!==t.platform&&"linux"!==t.platform&&"sunos"!==t.platform||(t.platform="UNIX"),"win32"===t.platform&&(t.platform="DOS");var e,i,s=[],a=0,o=0,c=n.transformTo("string",t.encodeFileName(t.comment||this.comment||""));for(var d in this.files)if(this.files.hasOwnProperty(d)){var f=this.files[d],g=f.options.compression||t.compression.toUpperCase(),m=h[g];if(!m)throw new Error(g+" is not a valid compression method !");var v=f.options.compressionOptions||t.compressionOptions||{},w=C.call(this,f,m,v),y=$.call(this,d,f,w,a,t.platform,t.encodeFileName);a+=y.fileRecord.length+w.compressedSize,o+=y.dirRecord.length,s.push(y)}var x;x=r.CENTRAL_DIRECTORY_END+"\0\0\0\0"+b(s.length,2)+b(s.length,2)+b(o,4)+b(a,4)+b(c.length,2)+c;var k=t.type.toLowerCase();for(e="uint8array"===k||"arraybuffer"===k||"blob"===k||"nodebuffer"===k?new p(a+o+x.length):new _(a+o+x.length),i=0;i<s.length;i++)e.append(s[i].fileRecord),e.append(s[i].compressedObject.compressedContent);for(i=0;i<s.length;i++)e.append(s[i].dirRecord);e.append(x);var S=e.finalize();switch(t.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return n.transformTo(t.type.toLowerCase(),S);case"blob":return n.arrayBuffer2Blob(n.transformTo("arraybuffer",S),t.mimeType);case"base64":return t.base64?l.encode(S):S;default:return S}},crc32:function(t,e){return a(t,e)},utf8encode:function(t){return n.transformTo("string",u.utf8encode(t))},utf8decode:function(t){return u.utf8decode(t)}};e.exports=S},{"./base64":2,"./compressedObject":3,"./compressions":4,"./crc32":5,"./defaults":7,"./nodeBuffer":12,"./signature":15,"./stringWriter":17,"./support":18,"./uint8ArrayWriter":20,"./utf8":21,"./utils":22}],15:[function(t,e,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],16:[function(t,e,i){"use strict";function s(t,e){this.data=t,e||(this.data=a.string2binary(this.data)),this.length=this.data.length,this.index=0,this.zero=0}var n=t("./dataReader"),a=t("./utils");s.prototype=new n,s.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},s.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},s.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"./dataReader":6,"./utils":22}],17:[function(t,e,i){"use strict";var s=t("./utils"),n=function(){this.data=[]};n.prototype={append:function(t){t=s.transformTo("string",t),this.data.push(t)},finalize:function(){return this.data.join("")}},e.exports=n},{"./utils":22}],18:[function(t,e,i){(function(t){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer=void 0!==t,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var e=new ArrayBuffer(0);try{i.blob=0===new Blob([e],{type:"application/zip"}).size}catch(t){try{var s=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);s.append(e),i.blob=0===s.getBlob("application/zip").size}catch(t){i.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],19:[function(t,e,i){"use strict";function s(t){t&&(this.data=t,this.length=this.data.length,this.index=0,this.zero=0)}var n=t("./arrayReader");s.prototype=new n,s.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"./arrayReader":1}],20:[function(t,e,i){"use strict";var s=t("./utils"),n=function(t){this.data=new Uint8Array(t),this.index=0};n.prototype={append:function(t){0!==t.length&&(t=s.transformTo("uint8array",t),this.data.set(t,this.index),this.index+=t.length)},finalize:function(){return this.data}},e.exports=n},{"./utils":22}],21:[function(t,e,i){"use strict";for(var s=t("./utils"),n=t("./support"),a=t("./nodeBuffer"),r=new Array(256),o=0;o<256;o++)r[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;r[254]=r[254]=1;var l=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;i>=0&&128==(192&t[i]);)i--;return i<0||0===i?e:i+r[t[i]]>e?i:e},h=function(t){var e,i,n,a,o=t.length,l=new Array(2*o);for(i=0,e=0;e<o;)if((n=t[e++])<128)l[i++]=n;else if((a=r[n])>4)l[i++]=65533,e+=a-1;else{for(n&=2===a?31:3===a?15:7;a>1&&e<o;)n=n<<6|63&t[e++],a--;a>1?l[i++]=65533:n<65536?l[i++]=n:(n-=65536,l[i++]=55296|n>>10&1023,l[i++]=56320|1023&n)}return l.length!==i&&(l.subarray?l=l.subarray(0,i):l.length=i),s.applyFromCharCode(l)};i.utf8encode=function(t){return n.nodebuffer?a(t,"utf-8"):function(t){var e,i,s,a,r,o=t.length,l=0;for(a=0;a<o;a++)55296==(64512&(i=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(s=t.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(s-56320),a++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=n.uint8array?new Uint8Array(l):new Array(l),r=0,a=0;r<l;a++)55296==(64512&(i=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(s=t.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(s-56320),a++),i<128?e[r++]=i:i<2048?(e[r++]=192|i>>>6,e[r++]=128|63&i):i<65536?(e[r++]=224|i>>>12,e[r++]=128|i>>>6&63,e[r++]=128|63&i):(e[r++]=240|i>>>18,e[r++]=128|i>>>12&63,e[r++]=128|i>>>6&63,e[r++]=128|63&i);return e}(t)},i.utf8decode=function(t){if(n.nodebuffer)return s.transformTo("nodebuffer",t).toString("utf-8");for(var e=[],i=0,a=(t=s.transformTo(n.uint8array?"uint8array":"array",t)).length;i<a;){var r=l(t,Math.min(i+65536,a));n.uint8array?e.push(h(t.subarray(i,r))):e.push(h(t.slice(i,r))),i=r}return e.join("")}},{"./nodeBuffer":12,"./support":18,"./utils":22}],22:[function(t,e,i){"use strict";function s(t){return t}function n(t,e){for(var i=0;i<t.length;++i)e[i]=255&t.charCodeAt(i);return e}function a(t){var e=65536,s=[],n=t.length,a=i.getTypeOf(t),r=0,o=!0;try{switch(a){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,h(0))}}catch(t){o=!1}if(!o){for(var l="",c=0;c<t.length;c++)l+=String.fromCharCode(t[c]);return l}for(;r<n&&e>1;)try{"array"===a||"nodebuffer"===a?s.push(String.fromCharCode.apply(null,t.slice(r,Math.min(r+e,n)))):s.push(String.fromCharCode.apply(null,t.subarray(r,Math.min(r+e,n)))),r+=e}catch(t){e=Math.floor(e/2)}return s.join("")}function r(t,e){for(var i=0;i<t.length;i++)e[i]=t[i];return e}var o=t("./support"),l=t("./compressions"),h=t("./nodeBuffer");i.string2binary=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(255&t.charCodeAt(i));return e},i.arrayBuffer2Blob=function(t,e){i.checkSupport("blob"),e=e||"application/zip";try{return new Blob([t],{type:e})}catch(i){try{var s=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return s.append(t),s.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}},i.applyFromCharCode=a;var c={};c.string={string:s,array:function(t){return n(t,new Array(t.length))},arraybuffer:function(t){return c.string.uint8array(t).buffer},uint8array:function(t){return n(t,new Uint8Array(t.length))},nodebuffer:function(t){return n(t,h(t.length))}},c.array={string:a,array:s,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return h(t)}},c.arraybuffer={string:function(t){return a(new Uint8Array(t))},array:function(t){return r(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:s,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return h(new Uint8Array(t))}},c.uint8array={string:a,array:function(t){return r(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:s,nodebuffer:function(t){return h(t)}},c.nodebuffer={string:a,array:function(t){return r(t,new Array(t.length))},arraybuffer:function(t){return c.nodebuffer.uint8array(t).buffer},uint8array:function(t){return r(t,new Uint8Array(t.length))},nodebuffer:s},i.transformTo=function(t,e){if(e||(e=""),!t)return e;i.checkSupport(t);var s=i.getTypeOf(e);return c[s][t](e)},i.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":o.nodebuffer&&h.test(t)?"nodebuffer":o.uint8array&&t instanceof Uint8Array?"uint8array":o.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(t){if(!o[t.toLowerCase()])throw new Error(t+" is not supported by this browser")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(t){var e,i,s="";for(i=0;i<(t||"").length;i++)s+="\\x"+((e=t.charCodeAt(i))<16?"0":"")+e.toString(16).toUpperCase();return s},i.findCompression=function(t){for(var e in l)if(l.hasOwnProperty(e)&&l[e].magic===t)return l[e];return null},i.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},i.extend=function(){var t,e,i={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===i[e]&&(i[e]=arguments[t][e]);return i}},{"./compressions":4,"./nodeBuffer":12,"./support":18}],23:[function(t,e,i){"use strict";function s(t,e){this.files=[],this.loadOptions=e,t&&this.load(t)}var n=t("./stringReader"),a=t("./nodeBufferReader"),r=t("./uint8ArrayReader"),o=t("./arrayReader"),l=t("./utils"),h=t("./signature"),c=t("./zipEntry"),d=t("./support");t("./object"),s.prototype={checkSignature:function(t){var e=this.reader.readString(4);if(e!==t)throw new Error("Corrupted zip or bug : unexpected signature ("+l.pretty(e)+", expected "+l.pretty(t)+")")},isSignature:function(t,e){var i=this.reader.index;this.reader.setIndex(t);var s=this.reader.readString(4)===e;return this.reader.setIndex(i),s},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=d.uint8array?"uint8array":"array",i=l.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,i,s=this.zip64EndOfCentralSize-44;0<s;)t=this.reader.readInt(2),e=this.reader.readInt(4),i=this.reader.readString(e),this.zip64ExtensibleData[t]={id:t,length:e,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(h.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===h.CENTRAL_FILE_HEADER;)(t=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(h.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,h.LOCAL_FILE_HEADER)?new Error("Corrupted zip : can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(h.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(h.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(h.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,h.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(h.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(h.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var s=e-i;if(s>0)this.isSignature(e,h.CENTRAL_FILE_HEADER)||(this.reader.zero=s);else if(s<0)throw new Error("Corrupted zip: missing "+Math.abs(s)+" bytes.")},prepareReader:function(t){var e=l.getTypeOf(t);if(l.checkSupport(e),"string"!==e||d.uint8array)if("nodebuffer"===e)this.reader=new a(t);else if(d.uint8array)this.reader=new r(l.transformTo("uint8array",t));else{if(!d.array)throw new Error("Unexpected error: unsupported type '"+e+"'");this.reader=new o(l.transformTo("array",t))}else this.reader=new n(t,this.loadOptions.optimizedBinaryString)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=s},{"./arrayReader":1,"./nodeBufferReader":13,"./object":14,"./signature":15,"./stringReader":16,"./support":18,"./uint8ArrayReader":19,"./utils":22,"./zipEntry":24}],24:[function(t,e,i){"use strict";function s(t,e){this.options=t,this.loadOptions=e}var n=t("./stringReader"),a=t("./utils"),r=t("./compressedObject"),o=t("./object"),l=t("./support");s.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(t,e,i){return function(){var s=t.index;t.setIndex(e);var n=t.readData(i);return t.setIndex(s),n}},prepareContent:function(t,e,i,s,n){return function(){var t=a.transformTo(s.uncompressInputType,this.getCompressedContent()),e=s.uncompress(t);if(e.length!==n)throw new Error("Bug : uncompressed data size mismatch");return e}},readLocalPart:function(t){var e,i;if(t.skip(22),this.fileNameLength=t.readInt(2),i=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(i),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(e=a.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");if(this.decompressed=new r,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(t,t.index,this.compressedSize,e),this.decompressed.getContent=this.prepareContent(t,t.index,this.compressedSize,e,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=a.transformTo("string",this.decompressed.getContent()),o.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(t){if(this.versionMadeBy=t.readInt(2),this.versionNeeded=t.readInt(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4),this.fileNameLength=t.readInt(2),this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=t.readData(this.fileNameLength),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===t&&(this.dosPermissions=63&this.externalFileAttributes),3===t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=new n(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,i,s,n=t.index;for(this.extraFields=this.extraFields||{};t.index<n+this.extraFieldsLength;)e=t.readInt(2),i=t.readInt(2),s=t.readString(i),this.extraFields[e]={id:e,length:i,value:s}},handleUTF8:function(){var t=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var i=a.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var s=this.findExtraFieldUnicodeComment();if(null!==s)this.fileCommentStr=s;else{var n=a.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(n)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=new n(t.value);return 1!==e.readInt(1)||o.crc32(this.fileName)!==e.readInt(4)?null:o.utf8decode(e.readString(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=new n(t.value);return 1!==e.readInt(1)||o.crc32(this.fileComment)!==e.readInt(4)?null:o.utf8decode(e.readString(t.length-5))}return null}},e.exports=s},{"./compressedObject":3,"./object":14,"./stringReader":16,"./support":18,"./utils":22}],25:[function(t,e,i){"use strict";var s={};(0,t("./lib/utils/common").assign)(s,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=s},{"./lib/deflate":26,"./lib/inflate":27,"./lib/utils/common":28,"./lib/zlib/constants":31}],26:[function(t,e,i){"use strict";function s(t){if(!(this instanceof s))return new s(t);this.options=r.assign({level:u,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var i=a.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==d)throw new Error(l[i]);if(e.header&&a.deflateSetHeader(this.strm,e.header),e.dictionary){var n;if(n="string"==typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(i=a.deflateSetDictionary(this.strm,n))!==d)throw new Error(l[i]);this._dict_set=!0}}function n(t,e){var i=new s(e);if(i.push(t,!0),i.err)throw i.msg;return i.result}var a=t("./zlib/deflate"),r=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),h=t("./zlib/zstream"),c=Object.prototype.toString,d=0,u=-1,_=0,p=8;s.prototype.push=function(t,e){var i,s,n=this.strm,l=this.options.chunkSize;if(this.ended)return!1;s=e===~~e?e:!0===e?4:0,"string"==typeof t?n.input=o.string2buf(t):"[object ArrayBuffer]"===c.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new r.Buf8(l),n.next_out=0,n.avail_out=l),1!==(i=a.deflate(n,s))&&i!==d)return this.onEnd(i),this.ended=!0,!1;0!==n.avail_out&&(0!==n.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(o.buf2binstring(r.shrinkBuf(n.output,n.next_out))):this.onData(r.shrinkBuf(n.output,n.next_out)))}while((n.avail_in>0||0===n.avail_out)&&1!==i);return 4===s?(i=a.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===d):2!==s||(this.onEnd(d),n.avail_out=0,!0)},s.prototype.onData=function(t){this.chunks.push(t)},s.prototype.onEnd=function(t){t===d&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Deflate=s,i.deflate=n,i.deflateRaw=function(t,e){return(e=e||{}).raw=!0,n(t,e)},i.gzip=function(t,e){return(e=e||{}).gzip=!0,n(t,e)}},{"./utils/common":28,"./utils/strings":29,"./zlib/deflate":33,"./zlib/messages":38,"./zlib/zstream":40}],27:[function(t,e,i){"use strict";function s(t){if(!(this instanceof s))return new s(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var i=a.inflateInit2(this.strm,e.windowBits);if(i!==l.Z_OK)throw new Error(h[i]);this.header=new d,a.inflateGetHeader(this.strm,this.header)}function n(t,e){var i=new s(e);if(i.push(t,!0),i.err)throw i.msg;return i.result}var a=t("./zlib/inflate"),r=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),h=t("./zlib/messages"),c=t("./zlib/zstream"),d=t("./zlib/gzheader"),u=Object.prototype.toString;s.prototype.push=function(t,e){var i,s,n,h,c,d,_=this.strm,p=this.options.chunkSize,f=this.options.dictionary,g=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?l.Z_FINISH:l.Z_NO_FLUSH,"string"==typeof t?_.input=o.binstring2buf(t):"[object ArrayBuffer]"===u.call(t)?_.input=new Uint8Array(t):_.input=t,_.next_in=0,_.avail_in=_.input.length;do{if(0===_.avail_out&&(_.output=new r.Buf8(p),_.next_out=0,_.avail_out=p),(i=a.inflate(_,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&f&&(d="string"==typeof f?o.string2buf(f):"[object ArrayBuffer]"===u.call(f)?new Uint8Array(f):f,i=a.inflateSetDictionary(this.strm,d)),i===l.Z_BUF_ERROR&&!0===g&&(i=l.Z_OK,g=!1),i!==l.Z_STREAM_END&&i!==l.Z_OK)return this.onEnd(i),this.ended=!0,!1;_.next_out&&(0!==_.avail_out&&i!==l.Z_STREAM_END&&(0!==_.avail_in||s!==l.Z_FINISH&&s!==l.Z_SYNC_FLUSH)||("string"===this.options.to?(n=o.utf8border(_.output,_.next_out),h=_.next_out-n,c=o.buf2string(_.output,n),_.next_out=h,_.avail_out=p-h,h&&r.arraySet(_.output,_.output,n,h,0),this.onData(c)):this.onData(r.shrinkBuf(_.output,_.next_out)))),0===_.avail_in&&0===_.avail_out&&(g=!0)}while((_.avail_in>0||0===_.avail_out)&&i!==l.Z_STREAM_END);return i===l.Z_STREAM_END&&(s=l.Z_FINISH),s===l.Z_FINISH?(i=a.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===l.Z_OK):s!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),_.avail_out=0,!0)},s.prototype.onData=function(t){this.chunks.push(t)},s.prototype.onEnd=function(t){t===l.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Inflate=s,i.inflate=n,i.inflateRaw=function(t,e){return(e=e||{}).raw=!0,n(t,e)},i.ungzip=n},{"./utils/common":28,"./utils/strings":29,"./zlib/constants":31,"./zlib/gzheader":34,"./zlib/inflate":36,"./zlib/messages":38,"./zlib/zstream":40}],28:[function(t,e,i){"use strict";var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])}}return t},i.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var n={arraySet:function(t,e,i,s,n){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+s),n);else for(var a=0;a<s;a++)t[n+a]=e[i+a]},flattenChunks:function(t){var e,i,s,n,a,r;for(s=0,e=0,i=t.length;e<i;e++)s+=t[e].length;for(r=new Uint8Array(s),n=0,e=0,i=t.length;e<i;e++)a=t[e],r.set(a,n),n+=a.length;return r}},a={arraySet:function(t,e,i,s,n){for(var a=0;a<s;a++)t[n+a]=e[i+a]},flattenChunks:function(t){return[].concat.apply([],t)}};i.setTyped=function(t){t?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,n)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],29:[function(t,e,i){"use strict";function s(t,e){if(e<65537&&(t.subarray&&r||!t.subarray&&a))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var i="",s=0;s<e;s++)i+=String.fromCharCode(t[s]);return i}var n=t("./common"),a=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(t){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){r=!1}for(var o=new n.Buf8(256),l=0;l<256;l++)o[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;o[254]=o[254]=1,i.string2buf=function(t){var e,i,s,a,r,o=t.length,l=0;for(a=0;a<o;a++)55296==(64512&(i=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(s=t.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(s-56320),a++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=new n.Buf8(l),r=0,a=0;r<l;a++)55296==(64512&(i=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(s=t.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(s-56320),a++),i<128?e[r++]=i:i<2048?(e[r++]=192|i>>>6,e[r++]=128|63&i):i<65536?(e[r++]=224|i>>>12,e[r++]=128|i>>>6&63,e[r++]=128|63&i):(e[r++]=240|i>>>18,e[r++]=128|i>>>12&63,e[r++]=128|i>>>6&63,e[r++]=128|63&i);return e},i.buf2binstring=function(t){return s(t,t.length)},i.binstring2buf=function(t){for(var e=new n.Buf8(t.length),i=0,s=e.length;i<s;i++)e[i]=t.charCodeAt(i);return e},i.buf2string=function(t,e){var i,n,a,r,l=e||t.length,h=new Array(2*l);for(n=0,i=0;i<l;)if((a=t[i++])<128)h[n++]=a;else if((r=o[a])>4)h[n++]=65533,i+=r-1;else{for(a&=2===r?31:3===r?15:7;r>1&&i<l;)a=a<<6|63&t[i++],r--;r>1?h[n++]=65533:a<65536?h[n++]=a:(a-=65536,h[n++]=55296|a>>10&1023,h[n++]=56320|1023&a)}return s(h,n)},i.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;i>=0&&128==(192&t[i]);)i--;return i<0||0===i?e:i+o[t[i]]>e?i:e}},{"./common":28}],30:[function(t,e,i){"use strict";e.exports=function(t,e,i,s){for(var n=65535&t|0,a=t>>>16&65535|0,r=0;0!==i;){i-=r=i>2e3?2e3:i;do{a=a+(n=n+e[s++]|0)|0}while(--r);n%=65521,a%=65521}return n|a<<16|0}},{}],31:[function(t,e,i){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],32:[function(t,e,i){"use strict";var s=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e,i,n){var a=s,r=n+i;t^=-1;for(var o=n;o<r;o++)t=t>>>8^a[255&(t^e[o])];return-1^t}},{}],33:[function(t,e,i){"use strict";function s(t,e){return t.msg=I[e],e}function n(t){return(t<<1)-(t>4?9:0)}function a(t){for(var e=t.length;--e>=0;)t[e]=0}function r(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(k.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function o(t,e){C._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,r(t.strm)}function l(t,e){t.pending_buf[t.pending++]=e}function h(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function c(t,e,i,s){var n=t.avail_in;return n>s&&(n=s),0===n?0:(t.avail_in-=n,k.arraySet(e,t.input,t.next_in,n,i),1===t.state.wrap?t.adler=$(t.adler,e,n,i):2===t.state.wrap&&(t.adler=S(t.adler,e,n,i)),t.next_in+=n,t.total_in+=n,n)}function d(t,e){var i,s,n=t.max_chain_length,a=t.strstart,r=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-it?t.strstart-(t.w_size-it):0,h=t.window,c=t.w_mask,d=t.prev,u=t.strstart+et,_=h[a+r-1],p=h[a+r];t.prev_length>=t.good_match&&(n>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(i=e)+r]===p&&h[i+r-1]===_&&h[i]===h[a]&&h[++i]===h[a+1]){a+=2,i++;do{}while(h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&a<u);if(s=et-(u-a),a=u-et,s>r){if(t.match_start=e,r=s,s>=o)break;_=h[a+r-1],p=h[a+r]}}}while((e=d[e&c])>l&&0!=--n);return r<=t.lookahead?r:t.lookahead}function u(t){var e,i,s,n,a,r=t.w_size;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-it)){k.arraySet(t.window,t.window,r,r,0),t.match_start-=r,t.strstart-=r,t.block_start-=r,e=i=t.hash_size;do{s=t.head[--e],t.head[e]=s>=r?s-r:0}while(--i);e=i=r;do{s=t.prev[--e],t.prev[e]=s>=r?s-r:0}while(--i);n+=r}if(0===t.strm.avail_in)break;if(i=c(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=i,t.lookahead+t.insert>=tt)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+tt-1])&t.hash_mask,t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<tt)););}while(t.lookahead<it&&0!==t.strm.avail_in)}function _(t,e){for(var i,s;;){if(t.lookahead<it){if(u(t),t.lookahead<it&&e===A)return dt;if(0===t.lookahead)break}if(i=0,t.lookahead>=tt&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+tt-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-it&&(t.match_length=d(t,i)),t.match_length>=tt)if(s=C._tr_tally(t,t.strstart-t.match_start,t.match_length-tt),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=tt){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+tt-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else s=C._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(s&&(o(t,!1),0===t.strm.avail_out))return dt}return t.insert=t.strstart<tt-1?t.strstart:tt-1,e===j?(o(t,!0),0===t.strm.avail_out?_t:pt):t.last_lit&&(o(t,!1),0===t.strm.avail_out)?dt:ut}function p(t,e){for(var i,s,n;;){if(t.lookahead<it){if(u(t),t.lookahead<it&&e===A)return dt;if(0===t.lookahead)break}if(i=0,t.lookahead>=tt&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+tt-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=tt-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-it&&(t.match_length=d(t,i),t.match_length<=5&&(t.strategy===O||t.match_length===tt&&t.strstart-t.match_start>4096)&&(t.match_length=tt-1)),t.prev_length>=tt&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-tt,s=C._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-tt),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=n&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+tt-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=tt-1,t.strstart++,s&&(o(t,!1),0===t.strm.avail_out))return dt}else if(t.match_available){if((s=C._tr_tally(t,0,t.window[t.strstart-1]))&&o(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return dt}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(s=C._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<tt-1?t.strstart:tt-1,e===j?(o(t,!0),0===t.strm.avail_out?_t:pt):t.last_lit&&(o(t,!1),0===t.strm.avail_out)?dt:ut}function f(t,e){for(var i,s,n,a,r=t.window;;){if(t.lookahead<=et){if(u(t),t.lookahead<=et&&e===A)return dt;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=tt&&t.strstart>0&&(s=r[n=t.strstart-1])===r[++n]&&s===r[++n]&&s===r[++n]){a=t.strstart+et;do{}while(s===r[++n]&&s===r[++n]&&s===r[++n]&&s===r[++n]&&s===r[++n]&&s===r[++n]&&s===r[++n]&&s===r[++n]&&n<a);t.match_length=et-(a-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=tt?(i=C._tr_tally(t,1,t.match_length-tt),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=C._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(o(t,!1),0===t.strm.avail_out))return dt}return t.insert=0,e===j?(o(t,!0),0===t.strm.avail_out?_t:pt):t.last_lit&&(o(t,!1),0===t.strm.avail_out)?dt:ut}function g(t,e){for(var i;;){if(0===t.lookahead&&(u(t),0===t.lookahead)){if(e===A)return dt;break}if(t.match_length=0,i=C._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(o(t,!1),0===t.strm.avail_out))return dt}return t.insert=0,e===j?(o(t,!0),0===t.strm.avail_out?_t:pt):t.last_lit&&(o(t,!1),0===t.strm.avail_out)?dt:ut}function m(t,e,i,s,n){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=s,this.func=n}function v(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=U,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new k.Buf16(2*Z),this.dyn_dtree=new k.Buf16(2*(2*X+1)),this.bl_tree=new k.Buf16(2*(2*J+1)),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new k.Buf16(Q+1),this.heap=new k.Buf16(2*K+1),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new k.Buf16(2*K+1),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function b(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=q,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?nt:ht,t.adler=2===e.wrap?0:1,e.last_flush=A,C._tr_init(e),N):s(t,F)}function w(t){var e=b(t);return e===N&&function(t){t.window_size=2*t.w_size,a(t.head),t.max_lazy_match=x[t.level].max_lazy,t.good_match=x[t.level].good_length,t.nice_match=x[t.level].nice_length,t.max_chain_length=x[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=tt-1,t.match_available=0,t.ins_h=0}(t.state),e}function y(t,e,i,n,a,r){if(!t)return F;var o=1;if(e===M&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),a<1||a>W||i!==U||n<8||n>15||e<0||e>9||r<0||r>z)return s(t,F);8===n&&(n=9);var l=new v;return t.state=l,l.strm=t,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+tt-1)/tt),l.window=new k.Buf8(2*l.w_size),l.head=new k.Buf16(l.hash_size),l.prev=new k.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new k.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=r,l.method=i,w(t)}var x,k=t("../utils/common"),C=t("./trees"),$=t("./adler32"),S=t("./crc32"),I=t("./messages"),A=0,D=1,E=3,j=4,V=5,N=0,T=1,F=-2,P=-3,B=-5,M=-1,O=1,L=2,R=3,z=4,H=0,q=2,U=8,W=9,Y=15,G=8,K=286,X=30,J=19,Z=2*K+1,Q=15,tt=3,et=258,it=et+tt+1,st=32,nt=42,at=69,rt=73,ot=91,lt=103,ht=113,ct=666,dt=1,ut=2,_t=3,pt=4,ft=3;x=[new m(0,0,0,0,(function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(u(t),0===t.lookahead&&e===A)return dt;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var s=t.block_start+i;if((0===t.strstart||t.strstart>=s)&&(t.lookahead=t.strstart-s,t.strstart=s,o(t,!1),0===t.strm.avail_out))return dt;if(t.strstart-t.block_start>=t.w_size-it&&(o(t,!1),0===t.strm.avail_out))return dt}return t.insert=0,e===j?(o(t,!0),0===t.strm.avail_out?_t:pt):(t.strstart>t.block_start&&(o(t,!1),t.strm.avail_out),dt)})),new m(4,4,8,4,_),new m(4,5,16,8,_),new m(4,6,32,32,_),new m(4,4,16,16,p),new m(8,16,32,32,p),new m(8,16,128,128,p),new m(8,32,128,256,p),new m(32,128,258,1024,p),new m(32,258,258,4096,p)],i.deflateInit=function(t,e){return y(t,e,U,Y,G,H)},i.deflateInit2=y,i.deflateReset=w,i.deflateResetKeep=b,i.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?F:(t.state.gzhead=e,N):F},i.deflate=function(t,e){var i,o,c,d;if(!t||!t.state||e>V||e<0)return t?s(t,F):F;if(o=t.state,!t.output||!t.input&&0!==t.avail_in||o.status===ct&&e!==j)return s(t,0===t.avail_out?B:F);if(o.strm=t,i=o.last_flush,o.last_flush=e,o.status===nt)if(2===o.wrap)t.adler=0,l(o,31),l(o,139),l(o,8),o.gzhead?(l(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),l(o,255&o.gzhead.time),l(o,o.gzhead.time>>8&255),l(o,o.gzhead.time>>16&255),l(o,o.gzhead.time>>24&255),l(o,9===o.level?2:o.strategy>=L||o.level<2?4:0),l(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(l(o,255&o.gzhead.extra.length),l(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(t.adler=S(t.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=at):(l(o,0),l(o,0),l(o,0),l(o,0),l(o,0),l(o,9===o.level?2:o.strategy>=L||o.level<2?4:0),l(o,ft),o.status=ht);else{var u=U+(o.w_bits-8<<4)<<8;u|=(o.strategy>=L||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(u|=st),u+=31-u%31,o.status=ht,h(o,u),0!==o.strstart&&(h(o,t.adler>>>16),h(o,65535&t.adler)),t.adler=1}if(o.status===at)if(o.gzhead.extra){for(c=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>c&&(t.adler=S(t.adler,o.pending_buf,o.pending-c,c)),r(t),c=o.pending,o.pending!==o.pending_buf_size));)l(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>c&&(t.adler=S(t.adler,o.pending_buf,o.pending-c,c)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=rt)}else o.status=rt;if(o.status===rt)if(o.gzhead.name){c=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>c&&(t.adler=S(t.adler,o.pending_buf,o.pending-c,c)),r(t),c=o.pending,o.pending===o.pending_buf_size)){d=1;break}d=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,l(o,d)}while(0!==d);o.gzhead.hcrc&&o.pending>c&&(t.adler=S(t.adler,o.pending_buf,o.pending-c,c)),0===d&&(o.gzindex=0,o.status=ot)}else o.status=ot;if(o.status===ot)if(o.gzhead.comment){c=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>c&&(t.adler=S(t.adler,o.pending_buf,o.pending-c,c)),r(t),c=o.pending,o.pending===o.pending_buf_size)){d=1;break}d=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,l(o,d)}while(0!==d);o.gzhead.hcrc&&o.pending>c&&(t.adler=S(t.adler,o.pending_buf,o.pending-c,c)),0===d&&(o.status=lt)}else o.status=lt;if(o.status===lt&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&r(t),o.pending+2<=o.pending_buf_size&&(l(o,255&t.adler),l(o,t.adler>>8&255),t.adler=0,o.status=ht)):o.status=ht),0!==o.pending){if(r(t),0===t.avail_out)return o.last_flush=-1,N}else if(0===t.avail_in&&n(e)<=n(i)&&e!==j)return s(t,B);if(o.status===ct&&0!==t.avail_in)return s(t,B);if(0!==t.avail_in||0!==o.lookahead||e!==A&&o.status!==ct){var _=o.strategy===L?g(o,e):o.strategy===R?f(o,e):x[o.level].func(o,e);if(_!==_t&&_!==pt||(o.status=ct),_===dt||_===_t)return 0===t.avail_out&&(o.last_flush=-1),N;if(_===ut&&(e===D?C._tr_align(o):e!==V&&(C._tr_stored_block(o,0,0,!1),e===E&&(a(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),r(t),0===t.avail_out))return o.last_flush=-1,N}return e!==j?N:o.wrap<=0?T:(2===o.wrap?(l(o,255&t.adler),l(o,t.adler>>8&255),l(o,t.adler>>16&255),l(o,t.adler>>24&255),l(o,255&t.total_in),l(o,t.total_in>>8&255),l(o,t.total_in>>16&255),l(o,t.total_in>>24&255)):(h(o,t.adler>>>16),h(o,65535&t.adler)),r(t),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?N:T)},i.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==nt&&e!==at&&e!==rt&&e!==ot&&e!==lt&&e!==ht&&e!==ct?s(t,F):(t.state=null,e===ht?s(t,P):N):F},i.deflateSetDictionary=function(t,e){var i,s,n,r,o,l,h,c,d=e.length;if(!t||!t.state)return F;if(2===(r=(i=t.state).wrap)||1===r&&i.status!==nt||i.lookahead)return F;for(1===r&&(t.adler=$(t.adler,e,d,0)),i.wrap=0,d>=i.w_size&&(0===r&&(a(i.head),i.strstart=0,i.block_start=0,i.insert=0),c=new k.Buf8(i.w_size),k.arraySet(c,e,d-i.w_size,i.w_size,0),e=c,d=i.w_size),o=t.avail_in,l=t.next_in,h=t.input,t.avail_in=d,t.next_in=0,t.input=e,u(i);i.lookahead>=tt;){s=i.strstart,n=i.lookahead-(tt-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[s+tt-1])&i.hash_mask,i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++}while(--n);i.strstart=s,i.lookahead=tt-1,u(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=tt-1,i.match_available=0,t.next_in=l,t.input=h,t.avail_in=o,i.wrap=r,N},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":28,"./adler32":30,"./crc32":32,"./messages":38,"./trees":39}],34:[function(t,e,i){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],35:[function(t,e,i){"use strict";e.exports=function(t,e){var i,s,n,a,r,o,l,h,c,d,u,_,p,f,g,m,v,b,w,y,x,k,C,$,S;i=t.state,s=t.next_in,$=t.input,n=s+(t.avail_in-5),a=t.next_out,S=t.output,r=a-(e-t.avail_out),o=a+(t.avail_out-257),l=i.dmax,h=i.wsize,c=i.whave,d=i.wnext,u=i.window,_=i.hold,p=i.bits,f=i.lencode,g=i.distcode,m=(1<<i.lenbits)-1,v=(1<<i.distbits)-1;t:do{p<15&&(_+=$[s++]<<p,p+=8,_+=$[s++]<<p,p+=8),b=f[_&m];e:for(;;){if(_>>>=w=b>>>24,p-=w,0==(w=b>>>16&255))S[a++]=65535&b;else{if(!(16&w)){if(0==(64&w)){b=f[(65535&b)+(_&(1<<w)-1)];continue e}if(32&w){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}y=65535&b,(w&=15)&&(p<w&&(_+=$[s++]<<p,p+=8),y+=_&(1<<w)-1,_>>>=w,p-=w),p<15&&(_+=$[s++]<<p,p+=8,_+=$[s++]<<p,p+=8),b=g[_&v];i:for(;;){if(_>>>=w=b>>>24,p-=w,!(16&(w=b>>>16&255))){if(0==(64&w)){b=g[(65535&b)+(_&(1<<w)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(x=65535&b,p<(w&=15)&&(_+=$[s++]<<p,(p+=8)<w&&(_+=$[s++]<<p,p+=8)),(x+=_&(1<<w)-1)>l){t.msg="invalid distance too far back",i.mode=30;break t}if(_>>>=w,p-=w,x>(w=a-r)){if((w=x-w)>c&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(k=0,C=u,0===d){if(k+=h-w,w<y){y-=w;do{S[a++]=u[k++]}while(--w);k=a-x,C=S}}else if(d<w){if(k+=h+d-w,(w-=d)<y){y-=w;do{S[a++]=u[k++]}while(--w);if(k=0,d<y){y-=w=d;do{S[a++]=u[k++]}while(--w);k=a-x,C=S}}}else if(k+=d-w,w<y){y-=w;do{S[a++]=u[k++]}while(--w);k=a-x,C=S}for(;y>2;)S[a++]=C[k++],S[a++]=C[k++],S[a++]=C[k++],y-=3;y&&(S[a++]=C[k++],y>1&&(S[a++]=C[k++]))}else{k=a-x;do{S[a++]=S[k++],S[a++]=S[k++],S[a++]=S[k++],y-=3}while(y>2);y&&(S[a++]=S[k++],y>1&&(S[a++]=S[k++]))}break}}break}}while(s<n&&a<o);s-=y=p>>3,_&=(1<<(p-=y<<3))-1,t.next_in=s,t.next_out=a,t.avail_in=s<n?n-s+5:5-(s-n),t.avail_out=a<o?o-a+257:257-(a-o),i.hold=_,i.bits=p}},{}],36:[function(t,e,i){"use strict";function s(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new _.Buf16(320),this.work=new _.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=V,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new _.Buf32(ht),e.distcode=e.distdyn=new _.Buf32(ct),e.sane=1,e.back=-1,C):I}function r(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,a(t)):I}function o(t,e){var i,s;return t&&t.state?(s=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?I:(null!==s.window&&s.wbits!==e&&(s.window=null),s.wrap=i,s.wbits=e,r(t))):I}function l(t,e){var i,s;return t?(s=new n,t.state=s,s.window=null,(i=o(t,e))!==C&&(t.state=null),i):I}function h(t){if(ut){var e;for(d=new _.Buf32(512),u=new _.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(m(b,t.lens,0,288,d,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;m(w,t.lens,0,32,u,0,t.work,{bits:5}),ut=!1}t.lencode=d,t.lenbits=9,t.distcode=u,t.distbits=5}function c(t,e,i,s){var n,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new _.Buf8(a.wsize)),s>=a.wsize?(_.arraySet(a.window,e,i-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((n=a.wsize-a.wnext)>s&&(n=s),_.arraySet(a.window,e,i-s,n,a.wnext),(s-=n)?(_.arraySet(a.window,e,i-s,s,0),a.wnext=s,a.whave=a.wsize):(a.wnext+=n,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=n))),0}var d,u,_=t("../utils/common"),p=t("./adler32"),f=t("./crc32"),g=t("./inffast"),m=t("./inftrees"),v=0,b=1,w=2,y=4,x=5,k=6,C=0,$=1,S=2,I=-2,A=-3,D=-4,E=-5,j=8,V=1,N=2,T=3,F=4,P=5,B=6,M=7,O=8,L=9,R=10,z=11,H=12,q=13,U=14,W=15,Y=16,G=17,K=18,X=19,J=20,Z=21,Q=22,tt=23,et=24,it=25,st=26,nt=27,at=28,rt=29,ot=30,lt=31,ht=852,ct=592,dt=15,ut=!0;i.inflateReset=r,i.inflateReset2=o,i.inflateResetKeep=a,i.inflateInit=function(t){return l(t,dt)},i.inflateInit2=l,i.inflate=function(t,e){var i,n,a,r,o,l,d,u,ht,ct,dt,ut,_t,pt,ft,gt,mt,vt,bt,wt,yt,xt,kt,Ct,$t=0,St=new _.Buf8(4),It=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return I;(i=t.state).mode===H&&(i.mode=q),o=t.next_out,a=t.output,d=t.avail_out,r=t.next_in,n=t.input,l=t.avail_in,u=i.hold,ht=i.bits,ct=l,dt=d,xt=C;t:for(;;)switch(i.mode){case V:if(0===i.wrap){i.mode=q;break}for(;ht<16;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}if(2&i.wrap&&35615===u){i.check=0,St[0]=255&u,St[1]=u>>>8&255,i.check=f(i.check,St,2,0),u=0,ht=0,i.mode=N;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&u)<<8)+(u>>8))%31){t.msg="incorrect header check",i.mode=ot;break}if((15&u)!==j){t.msg="unknown compression method",i.mode=ot;break}if(ht-=4,yt=8+(15&(u>>>=4)),0===i.wbits)i.wbits=yt;else if(yt>i.wbits){t.msg="invalid window size",i.mode=ot;break}i.dmax=1<<yt,t.adler=i.check=1,i.mode=512&u?R:H,u=0,ht=0;break;case N:for(;ht<16;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}if(i.flags=u,(255&i.flags)!==j){t.msg="unknown compression method",i.mode=ot;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=ot;break}i.head&&(i.head.text=u>>8&1),512&i.flags&&(St[0]=255&u,St[1]=u>>>8&255,i.check=f(i.check,St,2,0)),u=0,ht=0,i.mode=T;case T:for(;ht<32;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}i.head&&(i.head.time=u),512&i.flags&&(St[0]=255&u,St[1]=u>>>8&255,St[2]=u>>>16&255,St[3]=u>>>24&255,i.check=f(i.check,St,4,0)),u=0,ht=0,i.mode=F;case F:for(;ht<16;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}i.head&&(i.head.xflags=255&u,i.head.os=u>>8),512&i.flags&&(St[0]=255&u,St[1]=u>>>8&255,i.check=f(i.check,St,2,0)),u=0,ht=0,i.mode=P;case P:if(1024&i.flags){for(;ht<16;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}i.length=u,i.head&&(i.head.extra_len=u),512&i.flags&&(St[0]=255&u,St[1]=u>>>8&255,i.check=f(i.check,St,2,0)),u=0,ht=0}else i.head&&(i.head.extra=null);i.mode=B;case B:if(1024&i.flags&&((ut=i.length)>l&&(ut=l),ut&&(i.head&&(yt=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),_.arraySet(i.head.extra,n,r,ut,yt)),512&i.flags&&(i.check=f(i.check,n,ut,r)),l-=ut,r+=ut,i.length-=ut),i.length))break t;i.length=0,i.mode=M;case M:if(2048&i.flags){if(0===l)break t;ut=0;do{yt=n[r+ut++],i.head&&yt&&i.length<65536&&(i.head.name+=String.fromCharCode(yt))}while(yt&&ut<l);if(512&i.flags&&(i.check=f(i.check,n,ut,r)),l-=ut,r+=ut,yt)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=O;case O:if(4096&i.flags){if(0===l)break t;ut=0;do{yt=n[r+ut++],i.head&&yt&&i.length<65536&&(i.head.comment+=String.fromCharCode(yt))}while(yt&&ut<l);if(512&i.flags&&(i.check=f(i.check,n,ut,r)),l-=ut,r+=ut,yt)break t}else i.head&&(i.head.comment=null);i.mode=L;case L:if(512&i.flags){for(;ht<16;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}if(u!==(65535&i.check)){t.msg="header crc mismatch",i.mode=ot;break}u=0,ht=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=H;break;case R:for(;ht<32;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}t.adler=i.check=s(u),u=0,ht=0,i.mode=z;case z:if(0===i.havedict)return t.next_out=o,t.avail_out=d,t.next_in=r,t.avail_in=l,i.hold=u,i.bits=ht,S;t.adler=i.check=1,i.mode=H;case H:if(e===x||e===k)break t;case q:if(i.last){u>>>=7&ht,ht-=7&ht,i.mode=nt;break}for(;ht<3;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}switch(i.last=1&u,ht-=1,3&(u>>>=1)){case 0:i.mode=U;break;case 1:if(h(i),i.mode=J,e===k){u>>>=2,ht-=2;break t}break;case 2:i.mode=G;break;case 3:t.msg="invalid block type",i.mode=ot}u>>>=2,ht-=2;break;case U:for(u>>>=7&ht,ht-=7&ht;ht<32;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}if((65535&u)!=(u>>>16^65535)){t.msg="invalid stored block lengths",i.mode=ot;break}if(i.length=65535&u,u=0,ht=0,i.mode=W,e===k)break t;case W:i.mode=Y;case Y:if(ut=i.length){if(ut>l&&(ut=l),ut>d&&(ut=d),0===ut)break t;_.arraySet(a,n,r,ut,o),l-=ut,r+=ut,d-=ut,o+=ut,i.length-=ut;break}i.mode=H;break;case G:for(;ht<14;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}if(i.nlen=257+(31&u),u>>>=5,ht-=5,i.ndist=1+(31&u),u>>>=5,ht-=5,i.ncode=4+(15&u),u>>>=4,ht-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=ot;break}i.have=0,i.mode=K;case K:for(;i.have<i.ncode;){for(;ht<3;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}i.lens[It[i.have++]]=7&u,u>>>=3,ht-=3}for(;i.have<19;)i.lens[It[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,kt={bits:i.lenbits},xt=m(v,i.lens,0,19,i.lencode,0,i.work,kt),i.lenbits=kt.bits,xt){t.msg="invalid code lengths set",i.mode=ot;break}i.have=0,i.mode=X;case X:for(;i.have<i.nlen+i.ndist;){for(;gt=($t=i.lencode[u&(1<<i.lenbits)-1])>>>16&255,mt=65535&$t,!((ft=$t>>>24)<=ht);){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}if(mt<16)u>>>=ft,ht-=ft,i.lens[i.have++]=mt;else{if(16===mt){for(Ct=ft+2;ht<Ct;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}if(u>>>=ft,ht-=ft,0===i.have){t.msg="invalid bit length repeat",i.mode=ot;break}yt=i.lens[i.have-1],ut=3+(3&u),u>>>=2,ht-=2}else if(17===mt){for(Ct=ft+3;ht<Ct;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}ht-=ft,yt=0,ut=3+(7&(u>>>=ft)),u>>>=3,ht-=3}else{for(Ct=ft+7;ht<Ct;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}ht-=ft,yt=0,ut=11+(127&(u>>>=ft)),u>>>=7,ht-=7}if(i.have+ut>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=ot;break}for(;ut--;)i.lens[i.have++]=yt}}if(i.mode===ot)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=ot;break}if(i.lenbits=9,kt={bits:i.lenbits},xt=m(b,i.lens,0,i.nlen,i.lencode,0,i.work,kt),i.lenbits=kt.bits,xt){t.msg="invalid literal/lengths set",i.mode=ot;break}if(i.distbits=6,i.distcode=i.distdyn,kt={bits:i.distbits},xt=m(w,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,kt),i.distbits=kt.bits,xt){t.msg="invalid distances set",i.mode=ot;break}if(i.mode=J,e===k)break t;case J:i.mode=Z;case Z:if(l>=6&&d>=258){t.next_out=o,t.avail_out=d,t.next_in=r,t.avail_in=l,i.hold=u,i.bits=ht,g(t,dt),o=t.next_out,a=t.output,d=t.avail_out,r=t.next_in,n=t.input,l=t.avail_in,u=i.hold,ht=i.bits,i.mode===H&&(i.back=-1);break}for(i.back=0;gt=($t=i.lencode[u&(1<<i.lenbits)-1])>>>16&255,mt=65535&$t,!((ft=$t>>>24)<=ht);){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}if(gt&&0==(240&gt)){for(vt=ft,bt=gt,wt=mt;gt=($t=i.lencode[wt+((u&(1<<vt+bt)-1)>>vt)])>>>16&255,mt=65535&$t,!(vt+(ft=$t>>>24)<=ht);){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}u>>>=vt,ht-=vt,i.back+=vt}if(u>>>=ft,ht-=ft,i.back+=ft,i.length=mt,0===gt){i.mode=st;break}if(32&gt){i.back=-1,i.mode=H;break}if(64&gt){t.msg="invalid literal/length code",i.mode=ot;break}i.extra=15&gt,i.mode=Q;case Q:if(i.extra){for(Ct=i.extra;ht<Ct;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}i.length+=u&(1<<i.extra)-1,u>>>=i.extra,ht-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=tt;case tt:for(;gt=($t=i.distcode[u&(1<<i.distbits)-1])>>>16&255,mt=65535&$t,!((ft=$t>>>24)<=ht);){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}if(0==(240&gt)){for(vt=ft,bt=gt,wt=mt;gt=($t=i.distcode[wt+((u&(1<<vt+bt)-1)>>vt)])>>>16&255,mt=65535&$t,!(vt+(ft=$t>>>24)<=ht);){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}u>>>=vt,ht-=vt,i.back+=vt}if(u>>>=ft,ht-=ft,i.back+=ft,64&gt){t.msg="invalid distance code",i.mode=ot;break}i.offset=mt,i.extra=15&gt,i.mode=et;case et:if(i.extra){for(Ct=i.extra;ht<Ct;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}i.offset+=u&(1<<i.extra)-1,u>>>=i.extra,ht-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=ot;break}i.mode=it;case it:if(0===d)break t;if(ut=dt-d,i.offset>ut){if((ut=i.offset-ut)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=ot;break}ut>i.wnext?(ut-=i.wnext,_t=i.wsize-ut):_t=i.wnext-ut,ut>i.length&&(ut=i.length),pt=i.window}else pt=a,_t=o-i.offset,ut=i.length;ut>d&&(ut=d),d-=ut,i.length-=ut;do{a[o++]=pt[_t++]}while(--ut);0===i.length&&(i.mode=Z);break;case st:if(0===d)break t;a[o++]=i.length,d--,i.mode=Z;break;case nt:if(i.wrap){for(;ht<32;){if(0===l)break t;l--,u|=n[r++]<<ht,ht+=8}if(dt-=d,t.total_out+=dt,i.total+=dt,dt&&(t.adler=i.check=i.flags?f(i.check,a,dt,o-dt):p(i.check,a,dt,o-dt)),dt=d,(i.flags?u:s(u))!==i.check){t.msg="incorrect data check",i.mode=ot;break}u=0,ht=0}i.mode=at;case at:if(i.wrap&&i.flags){for(;ht<32;){if(0===l)break t;l--,u+=n[r++]<<ht,ht+=8}if(u!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=ot;break}u=0,ht=0}i.mode=rt;case rt:xt=$;break t;case ot:xt=A;break t;case lt:return D;default:return I}return t.next_out=o,t.avail_out=d,t.next_in=r,t.avail_in=l,i.hold=u,i.bits=ht,(i.wsize||dt!==t.avail_out&&i.mode<ot&&(i.mode<nt||e!==y))&&c(t,t.output,t.next_out,dt-t.avail_out)?(i.mode=lt,D):(ct-=t.avail_in,dt-=t.avail_out,t.total_in+=ct,t.total_out+=dt,i.total+=dt,i.wrap&&dt&&(t.adler=i.check=i.flags?f(i.check,a,dt,t.next_out-dt):p(i.check,a,dt,t.next_out-dt)),t.data_type=i.bits+(i.last?64:0)+(i.mode===H?128:0)+(i.mode===J||i.mode===W?256:0),(0===ct&&0===dt||e===y)&&xt===C&&(xt=E),xt)},i.inflateEnd=function(t){if(!t||!t.state)return I;var e=t.state;return e.window&&(e.window=null),t.state=null,C},i.inflateGetHeader=function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?I:(i.head=e,e.done=!1,C):I},i.inflateSetDictionary=function(t,e){var i,s=e.length;return t&&t.state?0!==(i=t.state).wrap&&i.mode!==z?I:i.mode===z&&p(1,e,s,0)!==i.check?A:c(t,e,s,s)?(i.mode=lt,D):(i.havedict=1,C):I},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":28,"./adler32":30,"./crc32":32,"./inffast":35,"./inftrees":37}],37:[function(t,e,i){"use strict";var s=t("../utils/common"),n=15,a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,i,h,c,d,u,_){var p,f,g,m,v,b,w,y,x,k=_.bits,C=0,$=0,S=0,I=0,A=0,D=0,E=0,j=0,V=0,N=0,T=null,F=0,P=new s.Buf16(16),B=new s.Buf16(16),M=null,O=0;for(C=0;C<=n;C++)P[C]=0;for($=0;$<h;$++)P[e[i+$]]++;for(A=k,I=n;I>=1&&0===P[I];I--);if(A>I&&(A=I),0===I)return c[d++]=20971520,c[d++]=20971520,_.bits=1,0;for(S=1;S<I&&0===P[S];S++);for(A<S&&(A=S),j=1,C=1;C<=n;C++)if(j<<=1,(j-=P[C])<0)return-1;if(j>0&&(0===t||1!==I))return-1;for(B[1]=0,C=1;C<n;C++)B[C+1]=B[C]+P[C];for($=0;$<h;$++)0!==e[i+$]&&(u[B[e[i+$]]++]=$);if(0===t?(T=M=u,b=19):1===t?(T=a,F-=257,M=r,O-=257,b=256):(T=o,M=l,b=-1),N=0,$=0,C=S,v=d,D=A,E=0,g=-1,m=(V=1<<A)-1,1===t&&V>852||2===t&&V>592)return 1;for(;;){w=C-E,u[$]<b?(y=0,x=u[$]):u[$]>b?(y=M[O+u[$]],x=T[F+u[$]]):(y=96,x=0),p=1<<C-E,S=f=1<<D;do{c[v+(N>>E)+(f-=p)]=w<<24|y<<16|x|0}while(0!==f);for(p=1<<C-1;N&p;)p>>=1;if(0!==p?(N&=p-1,N+=p):N=0,$++,0==--P[C]){if(C===I)break;C=e[i+u[$]]}if(C>A&&(N&m)!==g){for(0===E&&(E=A),v+=S,j=1<<(D=C-E);D+E<I&&!((j-=P[D+E])<=0);)D++,j<<=1;if(V+=1<<D,1===t&&V>852||2===t&&V>592)return 1;c[g=N&m]=A<<24|D<<16|v-d|0}}return 0!==N&&(c[v+N]=C-E<<24|64<<16|0),_.bits=A,0}},{"../utils/common":28}],38:[function(t,e,i){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],39:[function(t,e,i){"use strict";function s(t){for(var e=t.length;--e>=0;)t[e]=0}function n(t,e,i,s,n){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=s,this.max_length=n,this.has_stree=t&&t.length}function a(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function r(t){return t<256?G[t]:G[256+(t>>>7)]}function o(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function l(t,e,i){t.bi_valid>P-i?(t.bi_buf|=e<<t.bi_valid&65535,o(t,t.bi_buf),t.bi_buf=e>>P-t.bi_valid,t.bi_valid+=i-P):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function h(t,e,i){l(t,i[2*e],i[2*e+1])}function c(t,e){var i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1}function d(t,e,i){var s,n,a=new Array(F+1),r=0;for(s=1;s<=F;s++)a[s]=r=r+i[s-1]<<1;for(n=0;n<=e;n++){var o=t[2*n+1];0!==o&&(t[2*n]=c(a[o]++,o))}}function u(t){var e;for(e=0;e<j;e++)t.dyn_ltree[2*e]=0;for(e=0;e<V;e++)t.dyn_dtree[2*e]=0;for(e=0;e<N;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*M]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function _(t){t.bi_valid>8?o(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function p(t,e,i,s){var n=2*e,a=2*i;return t[n]<t[a]||t[n]===t[a]&&s[e]<=s[i]}function f(t,e,i){for(var s=t.heap[i],n=i<<1;n<=t.heap_len&&(n<t.heap_len&&p(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!p(e,s,t.heap[n],t.depth));)t.heap[i]=t.heap[n],i=n,n<<=1;t.heap[i]=s}function g(t,e,i){var s,n,a,o,c=0;if(0!==t.last_lit)do{s=t.pending_buf[t.d_buf+2*c]<<8|t.pending_buf[t.d_buf+2*c+1],n=t.pending_buf[t.l_buf+c],c++,0===s?h(t,n,e):(h(t,(a=K[n])+E+1,e),0!==(o=z[a])&&l(t,n-=X[a],o),h(t,a=r(--s),i),0!==(o=H[a])&&l(t,s-=J[a],o))}while(c<t.last_lit);h(t,M,e)}function m(t,e){var i,s,n,a=e.dyn_tree,r=e.stat_desc.static_tree,o=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=T,i=0;i<l;i++)0!==a[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):a[2*i+1]=0;for(;t.heap_len<2;)a[2*(n=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[n]=0,t.opt_len--,o&&(t.static_len-=r[2*n+1]);for(e.max_code=h,i=t.heap_len>>1;i>=1;i--)f(t,a,i);n=l;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],f(t,a,1),s=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=s,a[2*n]=a[2*i]+a[2*s],t.depth[n]=(t.depth[i]>=t.depth[s]?t.depth[i]:t.depth[s])+1,a[2*i+1]=a[2*s+1]=n,t.heap[1]=n++,f(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,s,n,a,r,o,l=e.dyn_tree,h=e.max_code,c=e.stat_desc.static_tree,d=e.stat_desc.has_stree,u=e.stat_desc.extra_bits,_=e.stat_desc.extra_base,p=e.stat_desc.max_length,f=0;for(a=0;a<=F;a++)t.bl_count[a]=0;for(l[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<T;i++)(a=l[2*l[2*(s=t.heap[i])+1]+1]+1)>p&&(a=p,f++),l[2*s+1]=a,s>h||(t.bl_count[a]++,r=0,s>=_&&(r=u[s-_]),o=l[2*s],t.opt_len+=o*(a+r),d&&(t.static_len+=o*(c[2*s+1]+r)));if(0!==f){do{for(a=p-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[p]--,f-=2}while(f>0);for(a=p;0!==a;a--)for(s=t.bl_count[a];0!==s;)(n=t.heap[--i])>h||(l[2*n+1]!==a&&(t.opt_len+=(a-l[2*n+1])*l[2*n],l[2*n+1]=a),s--)}}(t,e),d(a,h,t.bl_count)}function v(t,e,i){var s,n,a=-1,r=e[1],o=0,l=7,h=4;for(0===r&&(l=138,h=3),e[2*(i+1)+1]=65535,s=0;s<=i;s++)n=r,r=e[2*(s+1)+1],++o<l&&n===r||(o<h?t.bl_tree[2*n]+=o:0!==n?(n!==a&&t.bl_tree[2*n]++,t.bl_tree[2*O]++):o<=10?t.bl_tree[2*L]++:t.bl_tree[2*R]++,o=0,a=n,0===r?(l=138,h=3):n===r?(l=6,h=3):(l=7,h=4))}function b(t,e,i){var s,n,a=-1,r=e[1],o=0,c=7,d=4;for(0===r&&(c=138,d=3),s=0;s<=i;s++)if(n=r,r=e[2*(s+1)+1],!(++o<c&&n===r)){if(o<d)do{h(t,n,t.bl_tree)}while(0!=--o);else 0!==n?(n!==a&&(h(t,n,t.bl_tree),o--),h(t,O,t.bl_tree),l(t,o-3,2)):o<=10?(h(t,L,t.bl_tree),l(t,o-3,3)):(h(t,R,t.bl_tree),l(t,o-11,7));o=0,a=n,0===r?(c=138,d=3):n===r?(c=6,d=3):(c=7,d=4)}}function w(t,e,i,s){l(t,(S<<1)+(s?1:0),3),function(t,e,i,s){_(t),s&&(o(t,i),o(t,~i)),y.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i,!0)}var y=t("../utils/common"),x=4,k=0,C=1,$=2,S=0,I=1,A=2,D=29,E=256,j=E+1+D,V=30,N=19,T=2*j+1,F=15,P=16,B=7,M=256,O=16,L=17,R=18,z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],H=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],q=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],W=new Array(2*(j+2));s(W);var Y=new Array(2*V);s(Y);var G=new Array(512);s(G);var K=new Array(256);s(K);var X=new Array(D);s(X);var J=new Array(V);s(J);var Z,Q,tt,et=!1;i._tr_init=function(t){et||(function(){var t,e,i,s,a,r=new Array(F+1);for(i=0,s=0;s<D-1;s++)for(X[s]=i,t=0;t<1<<z[s];t++)K[i++]=s;for(K[i-1]=s,a=0,s=0;s<16;s++)for(J[s]=a,t=0;t<1<<H[s];t++)G[a++]=s;for(a>>=7;s<V;s++)for(J[s]=a<<7,t=0;t<1<<H[s]-7;t++)G[256+a++]=s;for(e=0;e<=F;e++)r[e]=0;for(t=0;t<=143;)W[2*t+1]=8,t++,r[8]++;for(;t<=255;)W[2*t+1]=9,t++,r[9]++;for(;t<=279;)W[2*t+1]=7,t++,r[7]++;for(;t<=287;)W[2*t+1]=8,t++,r[8]++;for(d(W,j+1,r),t=0;t<V;t++)Y[2*t+1]=5,Y[2*t]=c(t,5);Z=new n(W,z,E+1,j,F),Q=new n(Y,H,0,V,F),tt=new n(new Array(0),q,0,N,B)}(),et=!0),t.l_desc=new a(t.dyn_ltree,Z),t.d_desc=new a(t.dyn_dtree,Q),t.bl_desc=new a(t.bl_tree,tt),t.bi_buf=0,t.bi_valid=0,u(t)},i._tr_stored_block=w,i._tr_flush_block=function(t,e,i,s){var n,a,r=0;t.level>0?(t.strm.data_type===$&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return k;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return C;for(e=32;e<E;e++)if(0!==t.dyn_ltree[2*e])return C;return k}(t)),m(t,t.l_desc),m(t,t.d_desc),r=function(t){var e;for(v(t,t.dyn_ltree,t.l_desc.max_code),v(t,t.dyn_dtree,t.d_desc.max_code),m(t,t.bl_desc),e=N-1;e>=3&&0===t.bl_tree[2*U[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),n=t.opt_len+3+7>>>3,(a=t.static_len+3+7>>>3)<=n&&(n=a)):n=a=i+5,i+4<=n&&-1!==e?w(t,e,i,s):t.strategy===x||a===n?(l(t,(I<<1)+(s?1:0),3),g(t,W,Y)):(l(t,(A<<1)+(s?1:0),3),function(t,e,i,s){var n;for(l(t,e-257,5),l(t,i-1,5),l(t,s-4,4),n=0;n<s;n++)l(t,t.bl_tree[2*U[n]+1],3);b(t,t.dyn_ltree,e-1),b(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,r+1),g(t,t.dyn_ltree,t.dyn_dtree)),u(t),s&&_(t)},i._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(K[i]+E+1)]++,t.dyn_dtree[2*r(e)]++),t.last_lit===t.lit_bufsize-1},i._tr_align=function(t){l(t,I<<1,3),h(t,M,W),function(t){16===t.bi_valid?(o(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":28}],40:[function(t,e,i){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[10])(10)},93794:function(t,e){!function(t){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var s,n,a=[],r=!0,o=!1;try{for(i=i.call(t);!(r=(s=i.next()).done)&&(a.push(s.value),!e||a.length!==e);r=!0);}catch(t){o=!0,n=t}finally{try{r||null==i.return||i.return()}finally{if(o)throw n}}return a}}(t,e)||n(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||n(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){if(t){if("string"==typeof t)return a(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}var r=window,o=1,l={},h=!1;function c(t){r.setImmediate?r.setImmediate(t):r.importScripts||!r.addEventListener?setTimeout(t):(o++,l[o]=t,r.postMessage(o,"*"))}function d(t){if("function"!=typeof t&&null!=t)throw TypeError();if("object"!=e(this)||this&&this.then)throw TypeError();var i,s,n=this,a=0,r=0,o=[];n.promise=n,n.resolve=function(t){return i=n.fn,s=n.er,a||(r=t,a=1,c(u)),n},n.reject=function(t){return i=n.fn,s=n.er,a||(r=t,a=2,c(u)),n},n._d=1,n.then=function(t,e){if(1!=this._d)throw TypeError();var i=new d;return i.fn=t,i.er=e,3==a?i.resolve(r):4==a?i.reject(r):o.push(i),i},n.finally=function(t){var e,i=function(i){return e=i,t()},s=function(){var t=new d;return 4==a?t.reject(e):t.resolve(e)};return n.then(i,i).then(s,s)},n.catch=function(t){return n.then(null,t)},n.fail=function(t){return n.then(null,t)};var l=function(t){a=t||4;for(var e=0;e<o.length;e++){var i=o[e];3==a&&i.resolve(r)||i.reject(r)}};try{"function"==typeof t&&t(n.resolve,n.reject)}catch(t){n.reject(t)}return n;function h(t,i,s,n){if(2==a)return n();if("object"!=e(r)&&"function"!=typeof r||"function"!=typeof t)n();else try{var o=0;t.call(r,(function(t){o++||(r=t,i())}),(function(t){o++||(r=t,s())}))}catch(t){r=t,s()}}function u(){var t;try{t=r&&r.then}catch(t){return r=t,a=2,u()}h(t,(function(){a=1,u()}),(function(){a=2,u()}),(function(){try{1==a&&"function"==typeof i?r=i(r):2==a&&"function"==typeof s&&(r=s(r),a=1)}catch(t){return r=t,l()}r==n?(r=TypeError(),l()):h(t,(function(){l(3)}),l,(function(){l(1==a&&3)}))}))}}!r.setImmediate&&r.addEventListener&&r.addEventListener("message",(function(t){if(t.source==r)if(h)c(l[t.data]);else{h=!0;try{"function"==typeof l[t.data]&&l[t.data]()}catch(t){}delete l[t.data],h=!1}})),d.resolve=function(t){if(1!=this._d)throw TypeError();return t instanceof d?t:new d((function(e){e(t)}))},d.reject=function(t){if(1!=this._d)throw TypeError();return new d((function(e,i){i(t)}))},d.all=function(t){if(1!=this._d)throw TypeError();if(!(t instanceof Array))return d.reject(TypeError());var e=new d;return function i(s,n){if(n)return e.resolve(n);if(s)return e.reject(s);var a=t.reduce((function(t,e){return e&&e.then?t+1:t}),0);0==a&&e.resolve(t),t.map((function(e,s){e&&e.then&&e.then((function(e){return t[s]=e,i(),e}),i)}))}(),e},d.race=function(t){if(1!=this._d)throw TypeError();if(!(t instanceof Array))return d.reject(TypeError());if(0==t.length)return new d;var e=new d;return function i(s,n){if(n)return e.resolve(n);if(s)return e.reject(s);var a=t.reduce((function(t,e){return e&&e.then?t+1:t}),0);0==a&&e.resolve(t),t.map((function(t){t&&t.then&&t.then((function(t){i(null,t)}),i)}))}(),e},d._d=1,d.defer=function(){return new d(null)};var u={};function _(t,e){u[t]=e}function p(t){return u[t]}function f(t,e){if(!t){g("error",e);var i=p("message");i&&"string"==typeof e&&i({type:"debug",text:e,expire:-1})}}function g(t,e,i){1==arguments.length&&(e=t,t="log"),window.console&&window.console.log&&(t=t.toLowerCase(),window.console[t]?window.console[t](e||"unknown error"):window.console.log(t+": "+e),i&&window.console.log(i))}var m={};var v=0;function b(){for(var t="",e=0;e<v;e++)t+="|  ";return t}function w(t,e){m.size&&(v||g(e?"--- get sizes ---":"--- set sizes ---"),g(b()+t.name+"@"+t.config.id),v++)}function y(t,e){m.size&&(v--,g(b()+e.join(",")))}function x(t,e,i){m.size&&(v||g(i?"--- get sizes ---":"--- set sizes ---"),g(b()+t.name+"@"+t.config.id+" "+e.join(",")))}var k=0;function C(){f(100!=++k,"Attempt to copy object with self reference")}function $(){k--}function S(t){var e=S._function;return e.prototype=t,new e}function I(t){f(t,"Invalid mixing target"),C();var i,s=!!(window.Map&&window.Set&&window.WeakMap&&window.WeakSet);for(var n in arguments.length>1?(i=arguments[0],t=arguments[1]):i=B(t)?[]:{},t){var a=t[n];!a||"object"!=e(a)||a instanceof RegExp?i[n]=a:M(a)?i[n]=new Date(a):s&&(a instanceof Map||a instanceof Set||a instanceof WeakMap||a instanceof WeakSet)?i[n]=a:(i[n]=B(a)?[]:{},I(i[n],a))}return $(),i}function A(t,e){return function(){return t.apply(e,arguments)}}function D(t){return window.eval(t)}function E(t){return void 0===t}function j(t,e,i,s){return window.setTimeout((function(){if(!e||!e.$destructed){var s=t.apply(e,i||[]);return t=e=i=null,s}}),s||1)}function V(t){var e=!0;return function(){e&&(e=!1,t.apply(this,arguments))}}S._function=function(){},t.extend=function(e,i,s){if(f(e,"Invalid mixing target"),f(i,"Invalid mixing source"),e.$protoWait)return L.insertAt.call(e.$protoWait,i,1),e;for(var n in i)n in e&&!s||(e[n]=i[n]);return i.defaults&&t.extend(e.defaults,i.defaults),i.$init&&i.$init.call(e),e};var N=(new Date).valueOf();function T(){return++N}function F(t){return"string"==typeof t?document.getElementById(t):t}function P(t,e){if("string"==typeof t){var i=t.replace("()","");return e&&e[i]?e[i]:window[i]||D(t)}return t}function B(t){return Array.isArray(t)}function M(t){return t instanceof Date}function O(e){return t.extend(e||[],L,!0)}var L={removeAt:function(t,e){t>=0&&this.splice(t,e||1)},remove:function(t){this.removeAt(this.find(t))},insertAt:function(t,e){e||0===e?this.splice(e,0,t):this.push(t)},find:function(t){for(var e=0;e<this.length;e++)if(t==this[e])return e;return-1},each:function(t,e){for(var i=0;i<this.length;i++)t.call(e||this,this[i])},map:function(t,e){for(var i=0;i<this.length;i++)this[i]=t.call(e||this,this[i]);return this},filter:function(t,e){for(var i=0;i<this.length;i++)t.call(e||this,this[i])||(this.splice(i,1),i--);return this}};window.webix_on_core_ready&&(t.extend=window.webix_on_core_ready({extend:t.extend}).extend);var R={parseFormat:"%Y-%m-%d %H:%i:%s",parseTimeFormat:"%H:%i:%s"};function z(t){var e,i=Date.prototype.toJSON;return Date.prototype.toJSON=function(){return R.parseFormatStr(this)},e=t instanceof Date?t.toJSON():JSON.stringify(t),Date.prototype.toJSON=i,e}var H={$init:function(){this._evs_events||(this._evs_events={},this._evs_handlers={},this._evs_map={})},blockEvent:function(){this._evs_events._block=!0},unblockEvent:function(){this._evs_events._block=!1},mapEvent:function(e){t.extend(this._evs_map,e,!0)},on_setter:function(t){if(t)for(var e in t){var i=P(t[e],this.$scope),s=e.indexOf("->");-1!==s?this[e.substr(0,s)].attachEvent(e.substr(s+2),A(i,this)):this.attachEvent(e,i)}},callEvent:function(t,e){var i=this._event_master||this;if(this._evs_events._block)return!0;t=t.toLowerCase();var s=this._evs_events[t.toLowerCase()],n=!0;if((m.events||this.debug)&&"onmousemoving"!==t&&g("info","["+this.name+"@"+(this._settings||{}).id+"] event:"+t,e),s)for(var a=0;a<s.length;a++)!1===s[a].apply(i,e||[])&&(n=!1);if(this._evs_map[t]){var r=this._evs_map[t];r.$eventSource=this,r.callEvent(t,e)||(n=!1),r.$eventSource=null}return n},attachEvent:function(t,e,i){f(e,"Invalid event handler for "+t),t=t.toLowerCase(),i=i||T(),e=P(e,this.$scope);var s=this._evs_events[t]||O();return arguments[3]?s.unshift(e):s.push(e),this._evs_events[t]=s,this._evs_handlers[i]={f:e,t},i},detachEvent:function(t){if(this._evs_handlers[t]){var e=this._evs_handlers[t].t,i=this._evs_handlers[t].f;this._evs_events[e].remove(i),delete this._evs_handlers[t]}else{var s=(t+"").toLowerCase();this._evs_events[s]&&(this._evs_events[s]=O())}},hasEvent:function(t){t=t.toLowerCase();var e=this._evs_events[t];if(e&&e.length)return!0;var i=this._evs_map[t];return!!i&&i.hasEvent(t)}},q={};t.extend(q,H,!0);var U=function(t,e){return q.callEvent(t,e)},W=function(t,e,i,s){return q.attachEvent(t,e,i,s)},Y=function(t){return q.detachEvent(t)},G=function(){return q.blockEvent()},K=function(){return q.unblockEvent()},X={_isValidXML:function(t){return t&&t.documentElement?t.getElementsByTagName("parsererror").length?null:t:null},toObject:function(t,e){var i=e?e.rawxml?e.rawxml():e:null;return this._isValidXML(i)?i:(i="string"==typeof t?this.fromString(t.replace(/^[\s]+/,"")):t,this._isValidXML(i)?i:null)},getRecords:function(t){return this.xpath(t,this.records)},records:"/*/item",child:"item",config:"/*/config",getDetails:function(t){return this.tagToObject(t,{})},getOptions:function(){return!1},getInfo:function(t){var e=this.xpath(t,this.config);return e=e.length?this.assignTypes(this.tagToObject(e[0],{})):null,{size:t.documentElement.getAttribute("total_count")||0,from:t.documentElement.getAttribute("pos"),parent:t.documentElement.getAttribute("parent")||0,config:e}},xpath:function(t,e){if(window.XPathResult){var i=t;-1==t.nodeName.indexOf("document")&&(t=t.ownerDocument);for(var s=[],n=t.evaluate(e,i,null,XPathResult.ANY_TYPE,null),a=n.iterateNext();a;)s.push(a),a=n.iterateNext();return s}var r=!0;try{void 0===t.selectNodes&&(r=!1)}catch(t){}if(r)return t.selectNodes(e);var o=e.split("/").pop();return t.getElementsByTagName(o)},assignTypes:function(t){for(var i in t){var s=t[i];if("object"==e(s))this.assignTypes(s);else if("string"==typeof s){if(""===s)continue;"true"==s?t[i]=!0:"false"==s?t[i]=!1:s==1*s&&(t[i]=1*t[i])}}return t},tagToObject:function(t,e){var i=0;if(1==t.nodeType&&t.getAttribute("stack")){e=[];for(var s=t.childNodes,n=0;n<s.length;n++)1==s[n].nodeType&&e.push(this.tagToObject(s[n],{}))}else{e=e||{};var a=t.attributes;if(a&&a.length)for(var r=0;r<a.length;r++)e[a[r].name]=a[r].value,i=1;for(var o=t.childNodes,l=0;l<o.length;l++)if(1==o[l].nodeType){var h=o[l].tagName;e[h]?("function"!=typeof e[h].push&&(e[h]=[e[h]]),e[h].push(this.tagToObject(o[l],{}))):e[h]=this.tagToObject(o[l],{}),i=2}if(!i)return this.nodeValue(t);i<2&&(e.value=e.value||this.nodeValue(t))}return e},nodeValue:function(t){return t.firstChild?t.firstChild.wholeText||t.firstChild.data:""},fromString:function(t){try{if(window.DOMParser)return(new DOMParser).parseFromString(t,"text/xml");if(window.ActiveXObject){var e=new ActiveXObject("Microsoft.xmlDOM");return e.loadXML(t),e}}catch(t){return f(0,t),null}f(0,"Load from xml string is not supported")}},J={toObject:function(t){if(!t)return null;if("string"==typeof t)try{if(this.parseDates){var e=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(.\d{1-3})?Z/;t=JSON.parse(t,(function(t,i){return"string"==typeof i&&e.test(i)?new Date(i):i}))}else t=JSON.parse(t)}catch(e){return g(e),g(t),f(0,"Invalid JSON data for parsing"),null}return t},getRecords:function(t){return t&&t.data&&(t=t.data),t&&!B(t)?[t]:t},getDetails:function(t){return"string"==typeof t?{id:t||T(),value:t}:t},getOptions:function(t){return t.collections},getInfo:function(t){return{size:t.total_count||0,from:t.pos,parent:t.parent||0,config:t.config}},child:"data",parseDates:!1};function Z(t,e,i){return 0!==arguments.length?(new Z).get(t,e,i):this&&this.getXHR?this:new Z}Z.count=0,Z.prototype={master:null,getXHR:function(){return new XMLHttpRequest},stringify:function(t){return z(t)},_send:function(t,i,s,n){var a;i&&(B(i)||"function"==typeof(i.success||i.error||i))&&(a=s,s=i,i=null);var r=d.defer(),o=this.getXHR(),l=this._header||{};if(!U("onBeforeAjax",[n,t,i,o,l,null,r]))return r.reject(o);var h=!1;if("GET"!==n){var c=!1;for(var u in l)"content-type"==u.toString().toLowerCase()&&(c=!0,"application/json"==l[u]&&(h=!0));c||window.FormData&&i instanceof window.FormData||(l["Content-Type"]="application/x-www-form-urlencoded")}if("object"==e(i)&&!(window.FormData&&i instanceof window.FormData))if(h)i=this.stringify(i);else{var _=[];for(var p in i){var f=i[p];null==f&&(f=""),"object"===e(f)&&(f=this.stringify(f)),_.push(encodeURIComponent(p)+"="+encodeURIComponent(f))}i=_.join("&")}i&&"GET"===n&&(t=t+(-1!=t.indexOf("?")?"&":"?")+i,i=null),o.open(n,t,!this._sync);var g=this._response;for(var m in g&&(o.responseType=g),l)o.setRequestHeader(m,l[m]);var v=this;return this.master=this.master||a,o.onreadystatechange=function(){if(!o.readyState||4==o.readyState){Z.count++;var t,e,i=o.status>=400||0===o.status;"blob"==o.responseType||"arraybuffer"==o.responseType?(t="",e=o.response):(t=o.responseText||"",e=v._data(o)),i?(U("onAjaxError",[o]),r.reject(o),s&&Z.$callback(v.master||window,s,t,e,o,i)):(r.resolve(e),s&&Z.$callback(v.master||window,s,t,e,o,i))}},this._timeout&&(o.timeout=this._timeout),this._sync?o.send(i||null):setTimeout((function(){o.send(i||null)}),0),this.master&&!this._sync&&r.then((function(t){return v.master=null,s=v=a=null,t})),this._sync?o:r},_data:function(t){return{xml:function(){try{return X.tagToObject(X.toObject(t.responseText,this))}catch(e){g(t.responseText),g(e.toString()),f(0,"Invalid xml data for parsing")}},rawxml:function(){return window.XPathResult?t.responseXML:X.fromString(t.responseText)},text:function(){return t.responseText},json:function(){return J.toObject(t.responseText,!1)}}},get:function(t,e,i){return this._send(t,e,i,"GET")},post:function(t,e,i){return this._send(t,e,i,"POST")},put:function(t,e,i){return this._send(t,e,i,"PUT")},del:function(t,e,i){return this._send(t,e,i,"DELETE")},patch:function(t,e,i){return this._send(t,e,i,"PATCH")},sync:function(){return this._sync=!0,this},timeout:function(t){return this._timeout=t,this},response:function(t){return this._response=t,this},headers:function(e){return this._header=t.extend(this._header||{},e),this},bind:function(t){return this.master=t,this}},Z.$callback=function(t,e,i,s,n,a){if(!t.$destructed&&(a&&U("onAjaxError",[n]),e)){var r=e.success||e;a&&(r=e.error),r&&r.call&&r.call(t,i,s,n)}};var Q={$proxy:!0,load:function(){var t=this.source.split("@"),e=t[0].split(".").pop();return Z().response("arraybuffer").get(t[0]).then((function(i){return{data:i,options:{ext:e,dataurl:t[1]}}}))}},tt={$proxy:!0,load:function(){},save:function(t,e,i){j((function(){window.console.log("[DP] "+e.id+" -> "+e.operation,e.data);var t={id:e.data.id,newid:e.data.id,status:e.data.operation};i.processResult(t,t)}))}},et={$proxy:!0,load:function(){return Z(this.source)},save:function(t,e){return et._save_logic.call(this,e,Z())},_save_logic:function(t,e){var i=this.source,s="",n=i.indexOf("?");-1!==n&&(s=i.substr(n),i=i.substr(0,n)),i+="/"==i.charAt(i.length-1)?"":"/";var a=t.operation,r=t.data;return"insert"==a&&delete r.id,"update"==a?e.put(i+r.id+s,r):"delete"==a?e.del(i+r.id+s,r):e.post(i+s,r)}},it={$proxy:!0,load:function(){return Z(this.source)},save:function(t,e){var i=Z().headers({"Content-Type":"application/json"});return et._save_logic.call(this,e,i)}},st={$proxy:!0,load:function(e,i){return i=t.extend(i||{},this.params||{},!0),Z().post(this.source,i)}};function nt(t){if(!t||"object"===!e(t)||Array.isArray(t))return t;var i="",s=0;for(var n in t){if(2==++s)return t;i=n}return t[i]}var at={$proxy:!0,save:function(t){return this.load(t)},load:function(t){var e={query:this.source};return 1===arguments.length&&(e.variables=t),Z().headers({"Content-type":"application/json"}).post(this.url,e).then((function(t){return nt(t.json().data)}))}};function rt(e,i,s){f(rt[e],"Invalid proxy name: "+e);var n=I(rt[e]);return n.source=i,s&&t.extend(n,s,!0),n.init&&n.init(),n}rt.$parse=function(t){if("string"==typeof t&&-1!=t.indexOf("->")){var e=t.split("->");return rt(e[0],e[1])}return t},rt.binary=Q,rt.debug=tt,rt.json=it,rt.post=st,rt.rest=et,rt.GraphQL=at;var ot={toObject:function(t){return"string"==typeof t?JSON.parse(t):t},getRecords:function(t){return t&&t.data&&(t=t.data),t},getDetails:function(t){for(var e={},i=0;i<t.length;i++)e["data"+i]=t[i];return null!==this.idColumn&&(e.id=t[this.idColumn]),e},getOptions:function(){return!1},getInfo:function(){return{size:0}},idColumn:null},lt={toObject:function(t){if("string"==typeof t){var e=null;return-1==t.indexOf("<")&&(e=F(t)),e||((e=document.createElement("DIV")).innerHTML=t),e.firstChild}return t},getRecords:function(t){return t.getElementsByTagName(this.tag)},getDetails:function(t){return X.tagToObject(t)},getOptions:function(){return!1},getInfo:function(){return{size:0}},tag:"LI"},ht=0,ct={},dt={};function ut(){ht||(ht=document.onselectstart),document.onselectstart=It}function _t(){0!==ht&&(document.onselectstart=ht||null),ht=0}function pt(t){for(var e=0;t=t.previousSibling;)e++;return e}function ft(t,e){var i="";for(var s in e=e||"",t)i+=s+":"+t[s]+";";var n=dt[i+e];return n||(gt("."+(n="s"+T())+(e||"")+"{"+i+"}"),dt[i+e]=n),n}function gt(t,e){var i=e?ct[e]:ct.default;i||((i=document.createElement("style")).setAttribute("type","text/css"),i.setAttribute("media","screen,print"),document.getElementsByTagName("head")[0].appendChild(i),e?ct[e]=i:ct.default=i),i.appendChild(document.createTextNode(t))}function mt(t){var e=ct[t||"default"];e&&(e.innerHTML="")}function vt(t,e,i){e=e||{};var s=document.createElement(t);for(var n in e)s.setAttribute(n,e[n]);return e.style&&(s.style.cssText=e.style),e.class&&(s.className=e.class),i&&(s.innerHTML=i),s}function bt(t){return(t=F(t))?E(t.value)?t.innerHTML:t.value:""}function wt(t){if(t instanceof Array)for(var e=0;e<t.length;e++)wt(t[e]);else t&&t.parentNode&&t.parentNode.removeChild(t)}function yt(t,e,i){t&&(e&&e.parentNode?e.parentNode.insertBefore(t,e):i.appendChild(t))}function xt(t,e){var i;for(i=t.tagName?t:t.target;i;){if(i.getAttribute){var s=i.getAttribute(e);if(s)return s}i=i.parentNode}return null}function kt(t){var e=t.getBoundingClientRect(),i=document.body,s=document.documentElement,n=window.pageYOffset||s.scrollTop||i.scrollTop,a=window.pageXOffset||s.scrollLeft||i.scrollLeft,r=s.clientTop||i.clientTop||0,o=s.clientLeft||i.clientLeft||0,l=e.top+n-r,h=e.left+a-o;return{y:Math.round(l),x:Math.round(h),width:t.offsetWidth,height:t.offsetHeight}}function Ct(t){return{x:t.offsetX,y:t.offsetY}}function $t(t){return t.type?(t.touches&&t.touches[0]&&(t=t.touches[0]),{x:t.pageX,y:t.pageY}):{x:t.x,y:t.y}}function St(t){return t.preventDefault(),It(t)}function It(t){return t.stopPropagation(),!1}function At(e,i,s,n){var a;"function"==typeof window[i]?(n=t.extend(n||{},{bubbles:!0,cancelable:!0}),a=new window[i](s,n)):(a=document.createEvent(i)).initEvent(s,!0,!0),e.dispatchEvent(a)}function Dt(t,e,i){i&&-1!==t.className.indexOf(e)||(t.className+=" "+e)}function Et(t,e){t.className=t.className.replace(RegExp(" "+e,"g"),"")}function jt(t,i,s){var n=vt("DIV",{class:"webix_view webix_measure_size "+(i||"")},"");n.style.cssText="height:auto;visibility:hidden; position:absolute; top:0px; left:0px; overflow:hidden;"+(s?"width:"+s+"px;":"width:auto;white-space:nowrap;"),document.body.appendChild(n);for(var a="object"!==e(t)?[t]:t,r=0,o=0,l=0;l<a.length;l++){n.innerHTML=a[l];var h=n.getBoundingClientRect();r=Math.max(r,Math.ceil(h.width)),o=Math.max(o,Math.ceil(h.height))}return wt(n),{width:r,height:o}}function Vt(t,i){var s=!1;if("object"==e(t)){if(window.navigator.msSaveBlob)return window.navigator.msSaveBlob(t,i);t=window.URL.createObjectURL(t),s=!0}var n=document.createElement("a");n.href=t,n.download=i,document.body.appendChild(n),n.click(),j((function(){s&&window.URL.revokeObjectURL(t),document.body.removeChild(n),n.remove()}))}function Nt(t){if(!t)return"";var e=t.className||"";return e.baseVal&&(e=e.baseVal),e.indexOf||(e=""),e}function Tt(t,e,i){t.focus(),t.setSelectionRange&&(e=e||0,i=i||e,t.setSelectionRange(e,i))}function Ft(t){return{start:t.selectionStart||0,end:t.selectionEnd||0}}function Pt(t,e){document.getElementsByTagName("head").item(0).appendChild(vt("meta",{name:t,content:e}))}var Bt=Object.freeze({denySelect:ut,allowSelect:_t,index:pt,createCss:ft,addStyle:gt,removeStyle:mt,create:vt,getValue:bt,remove:wt,insertBefore:yt,locate:xt,offset:kt,posRelative:Ct,pos:$t,preventEvent:St,stopEvent:It,triggerEvent:At,addCss:Dt,removeCss:Et,getTextSize:jt,download:Vt,_getClassName:Nt,setSelectionRange:Tt,getSelectionRange:Ft,addMeta:Pt}),Mt={toObject:function(t){f(t=F(t),"table is not found"),f("table"===t.tagName.toLowerCase(),"Incorrect table object");var e=t.rows;return wt(t),e},getRecords:function(t){for(var e=[],i=t[0]&&t[0]._webix_skip?1:0;i<t.length;i++)e.push(t[i]);return e},getDetails:function(t){var e=t.getElementsByTagName("td");t={};for(var i=0;i<e.length;i++)t["data"+i]=e[i].innerHTML;return t},getInfo:function(){return{size:0}},getOptions:function(){},getConfig:function(e){var i=[],s=e[0].getElementsByTagName("th");s.length&&(e[0]._webix_skip=!0);for(var n=0;n<s.length;n++){var a={id:"data"+n,header:this._de_json(s[n].innerHTML)},r=this._get_attrs(s[n]);a=t.extend(a,r),i.push(a)}return i},_de_json:function(t){var e=t.indexOf("json://");return-1!=e&&(t=JSON.parse(t.substr(e+7))),t},_get_attrs:function(t){for(var e=t.attributes,i={},s=0;s<e.length;s++)i[e[s].nodeName]=this._de_json(e[s].nodeValue);return i.width=parseInt(i.width,10),i}},Ot={cdn:"//cdn.webix.com",codebase:"",zIndexBase:100,scrollSize:17};Ot.strict=!!window.webix_strict,Ot.https="https:"===document.location.protocol;var Lt=navigator.userAgentData,Rt=Lt&&Lt.platform&&Lt.brands.length?null:navigator.userAgent,zt={Chromium:"Chrom",IE:"Trident",Edge:"Edg",FF:"Firefox",Safari:"Safari"},Ht=function(t){if((Rt?-1!=Rt.indexOf(zt[t]):Lt.brands.find((function(e){return-1!=e.brand.indexOf(zt[t])})))&&(Ot["is"+t]=!0,"Chromium"!=t))return"break"};for(var qt in zt)if("break"===Ht(qt))break;var Ut=Rt||Lt.platform;Ot.isMac=-1!=Ut.toLowerCase().indexOf("mac"),/iPad|iPhone|iPod/.test(Ut)&&(Ot.isIOS=!0),-1!=Ut.indexOf("Android")&&(Ot.isAndroid=!0),Rt?(Ot.isIOS||Ot.isAndroid||-1!=Rt.indexOf("Mobile")||-1!=Rt.indexOf("Windows Phone"))&&(Ot.mobile=!0):Ot.mobile=Lt.mobile,(Ot.mobile||navigator.maxTouchPoints>1)&&(Ot.touch=!0),Ot.fastClick=!Ot.touch,(Ot.isIE||Ot.isEdge||Ot.isFF)&&(Ot.maxHTMLElementSize=1e7),Ot.isSafari&&(Ot.maxHTMLElementSize=1e8),Ot.transform="transform",Ot.transition="transition",Ot.transitionDuration="transitionDuration",Ot.translate="translate3d",Ot.transitionEnd="transitionend",Ot.passiveEventListeners=!1;try{var Wt=Object.defineProperty({},"passive",{get:function(){Ot.passiveEventListeners=!0}});window.addEventListener("testPassive",null,Wt),window.removeEventListener("testPassive",null,Wt)}catch(t){}Ot.svg=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),Ot.svganimation=document.implementation.hasFeature("https://www.w3.org/TR/SVG11/feature#SVG-animation","1.1");var Yt={};function Gt(t,e,i){var s=d.defer();if(e&&!0!==e&&(s=s.then((function(){e.call(i||this)}))),Gt.disabled)return s.resolve(),s;if("string"!=typeof t){var n=t.length||0;if(n){var a=function(){n?(n--,Gt(t[t.length-n-1]).then(a,(function(){return s.reject()}))):s.resolve()};a()}else{for(var r in t)n++;var o=function(){0==--n&&s.resolve()};for(var l in t)Gt(l).then(o,(function(){return s.reject()}))}return s}if(!0!==Yt[t]){var h=t;if(!0===e)return D(Z().sync().get(h).responseText),Yt[t]=!0,s.resolve();if(Yt[t])return Yt[t].push(s),s;Yt[t]=[s];var c=function(){var e=Yt[t];Yt[t]=!1;for(var i=0;i<e.length;i++)e[i].reject()},u=function(){var e=Yt[t];Yt[t]=!0;for(var i=0;i<e.length;i++)e[i].resolve()},_=t.split("?");if(".css"==_[0].substr(_[0].length-4)){var p=vt("LINK",{type:"text/css",rel:"stylesheet",href:h});p.onload=u,p.onerror=c,document.getElementsByTagName("head")[0].appendChild(p)}else{var f=document.createElement("script");f.onload=u,f.onerror=c,document.getElementsByTagName("head")[0].appendChild(f),f.src=h}}else s.resolve();return s}var Kt=t.extend({toObject:function(e){if(!e.excel){var i=e.options||{};i.dataurl&&t.extend(i,this._urlToOptions(i.dataurl)),e=e.data||e;var s=d.defer();if(e.name){i.ext=e.name.split(".").pop();var n=new FileReader;n.onload=A((function(t){s.resolve(this.parseData(t.target.result,i))}),this),n.readAsArrayBuffer(e)}else s.resolve(this.parseData(e,i));return s}return e},parseData:function(e,i){e=new Uint8Array(e);for(var s=[],n=0;n!=e.length;++n)s[n]=String.fromCharCode(e[n]);var a=(i.ext||i).toLowerCase();return"xls"!=a&&(a="xlsx"),Gt(Ot.cdn+"/extras/xlsx.core.styles.min.js").then(A((function(){var e=("xls"==a?XLS:XLSX).read(s.join(""),{type:"binary",cellStyles:!0,cellDates:!!E(i.cellDates)||i.cellDates,sheetStubs:i.sheetStubs}),n={sheets:e.Sheets,names:e.SheetNames,options:i,ranges:e.Workbook&&e.Workbook.Names||[],states:e.Workbook.Sheets.map((function(t){return["visible","hidden","veryHidden"][t.Hidden]}))};return t.extend(this.getSheet(n,i),n)}),this))},getSheet:function(t,e){var i=e.name||t.names[0];return t=this.sheetToArray(t.sheets[i],e),e.rows&&e.rows.length&&(t.data=t.data.splice(e.rows[0],Math.min(e.rows[1],t.data.length)-e.rows[0])),t},sheetToArray:function(t,e){var i=[],s=[],n=[],a=[],r=[],o=[],l={n:"number",d:"date",s:"string",b:"boolean"};if(t&&t["!ref"]){var h,c,d,u=XLS.utils.decode_range(t["!ref"]),_=u.s.c,p=u.s.r+(e.rows?e.rows[0]:0);for(h=u.s.r;h<=u.e.r;h++){var f=[];for(c=u.s.c;c<=u.e.c;c++)if(d=t[XLS.utils.encode_cell({r:h,c})]){var g;g=e.math&&d.f?"="==d.f.charAt(0)?d.f:"="+d.f:"d"==d.t&&M(d.v)?R.dateFormatStr(d.v):d.v,f.push(g),d.s&&n.push([h-p,c-_,d.s]),d.t&&r.push([h-p,c-_,l[d.t]])}else f.push("");i.push(f)}if(t["!merges"])for(var m=t["!merges"],v=0;v<m.length;v++){var b=m[v].s,w=m[v].e;(!e.rows||b.r-p>=0&&w.r-p<=e.rows[1])&&s.push([b.r-p,b.c-_,w.c-b.c+1,w.r-b.r+1])}if(t["!cols"])for(var y=t["!cols"],x=0;x<y.length;x++){var k=y[x];if(k){var C=x-_;a.push(["column",C,Math.round(k.wch/(8.43/70))]),k.hidden&&o.push(["column",C])}}if(t["!rows"])for(var $=t["!rows"],S=0;S<$.length;S++){var I=$[S];if(I){var A=S-p;a.push(["row",A,I.hpx]),I.hidden&&o.push(["row",A])}}}return{data:i,spans:s,styles:n,sizes:a,types:r,hidden:o,excel:!0}},_urlToOptions:function(t){var e=t.split("["),i={};if(i.name=e[0],e[1]){var s=e[1].split(/[^0-9]+/g);s[0]=1*s[0]||0,s[1]=1*s[1]||9999999,i.rows=s}return i}},ot),Xt={json:J,jsarray:ot,xml:X,csv:{toObject:function(t){return t},getRecords:function(t){return t.split(this.row)},getDetails:function(t){t=this.stringToArray(t);for(var e={},i=0;i<t.length;i++)e["data"+i]=t[i];return null!==this.idColumn&&(e.id=t[this.idColumn]),e},getOptions:function(){return!1},getInfo:function(){return{size:0}},stringToArray:function(t){t=t.split(this.cell);for(var e=0;e<t.length;e++)t[e]=t[e].replace(/^[ \t\n\r]*("|)/g,"").replace(/("|)[ \t\n\r]*$/g,"");return t},idColumn:null,row:"\n",cell:","},html:lt,htmltable:Mt,excel:Kt},Jt={},Zt={$init:function(t){this._data_generation=0,this.data={},this.waitData=d.defer(),t&&(this._settings.datatype=t.datatype||"json"),this.$ready.push(this._load_when_ready)},_load_when_ready:function(){this._ready_for_data=!0,this._settings.url&&this.url_setter(this._settings.url),this._settings.data&&this.data_setter(this._settings.data)},url_setter:function(t){return t=rt.$parse(t),this._ready_for_data?(this.load(t,this._settings.datatype),t):t},data_setter:function(t){return this._ready_for_data?(this.parse(t,this._settings.datatype),!0):t},load:function(t,e,i,s){var n,a=this;"string"==typeof e&&(n=e,e=arguments[2]);var r=this._fetch(t,n,i||null);if(r&&r.then)return r.then((function(t){return a._onLoad(t,s),e&&Z.$callback(a,e,"",t,-1),t}),(function(t){return a._onLoadError(t)}))},_fetch:function(t,e,i){var s,n=this;if(!e&&this.data.driver||(this.data.driver=Xt[e||"json"]),!this.callEvent("onBeforeLoad",[]))return d.reject();(s=(t=rt.$parse(t)).$proxy&&t.load?t.load(this,i):"function"==typeof t?t.call(this,i):Z().bind(this).get(t))&&!s.then&&(s=d.resolve(s));var a=++this._data_generation;return s&&s.then?s.then((function(t){return n.$destructed||n._data_generation!==a?d.reject(Jt):t})):s},parse:function(t,e,i){var s=this;if(t&&"function"==typeof t.then){var n=++this._data_generation;return t.then((function(t){if(s.$destructed||s._data_generation!==n)return d.reject();s.parse(t,e,i)}))}if(t&&t.sync&&this.sync)this._syncData(t);else{if(!this.callEvent("onBeforeLoad",[]))return d.reject();!e&&this.data.driver||(this.data.driver=Xt[e||"json"]),this._onLoad(t,i)}return d.resolve()},_syncData:function(t){this.data&&this.data.attachEvent&&this.data.attachEvent("onSyncApply",A((function(){this._call_onready&&this._call_onready()}),this)),this.sync(t)},_parse:function(t){var e,i,s=this.data.driver;e=(i=s.getRecords(t)[0])?I(s.getDetails(i)):{},this.setValues?this.setValues(e,!1,"auto"):this.data=e},_onLoadContinue:function(t,e){t?this.$onLoad&&this.$onLoad(t,this.data.driver,e)||(this.data&&this.data._parse?(e&&this.data.clearAll(!0),this.data._parse(t)):(e&&this.clearAll(!0),this._parse(t))):this._onLoadError(t),this._call_onready&&this._call_onready(),this.callEvent("onAfterLoad",[]),this.waitData.resolve()},_onLoad:function(t,e){var i=this;t&&"function"==typeof t.text&&!t.name&&(t=t.text()),(t=this.data.driver.toObject(t))&&t.then?t.then((function(t){return i._onLoadContinue(t,e)})):this._onLoadContinue(t,e)},_onLoadError:function(t){return t!==Jt&&(this.$destructed||(this.callEvent("onAfterLoad",[]),this.callEvent("onLoadError",arguments)),U("onLoadError",[t,this])),d.reject(t)},_check_data_feed:function(t){if(!this._settings.dataFeed||this._ignore_feed||!t)return!0;var e=this._settings.dataFeed;return"function"==typeof e?e.call(this,t.id||t,t):(e=e+(-1==e.indexOf("?")?"?":"&")+"action=get&id="+encodeURIComponent(t.id||t),!!this.callEvent("onBeforeLoad",[])&&(Z(e,(function(t,e,i){this._ignore_feed=!0;var s=Xt.json,n=s.toObject(t,e);n?this.setValues(s.getDetails(s.getRecords(n)[0]),!1,"auto"):this._onLoadError(i),this._ignore_feed=!1,this.callEvent("onAfterLoad",[])}),this),!1))}},Qt={collapseNames:function(t,i,s,n){if(s=s||{},i=i||"",n=n||function(){return!0},!t||"object"!=e(t))return null;for(var a in t){var r=t[a],o=i+a;r&&"object"==e(r)&&!M(r)&&!B(r)&&n(o)?Qt.collapseNames(r,o+".",s,n):s[o]=r}return s},expandNames:function(t){var e,i,s,n,a,r={};for(a in t){for(i=(s=a.split(".")).length-1,n=r,e=0;e<i;e++)n[s[e]]||(n[s[e]]={}),n=n[s[e]];n[s[i]]=t[a]}return r}},te={},ee={},ie=new RegExp("(\\r\\n|\\n)","g"),se=new RegExp('(\\")',"g"),ne=new RegExp("(\\\\)","g"),ae={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},re=/[&<>"'`]/g,oe=function(t){return ae[t]||"&amp;"};function le(t){if("function"==typeof t)return t;if(te[t])return te[t];if(-1!=(t=(t||"").toString()).indexOf("->")){var e=t.split("->");switch(e[0]){case"html":t=bt(e[1]);break;case"http":t=(new Z).sync().get(e[1],{uid:T()}).responseText}}if(t=(t||"").toString(),Ot.strict){if(!ee[t]){ee[t]=[];var i=[];if(t.replace(/\{obj\.([^}?]+)\?([^:]*):([^}]*)\}/g,(function(t,e,s,n,a){i.push({pos:a,str:t,fn:function(t){return t[e]?s:n}})})),t.replace(/\{common\.([^}(]*)\}/g,(function(t,e,s){i.push({pos:s,str:t,fn:function(t,i){return i[e]||""}})})),t.replace(/\{common\.([^}(]*)\(\)\}/g,(function(t,e,s){i.push({pos:s,str:t,fn:function(t,i){return i[e]?i[e].apply(this,arguments):""}})})),t.replace(/\{obj\.([^:}]*)\}/g,(function(t,e,s){i.push({pos:s,str:t,fn:function(t){return t[e]}})})),t.replace("{obj}",(function(t,e){i.push({pos:e,str:t,fn:function(t){return t}})})),t.replace(/#([^#'";, ]+)#/gi,(function(t,e,s){"!"==e.charAt(0)?(e=e.substr(1),i.push({pos:s,str:t,fn:function(t){return-1!=e.indexOf(".")&&(t=Qt.collapseNames(t)),le.escape(t[e])}})):i.push({pos:s,str:t,fn:function(t){return-1!=e.indexOf(".")&&(t=Qt.collapseNames(t)),t[e]}})})),i.sort((function(t,e){return t.pos>e.pos?1:-1})),i.length){for(var s=0,n=function(t,e,i){ee[t].push((function(){return t.slice(e,i)}))},a=0;a<i.length;a++){var r=i[a].pos;n(t,s,r),ee[t].push(i[a].fn),s=r+i[a].str.length}n(t,s,t.length)}else ee[t].push((function(){return t}))}return function(){for(var e="",i=0;i<ee[t].length;i++)e+=ee[t][i].apply(this,arguments);return e}}var o=!1;t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(ne,"\\\\")).replace(ie,"\\n")).replace(se,'\\"')).replace(/\{obj\.([^}?]+)\?([^:]*):([^}]*)\}/g,'"+(obj.$1?"$2":"$3")+"')).replace(/\{common\.([^}(]*)\}/g,"\"+(common.$1||'')+\"")).replace(/\{common\.([^}(]*)\(\)\}/g,'"+(common.$1?common.$1.apply(this, arguments):"")+"')).replace(/\{obj\.([^}]*)\}/g,'"+(obj.$1)+"')).replace("{obj}",'"+obj+"')).replace(/#([^#'";, ]+)#/gi,(function(t,e){return"!"==e.charAt(0)?(o=!0,'"+template.escape(obj.'+e.substr(1)+')+"'):'"+(obj.'+e+')+"'}));try{if(o){var l=Function("obj","common","marks","value","template",'return "'+t+'";');te[t]=function(t,e,i,s){return l(t,e,i,s,le)}}else te[t]=Function("obj","common",'return "'+t+'";')}catch(e){f(0,"Invalid template:"+t)}return te[t]}le.escape=function(t){return null==t?"":(t.toString()||"").replace(re,oe)},le.empty=function(){return""};var he={_toHTML:function(t){return t.$empty?"":this._settings.template(t,this)},render:function(){var t=this._settings;return!!this.isVisible(t.id)&&(this.callEvent&&!this.callEvent("onBeforeRender",[this.data])||(this.data&&!t.content&&(this._dataobj.innerHTML="",this._dataobj.innerHTML=this._toHTML(this.data)),this.callEvent&&this.callEvent("onAfterRender",[])),!0)},sync:function(t){this._backbone_sync=!1,"DataStore"!=t.name&&(t.data&&"DataStore"==t.data.name?t=t.data:this._backbone_sync=!0),this._backbone_sync?t.bind("change",A((function(t){t.id==this.data.id&&(this.data=t.attributes,this.refresh())}),this)):t.attachEvent("onStoreUpdated",A((function(e){e&&e!=this.data.id||(this.data=t.pull[e],this.refresh())}),this))},template_setter:le},ce={_auto_scroll:function(t){var e,i,s=this._settings.dragscroll;"string"!=typeof s&&(s=this._settings.layout||"xy"),i=-1!==s.indexOf("x"),e=-1!==s.indexOf("y");var n=kt(this._body||this.$view),a=Math.max((this._settings.rowHeight||(this.type&&!isNaN(parseFloat(this.type.height))?this.type.height:0))+5,40),r=!1;e&&this._auto_y_scroll(t,n,a)&&(r=!0),i&&this._auto_x_scroll(t,n,a)&&(r=!0),r&&(this._auto_scroll_delay=j(this._auto_scroll,this,[t],100))},_auto_scroll_column:function(t){var e=this._settings.dragscroll;if("string"!=typeof e||-1!==e.indexOf("x")){var i=kt(this._header||this.$view),s=Math.max(this._settings.headerRowHeight||0,40);this._auto_x_scroll(t,i,s)&&(this._auto_scroll_delay=j(this._auto_scroll_column,this,[t],100))}},_auto_y_scroll:function(t,e,i){var s=e.y,n=s+e.height,a=this.getScrollState(),r=this._settings;if(r.topSplit){var o=this._cellPosition(this.getIdByIndex(r.topSplit-1),this.columnId(0));s+=o.top+o.height}return t.y<s+i?this._auto_scrollTo(a.x,a.y-2*i,t,"y"):t.y>n-i&&this._auto_scrollTo(a.x,a.y+2*i,t,"y")},_auto_x_scroll:function(t,e,i){var s=e.x,n=s+e.width,a=this.getScrollState();return t.x<s+i?this._auto_scrollTo(a.x-2*i,a.y,t,"x"):t.x>n-i&&this._auto_scrollTo(a.x+2*i,a.y,t,"x")},_auto_scrollTo:function(t,e,i,s){if(this.callEvent("onBeforeAutoScroll",[i])){this.scrollTo(t,e),this.callEvent("onAfterAutoScroll",[]);var n=this.getScrollState(),a=this._render_scroll_shift?0:this._render_scroll_diff||0;return Math.abs(("x"===s?t:e)-n[s]+a)<1}return!1}},de={};function ue(){for(var t in de)fe(t)}function _e(t,e,i,s){(s=s||{}).inner=!0,pe(t,e,i,s)}function pe(t,e,i,s){s=s||{},f(t=F(t),"Invalid node as target for webix.event");var n=s.id||T();s.bind&&(i=A(i,s.bind));var a=[t,e,i,s.capture];s.inner||(de[n]=a);var r=!!s.capture;return!E(s.passive)&&Ot.passiveEventListeners&&(r={passive:s.passive,capture:r}),t.addEventListener(e,i,r),n}function fe(t){if(t){f(de[t],"Removing non-existing event");var e=de[t];e[0].removeEventListener(e[1],e[2],!!e[3]),delete de[t]}}function ge(t,e){if(t.$protoWait)return t._webix_type_wait||(t._webix_type_wait=[]),void t._webix_type_wait.push(e);"function"==typeof t&&(t=t.prototype),t.types||(t.types={default:t.type},t.type.name="default");var i=e.name,s=t.type;for(var n in i&&(s=t.types[i]=S(e.baseType?t.types[e.baseType]:t.type)),e)0===n.indexOf("template")?s[n]=le(e[n]):s[n]=e[n];return i}var me={top_views:[],_global_scope:null,_global_collection:null,_child_sizing_active:null,_responsive_exception:null,_responsive_tinkery:null,_freeze_resize:null,_parent_cell:null,_focus_time:null,_ui_creation:0,_edit_open_time:null,_final_destruction:null,_events:[],destructors:[],_noselect_element:null,_modality:[],_popups:O(),_wait_animate:null},ve={};function be(t,e,i){var s;me._ui_creation++;var n=me._global_scope,a=me._global_collection;me._global_scope=t.$scope||n;try{s=function(t,e,i){var s,n=B(t),a=F(t.container||e||document.body);a._settings&&(i=function(t,e,i){var s=[t];if(e)s=t.getChildViews();else if(t._body_cell)s=[t._body_cell];else{if("number"==typeof i)return i;if(i)return ye(s=[ke(i)]),s[0].config.id}return ye(s),i}(a,n,i));var r=!1,o=a==document.body;if(t._settings||a&&n?(s=t,r=!0):(a&&o&&(t.$topView=!0),t._inner||(t._inner={}),e&&e.getParentView&&(me._parent_cell=i||0===i?e:e.getParentView()),s=xe(t)),!o||s.setPosition||s.$apiOnly||p("fixHeight")(),s._settings&&s._settings._hidden&&!a.$view)s._settings._container=a;else if(!s.$apiOnly)if(a.appendChild)we(a,s,t);else if(a.destructor){var l=a;if(i||0===i||B(s)||(i=a,a=a.getParentView()),a&&a._replace){if(r&&s.getParentView){var h=s.getParentView();h&&h._remove&&h._remove(s),s._parent_cell=a,s.$scope=a.$scope}a._replace(s,i)}else{var c=l.$view.parentNode;l.destructor(),we(c,s,t)}}else f(0,"Not existing parent:"+t.container);return s}(t,e,i)}finally{me._ui_creation--,me._global_scope=n,me._global_collection=a}return s}function we(t,e,i){t.appendChild(e._viewobj),e.getParentView()||(((!e.setPosition||e._settings.fullscreen)&&t==document.body||e._settings.position)&&me.top_views.push(e._destructor_handler),i.skipResize||e.adjust())}function ye(t){for(var e=t.length-1;e>=0;e--){var i=t[e];delete ve[i.config.id],i.config.id="x"+T(),ve[i.config.id]=i,i.getChildViews&&ye(i.getChildViews()),i._destroy_with_me&&ye(i._destroy_with_me)}}function xe(t){var e=t.cells||t.rows||t.elements||t.cols;if(e)for(var i=0;i<e.length;i++)null!==e[i]&&void 0!==e[i]||f(0,"You have trailing comma or Null element in collection's configuration");if(t.view){var s=t.view;return f(be[s],"unknown view:"+s),new be[s](t)}if(t.rows||t.cols){for(var n=t.rows||t.cols,a=!1,r=0;r<n.length;r++)!n[r].body||n[r].view||n[r].align||(a=!0);return a?new be.headerlayout(t):new be.layout(t)}return t.cells?new be.multiview(t):t.template||t.content?new be.template(t):t.align&&t.body?new be.align(t):new be.spacer(t)}function ke(t){if(!t)return null;if(ve[t])return ve[t];var i=t;if("object"==e(t)){if(t._settings)return t;i=t.target||t}return ve[xt({target:F(i)},"view_id")]}if(be.views=ve,be._view=xe,void 0===window.$$&&(window.$$=ke),t.protoUI=function(){var e=arguments[0].name,i=function(s){if(!i)return be[e].prototype;var n=i.$protoWait;if(n){for(var a=[n[0]],r=1;r<n.length;r++)a[r]=n[r],a[r].$protoWait&&(a[r]=a[r].call(-1,a[r].name)),a[r].prototype&&a[r].prototype.name&&(be[a[r].prototype.name]=a[r]);if(be[e]=t.proto.apply(-1,a),i._webix_type_wait)for(var o=0;o<i._webix_type_wait.length;o++)ge(be[e],i._webix_type_wait[o]);i=n=null}return-1!=this?new be[e](s):be[e]};return i.$protoWait=Array.prototype.slice.call(arguments,0),be[e]=i},t.proto=function(){var t=arguments,e=t[0],i=!!e.$init,s=[];f(e,"Invalid mixing target");for(var n=t.length-1;n>0;n--){if(f(t[n],"Invalid mixing source"),"function"==typeof t[n]&&(t[n]=t[n].prototype),t[n].$init&&s.push(t[n].$init),t[n].defaults){var a=t[n].defaults;for(var r in e.defaults||(e.defaults={}),a)E(e.defaults[r])&&(e.defaults[r]=a[r])}if(t[n].type&&e.type)for(var o in t[n].type)e.type[o]||(e.type[o]=t[n].type[o]);for(var l in t[n])e[l]||!1===e[l]||(e[l]=t[n][l])}i&&s.push(e.$init),e.$init=function(){for(var t=0;t<s.length;t++)s[t].apply(this,arguments)},e.$skin&&e.$skin();var h=function(t){this.$ready=[],f(this.$init,"object without init method"),this.$init(t),this._parseSettings&&this._parseSettings(t,this.defaults);for(var e=0;e<this.$ready.length;e++)this.$ready[e].call(this)};return h.prototype=e,e=t=null,h},W("onClick",(function(t){var i=ke(t);if(i&&i.touchable){p("UIManager").applyChanges(i),i.getNode(t);var s=t.target;if(i.config.disabled)return;var n="";if(s.className&&0===s.className.toString().indexOf("webix_view"))return;for(i&&p("UIManager")._focus_action(i);s&&s.parentNode;){if(s.getAttribute){if(s.getAttribute("view_id"))break;if(n=s.className){n=n.toString().split(" ");for(var a=0;a<n.length;a++)if(i.on_click[n[a]]&&!1===i.on_click[n[a]].call(i,t,i._settings.id,s))return}}s=s.parentNode}if(i._settings.click){var r=P(i._settings.click,i.$scope);r&&r.call&&r.call(i,i._settings.id,t)}var o=i._settings.popup;!o||i._settings.readonly||t.longtouch_drag||("object"!=e(o)||o.name||(o=i._settings.popup=be(o)._settings.id,i._destroy_with_me.push(ke(o))),f(o=ke(o),"Unknown popup"),o.isVisible()||(o._settings.master=i._settings.id,o.show(i.getInputNode()||i.getNode(),null,!0))),i.callEvent("onItemClick",[i._settings.id,t])}})),window.webix_on_core_ready){var Ce=window.webix_on_core_ready({proto:t.proto,protoUI:t.protoUI});t.proto=Ce.proto,t.protoUI=Ce.protoUI}var $e={_tooltip_masters:O(["dummy"]),_tooltip_exist:0,overflow:!1,delay:400,addTooltip:function(t,e){var i,s,n=this;f(t=F(t),"Target isn't defined"),t instanceof Element?(i=t,"string"==typeof e?i.setAttribute("webix_tooltip",e):s=e):(i=t.$view,s=t),s=s||this;var a=this._tooltip_masters.find(s);-1===a&&(a=this._tooltip_masters.length,this._tooltip_masters.push(s)),i.webix_tooltip=a,this._tooltip_exist++,this._tooltip||(this._tooltip=new be.tooltip({}),this._tooltip._css_name="webix_tooltip webix_global_tooltip",this._webix_tooltip_mm=pe(document,"pointermove",(function(t){return n._move_tooltip(t)})),this._webix_tooltip_ml=pe(document,"pointerleave",(function(){return n._hide_tooltip()})),this._drag_event=W("onDragMode",(function(){return n._hide_tooltip()})),this._click_event=W("onClick",(function(){return n._hide_tooltip()})))},getTooltip:function(){return this._tooltip},_move_tooltip:function(t){if("mouse"===t.pointerType){for(var e={},i=t.target;i instanceof Element&&"HTML"!=i.tagName;){if(!e.first||!e.overflow){var s=i.getAttribute("webix_tooltip");e.first=e.first||s,s&&i.scrollWidth>i.clientWidth&&(e.overflow=s)}if(this._tooltip_masters[i.webix_tooltip])return this._last&&this._last!=i?(this.$tooltipOut(this._last,i,t),void(this._last=null)):(this._last||(this._last=this.$tooltipIn(i,t)),this.$tooltipMove(i,t,e));i=i.parentElement}this._last&&(this._last=this.$tooltipOut(this._last,null,t))}},_hide_tooltip:function(){clearTimeout(this._before_show_delay),this._tooltip.hide()},getMaster:function(t){return this._tooltip_masters[t.webix_tooltip]},removeTooltip:function(t){var e;f(t,"Target isn't defined");var i=(e=(t=F(t))instanceof Element?t:t.$view).webix_tooltip;i&&(this._last==e&&(this._hide_tooltip(),this._last=null),delete e.webix_tooltip,this._tooltip_exist--,this._tooltip_masters[i]=null),!this._tooltip_exist&&this._tooltip&&(this._webix_tooltip_mm=fe(this._webix_tooltip_mm),this._webix_tooltip_ml=fe(this._webix_tooltip_ml),this._drag_event=Y(this._drag_event),this._click_event=Y(this._click_event),this._tooltip.destructor(),this._tooltip=this._last=null,this._tooltip_masters=O(["dummy"]))},$tooltipIn:function(t,e){var i=this._tooltip_masters[t.webix_tooltip];return i.$tooltipIn&&i!=this?i.$tooltipIn(t,e):(this._tooltip.define({dx:20,dy:0,template:"",css:""}),t)},$tooltipOut:function(t,e,i){var s=this._tooltip_masters[t.webix_tooltip];return s.$tooltipOut&&s!=this?s.$tooltipOut(t,e,i):(this._hide_tooltip(),null)},$tooltipMove:function(t,e,i){var s=this._tooltip_masters[t.webix_tooltip];if(s.$tooltipMove&&s!=this)return s.$tooltipMove(t,e,i);var n=E(s.overflow)?this.overflow:s.overflow,a=E(s.delay)?this.delay:s.delay,r=n?i.overflow:i.first;a>0&&this._hide_tooltip(),this._before_show_delay=j(this._tooltip.show,this._tooltip,[r||{},$t(e)],a)}};function Se(t){return"$"+t+(Ie[t]=(Ie[t]||0)+1)}var Ie={},Ae=!1;function De(t,e){Ae=!0;var i=t();return i&&i.then?i=i.then((function(t){return Ae=!1,!1!==e&&Ee(),t})):(Ae=!1,!1!==e&&Ee()),i}function Ee(){if(p("UIManager").applyChanges(),U("onClick",[]),me._force_resize=!0,!Ae)for(var t=me.top_views.length-1;t>=0;t--)me.top_views[t].obj&&me.top_views[t].obj.resize();me._force_resize=!1}function je(t,e,i,s){if(t)for(var n=s?[t]:t.getChildViews(),a=0;a<n.length;a++)!1!==e.call(i,n[a])&&je(n[a],e,i)}function Ve(t){return E(t)?Ot.zIndexBase++:(Ot.zIndexBase=Math.max(Ot.zIndexBase,t+1),t)}function Ne(t){Te?t.call():Fe.push(t)}pe(window,"resize",(function(){Ot.touch&&me._focus_time&&new Date-me._focus_time<1e3||Ee()}));var Te=!1,Fe=[],Pe=document.getElementsByTagName("SCRIPT");f(Pe.length,"Can't locate codebase"),Pe.length&&((Pe=(Pe[Pe.length-1].getAttribute("src")||"").split("/")).splice(Pe.length-1,1),Ot.codebase=Pe.slice(0,Pe.length).join("/")+"/");var Be=function(){Ot.isIE&&(document.body.className+=" webix_ie"),U("onReady",[])},Me=function(){Te=!0,window.webix_ready&&B(webix_ready)&&(Fe=webix_ready.concat(Fe));for(var t=0;t<Fe.length;t++)Fe[t].call();Fe=[]};W("onReady",(function(t){t?Me():j(Me)})),"complete"==document.readyState?Be():pe(window,"load",Be),Ne((function(){pe(document.body,"click",(function(t){U("onClick",[t])}))}));var Oe={isEmail:function(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((t||"").toString())},isNumber:function(t){return parseFloat(t)==t},isChecked:function(t){return!!t||"0"===t},isNotEmpty:function(t){return 0===t||t}};function Le(t,e){if(-1!=t.type.indexOf("prompt"))if(!1===e)t._promise.reject();else{var i=t._box.querySelector(".webix_popup_input"),s=i.querySelector("input");if(t.input.required&&!s.value)return t.input.invalid=!0,void Dt(i,"webix_popup_invalid");e=s.value||"",t._promise.resolve(e)}-1!=t.type.indexOf("confirm")&&!1===e?t._promise.reject():t._promise.resolve(e);var n=t.callback;n&&n(e,t.details),ti.hide(t.id)}function Re(t){var e=ti.order,i=e.length,s=t.target;if(i>0&&ei.keyboard){var n,a=t.which||t.keyCode;if(13!=a&&32!=a&&27!=a)return;for(var r=i-1;r>=0;r--){var o=ti.pull[e[r]];if(o._box!=s&&o._box.contains(s)&&32==a)return;if(o.container&&o.container.contains(s)){n=o;break}}return n||(n=ti.pull[e[e.length-1]]),13==a||32==a?Le(n,!0):27==a&&Le(n,!1),St(t),!(t.cancelBubble=!0)}}function ze(t,e){var i,s=e||document.body;if(E(s.modality)){if((i=vt("DIV",{class:"webix_modal_cover",style:"position:"+(e?"absolute":"fixed")+";"})).onkeydown=Re,e){var n=window.getComputedStyle(e).position;"fixed"!=n&&"absolute"!=n&&"sticky"!=n&&"relative"!=n&&(s.style.position="relative")}s.appendChild(i),s.modality=1}else t?s.modality++:s.modality--;return(t&&1===s.modality||0===s.modality)&&(i=i||Array.prototype.slice.call(s.querySelectorAll(".webix_modal_cover")).filter((function(t){return t.parentNode==s}))[0])&&(s.modality?1==s.modality&&(i.style.display="inline-block",Dt(s,"webix_modalbox_inside")):(i.style.display="none",Et(s,"webix_modalbox_inside"))),i}function He(t,e,i){return"<div role='button' tabindex='0' aria-label='"+t+"' class='webix_popup_button"+(i?" "+i:"")+"' result='"+e+"' ><div>"+t+"</div></div>"}function qe(t){ii.area||(ii.area=document.createElement("DIV"),ii.area.className="webix_message_area",ii.area.style[ii.position]="5px",document.body.appendChild(ii.area)),ii.area.setAttribute("role","alert"),ii.area.setAttribute("aria-atomic",!0),ii.hide(t.id);var e=document.createElement("DIV");return e.innerHTML="<div>"+t.text+"</div>",e.className="webix_message webix_"+t.type,e.onclick=function(){t&&ii.hide(t.id),t=null},"bottom"==ii.position&&ii.area.firstChild?ii.area.insertBefore(e,ii.area.firstChild):ii.area.appendChild(e),t.expire>0&&(ii.timers[t.id]=window.setTimeout((function(){ii.hide(t.id)}),t.expire)),e.style.height=e.offsetHeight-2+"px",ii.pull[t.id]=e,e=null,t.id}function Ue(t,e,i,s){var n=document.createElement("DIV"),a=t.css?" "+t.css:"";n.className="webix_modal_box webix_"+t.type+a,n.setAttribute("webixbox",1),n.setAttribute("role","alertdialog"),n.setAttribute("aria-label",t.title||""),n.setAttribute("tabindex","0");var r="";if(t.width&&(n.style.width=t.width+(Oe.isNumber(t.width)?"px":"")),t.height&&(n.style.height=t.height+(Oe.isNumber(t.height)?"px":"")),t.title&&(r+='<div class="webix_popup_title">'+t.title+"</div>"),r+='<div class="webix_popup_text'+(s?" webix_popup_label":"")+'"><span>'+(t.content?"":t.text||"")+"</span></div>",r+='<div  class="webix_popup_controls">',s&&(r+=function(t){return"<div tabindex='0' class='webix_popup_input webix_el_text"+(t.required?" webix_required":"")+"'><input value='"+le.escape(t.value||"")+"' placeholder='"+le.escape(t.placeholder||"")+"'></input></div>"}(t.input)),i&&(r+=He(t.cancel||R.message.cancel,!1)),e&&(r+=He(t.ok||R.message.ok,!0,"confirm")),t.buttons&&!e&&!i)for(var o=0;o<t.buttons.length;o++)r+=He(t.buttons[o],o);if(r+="</div>",n.innerHTML=r,t.content){var l=t.content;"string"==typeof l&&(l=document.getElementById(l)),"none"==l.style.display&&(l.style.display=""),n.childNodes[t.title?1:0].appendChild(l)}if(-1!=t.type.indexOf("prompt")){var h=n.querySelector(".webix_popup_input");h.querySelector("input").oninput=function(){t.input.invalid&&(Et(h,"webix_popup_invalid"),t.input.invalid=!1)}}return n.onclick=function(e){var i=e.target;if(i.className||(i=i.parentNode),-1!=i.className.indexOf("webix_popup_button")){var s=i.getAttribute("result");Le(t,s="true"==s||"false"!=s&&s)}e.cancelBubble=!0},t._box=n,n}function We(t,e,i,s){var n=t.tagName?t:Ue(t,e,i,s),a=t.container,r=a?a.offsetWidth:window.innerWidth||document.documentElement.offsetWidth,o=a?a.offsetHeight:window.innerHeight||document.documentElement.offsetHeight,l=a?a.scrollLeft:0,h=a?a.scrollTop:0;t.container&&(n.style.position="absolute"),F((t.container||document.body).appendChild(n));var c=ze(!0,t.container),u=t.left||Math.abs(l+Math.floor((r-n.offsetWidth)/2)),_=t.top||Math.abs(h+Math.floor((o-n.offsetHeight)/2));return"top"==t.position?n.style.top="-3px":(n.style.top=_+"px",c&&(c.style.top=h+"px",c.style.left=l+"px")),n.style.left=u+"px",n.onkeydown=Re,s?n.querySelector(".webix_popup_input input").focus():n.focus(),t.id?ti.pull[t.id]&&ti.hide(t.id):t.id=Se("modalbox"),ti.order.push(t.id),ti.pull[t.id]=t,t._promise=d.defer(),t._promise}function Ye(t){return We(t,!0)}function Ge(t){return We(t,!0,!0)}function Ke(t){return We(t)}function Xe(t){return We(t,!0,!0,!0)}function Je(t,i,s){return"object"!=e(t)&&("function"==typeof i&&(s=i,i=""),t={text:t,type:i,callback:s}),t}function Ze(t,i,s,n){return"object"!=e(t)&&(t={text:t,type:i,expire:s,id:n}),t.id=t.id||Se("message"),t.expire=t.expire||ii.expire,t}function Qe(){var t=Je.apply(this,arguments);return t.type=t.type||"confirm",Ge(t)}function ti(){var t=Je.apply(this,arguments);return t.type=t.type||"alert",Ke(t)}function ei(t,e,i,s){switch((t=Ze.apply(this,arguments)).type=t.type||"info",t.type.split("-")[0]){case"alert":return Ye(t);case"confirm":return Ge(t);case"modalbox":return Ke(t);case"prompt":return Xe(t);default:return qe(t)}}pe(document,"keydown",Re,{capture:!0}),ti.pull={},ti.order=[],ti.hide=function(t){if(t&&ti.pull[t]){var e=ti.pull[t]._box;e&&(e.parentNode.removeChild(e),ti.order.splice(ti.order.indexOf(t),1),ze(!1,ti.pull[t].container),delete ti.pull[t])}},ti.hideAll=function(){for(var t in ti.pull)this.hide(t)};var ii=ei;ii.expire=4e3,ii.keyboard=!0,ii.position="top",ii.pull={},ii.timers={},ii.hideAll=function(){for(var t in ii.pull)ii.hide(t)},ii.hide=function(t){var e=ii.pull[t];e&&e.parentNode&&(window.setTimeout((function(){e.parentNode.removeChild(e),e=null}),2e3),e.style.height=0,e.className+=" hidden",ii.area.removeAttribute("role"),ii.timers[t]&&window.clearTimeout(ii.timers[t]),delete ii.pull[t])},_("message",ei);var si={set:function(t,e){e=e||{},this._view&&this.exit(),ke(t)?t=ke(t):("string"==typeof t&&(t=document.getElementById(t)),t instanceof Element&&(t={$view:t,$html:!0}),f(t,"Incorrect view for fullscreen mode")),this._view=t,this._pos=this._setPosition();var i=t.config;return t.setPosition?(i.fullscreen=!0,t.resize(),t):(this._fullscreen=be({view:"window",head:this._getHeadConfig(e),css:e.css||"",fullscreen:!0,borderless:!0,body:{rows:[]}}),i&&(this._sizes={width:i.width,minWidth:i.minWidth,maxWidth:i.maxWidth,height:i.height,minHeight:i.minHeight,maxHeight:i.maxHeight}),t.getParentView&&t.getParentView()?(this._parent=t.getParentView(),this._parent.index&&(this._pos.index=this._parent.index(t),this._pos.active=!!this._parent.getActiveId&&this._parent.getActiveId()==i.id)):(this._parent=t.$view.parentNode,this._pos.node=vt("div"),this._parent.replaceChild(this._pos.node,t.$view)),this._fullscreen.getBody().addView(t.$html?{view:"template",content:t.$view,css:"webix_fullscreen_html"}:t),this._fullscreen.show(),this._setSizes(t),this._fullscreen)},exit:function(){if(this._view){var t=this._view.config;this._setPosition(!0),this._view.setPosition?(t.fullscreen=!1,this._view.resize()):(this._parent instanceof Element?(this._view._parent_cell=null,this._view._set_inner&&this._view._set_inner(this._view.config),this._parent.replaceChild(this._view.$view,this._pos.node)):E(this._pos.index)?(this._view._parent_cell=this._parent,this._parent._replace(this._view)):(this._parent.addView(this._view,this._pos.index),this._pos.active&&this._view.show(!1,!1)),this._setSizes(this._view,this._sizes),this._view.$html||(this._fullscreen.getBody()._cells=[]),this._fullscreen.close()),this._clearValues()}},_clearValues:function(){delete this._parent,delete this._view,delete this._sizes,delete this._pos,delete this._fullscreen},_setPosition:function(t){var e=this,i=this._view,s={};if(i.setPosition)t?i.setPosition(this._pos.left,this._pos.top):(s.left=i.config.left,s.top=i.config.top,i.setPosition(0,0));else{var n=i.$view.style;["position","top","bottom","left","right"].forEach((function(i){t?n[i]=e._pos[i]:(s[i]=n[i],n[i]="position"==i?"relative":0)}))}return s},_setSizes:function(t,e){t.$html||(e=e||{height:0,minHeight:0,maxHeight:0,width:0,minWidth:0,maxWidth:0},t.define(e),t.resize())},_getHeadConfig:function(t){var i=this;return!1===t.head||"object"==e(t.head)?t.head:{cols:[{template:t.head||"",type:"header",borderless:!0},{view:"icon",icon:"wxi-close",click:function(){i.exit()}}]}}},ni={_view:null,_hotkeys:{},_focus_time:0,_controls:{esc:"escape",up:"arrowup",down:"arrowdown",left:"arrowleft",right:"arrowright",pgdown:"pagedown",pgup:"pageup",space:" ",multiply:"*",add:"+",subtract:"-",decimal:".",divide:"/",pausebreak:"pause","5numlocked":"clear"},_inputs:{input:1,button:1,textarea:1,select:1},_enable:function(){var t=this;pe(document,"keydown",this._keypress,{bind:this}),pe(document,"compositionstart",(function(){return t._startComposition()})),pe(document,"compositionend",(function(){return t._endComposition()})),pe(document.body,"click",this._focus_click,{capture:!0,bind:this}),pe(document.body,"focus",this._focus_tab,{capture:!0,bind:this}),me.destructors.push({obj:this})},_startComposition:function(){clearTimeout(this._composition),this._composition=!0},_endComposition:function(){var t=this;this._composition=j((function(){return delete t._composition}))},destructor:function(){ni._view=null},getFocus:function(){return this._view},_focus_action:function(t){this._focus_was_there=this._focus_was_there||t._settings.id},setFocus:function(t,e,i){return(t=ke(t))&&!t.$view&&(t=null),this._focus_time=me._focus_time=new Date,this._view===t||(this._view&&this._view.callEvent&&this._view.callEvent("onBlur",[this._view]),t&&t.callEvent&&(t.callEvent("onFocus",[t,this._view]),i&&t.callEvent("onTabFocus",[t,this._view])),U("onFocusChange",[t,this._view]),this._view&&this._view.blur&&!e&&this._view.blur(),this._view=t,t&&t.focus&&!e&&t.focus()),!0},applyChanges:function(t){var e=this.getFocus();e&&e!=t&&e._applyChanges&&e._applyChanges(t)},hasFocus:function(t){return t===this._view},_focus:function(t){for(var e=0;e<ti.order.length;e++)if(ti.pull[ti.order[e]]._box.contains(t.target))return;var i=xt(t,"view_id")||this._focus_was_there;return i=ke(i),this._focus_was_there=null,me._focus_time=new Date,i==this._view||(i?this.canFocus(i)?this._view&&this._view.getFormView()==i&&this._view.focus?this._view.focus():("radio"!=t.target.type&&"radio"!=t.target.getAttribute("role")||U("onClick",[t]),this.setFocus(i)):i.$view.contains(t.target)&&t.target.blur():this.setFocus(null)),!0},_focus_click:function(t){return new Date-this._focus_time<100?(this._focus_was_there=null,!1):this._focus(t)},_focus_tab:function(t){return!!this._inputs[t.target.nodeName.toLowerCase()]&&this._focus(t)},_top_modal:function(t){var e=me._modality;return!e.length||(this._getTop(t).$view.style.zIndex||0)>=Math.max.apply(Math,s(e))},_getTop:function(t){var e=t.queryView((function(t){return!t.getParentView()}),"parent")||t,i=ke(e.$view.parentNode);return i&&(e=this._getTop(i)),e},canFocus:function(t){return!(document.body.modality||t.$view.modality||t.queryView((function(t){return t.$view.modality}),"parent"))&&t.isVisible()&&t.isEnabled()&&!t.config.disabled&&this._top_modal(t)&&!t.queryView({disabled:!0},"parent")},_moveChildFocus:function(t){var e=this.getFocus();if(t&&!this._is_child_of(t,e))return!1;this._focus_logic("getPrev",t)||(this._view=null)},_is_child_of:function(t,e){if(!t)return!1;if(!e)return!1;for(;e;){if(e===t)return!0;e=e.getParentView()}return!1},_keypress_timed:function(){this&&this.callEvent&&this.callEvent("onTimedKeyPress",[])},_keypress:function(t){var e=t.which||t.keyCode;if(229!=e&&0!=e){e>95&&e<106&&(e-=48);var i=this.getFocus();return i&&i.callEvent&&(!1===i.callEvent("onKeyPress",[e,t])&&St(t),i.hasEvent("onTimedKeyPress")&&(clearTimeout(i._key_press_timeout),i._key_press_timeout=j(this._keypress_timed,i,[],i._settings.keyPressTimeout||250))),!1===this._check_keycode(t)?(St(t),!1):void 0}},_focus_logic:function(t,e){var i=e||this.getFocus();if(i){t=t||"getNext";for(var s=i,n=T();;){if((i=this[t](i))&&this.canFocus(i))return this.setFocus(i);if(i===s||i.$fmarker==n)return e&&document.activeElement.blur(),null;i.$fmarker=n}}},_tab_logic:function(t,e){var i=!e.shiftKey;if(t&&t._custom_tab_handler&&!t._custom_tab_handler(i,e))return!1;if(t&&t._in_edit_mode){if(t.editNext)return t.editNext(i);if(t.editStop)return t.editStop(),!0}else j((function(){if((t=ke(document.activeElement))&&!ni.canFocus(t))return ni._focus_logic(i?"getNext":"getPrev",t);ni.setFocus(t,!0,!0)}))},getTop:function(t){for(var e,i=ke(t);i&&(e=i.getParentView());)i=e;return i},getNext:function(t,e){var i=t.getChildViews();if(i.length&&!e)for(var s=0;s<i.length;s++)if(this.canFocus(i[s]))return i[s];var n=t.getParentView();if(!n)return t;var a=n.getChildViews();if(a.length)for(var r=L.find.call(a,t)+1;r<a.length;){if(this.canFocus(a[r]))return a[r];r++}return this.getNext(n,!0)},getPrev:function(t,e){var i=t.getChildViews();if(i.length&&e)for(var s=i.length-1;s>=0;s--)if(this.canFocus(i[s]))return this.getPrev(i[s],!0);if(e&&this.canFocus(t))return t;var n=t.getParentView();if(!n)return this.canFocus(t)?this.getPrev(t,!0):t;var a=n.getChildViews();if(a)for(var r=L.find.call(a,t)-1;r>=0;){if(this.canFocus(a[r]))return this.getPrev(a[r],!0);r--}return this.getPrev(n,!0)},addHotKey:function(t,e,i){f(e,"Hot key handler is not defined");var s=this._parse_keys(t);return i||(i=null),this._hotkeys[s]||(this._hotkeys[s]=[]),this._hotkeys[s].push({handler:e,view:i}),t},removeHotKey:function(t,e,i){var s=this._parse_keys(t);if(e||i){var n=this._hotkeys[s];if(n){for(var a=n.length-1;a>=0;a--)i&&n[a].view!==i||e&&n[a].handler!==e||n.splice(a,1);n.length||delete this._hotkeys[s]}}else delete this._hotkeys[s]},_keycode:function(t,e,i,s,n){return(t||"").toLowerCase()+"_"+["",e?"1":"0",i?"1":"0",s?"1":"0",n?"1":"0"].join("")},_check_keycode:function(t){var e=t.which||t.keyCode,i=!t.ctrlKey&&!t.altKey&&!t.metaKey&&9!=e&&27!=e&&13!=e,s=this._keycode(t.key,t.ctrlKey,t.shiftKey,t.altKey,t.metaKey),n=this.getFocus();return this._hotkeys[s]?this._process_calls(this._hotkeys[s],n,t):!i||!this._hotkeys.any_0000||this._process_calls(this._hotkeys.any_0000,n,t)},_process_calls:function(t,e,i){for(var s=0;s<t.length;s++){var n=t[s];if(null===n.view||e===n.view||"string"==typeof n.view&&e&&e.name===n.view){var a=n.handler(e,i);if(!!a===a)return a}}return!0},_parse_keys:function(t){var e,i,s,n,a=this._controls,r=t.toLowerCase().split(/[ +\-_]/);e=i=s=n=0;for(var o="",l=0;l<r.length;l++)"ctrl"===r[l]?e=1:"shift"===r[l]?i=1:"alt"===r[l]?s=1:"command"===r[l]?n=1:o=a[r[l]]||r[l];return this._keycode(o,e,i,s,n)},getState:function(t,e){e=e||!1;var i={id:(t=ke(t)).config.id,width:t.config.width,height:t.config.height,gravity:t.config.gravity};if(E(t.config.collapsed)||(i.collapsed=t.config.collapsed),"tabs"!==t.name&&"tabbar"!==t.name||(i.activeCell=t.getValue()),e&&(i=[i],t._cells))for(var s=0;s<t._cells.length;s++)i=i.concat(this.getState(t._cells[s],e));return i},setState:function(t){B(t)||(t=[t]);for(var e=0;e<t.length;e++){var i=t[e],s=ke(i.id);s&&(E(i.collapsed)||s.define("collapsed",i.collapsed),E(i.activeCell)||s.setValue(i.activeCell,"auto"),s.define("width",i.width),s.define("height",i.height),s.define("gravity",i.gravity))}var n=ke(t[0].id);n&&n.resize()}};Ne((function(){ni._enable(),ni.addHotKey("enter",(function(t,e){if(ni._composition)return!1;if(t&&t.callEvent&&t.callEvent("onEnter",[e]),t&&t.editStop&&t._in_edit_mode)return t.editStop(),!0;if(t&&t.touchable){var i=t.getFormView();i&&!t._skipSubmit&&i.callEvent("onSubmit",[t,e])}})),ni.addHotKey("esc",(function(t){if(t){if(t.editCancel&&t._in_edit_mode)return t.editCancel(),!0;var e=t.getTopParentView();if(e&&e.setPosition){if(si._fullscreen==e&&si.exit(),e._editorMaster){var i=ke(e._editorMaster);i.editCancel&&i._in_edit_mode&&i.editCancel()}e._hide()}}})),ni.addHotKey("shift+tab",ni._tab_logic),ni.addHotKey("tab",ni._tab_logic)})),_("UIManager",ni);var ai={$init:function(){this._settings=this.config={}},define:function(t,i){return"object"==e(t)?this._parseSeetingColl(t):this._define(t,i)},_define:function(t,e){var i=this[t+"_setter"];return this._settings[t]=i?i.call(this,e,t):e},_parseSeetingColl:function(t){if(t)for(var e in t)this._define(e,t[e])},_parseSettings:function(i,s){var n={};s&&(n=t.extend(n,s)),"object"!=e(i)||i.tagName||t.extend(n,i,!0),this._parseSeetingColl(n)},_mergeSettings:function(t,i){for(var s in i)switch(e(t[s])){case"object":t[s]=this._mergeSettings(t[s]||{},i[s]);break;case"undefined":t[s]=i[s]}return t}},ri={$init:function(){var t=this._destructor_handler=this._destructor_handler||{obj:this};me.destructors.push(t)},destructor:function(){var t=this._settings;if(this._last_editor&&this.editCancel(),this.callEvent&&this.callEvent("onDestruct",[]),this.destructor=function(){},this._destructor_handler.obj=null,this.getChildViews){var e=this.getChildViews();if(e)for(var i=0;i<e.length;i++)e[i].destructor();if(this._destroy_with_me)for(var s=0;s<this._destroy_with_me.length;s++)this._destroy_with_me[s].destructor()}if(delete be.views[t.id],t.$id){var n=this.getTopParentView();n&&n._destroy_child&&n._destroy_child(t.$id)}this._htmlmap=null,this._htmlrows=null,this._html=null,this._contentobj&&(this._contentobj.innerHTML="",this._contentobj._htmlmap=null),this._viewobj&&this._viewobj.parentNode&&this._viewobj.parentNode.removeChild(this._viewobj),this.data&&this.data.destructor&&this.data.destructor(),this.unbind&&this.unbind(),this.data=null,this._parent_cell=null,this._viewobj=this.$view=this._contentobj=this._dataobj=null,this._evs_events=this._evs_handlers=this._evs_map={},ni._view==this&&(ni._view=null);var a=t.url;a&&a.$proxy&&a.release&&a.release(),this.$scope=null,this.$destructed=!0}};pe(window,"unload",(function(){U("unload",[]),me._final_destruction=!0;for(var t=0;t<me.destructors.length;t++){var e=me.destructors[t].obj;e&&e.destructor()}me.destructors=[],me._popups=O(),ue()}));var oi={$init:function(){this._cursor=null,this.attachEvent("onSelectChange",(function(){var t=this.getSelectedId();this.setCursor(t?t.id||t:null)})),this.attachEvent("onAfterCursorChange",this._update_binds),this.attachEvent("onAfterDelete",(function(t){t==this.getCursor()&&this.setCursor(null)})),this.data.attachEvent("onStoreUpdated",A((function(t,e,i){t&&t==this.getCursor()&&"paint"!=i&&"delete"!=i&&this._update_binds()}),this)),this.data.attachEvent("onClearAll",A((function(){this._cursor=null}),this)),this.data.attachEvent("onIdChange",A((function(t,e){this._cursor==t&&(this._cursor=e,this._update_binds())}),this))},refreshCursor:function(){this._cursor&&this.callEvent("onAfterCursorChange",[this._cursor])},setCursor:function(t){t==this._cursor||null!==t&&!this.getItem(t)||(this.callEvent("onBeforeCursorChange",[this._cursor]),this._cursor=t,this.callEvent("onAfterCursorChange",[t]))},getCursor:function(){return this._cursor},_bind_update:function(t,e,i){if("$level"==e&&this.data.getBranch)return(t.data||t).importData(this.data.getBranch(this.getCursor()));var s=this.getItem(this.getCursor())||this._settings.defaultData||null;"$data"==e?("function"==typeof i?i.call(t,s,this):t.data.importData(s?s[i]:[]),t.callEvent("onBindApply",[s,e,this])):(i&&(s=i(s)),this._bind_update_common(t,e,s))}},li={$init:function(){this.attachEvent("onChange",this._update_binds)},_bind_update:function(t,e,i){e=e||"value";var s=this.getValue()||"";if(i&&(s=i(s)),t.setValue)t.setValue(s,"auto");else if(t.filter)t.data.silent((function(){this.filter(e,s)}));else{var n={};n[e]=s,t._check_data_feed(s)&&t.setValues(n,!1,"auto")}t.callEvent("onBindApply",[s,e,this])}},hi={$init:function(){this.attachEvent("onChange",this._update_binds)},_bind_update:function(t,e,i){var s=this.getValues()||null;i&&(s=i(s)),this._bind_update_common(t,e,s)}},ci={$init:function(){this._bind_hash={},this._bind_updated={},this._ignore_binds={},this._bind_specific_rules(this)},saveBatch:function(t){this._do_not_update_binds=!0,t.call(this),this._do_not_update_binds=!1,this._update_binds()},setBindData:function(t,e){if(e&&(this._ignore_binds[e]=!0),this.setValue)this.setValue(t,"auto");else if(this.setValues)this.setValues(t,!1,"auto");else{var i=this.getCursor();i?this.updateItem(i,t):this.add(t)}this.callEvent("onBindUpdate",[t,e]),this.save&&this.save(),e&&(this._ignore_binds[e]=!1)},getBindData:function(t,e){if(this._bind_updated[t])return!1;var i=ke(t);i.isVisible(i._settings.id)&&(this._bind_updated[t]=!0,this._bind_update(i,this._bind_hash[t][0],this._bind_hash[t][1]),e&&i.filter&&i.refresh())},addBind:function(t,e,i){this._bind_hash[t]=[e,i]},removeBind:function(t){delete this._bind_hash[t],delete this._bind_updated[t],delete this._ignore_binds[t]},_bind_specific_rules:function(e){e.filter?t.extend(this,oi):e.setValue?t.extend(this,li):t.extend(this,hi)},_update_binds:function(){if(!this._do_not_update_binds)for(var t in this._bind_hash)this._ignore_binds[t]||(this._bind_updated[t]=!1,this.getBindData(t,!0))},_bind_update_common:function(t,e,i){t.setValue?t.setValue(i&&e?i[e]:i,"auto"):t.filter?t.data.silent((function(){this.filter(e,i)})):!i&&t.clear?t.clear("auto"):t._check_data_feed(i)&&t.setValues(S(i),!1,"auto"),t.callEvent("onBindApply",[i,e,this])}},di={bind:function(e,i,s){this.attachEvent||t.extend(this,H),"string"==typeof e&&(e=ke(e)),e._initBindSource&&e._initBindSource(),this._initBindSource&&this._initBindSource(),e.getBindData||t.extend(e,ci),this._bind_ready(),e.addBind(this._settings.id,i,s),this._bind_source=e._settings.id,this._bind_id=this._settings.id,this._bind_refresh_handler=this.attachEvent(this.touchable?"onAfterRender":"onBindRequest",(function(){return e.getBindData(this._bind_id)})),this.refresh&&this.isVisible(this._bind_id)&&this.refresh()},unbind:function(){if(this._bind_source){var t=ke(this._bind_source);t&&t.removeBind(this._bind_id),this.detachEvent(this._bind_refresh_handler),this._bind_source=this._bind_refresh_handler=null}},_bind_ready:function(){var t=this._settings;if(this.filter){var e=t.id;this.data._on_sync=A((function(){ke(this._bind_source)._bind_updated[e]=!1}),this)}var i=this.render;this.render=function(){if(!this._in_bind_processing){this._in_bind_processing=!0;var t=this.callEvent("onBindRequest");return this._in_bind_processing=!1,i.apply(this,!1===t?arguments:[])}},(this.getValue||this.getValues)&&(this.save=function(t){var e=ke(this._bind_source);if(t)e.setBindData(t);else{if(this.validate&&!this.validate())return!1;var i=this.getValue?this.getValue:this.getValues();e.setBindData(i,this._settings.id),this.setDirty&&this.setDirty(!1)}}),this._bind_ready=function(){}}},ui=window.webix_view||{},_i={name:"baseview",$init:function(t){t.id||(t.id=Se(this.name)),this._parent_cell=me._parent_cell,me._parent_cell=null,this.$scope=t.$scope||(this._parent_cell?this._parent_cell.$scope:me._global_scope),this._viewobj||(this._contentobj=this._viewobj=vt("DIV",{class:"webix_view"}),this.$view=this._viewobj)},$skin:!1,defaults:{width:0,height:0,gravity:1},getNode:function(){return this._viewobj},$setNode:function(t){this._viewobj=this._dataobj=this.$view=t},getParentView:function(){return this._parent_cell||null},getTopParentView:function(){var t=this.getParentView();return t?t.getTopParentView():this},getFormView:function(){var t=this.getParentView();return!t||t._recollect_elements?t:t.getFormView()},getChildViews:function(){return[]},queryView:function(t,i){var s;if("string"==typeof t&&(t={view:t}),s="object"===e(t)?function(e){var i=e.config;for(var s in t)if(i[s]!=t[s])return!1;return!0}:t,"self"===i&&s(this))return this;var n="all"===i&&[],a="parent"===i?this._queryGoUp:this._queryGoDown,r=this._queryView(s,a,n);return"all"===i?n:r},_queryGoDown:function(t){return t.getChildViews()},_queryGoUp:function(t){var e=t.getParentView();return e?[e]:[]},_queryView:function(t,e,i){for(var s=e(this),n=0;n<s.length;n++){if(t(s[n])){if(!i)return s[n];i.push(s[n])}var a=s[n]._queryView(t,e,i);if(a&&!i)return a}return null},isVisible:function(t){if(this._settings.hidden)return t&&(this._hidden_render||(this._hidden_render=[],this._hidden_hash={}),this._hidden_hash[t]||(this._hidden_hash[t]=!0,this._hidden_render.push(t))),!1;var e=this.getParentView();return!e||e.isVisible(t,this._settings.id)},isEnabled:function(){if(this._disable_cover)return!1;var t=this.getParentView();return!t||t.isEnabled()},_fix_cover:function(){this._disable_cover&&!this._disable_cover.parentNode&&this._viewobj.appendChild(this._disable_cover)},disable:function(){wt(this._disable_cover),this._settings.disabled=!0;var t=this._viewobj;this._disable_cover=vt("div",{class:"webix_disabled",style:"left:".concat(t.scrollLeft,"px; top:").concat(t.scrollTop,"px;")}),t.appendChild(this._disable_cover),t.setAttribute("aria-disabled","true"),Dt(t,"webix_disabled_view",!0),ni._moveChildFocus(this)},enable:function(){this._settings.disabled=!1,this._disable_cover&&(wt(this._disable_cover),Et(this._viewobj,"webix_disabled_view"),this._viewobj.removeAttribute("aria-disabled"),this._disable_cover=null)},disabled_setter:function(t){return t?this.disable():this.enable(),t},container_setter:function(t){return f(F(t),"Invalid container"),!0},css_setter:function(t){return"object"==e(t)&&(t=ft(t)),this._viewobj.className+=" "+t,t},id_setter:function(t){if(me._global_collection&&(me._global_collection!=this||this._prev_global_col)){var e=this.config.$id=t;(this._prev_global_col||me._global_collection)._elements[t]=this,t=Se(this.name),(this._prev_global_col||me._global_collection)._translate_ids[t]=e}return f(!be.views[t],"Non unique view id: "+t),be.views[t]=this,this._viewobj.setAttribute("view_id",t),t},$setSize:function(t,e){var i=this._last_size;return i&&i[0]==t&&i[1]==e?(x(this,[t,e,"not changed"]),!1):(x(this,[t,e]),this._last_size=[t,e],this.$width=this._content_width=t-(this._scroll_y?Ot.scrollSize:0),this.$height=this._content_height=e-(this._scroll_x?Ot.scrollSize:0),this._settings.flex||(this._viewobj.style.width=t+"px",this._viewobj.style.height=e+"px"),!0)},$getSize:function(t,e){var i=this._settings,s=[1*(i.width||i.minWidth||0),1*(i.width||i.maxWidth||1e5),1*(i.height||i.minHeight||0),1*(i.height||i.maxHeight||1e5),i.gravity];return f&&(isNaN(s[0])||isNaN(s[1])||isNaN(s[2])||isNaN(s[3]))&&(f(!1,"Size is not a number "+this._settings.id),i.width=i.height=i.maxWidth=i.maxHeight=i.minWidth=i.minHeight=0,s=[0,0,1e5,1e5,1]),s[0]+=t,s[1]+=t,s[2]+=e,s[3]+=e,s},show:function(e,i){var s=this.getParentView(),n=!arguments[2];s?(!i&&!1!==i&&this._settings.animate&&s._settings.animate&&(i=t.extend(s._settings.animate?t.extend({},s._settings.animate):{},this._settings.animate,!0)),(n?s._show:s._hide)&&(n?s._show:s._hide).call(s,this,i),n&&this._render_hidden_views(),e&&n&&s.show(!s.$$&&e)):this._settings.hidden?n&&(F(this._settings._container||document.body).appendChild(this._viewobj),this._settings.hidden=!1,this.adjust(),this.callEvent&&(this.callEvent("onViewShow",[]),this._signal_hidden_cells&&je(this,this._signal_hidden_cells)),this._render_hidden_views()):n||(this._settings.hidden=this._settings._hidden=!0,this._viewobj&&(this._settings._container=this._viewobj.parentNode,wt(this._viewobj)))},_render_hidden_views:function(){if(this._hidden_render){for(var t=0;t<this._hidden_render.length;t++){var e=ke(this._hidden_render[t]);e&&e.render()}this._hidden_render=[],this._hidden_hash={}}},_onKeyPress:function(t,e){var i=e.target,s=i.getAttribute("role");13!==t&&32!==t||"button"!=s&&"tab"!=s||this._settings.disabled||(At(i,"MouseEvent","click"),St(e))},hidden_setter:function(t){return t&&this.hide(),this._settings.hidden},hide:function(){this.show(null,null,!0),ni._moveChildFocus(this)},adjust:function(){if(!this._viewobj.parentNode)return!1;var t=this._viewobj.parentNode.clientWidth||0,e=this._viewobj.parentNode.clientHeight||0,i=this.$getSize(0,0),s=this._viewobj.parentNode==document.body&&!this.setPosition;i[0]>t&&(t=i[0]),i[2]>e&&(e=i[2]),(!s||this._settings.width)&&t>i[1]&&(t=i[1]),(!s||this._settings.height)&&e>i[3]&&(e=i[3]),this.$setSize(t,e),me._responsive_exception&&(me._responsive_exception=!1,this.adjust())},resize:function(){if(!(me._child_sizing_active||me._freeze_resize||me._responsive_tinkery)){var t=this.getParentView();t?t.resizeChildren?t.resizeChildren():t.resize():(this.adjust(),U("onResize",[]))}}},pi={api:_i,view:t.protoUI(_i,ai,ri,di,ui)},fi={name:"view",$init:function(t){this._set_inner(t)},_set_inner:function(t){var e=E(t.borderless);e&&!this.setPosition&&t.$topView&&(t.borderless=!0,e=!1),e&&this.defaults.borderless||t.borderless?t._inner={top:!0,left:!0,bottom:!0,right:!0}:(t._inner||(t._inner={}),this._contentobj.style.borderWidth="1px")},$getSize:function(t,e){var i=this._settings._inner;i&&(t+=(i.left?0:1)+(i.right?0:1),e+=(i.top?0:1)+(i.bottom?0:1));var s=pi.api.$getSize.call(this,t,e);return x(this,s,!0),s},$setSize:function(t,e){x(this,[t,e]);var i=this._settings._inner;return i&&(t-=(i.left?0:1)+(i.right?0:1),e-=(i.top?0:1)+(i.bottom?0:1)),pi.api.$setSize.call(this,t,e)}},gi=t.protoUI(fi,pi.view),mi={api:fi,view:gi};gi.call(-1);var vi,bi,wi=t.proto({$init:function(){this.type=S(this.type)},customize:function(t){ge(this,t)},template_setter:function(t){this.type.template=le(t)},_toHTML:function(t){var e=this.type;return(e.templateStart?e.templateStart(t,e):"")+e.template(t,e)+(e.templateEnd?e.templateEnd(t,e):"")}},he),yi={name:"tooltip",defaults:{dy:0,dx:20},$init:function(t){"string"==typeof t&&(t={template:t}),this.$view=this._viewobj=this._contentobj=this._dataobj=vt("DIV",{role:"alert","aria-atomic":"true"}),this._viewobj.className=this._css_name,yt(this._contentobj,document.body.firstChild,document.body)},adjust:function(){},isVisible:function(){return this._visible},_alt_render:function(t){this.callEvent("onBeforeRender",[t])&&(this._dataobj.innerHTML="",this._dataobj.innerHTML=t,this.callEvent("onAfterRender",[]))},_css_name:"webix_tooltip",css_setter:function(t){return"object"===e(t)&&(t=ft(t)),this._viewobj.className=this._css_name+" "+t,t},show:function(e,i){if(!this._disabled)if(this._visible=!0,"string"==typeof e?this._alt_render(e):(this.data=t.extend({},e),this.render()),this._dataobj.firstChild){var s=Math.max(document.documentElement.clientWidth,window.innerWidth||0),n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),a=s-i.x,r=n-i.y;this._contentobj.style.display="block",a-this._settings.dx>this._contentobj.offsetWidth?a=i.x:(a=i.x-2*this._settings.dx-this._contentobj.offsetWidth)<0&&(a=0),r-this._settings.dy>this._contentobj.offsetHeight?r=i.y:(r=i.y-2*this._settings.dy-this._contentobj.offsetHeight)<0&&(r=0),this._contentobj.style.left=a+this._settings.dx+"px",this._contentobj.style.top=r+this._settings.dy+"px"}else this.hide()},hide:function(){this._visible&&(this.data=null,this._contentobj.style.display="none",this._visible=!1)},disable:function(){this._disabled=!0},enable:function(){this._disabled=!1},type:{template:le("{obj.value}"),templateStart:le.empty,templateEnd:le.empty}},xi=(t.protoUI(yi,wi,ai,H,mi.view),{tooltip_setter:function(t){return t?("function"!=typeof t&&"string"!=typeof t||(t={template:t}),"object"!==e(t)&&(t={}),t.overflow&&E(t.template)&&(t.template=""),this._init_tooltip_once(),t):this._settings.tooltip?{template:""}:void 0},_init_tooltip_once:function(){$e.addTooltip(this),this.attachEvent("onDestruct",(function(){$e.removeTooltip(this)})),this.attachEvent("onAfterScroll",(function(){$e._tooltip_exist&&$e._hide_tooltip()})),this._init_tooltip_once=function(){}},$tooltipIn:function(e){var i=$e._tooltip,s=t.extend({dx:20,dy:0,template:"{obj.value}",css:""},this._settings.tooltip,!0);return i.define(s),e},$tooltipOut:function(){return $e._hide_tooltip(),null},$tooltipMove:function(t,e,i){var s=this._settings.tooltip,n=!s||E(s.overflow)?$e.overflow:s.overflow,a=!s||E(s.delay)?$e.delay:s.delay,r=n?i.overflow:i.first;a>0&&$e._hide_tooltip(),$e._before_show_delay=j(this._show_tooltip,this,[t,e,r],a)},_show_tooltip:function(t,e,i){var s=i||this._get_tooltip_data(t,e);s&&this.isVisible()&&$e._tooltip.show(s,$t(e))},_get_tooltip_data:function(t,e){if(this.locate&&this.getItem){var i=this.locate(e);return i?this.getItem(i):null}return this._settings}}),ki=t.proto({$init:function(t){this._canvas_labels=[],this._canvas_series=E(t.series)?t.name:t.series,this._obj=F(t.container||t);var e=t.width*(window.devicePixelRatio||1),i=t.height*(window.devicePixelRatio||1),s=t.style||"";s+=";width:"+t.width+"px;height:"+t.height+"px;",this._prepareCanvas(t.name,s,e,i,t.title)},_prepareCanvas:function(t,e,i,s,n){return this._canvas=vt("canvas",{title:n,width:i,height:s,canvas_id:t,style:e||""}),this._obj.appendChild(this._canvas),this._canvas},getCanvas:function(t){var e=(this._canvas||this._prepareCanvas(this._contentobj)).getContext(t||"2d");return this._webixDevicePixelRatio||(this._webixDevicePixelRatio=!0,e.scale(window.devicePixelRatio||1,window.devicePixelRatio||1)),e},_resizeCanvas:function(t,e){this._canvas&&(this._canvas.setAttribute("width",t*(window.devicePixelRatio||1)),this._canvas.setAttribute("height",e*(window.devicePixelRatio||1)),this._canvas.style.width=t+"px",this._canvas.style.height=e+"px",this._webixDevicePixelRatio=!1)},renderText:function(t,e,i,s,n){if(i){n&&(n=Math.max(n,0)),e&&(e=Math.max(e,0));var a=vt("DIV",{class:"webix_canvas_text"+(s?" "+s:""),style:"left:"+t+"px; top:"+e+"px;","aria-hidden":"true"},i);return this._obj.appendChild(a),this._canvas_labels.push(a),n&&(a.style.width=n+"px"),a}},renderTextAt:function(t,e,i,s,n,a,r){var o=this.renderText.call(this,i,s,n,a,r);if(o){var l;if(document.body.contains(o))l={width:o.offsetWidth,height:o.offsetHeight};else{var h=vt("DIV",{class:"webix_chart",style:"visibility:hidden; position:absolute; top:0px; left:0px;"},""),c=o.parentNode;document.body.appendChild(h),h.appendChild(o),l={width:o.offsetWidth,height:o.offsetHeight},c.appendChild(o),wt(h)}t&&(o.style.top="middle"==t?parseInt(s-l.height/2,10)+"px":s-l.height+"px"),e&&(o.style.left="left"==e?i-l.width+"px":parseInt(i-l.width/2,10)+"px")}return o},clearCanvas:function(t){var e=[];if(wt(this._canvas_labels),this._canvas_labels=[],!t&&this._obj._htmlmap){for(e=this._getMapAreas();e.length;)e[0].parentNode.removeChild(e[0]),e.splice(0,1);e=null,this._obj._htmlmap.getElementsByTagName("AREA").length||(this._obj._htmlmap.parentNode.removeChild(this._obj._htmlmap),this._obj._htmlmap=null)}this.getCanvas().clearRect(0,0,this._canvas.offsetWidth||Math.floor(this._canvas.width/(window.devicePixelRatio||1)),this._canvas.offsetHeight||Math.floor(this._canvas.height/(window.devicePixelRatio||1)))},toggleCanvas:function(){this._toggleCanvas("none"==this._canvas.style.display)},showCanvas:function(){this._toggleCanvas(!0)},hideCanvas:function(){this._toggleCanvas(!1)},_toggleCanvas:function(t){var e,i;for(i=0;i<this._canvas_labels.length;i++)this._canvas_labels[i].style.display=t?"":"none";if(this._obj._htmlmap)for(e=this._getMapAreas(),i=0;i<e.length;i++)t?e[i].removeAttribute("disabled"):e[i].setAttribute("disabled","true");this._canvas.style.display=t?"":"none"},_getMapAreas:function(){var t,e,i=[];for(t=this._obj._htmlmap.getElementsByTagName("AREA"),e=0;e<t.length;e++)t[e].getAttribute("userdata")==this._canvas_series&&i.push(t[e]);return i}}),Ci=function(t,e){var i=e;if(B(t))for(var s=0;s<t.length;s++){if(B(e)&&(i=e[s]),"slide"==i.type){if("out"==i.subtype&&0===s)continue;if("in"==i.subtype&&1==s)continue}if("flip"!=i.type)Ci(t[s],i);else{var n=S(i);0===s&&(n.type="flipback"),1==s&&(n.callback=null),Ci(t[s],n)}}else{var a=F(t);a._has_animation?Ci.end(a,i):Ci.start(a,i)}};function $i(t){if(f(Si[t],"Incorrect skin name: "+t),bi!==t&&(Si.$active=vi=Si[t],Si.$name=bi=t,be))for(var e in be){var i=be[e];i&&i.prototype&&i.prototype.$skin&&i.prototype.$skin(i.prototype)}}Ci.end=function(t,e){t.style[Ot.transitionDuration]="1ms",t._has_animation=null,me._wait_animate&&window.clearTimeout(me._wait_animate),me._wait_animate=j(Ci,this,[t,e],10)},Ci.formLine=function(t,e,i){var s=i.direction;e.parentNode&&(e.parentNode.style.position="relative"),e.style.position="absolute",t.style.position="absolute";var n=Ot.isFF?"top"==s||"left"==s?-1:1:0;return"top"==s||"bottom"==s?(t.style.left="0px",t.style.top=(i.top||n)+("top"==s?1:-1)*e.offsetHeight+"px"):(t.style.top=(i.top||0)+"px",t.style.left=n+("left"==s?1:-1)*e.offsetWidth+"px"),e.parentNode==t.parentNode&&i.keepViews?t.style.display="":yt(t,e.nextSibling,e.parentNode),"slide"==i.type&&"out"==i.subtype&&(t.style.left="0px",t.style.top=(i.top||0)+"px",e.parentNode.removeChild(e),yt(e,t.nextSibling,t.parentNode)),[t,e]},Ci.breakLine=function(t){arguments[1]?t[1].style.display="none":wt(t[1]),Ci.clear(t[0]),Ci.clear(t[1]),t[0].style.position=""},Ci.clear=function(t){t.style[Ot.transform]="none",t.style[Ot.transition]="none",t.style.top=t.style.left=""},Ci.defaults={type:"slide",delay:"0",duration:"500",timing:"ease-in-out",x:0,y:0},Ci.start=function(t,e){"string"==typeof e&&(e={type:e}),e=ai._mergeSettings(e,Ci.defaults);var i,s,n=t._has_animation=e;switch("slide"==n.type&&n.direction){case"right":n.x=t.offsetWidth;break;case"left":n.x=-t.offsetWidth;break;case"top":n.y=-t.offsetHeight;break;default:n.y=n.y||t.offsetHeight}"flip"!=n.type&&"flipback"!=n.type||(i=[0,0],s="scaleX","vertical"==n.subtype?(i[0]=20,s="scaleY"):i[1]=20,"right"!=n.direction&&"bottom"!=n.direction||(i[0]*=-1,i[1]*=-1));var a=n.duration+"ms "+n.timing+" "+n.delay+"ms",r="transformStyle: preserve-3d;",o="",l="";switch(n.type){case"fade":o="opacity "+a,r="opacity: 0;";break;case"show":o="opacity "+a,r="opacity: 1;";break;case"flip":a=n.duration/2+"ms "+n.timing+" "+n.delay+"ms",l="skew("+i[0]+"deg, "+i[1]+"deg) "+s+"(0.00001)",o="all "+a;break;case"flipback":n.delay+=n.duration/2,a=n.duration/2+"ms "+n.timing+" "+n.delay+"ms",t.style[Ot.transform]="skew("+-1*i[0]+"deg, "+-1*i[1]+"deg) "+s+"(0.00001)",t.style.left="0",l="skew(0deg, 0deg) "+s+"(1)",o="all "+a;break;case"slide":var h=n.x+"px",c=n.y+"px";l=Ot.translate+"("+h+", "+c+("translate3d"==Ot.translate?", 0":"")+")",o="transform "+a}j((function(){t.style[Ot.transition]=o,j((function(){r&&(t.style.cssText+=r),l&&(t.style[Ot.transform]=l);var e=!1,i=pe(t,Ot.transitionEnd,(function(s){t._has_animation=null,n.callback&&n.callback.call(n.master||window,t,n,s),e=!0,fe(i)}));window.setTimeout((function(){if(!e){var s=n.master||window;t._has_animation=null,!s.$destructed&&n.callback&&n.callback.call(s,t,n),e=!0,fe(i)}}),1.3*(1*n.duration+1*n.delay))}))}))};var Si={set:$i,material:{topLayout:"space",barHeight:44,tabbarHeight:42,sidebarTitleHeight:44,rowHeight:36,toolbarHeight:44,listItemHeight:36,inputHeight:38,buttonHeight:38,inputPadding:3,menuHeight:36,labelTopHeight:22,propertyItemHeight:28,timelineItemHeight:70,unitHeaderHeight:36,fontSize:14,inputSpacing:4,borderWidth:1,sliderHandleWidth:14,sliderPadding:10,sliderBorder:1,vSliderPadding:15,vSliderHeight:100,switchHeight:24,switchWidth:50,layoutMargin:{space:10,wide:10,clean:0,head:4,line:-1,toolbar:4,form:8,accordion:2},layoutPadding:{space:10,wide:0,clean:0,head:0,line:0,toolbar:2,form:17,accordion:0},tabMargin:0,tabOffset:0,tabBottomOffset:0,tabTopOffset:0,tabBorder:!0,customCheckbox:!0,customRadio:!0,sidebarMarkAll:!0,popupNoPoint:!0,borderlessPopup:!0,popupPadding:0,dataPadding:12,calendarWeekHeaderHeight:18,padding:0,accordionType:"accordion",optionHeight:32,timelineColor:"#1CA1C1",backColor:"#FFFFFF",dataBorderColor:"#EDEFF0",colorPadding:4},mini:{topLayout:"space",barHeight:36,tabbarHeight:34,sidebarTitleHeight:36,rowHeight:28,toolbarHeight:36,listItemHeight:28,inputHeight:30,buttonHeight:30,inputPadding:3,menuHeight:28,labelTopHeight:16,propertyItemHeight:24,unitHeaderHeight:28,timelineItemHeight:50,fontSize:12,inputSpacing:4,borderWidth:1,sliderHandleWidth:12,sliderPadding:10,sliderBorder:1,vSliderPadding:13,vSliderHeight:100,switchHeight:22,switchWidth:40,layoutMargin:{space:5,wide:5,clean:0,head:4,line:-1,toolbar:4,form:8,accordion:2},layoutPadding:{space:5,wide:0,clean:0,head:0,line:0,toolbar:2,form:12,accordion:0},tabMargin:0,tabOffset:0,tabBottomOffset:0,tabTopOffset:0,tabBorder:!0,customCheckbox:!0,customRadio:!0,sidebarMarkAll:!0,popupNoPoint:!0,borderlessPopup:!0,popupPadding:0,dataPadding:12,calendarWeekHeaderHeight:18,padding:0,accordionType:"accordion",optionHeight:24,timelineColor:"#1CA1C1",backColor:"#FFFFFF",dataBorderColor:"#EDEFF0",colorPadding:4},flat:{topLayout:"space",barHeight:46,tabbarHeight:46,rowHeight:34,toolbarHeight:46,sidebarTitleHeight:45,listItemHeight:34,inputHeight:38,buttonHeight:38,inputPadding:3,menuHeight:34,labelTopHeight:22,unitHeaderHeight:20,propertyItemHeight:28,timelineItemHeight:70,fontSize:15,inputSpacing:4,borderWidth:1,sliderHandleWidth:14,sliderPadding:10,sliderBorder:1,vSliderPadding:15,vSliderHeight:100,switchHeight:22,switchWidth:50,layoutMargin:{space:10,wide:10,clean:0,head:4,line:-1,toolbar:4,form:8,accordion:10},layoutPadding:{space:10,wide:0,clean:0,head:0,line:0,toolbar:3,form:17,accordion:0},tabMargin:4,tabOffset:0,tabBottomOffset:6,tabTopOffset:1,customCheckbox:!0,customRadio:!0,popupPadding:8,dataPadding:10,calendarWeekHeaderHeight:24,padding:0,accordionType:"accordion",optionHeight:32,timelineColor:"#3498db",backColor:"#ffffff",dataBorderColor:"#ebebeb",colorPadding:4},compact:{topLayout:"space",barHeight:34,tabbarHeight:34,sidebarTitleHeight:34,rowHeight:24,toolbarHeight:34,listItemHeight:28,unitHeaderHeight:20,propertyItemHeight:24,timelineItemHeight:50,inputHeight:30,buttonHeight:30,inputPadding:3,menuHeight:28,labelTopHeight:16,fontSize:13,inputSpacing:4,borderWidth:1,sliderHandleWidth:10,sliderPadding:10,sliderBorder:1,vSliderPadding:13,vSliderHeight:100,switchHeight:20,switchWidth:40,layoutMargin:{space:5,wide:5,clean:0,head:4,line:-1,toolbar:4,form:4,accordion:5},layoutPadding:{space:5,wide:0,clean:0,head:0,line:0,toolbar:1,form:12,accordion:0},tabMargin:3,tabOffset:0,tabBottomOffset:3,tabTopOffset:1,customCheckbox:!0,customRadio:!0,popupPadding:8,dataPadding:10,calendarWeekHeaderHeight:24,padding:0,accordionType:"accordion",optionHeight:23,timelineColor:"#3498db",backColor:"#ffffff",dataBorderColor:"#ebebeb",colorPadding:4},contrast:{topLayout:"space",barHeight:46,tabbarHeight:46,rowHeight:34,toolbarHeight:46,sidebarTitleHeight:45,listItemHeight:34,unitHeaderHeight:20,inputHeight:38,buttonHeight:38,inputPadding:3,menuHeight:34,labelTopHeight:22,propertyItemHeight:28,timelineItemHeight:70,fontSize:15,inputSpacing:4,borderWidth:1,sliderHandleWidth:14,sliderPadding:10,sliderBorder:1,vSliderPadding:15,vSliderHeight:100,switchHeight:22,switchWidth:50,layoutMargin:{space:10,wide:10,clean:0,head:4,line:-1,toolbar:8,form:8,accordion:10},layoutPadding:{space:10,wide:0,clean:0,head:0,line:0,toolbar:3,form:17,accordion:0},tabMargin:4,tabOffset:0,tabBottomOffset:6,tabTopOffset:1,customCheckbox:!0,customRadio:!0,popupPadding:8,dataPadding:10,calendarWeekHeaderHeight:24,padding:0,accordionType:"accordion",optionHeight:32,timelineColor:"#b300b3",backColor:"#393939",dataBorderColor:"#4d4d4d",colorPadding:4},willow:{topLayout:"space",barHeight:46,tabbarHeight:44,sidebarTitleHeight:46,rowHeight:36,toolbarHeight:46,listItemHeight:36,inputHeight:38,buttonHeight:38,inputPadding:3,menuHeight:36,labelTopHeight:22,propertyItemHeight:28,timelineItemHeight:64,unitHeaderHeight:36,fontSize:14,inputSpacing:4,borderWidth:1,sliderHandleWidth:14,sliderPadding:10,sliderBorder:1,vSliderPadding:15,vSliderHeight:100,switchHeight:24,switchWidth:50,layoutMargin:{space:10,wide:10,clean:0,head:4,line:-1,toolbar:4,form:8,accordion:2},layoutPadding:{space:10,wide:0,clean:0,head:0,line:0,toolbar:3,form:17,accordion:0},tabMargin:0,tabOffset:0,tabBottomOffset:0,tabTopOffset:0,tabBorder:!0,customCheckbox:!0,customRadio:!0,sidebarMarkAll:!0,popupNoPoint:!0,borderlessPopup:!0,popupPadding:0,dataPadding:12,calendarWeekHeaderHeight:18,padding:0,accordionType:"accordion",optionHeight:32,timelineColor:"#37A9EF",backColor:"#FFFFFF",dataBorderColor:"#E6E6E6",colorPadding:4},dark:{topLayout:"space",barHeight:46,tabbarHeight:44,sidebarTitleHeight:46,rowHeight:36,toolbarHeight:46,listItemHeight:36,inputHeight:38,buttonHeight:38,inputPadding:3,menuHeight:36,labelTopHeight:22,propertyItemHeight:28,timelineItemHeight:64,unitHeaderHeight:36,fontSize:14,inputSpacing:4,borderWidth:1,sliderHandleWidth:14,sliderPadding:10,sliderBorder:1,vSliderPadding:15,vSliderHeight:100,switchHeight:24,switchWidth:50,layoutMargin:{space:10,wide:10,clean:0,head:4,line:-1,toolbar:4,form:8,accordion:2},layoutPadding:{space:10,wide:0,clean:0,head:0,line:0,toolbar:3,form:17,accordion:0},tabMargin:0,tabOffset:0,tabBottomOffset:0,tabTopOffset:0,tabBorder:!0,customCheckbox:!0,customRadio:!0,sidebarMarkAll:!0,popupNoPoint:!0,borderlessPopup:!1,popupPadding:0,dataPadding:12,calendarWeekHeaderHeight:18,padding:0,accordionType:"accordion",optionHeight:32,timelineColor:"#7A67EB",backColor:"#2A2B2D",dataBorderColor:"#384047",colorPadding:4}};$i(window.webix_skin||"material");var Ii={config:{longTouchDelay:700,scrollDelay:150,gravity:500,deltaStep:10,speed:"0ms",finish:1e3,elastic:!0},limit:function(t){Ii._limited=!1!==t},disable:function(){Ii._disabled=!0},enable:function(){Ii._disabled=!1},$init:function(){Ii.$init=function(){},pe(document.body,Ot.touch.down,Ii._touchstart,{passive:!1}),pe(document.body,Ot.touch.move,Ii._touchmove,{passive:!1}),pe(document,Ot.touch.up,Ii._touchend),pe(document.body,"dragstart",(function(t){if(!Ii._disabled&&!Ii._limited)return St(t)})),Ii._clear_artefacts(),Ii._scroll=[null,null],Ii.$active=!0},_clear_artefacts:function(){Ii._start_context=Ii._current_context=Ii._prev_context=Ii._scroll_context=null,Ii._scroll_mode=Ii._scroll_node=Ii._scroll_stat=Ii._long_touched=null,Ii._delta={_x_moment:0,_y_moment:0,_time:0},Ii._css_button_remove&&(Et(Ii._css_button_remove,"webix_touch"),Ii._css_button_remove=null),window.clearTimeout(Ii._long_touch_timer),Ii._was_not_moved=!0,Ii._axis_x=!0,Ii._axis_y=!0,Ii._active_transion||Ii._scroll_end()},_touchend:function(t){if(Ii._start_context){if(Ii._scroll_mode){var e=Ii.config.finish,i=Ii._get_matrix(Ii._scroll_node),s=i.e,n=i.f,a=Ii._get_delta(t),r=ke(Ii._scroll_node),o=r&&r.$scroll?r.$scroll.gravity:Ii.config.gravity;if(a._time){var l=s+o*a._x_moment/a._time,h=n+o*a._y_moment/a._time,c=Ii._scroll[0]?Ii._correct_minmax(l,!1,!1,Ii._scroll_stat.dx,Ii._scroll_stat.px):s,d=Ii._scroll[1]?Ii._correct_minmax(h,!1,!1,Ii._scroll_stat.dy,Ii._scroll_stat.py):n,u=Math.max(Math.abs(c-s),Math.abs(d-n));u<150&&(e=e*u/150),c==s&&d==n||(e=Math.round(e*Math.max((c-s)/(l-s),(d-n)/(h-n))));var _={e:c,f:d};r&&r.adjustScroll&&r.adjustScroll(_),e=Math.min(Ii.config.finish,Math.max(100,e)),s!=_.e||n!=_.f?(Ii._set_matrix(Ii._scroll_node,_.e,_.f,e+"ms"),Ii._scroll_master&&Ii._scroll_master._sync_scroll(_.e,_.f,e+"ms")):Ii._scroll_end()}else Ii._scroll_end()}else if(!(Ii._long_touched||Ii._axis_x*Ii._axis_y)){var p=Ii._get_delta(t);!Ii._axis_x&&p._x/(p._y||1)>4?Ii._translate_event("onSwipeX"):!Ii._axis_y&&p._y/(p._x||1)>4&&Ii._translate_event("onSwipeY")}Ii._translate_event("onTouchEnd"),Ii._clear_artefacts()}},_touchmove:function(t){if(Ii._scroll_context&&Ii._start_context){var e=Ii._get_delta(t);if(Ii._translate_event("onTouchMove"),Ii._scroll_mode)Ii._set_scroll_pos();else if(Ii._axis_x=Ii._axis_check(e._x,"x",Ii._axis_x),Ii._axis_y=Ii._axis_check(e._y,"y",Ii._axis_y),Ii._scroll_mode){var i=Ii._get_event_view("onBeforeScroll",!0);if(i){var s={};i.callEvent("onBeforeScroll",[s]),s.update&&(Ii.config.speed=s.speed,Ii.config.scale=s.scale)}Ii._init_scroller()}else{var n=Ii._is_scroll(),a=ke(n&&n[0]);if(a&&a.$hasYScroll&&a.$hasYScroll()&&t.cancelable)return St(t)}return Ii._scroll_mode&&t.cancelable?St(t):void 0}},_set_scroll_pos:function(){if(Ii._scroll_node){var t=Ii._get_matrix(Ii._scroll_node),e=Ii._prev_context||Ii._start_context,i=ke(Ii._scroll_node),s=i&&i.$scroll?i.$scroll.elastic:Ii.config.elastic;Ii._scroll[0]&&(t.e=Ii._correct_minmax(t.e-e.x+Ii._current_context.x,s,t.e,Ii._scroll_stat.dx,Ii._scroll_stat.px)),Ii._scroll[1]&&(t.f=Ii._correct_minmax(t.f-e.y+Ii._current_context.y,s,t.f,Ii._scroll_stat.dy,Ii._scroll_stat.py)),Ii._set_matrix(Ii._scroll_node,t.e,t.f,"0ms"),Ii._scroll_master&&Ii._scroll_master._sync_scroll(t.e,t.f,"0ms")}},scrollTo:function(t,e,i,s){Ii._set_matrix(t,e,i,s)},_set_matrix:function(t,e,i,s){if(s){if(Ii._active_transion=!0,t){var n=Ii.config.translate||Ot.translate;t.style[Ot.transform]=n+"("+Math.round(e)+"px, "+Math.round(i)+"px"+("translate3d"==n?", 0":"")+")",t.style[Ot.transitionDuration]=s}}else t.style[Ot.transform]=""},_get_matrix:function(t){var e,i=window.getComputedStyle(t)[Ot.transform];if("none"==i)e={e:0,f:0};else if(window.WebKitCSSMatrix)e=new WebKitCSSMatrix(i);else{var s=i.replace(/(matrix\()(.*)(\))/gi,"$2");s=(s=s.replace(/\s/gi,"")).split(","),e={};for(var n=["a","b","c","d","e","f"],a=0;a<n.length;a++)e[n[a]]=parseInt(s[a],10)}return Ii._scroll_master&&Ii._scroll_master._sync_pos(e),e},_correct_minmax:function(t,e,i,s,n){if(t===i)return t;if(n>s)return 0;var a=Math.abs(t-i),r=a/(t-i);if(t>0)return e?i+r*Math.sqrt(a):0;var o=s-n;return o+t<0?e?i+r*Math.sqrt(a):-o:t},_init_scroll_node:function(t){t.scroll_enabled||(t.scroll_enabled=!0,t.parentNode.style.position="relative",t.style.cssText+="transition:transform; user-select:none; transform-style:flat;",t.addEventListener(Ot.transitionEnd,Ii._scroll_end,!1))},_init_scroller:function(){-1!==Ii._scroll_mode.indexOf("x")&&(Ii._scroll[0]=!0),-1!==Ii._scroll_mode.indexOf("y")&&(Ii._scroll[1]=!0),(Ii._scroll[0]||Ii._scroll[1])&&(Ii._scroll[2]=Ii._scroll_node),Ii._init_scroll_node(Ii._scroll_node)},_axis_check:function(t,e,i){return t>Ii.config.deltaStep?(Ii._was_not_moved&&(Ii._long_move(e),Ii._locate(e),-1==(Ii._scroll_mode||"").indexOf(e)&&(Ii._scroll_mode="")),!1):i},_scroll_end:function(){var t,e,i;(i=ke(Ii._scroll_node||this))&&(Ii._scroll_node?t=Ii._get_matrix(Ii._scroll_node):i.getScrollState&&(t={e:-(e=i.getScrollState()).x,f:-e.y}),U("onAfterScroll",[t]),i.callEvent&&i.callEvent("onAfterScroll",[t])),Ii._scroll_mode||(Ii._scroll=[null,null]),Ii._active_transion=!1},_long_move:function(){window.clearTimeout(Ii._long_touch_timer),Ii._was_not_moved=!1},_stop_old_scroll:function(t){if(!Ii._scroll[2])return!0;Ii._stop_scroll(t,Ii._scroll[0]?"x":"y")},_touchstart:function(t){if(!Ii._disabled){Ii._long_touched=null,Ii._scroll_context=Ii._start_context=Ot.touch.context(t),Ii._limited&&!Ii._is_scroll()&&(Ii._scroll_context=null),Ii._translate_event("onTouchStart"),Ii._stop_old_scroll(t)&&(Ii._long_touch_timer=window.setTimeout(Ii._long_touch,Ii.config.longTouchDelay));var e=ke(t);!e||!e.touchable||t.target.className&&0===t.target.className.indexOf("webix_view")||(Ii._css_button_remove=e.getNode(t),Dt(Ii._css_button_remove,"webix_touch"))}},_long_touch:function(){Ii._start_context&&(Ii._long_touched=!0,Ii._translate_event("onLongTouch"),U("onClick",[Ii._start_context]))},_stop_scroll:function(t,e){if(Ii._locate(e),Ii._scroll[2]){var i=Ii._get_event_view("onBeforeScroll",!0);i&&i.callEvent("onBeforeScroll",[Ii._start_context,Ii._current_context]),Ii._scroll_node&&Ii._scroll_node.parentNode===Ii._scroll[2].parentNode||(Ii._clear_artefacts(),Ii._scroll_end(),Ii._start_context=Ot.touch.context(t))}Ii._touchmove(t)},_get_delta:function(t){return Ii._prev_context=Ii._current_context,Ii._current_context=Ot.touch.context(t),Ii._delta._x=Math.abs(Ii._start_context.x-Ii._current_context.x),Ii._delta._y=Math.abs(Ii._start_context.y-Ii._current_context.y),Ii._prev_context&&(Ii._current_context.time-Ii._prev_context.time<Ii.config.scrollDelay?(Ii._delta._x_moment=Ii._delta._x_moment/1.3+Ii._current_context.x-Ii._prev_context.x,Ii._delta._y_moment=Ii._delta._y_moment/1.3+Ii._current_context.y-Ii._prev_context.y):Ii._delta._y_moment=Ii._delta._x_moment=0,Ii._delta._time=Ii._delta._time/1.3+(Ii._current_context.time-Ii._prev_context.time)),Ii._delta},_get_sizes:function(t){return{dx:t.offsetWidth,dy:t.offsetHeight,px:t.parentNode.offsetWidth,py:t.parentNode.offsetHeight}},_is_scroll:function(t){for(var e=Ii._start_context.target;e&&"BODY"!=e.tagName;){if(e.getAttribute){var i=e.getAttribute("touch_scroll");if(i&&(!t||-1!=i.indexOf(t)))return[e,i]}e=e.parentNode}return null},_locate:function(t){var e=Ii._is_scroll(t);return e&&(Ii._scroll_mode=e[1],Ii._scroll_node=e[0],Ii._scroll_stat=Ii._get_sizes(e[0])),e},_translate_event:function(t){U(t,[Ii._start_context,Ii._current_context]);var e=Ii._get_event_view(t);e&&e.callEvent(t,[Ii._start_context,Ii._current_context])},_get_event_view:function(t,e){var i=ke(e?Ii._scroll_node:Ii._start_context);if(!i)return null;for(;i;){if(i.hasEvent&&i.hasEvent(t))return i;i=i.getParentView()}return null},_get_context:function(t){if(!t.touches[0]){var e=Ii._current_context;return e.time=new Date,e}return{target:t.target,x:t.touches[0].pageX,y:t.touches[0].pageY,time:new Date}},_get_context_m:function(t){return{target:t.target,x:t.pageX,y:t.pageY,time:new Date}}};Ne((function(){Ot.touch&&(Ii.$init(),-1===document.body.className.indexOf("webix_full_screen")&&Ii.limit(!0),Ot.isSafari&&CSS.supports("-webkit-overflow-scrolling: touch")&&gt(".webix_view{ -webkit-overflow-scrolling:touch; } .webix_scroll_cont{ transform:translateZ(0px); }"))})),Ot.mouse={down:"mousedown",move:"mousemove",up:"mouseup",context:Ii._get_context_m},Ot.touch=Ot.touch&&{down:"touchstart",move:"touchmove",up:"touchend",context:Ii._get_context};var Ai={_drag_masters:O(["dummy"]),addDrop:function(t,e,i){(t=F(t)).webix_drop=this._getCtrl(e),i&&(t.webix_master=!0)},_getCtrl:function(t){t=t||Ai;var e=this._drag_masters.find(t);return e<0&&(e=this._drag_masters.length,this._drag_masters.push(t),t.attachEvent&&t.attachEvent("onDestruct",(function(){return Ai.unlink(t)}))),e},unlink:function(t){var e=this._drag_masters.find(t);e>-1&&(Ai._active&&Ai._active.webix_drag==e&&Ai._stopDrag(),Ai._last&&Ai._last.webix_drop==e&&(Ai._last=null),this._drag_masters[e]=null)},_createTouchDrag:function(t,e){var i=Ai,s=this._getActiveDragMaster();if(s&&s.$longTouchLimit){if(!i._html&&!i.createDrag(t,e))return;t.longtouch_drag=!0;var n=$t(t),a=i.$dragPos(n,t),r=i._drag_context;i._html.style.top=n.y+i.top+(a||!r.y_offset?0:r.y_offset)+"px",i._html.style.left=n.x+i.left+(a||!r.x_offset?0:r.x_offset)+"px"}},addDrag:function(t,e){var i=this;(t=F(t)).webix_drag=this._getCtrl(e),_e(t,"dragstart",St),_e(t,Ot.mouse.down,(function(e){return i._preStart(e,t,"mouse")})),Ot.touch&&_e(t,Ot.touch.down,(function(e){return i._preStart(e,t,"touch")}))},_preStart:function(t,e,i){if(Ai._active){if(Ai._saved_event==t)return;Ai._preStartFalse(t),Ai.destroyDrag(t)}Ai._active=e;var s=Ot[i].context(t);Ai._start_pos=s,Ai._saved_event=t;var n="touch"===i?{passive:!1}:null;Ai._webix_drag_mm=pe(document.body,Ot[i].move,(function(t){return Ai._startDrag(t,i)}),n),Ai._webix_drag_mu=pe(document,Ot[i].up,Ai._preStartFalse),Dt(document.body,"webix_noselect",1)},_preStartFalse:function(t){Ai._clean_dom_after_drag(),Ai._touch_animation=!t.cancelable},_startDrag:function(t,e){var i="touch"===e;if(i||!Ai._saved_event.button){if(Ai._touch_animation=!t.cancelable,i&&Ai._touch_animation)return Ai._clean_dom_after_drag(),Ai.destroyDrag(t);var s=Ot[e].context(t),n=Ai._getActiveDragMaster();if(!(i&&n&&n.$longTouchLimit&&!Ii._long_touched||Math.abs(s.x-Ai._start_pos.x)<5&&Math.abs(s.y-Ai._start_pos.y)<5)){if(!Ai._html&&!Ai.createDrag(Ai._saved_event,e))return Ai._clean_dom_after_drag();Ai._clean_dom_after_drag(!0),Ai.sendSignal("start"),i?(Ai._webix_drag_mm=pe(t.target,Ot[e].move,(function(t){return Ai._moveDrag(t,e)}),{passive:!1}),Ai._webix_drag_mu=pe(t.target,Ot[e].up,Ai._stopDrag)):(Ai._webix_drag_mm=pe(document.body,Ot[e].move,(function(t){return Ai._moveDrag(t,e)})),Ai._webix_drag_mu=pe(document,Ot[e].up,Ai._stopDrag)),Ai._moveDrag(t,e,!0)}}},_stopDrag:function(t){Ai._clean_dom_after_drag(),Ai._saved_event=null,Ai._last&&t&&(Ai.$drop(Ai._active,Ai._last,t),Ai.$dragOut(Ai._active,Ai._last,null,t)),Ai.destroyDrag(t),Ai.sendSignal("stop")},_clean_dom_after_drag:function(t){this._webix_drag_mm=fe(this._webix_drag_mm),this._webix_drag_mu=fe(this._webix_drag_mu),t||Et(document.body,"webix_noselect")},_moveDrag:function(t,e,i){var s=Ai,n=$t(t),a=s.$dragPos(n,t),r=s._drag_context;if(s._html.style.top=n.y+s.top+(a||!r.y_offset?0:r.y_offset)+"px",s._html.style.left=n.x+s.left+(a||!r.x_offset?0:r.x_offset)+"px",i&&(s._skip=!1),s._skip)s._skip=!1;else{var o=t;if("touch"===e){var l=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,h=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,c=Ot[e].context(t),d=document.elementFromPoint(c.x-l,c.y-h);o=new Proxy(t,{get:function(e,i){if("target"===i)return d;var s=e[i];return"function"==typeof s?s.bind(t):s}})}s._checkLand(o.target,o)}return St(t)},_checkLand:function(t,e){for(;t&&"BODY"!=t.tagName;){if(t.webix_drop)return this._last&&(this._last!=t||t.webix_master)&&this.$dragOut(this._active,this._last,t,e),!this._last||this._last!=t||t.webix_master?(this._last=null,this._landing=this.$dragIn(Ai._active,t,e),void(this._landing&&(this._last=t))):void 0;t=t.parentNode}this._last&&(this._last=this._landing=this.$dragOut(this._active,this._last,null,e))},sendSignal:function(t){Ai.active="start"==t,U("onDragMode",[t])},getMaster:function(t){return this._drag_masters[t.webix_drag||t.webix_drop]},getContext:function(){return this._drag_context},getNode:function(){return this._html},createDrag:function(t,e){var i=Ai._active;Ai._drag_context={};var s,n=this._drag_masters[i.webix_drag];if(n.$dragCreate){if(!(s=n.$dragCreate(i,t,e)))return!1;this._setDragOffset(t),s.style.position="absolute"}else{var a=Ai.$drag(i,t,e);if(Ai._setDragOffset(t),!a)return!1;(s=document.createElement("DIV")).innerHTML=a,s.className="webix_drag_zone",document.body.appendChild(s);var r=Ai._drag_context;r.html&&(r.x_offset=-Math.round(.5*s.offsetWidth),r.y_offset=-Math.round(.75*s.offsetHeight))}return s.style.zIndex=Math.max(s.style.zIndex,Ve()),Ai._skipDropH=pe(s,Ot[e].move,Ai._skip_mark),Ai._drag_context.from||(Ai._drag_context={source:i,from:i}),Ai._html=s,!0},_skip_mark:function(){Ai._skip=!0},destroyDrag:function(t){var e=Ai._active,i=this._drag_masters[e.webix_drag];Ai._skipDropH&&(Ai._skipDropH=fe(Ai._skipDropH)),i&&i.$dragDestroy?Ai._html&&i.$dragDestroy(e,Ai._html,t):wt(Ai._html),i&&i._auto_scroll_delay&&(i._auto_scroll_delay=window.clearTimeout(i._auto_scroll_delay)),Ai._dropHTML&&wt(Ai._dropHTML),Ai._landing=Ai._active=Ai._last=Ai._html=Ai._dropHTML=null,Ai._drag_context=null},_getActiveDragMaster:function(){return Ai._drag_masters[Ai._active.webix_drag]},top:0,left:0,_setDragOffset:function(t){var e=Ai._start_pos,i=Ai._drag_context;if(void 0!==i.x_offset&&void 0!==i.y_offset)return null;i.x_offset=i.y_offset=0;var s=Ai._getActiveDragMaster();if(s._getDragItemPos&&s!==this){var n=s._getDragItemPos(e,t);n&&(i.x_offset=n.x-e.x,i.y_offset=n.y-e.y)}},$dragPos:function(t,e){var i=this._drag_masters[Ai._active.webix_drag];if(i.$dragPos&&i!=this)return i.$dragPos(t,e,Ai._html),!0},$dragIn:function(t,e,i){var s=this._drag_masters[e.webix_drop];return s.$dragIn&&s!=this?s.$dragIn(t,e,i):(e.className=e.className+" webix_drop_zone",e)},$dragOut:function(t,e,i,s){var n=this._drag_masters[e.webix_drop];return n.$dragOut&&n!=this?n.$dragOut(t,e,i,s):(e.className=e.className.replace("webix_drop_zone",""),null)},$drop:function(t,e,i){var s=this._drag_masters[e.webix_drop];if(Ai._drag_context.from=Ai.getMaster(t),s.$drop&&s!=this)return s.$drop(t,e,i);e.appendChild(t)},$drag:function(t,e,i){var s=this._drag_masters[t.webix_drag];return s.$drag&&s!=this?s.$drag(t,e,i):"<div style='"+t.style.cssText+"'>"+t.innerHTML+"</div>"}};W("onLongTouch",(function(t){var e=Ai._active;!Ai._touch_animation&&e&&e.contains(t.target)&&Ai._createTouchDrag(t,"touch")}));var Di={move_setter:function(e){return e&&(t.extend(this,Ei,!0),Ai.addDrag(this._headobj?this._headobj:this.$view,this),delete this.move_setter),e}},Ei={$dragCreate:function(t,e){if(this.config.move){var i=kt(t),s=$t(e);return Ai.top=i.y-s.y,Ai.left=i.x-s.x,F(this._viewobj)}},$dragDestroy:function(t,e){var i=this;i._settings&&(i._settings.top=parseInt(e.style.top,10),i._settings.left=parseInt(e.style.left,10)),Ai.top=Ai.left=0,this.callEvent("onViewMoveEnd",[])},$dragPos:function(t,e){this.callEvent("onViewMove",[t,e])}},ji={_modal_set:function(t){if(t){if(!this._modal_cover){this._modal_cover=vt("div",{class:"webix_modal"});var e=this._modality=Ve(this._settings.zIndex);me._modality.push(e),this._modal_cover.style.zIndex=e-1,this._viewobj.style.zIndex=e,document.body.appendChild(this._modal_cover),document.body.style.overflow="hidden",_e(this._modal_cover,"click",A(this._ignore_clicks,this))}}else if(this._modal_cover){wt(this._modal_cover),this._modal_cover=null;var i=me._modality;i.splice(i.indexOf(this._modality),1),i.length||(document.body.style.overflow="")}return t}},Vi={resize_setter:function(t){return t&&!this._resizeHandlers&&this._renderResizeHandler(),t},_renderResizeHandler:function(){var t=this;if(!this._rwHandle){var e=this._viewobj;e.firstChild&&((e=e.firstChild).style.position="relative"),this._rwHandle=vt("DIV",{class:"webix_resize_handle",webix_disable_drag:"true"}),e.appendChild(this._rwHandle),_e(this._rwHandle,Ot.mouse.down,(function(e){return t._wrDown(e,"mouse")})),Ot.touch&&_e(this._rwHandle,Ot.touch.down,(function(e){return t._wrDown(e,"touch")}))}},_showResizeFrame:function(t,e){if(!this._resizeFrame){this._resizeFrame=vt("div",{class:"webix_resize_frame"},""),document.body.appendChild(this._resizeFrame);var i=kt(this._viewobj);this._resizeFrame.style.left=i.x+"px",this._resizeFrame.style.top=i.y+"px",this._resizeFrame.style.zIndex=Ve()}this._resizeFrame.style.width=t+"px",this._resizeFrame.style.height=e+"px"},_wrDown:function(t,e){var i=this;if(this.config.resize){Dt(document.body,"webix_noselect webix_resize_cursor"),this._wsReady=kt(this._viewobj);var s="touch"===e?{passive:!1}:null;this._resizeHandlersMove=pe(document.body,Ot[e].move,(function(t){return i._wrMove(t,e)}),s),this._resizeHandlersUp=pe(document,Ot[e].up,(function(){return i._wrUp()}))}},_wrMove:function(t,e){if(!1!==this._wsReady){var i=$t(t),s={x:i.x-this._wsReady.x,y:i.y-this._wsReady.y};if(this.$resizeMove)this.$resizeMove(s);else{var n=this.config,a=n.minWidth||100,r=n.minHeight||100;s.x<a?s.x=a:s.x>n.maxWidth&&(s.x=n.maxWidth),s.y<r?s.y=r:s.y>n.maxHeight&&(s.y=n.maxHeight)}this._wsProgress=s,this._showResizeFrame(s.x,s.y),"touch"===e&&St(t)}},_wrUp:function(){this._resizeFrame&&(this._resizeFrame=wt(this._resizeFrame)),Et(document.body,"webix_resize_cursor"),Et(document.body,"webix_noselect"),fe(this._resizeHandlersMove),fe(this._resizeHandlersUp),this._wsProgress&&(this.$resizeEnd?this.$resizeEnd(this._wsProgress):(this.config.width=this._wsProgress.x,this.config.height=this._wsProgress.y,this.resize())),this._wsReady=this._wsProgress=!1,this.callEvent("onViewResize",[])}},Ni={name:"window",$init:function(t){this._viewobj.innerHTML="<div class='webix_win_content'><div class='webix_win_head'></div><div class='webix_win_body'></div></div>",this._contentobj=this._viewobj.firstChild,this._headobj=this._contentobj.childNodes[0],this._dataobj=this._bodyobj=this._contentobj.childNodes[1],this._viewobj.className+=" webix_window",this._viewobj.setAttribute("role","dialog"),this._viewobj.setAttribute("tabindex","0"),this._head_cell=this._body_cell=null,this._settings._inner={top:!1,left:!1,right:!1,bottom:!1},t.id||(t.id=T()),_e(this._contentobj,"click",this._ignore_clicks,{bind:this}),_e(this._contentobj,"click",(function(){!this._settings.zIndex&&this._settings.toFront&&(this._viewobj.style.zIndex=Ve())}),{bind:this,capture:!0}),t.modal&&(this._modal=!0),t.headHeight&&(this._settings.headHeight=t.headHeight),t.close&&(this._settings.close=t.close),this.attachEvent("onViewMoveEnd",(function(){this._settings.position&&delete this._settings.position}))},_ignore_clicks:function(t){var e=me._popups,i=e.find(this);-1==i&&(i=e.length-1),t.click_view=i},getChildViews:function(){return this._head_cell?[this._head_cell,this._body_cell]:[this._body_cell]},zIndex_setter:function(t){return this._viewobj.style.zIndex=t,t},_remove:function(){this.body_setter()},_replace:function(t,e){var i=(e=e||this._body_cell)==this._body_cell;e.destructor(),i?this._body_cell=t:this._head_cell=t,(i?this._bodyobj:this._headobj).appendChild(t._viewobj);var s=t._viewobj.style,n={top:!0,left:!0,right:!0,bottom:!0},a="0px";!1===t.config.borderless&&(n=S(this._settings._inner),a="1px"),t._settings._inner=n,s.borderTopWidth=s.borderBottomWidth=s.borderLeftWidth=s.borderRightWidth=a,this.resize(!0)},show:function(t,i,s){if(!0===t){if(!this._settings.hidden)return;t=null}if(!this.callEvent("onBeforeShow",arguments))return!1;var n,a,r;if(this._settings.hidden=!1,this._viewobj.style.zIndex=Ve(this._settings.zIndex),(this._settings.modal||this._modal)&&(this._modal_set(!0),this._modal=null),(i=i||{}).pos||(i.pos=this._settings.relative),t){"object"!=e(t)||t.tagName?(f(t=F(t),"Not existing target for window:show"),n=kt(t)):t.target?(n=$t(t),a=20,r=5):n=t;var o=Math.max(window.innerWidth||0,document.body.offsetWidth),l=Math.max(window.innerHeight||0,document.body.offsetHeight);a=a||t.offsetWidth||0,r=r||t.offsetHeight||0;var h=this._last_size,c=n.x,d=n.y,u=0,_=0,p=0,g=0,m=this._settings.autofit;if(m){var v="node"===m,b=6,w=6,y=6;this._settings.point||(b=w=y=0),s="top",d=0,c=0,p=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,o-n.x-a<h[0]&&"right"==i.pos&&!v&&(i.pos="left"),"right"==i.pos?(c=n.x+b+a,w=-r,s="left",u=Math.round(n.y+r/2),_=c-y):"left"==i.pos?(c=n.x-b-h[0]-1,w=-r,s="right",u=Math.round(n.y+r/2),_=c+h[0]+1):(c=n.x<p?p:o+p-n.x>h[0]?n.x:o+p-b-h[0],_=Math.round(n.x+a/2),_=Math.min(_,c+h[0]-3*y)),g=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,(!h[1]||l+g-r-n.y-w>h[1]||v)&&"top"!=i.pos?(d=r+n.y+w-(this._settings.point?4:0),u||(s="top",u=d-y)):(d=n.y-w-h[1])<0?(d=0,"top"==s&&(s=!1)):u||(s="bottom",u=--d+h[1]+1)}var x=i.x||0,k=i.y||0,C=this._checkFixedPosition();this.$view.style.position=C?"fixed":"absolute",C&&(d-=g,u-=g),this.setPosition(c+x,d+k),this._set_point&&(s&&this._settings.point?this._set_point(s,_+x,u+k,C):this._hide_point())}else this._setPosition(this._settings.left,this._settings.top);this._viewobj.style.display="block",this._hide_timer=1,j((function(){this._hide_timer=0}),this,[],Ot.fastClick?100:400),this._render_hidden_views(),this.config.autofocus&&(this._prev_focus=ni.getFocus(),ni.setFocus(this)),-1==me._popups.find(this)&&me._popups.push(this),this.callEvent("onShow",[])},_hide:function(t){if(!this._settings.hidden&&!this._settings.modal&&this._settings.escHide&&!this._hide_timer&&!(t&&t.showpopup&&(t.showpopup==this._settings.id||this.getTopMenu&&this.getTopMenu()._settings.id==t.showpopup)||t&&Ot.touch&&t.longtouch_drag||me._modality.length&&this._viewobj.style.zIndex<=Math.max.apply(Math,s(me._modality)))){if(t){var e=t.click_view;if(e||0===e||(e=-1),me._popups.find(this)<=e)return}this._hide_single()}},hidden_setter:function(t){return t?this.hide():this.show(),!!t},hide:function(){var t=this._hide_single();this._hide_sub_popups(t)},_hide_single:function(){if(!this.$destructed&&!this._settings.hidden){if(this._settings.modal&&this._modal_set(!1),this._hiding_process(),this._settings.autofocus){var t=document.activeElement;t&&this._viewobj&&(this._viewobj.contains(t)||t===document.body)&&(ni.setFocus(this._prev_focus),this._prev_focus=null)}var e=me._popups.find(this);return e>-1&&me._popups.removeAt(e),e}},_hiding_process:function(){"top"==this._settings.position?Ci(this._viewobj,{type:"slide",x:0,y:-(this._content_height+20),duration:300,callback:this._hide_callback,master:this}):this._hide_callback()},_hide_sub_popups:function(t){if(t>-1)for(var e=me._popups,i=e.length-1;i>=t;i--)e[i]._hide_point&&e[i]._hide_single()},destructor:function(){this.hide(),ri.destructor.apply(this,[])},_hide_callback:function(){this.$destructed||(this._viewobj.style.display="none",this._settings.hidden=!0,this.callEvent("onHide",[]))},close:function(){this.destructor()},_inner_body_set:function(t){void 0===t.borderless&&(t.borderless=!0)},body_setter:function(t){return"object"!=e(t)&&(t={template:t}),this._inner_body_set(t),me._parent_cell=this,this._body_cell=be._view(t),this._bodyobj.appendChild(this._body_cell._viewobj),t},head_setter:function(e){var i=this;if(!1===e)return e;var s=this._settings.headHeight,n="string"==typeof e,a={height:s,padding:0,css:"webix_win_title",type:"header",borderless:!0};n&&(this._viewobj.setAttribute("aria-label",e),e={template:e}),("template"==e.view||!e.view&&e.template)&&t.extend(e,a),n&&this.config.close?e={padding:{left:vi.inputHeight+2,right:2},cols:[e,{height:s,view:"icon",icon:"wxi-close",click:function(){i.hide()}}]}:t.extend(e,{borderless:!0}),me._parent_cell=this,this._head_cell=be._view(e);var r=this._head_cell._viewobj.querySelector(".webix_win_title>div");return r&&(r.style.lineHeight=s+"px"),this._headobj.appendChild(this._head_cell._viewobj),e},getBody:function(){return this._body_cell},getHead:function(){return this._head_cell},adjust:function(){return this.resize()},resizeChildren:function(){this._body_cell&&this.resize()},resize:function(){pi.api.adjust.call(this),U("onResize",[]),this.isVisible()&&this._setPosition(this._settings.left,this._settings.top)},_checkFixedPosition:function(){if(this._settings.master){var t=ke(this._settings.master).getTopParentView().$view;return t&&"fixed"===t.style.position}return!1},_setPosition:function(t,e){if(this._settings.position||this._checkFixedPosition()){this.$view.style.position="fixed";var i=this._content_width,s=this._content_height;if(i<=0||s<=0)return;var n=window.innerWidth||document.documentElement.offsetWidth,a=window.innerHeight||document.documentElement.offsetHeight,r=Math.round((n-i)/2),o=Math.round((a-s)/2);if("function"==typeof this._settings.position){var l={left:r,top:o,width:i,height:s,maxWidth:n,maxHeight:a};this._settings.position.call(this,l),l.width==i&&l.height==s||(this._settings.width=l.width,this._settings.height=l.height,this.$setSize(l.width,l.height)),this.setPosition(l.left,l.top)}else"top"==this._settings.position&&(o=-1*s),this._settings.position||(r=this._settings.left||r,o=this._settings.top||o),this.setPosition(r,o);"top"==this._settings.position&&Ci(this._viewobj,{type:"slide",x:0,y:s-2*(this._settings.padding||0),duration:300,callback:this._topPositionCallback,master:this})}else this.setPosition(t,e)},_topPositionCallback:function(t){Ci.clear(t),this._settings.top=-2*(this._settings.padding||0),this.setPosition(this._settings.left,this._settings.top)},setPosition:function(t,e){this._viewobj.style.top=e+"px",this._viewobj.style.left=t+"px",this._settings.left=t,this._settings.top=e},$getSize:function(t,e){var i=this._settings._inner;i&&(t+=(i.left?0:1)+(i.right?0:1),e+=(i.top?0:1)+(i.bottom?0:1)),this._settings.head&&(e+=1);var s=this._body_cell.$getSize(0,0),n=0;if(this._head_cell){var a=this._head_cell.$getSize(0,0);a[3]==a[2]&&(this._settings.headHeight=a[3]),e+=this._settings.headHeight,n=a[0]}if(this._settings.fullscreen){var r=window.innerWidth||document.body.clientWidth,o=window.innerHeight||document.body.clientHeight;return[r,r,o,o]}var l=mi.api.$getSize.call(this,0,0);return n&&s[1]>1e5&&(s[0]=Math.max(n,s[0])),l[1]=Math.min(l[1],(s[1]>=1e5&&l[1]>=1e5?Math.max(s[0],l[0]):s[1])+t),l[3]=Math.min(l[3],(s[3]>=1e5&&l[3]>=1e5?Math.max(s[2],l[2]):s[3])+e),l[0]=Math.min(Math.max(l[0],s[0]+t),l[1]),l[2]=Math.min(Math.max(l[2],s[2]+e),l[3]),l},$setSize:function(t,e){mi.api.$setSize.call(this,t,e),t=this._content_width,e=this._content_height,!1===this._settings.head?(this._headobj.style.display="none",this._body_cell.$setSize(t,e)):(this._head_cell.$setSize(t,this._settings.headHeight),this._body_cell.$setSize(t,e-this._settings.headHeight))},$skin:function(){this.defaults.headHeight=vi.barHeight},defaults:{top:0,left:0,autofit:!0,relative:"bottom",body:"",head:"",hidden:!0,autofocus:!0,minWidth:300,minHeight:200,escHide:!0}};W("onLongTouch",(function(t){if(t&&t.target){var e=ke(t.target);if(e){e=e.queryView((function(t){return!t.getParentView()}),"parent")||e;var i=me._popups.find(e);-1!==i&&(t.click_view=i)}}}));var Ti={api:Ni,view:t.protoUI(Ni,mi.view,Di,ji,H,Vi)},Fi={defaults:{padding:"4",hidden:!0},body_setter:function(t){return t=Ti.api.body_setter.call(this,t),this._body_cell._viewobj.style.borderWidth="0px",t},attachTo:function(t){var e;f(t,"Invalid target for Context::attach"),e=t.on_context?t.attachEvent("onAfterContextMenu",A(this._show_at_ui,this)):pe(t,"contextmenu",this._show_at_node,{bind:this}),this.attachEvent("onDestruct",(function(){t.callEvent?t.detachEvent(e):fe(e),t=null}))},getContext:function(){return this._area},setContext:function(t){this._area=t},_show_at_node:function(t){return this._area=F(t),this._show_at(t)},_show_at_ui:function(t,e){return this._area={obj:ke(e),id:t},this._show_at(e)},_show_at:function(t){var e=this.show(t,null,!0);if(!1===e)return e;var i=ke(t);if(i){var s=i.queryView((function(t){return!t.getParentView()}),"parent")||i;s._ignore_clicks&&s._ignore_clicks(t)}return U("onClick",[t]),St(t)},_show_on_mouse_out:!0,master_setter:function(t){return this.attachTo(t),null}},Pi={_area:null,_blur_id:null,_ctrl:0,init:function(){return null!==this._area||(me.destructors.push({obj:this}),this._area=document.createElement("textarea"),this._area.className="webix_clipbuffer",this._area.setAttribute("webixignore",1),this._area.setAttribute("spellcheck","false"),this._area.setAttribute("autocapitalize","off"),this._area.setAttribute("autocorrect","off"),this._area.setAttribute("autocomplete","off"),document.body.appendChild(this._area),pe(document.body,"keydown",A((function(t){var e=t.which||t.keyCode,i=!(!t.ctrlKey&&!t.metaKey);86===e&&i&&(this._area.value="",j(this._paste,this,[t],100))}),this))),this._area},destructor:function(){this._area=null},set:function(t){this.init(),t=""===t?"\n":t,this._area.value=t,this.focus()},focus:function(){this._isSelectRange()||(this.init(),this._area.focus(),this._area.select())},_isSelectRange:function(){var t="";return void 0!==window.getSelection?t=window.getSelection().toString():void 0!==document.selection&&"Text"==document.selection.type&&(t=document.selection.createRange().text),!!t},_paste:function(t){if(t.target===this._area){var e=this._area.value,i=ni.getFocus();!i||i.getEditor&&i.getEditor()||(i.callEvent("onPaste",[e]),this._area.select())}}},Bi={escape:!0,delimiter:{rows:"\n",cols:"\t"},parse:function(t,e){if(e=e||this.delimiter,!this.escape)return this._split_clip_data(t,e);for(var i=t.replace(/\n$/,"").split(e.rows),s=0;s<i.length-1;)this._substr_count(i[s],'"')%2==1&&(i[s]+=e.rows+i[s+1],delete i[s+1],s++),s++;var n=[];for(s=0;s<i.length;s++)if(void 0!==i[s]){for(var a=i[s],r=0,o=[],l=!1,h=0;h<=a.length;h++){if(!l&&a[h]===e.cols||h===a.length){var c=a.substr(r,h-r);c[0]===c[c.length-1]&&'"'===c[0]&&(c=c.substr(1,c.length-2).replace('""','"')),o.push(c),r=h+1}'"'!==a[h]||(l=!l)}n.push(o)}return n},_split_clip_data:function(t,e){for(var i=t.split(e.rows),s=0;s<i.length;s++)i[s]=i[s].split(e.cols);return i},_substr_count:function(t,e){return t.split(e).length-1},stringify:function(t,e){if(e=e||this.delimiter,!this.escape){for(var i=0;i<t.length;i++)t[i]=t[i].join(e.cols);return t.join(e.rows)}for(var s=/\n|"|;|,/,n=0;n<t.length;n++){for(var a=0;a<t[n].length;a++){var r=t[n][a];r instanceof Date?t[n][a]=R.parseFormatStr(r):s.test(r)&&(t[n][a]='"'+r.toString().replace(/"/g,'""')+'"')}t[n]=t[n].join(e.cols)}return t.join(e.rows)}},Mi={clipboard_setter:function(t){return!0!==t&&1!==t||(t="modify"),this.attachEvent("onAfterSelect",this._sel_to_clip),this.attachEvent("onAfterEditStop",(function(t,e){var i=this.getSelectedId(!0);1==i.length&&e.id==i[0]&&this._sel_to_clip()})),this.attachEvent("onPaste",(function(t){if(!E(this._paste[this._settings.clipboard])){var e=Bi.parse(t,this._settings.delimiter);this._paste[this._settings.clipboard].call(this,e)}})),this.attachEvent("onFocus",(function(){Pi.focus()})),this.attachEvent("onItemClick",(function(t){this._selected&&-1===this._selected.find(t)||(Pi.focus(),ni.setFocus(this))})),t},_sel_to_clip:function(){var t=this;j((function(){if(!(t.$destructed||t.getEditor&&t.getEditor())){for(var e=t.getSelectedId(!0),i=[],s=0;s<e.length;s++){var n=e[s],a=t.getItem(n);i.push([t.type.templateCopy(a)])}var r=1===i.length?i[0][0]:Bi.stringify(i,t._settings.delimiter);Pi.set(r,t),Pi.focus(),ni.setFocus(t)}}))},_paste:{insert:function(t){var e=this;t.forEach((function(t){return e.add({value:t})}))},modify:function(t){for(var e=this.getSelectedId(!0),i=0;i<e.length;i++){if(E(t[i]))return;this.getItem(e[i]).value=t[i],this.refresh(e[i])}},custom:function(){}},templateCopy_setter:function(t){this.type.templateCopy=le(t)},type:{templateCopy:function(t){return this.template(t)}}},Oi={$customPrint:function(t,e){if(this._prePrint(t,e))return!0;var i=this._getTableArray(t),s=this._getTableHTML(i,t);if(e)return s;var n=vt("div",{class:"webix_ui_print"});n.appendChild(s),yt(n,t.docFooter,document.body),window.print(),wt(n)},_prePrint:function(e,i){if(!i&&("y"==this.config.layout||e.scroll||this.config.prerender||this.config.autoheight))return!0;"x"==this.config.layout&&t.extend(e||{},{xCount:this.count(),nobreaks:!0},!0)},_getPageWidth:function(t){var e=t.size["portrait"==t.mode?"width":"height"];return Math.min(e*Ot.printPPI-2*Ot.printMargin)},_getTableArray:function(t,e,i){var s,n,a="page"==t.fit?1/0:this._getPageWidth(t),r=t.xCount||this._getVisibleRange()._dx,o=[],l=[],h=0;i=i||0,e=e||[];for(var c=0;c<this.data.order.length;){var d=this.data.pull[this.data.order[c]];if(n=c-parseInt(c/r)*r,d&&n>=i){if((h+=this.type.width)>a&&n>i){s=l.length+i,o.push(l),c+=r-l.length,l=[],h=0;continue}var u=this.type.template(d,this.type),_=this._itemClassName,p={display:"table-cell",height:this.type.height+"px",width:this.type.width+"px"};l.push({txt:u,className:_+" "+(d.$css||""),style:p}),(c+1)%r==0&&(o.push(l),l=[],h=0)}c++}return e.push(o),s&&this._getTableArray(t,e,s),e},_getTableHTML:function(t,e){var i=vt("div");return t.forEach(A((function(s,n){var a=vt("table",{class:"webix_table_print "+this.$view.className,style:"border-collapse:collapse"});if(s.forEach((function(t){var e=vt("tr");t.forEach((function(t){var i=vt("td");t.txt&&(i.innerHTML=t.txt),t.className&&(i.className=t.className),t.style&&Object.keys(t.style).forEach((function(e){t.style[e]&&(i.style[e]=t.style[e])})),t.span&&(t.span.colspan>1&&(i.colSpan=t.span.colspan),t.span.rowspan>1&&(i.rowSpan=t.span.rowspan)),e.appendChild(i)})),a.appendChild(e)})),i.appendChild(a),!e.nobreaks&&n+1<t.length){var r=vt("DIV",{class:"webix_print_pagebreak"});i.appendChild(r)}}),this)),i}},Li={scrollStep:40,init:function(){return!Ot.scrollSize||Ot.$customScroll?!!Ot.$customScroll:(this.scrollStep=vi.rowHeight,Ot.$customScroll=!0,Ot.scrollSize=0,me.destructors.push({obj:{destructor:function(){this._last_active_node=null}}}),W("onReconstruct",Li._on_reconstruct),W("onResize",Li._on_reconstruct),W("onClick",Li._on_reconstruct),Ot.$customScroll)},resize:function(){this._on_reconstruct()},_enable_datatable:function(t){t._body._custom_scroll_view=t._settings.id,t.attachEvent("onAfterRender",(function(){var t=Li._get_datatable_sizes(this),e=Math.max(t.dy-t.py,0),i=Math.max(t.dx-t.px,0);this._y_scroll&&this._scrollTop>e?this._y_scroll.scrollTo(e):this._x_scroll&&this._scrollLeft>i&&this._x_scroll.scrollTo(i),Li._last_active_node==this._body&&Li._on_reconstruct()})),_e(t._body,"pointerover",Li._mouse_in),_e(t._body,"pointerout",Li._mouse_out),Ot.touch&&(t.attachEvent("onTouchStart",(function(){return Li._touch_start(t._body)})),t.config.prerender&&t.attachEvent("onSyncScroll",(function(){return Li._update_scroll(t._body)})))},enable:function(t,e){if(t.mapCells)return this._enable_datatable(t);var i=t;t._dataobj&&(i=t._dataobj.parentNode),i._custom_scroll_mode=e||"xy",i.className+=" webix_custom_scroll",_e(i,"pointerover",Li._mouse_in),_e(i,"pointerout",Li._mouse_out),_e(i,"wheel",Li._mouse_wheel,{passive:!1}),Ot.touch&&_e(i,"scroll",(function(){return Li._update_scroll(i)})),this._set_additional_handlers(t)},_on_reconstruct:function(){var t=Li._last_active_node;if(t&&t._custom_scroll_size){var e=ke(t),i=e?e.queryView((function(t){var e=Li._getViewNode(t);return e&&e._custom_scroll_size}),"all").map((function(t){return Li._getViewNode(t)})):[];i.push(t),i.forEach((function(t){Li._mouse_out_timed.call(t),Li._mouse_in.call(t,!1)}))}},_getViewNode:function(t){return t._body||t._dataobj&&t._dataobj.parentNode||t.$view},_mouse_in:function(t){if(!(t&&"mouse"!==t.pointerType||(Li._last_active_node=this,clearTimeout(this._mouse_out_timer),-1!=this.className.indexOf("webix_modalbox_inside")||this._custom_scroll_size||Li._active_drag_area))){var e=ke(this);if(!e||e.isEnabled()){var i;if(this._custom_scroll_view){if(!(e=ke(this._custom_scroll_view)))return;i=Li._get_datatable_sizes(e)}else(i={dx:this.scrollWidth,dy:this.scrollHeight,px:this.clientWidth,py:this.clientHeight})._scroll_x=i.dx>i.px&&-1!=this._custom_scroll_mode.indexOf("x"),i._scroll_y=i.dy>i.py&&-1!=this._custom_scroll_mode.indexOf("y");this._custom_scroll_size=i,i._scroll_x&&(i._scroll_x_node=Li._create_scroll(this,"x",i.dx,i.px,"width","height"),i._sx=i.px-i._scroll_x_node.offsetWidth-4,i._vx=i.dx-i.px,Li.trackBar&&(i._bar_x=Li._create_bar(this,"x"))),i._scroll_y&&(i._scroll_y_node=Li._create_scroll(this,"y",i.dy,i.py,"height","width"),i._sy=i.py-i._scroll_y_node.offsetHeight-4,i._vy=i.dy-i.py,Li.trackBar&&(i._bar_y=Li._create_bar(this,"y"))),Li._update_scroll(this)}}},_create_bar:function(t,e){var i=vt("DIV",{webixignore:"1",class:"webix_c_scroll_bar_"+e},"");return t.appendChild(i),i},_adjust_scroll:function(t,e,i){var s=t._custom_scroll_size,n=t._custom_scroll_view;if(n&&(n=ke(n)),s._scroll_x_node==t._scroll_drag_enabled){var a=(i.x-e.x)*s._vx/s._sx;n?n._x_scroll.scrollTo(n._scrollLeft+a):Li._set_scroll_value(t,"scrollLeft",a)}if(s._scroll_y_node==t._scroll_drag_enabled){var r=(i.y-e.y)*s._vy/s._sy;n?n._y_scroll.scrollTo(n._scrollTop+r):Li._set_scroll_value(t,"scrollTop",r)}t._scroll_drag_pos=i,Li._update_scroll(t)},_get_datatable_sizes:function(t){var e={};return t._x_scroll&&t._settings.scrollX&&(e.dx=t._x_scroll.getSize(),e.px=t._x_scroll._last_set_size||1,e._scroll_x=e.dx-e.px>1),t._y_scroll&&t._settings.scrollY&&(e.dy=t._y_scroll.getSize(),e.py=t._y_scroll._last_set_size||1,e._scroll_y=e.dy-e.py>1),e},_mouse_out:function(t){t&&"mouse"!==t.pointerType||(clearTimeout(this._mouse_out_timer),this._mouse_out_timer=j(Li._mouse_out_timed,this,[],200))},_removeScroll:function(t){t&&(wt(t),fe(t._webix_event_sc1),fe(t._webix_event_sc2))},_mouse_out_timed:function(){if(this._custom_scroll_size){if(this._scroll_drag_enabled)return void(this._scroll_drag_released=!0);var t=this._custom_scroll_size;Li._removeScroll(t._scroll_x_node),Li._removeScroll(t._scroll_y_node),t._bar_x&&wt(t._bar_x),t._bar_y&&wt(t._bar_y),this._custom_scroll_size=null}},_mouse_wheel:function(t){if(t.ctrlKey)return!1;var e=!1,i=0===t.deltaMode?30:1,s=this._custom_scroll_size;if(s){var n=!s._scroll_y||t.shiftKey;if(t.deltaX&&Math.abs(t.deltaX)>Math.abs(t.deltaY)||n){var a=(n?t.deltaY:t.deltaX)/i;s._scroll_x_node&&(e=Li._set_scroll_value(this,"scrollLeft",a*Li.scrollStep))}else s._scroll_y_node&&(e=Li._set_scroll_value(this,"scrollTop",t.deltaY/i*Li.scrollStep))}return Li._update_scroll(this),!1!==e?St(t):void 0},_set_scroll_value:function(t,e,i){var s=t._custom_scroll_size,n="scrollLeft"==e?s.dx-s.px:s.dy-s.py,a=t[e];return a+i>n&&(i=n-a),!(!i||a+i<0&&0===a||(Ot.isIE?(Li._update_scroll(t,e,i+a),t[e]+=i):t[e]+=i,0))},_create_scroll:function(t,e,i,s,n){var a=vt("DIV",{webixignore:"1",class:"webix_c_scroll_"+e},"<div></div>");return a.style[n]=Math.max(s*s/i-7,40)+"px",a.style["height"==n?"top":"left"]="0px",t.style.position="relative",t.appendChild(a),t._webix_event_sc1=pe(a,Ot.mouse.down,Li._scroll_drag(t,"mouse")),Ot.touch&&(t._webix_event_sc2=pe(a,Ot.touch.down,Li._scroll_drag(t,"touch"))),a},_init_drag:function(t,e){Li._drag_events="touch"===e?[pe(t.target,Ot[e].move,(function(t){Li._adjust_scroll(Li._active_drag_area,Li._active_drag_area._scroll_drag_pos,$t(t))})),pe(t.target,Ot[e].up,Li._scroll_drop)]:[pe(document.body,Ot[e].move,(function(t){Li._adjust_scroll(Li._active_drag_area,Li._active_drag_area._scroll_drag_pos,$t(t))})),pe(document,Ot[e].up,Li._scroll_drop),pe(document.body,"mouseleave",Li._scroll_drop)]},_scroll_drag:function(t,e){return function(i){Dt(document.body,"webix_noselect",1),this.className+=" webix_scroll_active",t._scroll_drag_enabled=this,t._scroll_drag_pos=$t(i),Li._active_drag_area=t,Li._init_drag(i,e),i.cancelable&&St(i)}},_scroll_drop:function(){var t=Li._active_drag_area;if(t._scroll_drag_enabled&&(Et(document.body,"webix_noselect"),t._scroll_drag_enabled.className=t._scroll_drag_enabled.className.toString().replace(" webix_scroll_active",""),t._scroll_drag_enabled=!1,Li._active_drag_area=!1,t._scroll_drag_released&&(Li._mouse_out_timed.call(t),t._scroll_drag_released=!1)),Li._drag_events){for(var e=0;e<Li._drag_events.length;e++)fe(Li._drag_events[e]);Li._drag_events=null}},_update_scroll:function(t,e,i){var s=t._custom_scroll_size;if(s&&(s._scroll_x_node||s._scroll_y_node)){var n=t._custom_scroll_view,a="scrollLeft"===e?i:Math.round(t.scrollLeft),r=n?ke(n)._scrollLeft:a,o=n?0:r,l="scrollTop"===e?i:Math.round(t.scrollTop),h=n?ke(n)._scrollTop:l,c=n?0:h;s._scroll_x_node&&(s._scroll_x_node.style.bottom=1-c+"px",s._scroll_x_node.style.left=Math.round(s._sx*r/(s.dx-s.px))+o+1+"px",s._bar_x&&(s._bar_x.style.bottom=1-c+"px",s._bar_x.style.left=o+"px")),s._scroll_y_node&&(s._scroll_y_node.style.right=0-o+"px",s._scroll_y_node.style.top=Math.round(s._sy*h/(s.dy-s.py))+c+1+"px",s._bar_y&&(s._bar_y.style.right=0-o+"px",s._bar_y.style.top=c+"px"))}},_set_additional_handlers:function(t){var e=this;t.attachEvent&&(t.attachEvent("onViewShow",(function(){return e._resize_scroll(t)})),t.attachEvent("onAfterAutoScroll",(function(){return e._resize_scroll(t)})),t._level_up&&t.attachEvent("onAfterRender",(function(){return e._resize_scroll(t)})),Ot.touch&&t.attachEvent("onTouchStart",(function(){return e._touch_start(t._dataobj.parentNode)}))),t.data&&t.data.attachEvent&&t.data.attachEvent("onStoreUpdated",(function(){return e._resize_scroll(t)}))},_touch_start:function(t){var e=Li._last_active_node;e!==t&&(e&&Li._mouse_out.call(e,!1),Li._mouse_in.call(t,!1))},_resize_scroll:function(t){var e=Li._last_active_node;e&&t.$view.contains(e)?Li._on_reconstruct():Li._mouse_out_timed.call(t._dataobj.parentNode)}},Ri={addCss:function(t,e,i){if(!this.addRowCss&&!i&&!this.hasCss(t,e)){var s=this.getItemNode(t);s&&(s.className+=" "+e,i=!0)}return this.data.addMark(t,e,1,1,i)},removeCss:function(t,e,i){if(!this.addRowCss&&!i&&this.hasCss(t,e)){var s=this.getItemNode(t);if(s){var n=new RegExp("(\\s|^)"+e+"(\\s|$)");s.className=s.className.replace(n,(function(t,e,i){return e&&i?" ":""})),i=!0}}return this.data.removeMark(t,e,1,i)},hasCss:function(t,e){return this.data.getMark(t,e)},clearCss:function(t,e){return this.data.clearMark(t,1,e)}},zi={copy:function(t,e,i,s){var n=(s=s||{}).newId||t;i=i||this;var a=this.getItem(t);return f(a,"Incorrect ID in DataMove::copy"),i&&(a=i._externalData(a)),i.data.add(i._externalData(a,n),e,s.parent||0)},_next_move_index:function(t,e,i){if(e&&t){var s=this.getIndexById(t);return s+(i==this&&i.getIndexById(e)<s?0:1)}},move:function(t,e,i,s){var n=(s=s||{}).newId||t;if(f((i=i||this).data,"moving attempt to component without datastore"),i.data){if(B(t)){t.length>3&&(this.$blockRender=i.$blockRender=!0);for(var a=0;a<t.length;a++){var r=this.move(t[a],e,i,s);e=i._next_move_index(r,t[a+1],this)}return this.$blockRender=i.$blockRender=!1,void(t.length>3&&(this.refresh(),i!=this&&i.refresh()))}var o=t,l=this.getItem(t);return f(l,"Incorrect ID in DataMove::move"),i&&i!=this?(o=i.data.add(i._externalData(l,n),e,s.parent||0),this.data.remove(t)):(e<0&&(e=this.data.order.length-1),this.data.move(this.getIndexById(t),e),this.data.callEvent("onDataMove",[t,e,null,this.data.order[e+1]])),o}},moveUp:function(t,e){var i=this.getIndexById(t)-(e||1);return this.move(t,i<0?0:i)},moveDown:function(t,e){return this.moveUp(t,-1*(e||1))},moveTop:function(t){return this.move(t,0)},moveBottom:function(t){return this.move(t,this.data.count()-1)},_externalData:function(e,i){var s=t.extend({},e);return s.id=!i||this.data.pull[i]?T():i,s.$template=null,this._settings.externalData&&(s=this._settings.externalData.call(this,s,i,e)),s}},Hi={$init:function(){this._events&&this.attachEvent("onChange",this.clearValidation)},clearValidation:function(){if(this.elements)for(var t in this.elements)this._clear_invalid(t)},validate:function(t,e){f(this.callEvent,"using validate for eventless object"),this.callEvent("onBeforeValidate",[]);var i=this._validate_details={},s=!0,n=this._settings.rules,a=this.isVisible&&!this.isVisible(),r=t&&t.hidden,o=t&&t.disabled,l={},h={};for(var c in this.elements){var d=this.elements[c].config.name;(a||this.elements[c].isVisible()||r)&&(this.elements[c].isEnabled()||o)?l[d]=this.elements[c]:h[d]=!0}if((n||l)&&!e&&this.getValues&&(e=this.getValues()),n){n.$obj&&(s=this._validate(n.$obj,e,e,"")&&s);var u=n.$all,_=e;if(this._settings.complexData&&(_=Qt.collapseNames(e,"",{},(function(t){return!n[t]}))),u)for(var p in e)if(!h[p]){var g=this._validate(u,_[p],e,p);g||(i[p]=!0),s=g&&s}for(var m in n)if(!h[m]&&0!==m.indexOf("$")&&!i[m]){f(n[m],"Invalid rule for:"+m);var v=this._validate(n[m],_[m],e,m);v||(i[m]=!0),s=v&&s}}if(l)for(var b in l)if(!i[b]){var w=l[b];if(w.validate){var y=w.validate();s=y&&s,y||(i[b]=!0)}else{var x=w._settings;if(x){var k=x.validate;if(!k&&x.required&&(k=n.isNotEmpty),k){var C=this._validate(k,e[b],e,b);C||(i[b]=!0),s=C&&s}}}}return this.callEvent("onAfterValidation",[s,this._validate_details]),s},_validate:function(t,e,i,s){return"string"==typeof t&&(t=Oe[t]),t.call(this,e,i,s)?(this.callEvent("onValidationSuccess",[s,i])&&this._clear_invalid&&this._clear_invalid(s),!0):(this.callEvent("onValidationError",[s,i])&&this._mark_invalid&&this._mark_invalid(s),!1)}},qi={};function Ui(t,i){if("object"==e(t)&&t._settings&&(t=t._settings.id),qi[t]||i)return qi[t];"string"!=typeof t&&"number"!=typeof t||(t={master:ke(t)});var s=new Wi(t),n=s._settings.master._settings.id;return qi[n]=s,ke(n).attachEvent("onDestruct",(function(){qi[this._settings.id]=null,delete qi[this._settings.id]})),s}_("dp",Ui),Ui.$$=function(t){return qi[t]};var Wi=t.proto({defaults:{autoupdate:!0,updateFromResponse:!1,mode:"post",operationName:"webix_operation",trackMove:!1},$init:function(){this.reset(),this._ignore=!1,this.name="DataProcessor",this.$ready.push(this._after_init_call)},reset:function(){this._updates=[]},url_setter:function(t){var e="";if("string"==typeof t){var i=t.split("->");i.length>1&&(t=i[1],e=i[0])}else t&&t.mode&&(e=t.mode,t=t.url);return e?rt(e,t):t},master_setter:function(t){var e=t;return"DataStore"!=t.name&&(e=t.data),this._settings.store=e,t},_promise:function(t){var e=this._waitSave;this._waitSave=[],t();var i=Promise.all(this._waitSave);return this._waitSave=e,e&&e.push(i),i},_after_init_call:function(){var t=this._settings.store;t&&(t.attachEvent("onStoreUpdated",A(this._onStoreUpdated,this)),t.attachEvent("onDataMove",A(this._onDataMove,this)))},ignore:function(t,e){var i=this._ignore;this._ignore=!0,t.call(e||this),this._ignore=i},off:function(){this._ignore=!0},on:function(){this._ignore=!1},_copy_data:function(t){var e={};for(var i in t)0!==i.indexOf("$")&&(e[i]=t[i]);return e},save:function(t,e,i){return e=e||"update",this._save_inner(t,i,e,!0)},_save_inner:function(t,i,s,n){if("object"==e(t)&&(t=t.toString()),t&&!0!==this._ignore&&s&&"paint"!=s){var a=this._settings.store;a&&(i=i||this._settings.store.getItem(t),a._scheme_serialize&&(i=a._scheme_serialize(i)));var r={id:t,data:this._copy_data(i),operation:s};if(E(i.$parent)||(r.data.parent=i.$parent),"delete"!=r.operation){var o=this._settings.master;o&&o.data&&o.data.getMark&&o.data.getMark(t,"webix_invalid")&&(r._invalid=!0),this.validate(null,r.data)||(r._invalid=!0)}return this._check_unique(r)&&this._updates.push(r),this._settings.autoupdate||n?this._sendData(t):void 0}},_onDataMove:function(t,e,i,s){if(this._settings.trackMove){var n=I(this._settings.store.getItem(t));n.webix_move_index=e,n.webix_move_id=s,n.webix_move_parent=i,this._save_inner(t,n,"order")}},_onStoreUpdated:function(t,e,i){switch(i){case"save":case"update":i="update";break;case"add":i="insert";break;case"delete":i="delete";break;default:return!0}return this._save_inner(t,e,i)},_check_unique:function(t){for(var e=0;e<this._updates.length;e++){var i=this._updates[e];if(i.id==t.id&&!i._in_progress)return"delete"==t.operation&&("insert"==i.operation?this._updates.splice(e,1):i.operation="delete"),i.data=t.data,i._invalid=t._invalid,!1}return!0},send:function(){return this._sendData()},_sendData:function(t){if(this._settings.url){for(var i,s=this._updates,n=[],a=this._settings.url,r=0;r<s.length;r++){var o=s[r];if(!o._in_progress&&!o._invalid){var l=o.id;if(this._settings.autoupdate||!t||t==l){var h=o.operation,c=rt.$parse("object"!=e(a)||a.$proxy?a:a[h]),d=c&&(c.$proxy||"function"==typeof c);if(c){var u=this._settings.store;if(u&&u._scheme_save&&u._scheme_save(o.data),this.callEvent("onBefore"+h,[l,o])){if(o._in_progress=!0,!this.callEvent("onBeforeDataSend",[o]))return;o.data=this._updatesData(o.data);var _=void 0;c.$proxy?(c.save&&(_=c.save(this.config.master,o,this)),n.push(o)):("insert"==h&&delete o.data.id,d?_=c.call(this.config.master,o.id,o.operation,o.data):(o.data[this._settings.operationName]=h,_=this._send(c,o.data,this._settings.mode))),_&&(_=this._proxy_on_save(_,{id:o.id,status:o.operation}),t&&l===t&&(i=_)),this.callEvent("onAfterDataSend",[o])}}}}}if(a.$proxy&&a.saveAll&&n.length){var p=a.saveAll(this.config.master,n,this);p&&(p=this._proxy_on_save(p,null),i||(i=p))}return i}},_proxy_on_save:function(t,e){var i=this;if(t)return t.then||(t=d.resolve(t)),t=t.then((function(t){var s;if(t&&"function"==typeof t.json&&(t=t.json()),!(s=null===e?i._processResult(t):i._processResult(e,"",t,-1)))throw s;return s}),(function(t){throw i._processError(e,"",null,t),t})),this._waitSave&&this._waitSave.push(t),t},_updatesData:function(t){var e={};for(var i in t)0!==i.indexOf("$")&&(e[i]=t[i]);return e},_send:function(t,e,i){return f(t,"url was not set for DataProcessor"),Z()[i](t,e)},attachProgress:function(t,e,i){this.attachEvent("onBeforeDataSend",t),this.attachEvent("onAfterSync",e),this.attachEvent("onAfterSaveError",i),this.attachEvent("onLoadError",i)},_processError:function(t,e,i,s){t?this._innerProcessResult(!0,t.id,!1,t.status,!1,{text:e,data:i,loader:s}):(this.callEvent("onLoadError",arguments),U("onLoadError",[e,i,s,this]))},_innerProcessResult:function(t,e,i,s,n,a){var r=this._settings.master,o=this.getItemState(e);if(o._in_progress=!1,!t){this.setItemState(e,!1);var l=this._settings.store;return l&&l.exists(e)&&(i&&e!=i&&l.changeId(e,i),n&&"delete"!=s&&this._settings.updateFromResponse&&this.ignore((function(){l.updateItem(i||e,n)}))),this._settings.undoOnError&&r._settings.undo&&r.removeUndo(i||e),this.callEvent("onAfterSave",[n,e,a]),this.callEvent("onAfter"+s,[n,e,a]),n||{}}this.callEvent("onBeforeSaveError",[e,s,n,a])&&(o._invalid=!0,this._settings.undoOnError&&r._settings.undo&&(this.ignore((function(){r.undo(e)})),this.setItemState(e,!1)),this.callEvent("onAfterSaveError",[e,s,n,a]))},processResult:function(t,e,i){var s=e&&("error"==e.status||"invalid"==e.status),n=!!e&&(e.newid||e.id);return this._innerProcessResult(s,t.id,n,t.status,e,i)},_processResult:function(t,e,i,s){var n,a=this;if(this.callEvent("onBeforeSync",[t,e,i,s]),B(t))n=[],t.forEach((function(t){n.push(a.processResult(t,t,{}))}));else if(-1===s)n=this.processResult(t,i,{});else{var r,o=this._settings.url;o.$proxy&&o.result?n=o.result(t,this._settings.master,this,e,i,s)||{}:(e&&(r=i.json(),e&&null==r&&(r={status:"error"})),n=this.processResult(t,r,{text:e,data:i,loader:s}))}return this.callEvent("onAfterSync",[t,e,i,s]),n},escape:function(t){return this._settings.escape?this._settings.escape(t):encodeURIComponent(t)},getState:function(){if(!this._updates.length)return!1;for(var t=this._updates.length-1;t>=0;t--)if(this._updates[t]._in_progress)return"saving";return!0},getItemState:function(t){var e=this._get_stack_index(t);return this._updates[e]||null},setItemState:function(t,e){if(e)this._save_inner(t,null,"update");else{var i=this._get_stack_index(t);i>-1&&this._updates.splice(i,1)}},_get_stack_index:function(t){for(var e=-1,i=0;i<this._updates.length;i++)if(this._updates[i].id==t){e=i;break}return e}},ai,H,Hi);function Yi(){this.name="DataStore",t.extend(this,H),this.setDriver("json"),this.pull={},this.order=O(),this._marks={}}Yi.prototype={setDriver:function(t){f(Xt[t],"incorrect DataDriver"),this.driver=Xt[t]},_parse:function(t){this.callEvent("onParse",[this.driver,t]),this._filter_order&&this.filter();var e=this.driver.getInfo(t);e.config&&this.callEvent("onServerConfig",[e.config]);var i=this.driver.getOptions(t);i&&this.callEvent("onServerOptions",[i]);var s=this.driver.getRecords(t);this._inner_parse(e,s),this._scheme_group&&this._group_processing&&!this._not_grouped_order&&this._group_processing(this._scheme_group),this._scheme_sort&&(this.blockEvent(),this.sort(this._scheme_sort),this.unblockEvent()),this.callEvent("onStoreLoad",[this.driver,t]),this.refresh()},_inner_parse:function(e,i){var s=e.from,n=!0,a=!1;if(!s&&0!==s&&this.order[0]){if(this._removeMissed){a={};for(var r=0;r<this.order.length;r++)a[this.order[r]]=!0}n=!1,s=this.order.length}else s=1*(s||0);for(var o=0,l=0;l<i.length;l++){var h=this.driver.getDetails(i[l]),c=this.id(h);this.pull[c]?n&&this.order[o+s]&&o++:(this.order[o+s]=c,o++),this.pull[c]?(t.extend(this.pull[c],h,!0),this._scheme_update&&this._scheme_update(this.pull[c]),a&&delete a[c]):(this.pull[c]=h,this._scheme_init&&this._scheme_init(h))}if(a){for(var d in this.blockEvent(),a)this.remove(d);this.unblockEvent()}var u=1*e.size;u&&(this.order[u-1]||(this.order[u-1]=void 0),u<this.order.length&&(this.order=O(this.order.slice(0,u))))},id:function(t){return t.id||(t.id=T())},changeId:function(t,e){t!=e&&(this.pull[t]&&(this.pull[e]=this.pull[t]),this.pull[e].id=e,this.order[this.order.find(t)]=e,this._filter_order&&(this._filter_order[this._filter_order.find(t)]=e),this._marks[t]&&(this._marks[e]=this._marks[t],delete this._marks[t]),this.callEvent("onIdChange",[t,e]),this._render_change_id&&this._render_change_id(t,e),delete this.pull[t])},getItem:function(t){return this.pull[t]},updateItem:function(i,s,n){"object"===e(i)&&(i=i.toString());var a=this.getItem(i),r=null,o=this.hasEvent("onDataUpdate");f(a,"Invalid ID for updateItem"),f(!s||!s.id||s.id==i,"Attempt to change ID in updateItem"),E(s)||a===s||(o&&(r=I(a)),i=a.id,t.extend(a,s,!0),a.id=i),this._scheme_update&&this._scheme_update(a),this.callEvent("onStoreUpdated",[i,a,n||"update"]),o&&this.callEvent("onDataUpdate",[i,a,r])},refresh:function(t){this._skip_refresh||(t?this.exists(t)&&this.callEvent("onStoreUpdated",[t,this.pull[t],"paint"]):this.callEvent("onStoreUpdated",[null,null,null]))},silent:function(t,e){this._skip_refresh=!0,t.call(e||this),this._skip_refresh=!1},getRange:function(t,e){if(t=t?this.getIndexById(t):this.$min||this.startOffset||0,e?e=this.getIndexById(e):(e=0===this.$max?0:Math.min(this.$max?this.$max-1:this.endOffset||1/0,this.count()-1))<0&&(e=0),t>e){var i=e;e=t,t=i}return this.getIndexRange(t,e)},getIndexRange:function(t,e){e=Math.min(0===e?0:e||1/0,this.count()-1);for(var i=O(),s=t||0;s<=e;s++)i.push(this.getItem(this.order[s]));return i},count:function(){return this.order.length},exists:function(t){return!!this.pull[t]},move:function(t,e){if(f(t>=0&&e>=0,"DataStore::move"),t!=e){var i=this.getIdByIndex(t),s=this.getItem(i);this._filter_order&&this._move_inner(this._filter_order,0,0,this.getIdByIndex(t),this.getIdByIndex(e)),this._move_inner(this.order,t,e),this.callEvent("onStoreUpdated",[i,s,"move"])}},_move_inner:function(t,e,i,s,n){if(s||n){e=i=-1;for(var a=0;a<t.length;a++)t[a]==s&&e<0&&(e=a),t[a]==n&&i<0&&(i=a)}var r=t[e];t.removeAt(e),t.insertAt(r,Math.min(t.length,i))},scheme:function(t){for(var e in this._scheme={},this._scheme_save=t.$save,this._scheme_init=t.$init||t.$change,this._scheme_update=t.$update||t.$change,this._scheme_serialize=t.$serialize,this._scheme_group=t.$group,this._scheme_sort=t.$sort,this._scheme_export=t.$export,t)"$"!=e.substr(0,1)&&(this._scheme[e]=t[e])},importData:function(t,i){var s=t?t.data||t:[];if(this._filter_order=null,"function"==typeof s.serialize){if(this.order=O([].concat(s.order)),this._make_full_copy){this._make_full_copy=!1;var n=this.pull;for(var a in this.pull={},s.pull){var r=n[a];this.pull[a]=I(s.pull[a]),r&&r.open&&(this.pull[a].open=!0)}}else for(var o in this.pull={},s.pull)this.pull[o]=s.pull[o];s.branch&&this.branch&&(this.branch=I(s.branch),this._filter_branch=null)}else{var l,h;if(this.order=O(),this.pull={},B(t))for(var c=0;c<t.length;c++)"object"==e(h=l=t[c])?h.id=h.id||T():h={id:l,value:l},this.order.push(h.id),this._scheme_init&&this._scheme_init(h),this.pull[h.id]=h;else for(var d in s)this.order.push(d),this.pull[d]={id:d,value:s[d]}}if(this._extraParser&&!s.branch){this.branch={0:[]},this._datadriver_child||this._set_child_scheme("data");for(var u=0;u<this.order.length;u++){var _=this.order[u];this._extraParser(this.pull[_],0,0,!1)}}this.callEvent("onStoreLoad",[]),i||this.callEvent("onStoreUpdated",[])},sync:function(t,i,s){this.unsync();var n=e(t);if("string"==n&&(t=ke(t)),"function"!=n&&"object"!=n&&(s=i,i=null),"DataStore"!=t.name&&"TreeStore"!=t.name){if(!t.data||"DataStore"!==t.data.name&&"TreeStore"!==t.data.name)return this._sync_source=t,U("onSyncUnknown",[this,t,i]);t=t.data}var a=A((function(e,n,a){this._skip_next_sync||(i&&this.branch&&(this._make_full_copy=!0),this.importData(t,!0),i&&this.silent(i),this._on_sync&&this._on_sync(),e&&n&&a||this.count()||(this._marks={}),"delete"==a&&this._marks[e]&&delete this._marks[e],this.callEvent("onSyncApply",[]),s?s=!1:this.refresh())}),this);this._sync_events=[t.attachEvent("onStoreUpdated",a),t.attachEvent("onIdChange",A((function(t,e){this.changeId(t,e),this.refresh(e)}),this))],this._sync_source=t,this._back_sync_handler=this.attachEvent("onStoreUpdated",(function(e,i,s){"update"!=s&&"save"!=s||(this._skip_next_sync=1,t.updateItem(e,i),this._skip_next_sync=0)})),a()},unsync:function(){if(this._sync_source){var t=this._sync_source;if("DataStore"==t.name||"TreeStore"==t.name||t.data&&"DataStore"==t.data.name&&"TreeStore"==t.data.name){for(var e=0;e<this._sync_events.length;e++)t.detachEvent(this._sync_events[e]);this.detachEvent(this._back_sync_handler)}else U("onUnSyncUnknown",[this,t]);this._sync_source=null}},destructor:function(){this.unsync(),this.pull=this.order=this._marks=null,this._evs_events=this._evs_handlers={}},add:function(t,e){if(this._scheme)for(var i in this._scheme)E(t[i])&&(t[i]=this._scheme[i]);this._scheme_init&&this._scheme_init(t);var s=this.id(t),n=arguments[2]||this.order,a=n.length;if((E(e)||e<0)&&(e=a),e>a&&(f(0,"Warning"),e=Math.min(n.length,e)),!1===this.callEvent("onBeforeAdd",[s,t,e]))return!1;if(f(!this.exists(s),"Not unique ID"),this.pull[s]=t,n.insertAt(s,e),this._filter_order){var r=this._filter_order.length;this.order.length&&(r=Math.min(e||0,r)),this._filter_order.insertAt(s,r)}return this.callEvent("onStoreUpdated",[s,t,"add"]),this.callEvent("onAfterAdd",[s,e]),t.id},remove:function(t){if(B(t))for(var e=0;e<t.length;e++)this.remove(t[e]);else{if(!1===this.callEvent("onBeforeDelete",[t]))return!1;f(this.exists(t),"Not existing ID in remove command"+t);var i=this.getItem(t);this.order.remove(t),this._filter_order&&this._filter_order.remove(t),delete this.pull[t],this._marks[t]&&delete this._marks[t],this.callEvent("onStoreUpdated",[t,i,"delete"]),this.callEvent("onAfterDelete",[t])}},clearAll:function(t){this.pull={},this._marks={},this.order=O(),this._filter_order=null,t||(this.url=null),this.callEvent("onClearAll",[t]),this.refresh()},getIdByIndex:function(t){return f(t>=0,"DataStore::getIdByIndex Incorrect index"),this.order[t]},getIndexById:function(t){return this.pull[t]?this.order.find(t):-1},getNextId:function(t,e){return this.order[this.getIndexById(t)+(e||1)]},getFirstId:function(){return this.order[0]},getLastId:function(){return this.order[this.order.length-1]},getPrevId:function(t,e){return this.order[this.getIndexById(t)-(e||1)]},sort:function(t,e,i){var s,n=this,a=t;if(s=B(a)?[a=a.map((function(t){return n._sort_init(t)}))]:[(a=this._sort_init(t,e,i)).by,a.dir,a.as,a],!this.callEvent("onBeforeSort",s))return!1;var r=this.sorting.create(a);return this.order=this._sort_core(r,this.order),this._filter_order&&(this._filter_order=this._sort_core(r,this._filter_order)),this._filter_branch&&this._sort_core(r,this.order,this._filter_branch),this.refresh(),this.callEvent("onAfterSort",s),!0},_sort_init:function(t,e,i){var s=t;return"function"==typeof t?s={as:t,dir:e}:"string"==typeof t&&(s={by:t,dir:e,as:i}),"string"==typeof s.by&&(s.by=s.by.replace(/#/g,"")),s},_sort_core:function(t,e){if(this.order.length){for(var i=e.splice(0,this.$freeze),s=O(),n=e.length-1;n>=0;n--)s[n]=this.pull[e[n]];return s.sort(t),O(i.concat(s.map((function(t){return f(t,"Client sorting can't be used with dynamic loading"),this.id(t)}),this)))}return e},_filter_reset:function(t){this._filter_order&&!t&&(this.order=this._filter_order,delete this._filter_order)},_filter_core:function(t,e,i){for(var s=O(),n=this.$freeze||0,a=0;a<this.order.length;a++){var r=this.order[a];(a<n||t(this.getItem(r),e))&&s.push(r)}i&&this._filter_order||(this._filter_order=this.order),this.order=s},find:function(t,i){var s=[];for(var n in this.pull){var a=this.pull[n],r=!0;if("object"==e(t)){for(var o in t)if(a[o]!=t[o]){r=!1;break}}else t(a)||(r=!1);if(r&&s.push(a),i&&s.length)return s[0]}return i?null:s},filter:function(t,e,i){if((t||this._filter_order||this._filter_branch)&&this.callEvent("onBeforeFilter",[t,e])&&(this._filter_reset(i),this.order.length)){if(t){var s=t;e=e||"","string"==typeof t&&(t=t.replace(/#/g,""),"function"==typeof e?s=function(i){return e(i[t])}:(e=e.toString().toLowerCase(),s=function(e,i){return f(e,"Client side filtering can't be used with dynamic loading"),-1!=(e[t]||"").toString().toLowerCase().indexOf(i)})),this._filter_core(s,e,i,this._filterMode)}this.refresh(),this.callEvent("onAfterFilter",[])}},_obj_array:function(){for(var t=[],e=this.order.length-1;e>=0;e--)t[e]=this.pull[this.order[e]];return t},each:function(t,e,i){var s=this.order;i&&(s=this._filter_order||s);for(var n=0;n<s.length;n++)s[n]&&t.call(e||this,this.getItem(s[n]),n)},_methodPush:function(t,e){return function(){return t[e].apply(t,arguments)}},provideApi:function(t,e){e&&this.mapEvent({onbeforesort:t,onaftersort:t,onbeforeadd:t,onafteradd:t,onbeforedelete:t,onafterdelete:t,ondataupdate:t});for(var i=["sort","add","remove","exists","getIdByIndex","getIndexById","getItem","updateItem","refresh","count","filter","find","getNextId","getPrevId","clearAll","getFirstId","getLastId","serialize","sync"],s=0;s<i.length;s++)t[i[s]]=this._methodPush(this,i[s])},addMark:function(t,e,i,s,n){var a=this._marks[t]||{};if(this._marks[t]=a,!a[e]){if(a[e]=s||!0,i){var r=a.$css||"";a.$css=r+" "+e}n||this.refresh(t)}return a[e]},removeMark:function(t,e,i,s){var n=this._marks[t];if(n){if(n[e]&&delete n[e],i){var a=n.$css;if(a){var r=new RegExp("(\\s|^)"+e+"(\\s|$)");n.$css=a.replace(r,(function(t,e,i){return e&&i?" ":""}))}}s||this.refresh(t)}},getMark:function(t,e){var i=this._marks[t];return!!i&&i[e]},clearMark:function(t,e,i){for(var s in this._marks){var n=this._marks[s];if(n[t]){if(delete n[t],e&&n.$css){var a=new RegExp("(\\s|^)"+t+"(\\s|$)");n.$css=n.$css.replace(a,(function(t,e,i){return e&&i?" ":""}))}i||this.refresh(s)}}},serialize:function(t){var e=this.order;t&&this._filter_order&&(e=this._filter_order);for(var i=[],s=0;s<e.length;s++){var n=this.pull[e[s]];this._scheme_serialize&&!1===(n=this._scheme_serialize(n))||i.push(n)}return i},sorting:{create:function(t){return B(t)?this._multi(t):this._dir(t.dir,this._by(t.by,t.as))},as:{server:function(){return!1},date:function(t,e){return t-=0,e-=0,isNaN(e)?1:isNaN(t)?-1:t>e?1:t<e?-1:0},int:function(t,e){return t*=1,e*=1,isNaN(e)?1:isNaN(t)?-1:t>e?1:t<e?-1:0},string_strict:function(t,e){return e||""===e?t||""===t?(t=t.toString())>(e=e.toString())?1:t<e?-1:0:-1:1},string:function(t,e){return e||""===e?t||""===t?(t=t.toString().toLowerCase())>(e=e.toString().toLowerCase())?1:t<e?-1:0:-1:1},string_locale_strict:function(t,e){return e||""===e?t||""===t?(t=t.toString(),e=e.toString(),t.localeCompare(e,R.locale)):-1:1},string_locale:function(t,e){return e||""===e?t||""===t?(t=t.toString().toLowerCase(),e=e.toString().toLowerCase(),t.localeCompare(e,R.locale)):-1:1},raw:function(t,e){return t>e?1:t<e?-1:0}},_multi:function(t){var e=this;return t=t.map((function(t){return e._dir(t.dir,e._by(t.by,t.as))})),function(e,i){var s,n=0;do{s=t[n](e,i)}while(!s&&t[++n]);return s}},_by:function(t,e){var i;return"function"!=typeof e?e=this.as[e||"string"]:i=!0,f(e,"Invalid sorting method"),function(s,n){return i||(s=s[t],n=n[t]),e(s,n,t)}},_dir:function(t,e){return"asc"!=t&&t?function(t,i){return-1*e(t,i)}:e}}};var Gi=t.proto({$init:function(t){t=t||"",this._feed_last={},this._data_generation=0,this.data=new Yi,this.data.attachEvent("onClearAll",A(this._call_onclearall,this)),this.data.attachEvent("onServerConfig",A(this._call_on_config,this)),this.attachEvent("onDestruct",this._call_onclearall),this.data.feed=this._feed,this.data.owner=t.id},_feed:function(t,e,i,s,n){return this._load_count?(s=d.defer(),this._load_count=[t,e,i,s,n],s):(this._load_count=!0,this._feed_last.from=t,this._feed_last.count=e,this._feed_common.call(this,t,e,i,s,!1,n))},_feed_common:function(t,i,s,n,a,r){var o=this,l=this.data.url;t<0&&(t=0),a||(a={start:t,count:i}),this.count()&&(a.continue="true");var h=this.getState?this.getState():null;if(l&&"string"!=typeof l)return h&&(h.sort&&(a.sort=h.sort),h.filter&&(a.filter=h.filter)),this.load(l,0,a,r).then((function(t){return o._feed_on_load(t,s,n)}),(function(){return o._feed_callback()}));l+=-1==l.indexOf("?")?"?":"&";var c=[];for(var u in a)c.push(u+"="+a[u]);if(h){if(h.sort)for(var _=B(h.sort)?h.sort:[h.sort],p=0;p<_.length;p++)c.push("sort["+_[p].id+"]="+encodeURIComponent(_[p].dir));if(h.filter)for(var f in h.filter){var g=h.filter[f];"object"==e(g)&&(g=Z().stringify(g)),c.push("filter["+f+"]="+encodeURIComponent(g))}}return l+=c.join("&"),this._feed_last.url!==l?(this._feed_last.url=l,this.load(l,0,null,r).then((function(t){return o._feed_on_load(t,s,n)}),(function(){return o._feed_callback()}))):(this._load_count=!1,d.reject())},_feed_on_load:function(t,e,i){var s=this;return j((function(){return s._feed_callback()}),"","",100),e&&Z.$callback(this,e,t),i&&i.resolve(t),t},_feed_callback:function(){var t=this._load_count;this._load_count=!1,"object"==e(t)&&this.data.feed.apply(this,t)},load:function(t){t=rt.$parse(t);var e=Zt.load.apply(this,arguments);return this.data.url||(this.data.url=t),e},loadNext:function(t,e,i,s,n,a){var r=this._settings;if(r.datathrottle&&!n){this._throttle_request&&window.clearTimeout(this._throttle_request);var o=d.defer();return this._throttle_request=j((function(){o.resolve(this.loadNext(t,e,i,s,!0,a))}),this,0,r.datathrottle),o}return e||0===e||(e=this.count()),t||(t=r.datafetch||this.count()),this.data.url=s||this.data.url,this.callEvent("onDataRequest",[e,t,i,s])&&this.data.url?this.data.feed.call(this,e,t,i,!1,a):d.reject()},_maybe_loading_already:function(t,e){var i=this._feed_last;return!!(this._load_count&&i.url&&i.from<=e&&i.count+i.from>=t+e)},removeMissed_setter:function(t){return this.data._removeMissed=t},_init_dataprocessor:function(){var e=this._settings.save;!0===e&&(e=this._settings.save=this._settings.url);var i={master:this};e&&e.url?t.extend(i,e):i.url=e,Ui(i)},save_setter:function(t){return t&&this.$ready.push(this._init_dataprocessor),t},waitSave:function(t){var e=this;return Ui(this)._promise((function(){t.call(e)})).then((function(t){return 1==t.length?t[0]:t}))},scheme_setter:function(t){this.data.scheme(t)},dataFeed_setter:function(t){return t=rt.$parse(t),this.data.attachEvent("onBeforeFilter",A((function(t,i){var s,n=this;if("function"==typeof t)return!0;if(this._settings.dataFeed&&(t||i)){t=t||"id",i&&"object"==e(i)&&(i=i.id);var a=this._settings.dataFeed;if("string"==typeof a){var r="filter["+t+"]="+encodeURIComponent(i);s=this._fetch(a+(a.indexOf("?")<0?"?":"&")+r,this._settings.datatype)}else{var o={};o[t]=i,"function"==typeof a?s=a.call(this,i,o):a.$proxy&&a.load&&(s=a.load(this,{filter:o}))}return s&&(s.then||(s=d.resolve(s)),s.then((function(t){n._onLoad(t,!0),n.data.callEvent("onAfterFilter",[])}),(function(t){return n._onLoadError(t)}))),!1}}),this)),t},_call_onready:function(){if(this._settings.ready&&!this._ready_was_used){var t=P(this._settings.ready,this.$scope);t&&j(t,this,arguments),this.callEvent&&j(this.callEvent,this,["onReady",[]]),this._ready_was_used=!0}},_call_onclearall:function(t){this._data_generation++,t||(this._load_count=!1,this._feed_last={},this.waitData=d.defer())},_call_on_config:function(t){this._parseSeetingColl(t)}},Zt),Ki={getState:function(){for(var t=this,e=this.config.columns.length,i=this.config.columns,s={ids:[],size:[],select:this.getSelectedId(!0),scroll:this.getScrollState()},n=0;n<e;n++){var a=i[n];s.ids.push(a.id),s.size.push(a.fillspace||a.adjust?-1:a.width)}if(s.order=[].concat(this._hidden_column_order.length?this._hidden_column_order:s.ids),this._last_order.length){var r=this._last_order.map((function(e){return{id:e,dir:t._last_sorted[e].dir}}));s.sort=1==r.length?r[0]:r}if(this._filter_elements&&this._dtable_fully_ready){var o={},l=0;for(var h in this._filter_elements)if(!this._hidden_column_hash[h]){var c=this._filter_elements[h];c[1].value=o[h]=c[2].getValue(c[0]),l=1}l&&(s.filter=o)}for(var d in s.hidden=[],this._hidden_column_hash)s.hidden.push(d);return s},setState:function(t){var e=this,i=this.config.columns;if(t){if(this.markSorting(),this._last_order=[],this._last_sorted={},this.blockEvent(),t.order&&t.order.length){this._hidden_column_order=O([].concat(t.order));var s=t.order.length-this._settings.rightSplit;this._hidden_split=[this._settings.leftSplit,s,this._settings.rightSplit]}if(t.hidden){for(var n={},a=0;a<t.hidden.length;a++)n[t.hidden[a]]=!0,this._hidden_column_order.length||this.hideColumn(t.hidden[a]);if(this._hidden_column_order.length)for(var r=0;r<this._hidden_column_order.length;r++){var o=this._hidden_column_order[r];!!n[o]==!this._hidden_column_hash[o]&&this.hideColumn(o,{},!1,!!n[o])}}if(t.ids){for(var l=!1,h=0;h<i.length;h++)i[h].id!=t.ids[h]&&(l=!0);if(l){for(var c=0;c<t.ids.length;c++)i[c]=this.getColumnConfig(t.ids[c])||i[c];this.refreshColumns()}}if(t.size)for(var d=Math.min(t.size.length,i.length),u=0;u<d;u++){var _=i[u];_&&t.size[u]>0&&_.width!=t.size[u]&&(delete _.fillspace,delete _.adjust,this._setColumnWidth(u,t.size[u],!0))}this.unblockEvent();var p=!(this._settings.leftSplit||this._settings.rightSplit);this._updateColsSizeSettings(p),this.callEvent("onStructureUpdate",[]);var f=this._skip_server_op={};if(t.sort){var g=t.sort,m=!0;B(g)||(g=[g],m=!1);for(var v=0;v<g.length;v++){var b=this.getColumnConfig(g[v].id);b&&(this._sort(b.id,g[v].dir,b.sort,m),"server"==b.sort&&(f.sort=!0))}}if(t.filter){var w=this.filterByAll;for(var y in this.filterByAll=function(){},t.filter){var x=t.filter[y],k=this._filter_elements[y];if(x&&k){k[2].setValue(k[0],x);var C=k[1].contentId;C&&(this._active_headers[C].value=x)}}for(var $ in this._filter_elements)if(!t.filter[$]){var S=this._filter_elements[$];S[2].setValue(S[0],"")}this.filterByAll=w,this.filterByAll()}if(delete this._skip_server_op,(f.sort||f.filter)&&this.loadNext(0,0,0,0,!0,!0).then((function(){f.sort&&e._on_after_sort(f.$params),f.filter&&e._on_after_filter()})),t.select&&this.select){var I=t.select;this.unselect();for(var A=0;A<I.length;A++)I[A].row&&!this.exists(I[A].row)||this._select(I[A],!0)}t.scroll&&this.scrollTo(t.scroll.x,t.scroll.y)}}},Xi={_initHandlers:function(t,e,i){e||Ai.addDrop(t._contentobj,t,!0),i||Ai.addDrag(t._contentobj,t),this.attachEvent("onDragOut",(function(t,e){this.$dragMark(t,e)})),this.attachEvent("onBeforeAutoScroll",(function(){var t=Ai.getContext();return!(!Ai._active||!t||t.to!==this&&!this._auto_scroll_force)}))},drag_setter:function(e){return e&&(t.extend(this,ce,!0),"order"!=e&&"move"!=e||t.extend(this,p("DragOrder"),!0),"inner"!=e&&"order"!=e||(this._inner_drag_only=!0),this._initHandlers(this,"source"==e,"target"==e),delete this.drag_setter),e},$dragIn:function(t,e,i){var s=this.locate(i)||null,n=Ai._drag_context;if((this._inner_drag_only||n.from._inner_drag_only)&&n.from!==this)return!1;var a=Ai.getMaster(e),r=this.getItemNode(s,i)||this._dataobj;if(r==Ai._landing)return r;n.target=s,n.to=a,this._auto_scroll_delay&&(this._auto_scroll_delay=window.clearTimeout(this._auto_scroll_delay));var o=this._touch_scroll&&!this._settings.prerender;return!1===this._settings.dragscroll||o||(this._auto_scroll_delay=j((function(t,e){this._drag_pause(e),this._auto_scroll(t,e)}),this,[$t(i),s],250)),this.$dropAllow(n,i)&&this.callEvent("onBeforeDragIn",[n,i])?(this.$dragMark(n,i),r):(n.to=n.target=null,this._auto_scroll_delay&&(this._auto_scroll_delay=window.clearTimeout(this._auto_scroll_delay)),null)},$dropAllow:function(){return!0},_drag_pause:function(){},_target_to_id:function(t){return t&&"object"===e(t)?t.toString():t},$dragOut:function(t,e,i,s){var n=(this._viewobj.contains(i)?this.locate(s):null)||null,a=Ai._drag_context;return(a.target||"").toString()==(n||"").toString()||(this._auto_scroll_delay&&(this._auto_scroll_delay=window.clearTimeout(this._auto_scroll_delay)),a.target=a.to=null,this.callEvent("onDragOut",[a,s])),null},$drop:function(t,e,i){var s=Ai._drag_context;s.to=this,this._define_index(t,e,s),this.$dragMark({},i),s.from&&s.from!=s.to&&s.from.callEvent&&!s.from.callEvent("onBeforeDropOut",[s,i])||this.callEvent("onBeforeDrop",[s,i])&&(this._context_to_move(s,i),this.callEvent("onAfterDrop",[s,i]))},_define_index:function(t,e,i){var s=this._target_to_id(i.target);this.getBranchIndex?s?(i.parent=this.getParentId(s),i.index=this.getBranchIndex(s)):i.index=-1:i.index=s?this.getIndexById(s):this.count()},_context_to_move:function(t){if(f(t.from,"Unsopported d-n-d combination"),t.from&&t.from.move){var e={parent:t.parent,mode:t.pos};t.from.move(t.source,t.index,t.to,e)}},$longTouchLimit:!0,_getDragItemPos:function(t,e){if(this.getItemNode){var i=this.locate(e,!0),s=i?this.getItemNode(i):null;return s?kt(s):s}},$drag:function(t,e){var i=this.locate(e,!0);if(i){var s=[i];if(this.getSelectedId){var n=this.getSelectedId(!0,!0);if(n&&n.length>1&&-1!=L.find.call(n,i)){var a={};s=[];for(var r=0;r<n.length;r++)a[n[r]]=!0;for(var o=0;o<this.data.order.length;o++){var l=this.data.order[o];a[l]&&s.push(l)}}}var h=Ai._drag_context={source:s,start:i};if(h.from=this,this.callEvent("onBeforeDrag",[h,e]))return Ii._start_context&&j((function(){Ii._start_context=null})),h.html||this.$dragHTML(this.getItem(i),e,h)}return null},$dragHTML:function(t,e,i){var s=this._toHTML(t);return B(i.source)&&i.source.length>1&&(s=this._toMultipleHTML(s,i.source.length)),s},_toMultipleHTML:function(t,e){var i="<div class='webix_drag_multiple'></div>";return e>2&&(i="<div class='webix_drag_multiple_last'></div>"+i),i+(t="<div class='webix_drag_main'>"+t+"</div>")+"<span class='webix_badge'>"+e+"</span>"},$dragMark:function(t){var e=null;return t.target&&(e=this._target_to_id(t.target)),this._marked&&this._marked!=e&&(this._remove_css([this._marked],"webix_drag_over",!0),this._marked=null),!this._marked&&e?(this._marked=e,this._add_css([e],"webix_drag_over",!0),e):!!t.to},_add_css:function(t,e){for(var i=0;i<t.length;i++)this.addCss(t[i],e)},_remove_css:function(t,e){for(var i=0;i<t.length;i++)this.removeCss(t[i],e)},$dropHTML:function(){return""},_set_drop_area:function(t,e){var i=this.getItemNode(t);i?i.parentNode.insertBefore(Ai._dropHTML[0],i):e.children[0].appendChild(Ai._dropHTML[0])}},Ji={$drag:function(t,e){var i=Xi.$drag.apply(this,arguments);if(!i)return i;var s=Ai._drag_context;return this._close_branches&&this._close_branches(s),this._inner_drag_only&&this.getBranchIndex&&(this._drag_order_stored_left=this._drag_order_complex?20*(this.getItem(s.start).$level+1)+8:0),B(s.source)&&(Ai._setDragOffset(e),this._add_css(s.source,"webix_invisible")),i},$dragIn:function(t,e,i){var s=Xi.$dragIn.apply(this,arguments);if(!s)return s;Ai._dropHTML||(Ai._dropHTML=this._init_drop_area());var n=Ai._drag_context,a="$webix-last";if(n.target&&(a=this._target_to_id(n.target)),"$webix-last"!=a&&"$webix-drop"!=a){var r={direction:this._settings.layout||this._drag_direction||"y",x:"width",y:"height"},o=kt(s);2*($t(i)[r.direction]-o[r.direction])>o[r[r.direction]]&&(a=this.getNextId(a)||"$webix-last")}return a==this._marked_item_id||"$webix-drop"==a||(this._marked_item_id=a,this._set_drop_area(a,e)),s},$dragPos:function(t){if(!this._inner_drag_only){var e=Ai._drag_context;return t.y+=e.y_offset,void(t.x+=e.x_offset)}var i=kt(this.$view);if("x"==this._settings.layout)if(i.x-=12,t.y=i.y-8,t.x=t.x-18,t.x<i.x)t.x=i.x;else{var s=i.x+i.width;t.x>s&&(t.x=s)}else if(i.y+=(this._header_height||0)-12,t.x=i.x+8+(this._drag_order_stored_left||0),t.y=t.y-18,t.y<i.y)t.y=i.y;else{var n=i.y+i.height-(this._header_height||0);t.y>n&&(t.y=n)}},$dragOut:function(t,e,i){return e!=i&&(this._remove_drop_area?this._remove_drop_area():wt(Ai._dropHTML),this._marked_item_id=Ai._dropHTML=null),Xi.$dragOut.apply(this,arguments)},_define_index:function(t,e,i){var s="$webix-last"==this._marked_item_id?null:this._marked_item_id;this.getBranchIndex?s?(i.parent=this.getParentId(s),i.index=this.getBranchIndex(s),t==e&&this.getParentId(i.start)==i.parent&&this.getBranchIndex(i.start)<i.index&&(i.index-=1)):i.index=-1:(i.index=s?this.getIndexById(s):this.count(),i.index-=t==e&&this.getIndexById(i.start)<i.index?1:0)},$dragDestroy:function(){var t=Ai._drag_context;B(t.source)&&this._remove_css(t.source,"webix_invisible"),this._settings.dynamic&&this.render(null,null,"drag-end"),wt(Ai._html)},_init_drop_area:function(){var t=document.createElement("div");return t.className="webix_drop_area",t.style.width=this.type.width+"px",t.style.height=this.type.height+"px",t.innerHTML=this.$dropHTML(),t.setAttribute(this._id,"$webix-drop"),[t]},$dragMark:function(){return!1}};_("DragOrder",Ji);var Zi={$init:function(){this._undoHistory=t.extend([],L,!0),this._undoCursor=-1},undo_setter:function(t){return t&&(this._init_undo(),this._init_undo=function(){}),t},_init_undo:function(){var t=this;this.attachEvent("onBeforeDrop",(function(e){if(e.from==e.to){var i=t._draggedItem=I(this.getItem(e.start));this.data.branch?i.$index=this.getBranchIndex(i.id):i.$index=this.getIndexById(i.id)}})),this.data.attachEvent("onDataMove",(function(e){if(t._draggedItem&&t._draggedItem.id==e){var i=t._draggedItem;t._draggedItem=null,t._addToHistory(e,i,"move")}})),this.data.attachEvent("onBeforeDelete",(function(e){if(this.getItem(e)){var i=t._deletedItem=I(this.getItem(e));this.branch?(i.$index=this.getBranchIndex(e),this.branch[e]&&(i.$branch=I(this.serialize(e)))):i.$index=this.getIndexById(e)}})),this.data.attachEvent("onDataUpdate",(function(e,i,s){t._addToHistory(e+"",s,"update")})),this.data.attachEvent("onStoreUpdated",(function(e,i,s){var n=null;e&&("add"==s?n=I(i):"delete"==s&&(n=t._deletedItem),n&&t._addToHistory(e,n,s))})),this.data.attachEvent("onIdChange",(function(i,s){"object"==e(i)&&(i=i.row);for(var n=0;n<t._undoHistory.length;n++)t._undoHistory[n].id==i&&(t._undoHistory[n].id=s)}))},_addToHistory:function(t,e,i){if(!this._skipHistory&&this._settings.undo){this._undoHistory.push({id:t,action:i,data:e});var s=this._settings.undoLimit||20;this._undoHistory.length>s&&this._undoHistory.splice(0,1),this._skipCursorInc||(this._undoCursor=this._undoHistory.length-1)}},ignoreUndo:function(t,e){this._skipHistory=!0,t.call(e||this),this._skipHistory=!1},removeUndo:function(t){for(var e=this._undoHistory.length-1;e>=0;e--)this._undoHistory[e].id==t&&("id"==this._undoHistory[e].action&&(t=this._undoHistory[e].data),this._undoHistory.removeAt(e));this._undoCursor=this._undoHistory.length-1},undo:function(t){if(t)this.ignoreUndo((function(){var e,i;for(i=this._undoHistory.length-1;!e&&i>=0;i--)this._undoHistory[i].id==t&&(e=this._undoHistory[i]);e&&(this._undoAction(e),this._undoHistory.removeAt(i+1),this._undoCursor=this._undoHistory.length-1)}));else{var e=this._undoHistory[this._undoCursor];e&&(this.ignoreUndo((function(){this._undoAction(e),this._undoHistory.removeAt(this._undoCursor)})),this._undoCursor--)}},_undoAction:function(t){if("delete"==t.action){var e=null,i=t.data.$parent;t.data.$branch&&(e={parent:t.id,data:I(t.data.$branch)},delete t.data.$branch,i&&!this.data.pull[i]&&(i=0)),this.add(t.data,t.data.$index,i),e&&this.parse(e)}else"add"==t.action?this.remove(t.id):"update"==t.action?this.updateItem(t.id,t.data):"move"==t.action&&(t.data.$parent?this.getItem(t.data.$parent)&&this.move(t.id,t.data.$index,null,{parent:t.data.$parent}):this.move(t.id,t.data.$index))}};function Qi(t){t&&t.setMasterValue&&!t._editor_initialized&&(t._editor_initialized=!0,t.attachEvent("onValueSuggest",(function(){j((function(){return U("onEditEnd",[])}))})))}function ts(t){return"string"==typeof t?t:t.linkInput?t._settings.id:("object"==e(t)?(B(t)&&(t={data:t}),t.view=t.view||"suggest"):!0===t&&(t={view:"suggest"}),be(t).config.id)}function es(t){return((t.header&&t.header[0]?t.header[0].text:t.editValue||t.label)||"").toString().replace(/<[^>]*>/g,"")}var is={text:{focus:function(){this.getInputNode(this.node).focus(),this.getInputNode(this.node).select()},getValue:function(){return this.getInputNode(this.node).value},setValue:function(t){var e=this.getInputNode(this.node);e.value=t,Qi(function(t,e){var i=t.config.suggest;if(i){var s=ke(t.config.suggest=ts(i));return s&&e&&s.linkInput(e),s}}(this,e))},getInputNode:function(){return this.node.firstChild},render:function(){return vt("div",{class:"webix_dt_editor"},"<input type='text' aria-label='"+es(this.config)+"'>")}},"inline-checkbox":{render:function(){return{}},getValue:function(){return this.node.checked},setValue:function(){},focus:function(){this.node.focus()},getInputNode:function(){},$inline:!0},"inline-text":{render:function(){return{}},getValue:function(){return this.node.value},setValue:function(){},focus:function(){this.node.focus(),this.node.select()},getInputNode:function(){},$inline:!0},checkbox:{focus:function(){this.getInputNode().focus()},getValue:function(){return this.getInputNode().checked},setValue:function(t){this.getInputNode().checked=!!t},getInputNode:function(){return this.node.firstChild.firstChild},render:function(){return vt("div",{class:"webix_dt_editor"},"<div><input type='checkbox' aria-label='"+es(this.config)+"'></div>")}},select:{focus:function(){this.getInputNode().focus()},getValue:function(){return this.getInputNode().value},setValue:function(t){this.getInputNode().value=t},getInputNode:function(){return this.node.firstChild},render:function(){var t="",e=this.config.options||this.config.collection;if(f(e,"options not defined for select editor"),e.data&&e.data.each)e.data.each((function(e){t+="<option value='"+e.id+"'>"+e.value+"</option>"}));else if(B(e))for(var i=0;i<e.length;i++){var s=e[i],n=E(s.id),a=n?s:s.id,r=n?s:s.value;t+="<option value='"+a+"'>"+r+"</option>"}else for(var o in e)t+="<option value='"+o+"'>"+e[o]+"</option>";return vt("div",{class:"webix_dt_editor"},"<select aria-label='"+es(this.config)+"'>"+t+"</select>")}},popup:{focus:function(){this.getInputNode().focus()},destroy:function(){this.getPopup().hide()},getValue:function(){return this.getInputNode().getValue()||""},setValue:function(t){this.getPopup().show(this.node),this.getInputNode().setValue(t)},getInputNode:function(){return this.getPopup().getChildViews()[0]},getPopup:function(){var t=this.config.$popup;return t&&ke(t)||(t=this.config.$popup=this.createPopup()),ke(t)},createPopup:function(){var t,i=this.config.popup||this.config.suggest;if(i)return"object"!=e(i)||i.name?t=ke(i):(i.view=i.view||"suggest",t=be(I(i))),t._linked||(t.linkInput?t.linkInput(document.body):this.linkInput&&this.linkInput(document.body),t._linked=!0),Qi(t),t;var s=is.$popup[this.popupType],n=s.$popup;if(!n||!ke(n)){var a=be(I(s));a.linkInput||n||this.linkInput(document.body),s.$popup=n=a._settings.id,this.popupInit(a)}return n},linkInput:function(t){var e=this;_e(F(t),"keydown",(function(t){if(e.config.$popup){var i,s=t.which||t.keyCode,n=e.getInputNode();n.isVisible()&&(n.moveSelection&&s<41&&s>32?(33==s?i="pgup":34==s?i="pgdown":35==s?i="bottom":36==s?i="top":37==s?i="left":38==s?i="up":39==s?i="right":40==s&&(i="down"),n.moveSelection(i)):13!==s||"TEXTAREA"===t.target.nodeName&&t.shiftKey||U("onEditEnd",[]))}}))},popupInit:function(){},popupType:"text",render:function(){return{}},$inline:!0}};is.color=t.extend({focus:function(){},popupType:"color",popupInit:function(t){t.getChildViews()[0].attachEvent("onItemClick",(function(t){U("onEditEnd",[t])}))}},is.popup),is.date=t.extend({focus:function(){},popupType:"date",setValue:function(t){this._is_string=this.config.stringResult||t&&"string"==typeof t,is.popup.setValue.call(this,t)},getValue:function(){return this.getInputNode().getValue(this._is_string?R.parseFormatStr:"")||""},popupInit:function(t){t.getChildViews()[0].attachEvent("onAfterDateSelect",(function(t){U("onEditEnd",[t])}))}},is.popup),is.combo=t.extend({_create_suggest:function(t){var e,i;return this.config.popup?i=(e=this.config.popup).config.id:t?e=ke(i=ts(t)):i=this._shared_suggest(t),Qi(e),i},_shared_suggest:function(){var t=is.combo;return t._suggest&&ke(t._suggest)?t._suggest:t._suggest=this._create_suggest(!0)},render:function(){var t=this,e=vt("div",{class:"webix_dt_editor"},"<input type='text' role='combobox' aria-label='"+es(this.config)+"'>"),i=this.config.suggest=this._create_suggest(this.config.suggest);return i&&(ke(i).linkInput(e.firstChild,!0),_e(e.firstChild,"click",(function(){return t.showPopup()}))),e},getPopup:function(){return ke(this.config.suggest)},showPopup:function(){var t=this.getPopup(),e=t.getList(),i=this.getInputNode(),s=this._initial_value;t.show(i),i.setAttribute("aria-expanded","true"),s?(f(e.exists(s),"Option with ID "+s+" doesn't exist"),e.exists(s)&&(e.select(s),e.showItem(s))):(e.unselect(),e.showItem(e.getFirstId())),t._last_input_target=i},afterRender:function(){this.showPopup()},setValue:function(t){if(this._initial_value=t,this.config.suggest){var e=ke(this.config.suggest),i=this.config.collection||this.config.options;i&&e.getList().data.importData(i),this.getInputNode(this.node).value=e.getItemText(t)}},getValue:function(){var t=this.getInputNode().value;if(this.config.suggest){var e=ke(this.config.suggest),i=e.getList();(t||i.getSelectedId&&i.getSelectedId())&&(t=e.getSuggestion(t))}return t}},is.text),is.richselect=t.extend({focus:function(){},getValue:function(){return this.getPopup().getValue()},setValue:function(t){var e=this.config.collection||this.config.options;this.getInputNode(),e&&this.getPopup().getList().data.importData(e),this.getPopup().show(this.node),this.getPopup().setValue(t)},getInputNode:function(){return this.getPopup().getList()},popupInit:function(t){t.linkInput(document.body),Qi(t)},popupType:"richselect"},is.popup),is.password=t.extend({render:function(){var t=this,e=vt("div",{class:"webix_dt_editor webix_password_editor"},"<input type='password' aria-label='"+es(this.config)+"'><span class='webix_icon wxi-eye'></span>");return _e(e.querySelector(".webix_icon"),"click",(function(){t.toggleInput(),t.getInputNode(t.node).focus()})),e},toggleInput:function(){var t=this.getInputNode(this.node),e="password"===t.getAttribute("type");t.setAttribute("type",e?"text":"password"),t.nextSibling.className="webix_icon wxi-eye".concat(e?"-slash":"")},masterFormat:function(t){return t||0===t?"&bull;".repeat(t.toString().length):""}},is.text),is.$popup={text:{view:"popup",width:250,height:150,body:{view:"textarea"}},color:{view:"popup",body:{view:"colorboard"}},date:{view:"popup",width:250,height:250,padding:0,body:{view:"calendar",icons:!0,borderless:!0}},richselect:{view:"suggest",body:{view:"list",select:!0}},multiselect:{view:"multisuggest",suggest:{button:!0}}};var ss={defaults:{editaction:"click"},$init:function(e){this._editors={},this._in_edit_mode=0,this._edit_open_time=0,this._contentobj.style.position="relative",e&&(e.onDblClick=e.onDblClick||{}),this.attachEvent("onAfterRender",this._refocus_inline_editor),this._settings.editable&&this._init_edit_events_once(),t.extend(this,Zi)},_try_reselecting_text:function(t,e){try{"number"==typeof t.selectionStart&&(t.selectionStart=e>=0?e:t.value.length,t.selectionEnd=t.value.length)}catch(t){}},_refocus_inline_editor:function(){var t=this.getEditor();if(t&&t.$inline&&!t.getPopup){var e=this._locateInput(t);if(e&&e!=t.node){t.node=e,e.focus();var i=new Date-this._edit_open_time>200;this._try_reselecting_text(e,i?-1:0)}}},editable_setter:function(t){return t&&this._init_edit_events_once(),t},_init_edit_events_once:function(){var t=W("onEditEnd",A((function(){this._in_edit_mode&&this.editStop()}),this)),e=W("onClick",A((function(t){this._in_edit_mode&&new Date-this._edit_open_time>200&&(this._last_editor&&!this._last_editor.popupType&&t&&this._last_editor.node&&this._last_editor.node.contains(t.target)||this.editStop())}),this));this.attachEvent("onDestruct",(function(){Y(t),Y(e)})),this.data.attachEvent&&this.data.attachEvent("onIdChange",A((function(t,e){this._changeEditorId(t,e)}),this)),this.attachEvent("onItemClick",(function(t){this._settings.editable&&"click"==this._settings.editaction&&this.edit(t)})),this.attachEvent("onItemDblClick",(function(t){this._settings.editable&&"dblclick"==this._settings.editaction&&this.edit(t)})),this._reset_active_editor=A((function(){this._edit_open_time=new Date}),this),this._init_edit_events_once=function(){},this._component_specific_edit_init&&this._component_specific_edit_init()},_handle_live_edits:function(){j((function(){var t=this.getEditor();if(t&&t.config.liveEdit){var e={value:t.getValue(),old:t.value};if(e.value==e.old)return;t.value=e.value,this._set_new_value(t,e.value,!1),this.callEvent("onLiveEdit",[e,t])}}),this)},_show_editor_form:function(t){var e=this._settings.form;"string"!=typeof e&&(this._settings.form=e=be(e).config.id);var i=(e=ke(e)).setValues?e:e.getChildViews()[0];i.setValues(this.getItem(t.row||t),!1,"auto"),e.config.master=this.config.id,e.show(this.getItemNode(t));var s=i.getChildViews()[0];s.focus&&s.focus()},edit:function(e,i,s){if(this._settings.editable&&this.callEvent("onBeforeEditStart",[e])){if(this._settings.form)return this._show_editor_form(e);var n=this._get_editor_type(e);if(n){if(this.getEditor(e))return;i||this.editStop(),f(is[n],"Invalid editor type: "+n);var a=t.extend({},is[n]),r=this._init_editor(e,a,s);a.config.liveEdit&&(this._live_edits_handler=this.attachEvent("onKeyPress",this._handle_live_edits));var o=a.getPopup?a.getPopup(r)._viewobj:r;return o&&_e(o,"click",this._reset_active_editor),r&&_e(r,"input",this._on_editor_change,{bind:{view:this,id:e}}),!1!==s&&a.focus(),this.$fixEditor&&this.$fixEditor(a),this._edit_open_time=me.edit_open_time=new Date,ni.setFocus(this,!0),this.callEvent("onAfterEditStart",[e]),a}return null}},getEditor:function(t){return t?this._editors[t]:this._last_editor},_changeEditorId:function(t,e){var i=this._editors[t];i&&(this._editors[e]=i,i.id=e,delete this._editors[t])},_on_editor_change:function(){this.view.hasEvent("onEditorChange")&&this.view.callEvent("onEditorChange",[this.id,this.view.getEditorValue(this.id)])},_get_edit_config:function(){return this._settings},_init_editor:function(t,e,i){e.config=this._get_edit_config(t);var s=e.render();e.$inline&&(s=this._locateInput(t)),e.node=s;var n=this.getItem(t),a=n[this._settings.editValue||"value"];return E(a)&&(a=""),e.setValue(a,n),e.value=a,this._addEditor(t,e),e.getPopup&&(e.getPopup()._editorMaster=this._settings.id),!1!==i&&this.showItem(t),e.$inline||this._sizeToCell(t,s,!0),e.afterRender&&e.afterRender(),s},_locate_cell:function(t){return this.getItemNode(t)},_locateInput:function(t){var e=this._locate_cell(t);return e&&(e=e.getElementsByTagName("input")[0]||e),e},_get_editor_type:function(){return this._settings.editor},_addEditor:function(t,e){e.id=t,this._editors[t]=this._last_editor=e,this._in_edit_mode++},_removeEditor:function(t){this._last_editor==t&&(this._last_editor=0),t.destroy&&t.destroy(),delete t.popup,delete t.node,delete this._editors[t.id],this._in_edit_mode--},focusEditor:function(){var t=this.getEditor.apply(this,arguments);t&&t.focus&&t.focus()},editCancel:function(){this.editStop(null,null,!0)},_applyChanges:function(t){if(t){var e=this.getEditor();if(e&&e.getPopup&&e.getPopup()==t.getTopParentView())return}this.editStop()},editStop:function(t){if(!this._edit_stop){this._edit_stop=1;var e=arguments[2],i=1;return t?i=this._editStop(this._editors[t],e):this._for_each_editor((function(t){i*=this._editStop(t,e)})),this._edit_stop=0,i}},_cellPosition:function(t){var e=this.getItemNode(t);return{left:e.offsetLeft,top:e.offsetTop,height:e.offsetHeight,width:e.offsetWidth,parent:this._contentobj}},_sizeToCell:function(t,e,i){if(e.style){var s=this._cellPosition(t,null,!0);return e.style.top=s.top+"px",e.style.left=s.left+"px",e.style.width=s.width-1+"px",e.style.height=s.height-1+"px",e.top=s.top,i&&s.parent.appendChild(e),s}},_for_each_editor:function(t){for(var e in this._editors)t.call(this,this._editors[e])},_editStop:function(t,e){if(t&&!me._final_destruction){var i={value:this._get_new_value(t),old:t.value};if(this.callEvent("onBeforeEditStop",[i,t,e])){if(!e){var s=i.old;if("string"==typeof i.value&&(s+=""),s!=i.value||t.config.liveEdit){var n=this._set_new_value(t,i.value,!0);this.updateItem(t.row||t.id,n)}}t.$inline?t.node=null:wt(t.node);var a=t.config.suggest;return a&&"string"==typeof a&&ke(a).hide(),this._removeEditor(t),this._live_edits_handler&&this.detachEvent(this._live_edits_handler),this.callEvent("onAfterEditStop",[i,t,e]),1}return 0}},validateEditor:function(t){var e=!0;if(this._settings.rules){var i=this.getEditor(t),s=i.column||this._settings.editValue||"value",n=this._settings.rules[s],a=this._settings.rules.$all,r=i.getInputNode();if((n||a)&&!r._viewobj){var o=this.data.getItem(i.row||i.id),l=i.getValue();n&&(e=n.call(this,l,o,s)),a&&(e=a.call(this,l,o,s)&&e),e?Et(r,"webix_invalid"):Dt(r,"webix_invalid"),U("onLiveValidation",[i,e,o,l])}}return e},getEditorValue:function(t){var e;if(e=0===arguments.length?this._last_editor:this.getEditor(t))return e.getValue()},getEditState:function(){return this._last_editor||!1},editNext:function(t,e){if(t=!1!==t,1==this._in_edit_mode||e){var i=this._find_cell_next(this._last_editor||e,(function(t){return!!this._get_editor_type(t)}),t);if(this.editStop())return i&&(this.edit(i),this._after_edit_next(i)),!1}},_after_edit_next:function(){},_find_cell_next:function(t,e,i){var s=this.getIndexById(t.id),n=this.data.order;if(i){for(var a=s+1;a<n.length;a++)if(e.call(this,n[a]))return n[a]}else for(var r=s-1;r>=0;r--)if(e.call(this,n[r]))return n[r];return null},_get_new_value:function(t){return t.getValue()},_set_new_value:function(t,e,i){var s=i?{}:this.getItem(t.id);return s[this._settings.editValue||"value"]=e,s}},ns={$init:function(){this.$view.className+=" webix_flexlayout"},_fix_vertical_layout:function(){},_beforeResetBorders:function(){},_afterResetBorders:function(){},$getSize:function(){w(this,!0);var t=0,e=0,i=this._settings.gravity;this._sizes=[];for(var s=0;s<this._cells.length;s++){var n=this._cells[s].$getSize(0,0);this._sizes.push(n),t=Math.max(t,n[0]),e=Math.max(e,n[2])}t+=this._padding.left+this._padding.right,e+=this._padding.top+this._padding.bottom,this._settings.width&&(t=Math.max(t,this._settings.width)),this._settings.height&&(e=Math.max(e,this._settings.height));var a=[t,1e5,e,1e5,i];return y(0,a),a},render:function(){this.resize()},_set_child_size:function(){if(this.isVisible(this._settings.id)){var t=this.$view.style,e=Math.round(this._margin/2);t.paddingTop=this._padding.top-e+"px",t.paddingBottom=this._padding.bottom-e+"px",t.paddingLeft=this._padding.left-e+"px",t.paddingRight=this._padding.right-e+"px";for(var i=0;i<this._cells.length;i++)if(!this._cells[i]._settings.hidden){var s=this._cells[i].$view,n=this._sizes[i],a=this._cells[i]._settings;s&&(s.style.minWidth=n[0]+"px",n[1]<1e5&&n[1]!=n[0]&&(s.style.maxWidth=n[1]+"px"),s.style.flexBasis=a.flexBasis||n[0]+"px",s.style.flexGrow=a.flexGrow||(n[1]!=n[0]?n[4]:0),s.style.height=n[3]!=n[2]?"auto":n[2]+"px",s.style.minHeight=n[2]+"px",n[3]<1e5&&n[3]!=n[2]&&(s.style.maxHeight=n[3]+"px"),s.style.margin=e+"px")}for(var r=[],o=0;o<this._cells.length;o++)if(!this._cells[o]._settings.hidden){var l=this._cells[o].$view;r[o]=[l.offsetWidth,l.offsetHeight]}for(var h=0;h<this._cells.length;h++)if(!this._cells[h]._settings.hidden){var c=this._cells[h];if(c.$view){c._settings.flex=!0;var d=this._sizes[h],u=d[2]==d[3]?d[2]:r[h][1];c.$setSize(r[h][0],u),c._settings.flex=!1}}this.$view.style.height="",this.$height=this._content_height=this.$view.scrollHeight,this.$view.style.height=this._content_height+"px"}}},as={sum:function(t,e){e=e||this;for(var i=0,s=0;s<e.length;s++){var n=parseFloat(t(e[s]),10);isNaN(n)||(i+=n)}return i},min:function(t,e){e=e||this;for(var i=1/0,s=0;s<e.length;s++){var n=parseFloat(t(e[s]),10);isNaN(n)||n<i&&(i=n)}return i===1/0?0:1*i},max:function(t,e){e=e||this;for(var i=-1/0,s=0;s<e.length;s++){var n=parseFloat(t(e[s]),10);isNaN(n)||n>i&&(i=n)}return i===-1/0?0:1*i},count:function(t,e){for(var i=0,s=0;s<e.length;s++){null!=t(e[s])&&i++}return i},any:function(t,e){return t(e[0])},string:function(t){return t.$name}},rs={$init:function(){var t=this;this.attachEvent("onClearAll",(function(){return t._not_grouped_order=null})),this.attachEvent("onSyncApply",(function(){return t._not_grouped_order=null}))},ungroup:function(t){if(this._filter_reset&&this._filter_reset(!1),this.getBranchIndex){if(!this._ungroupLevel(t))return}else{if(!this._not_grouped_order)return;this.order=this._not_grouped_order,this.pull=this._not_grouped_pull,this._not_grouped_order=this._not_grouped_pull=null}this.callEvent("onStoreUpdated",[])},_ungroupLevel:function(t){for(var e=this,i=t||0,s="0"==i?1:this.getItem(i).$level+1,n=!1,a=this.branch[i],r=[],o=0;o<a.length;o++){var l=a[o];if(this.pull[l].$group){n=!0;var h=this.branch[l];h&&(this.branch[l]=h.filter((function(t){if(!e.pull[t].$footer)return t;e._unregisterItem(t)}))),r=r.concat(this.branch[l]||[]),this._unregisterItem(l)}else r.push(l)}return!!n&&(this.branch[i]=r,this._fix_group_levels(this.branch[i],i,s),void 0===t&&this._ungroupLevel(),!0)},_unregisterItem:function(t){delete this.pull[t],delete this.branch[t]},_group_processing:function(t){this.blockEvent(),this.group(t),this.unblockEvent()},_group_prop_accessor:function(t){if("function"==typeof t)return t;var e=function(e){return e[t]};return e.$name=t,e},group:function(t,e){var i;if(f(t,"Empty config"),"string"==typeof t?(i=t,t={by:this._group_prop_accessor(t),map:{}}):"function"==typeof t?t={by:t,map:{}}:"string"==typeof t.by&&(i=t.by,t.by=this._group_prop_accessor(t.by)),t.map=t.map||{},i&&!t.map[i]&&(t.map[i]=[i]),t.missing=void 0===t.missing||t.missing,this._filter_reset&&this._filter_reset(!1),this.getBranchIndex)return this._group_tree(t,e);this._not_grouped_order||(this._not_grouped_order=this.order,this._not_grouped_pull=this.pull);var s={},n=[],a=[],r=t.missing;this.each((function(e){var i=t.by(e);if(!i&&0!==i){if(!1===r)return;if(!0===r)return void a.push(e);i=r}s[i]||(n.push({id:i,value:i,$group:!0,$row:t.row}),s[i]=O()),s[i].push(e)}));for(var o=0;o<n.length;o++){var l=n[o];this._map_group(t.map,l,s[n[o].id]),this.hasEvent("onGroupCreated")&&this.callEvent("onGroupCreated",[l.id,l.value,s[n[o].id]])}this.order=O(),this.pull={},this._fill_pull(n),this._fill_pull(a),this.callEvent("onStoreUpdated",[])},_fill_pull:function(t){for(var e=0;e<t.length;e++){var i=this.id(t[e]);this.pull[i]&&(i=t[e].id=T()),this.pull[i]=t[e],this.order.push(i),this._scheme_init&&this._scheme_init(t[e])}},_map_group:function(t,e,i){for(var s in t){var n=t[s][1]||"any",a=this._group_prop_accessor(t[s][0]);"function"!=typeof n&&(f(as[n],"Unknown grouping rule: "+n),n=as[n]),e[s]=n.call(this,a,i)}},_group_tree:function(t,e){var i=0;e?i=this.getItem(e).$level:e=0;for(var s=[],n=[],a=[],r=this.branch[e],o={},l=0;l<r.length;l++){var h=this.getItem(r[l]),c=t.by(h);if(!c&&0!==c){if(!1===t.missing)continue;if(!0===t.missing){a.push(h.id);continue}c=t.missing}var d=o[c];if(!d){var u=T(),_=this.pull[u]={id:u,value:c,$group:!0,$row:t.row};this._scheme_init&&this._scheme_init(_),n.push(_),(d=o[c]=this.branch[u]=[])._formath=[],s.push(u)}d.push(h.id),d._formath.push(h)}this.branch[e]=s.concat(a);for(var p=0;p<n.length;p++){var f=n[p];if(this._map_group(t.map,f,this.branch[n[p].id]._formath),this.hasEvent("onGroupCreated")&&this.callEvent("onGroupCreated",[f.id,f.value,this.branch[f.id]._formath]),t.footer){var g="footer$"+f.id,m=this.pull[g]={id:g,$footer:!0,value:f.value,$level:i,$count:0,$parent:f.id,$row:t.footer.row};this._map_group(t.footer,m,this.branch[n[p].id]._formath),this.branch[f.id].push(m.id),this.callEvent("onGroupFooter",[m.id,m.value,this.branch[f.id]._formath])}delete this.branch[f.id]._formath}this._fix_group_levels(this.branch[e],e,i+1),this.callEvent("onStoreUpdated",[])},_fix_group_levels:function(t,e,i){e&&(this.getItem(e).$count=t.length);for(var s=0;s<t.length;s++){var n=this.pull[t[s]];n.$level=i,n.$parent=e;var a=this.branch[n.id];a&&this._fix_group_levels(a,n.id,i+1)}}},os={$init:function(){t.extend(this.data,rs)},group:function(t,e){e||0===e||(this.$blockRender=!0,this.data.ungroup(),this.$blockRender=!1),this.data.group(t,e)},ungroup:function(t){this.data.ungroup(t)}},ls={$init:function(){var t=this;this.$ready.push((function(){t.customRadio_setter&&!t.config.customRadio||_e(t.$view,"keydown",t._moveSelection,{bind:t})}))},_focus:function(){if(!ni.canFocus(this))return!1;var t=this._getInputNode();if(t)for(var e=0;e<t.length;e++)if("0"==t[e].getAttribute("tabindex"))return t[e].focus()},_blur:function(){var t=this._getInputNode();if(t)for(var e=0;e<t.length;e++)if("0"==t[e].getAttribute("tabindex"))return t[e].blur()},_moveSelection:function(t){var e=t.which||t.keyCode;if(e>34&&e<41){var i=this._getInputNode(),s=!1;if(!i.length)return;St(t);var n=37===e||38===e||35===e?-1:1;if(35===e)s=i.length-1;else if(36===e)s=0;else for(var a=0;a<i.length;a++)if("0"==i[a].getAttribute("tabindex")){s=a+n;break}if(!1!==s){var r=s;do{if(r>=i.length&&(r=0),r<0&&(r=i.length-1),i[r].getAttribute("webix_disabled"))r+=n;else{var o=i[r].getAttribute("button_id");this.setValue(o,"user"),i[r].focus(),r="success"}}while("success"!==r&&r!==s)}}},_get_tooltip_data:function(t,e){for(var i,s=e.target;s&&!s.webix_tooltip;){if(i=s.getAttribute("webix_t_id"))return this.getOption(i);s=s.parentNode}return null},optionIndex:function(t){for(var e=this._settings.options,i=0;i<e.length;i++)if(e[i].id==t)return i;return-1},getOption:function(t){var e=this.optionIndex(t);return-1!==e?this._settings.options[e]:null},addOption:function(t,i,s,n){var a=t;"object"!=e(t)?a={id:t,value:i=i||t}:(t=a.id,n=s,s=i),-1===this.optionIndex(t)&&(L.insertAt.call(this._settings.options,a,n),this.refresh(),this.callEvent("onOptionAdd",[t,a])),s&&(1===this._settings.options.length&&(this._settings.value=""),this.setValue(t,"auto"))},removeOption:function(t){var e=this.optionIndex(t);if(-1!==e){var i=this._settings.options;L.removeAt.call(i,e),this._settings.value==t&&this._setNextVisible(i,e),this.refresh(),this.callEvent("onOptionRemove",[t,this._settings.value])}},_setNextVisible:function(t,e){var i=t.length;if(i&&!this.customRadio_setter){for(var s=e=Math.min(e,i-1);s<i;s++)if(!t[s].hidden)return this.setValue(t[s].id,"auto");for(var n=e;n>=0;n--)if(!t[n].hidden)return this.setValue(t[n].id,"auto")}this.setValue("","auto")},_getFirstActive:function(t){var e=this._settings.options;if(e.length){for(var i=0;i<e.length;i++)if(!e[i].hidden&&!e[i].disabled)return e[i].id;if(t)return e[0].id}return""},_filterOptions:function(t){for(var e=[],i=0;i<t.length;i++)t[i].hidden||e.push(t[i]);return e},_setOptionState:function(t,e,i){var s=this._settings.options,n=this.optionIndex(t);s[n]&&i!=!!s[n][e]&&(s[n][e]=i,i&&"hidden"===e&&this._settings.value==t&&this._setNextVisible(s,n),this.refresh())},hideOption:function(t){this._setOptionState(t,"hidden",!0)},showOption:function(t){this._setOptionState(t,"hidden",!1)},disableOption:function(t){this._setOptionState(t,"disabled",!0)},enableOption:function(t){this._setOptionState(t,"disabled",!1)}},hs=t.proto({$init:function(t){this._id="map_"+T(),this._key=t,this._map=[],this._areas=[]},addRect:function(t,e,i){this._createMapArea(t,"RECT",e,i)},addPoly:function(t,e,i){this._createMapArea(t,"POLY",e,i)},_createMapArea:function(t,e,i,s){var n="";4==arguments.length&&(n="userdata='"+s+"'"),this._map.push("<area "+this._key+"='"+t+"' shape='"+e+"' coords='"+i.join()+"' "+n+"></area>"),this._areas.push({index:s,points:i})},addSector:function(t,e,i,s,n,a,r,o,l,h){var c=[];return l?c=c.concat(this._getArcPoints(s,n,l,i,e,r,-1)):(c.push(s),c.push(Math.floor(n))),(c=h?e<0&&i>=0?(c=(c=c.concat(this._getArcPoints(s,n,a,e,0,r))).concat(this._getArcPoints(s,n+h,a,0,i,r))).concat(this._getPointByAngle(s,n,a,i,r)):e<Math.PI&&i>=Math.PI?(c=(c=c.concat(this._getPointByAngle(s,n,a,e,r))).concat(this._getArcPoints(s,n+h,a,e,Math.PI,r))).concat(this._getArcPoints(s,n,a,Math.PI,i,r)):(c=(c=c.concat(this._getPointByAngle(s,n,a,e,r))).concat(this._getArcPoints(s,n+h,a,e,i,r))).concat(this._getPointByAngle(s,n,a,i,r)):c.concat(this._getArcPoints(s,n,a,e,i,r))).push(c[0]),c.push(c[1]),this.addPoly(t,c,o)},_getArcPoints:function(t,e,i,s,n,a,r){var o=[];r=r||1;for(var l=s;r>0&&l<n||r<0&&l>n;l+=r*Math.PI/18)o=o.concat(this._getPointByAngle(t,e,i,l,a));return o.concat(this._getPointByAngle(t,e,i,n,a))},_getPointByAngle:function(t,e,i,s,n){var a=[];return a.push(Math.floor(t+i*Math.cos(s))),a.push(Math.floor(e+i*Math.sin(s)*n)),a},hide:function(t,e,i){if(t.querySelectorAll)for(var s=t.querySelectorAll('area[userdata="'+e+'"]'),n=0;n<s.length;n++){var a=s[n];i?a.getAttribute("coords")&&(a.coordsdis=a.getAttribute("coords"),a.setAttribute("coords",""),a.coords=""):i||a.coordsdis&&(a.setAttribute("coords",a.coordsdis),a.coords=a.coordsdis,a.coordsdis=""),s[n].style.display=i?"none":""}},render:function(t){var e=vt("DIV");e.style.cssText="position:absolute; width:100%; height:100%; top:0px; left:0px;",t.appendChild(e),e.innerHTML='\n\t\t\t<map id="'.concat(this._id,'" name="').concat(this._id,'">').concat(this._map.join("\n"),'</map>\n\t\t\t<img class="webix_map_img" usemap="#').concat(this._id,'">'),t._htmlmap=e,this._map=[]}}),cs={$init:function(){this._elements={},this._translate_ids={},this.getTopParentView=this._get_self=A((function(){return this}),this),this._run_inner_init_logic(),this.$ready.push(this._run_after_inner_init_logic)},$$:function(t){return this._elements[t]},innerId:function(t){return this._translate_ids[t]},_run_inner_init_logic:function(){this._prev_global_col=me._global_collection,me._global_collection=this},_run_after_inner_init_logic:function(){for(var t in this._elements){var e=this._elements[t];this.callEvent&&e.mapEvent&&!e._evs_map.onitemclick&&e.mapEvent({onitemclick:this}),e.getTopParentView=this._get_self}me._global_collection=this._prev_global_col,this._prev_global_col=0},_destroy_child:function(t){delete this._elements[t]},ui:function(){this._run_inner_init_logic();var t=be.apply(this,arguments);return this._run_after_inner_init_logic(),t}},ds={$init:function(){this.getSelectedId&&this.attachEvent("onAfterRender",this._set_focusable_item),this.moveSelection&&this.attachEvent("onTabFocus",this._set_item_focus)},_set_item_focus:function(){if(this.getSelectedId){var t=this.getSelectedId(!0);t.length&&this.getItemNode(t[0])||this.moveSelection("down")}},_set_focusable_item:function(){var t=this.getSelectedId(!0);if(!t.length||!this.getItemNode(t[0])){var e=this._dataobj.querySelector("["+this._id+"]");e&&e.setAttribute("tabindex","0")}},_navigation_helper:function(t){return function(e,i){var s=i.target;if(!s.getAttribute("webixignore")){var n=s.tagName;if("INPUT"==n||"TEXTAREA"==n||"SELECT"==n)return!0}if(e&&e.moveSelection&&e.config.navigation&&!e._in_edit_mode)return St(i),e.moveSelection(t,{shift:i.shiftKey,ctrl:i.ctrlKey,e:i})}},moveSelection:function(t,e,i){var s=this._settings;if(!s.disabled){if(("right"==t||"left"==t)&&this._parent_menu){var n=ke(this._parent_menu);return n._hide_sub_menu(!0),void("x"===n.config.layout?n.moveSelection(t):ni.setFocus(n))}var a=this.getSelectedId(!0),r=this.count&&("x"==s.layout||s.xCount>1),o=!0;if(!a.length&&this.count()){if("down"==t||"right"==t&&r)t="top";else{if(!("up"==t||"left"==t&&r))return;t="bottom"}a=[this.getFirstId()],o=!1}if(1==a.length){if(a=a[0],o=!0===o?a:null,"left"==t){if(this.close&&!this._ignore_clicks)return this.close(a);if(this._level_up&&this._level_up(a))return this.render()}else if("right"==t){if(this.open)return this.open(a);if(this._level_down&&this._level_down(a))return this.render()}if("top"==t)a=this.getFirstId();else if("bottom"==t)a=this.getLastId();else if("up"==t||"left"==t||"pgup"==t){var l=this.getIndexById(a),h="pgup"==t?10:1;a=this.getIdByIndex(Math.max(0,l-h))}else{if("down"!=t&&"right"!=t&&"pgdown"!=t)return void f(!1,"Not supported selection moving mode");var c=this.getIndexById(a),d="pgdown"==t?10:1;a=this.getIdByIndex(Math.min(this.count()-1,c+d))}var u="up"==t||"left"==t||"pgdown"==t||"bottom"==t?-1:1;if(this._skip_item&&!(a=this._skip_item(a,o,u)))return;if(this.showItem(a),this.select(a),this.getSubMenu&&this.getSubMenu(a)&&this._mouse_move_activation(a,this.getItemNode(a)),!s.clipboard&&!1!==i){var _=this.getItemNode(a);_&&_.focus()}}return!1}},navigation_setter:function(t){return t&&!ni._global_nav_grid_hotkeys&&(ni._global_nav_grid_hotkeys=!0,ni.addHotKey("up",this._navigation_helper("up")),ni.addHotKey("down",this._navigation_helper("down")),ni.addHotKey("right",this._navigation_helper("right")),ni.addHotKey("left",this._navigation_helper("left")),ni.addHotKey("shift+up",this._navigation_helper("up")),ni.addHotKey("shift+down",this._navigation_helper("down")),ni.addHotKey("shift+right",this._navigation_helper("right")),ni.addHotKey("shift+left",this._navigation_helper("left")),ni.addHotKey("ctrl+shift+up",this._navigation_helper("up")),ni.addHotKey("ctrl+shift+down",this._navigation_helper("down")),ni.addHotKey("ctrl+shift+right",this._navigation_helper("right")),ni.addHotKey("ctrl+shift+left",this._navigation_helper("left")),ni.addHotKey("pageup",this._navigation_helper("pgup")),ni.addHotKey("pagedown",this._navigation_helper("pgdown")),ni.addHotKey("home",this._navigation_helper("top")),ni.addHotKey("end",this._navigation_helper("bottom")),ni.addHotKey("shift+pageup",this._navigation_helper("pgup")),ni.addHotKey("shift+pagedown",this._navigation_helper("pgdown")),ni.addHotKey("shift+home",this._navigation_helper("top")),ni.addHotKey("shift+end",this._navigation_helper("bottom")),ni.addHotKey("ctrl+up",this._navigation_helper("up")),ni.addHotKey("ctrl+down",this._navigation_helper("down")),ni.addHotKey("ctrl+left",this._navigation_helper("left")),ni.addHotKey("ctrl+right",this._navigation_helper("right"))),t}},us={$init:function(){this.$ready.push(this._create_scheme_init),this.attachEvent("onStructureUpdate",this._create_scheme_init),this.attachEvent("onStructureLoad",(function(){this._scheme_init_order.length||this._create_scheme_init()}))},_create_scheme_init:function(){var t=this._scheme_init_order=[],e=this._settings;e.columns&&this._build_data_map(e.columns),this._settings.map&&this._process_field_map(e.map),t.length&&(this.data._scheme_init=function(e){for(var i=0;i<t.length;i++)t[i](e)})},_process_field_map:function(t){for(var e in t)this._scheme_init_order.push(this._process_single_map(e,t[e]))},_process_single_map:function(t,e,i){var s,n=e.replace(/^(\s|)\((date|number)\)/,"");return""===n?s=function(e){return e[t]}:(-1===n.indexOf("#")&&-1===n.indexOf("{")&&(n="#"+n+"#"),s=le(n)),0===e.indexOf("(date)")?(i&&!i.format&&(i.format=R.dateFormatStr),function(e){var i=(s(e)||"").toString();e[t]=R.parseFormatDate(i)}):0===e.indexOf("(number)")?function(e){e[t]=1*s(e)}:function(e){e[t]=s(e)||""}},_build_data_map:function(t){for(var e=0;e<t.length;e++){var i=t[e];i.id||(i.id="i"+T(),i.header||(i.header="")),i.map&&this._scheme_init_order.push(this._process_single_map(i.id,i.map,t[e])),this._map_options(t[e]),!i.editor||i.template||i.format||this._map_editor(i.id,t[e])}},_create_collection:function(t){if("string"==typeof t){var i=ke(t);i?t=i:(t=new(p("DataCollection"))({url:t}),this._destroy_with_me.push(t)),t.getBody&&(t=i.getBody())}else if("function"==typeof t||t.$proxy)t=new(p("DataCollection"))({url:t}),this._destroy_with_me.push(t);else if(!t.loadNext){var s=B(t),n=[];if(s&&"object"!==e(t[0])){for(var a=0;a<t.length;a++)n.push({id:t[a],value:t[a]});t=n}else if(!s){for(var r in t)n.push({id:r,value:t[r]});t=n}t=new(p("DataCollection"))({data:t}),this._destroy_with_me.push(t)}return t},_map_options:function(t){var e=t.options||t.collection;e&&(e=this._create_collection(e),this._bind_collection(e,t)),t.header&&(this._map_header_options(t.header),this._map_header_options(t.footer))},_map_header_options:function(t){var e=this;t=t||[];for(var i=function(i){var s=t[i];if(s&&s.options){var n=s.options;n.loadNext||(n=s.options=e._create_collection(n));var a=n.data.attachEvent("onStoreUpdated",(function(){e.refreshFilter&&e.refreshFilter(s.columnId)}));e.attachEvent("onDestruct",(function(){n.$destructed||n.data.detachEvent(a)}))}},s=0;s<t.length;s++)i(s)},_bind_collection:function(t,e){var i=this;if(e){delete e.options,e.collection=t,e.template=e.template||this._bind_template(e.optionslist);var s=t.data.attachEvent("onStoreUpdated",(function(){i.refresh(),i.refreshFilter&&i.refreshFilter(e.id)}));this.attachEvent("onDestruct",(function(){t.$destructed||t.data.detachEvent(s)}))}},_bind_template:function(t){if(t){var e="string"==typeof t?t:",";return function(t,i,s,n){if(!s)return"";for(var a=s.toString().split(e),r=0;r<a.length;r++){var o=n.collection.data.pull[a[r]];a[r]=o&&o.value||""}return a.join(", ")}}return function(t,e,i,s){var n=s.collection.data.pull[i];return n&&(n.value||0===n.value)?n.value:""}},_map_editor:function(t,e){var i=is[e.editor];i&&i.masterFormat&&(e.format=i.masterFormat)}},_s={$init:function(t){t=t||{},this._clickstamp=0,this._dbl_sensetive=Ot.touch?500:300,this._item_clicked=null,this._mouse_action_extend(t.onClick,"on_click"),this._mouse_action_extend(t.onContext,"on_context"),this._mouse_action_extend(t.onDblClick,"on_dblclick"),this._mouse_action_extend(t.onMouseMove,"on_mouse_move"),this.on_click&&_e(this._contentobj,"click",this._onClick,{bind:this}),this.on_context&&_e(this._contentobj,"contextmenu",this._onContext,{bind:this}),this.on_mouse_move&&this._enable_mouse_move()},_enable_mouse_move:function(){this._mouse_move_enabled||(this.on_mouse_move=this.on_mouse_move||{},_e(this._contentobj,"mousemove",this._onMouse,{bind:this}),_e(this._contentobj,"mouseout",this._onMouse,{bind:this}),this._mouse_move_enabled=1,this.attachEvent("onDestruct",(function(){this._mouse_move_timer&&window.clearTimeout(this._mouse_move_timer)})))},_mouse_action_extend:function(e,i){if(e){var s=this[i],n=s?t.extend({},s):{};this[i]=t.extend(n,e)}},_onClick:function(t){var e=this;if(!this.isEnabled())return!1;if(ni._focus_action(this),this.on_dblclick&&this.locate){if(this._clickHandler&&this._item_clicked+""==this.locate(t)+"")return clearTimeout(this._clickHandler),this._clickHandler=null,this._onDblClick(t);this._item_clicked=this.locate(t),this._clickHandler=j((function(){return e._clickHandler=null,e._mouseEvent(t,e.on_single_click,"ItemSingleClick")}),null,[t],this._dbl_sensetive)}return this._mouseEvent(t,this.on_click,"ItemClick")},_onDblClick:function(t){return this._mouseEvent(t,this.on_dblclick,"ItemDblClick")},_onContext:function(t){this._mouseEvent(t,this.on_context,"BeforeContextMenu","AfterContextMenu")},_onMouse:function(t){this.$destructed||(document.createEventObject&&(t=document.createEventObject(event)),this._mouse_move_timer&&window.clearTimeout(this._mouse_move_timer),this.callEvent("onMouseMoving",[t]),this._mouse_move_timer=j((function(t){"mousemove"==t.type?this._onMouseMove(t):this._onMouseOut(t)}),this,[t],this._settings.mouseEventDelay||500))},_onMouseMove:function(t){this._mouseEvent(t,this.on_mouse_move,"MouseMove")||this._onMouseOut(t)},_onMouseOut:function(t){this.callEvent("onMouseOut",[t])},_mouseEvent:function(t,e,i,s){if(!t.processed&&this._viewobj){t.processed=!0;for(var n=t.target,a="",r=null,o=!1;n&&n.parentNode&&this._viewobj&&n!=this._viewobj.parentNode;){if(!o&&n.getAttribute&&(r=n.getAttribute(this._id))){if(n.getAttribute("webix_disabled"))return void(this._item_clicked=null);if(this._item_clicked=r,this.callEvent){if(!this.callEvent("on"+i,[r,t,n]))return;s&&this.callEvent("on"+s,[r,t,n])}o=!0}if(a=Nt(n),e&&a){a=a.toString().split(" ");for(var l=0;l<a.length;l++)if(e[a[l]]&&!1===P(e[a[l]],this.$scope).call(this,t,r||xt(t,this._id),n))return o}n=n.parentNode}return o}}},ps={$init:function(){this.$ready.push((function(){this.attachEvent("onKeyPress",this._onKeyPress)}))},_moveActive:function(t,e){if(37===t||39===t){St(e),this._showNavItem(37===t?-1:1);var i=this._navPanel.querySelector("[tabindex='0']");i&&i.focus()}},_renderPanel:function(){wt(this._navPanel),this._navPanel=vt("DIV",{class:"webix_nav_panel webix_nav_panel_"+this._settings.navigation.type,role:"tablist"},""),this._viewobj.appendChild(this._navPanel),this._renderNavItems(),this._renderNavButtons(),this._setLinkEventHandler()},_setLinkEventHandler:function(){var t=[];this._navPanel&&(t[0]=pe(this._navPanel,"click",A((function(t){for(var e=t.target,i=!1;e!=this._navPanel&&!i;){var s=e.getAttribute(this._linkAttr);s&&(i=!0,this._showPanelBind(s)),e=e.parentNode}}),this))),this._prevNavButton&&(t[1]=pe(this._prevNavButton,"click",A((function(){this._showNavItem(-1)}),this))),this._nextNavButton&&(t[1]=pe(this._nextNavButton,"click",A((function(){this._showNavItem(1)}),this))),this.attachEvent("onDestruct",(function(){for(var e=0;e<t.length;e++)this.detachEvent(t[e]);t=null}))},_showNavItem:function(t){if(this._cells){var e=this._active_cell+t;(e>=this._cells.length||e<0)&&(e=e<0?this._cells.length-1:0),this.setActiveIndex(e)}},_showPanelBind:function(t){this._cells&&ke(t).show()},_renderNavItems:function(){var t,e;if((e=this._settings.navigation).items){this._linkAttr=e.linkAttr||"bind_id",this._navPanel?this._clearPanel():this._renderPanel();var i=this._cells?this._cells:this.data.order;if(i.length>1)for(var s=0;s<i.length;s++){t=vt("DIV",{class:"webix_nav_item webix_nav_"+(s==this._active_cell?"active":"inactive"),role:"tab",tabindex:s==this._active_cell?"0":"-1"});var n=this._cells?this._cells[s]._settings.id:i[s];n&&t.setAttribute(this._linkAttr,n),this._navPanel.appendChild(t)}}},_clearPanel:function(){if(this._navPanel)for(var t=this._navPanel.childNodes,e=t.length-1;e>=0;e--)wt(t[e])},_renderNavButtons:function(){var t=this._settings.navigation;t.buttons&&(this._prevNavButton&&wt(this._prevNavButton),this._prevNavButton&&wt(this._nextNavButton),this._prevNavButton=vt("DIV",{class:"webix_nav_button_"+t.type+" webix_nav_button_prev "},'<div role="button" tabindex="0" aria-label="'+R.aria.prevTab+'" class="webix_nav_button_inner"></div>'),this._viewobj.appendChild(this._prevNavButton),this._nextNavButton=vt("DIV",{class:"webix_nav_button_"+t.type+" webix_nav_button_next "},'<div role="button" tabindex="0" aria-label="'+R.aria.prevTab+'" class="webix_nav_button_inner"></div>'),this._viewobj.appendChild(this._nextNavButton))}},fs={showOverlay:function(t){this._overlay?this._overlay.innerHTML=t:(this._overlay=vt("DIV",{class:"webix_overlay"},t||""),yt(this._overlay,this._viewobj.firstChild,this._viewobj),this._viewobj.style.position="relative")},hideOverlay:function(){this._overlay&&(wt(this._overlay),this._overlay=null)}},gs={pager_setter:function(t){if("string"==typeof t){var e=ke(t);if(!e)return this.$blockRender=!0,j((function(){var e=ke(t);this._settings.pager=this.pager_setter(e);var i=e._settings;i.count=this.data._count_pager_total(i.level),e.refresh(),this.$blockRender=!1,this.render()}),this),null;t=e}return this.attachEvent("onBeforeRender",(function e(i){if(this.config.topSplit&&(this.config.topSplit=0),t.config.autosize&&this.getVisibleCount){var s=this.getVisibleCount();isNaN(s)?(t.config.size=1,j(e,this,[!0])):s!=t.config.size&&(t.config.size=s,t.refresh(),!0===i&&this.refresh())}var n=this._settings.pager;return-1!=n.page&&(this.data.$min=this._count_pager_index(0,n.page*n.size),this.data.$max=this._count_pager_index(this.data.$min,n.size),this.data.$pagesize=this.data.$max-this.data.$min,!0)})),t.$view||(t.view="pager",t=be(t)),this._pager=t,t.$master=this,this.data.attachEvent("onStoreUpdated",(function(){var e=t._settings;e.count=this._count_pager_total(e.level),t.refresh()})),this.data._count_pager_total=this._count_pager_total,t._settings},_count_pager_total:function(t){var e=this,i=0;return t&&this.order.forEach((function(t){t&&1!=e.getItem(t).$level&&i++})),this.count()-i},_count_pager_index:function(t,e){if(this._settings.pager.level){var i=this.data.order;if(i.length)for(var s=t;s<=t+e;s++){var n=i[s];n&&1!=this.getItem(n).$level&&e++}else e=0}return t+e},setPage:function(t){this._pager&&this._pager.select(t)},getPage:function(){return this._pager._settings.page},getPager:function(){return this._pager}},ms={$init:function(){var t=this;E(this._progress)&&this.attachEvent&&(this.attachEvent("onBeforeLoad",(function(){return t.showProgress()})),this.attachEvent("onAfterLoad",(function(){return t.hideProgress()})),this._progress=null)},showProgress:function(e){var i;if(!this._progress){var s="icon"==(e=t.extend({position:0,delay:2e3,type:"icon",icon:"wxi-sync",hide:!1},e||{},!0)).type?e.icon+" webix_spin":"";if(this._progress=vt("DIV",{class:"webix_progress_"+e.type,role:"progressbar","aria-valuemin":"0","aria-valuemax":"100",tabindex:"0"},"<div class='webix_progress_state "+s+"'></div>"),this.setPosition||(this._viewobj.style.position="relative"),yt(this._progress,this._viewobj.firstChild,this._viewobj),this._viewobj.setAttribute("aria-busy","true"),!this._touch_scroll&&this.getScrollState){var n=this.getScrollState();this._viewobj.scrollWidth!=this.$width&&(this._progress.style.left=n.x+"px"),this._viewobj.scrollHeight!=this.$height&&("bottom"!=e.type?this._progress.style.top=n.y+"px":this._progress.style.top=n.y+this.$height-this._progress.offsetHeight+"px")}this._progress_animate="icon"!=e.type}if(e){if(this._progress_animate){var a=e.position||1;e.delay&&(i=this._viewobj.firstChild.offsetWidth,this._progress.firstChild.style[Ot.transitionDuration]=e.delay+"ms"),this._progress.firstChild.style.width=100*a+"%"}return this._progress_hide&&clearTimeout(this._progress_hide),e.hide&&(this._progress_hide=j(this.hideProgress,this,[!0],e.delay)),i}},hideProgress:function(t){this._progress&&(t||!this._progress_animate?(wt(this._progress),this._progress=null,this._viewobj.removeAttribute("aria-busy")):this.showProgress({position:1.1,delay:300,hide:!0}))}},vs={$init:function(){f(this.data,"RenderStack :: Component doesn't have DataStore"),f(le,"template :: template is not accessible"),this._html=document.createElement("DIV"),this.data.attachEvent("onIdChange",A(this._render_change_id,this)),this.attachEvent("onItemClick",this._call_onclick),this.types||(this.types={default:this.type},this.type.name="default"),this.type=S(this.type)},customize:function(t){ge(this,t)},item_setter:function(t){return this.type_setter(t)},type_setter:function(e){return this.types[e]?(this.type=S(this.types[e]),this.type.css&&(this._contentobj.className+=" "+this.type.css)):this.customize(e),this.type.on_click&&t.extend(this.on_click,this.type.on_click),e},template_setter:function(t){this.type.template=le(t)},_toHTML:function(t){var e=this.data._marks[t.id];return f(!t.$template||this.type["template"+t.$template],"RenderStack :: Unknown template: "+t.$template),this.callEvent("onItemRender",[t]),this.type.templateStart(t,this.type,e)+(t.$template?this.type["template"+t.$template]:this.type.template)(t,this.type,e)+this.type.templateEnd(t,this.type,e)},_toHTMLObject:function(t){return this._html.innerHTML=this._toHTML(t),this._html.firstChild},_render_change_id:function(t,e){var i=this.getItemNode(t);i&&(i.setAttribute(this._id,e),this._htmlmap[e]=this._htmlmap[t],delete this._htmlmap[t])},_call_onclick:function(){if(this._settings.click){var t=P(this._settings.click,this.$scope);t&&t.call&&t.apply(this,arguments)}},getItemNode:function(t){if(this._htmlmap)return this._htmlmap[t];this._htmlmap={};for(var e=this._dataobj.childNodes,i=0;i<e.length;i++){var s=e[i].getAttribute(this._id);s&&(this._htmlmap[s]=e[i])}return this.getItemNode(t)},locate:function(t){return xt(t,this._id)},showItem:function(t){var e=this.getItemNode(t);if(e&&this.scrollTo){var i=e.offsetLeft,s=i+e.offsetWidth,n=e.offsetTop,a=n+e.offsetHeight,r=this.getScrollState(),o=r.x;(o>i||o+this._content_width<s)&&(o=i);var l=r.y;(l>n||l+this._content_height<a)&&(l=n),this.scrollTo(o,l),this._setItemActive&&this._setItemActive(t)}},render:function(t,e,i){if(this.isVisible(this._settings.id)&&!this.$blockRender)if(t){var s=this.getItemNode(t);switch(i){case"paint":case"update":if(!s)return;yt(this._htmlmap[t]=this._toHTMLObject(e),s),wt(s);break;case"delete":if(!s)return;wt(s),delete this._htmlmap[t];break;case"add":yt(this._htmlmap[t]=this._toHTMLObject(e),this.getItemNode(this.data.getNextId(t)),this._dataobj);break;case"move":yt(this.getItemNode(t),this.getItemNode(this.data.getNextId(t)),this._dataobj);break;default:f(0,"Unknown render command: "+i)}}else this.callEvent("onBeforeRender",[this.data])&&((this._renderobj||this._dataobj).innerHTML=this.data.getRange().map(this._toHTML,this).join(""),this._htmlmap=null,this.callEvent("onAfterRender",[]))}},bs={$init:function(t){if(t&&!t.scroll&&this._one_time_scroll)return this._dataobj=this._dataobj||this._contentobj;(this._dataobj||this._contentobj).appendChild(vt("DIV",{class:"webix_scroll_cont"},"")),this._dataobj=(this._dataobj||this._contentobj).firstChild,this.callEvent&&!this.$hasYScroll&&_e(this._viewobj,"scroll",(function(){j((function(){this.callEvent("onAfterScroll",[])}),this)}),{bind:this})},scroll_setter:function(t){if(!t)return!1;var e="auto"===t,i="x"==t?"x":"xy"==t||e?"xy":"y";Ot.$customScroll&&Li.enable(this,i);var s=this._dataobj.parentNode.style;return e&&!Ot.$customScroll?s.overflowX=s.overflowY="auto":(-1!==i.indexOf("x")&&(this._scroll_x=!0,s.overflowX="scroll"),-1!==i.indexOf("y")&&(this._scroll_y=!0,s.overflowY="scroll")),i},_onoff_scroll:function(t,e){!!this._settings.scroll!=!!t&&(Ot.$customScroll||(this._dataobj.parentNode.style["x"===e?"overflowX":"overflowY"]=t?"auto":"hidden"),"x"===e?this._scroll_x=t:this._scroll_y=t,this._settings.scroll=!!t&&e)},getScrollState:function(){return{x:this._dataobj.parentNode.scrollLeft,y:this._dataobj.parentNode.scrollTop}},scrollTo:function(t,e){this._dataobj.parentNode.scrollLeft=t,this._dataobj.parentNode.scrollTop=e}},ws={$init:function(){this._selected=O(),f(this.data,"SelectionModel :: Component doesn't have DataStore"),this.data.attachEvent("onStoreUpdated",A(this._data_updated,this)),this.data.attachEvent("onStoreLoad",A(this._data_loaded,this)),this.data.attachEvent("onAfterFilter",A(this._data_filtered,this)),this.data.attachEvent("onSyncApply",A(this._select_check,this)),this.data.attachEvent("onIdChange",A(this._id_changed,this)),this.$ready.push(this._set_noselect)},_set_noselect:function(){("multiselect"==this._settings.select||this._settings.multiselect||"area"==this._settings.select)&&_e(this.$view,"mousedown",(function(t){if(t.shiftKey||Ot.isIE&&t.ctrlKey){var e=Ot.isIE?document.body:this;me._noselect_element=e,Dt(e,"webix_noselect",!0)}}))},_id_changed:function(t,e){for(var i=this._selected.length-1;i>=0;i--)this._selected[i]==t&&(this._selected[i]=e)},_data_filtered:function(){for(var t=this._selected.length-1;t>=0;t--)if(this.data.getIndexById(this._selected[t])<0){var e=this._selected[t];this.removeCss(e,"webix_selected",!0),this._selected.splice(t,1),this.callEvent("onSelectChange",[e])}},_data_updated:function(t,e,i){"delete"==i?this.loadBranch?this._select_check():(this._selected.remove(t),this.callEvent("onSelectChange",[this._selected])):t||this.data.count()||this.data._filter_order||this.data._filter_branch||(this._selected=O())},_data_loaded:function(){this._settings.select&&this.data.each((function(t){t&&t.$selected&&this.select(t.id)}),this)},_select_check:function(){for(var t,e=this._selected.length-1;e>=0;e--)this.exists(this._selected[e])||(t=!0,this._selected.splice(e,1));t&&this.callEvent("onSelectChange",[this._selected])},_select_mark:function(t,e,i,s){var n=e?"onBeforeSelect":"onBeforeUnSelect";if(!this.callEvent(n,[t,e]))return!1;s&&(this._silent_selection=!0,this.unselectAll(),this._silent_selection=!1),e?this.addCss(t,"webix_selected",!0):this.removeCss(t,"webix_selected",!0),i?i.push(t):(e?this._selected.push(t):this._selected.remove(t),this._refresh_selection(t));var a=e?"onAfterSelect":"onAfterUnSelect";return this.callEvent(a,[t]),!0},select:function(t,e){var i=arguments[2],s=arguments[3];if(!t)return this.selectAll();if(B(t))for(var n=0;n<t.length;n++)this.select(t[n],n?1:e,i,s);else{if(f(this.data.exists(t),"Incorrect id in select command: "+t),s&&this._selected.length)return this.selectAll(this._selected[this._selected.length-1],t);var a=!1;i||e||1==this._selected.length&&this._selected[0]==t||(a=!0),a||!this.isSelected(t)?this._select_mark(t,!0,null,a):i&&this.unselect(t)}},unselect:function(t){if(!t)return this.unselectAll();this.isSelected(t)&&this._select_mark(t,!1)},selectAll:function(t,e){var i=[];(t||e?this.data.getRange(t||null,e||null):this.data.getRange()).each((function(t){this.data.getMark(t.id,"webix_selected")||this._select_mark(t.id,!0,i)&&this._selected.push(t.id)}),this),this._refresh_selection(i)},unselectAll:function(){var t=[];this._selected.each((function(e){this._select_mark(e,!1,t)}),this),this._selected=O(),this._refresh_selection(t)},isSelected:function(t){return-1!=this._selected.find(t)},getSelectedId:function(t){switch(this._selected.length){case 0:return t?[]:"";case 1:return t?[this._selected[0]]:this._selected[0];default:return[].concat(this._selected)}},getSelectedItem:function(t){var e=this.getSelectedId(!0);if(e.length>1||t){for(var i=e.length-1;i>=0;i--)e[i]=this.getItem(e[i]);return e}if(e.length)return this.getItem(e[0])},_is_mass_selection:function(t){return t.length>100||t.length>this.data.count/2},_refresh_selection:function(t){if("object"!=e(t)&&(t=[t]),t.length){if(this._is_mass_selection(t))this.data.refresh();else for(var i=0;i<t.length;i++)this.render(t[i],this.data.getItem(t[i]),"update");this._silent_selection||this.callEvent("onSelectChange",[t])}}};Ne((function(){pe(document.body,"mouseup",(function(){me._noselect_element&&(Et(me._noselect_element,"webix_noselect"),me._noselect_element=null)}))}));var ys={_toHex:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],toHex:function(t,e){t=parseInt(t,10);for(var i="";t>0;)i=this._toHex[t%16]+i,t=Math.floor(t/16);for(;i.length<e;)i="0"+i;return i},rgbToHex:function(t){var e=[];return"string"==typeof t?t.replace(/[\d+.]+/g,(function(t){e.push(parseFloat(t))})):B(t)&&(e=t),0===e[3]?"":e.slice(0,3).map((function(t){return ys.toHex(Math.floor(t),2)})).join("")},hexToDec:function(t){return parseInt(t,16)},toRgb:function(t){var e,i,s,n;if("string"!=typeof t)e=t[0],i=t[1],s=t[2];else if(-1!=t.indexOf("rgb"))e=(n=t.substr(t.indexOf("(")+1,t.lastIndexOf(")")-t.indexOf("(")-1).split(","))[0],i=n[1],s=n[2];else if("#"==t.substr(0,1))t=t.substr(1),e=this.hexToDec(t.substr(0,2)),i=this.hexToDec(t.substr(2,2)),s=this.hexToDec(t.substr(4,2));else{var a=vt("div",{style:"color:".concat(t)});document.body.appendChild(a);var r=window.getComputedStyle(a).color;wt(a);var o=r.slice(r.indexOf("(")+1,r.indexOf(")")).split(", ");e=o[0],i=o[1],s=o[2]}return((e=parseInt(e,10)||0)<0||e>255)&&(e=0),((i=parseInt(i,10)||0)<0||i>255)&&(i=0),((s=parseInt(s,10)||0)<0||s>255)&&(s=0),[e,i,s]},hsvToRgb:function(t,e,i){var s,n,a,r,o,l,h,c;switch(a=i*(1-e),r=i*(1-(n=t/60-(s=Math.floor(t/60)%6))*e),o=i*(1-(1-n)*e),l=0,h=0,c=0,s){case 0:l=i,h=o,c=a;break;case 1:l=r,h=i,c=a;break;case 2:l=a,h=i,c=o;break;case 3:l=a,h=r,c=i;break;case 4:l=o,h=a,c=i;break;case 5:l=i,h=a,c=r}return[l=Math.floor(255*l),h=Math.floor(255*h),c=Math.floor(255*c)]},rgbToHsv:function(t,e,i){var s,n,a,r,o,l;return s=t/255,n=e/255,a=i/255,r=Math.min(s,n,a),l=0,(o=Math.max(s,n,a))==r?l=0:o==s&&n>=a?l=60*(n-a)/(o-r)+0:o==s&&n<a?l=60*(n-a)/(o-r)+360:o==n?l=60*(a-s)/(o-r)+120:o==a&&(l=60*(s-n)/(o-r)+240),[l,0===o?0:1-r/o,o]}};function xs(t){var e=" ";if(t)for(var i in t)e+=i+'="'+t[i]+'" ';return e}var ks={draw:function(t,e,i,s){return"<svg "+xs({xmlns:"http://www.w3.org/2000/svg",version:"1.1",height:"100%",width:"100%",viewBox:"0 0 "+e+" "+i,class:s||""})+">"+t+"</svg>"},styleMap:{lineColor:"stroke",color:"fill"},group:function(t){return"<g>"+t+"</g>"}};ks._handlers={M:function(t){return" M "+t.x+" "+t.y},L:function(t){return" L "+t.x+" "+t.y},C:function(t,e,i){return" C "+t.x+" "+t.y+" "+e.x+" "+e.y+" "+i.x+" "+i.y},A:function(t,e,i,s){var n=t.x+Math.cos(s)*e,a=t.y+Math.sin(s)*e;return" A "+e+" "+e+" 0 "+(s-i>=Math.PI?1:0)+" 1 "+n+" "+a}},ks.definePath=function(t,e){for(var i="",s=0;s<t.length;s++){f(t[s][0]&&"string"==typeof t[s][0],"Path type must be a string");var n=t[s][0].toUpperCase();f(this._handlers[n],"Incorrect path type"),i+=this._handlers[n].apply(this,t[s].slice(1))}return e&&(i+=" Z"),i},ks._linePoints=function(t){for(var e=[],i=0;i<t.length;i++)e.push([i?"L":"M",t[i]]);return e},ks.setOpacity=function(t,e){var i=ys.toRgb(t);return i.push(e),"rgba("+i.join(",")+")"},ks._curvePoints=function(t){for(var e=[],i=0;i<t.length;i++){var s=t[i];i||e.push(["M",s[0]]),e.push(["C",s[1],s[2],s[3]])}return e},ks.getPath=function(t,e,i){return'<path class="'+e+'" vector-effect="non-scaling-stroke" d="'+t+'" '+(i=xs(i))+"/>"},ks.getSector=function(t,e,i,s,n,a){a=xs(a);var r=[["M",t],["L",{x:t.x+Math.cos(i)*e,y:t.y+Math.sin(i)*e}],["A",t,e,i,s],["L",t]];return'<path class="'+n+'" vector-effect="non-scaling-stroke" d="'+ks.definePath(r,!0)+'" '+a+"/>"},ks.getCurve=function(t,e,i){return i=xs(i),'<path fill="none" class="'+e+'" vector-effect="non-scaling-stroke" d="'+this.definePath(this._curvePoints(t))+'" '+i+"/>"},ks.getLine=function(t,e,i,s){return this.getPath(this.definePath(this._linePoints([t,e]),!0),i,s)},ks.getCircle=function(t,e,i,s){return s=xs(s),'<circle class="'+i+'" cx="'+t.x+'" cy="'+t.y+'" r="'+e+'" '+s+"/>"},ks.getRect=function(t,e,i,s,n,a){return'<rect class="'+n+'" rx="0" ry="0" x="'+t+'" y="'+e+'" width="'+i+'" height="'+s+'" '+(a=xs(a))+"/>"};var Cs={paddingX:6,paddingY:6,radius:2,minHeight:4,eventRadius:8};function $s(e){this.config=t.extend(I(Cs),e||{},!0)}$s.prototype.draw=function(t,e,i){var s=this.getPoints(t,e,i),n=this.config,a=ks,r=n.color?this._applyColor(a,n.color):null,o=a.definePath(this._getLinePoints(s)),l=a.group(a.getPath(o,"webix_sparklines_line"+(r?" "+r.line:"")));l+=this._drawItems(a,s,n.radius,"webix_sparklines_item"+(r?" "+r.item:""));var h=Math.min(t.length?(e-2*(n.paddingX||0))/t.length:0,n.eventRadius);return l+=this._drawEventItems(a,s,h),a.draw(l,e,i,"webix_sparklines_line_chart"+(n.css?" "+n.css:""))},$s.prototype._applyColor=function(t,e){var i={line:{},item:{}},s=t.styleMap;if(e)for(var n in i.line[s.lineColor]=e,i.item[s.color]=e,i)i[n]=ft(i[n]);return i},$s.prototype._drawItems=function(t,e,i,s,n){for(var a=[],r=0;r<e.length;r++)a.push(t.getCircle(e[r],i,s,n));return t.group(a.join(""))},$s.prototype._drawEventItems=function(t,e,i){for(var s=[],n=0;n<e.length;n++)s.push(t.getCircle(e[n],i,"webix_sparklines_event_area",{webix_area:n}));return t.group(s.join(""))},$s.prototype._getLinePoints=function(t){var e,i,s=[];for(e=0;e<t.length;e++)i=e?"L":"M",s.push([i,t[e]]);return s},$s.prototype.getPoints=function(t,e,i){var s=this.config,n=Math.min.apply(null,t);void 0!==s.origin&&(n=Math.min(s.origin,n));var a=Math.max.apply(null,t),r=[],o=s.paddingX||0,l=s.paddingY||0;e=(e||100)-2*o;var h=s.minHeight||0;if(i=(i||100)-2*l,t.length)if(1==t.length)r.push({x:e/2+o,y:i/2+o});else{var c=e/(t.length-1),d=s.scale||a-n,u=(i-h)/(d||1);d||(i/=2);for(var _=0;_<t.length;_++)r.push({x:Math.ceil(c*_)+o,y:i-Math.ceil(u*(t[_]-n))+l-h})}return r};var Ss={paddingX:3,paddingY:4,radius:1,minHeight:4,eventRadius:8};function Is(e){this.config=t.extend(I(Ss),e||{},!0)}Is.prototype.draw=function(t,e,i){var s,n,a,r,o,l=this.config,h=$s.prototype,c=ks;return r=this.getPoints(t,e,i),a=c.definePath(h._getLinePoints(r),!0),l.color&&(o=this._applyColor(c,l.color)),n=c.group(c.getPath(a,"webix_sparklines_area"+(o?" "+o.area:""))),r.splice(r.length-3,3),a=c.definePath(h._getLinePoints(r)),n+=c.group(c.getPath(a,"webix_sparklines_line"+(o?" "+o.line:""))),n+=h._drawItems(c,r,l.radius,"webix_sparklines_item"+(o?" "+o.item:"")),s=Math.min(t.length?(e-2*(l.paddingX||0))/t.length:0,l.eventRadius),n+=h._drawEventItems(c,r,s),c.draw(n,e,i,"webix_sparklines_area_chart"+(l.css?" "+l.css:""))},Is.prototype._applyColor=function(t,e){var i={area:{},line:{},item:{}},s=t.styleMap;if(e)for(var n in i.area[s.color]=t.setOpacity(e,.2),i.line[s.lineColor]=e,i.item[s.color]=e,i)i[n]=ft(i[n]);return i},Is.prototype.getPoints=function(t,e,i){var s=$s.prototype.getPoints.call(this,t,e,i),n=this.config.paddingX||0,a=this.config.paddingY||0;return s.push({x:e-n,y:i-a},{x:n,y:i-a},{x:n,y:s[0].y}),s};var As={paddingX:3,paddingY:4,width:20,margin:4,minHeight:4,eventRadius:8,origin:0,itemCss:function(t){return t<(this.config.origin||0)?" webix_sparklines_bar_negative":""}};function Ds(e){this.config=t.extend(I(As),e||{},!0)}Ds.prototype.draw=function(t,e,i){for(var s="",n=this.config,a=ks,r=n.horizontal,o=[],l=parseInt(this._getOrigin(t,e,i),10)+.5,h=this.getPoints(t,e,i,l),c=0;c<h.length;c++){var d=void 0;d="function"==typeof n.itemCss?n.itemCss.call(this,t[c]):n.itemCss||"",n.negativeColor&&t[c]<n.origin?d+=" "+this._applyColor(a,n.negativeColor):n.color&&(d+=" "+this._applyColor(a,n.color));var u=h[c];o.push(a.getRect(u.x,u.y,u.width,u.height,"webix_sparklines_bar "+d))}s+=a.group(o.join(""));var _=r?n.paddingY:n.paddingX;s+=r?a.group(a.getLine({x:l,y:_},{x:l,y:i-_},"webix_sparklines_origin")):a.group(a.getLine({x:_,y:l},{x:e-_,y:l},"webix_sparklines_origin"));for(var p=this._getEventPoints(t,e,i,l),f=[],g=0;g<p.length;g++){var m=p[g];f.push(a.getRect(m.x,m.y,m.width,m.height,"webix_sparklines_event_area ",{webix_area:g}))}return s+=a.group(f.join("")),a.draw(s,e,i,"webix_sparklines_bar_chart"+(n.css?" "+n.css:""))},Ds.prototype._applyColor=function(t,e){var i={},s=t.styleMap;return e&&(i[s.color]=e),ft(i)},Ds.prototype._getOrigin=function(t,e,i){var n,a=this.config,r=a.horizontal,o=r?a.paddingX:a.paddingY,l=((r?e:i)||100)-2*o;if(n=r?o:o+l,!1!==a.origin){var h=Math.min.apply(Math,s(t)),c=Math.max.apply(Math,s(t)),d=a.origin||-1e-6;d>=c?n=o:d>h&&(n+=l/(c-h)*(r?1:-1)*(d-h))}return n},Ds.prototype._getEventPoints=function(t,e,i){var s=[],n=this.config.horizontal,a=this.config.paddingX,r=this.config.paddingY;if(e=(e||100)-2*a,i=(i||100)-2*r,t.length)for(var o=(n?i:e)/t.length,l=0;l<t.length;l++)n?s.push({x:a,y:Math.ceil(o*l)+r,height:o,width:e}):s.push({x:Math.ceil(o*l)+a,y:r,height:i,width:o});return s},Ds.prototype.getPoints=function(t,e,i,n){var a=this.config,r=a.horizontal,o=Math.min.apply(Math,s(t));a.origin<o&&(o=a.origin);var l=Math.max.apply(Math,s(t)),h=[],c=a.paddingX,d=a.paddingY,u=a.margin,_=a.width||20;if(e=(e||100)-2*c,i=(i||100)-2*d,t.length){var p=(r?i:e)/t.length,f=a.scale||l-o;u=p-(_=Math.min(p-u,_));var g=o;!1!==a.origin&&a.origin>o&&(g=a.origin||0);for(var m=(r?e:i)/(f||1),v=0;v<t.length;v++){var b=Math.abs(Math.ceil(m*(t[v]-g)));t[v]&&b<a.minHeight&&(b+=a.minHeight),r?h.push({x:n-(t[v]>=g?0:b),y:Math.ceil(p*v)+d+u/2,height:_,width:b}):h.push({x:Math.ceil(p*v)+c+u/2,y:n-(t[v]>=g?b:0),height:b,width:_})}}return h};var Es={paddingY:2};function js(e){this.config=t.extend(I(Es),e||{},!0)}js.prototype._defColorsCursor=0,js.prototype._defColors=["#f55b50","#ff6d3f","#ffa521","#ffc927","#ffee54","#d3e153","#9acb61","#63b967","#21a497","#21c5da","#3ea4f5","#5868bf","#7b53c0","#a943ba","#ec3b77","#9eb0b8"],js.prototype._getColor=function(t,e){var i=e.length,s=this._defColors.length;return s>i?(t&&(t=t<s-i?this._defColorsCursor+2:this._defColorsCursor+1),this._defColorsCursor=t):t%=s,this._defColors[t]},js.prototype.draw=function(t,e,i){var s,n,a,r,o=this.config,l=o.color||this._getColor,h=this.getAngles(t),c=ks,d=i/2-(o.paddingY||0),u=e/2,_=i/2;for("function"!=typeof l&&(l=function(){return l}),r="",a=0;a<h.length;a++)(s={})[c.styleMap.color]=l.call(this,a,t,this._context),r+=c.getSector({x:u,y:_},d,h[a][0],h[a][1],"webix_sparklines_sector",s);for(n=c.group(r),r="",a=0;a<h.length;a++)r+=c.getSector({x:u,y:_},d,h[a][0],h[a][1],"webix_sparklines_event_area",{webix_area:a});return n+=c.group(r),o.donut&&(n+=ks.getCircle({x:u,y:_},o.innerRadius||.5*d,"webix_sparklines_donut_hole")),c.draw(n,e,i,"webix_sparklines_pie_chart"+(o.css?" "+o.css:""))},js.prototype.getAngles=function(t){var e,i,s=-Math.PI/2,n=[],a=this._getRatios(t);for(i=0;i<t.length;i++)e=-Math.PI/2+a[i]-1e-4,n.push([s,e]),s=e;return n},js.prototype._getTotalValue=function(t){for(var e=0,i=0;i<t.length;i++)e+=1*t[i];return e},js.prototype._getRatios=function(t){var e,i,s=[],n=0,a=this._getTotalValue(t);for(e=0;e<t.length;e++)i=1*t[e],s[e]=2*Math.PI*(a?(i+n)/a:1/t.length),n+=i;return s};var Vs={paddingX:3,paddingY:6,radius:2,minHeight:4,eventRadius:8};function Ns(e){this.config=t.extend(I(Vs),e||{},!0)}Ns.prototype.draw=function(t,e,i){var s=this.config,n="",a=$s.prototype,r=this.getPoints(t,e,i),o=ks,l=s.color?this._applyColor(o,s.color):null;n+=o.group(o.getCurve(r,"webix_sparklines_line"+(l?" "+l.line:"")));var h=a.getPoints.call(this,t,e,i);n+=a._drawItems(o,h,s.radius,"webix_sparklines_item"+(l?" "+l.item:""));var c=Math.min(t.length?(e-2*(s.paddingX||0))/t.length:0,s.eventRadius);return n+=a._drawEventItems(o,h,c),o.draw(n,e,i,"webix_sparklines_line_chart"+(s.css?" "+s.css:""))},Ns.prototype._applyColor=function(t,e){var i={line:{},item:{}},s=t.styleMap;if(e)for(var n in i.line[s.lineColor]=e,i.item[s.color]=e,i)i[n]=ft(i[n]);return i},Ns.prototype.getPoints=function(t,e,i){var s,n,a,r,o=[],l=[],h=[];for(n=$s.prototype.getPoints.call(this,t,e,i),s=0;s<n.length;s++)l.push(n[s].x),h.push(n[s].y);for(a=this._getControlPoints(l),r=this._getControlPoints(h),s=0;s<n.length-1;s++)o.push([n[s],{x:a[0][s],y:r[0][s]},{x:a[1][s],y:r[1][s]},n[s+1]]);return o},Ns.prototype._getControlPoints=function(t){var e,i,s=[],n=[],a=[],r=[],o=[],l=[],h=t.length-1;for(s[0]=0,n[0]=2,a[0]=1,r[0]=t[0]+2*t[1],e=1;e<h-1;e++)s[e]=1,n[e]=4,a[e]=1,r[e]=4*t[e]+2*t[e+1];for(s[h-1]=2,n[h-1]=7,a[h-1]=0,r[h-1]=8*t[h-1]+t[h],e=1;e<h;e++)i=s[e]/n[e-1],n[e]=n[e]-i*a[e-1],r[e]=r[e]-i*r[e-1];for(o[h-1]=r[h-1]/n[h-1],e=h-2;e>=0;--e)o[e]=(r[e]-a[e]*o[e+1])/n[e];for(e=0;e<h-1;e++)l[e]=2*t[e+1]-o[e+1];return l[h-1]=.5*(t[h]+o[h-1]),[o,l]};var Ts={paddingX:3,paddingY:6,radius:1,minHeight:4,eventRadius:8};function Fs(e){this.config=t.extend(I(Ts),e||{},!0)}Fs.prototype=I(Ns.prototype),Fs.prototype.draw=function(t,e,i){var s=this.config,n=$s.prototype,a=ks,r=s.color?this._applyColor(a,s.color):null,o=this.getPoints(t,e,i),l=o.splice(o.length-3,3),h=a._linePoints(l);h[0][0]="L";var c=a._curvePoints(o).concat(h),d=a.group(a.getPath(a.definePath(c),"webix_sparklines_area"+(r?" "+r.area:""),!0));d+=a.group(a.getPath(a.definePath(a._curvePoints(o)),"webix_sparklines_line"+(r?" "+r.line:"")));var u=n.getPoints.call(this,t,e,i);d+=n._drawItems(a,u,s.radius,"webix_sparklines_item"+(r?" "+r.item:""));var _=Math.min(t.length?(e-2*(s.paddingX||0))/t.length:0,s.eventRadius);return d+=n._drawEventItems(a,u,_),a.draw(d,e,i,"webix_sparklines_splinearea_chart"+(s.css?" "+s.css:""))},Fs.prototype._applyColor=function(t,e){var i={area:{},line:{},item:{}},s=t.styleMap;if(e)for(var n in i.area[s.color]=i.line[s.lineColor]=i.item[s.color]=e,i)i[n]=ft(i[n]);return i},Fs.prototype.getPoints=function(t,e,i){var s=Ns.prototype.getPoints.call(this,t,e,i),n=this.config.paddingX||0,a=this.config.paddingY||0;return s.push({x:e-n,y:i-a},{x:n,y:i-a},{x:n,y:s[0][0].y}),s};var Ps={padding:6,radius:2,eventRadius:8};function Bs(e){this.config=t.extend(I(Ps),e||{},!0)}function Ms(){}Bs.prototype.draw=function(t,e,i){var n=$s.prototype,a=Is.prototype,r=this.config,o=ks,l=e/2,h=i/2,c=Math.min(l,h)-r.padding,d="",u=[],_=[],p=this._getRatios(t.length);t=t.map((function(t){return isNaN(t)?0:t}));var f=Math.max.apply(Math,s(t)),g=Math.min.apply(Math,s(t));g>0&&(g=0);for(var m=0;m<t.length;m++){var v=-Math.PI/2+p[m];_.push(this._getPositionByAngle(v,l,h,c));var b=_[m].x,w=_[m].y;d+=o.getLine({x:l,y:h},{x:b,y:w},"webix_sparklines_origin");var y=void 0,x=void 0;if(t[m]==g)y=l,x=h;else if(t[m]==f)y=b,x=w;else{var k=Math.abs(t[m]-g)/Math.abs(f-t[m]);y=(l+b*k)/(1+k),x=(h+w*k)/(1+k)}u.push({x:y,y:x})}var C=r.color?a._applyColor(o,r.color):null,$=o.definePath(n._getLinePoints(_),!0),S=o.definePath(n._getLinePoints(u),!0),I=o.group(d+o.getPath($,"webix_sparklines_origin"))+o.group(o.getPath(S,"webix_sparklines_area"+(C?" "+C.area:"")))+o.group(o.getPath(S,"webix_sparklines_line"+(C?" "+C.line:"")))+n._drawItems(o,u,r.radius,"webix_sparklines_item"+(C?" "+C.item:""))+n._drawEventItems(o,u,r.eventRadius);return o.draw(I,e,i,"webix_sparklines_radar_chart"+(r.css?" "+r.css:""))},Bs.prototype._getPositionByAngle=function(t,e,i,s){return t*=-1,{x:e+=Math.cos(t)*s,y:i-=Math.sin(t)*s}},Bs.prototype._getRatios=function(t){for(var e=[],i=0;i<t;i++)e[i]=2*Math.PI*(i/t);return e},Ms.types={},Ms.getTemplate=function(e){var i=e||{};"string"==typeof e&&(i={type:e}),t.extend(i,{type:"line"});var s=this.types[i.type];return f(s,"Unknown sparkline type"),A(this._template,new s(i))},Ms._template=function(t,i,s,n){return n?this.draw(function(t){for(var i=[],s=t.length-1;s>=0;s--){var n=t[s];i[s]="object"===e(n)?n.value:n}return i}(s),n.width,33):this.draw(t.data||t,i.width,i.height)},W("onDataTable",(function(t){t.type.sparklines=Ms.getTemplate()})),Ms.types.area=Is,Ms.types.bar=Ds,Ms.types.line=$s,Ms.types.pie=js,Ms.types.spline=Ns,Ms.types.splineArea=Fs,Ms.types.radar=Bs;var Os={clipboard_setter:function(t){return!0!==t&&1!==t||(t="block"),Pi.init(),this.attachEvent("onSelectChange",this._sel_to_clip),this.attachEvent("onAfterEditStop",(function(t,e){var i=this.getSelectedId(!0);1==i.length&&e.row==i[0].row&&this._sel_to_clip()})),this.attachEvent("onItemClick",(function(){document.activeElement&&this.$view.contains(document.activeElement)&&(Pi.focus(),ni.setFocus(this))})),this.attachEvent("onPaste",this._clip_to_sel),t},templateCopy_setter:le,_sel_to_clip:function(){var t=this;j((function(){if(!(t.$destructed||t.getEditor&&t.getEditor())){var e=t._get_sel_text();Pi.set(e),ni.setFocus(t)}}))},_get_sel_text:function(){var t=[],e=this._settings.templateCopy;return this.mapSelection((function(i,s,n,a){t[a]||(t[a]=[]);var r=e?e(i,s,n):i;return t[a].push(r),i})),1===t.length&&1===t[0].length?t[0][0]:Bi.stringify(t,this._settings.delimiter)},_clip_to_sel:function(t){if(!E(this._paste[this._settings.clipboard])){var e=Bi.parse(t,this._settings.delimiter);this._paste[this._settings.clipboard].call(this,e)}},_paste:{block:function(t){var e=this.mapSelection(null);e&&(this.mapCells(e.row,e.column,t.length,null,(function(e,i,s,n,a){return t[n]&&t[n].length>a?t[n][a]:e})),this.render())},selection:function(t){this.mapSelection((function(e,i,s,n,a){return t[n]&&t[n].length>a?t[n][a]:e})),this.render()},repeat:function(t){this.mapSelection((function(e,i,s,n,a){return(i=t[n%t.length])[a%i.length]})),this.render()},custom:function(){}}},Ls={open:function(t,e){if(t){var i=this.getItem(t);f(i,"Incorrect ID to open: "+t),i.$count&&!i.open&&(this.callEvent("onBeforeOpen",[t])&&(i.open=!0,this.data.callEvent("onStoreUpdated",[t,0,"branch"]),this.callEvent("onAfterOpen",[t])),e&&"0"!=t&&this.open(this.getParentId(t),e))}},close:function(t){if(t){var e=this.getItem(t);e.open&&this.callEvent("onBeforeClose",[t])&&(e.open=!1,this.data.callEvent("onStoreUpdated",[t,0,"branch"]),this.callEvent("onAfterClose",[t]))}},openAll:function(t){this.data.eachSubItem(t||0,(function(t,e){e&&(t.open=!0)})),this.data.refresh()},closeAll:function(t){this.data.eachSubItem(t||0,(function(t,e){e&&(t.open=!1)})),this.data.refresh()},_tree_check_uncheck:function(t,e,i){if(this._settings.threeState)return this._tree_check_uncheck_3(t,null!==e?e:"");var s,n=this.getItem(t),a=i?i.target:null;s=a&&"checkbox"==a.type?!!a.checked:null!==e?e:!n.checked,n.checked=s,this.callEvent("onItemCheck",[t,n.checked,i])},isBranchOpen:function(t){if("0"==t)return!0;var e=this.getItem(t);return!!e.open&&this.isBranchOpen(e.$parent)},getOpenItems:function(){var t=[];for(var e in this.data.branch)this.exists(e)&&this.getItem(e).open&&t.push(e);return t},getState:function(){return{open:this.getOpenItems(),select:this.getSelectedId(!0)}},_repeat_set_state:function(t,e){var i=this.data.attachEvent("onStoreLoad",(function(){t.setState.call(t,e),t.data.detachEvent(i),t=null}))},setState:function(t){if(t.open){this.closeAll();for(var e=t.open,i=0;i<e.length;i++){var s=this.getItem(e[i]);if(s&&s.$count&&(s.open=!0,-1==s.$count))return this._repeat_set_state(this,t),this.refresh(),0}this.refresh()}if(t.select&&this.select){var n=t.select;this.unselect();for(var a=0;a<n.length;a++)this.exists(n[a])&&this.select(n[a],!0)}return 1}},Rs={webix_tree_open:function(t,e){return this.close(e),!1},webix_tree_close:function(t,e){return this.open(e),!1},webix_tree_checkbox:function(t,e){return this._tree_check_uncheck(e,null,t),!1}},zs={$init:function(){this.data.attachEvent("onStoreUpdated",A(this._sync_hierarchy,this),null,!0),this._feed_common=this._feed_commonA},_feed_commonA:function(t,e,i,s,n,a){return n=0===e?{parent:encodeURIComponent(t)}:null,Gi.prototype._feed_common.call(this,t,e,i,s,n,a)},loadBranch:function(t,e,i){return t=t||0,this.data.url=i||this.data.url,this.callEvent("onDataRequest",[t,e,this.data.url])&&this.data.url?this.data.feed.call(this,t,0,e):d.reject()},_sync_hierarchy:function(t,e,i){i&&"add"!=i&&"delete"!=i&&"branch"!=i||this.data._sync_to_order(this)}},Hs={$init:function(){f(this.data,"DataMove :: Component doesn't have DataStore")},copy:function(t,e,i,s){return(s=s||{}).copy=!0,this.move(t,e,i,s)},_next_move_index:function(t,e,i){if(e&&t){var s=this.getBranchIndex(t);return s+(i==this&&this.getParentId(t)==this.getParentId(e)&&i.getBranchIndex(e)<s?0:1)}},_check_branch_child:function(t,e){var i=this.data.branch[t];if(i&&i.length)for(var s=0;s<i.length;s++){if(i[s]==e)return!0;if(this._check_branch_child(i[s],e))return!0}return!1},_remove_childs:function(t){for(var e=0;e<t.length;e++)for(var i=t[e];this.getParentId(i);)i=this.getParentId(i),-1==L.find.call(t,i)||(t.splice(e,1),e--);return t},move:function(t,e,i,s){e=e||0;var n=(s=s||{}).newId||t,a=s.parent||0;if(f((i=i||this).data,"moving attempt to component without datastore"),i.data){if(!B(t)){var r=t,o=this.getItem(t);if(f(o,"Incorrect ID in TreeDataMove::move"),this!=i||s.copy){if(r=i.data.add(i._externalData(o,n),e,a||0),this.data.branch[t]&&i.getBranchIndex){var l=this.data._scheme_serialize;this.data._scheme_serialize=function(t){var e=I(t);return delete e.$parent,delete e.$level,delete e.$child,i.data.pull[e.id]&&(e.id=T()),e};var h={data:this.serialize(t,!0),parent:r};this.data._scheme_serialize=l,i.parse(h)}s.copy||this.data.remove(t)}else{if(t==a||this._check_branch_child(t,a))return;var c=this.data.branch[a];c||(c=this.data.branch[a]=[]);var d=this.data.branch[o.$parent],u=L.find.call(d,t);if(e<0&&(e=c.length),d===c&&e===u)return r;if(L.removeAt.call(d,u),L.insertAt.call(c,t,Math.min(c.length,e)),d.length||delete this.data.branch[o.$parent],o.$parent&&"0"!=o.$parent&&this.getItem(o.$parent).$count--,a&&"0"!=a){var _=i.getItem(a);_.$count++,this._set_level_rec(o,_.$level+1)}else this._set_level_rec(o,1);o.$parent=a,i.data.callEvent("onDataMove",[t,e,a,c[e+1]])}return this.refresh(),r}this._remove_childs(t);for(var p=0;p<t.length;p++){var g=this.move(t[p],e,i,s);e=i._next_move_index(g,t[p+1],this)}}},_set_level_rec:function(t,e){t.$level=e;var i=this.data.branch[t.id];if(i)for(var s=0;s<i.length;s++)this._set_level_rec(this.getItem(i[s]),e+1)},moveUp:function(t,e){var i=this.getBranchIndex(t)-(e||1);return this.move(t,i<0?0:i,this,{parent:this.data.getParentId(t)})},moveDown:function(t,e){return this.moveUp(t,-1*(e||1))},moveTop:function(t,e){return e=E(e)?this.getParentId(t):e,this.move(t,0,this,{parent:e})},moveBottom:function(t,e){e=E(e)?this.getParentId(t):e;var i=this.isBranch(e)?this.data.branch[e].length:0;return this.move(t,i,this,{parent:e})},_drag_pause:function(t){t&&!t.header&&this.exists(t)&&this._target_to_id(t)!=Ai._drag_context.start&&this.open(t)},$dropAllow:function(t){if(t.from!=t.to)return!0;for(var e=0;e<t.source.length;e++)if(this._check_branch_child(t.source,t.target))return!1;return!0},_externalData:function(t,e){var i=zi._externalData.call(this,t,e);return delete i.open,i}},qs={$init:function(){f(this.render,"TreeRenderStack :: Object must use RenderStack first")},_toHTMLItem:function(t){var e=this.data._marks[t.id];return this.callEvent("onItemRender",[t]),this.type.templateStart(t,this.type,e)+(t.$template?this.type["template"+t.$template](t,this.type,e):this.type.template(t,this.type,e))+this.type.templateEnd()},_toHTMLItemObject:function(t){return this._html.innerHTML=this._toHTMLItem(t),this._html.firstChild},_toHTML:function(t){f(!t.$template||this.type["template"+t.$template],"RenderStack :: Unknown template: "+t.$template);var e="<div role='presentation' class='webix_tree_branch_"+t.$level+"'>"+this._toHTMLItem(t);return t.open&&(e+=this._toHTMLLevel(t.id)),e+"</div>"},_toHTMLLevel:function(t){var e="",i=this.data.branch[t];if(i){e+="<div role='presentation' class='webix_tree_leaves'>";for(var s=i.length-1,n=0;n<=s;n++){var a=this.getItem(i[n]),r=this.type._tree_branch_render_state;0!==r&&(r[a.$level]=n==s),e+=this._toHTML(a)}e+="</div>"}return e},render:function(t,e,i){if(qs._obj=this,this.isVisible(this._settings.id)&&!this.$blockRender){if(t){var s,n,a=this.getItem(t);if("add"!=i&&!(s=this.getItemNode(t)))return;switch(i){case"branch":var r=s.parentNode;yt(n=this._toHTMLObject(a),r),wt(r),this._htmlmap=null;break;case"paint":case"update":yt(n=this._htmlmap[t]=this._toHTMLItemObject(a),s),wt(s);break;case"delete":wt(s.parentNode);break;case"add":var o;if(0==a.$parent)o=this._dataobj.firstChild;else if(this.getItem(a.$parent).open&&(o=this.getItemNode(a.$parent))){if(!o.nextSibling){var l=vt("DIV",{class:"webix_tree_leaves"},"");o.parentNode.appendChild(l)}o=o.nextSibling}if(o){var h=this.data.getNextSiblingId(t);(h=this.getItemNode(h))&&(h=h.parentNode),n=this._toHTMLObject(a),this._htmlmap[t]=n.firstChild,yt(n,h,o)}break;default:return!1}this.callEvent("onPartialRender",[t,e,i])}else this.callEvent("onBeforeRender",[this.data])&&(this.type._tree_branch_render_state=[],this._dataobj.innerHTML=this._toHTMLLevel(0),this._htmlmap=null,this.callEvent("onAfterRender",[]));return this.type._tree_branch_render_state=0,qs._obj=null,!0}},getItemNode:function(t){if(this._htmlmap)return this._htmlmap[t];this._htmlmap={};for(var e=this._dataobj.getElementsByTagName("DIV"),i=0;i<e.length;i++){var s=e[i].getAttribute(this._id);s&&(this._htmlmap[s]=e[i])}return this.getItemNode(t)},_branch_render_supported:1},Us={_init_render_tree_state:function(){if(this._branch_render_supported){var t=this.render;this.render=function(e,i){var s=t.apply(this,arguments);this._settings.threeState&&s&&"checkbox"!=i&&this._setThirdState.apply(this,arguments)},this._init_render_tree_state=function(){}}},threeState_setter:function(t){return t&&this._init_render_tree_state(),t},_setThirdState:function(t){var e,i,s,n,a;if(s=[],a=this,t&&!a.data.pull[t]&&(t=0),!t||a.data.pull[t].$count)for((i=this._getAllLeaves(t)).sort((function(t,e){return a.data.pull[e].$level-a.data.pull[t].$level})),e=0;e<i.length;e++)e&&a.data.pull[i[e]].$parent==a.data.pull[i[e-1]].$parent||(s=s.concat(a._setParentThirdState(i[e])));else s=s.concat(a._setParentThirdState(t));for(n={},e=0;e<s.length;e++)n[s[e]]||(n[s[e]]=1,this._setCheckboxIndeterminate(s[e]));a=null},_setCheckboxIndeterminate:function(t){var e;this.getItemNode(t)&&(this.render(t,"checkbox","update"),this.getItem(t).indeterminate&&(e=this.getItemNode(t).getElementsByTagName("input")[0])&&(e.indeterminate=this.getItem(t).indeterminate))},_setParentThirdState:function(t){var e,i,s,n,a,r,o;for(n=this.getParentId(t),a=[];n&&"0"!=n;){r=0,i=0,this.data.eachChild(n,(function(t){t.indeterminate?r++:t.checked&&i++})),e=s=o=!1;var l=this.getItem(n);i==l.$count?e=!0:(i>0||r>0)&&(s=!0),(s||s!=l.indeterminate)&&(o=!0),l.indeterminate=s,(e||l.checked!=e)&&(o=!0),l.checked=e,o?(a.push(n),n=this.getParentId(n)):n=0}return a},getChecked:function(){var t=[],e=this;return this.data.eachSubItem(0,(function(i){e.isChecked(i.id)&&t.push(i.id)})),t},_tree_check_uncheck_3:function(t,e){var i=this.getItem(t);if(i&&(""===e&&(e=!i.checked),i.checked!=e||i.indeterminate)){i.checked=e,this._correctThreeState(t);var s=this._setParentThirdState(t);if(this._branch_render_supported&&s.length<5)for(var n=0;n<s.length;n++)this._setCheckboxIndeterminate(s[n]);else this.refresh();this.callEvent("onItemCheck",[t,e])}},checkItem:function(t){this._tree_check_uncheck(t,!0),this.updateItem(t)},uncheckItem:function(t){this._tree_check_uncheck(t,!1),this.updateItem(t)},_checkUncheckAll:function(t,e,i){var s=e?"checkItem":"uncheckItem";t?this[s](t):t=0,this._settings.threeState?t||this.data.eachChild(0,(function(t){this[s](t.id)}),this,i):this.data.each((function(t){this[s](t.id)}),this,i,t)},checkAll:function(t,e){this._checkUncheckAll(t,!0,e)},uncheckAll:function(t,e){this._checkUncheckAll(t,!1,e)},_correctThreeState:function(t){var e,i=this.getItem(t);i.indeterminate=!1,e=i.checked,this.data.eachSubItem(t,(function(t){t.indeterminate=!1,t.checked=e})),this._branch_render_supported&&this.isBranchOpen(i.$parent)&&this.render(t,0,"branch")},isChecked:function(t){return this.getItem(t).checked},_getAllLeaves:function(t){var e=[];return this.data.eachSubItem(t,(function(t,i){i||e.push(t.id)})),e}},Ws={name:"TreeStore",$init:function(){this._filterMode={showSubItems:!0},this.branch={0:[]},this.attachEvent("onParse",(function(t){this._set_child_scheme(t.child)})),this.attachEvent("onClearAll",A((function(){this._filter_branch=null}),this))},filterMode_setter:function(e){return t.extend(this._filterMode,e,!0)},_filter_reset:function(t){if(this._filter_branch&&!t){for(var e in this.branch=this._filter_branch,this.order=O(I(this.branch[0])),this.branch)"0"!=e&&(this.getItem(e).$count=this.branch[e].length);delete this._filter_branch}},_filter_core:function(t,e,i,s){i&&this._filter_branch||(this._filter_branch=this.branch,this.branch=S(this.branch)),this.branch[0]=this._filter_branch_rec(t,e,this.branch[0],1,s||{})},_filter_branch_rec:function(t,e,i,s,n){for(var a=[],r=n.level&&n.level!=s,o=0;o<i.length;o++){var l=i[o],h=this.getItem(l),c=!1,d=this.branch[l];if(r)c=!0;else if(t(this.getItem(l),e)){if(a.push(l),!1!==n.openParents)for(var u=this.getParentId(l);u&&"0"!=u;)this.getItem(u).open=1,u=this.getParentId(u);if(n.level||n.showSubItems)continue}else c=!0;if((r||!n.level)&&d){var _=this.branch[l]=this._filter_branch_rec(t,e,d,s+1,n);h.$count=_.length,c&&_.length&&a.push(l)}}return a},count:function(){if(this.order.length)return this.order.length;var t=0;return this.eachOpen((function(){t++})),t},_change_branch_id:function(t,e,i,s){if(t[i]){for(var n=t[s]=t[i],a=0;a<n.length;a++)this.getItem(n[a]).$parent=s;delete t[i]}if(t[e]){var r=L.find.call(t[e],i);r>=0&&(t[e][r]=s)}},changeId:function(t,e){if(t!=e){var i=this.getItem(t).$parent;return this._change_branch_id(this.branch,i,t,e),this._filter_branch&&this._change_branch_id(this._filter_branch,i,t,e),Yi.prototype.changeId.call(this,t,e)}},clearAll:function(t){this.branch={0:[]},Yi.prototype.clearAll.call(this,t)},getPrevSiblingId:function(t){var e=this.branch[this.getItem(t).$parent],i=L.find.call(e,t)-1;return i>=0?e[i]:null},getNextSiblingId:function(t){var e=this.branch[this.getItem(t).$parent],i=L.find.call(e,t)+1;return i<e.length?e[i]:null},getParentId:function(t){return this.getItem(t).$parent},getFirstChildId:function(t){var e=this.branch[t];return e&&e.length?e[0]:null},isBranch:function(t){return!!this.branch[t]},getBranchIndex:function(t){var e=this.branch[this.pull[t].$parent];return L.find.call(e,t)},_set_child_scheme:function(t){this._datadriver_child="string"==typeof t?function(e){var i=e[t];return i&&delete e[t],i}:t},_inner_parse:function(e,i){for(var s=e.parent||0,n=0;n<i.length;n++){var a=this.driver.getDetails(i[n]),r=this.id(a),o=!!this.pull[r];o?(a=t.extend(this.pull[r],a,!0),this._scheme_update&&this._scheme_update(a)):(this._scheme_init&&this._scheme_init(a),this.pull[r]=a),this._extraParser(a,s,0,o,e.from?1*e.from+n:0)}var l=this.pull[s]||{},h=this.branch[s]||[];l.$count=h.length,delete l.webix_kids,e.size&&e.size!=h.length&&(h[e.size-1]=void 0)},_extraParser:function(e,i,s,n,a){e.$count=0,e.$parent="0"!=i?i:0,e.$level=s||("0"!=i?this.pull[i].$level+1:1);var r=this.branch[e.$parent];r||(r=this.branch[e.$parent]=[]),this._filter_branch&&(this._filter_branch[e.$parent]=r),n||(r[a||r.length]=e.id);var o=this._datadriver_child(e);if(e.webix_kids)return e.$count=-1;if(!o)return e.$count=0;B(o)||(o=[o]);for(var l=0;l<o.length;l++){var h=Xt.json.getDetails(o[l]),c=this.id(h);(n=!!this.pull[c])?(h=t.extend(this.pull[c],h,!0),this._scheme_update&&this._scheme_update(h)):(this._scheme_init&&this._scheme_init(h),this.pull[c]=h),this._extraParser(h,e.id,e.$level+1,n)}var d=this.branch[e.id];d&&(e.$count=d.length)},_sync_to_order:function(t){this.order=O(),this._sync_each_child(this.order,0,t)},_sync_each_child:function(t,e,i){for(var s=this.branch[e],n=0;n<s.length;n++){var a=s[n];t.push(a);var r=this.pull[a];r&&r.open&&(-1==r.$count?i.loadBranch(a):r.$count&&this._sync_each_child(t,a,i))}},provideApi:function(t,e){for(var i=["getPrevSiblingId","getNextSiblingId","getParentId","getFirstChildId","isBranch","getBranchIndex","filterMode_setter"],s=0;s<i.length;s++)t[i[s]]=this._methodPush(this,i[s]);t.getIndexById||Yi.prototype.provideApi.call(this,t,e)},getTopRange:function(){return O([].concat(this.branch[0])).map((function(t){return this.getItem(t)}),this)},eachChild:function(t,e,i,s){var n=this.branch;s&&this._filter_branch&&(n=this._filter_branch);var a=n[t];if(a)for(var r=0;r<a.length;r++)a[r]&&e.call(i||this,this.getItem(a[r]))},each:function(t,e,i,s){this.eachChild(s||0,(function(s){var n=this.branch;t.call(e||this,s),i&&this._filter_branch&&(n=this._filter_branch),s&&n[s.id]&&this.each(t,e,i,s.id)}),this,i)},eachOpen:function(t,e,i){this.eachChild(i||0,(function(i){t.call(e||this,i),this.branch[i.id]&&i.open&&this.eachOpen(t,e,i.id)}))},eachSubItem:function(t,e){var i=this.branch[t||0];if(i)for(var s=0;s<i.length;s++){var n=i[s];this.branch[n]?(e.call(this,this.getItem(n),!0),this.eachSubItem(n,e)):e.call(this,this.getItem(n),!1)}},eachLeaf:function(t,e){var i=this.branch[t||0];if(i)for(var s=0;s<i.length;s++){var n=i[s];this.branch[n]?this.eachLeaf(n,e):e.call(this,this.getItem(n),!1)}},_sort_core:function(t,e,i){for(var s in i=i||this.branch){for(var n=i[s],a=[],r=n.length-1;r>=0;r--)a[r]=this.pull[n[r]];a.sort(t),i[s]=a.map((function(t){return t.id}))}return e},add:function(t,e,i){var s=!1,n=this.getItem(i||0);if(n&&(this.branch[n.id]||(s=!0),n.$count++,n.$count||(n.$count=1)),this.branch[i||0]=this.order=O(this.branch[i||0]),t.$count=t.webix_kids?-1:0,t.$level=n?n.$level+1:1,t.$parent=n?n.id:0,this._filter_branch){var a=this._filter_branch[i||0];if(a||(a=this._filter_branch[i]=this.order),this.order!==a){var r=a.length;!e&&this.branch[i||0].length&&(r=0),a=O(a),t.id=t.id||T(),a.insertAt(t.id,r)}}var o=Yi.prototype.add.call(this,t,e);return s&&this.refresh(i),o},_rec_remove:function(t){var e=this.pull[t];if(this.branch[e.id]&&this.branch[e.id].length>0)for(var i=this.branch[t],s=0;s<i.length;s++)this._rec_remove(i[s],!0);delete this.branch[t],this._filter_branch&&delete this._filter_branch[t],delete this.pull[t],this._marks[t]&&delete this._marks[t]},_filter_removed:function(t,e,i){var s=t[e];1==s.length&&s[0]==i&&e?delete t[e]:O(s).remove(i)},remove:function(t){if(B(t))for(var e=0;e<t.length;e++)this.remove(t[e]);else{f(this.exists(t),"Not existing ID in remove command"+t);var i=this.pull[t],s=i.$parent||0;if(!1===this.callEvent("onBeforeDelete",[t]))return!1;this._rec_remove(t),this.callEvent("onAfterDelete",[t]);var n=this.pull[s];this._filter_removed(this.branch,s,t),this._filter_branch&&this._filter_removed(this._filter_branch,s,t);var a=0;n&&(n.$count--,n.$count<=0&&(n.$count=0,n.open=0,a=1)),this.callEvent("onStoreUpdated",[t,i,"delete"]),a&&this.refresh(n.id)}},getBranch:function(t){var e=[],i=(this._filter_branch||this.branch)[t];if(i)for(var s=0;s<i.length;s++)e[s]=this.pull[i[s]];return e},serialize:function(t,e){var i=this.branch;e&&this._filter_branch&&(i=this._filter_branch);for(var s=i[t||0],n=[],a=0;a<s.length;a++){var r,o=this.pull[s[a]];if(this._scheme_serialize){if(!1===(r=this._scheme_serialize(o)))continue}else r=I(o);i[o.id]&&(r.data=this.serialize(o.id,e)),n.push(r)}return n}},Ys={insert:function(t){for(var e=this.getSelectedId(!0,!0),i=0;i<t.length;i++){for(var s={},n=0;n<this._settings.columns.length;n++)s[this._settings.columns[n].id]=t[i][n]||"";!E(s.id)&&this.exists(s.id)&&(s.id=T()),this.add(s,null,e[0])}}},Gs={space:function(t){for(var e="",i=1;i<t.$level;i++)e+="<div class='webix_tree_none'></div>";return e},icon:function(t){return t.$count?t.open?"<div class='webix_tree_open'></div>":"<div class='webix_tree_close'></div>":"<div class='webix_tree_none'></div>"},checkbox:function(t){return t.nocheckbox?"":"<input type='checkbox' class='webix_tree_checkbox' "+(t.checked?"checked":"")+(t.disabled?" disabled":"")+">"},folder:function(t){return t.icon?"<div class='webix_tree_file webix_tree_"+t.icon+"'></div>":t.$count?t.open?"<div class='webix_tree_folder_open'></div>":"<div class='webix_tree_folder'></div>":"<div class='webix_tree_file'></div>"}},Ks={$render:function(){if(this._upload_area)this._contentobj.firstChild.appendChild(this._upload_area);else{this.files.attachEvent("onBeforeDelete",this._stop_file);var t={type:"file",class:"webix_hidden_upload",tabindex:-1};this._settings.accept&&(t.accept=this._settings.accept),this._settings.multiple&&(t.multiple="true"),this._settings.directory&&(t.webkitdirectory="true",t.mozdirectory="true",t.directory="true");var e=vt("input",t);this._upload_area=this._contentobj.firstChild.appendChild(e),_e(this._viewobj,"drop",A((function(t){this.$drop(t),St(t)}),this)),_e(e,"change",A((function(){if(this._add_files(e.files),Ot.isIE){var t=document.createElement("form");t.appendChild(this._upload_area),t.reset(),this._contentobj.firstChild.appendChild(e)}else e.value=""}),this)),_e(this._viewobj,"click",A((function(){new Date-(this._upload_timer_click||0)>250&&this.fileDialog()}),this)),_e(this._viewobj,"dragenter",St),_e(this._viewobj,"dragexit",St),_e(this._viewobj,"dragover",St)}},_directoryEntry:function(t){return t.isDirectory},_directoryDrop:function(t,e,i){t.isFile?t.file((function(t){e.addFile(t,null,null,{name:i+"/"+t.name})})):t.isDirectory&&t.createReader().readEntries((function(s){for(var n=0;n<s.length;n++)e._directoryDrop(s[n],e,(i?i+"/":"")+t.name)}))},$drop:function(t){var e=t.dataTransfer.files,i=t.dataTransfer.items;if(e.length){if(this.callEvent("onBeforeFileDrop",[e,t])){i=i||e;for(var s=0;s<i.length;s++){var n=i[s];n.webkitGetAsEntry&&(n=n.webkitGetAsEntry()).isDirectory?this._directoryDrop(n,this,""):this.addFile(e[s])}}this.callEvent("onAfterFileDrop",[e,t])}},fileDialog:function(t){this._upload_timer_click=new Date,this._last_file_context=t;var e=this._viewobj.getElementsByTagName("INPUT");e[e.length-1].click()},send:function(e){if("function"==typeof e&&(this._last_assigned_upload_callback=e,e=0),e){var i=this.files.getItem(e);if("client"!==i.status)return!1;f(this._settings.upload,"You need to define upload url for uploader component"),i.status="transfer";var s=new FormData;s.append(this.config.inputName,i.file,i.name),s.append(this.config.inputName+"_fullpath",i.name);var n={},a=this._settings.formData||{};"function"==typeof a&&(a=a.call(this));var r=t.extend(i.formData||{},a),o=new XMLHttpRequest,l=this._get_active_url(i);if(U("onBeforeAjax",["POST",l,r,o,n,s])){for(var h in r)s.append(h,r[h]);for(var c in i.xhr=o,o.upload.addEventListener("progress",A((function(t){this.$updateProgress(e,t.loaded/t.total*100)}),this),!1),o.onload=A((function(){o.aborted||this._file_complete(e)}),this),o.open("POST",l,!0),n)o.setRequestHeader(c,n[c]);o.send(s)}return this.$updateProgress(e,0),!0}var d=this.files.data.order,u=!0;if(d.length)for(var _=0;_<d.length;_++)u=!this.send(d[_])&&u;u&&this._upload_complete()},_file_complete:function(t){var e=this.files.getItem(t);if(e){var i=null;if(e.xhr.status<400){var s=Xt[this._settings.datatype||"json"];(i=s.toObject(e.xhr.responseText))&&(i=s.getDetails(i))}i&&"error"!=i.status?(f(!i.status||"server"==i.status,"Not supported status value, use 'error' or 'server'"),this._complete(t,i)):(e.status="error",delete e.percent,this.files.updateItem(t),this.callEvent("onFileUploadError",[e,i])),delete e.xhr}},stopUpload:function(t){A(this._stop_file,this.files)(t)},_stop_file:function(t){var e=this.getItem(t);void 0!==e.xhr&&(e.xhr.aborted=!0,e.xhr.abort(),delete e.xhr,e.status="client")}},Xs={_validate_init_once:function(){this.data.attachEvent("onStoreUpdated",A((function(t,e,i){!t||"add"!=i&&"update"!=i&&"save"!=i||this.validate(t)}),this)),this.data.attachEvent("onClearAll",A(this.clearValidation,this)),this._validate_init_once=function(){}},rules_setter:function(t){return t&&this._validate_init_once(),t},clearValidation:function(){this.data.clearMark("webix_invalid",!0)},validate:function(t){var e=!0;if(t){this._validate_details={};var i=this.getItem(t);(e=Hi.validate.call(this,null,i))?this.callEvent("onValidationSuccess",[t,i])&&this._clear_invalid(t):this.callEvent("onValidationError",[t,i,this._validate_details])&&this._mark_invalid(t,this._validate_details)}else for(var s in this.data.pull)e=this.validate(s)&&e;return e},_validate:function(t,e,i,s){"string"==typeof t&&(t=Oe[t]);var n=t.call(this,e,i,s);return n||(this._validate_details[s]=!0),n},_clear_invalid:function(t){this.data.removeMark(t,"webix_invalid",!0)},_mark_invalid:function(t){this.data.addMark(t,"webix_invalid",!0)}},Js={$init:function(){this.elements={}},focus:function(t){if(t)f(this.elements[t],"unknown input name: "+t),this._focus(this.elements[t]);else for(var e in this.elements)if(!1!==this._focus(this.elements[e]))return!0;return!1},_focus:function(t){return!(!t||!t.focus)&&t.focus()},setValues:function(t,e,i){var s=this;this._settings.complexData&&(t=Qt.collapseNames(t,"",{},(function(t){return!s.elements[t]}))),this._inner_setValues(t,e,i)},_inner_setValues:function(t,e,i){for(var s in this._is_form_dirty=e,this.blockEvent(),e&&this._values||(this._values={}),t)this.elements[s]||(this._values[s]=t[s]);for(var n in this.elements){var a=this.elements[n];a&&(E(t[n])?!e&&a.$allowsClear&&a.setValue("",i):a.setValue(t[n],i),this._values[n]=a.getValue())}this.unblockEvent(),this.callEvent("onValues",[])},isDirty:function(){return!!this._is_form_dirty||!0===this.getDirtyValues(!0)},setDirty:function(t){this._is_form_dirty=t,t||(this._values=this._inner_getValues())},getDirtyValues:function(){var t={};if(this._values)for(var e in this.elements){var i=this.elements[e],s=i.getValue(),n=this._values[e];if((i.$compareValue?!i.$compareValue(n,s):n!=s)&&(t[e]=s,arguments[0]))return!0}return t},getCleanValues:function(){return this._values},getValues:function(t){var e=this._inner_getValues(t);return this._settings.complexData&&(e=Qt.expandNames(e)),e},_inner_getValues:function(t){var i,s=null,n=this._values?I(this._values):{};for(var a in this.elements)s=this.elements[a],i=!0,t&&("object"==e(t)?(!1===t.hidden&&(i=s.isVisible()),i&&!1===t.disabled&&(i=s.isEnabled())):i=t.call(this,s)),i?n[a]=s.getValue():delete n[a];return n},clear:function(t){this._is_form_dirty=!1;var e={};for(var i in this.elements)this.elements[i].$allowsClear&&(e[i]="");this._inner_setValues(e,!1,t)},markInvalid:function(t,e){if(!1===e)this._clear_invalid(t);else{var i;if("string"==typeof e){var s=this.elements[t];s&&s._settings.invalidMessage!=e&&(s._settings.invalidMessage=e,i=!0)}this._validate_details&&(this._validate_details[t]=!0),this._mark_invalid(t,i)}},_mark_invalid:function(t,e){var i=this.elements[t];if(i){var s=i._settings,n=!s.invalid;(n||e)&&(n&&(Dt(i._viewobj,"webix_invalid",!0),s.invalid=!0),"string"==typeof s.invalidMessage&&i.setBottomText&&i.setBottomText())}},_clear_invalid:function(t){var e=this.elements[t];e&&e._settings.invalid&&(Et(e._viewobj,"webix_invalid"),e._settings.invalid=!1,"string"==typeof e._settings.invalidMessage&&e.setBottomText&&e.setBottomText())}},Zs={$init:function(){f(this.render,"VirtualRenderStack :: Object must use RenderStack first"),this._htmlmap={},_e(this._viewobj,"scroll",A(this._render_visible_rows,this)),this._unrendered_area=[]},getItemNode:function(t){return this._htmlmap[t]},showItem:function(t){var e=this._getVisibleRange(),i=this.data.getIndexById(t),s=Math.floor(i/e._dx)*e._y,n=this.getScrollState();(s<n.y||s+this._settings.height>=n.y+this._content_height)&&this.scrollTo(0,s)},render:function(t,e,i){if(this.isVisible(this._settings.id)&&!this.$blockRender)if(t){var s=this.getItemNode(t);if("update"===i){if(!s)return;yt(this._htmlmap[t]=this._toHTMLObject(e),s),wt(s)}else this._render_delayed()}else this.callEvent("onBeforeRender",[this.data])&&(this._htmlmap={},this._render_visible_rows(null,!0),this._wait_for_render=!1,this.callEvent("onAfterRender",[]))},_render_delayed:function(){this._wait_for_render||(this._wait_for_render=!0,window.setTimeout(A((function(){this.render()}),this),1))},_create_placeholder:function(t){Ot.maxHTMLElementSize&&(t=Math.min(Ot.maxHTMLElementSize,t));var e=document.createElement("DIV");return e.style.cssText="height:"+t+"px; width:100%; overflow:hidden;",e},_render_visible_rows:function(t,e){this._unrendered_area=[];var i=this._getVisibleRange();this._dataobj.firstChild&&!e||(this._dataobj.innerHTML="",this._dataobj.appendChild(this._create_placeholder(i._max)),this._htmlrows=[this._dataobj.firstChild]);for(var s=i._from;s<=i._height;){for(;this._htmlrows[s]&&this._htmlrows[s]._filled&&s<=i._height;)s++;if(s>i._height)break;for(var n=s;!this._htmlrows[n];)n--;var a=this._htmlrows[n],r=s*i._dx+(this.data.$min||0);if(r>(this.data.$max||1/0))break;var o=Math.min(r+i._dx-1,this.data.$max?this.data.$max-1:1/0),l=this._create_placeholder(i._y),h=this.data.getIndexRange(r,o);if(!h.length)break;for(var c={$template:"Loading"},d=0;d<h.length;d++)h[d]||this._unrendered_area.push(r+d),h[d]=this._toHTML(h[d]||c);l.innerHTML=h.join("");for(var u=0;u<h.length;u++)this._htmlmap[this.data.getIdByIndex(r+u)]=l.childNodes[u];var _=parseFloat(a.style.height,10),p=(s-n)*i._y,f=_-p-i._y;yt(l,p?a.nextSibling:a,this._dataobj),this._htmlrows[s]=l,l._filled=!0,p<=0&&f>0?(a.style.height=f+"px",this._htmlrows[s+1]=a):(p<0?wt(a):a.style.height=p+"px",f>0&&yt(this._htmlrows[s+1]=this._create_placeholder(f),l.nextSibling,this._dataobj)),s++}if(this._unrendered_area.length){var g=this._unrendered_area[0],m=this._unrendered_area.pop()+1;if(m>g){var v=m-g;if(this._maybe_loading_already(v,g))return;v=Math.max(v,this._settings.datafetch||this._settings.loadahead||0),this.loadNext(v,g)}}},_getVisibleRange:function(){var t=this.getScrollState(),e=Math.max(0,t.y),i=this._tilesPadding||0,s=this._content_width-i,n=this._content_height-i/2,a=this.type,r=Math.floor(s/a.width)||1,o=Math.floor(e/a.height),l=Math.ceil((n+e)/a.height)-1,h=this.data.$max?this.data.$max-this.data.$min:this.data.count();return{_from:o,_height:l,_top:e,_max:Math.ceil(h/r)*a.height,_y:a.height,_dx:r}},_cellPosition:function(t){var e=this.getItemNode(t);return e||(this.showItem(t),this._render_visible_rows(),e=this.getItemNode(t)),{left:e.offsetLeft,top:e.offsetTop,height:e.offsetHeight,width:e.offsetWidth,parent:this._contentobj}}},Qs={$init:function(){this._htmlmap={},_e(this._viewobj,"scroll",A((function(){this.render(null,null,"paint")}),this))},getItemNode:function(t){return this._htmlmap&&this._htmlmap[t]},showItem:function(t){var e=this.data.getIndexById(t);if(e>-1){var i=e*this.type.height,s=i+this.type.height,n=this.getScrollState(),a=kt(this.$view);i<n.y?this.scrollTo(0,i):s>n.y+a.height&&this.scrollTo(0,s-a.height)}},render:function(t,e,i){if(this.isVisible(this._settings.id)&&!this.$blockRender){var s=this._renderobj||this._dataobj;if(!t||"paint"!=i&&"update"!=i){var n,a,r=this._marked_item_id;if(Ai.active&&"drag-end"!=i){var o=Ai.getContext();a=(n=this._init_drop_area&&o.from===this)&&O(I(o.source||[]))}if(("paint"!=i||n)&&(this._htmlmap={},s.innerHTML=""),this.callEvent("onBeforeRender",[this.data])){var l=this.data.count(),h=this.getScrollState(),c=kt(this._viewobj),d=Math.floor(h.y/this.type.height)-2,u=Math.ceil((h.y+c.height)/this.type.height)+2;d=Math.max(0,d),u=Math.min(l-1,u+(n?a.length-1:0));for(var _=[],p=d;p<=u;p++){var f=this.data.order[p];if(n&&-1!==a.find(f))f==r&&(r=this.data.order[p+1]);else if(this._htmlmap[f])_.push('<div webix_skip="true" '.concat(this._id,'="').concat(f,'"></div>'));else{var g=this.data.getItem(f);if(!g){this._run_load_next({count:u-p+(this._settings.loadahead||0),start:p});break}_.push(this._toHTML(g))}}if(this._html.innerHTML=_.join(""),this._init_drop_area&&"drag-in"==i){var m=this._html.querySelector("[".concat(this._id,'="').concat(r,'"]'));m?this._html.insertBefore(Ai._dropHTML[0],m):this._html.appendChild(Ai._dropHTML[0])}s.style.position="relative",s.style.height=l*this.type.height+"px";for(var v=this._html.childNodes,b=v.length-1;b>=0;b--){var w=v[b];if(!w.getAttribute("webix_skip")){var y=w.getAttribute(this._id);y&&(w.style.position="absolute",w.style.top=(d+b)*this.type.height+"px",w.style.left=0,w.style.width="100%",s.appendChild(w),this._htmlmap[y]=w)}}this.callEvent("onAfterRender",[])}}else{var x=this.getItemNode(t);if(x){var k=this._htmlmap[t]=this._toHTMLObject(e);return k.style.top=x.style.top,k.style.position="absolute",k.style.left=0,k.style.width="100%",yt(k,x),void wt(x)}}}},$setSize:function(){mi.api.$setSize.apply(this,arguments)&&this.render(null,null,"paint")},_run_load_next:function(t){var e=Math.max(t.count,this._settings.datafetch||this._settings.loadahead||0);this._maybe_loading_already(t.count,t.start)||this.loadNext(e,t.start)},_set_drop_area:function(){this.render(null,null,"drag-in")},_remove_drop_area:function(){wt(Ai._dropHTML),this.render(null,null,"drag-out")}},tn="non-existing view for export";function en(t,e,i){return!i&&e.format?function(i){return e.format(i[t])}:function(e){return e[t]}}function sn(t,e){var i=e.text;if(e.contentId){var s=t.getHeaderContent(e.contentId);s&&!s.type.$icon&&(i=s.getValue(!0))}return(i||"").toString().replace(/<[^>]*>/gi,"")}function nn(t,e,i){return i[t]&&i[t][e]?i[t][e]:{}}function an(e,i){var s,n=[],a=0,r=0,o=e.getColumnConfig,l=i.columns,h=!!i.rawValues,c="TreeStore"==e.data.name,d=i.treeLines;if((!0===d||E(d))&&(d="value"),n.heights={},(i.hidden||i.hide)&&(n.hiddenCols={},n.hiddenRows={}),l){if(!l.length){var u=[];for(var _ in l)u.push(t.extend({id:_},t.extend({},l[_])));l=u}}else if(l=[],o){var p=e._hidden_column_order;if(i.hidden&&p.length)for(var f=0;f<p.length;f++){var g=e.getColumnConfig(p[f]);e.isColumnVisible(g.id)||(n.hiddenCols[g.id]=1),l.push(g)}else l=l.concat(e._columns)}else{var m=e.data.pull[e.data.order[0]];for(var v in m)"id"!==v&&"$"!=v[0]&&l.push({id:v,isTree:c&&v===d})}if(i.ignore)for(var b=l.length-1;b>=0;b--)i.ignore[l[b].id]&&l.splice(b,1);i.id&&n.push({id:"id",width:50,header:" ",template:function(t){return t.id}}),i.flatTree&&function(){for(var t=i.flatTree.id,e=[].concat(i.flatTree.columns),s=[],n=!!i.flatTree.fill,a=1;a<=e.length;a++)e[a-1].template=function(e){return function(i){return i.$level==e?s[e]=i[t]:n&&e<i.$level?s[e]:""}}(a);for(var r=0,o=l.length-1;o>=0;o--)l[o].id===t&&(r=o);l=[].concat(l.slice(0,r)).concat(e).concat(l.slice(r+1))}();for(var w=0;w<l.length;w++){var y=l[w],x=y.id;if(!y.noExport){var k=h&&o;if(o){var C=e.getColumnConfig(x);!y.template||C&&C.template==y.template||(k=!1),C&&(y=t.extend(t.extend({},y),C))}var $={id:y.id,template:k||!y.template?en(x,y,h):y.template,width:(y.width||200)*("excel"===i.export_mode?8.43/70:1),header:!1!==y.header?y.header||x:""};y.collection&&($.collection=y.collection),c&&x===d&&($.isTree=s=!0),"excel"===i.export_mode&&(t.extend($,{type:y.exportType||"",format:y.exportFormat||""}),y.hidden&&(n.hiddenCols||(n.hiddenCols={}),n.hiddenCols[y.id]=1)),"string"==typeof $.header?$.header=[{text:$.header}]:$.header=[].concat($.header);for(var S=0;S<$.header.length;S++)$.header[S]=$.header[S]?sn(e,$.header[S]):"";if(a=Math.max(a,$.header.length),e.config.footer){var I=y.footer||"";I="string"==typeof I?[{text:I}]:[].concat(I);for(var A=0;A<I.length;A++)I[A]=I[A]?sn(e,I[A]):"";$.footer=I,r=Math.max(r,$.footer.length)}n.push($)}}!s&&c&&i.treeLines!=d&&n[0]&&(n[0].isTree=!0);for(var D=0;D<n.length;D++){for(var j=a-n[D].header.length,V=0;V<j;V++)n[D].header.push("");if(e.config.footer){j=r-n[D].footer.length;for(var N=0;N<j;N++)n[D].footer.push("")}}return n}function rn(t,e){return t&&(t=t.replace(/[/?\\<>:*|"]/g,"").substring(0,150)),"".concat(t||"Data",".").concat(e)}function on(t,e,i){var s,n,a=!!e.filterHTML,r=/<[^>]*>/gi,o=[],l=e.export_mode;if("excel"!==l&&"csv"!=l||!e.docHeader||(o=[[(e.docHeader.text||e.docHeader).toString()],[""]],"excel"===l&&e.docHeader.height&&(i.heights[0]=e.docHeader.height)),!1!==e.header&&i.length)for(var h=0;h<i[0].header.length;h++){n=[];for(var c=0;c<i.length;c++)s="",i[c].header[h]&&(s=i[c].header[h],a&&(s=i[c].header[h]=s.replace(r,""))),n.push(s);"excel"!=l||!t._columns||!1===e.heights||t._headers[h]===vi.barHeight&&"all"!=e.heights||(i.heights[o.length]=t._headers[h]),"pdf"!==l&&(o[o.length]=n)}e.yCorrection=(e.yCorrection||0)-o.length;var d=e.flatTree||e.plainOutput?"":"-";if(t.data.each((function(s,n){if(!e.filter||e.filter(s)){var h=e.hidden&&t.data._filter_order&&-1==t.getIndexById(s.id);if(e.hide&&e.hide(s)||h){var c=(e.docHeader?2:0)+(!1===e.header?0:i[0].header.length);i.hiddenRows[c+n]=1}this.data._scheme_export&&(s=t.data._scheme_export(s));for(var u=[],_=0;_<i.length;_++){var p=i[_],f=null;if(t.$getExportValue)f=t.$getExportValue(s.id,p.id,e);else{var g=void 0;if(e.math&&s["$"+p.id]&&"="==s["$"+p.id].charAt(0)&&("excel"==l?g=s["$"+p.id]:f=s["$"+p.id]),this._spans_pull){var m=this.getSpan(s.id,p.id);m&&m[4]&&m[0]==s.id&&m[1]==p.id&&(f=m[4],a&&"string"==typeof f&&(f=f.replace(r,"")))}f||((f=p.template(s,t.type,s[p.id],p,_))||0===f||(f=""),p.isTree&&d&&(f=" "+Array(s.$level).join(d)+" "+f),a&&"string"==typeof f&&(f=f.replace(r,"")),"string"==typeof f&&"csv"===l&&(f=f.trim()),"string"!=typeof f||"excel"!==l&&"csv"!==l||(f=f.replace(/<br\s*\/?>/gm,"\n"))),g&&(f={formula:g,value:f})}u.push(f)}"excel"==l&&t._columns&&!1!==e.heights&&(s.$height&&s.$height!==vi.rowHeight||"all"==e.heights)&&(i.heights[o.length]=s.$height||this.config.rowHeight),o.push(u)}}),t,e.hidden),!1!==e.footer)for(var u=i[0].footer?i[0].footer.length:0,_=0;_<u;_++){for(var p=[],f=0;f<i.length;f++){var g=i[f].footer[_];a&&(g=i[f].footer[_]=g.toString().replace(r,"")),p.push(g)}"excel"!=l||!t._columns||!1===e.heights||t._footers[_]===vi.barHeight&&"all"!=e.heights||(i.heights[o.length]=t._footers[_]),"pdf"!==l&&o.push(p)}return"excel"===l&&e.docFooter&&(o=o.concat([[],[(e.docFooter.text||e.docFooter).toString()]]),e.docFooter.height&&(i.heights[o.length-1]=e.docFooter.height)),o}var ln={},hn=function(e,i){(i=i||{}).export_mode="pdf";var s={fontName:"pt-sans.regular",boldFontName:"pt-sans.bold",italicFontName:"pt-sans.italic",italicBoldFontName:"pt-sans.italic-bold"};t.extend(i,s),e=B(e)?e:[e];for(var n=[],a=0;a<e.length;a++){e[a].id||(e[a]={id:e[a]});var r=ke(e[a].id);if(r){var o=t.extend(e[a].options||{},i),l=o.display||"table";if("image"==o.display&&delete o.styles,r.$exportView&&(r=r.$exportView(o)),B(r))n=n.concat(r),i.autowidth&&pn(o,i);else{if(("table"==l||"all"==l)&&r.data&&r.data.pull){var h=an(r,o);n.push({scheme:h,exportData:on(r,o,h),viewOptions:o}),i.autowidth&&pn(r,i,h)}if("image"==l||"all"==l){var c=o._hidden?mn(r.$view):r.$view;n.push({node:c,viewOptions:o}),i.autowidth&&pn(r,i)}}}f(r,tn)}return i.dataOnly?n:Gt([Ot.cdn+"/extras/pdfjs.js",Ot.cdn+"/extras/html2canvas-1.0.min.js"]).then((function(){if(0==n.length)return d.reject(tn);var t=!0;for(var e in s)if(!ln[e]){t=!1;break}if(t)return dn(n,i).then((function(t){return cn(t,i)}));var a=d.defer();return pdfjs.load(i.fontURL||Ot.cdn+"/extras/"+i.fontName+".ttf",(function(t,e){if(t)return a.reject(t);pdfjs.load(i.italicBoldFontURL||Ot.cdn+"/extras/"+i.italicBoldFontName+".ttf",(function(t,s){pdfjs.load(i.italicFontURL||Ot.cdn+"/extras/"+i.italicFontName+".ttf",(function(r,o){pdfjs.load(i.boldFontURL||Ot.cdn+"/extras/"+i.boldFontName+".ttf",(function(l,h){ln[i.fontName]=new pdfjs.TTFFont(e),ln[i.boldFontName]=l?null:new pdfjs.TTFFont(h),ln[i.italicFontName]=r?null:new pdfjs.TTFFont(o),ln[i.italicBoldFontName]=t?null:new pdfjs.TTFFont(s),a.resolve(dn(n,i).then((function(t){return cn(t,i)})))}))}))}))})),a}))};function cn(t,e){var i=rn(e.filename,"pdf"),s=new Blob([t.toString()],{type:"application/pdf"});return!1!==e.download&&Vt(s,i),s}function dn(e,i){for(var s=function(t){var e=t.width||595.296,i=t.height||841.896;return t.orientation&&"landscape"===t.orientation&&(i=[e,e=i][0]),new pdfjs.Document({padding:40,font:ln[t.fontName],threshold:256,width:e,height:i})}(i),n=[],a=0;a<e.length;a++)e[a].node?n.push(_n(e[a].node)):n.push(d.resolve());return d.all(n).then((function(a){for(var r=0;r<n.length;r++){var o=e[r].viewOptions;o.textBefore&&un(s,"before",o.textBefore),a[r]?s.image(a[r],{align:"center"}):fn(e[r],s),o.textAfter&&un(s,"after",o.textAfter),r!=e.length-1&&s.pageBreak()}return function(e,i){!1!==i.docFooter&&(i.docFooter=t.extend(i.docFooter||{},{color:6710886,textAlign:"center"}),e.footer().text(i.docFooter).append(R.dataExport.page||"Page").pageNumber().append("  "+(R.dataExport.of||"of")+"  ").pageCount());var s={text:0,image:1};if(i.docHeader&&("string"==typeof i.docHeader&&(i.docHeader={text:i.docHeader}),t.extend(i.docHeader,{color:6710886,textAlign:"right",order:0}),s.text=i.docHeader.order),i.docHeaderImage&&("string"==typeof i.docHeaderImage&&(i.docHeaderImage={url:i.docHeaderImage}),t.extend(i.docHeaderImage,{align:"right",order:1}),s.image=i.docHeaderImage.order),i.docHeader&&s.image>s.text&&e.header({paddingBottom:10}).text(i.docHeader.text,i.docHeader),i.docHeaderImage){var n=d.defer();return pdfjs.load(i.docHeaderImage.url,(function(t,a){if(!t){var r=new pdfjs.Image(a);e.header({paddingBottom:10}).image(r,i.docHeaderImage),i.docHeader&&s.image<s.text&&e.header({paddingBottom:10}).text(i.docHeader.text,i.docHeader)}n.resolve(e.render())})),n}return d.resolve(e.render())}(s,i)}))}function un(t,e,i){"after"==e&&t.text().br(),"string"==typeof i&&(i={text:i}),t.text(i.text,i.options||{}),"before"==e&&t.text().br()}function _n(t){var e=!document.body.contains(t);return e&&(document.body.appendChild(t),t.style.position="absolute",t.style.left="-9999px"),window.html2canvas(t,{background:"#fff",logging:!1,useCORS:!0}).then((function(t){for(var e=t.toDataURL("image/jpeg"),i=window.atob(e.split("base64,")[1]),s=i.length,n=new Uint8Array(s),a=0;a<s;a++)n[a]=i.charCodeAt(a);return new pdfjs.Image(n.buffer)})).finally((function(){e&&document.body.removeChild(t)}))}function pn(t,e,i){var s,n=e.orientation&&"landscape"==e.orientation?"height":"width";if(i){s=80;for(var a=0;a<i.length;a++)s+=i[a].width}else s=t.$width?t.$width:t[n];e[n]=Math.max(e[n]||0,s||0)}function fn(e,i){var s=e.scheme,n=e.exportData,a=e.viewOptions,r=e.styles;a.header=E(a.header)||!0===a.header?{}:a.header,a.footer=E(a.footer)||!0===a.footer?{}:a.footer,a.table=a.table||{};for(var o=!1===a.header?0:s[0].header.length,l=!1!==a.footer&&s[0].footer?s[0].footer.length:0,h=[],c=0;c<s.length;c++)h[c]=s[c].width;var d=t.extend(a.table,{borderWidth:1,height:20,lineHeight:1.1,borderColor:15658734,backgroundColor:16777215,color:6710886,textAlign:"left",paddingRight:10,paddingLeft:10,headerRows:o,widths:h.length?h:["100%"]}),u=i.table(d);if(o)for(var _=t.extend(a.header,{borderRightColor:11587299,borderBottomColor:11587299,color:4868682,backgroundColor:13820911,height:27,lineHeight:1.2}),p=0;p<o;p++)for(var f=u.tr(_),g=0;g<s.length;g++){var m=r?nn(p,g,r):{};gn(m,a),f.td(s[g].header[p].toString(),m)}for(var v=0;v<n.length;v++)for(var b=u.tr({}),w=0;w<n[v].length;w++){var y=r?nn(v+o,w,r):{};gn(y,a),b.td(n[v][w],y)}if(l)for(var x=t.extend(a.footer,{borderRightColor:15658734,borderBottomColor:15658734,backgroundColor:16448250,color:6710886,height:27,lineHeight:1.2}),k=0;k<l;k++)for(var C=o+n.length,$=u.tr(x),S=0;S<s.length;S++){var I=r?nn(k+C,S,r):{};gn(I,a),$.td(s[S].footer[k].toString(),I)}}function gn(t,e){var i=ln[e.boldFontName],s=ln[e.italicFontName],n=ln[e.italicBoldFontName];t.bold&&i?t.italic&&n?t.font=n:t.font=i:t.italic&&s&&(t.font=s)}function mn(t){var e=t.cloneNode(!1);if(t.tagName){var i=window.getComputedStyle(t);e.style.cssText=i.cssText}for(var s=0;s<t.childNodes.length;s++)e.appendChild(mn(t.childNodes[s]));return e}var vn=function(e,i){(i=i||{}).export_mode="excel",e=B(e)?e:[e];for(var s=[],n=0;n<e.length;n++){e[n].id||(e[n]={id:e[n]});var a=ke(e[n].id),r=t.extend(e[n].options||{},i);if(a&&a.$exportView&&(a=a.$exportView(r)),f(a,tn),B(a))s=s.concat(a);else if(a.data&&a.data.pull){var o=an(a,r);s.push({scheme:o,exportData:on(a,r,o),spans:r.spans?xn(a,r):[],viewOptions:r})}}if(i.dataOnly)return s;var l=d.defer();return Gt(Ot.cdn+"/extras/xlsx.core.styles.min.js").then((function(){if(!s.length)return l.reject(tn);for(var t={SheetNames:[],Sheets:{},Workbook:{WBProps:{},Names:[],Sheets:[]}},e=0;e<s.length;e++){for(var n=s[e].viewOptions,a=s[e].scheme,r=s[e].exportData,o=s[e].spans,h=s[e].ranges||[],c=yn(r,a,o,s[e].styles||[],n),d=(n.name||"Data"+(e+1)).replace(/[*?:[\]\\/]/g,"").replace(/&/g,"&amp;").substring(0,31),u=e;-1!=t.SheetNames.indexOf(d);)d="Data"+ ++u;t.SheetNames.push(d),t.Sheets[d]=c,t.Workbook.Names=t.Workbook.Names.concat(h),t.Workbook.Sheets.push({state:s[e].state||"visible"})}var _=XLSX.write(t,{bookType:"xlsx",bookSST:!1,type:"binary"}),p=rn(i.filename,"xlsx"),f=new Blob([bn(_)],{type:"application/xlsx"});return!1!==i.download&&Vt(f,p),l.resolve(f),l}))};function bn(t){for(var e=new ArrayBuffer(t.length),i=new Uint8Array(e),s=0;s!=t.length;++s)i[s]=255&t.charCodeAt(s);return e}var wn={number:"n",date:"n",string:"s",boolean:"b"};function yn(t,i,s,n,a){for(var r={},o={s:{c:1e7,r:1e7},e:{c:0,r:0}},l=0;l!=t.length;++l)for(var h=0;h!=t[l].length;++h){o.s.r>l&&(o.s.r=l),o.s.c>h&&(o.s.c=h),o.e.r<l&&(o.e.r=l),o.e.c<h&&(o.e.c=h);var c={v:t[l][h]};if(null!==c.v){var d=XLSX.utils.encode_cell({c:h,r:l}),u="object"==e(c.v)&&c.v.formula,_=(u?c.v.value:c.v).toString();if(n){var p=nn(l,h,n);p.format&&(c.z=p.format,delete p.format),p.type&&(c.t=wn[p.type],delete p.type),c.s=p}if(l>=(a.docHeader?2:0)+i[0].header.length&&!u){var f=i[h];f.type&&!c.t&&(c.t=wn[f.type]||""),f.format&&!c.z&&(c.z=f.format)}a.stubCells&&!_?c.t="z":c.v instanceof Date?(c.t=c.t||"n",c.z=c.z||XLSX.SSF._table[14],c.v=(25569+((g=c.v).getTime()-60*g.getTimezoneOffset()*1e3)/864e5).toString().substr(0,20)):u?(c.t||(c.t=isNaN(_)?"s":"n"),c.f=c.v.formula.substring(1),c.v=_):c.t||("boolean"==typeof c.v?c.t="b":"number"==typeof c.v||parseFloat(c.v)==c.v?(c.v=1*c.v,c.t="n"):(c.v=_,c.t="s")),r[d]=c}}var g;return o.s.c<1e7&&(r["!ref"]=XLSX.utils.encode_range(o)),r["!rows"]=function(t){var e=t.heights;for(var i in e)e[i]={hpx:e[i],hpt:.75*e[i]};var s=t.hiddenRows;if(s)for(var n in s)e[n]||(e[n]={}),e[n].hidden=1;return e}(i),r["!cols"]=function(t){for(var e=[],i=0;i<t.length;i++){var s=t[i];e.push({wch:s.width,hidden:t.hiddenCols?t.hiddenCols[s.id]:0})}return e}(i),s.length&&(r["!merges"]=s),r}function xn(t,e){var i=t.getColumnConfig,s=t._spans_pull,n=[];if(i){if(!1!==e.header&&(n=kn(t,e,"header",n)),s){var a=e.xCorrection||0,r=e.yCorrection||0;for(var o in s){var l=s[o];for(var h in l){var c=t.getColumnIndex(h),d=t.getItem(o).id,u=t.getIndexById(d);if(e.hidden){var _=t._hidden_column_order;if(_.length){var p=t.getColumnConfig(h).id;c=_.indexOf(p)}var f=t.data._filter_order;f&&f.length&&(u=f.indexOf(d))}var g=c-a,m=u-r;if(!(g<0||m<0)){var v=g+l[h][0]-1,b=m+(l[h][1]-1);n.push({s:{c:g,r:m},e:{c:v,r:b}})}}}}!1!==e.footer&&(n=kn(t,e,"footer",n))}return n}function kn(t,e,i,s){for(var n=t.config.columns,a=(e.docHeader?2:0)+("header"==i?0:(!1!==e.header?t._headers.length:0)+t.count()),r=0;r<n.length;r++)for(var o=n[r][i],l=0;l<o.length;l++)o[l]&&(o[l].colspan||o[l].rowspan)&&s.push({s:{c:r,r:l+a},e:{c:r+(o[l].colspan||1)-1,r:l+(o[l].rowspan||1)-1+a}});return s}var Cn={groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2,minusPosition:"before",minusSign:"-",dateFormat:"%m/%d/%Y",timeFormat:"%h:%i %A",longDateFormat:"%d %F %Y",fullDateFormat:"%m/%d/%Y %h:%i %A",am:["am","AM"],pm:["pm","PM"],price:"${obj}",priceSettings:{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2,minusPosition:"before",minusSign:"-"},fileSize:["b","Kb","Mb","Gb","Tb","Pb","Eb"],calendar:{monthFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],hours:"Hours",minutes:"Minutes",done:"Done",clear:"Clear",today:"Today"},dataExport:{page:"Page",of:"of"},PDFviewer:{of:"of",automaticZoom:"Automatic Zoom",actualSize:"Actual Size",pageFit:"Page Fit",pageWidth:"Page Width",pageHeight:"Page Height",enterPassword:"Enter password",passwordError:"Wrong password"},aria:{calendar:"Calendar",increaseValue:"Increase value",decreaseValue:"Decrease value",navMonth:["Previous month","Next month"],navYear:["Previous year","Next year"],navDecade:["Previous decade","Next decade"],dateFormat:"%d %F %Y",monthFormat:"%F %Y",yearFormat:"%Y",hourFormat:"Hours: %h %A",minuteFormat:"Minutes: %i",removeItem:"Remove item",pages:["First page","Previous page","Next page","Last page"],page:"Page",headermenu:"Header menu",openGroup:"Open column group",closeGroup:"Close column group",closeTab:"Close tab",showTabs:"Show more tabs",resetTreeMap:"Reset tree map",navTreeMap:"Level up",nextTab:"Next tab",prevTab:"Previous tab",multitextSection:"Add section",multitextextraSection:"Remove section",showChart:"Show chart",hideChart:"Hide chart",resizeChart:"Resize chart"},richtext:{underline:"Underline",bold:"Bold",italic:"Italic"},combo:{select:"Select",selectAll:"Select all",unselectAll:"Unselect all"},message:{ok:"OK",cancel:"Cancel"},comments:{send:"Send",confirmMessage:"The comment will be removed. Are you sure?",edit:"Edit",remove:"Remove",placeholder:"Type here..",moreComments:"More comments"},filter:{less:"less",lessOrEqual:"less or equal",greater:"greater",greaterOrEqual:"greater or equal",contains:"contains",notContains:"not contains",equal:"equal",notEqual:"not equal",beginsWith:"begins with",notBeginsWith:"not begins with",endsWith:"ends with",notEndsWith:"not ends with",between:"between",notBetween:"not between"},timeboard:{seconds:"Seconds"}},$n={startOnMonday:!1,toFixed:function(t,e){return t<10&&(t="0"+t),e&&t<100&&(t="0"+t),t},weekStart:function(t){var e=(t=this.copy(t)).getDay();return this.startOnMonday&&(0===e?e=6:e--),this.datePart(this.add(t,-1*e,"day"))},monthStart:function(t){return(t=this.copy(t)).setDate(1),this.datePart(t)},yearStart:function(t){return(t=this.copy(t)).setMonth(0),this.monthStart(t)},dayStart:function(t){return this.datePart(t,!0)},dateToStr:function(t,e){if("function"==typeof t)return t;if(Ot.strict)return function(e){if(!e)return"";e.getMonth||(e=R.parseFormatDate(e));var i="",s=0;return t.replace(/%[a-zA-Z]/g,(function(n,a){i+=t.slice(s,a);i+=function(t){if("%d"==n)return $n.toFixed(t.getDate());if("%m"==n)return $n.toFixed(t.getMonth()+1);if("%j"==n)return t.getDate();if("%n"==n)return t.getMonth()+1;if("%y"==n)return $n.toFixed(t.getFullYear()%100);if("%Y"==n)return t.getFullYear();if("%D"==n)return R.calendar.dayShort[t.getDay()];if("%l"==n)return R.calendar.dayFull[t.getDay()];if("%M"==n)return R.calendar.monthShort[t.getMonth()];if("%F"==n)return R.calendar.monthFull[t.getMonth()];if("%h"==n)return $n.toFixed((t.getHours()+11)%12+1);if("%g"==n)return(t.getHours()+11)%12+1;if("%G"==n)return t.getHours();if("%H"==n)return $n.toFixed(t.getHours());if("%i"==n)return $n.toFixed(t.getMinutes());if("%a"==n)return t.getHours()>11?R.pm[0]:R.am[0];if("%A"==n)return t.getHours()>11?R.pm[1]:R.am[1];if("%s"==n)return $n.toFixed(t.getSeconds());if("%S"==n)return $n.toFixed(t.getMilliseconds(),!0);if("%W"==n)return $n.toFixed(Date.getISOWeek(t));if("%c"==n){var e=t.getFullYear();return e+="-"+$n.toFixed(t.getMonth()+1),e+="-"+$n.toFixed(t.getDate()),e+="T",e+=$n.toFixed(t.getHours()),(e+=":"+$n.toFixed(t.getMinutes()))+":"+$n.toFixed(t.getSeconds())}return n}(e),s=a+2})),i+=t.slice(s,t.length)};t=t.replace(/%[a-zA-Z]/g,(function(t){switch(t){case"%d":return'"+wDate.toFixed(date.getDate())+"';case"%m":return'"+wDate.toFixed((date.getMonth()+1))+"';case"%j":return'"+date.getDate()+"';case"%n":return'"+(date.getMonth()+1)+"';case"%y":return'"+wDate.toFixed(date.getFullYear()%100)+"';case"%Y":return'"+date.getFullYear()+"';case"%D":return'"+i18n.calendar.dayShort[date.getDay()]+"';case"%l":return'"+i18n.calendar.dayFull[date.getDay()]+"';case"%M":return'"+i18n.calendar.monthShort[date.getMonth()]+"';case"%F":return'"+i18n.calendar.monthFull[date.getMonth()]+"';case"%h":return'"+wDate.toFixed((date.getHours()+11)%12+1)+"';case"%g":return'"+((date.getHours()+11)%12+1)+"';case"%G":return'"+date.getHours()+"';case"%H":return'"+wDate.toFixed(date.getHours())+"';case"%i":return'"+wDate.toFixed(date.getMinutes())+"';case"%a":return'"+(date.getHours()>11?i18n.pm[0]:i18n.am[0])+"';case"%A":return'"+(date.getHours()>11?i18n.pm[1]:i18n.am[1])+"';case"%s":return'"+wDate.toFixed(date.getSeconds())+"';case"%S":return'"+wDate.toFixed(date.getMilliseconds(), true)+"';case"%W":return'"+wDate.toFixed(wDate.getISOWeek(date))+"';case"%c":var i='"+date.getFullYear()+"';return i+='-"+wDate.toFixed((date.getMonth()+1))+"',i+='-"+wDate.toFixed(date.getDate())+"',i+="T",i+='"+wDate.toFixed(date.getHours())+"',i+=':"+wDate.toFixed(date.getMinutes())+"',i+=':"+wDate.toFixed(date.getSeconds())+"',!0===e&&(i+="Z"),i;default:return t}})),!0===e&&(t=t.replace(/date\.get/g,"date.getUTC"));var i=new Function("date","i18n","wDate","if (!date) return ''; if (!date.getMonth) date=i18n.parseFormatDate(date);  return \""+t+'";');return function(t){return i(t,R,$n)}},strToDate:function(t,i){if("function"==typeof t)return t;var s,n,a,r=t.match(/%[a-zA-Z]/g),o="var temp=date.split(/[\\s\\./\\-\\:\\,]+/g); if(!temp.join('')){return ''}";if(!R.calendar.monthShort_hash){for(a=R.calendar.monthShort,n=R.calendar.monthShort_hash={},s=0;s<a.length;s++)n[a[s]]=s;for(a=R.calendar.monthFull,n=R.calendar.monthFull_hash={},s=0;s<a.length;s++)n[a[s]]=s}if(Ot.strict)return function(t){if(!t)return"";if("object"==e(t))return t;var n=t.split(/[\s./\-:,]+/g);if(!n.join(""))return"";var a=[0,0,1,0,0,0,0];for(s=0;s<r.length;s++){var o=r[s];if("%y"==o)a[0]=1*n[s]+(n[s]>30?1900:2e3);else if("%Y"==o)a[0]=1*(n[s]||0),a[0]<30&&(a[0]+=2e3);else if("%n"==o||"%m"==o)a[1]=(n[s]||1)-1;else if("%M"==o)a[1]=R.calendar.monthShort_hash[n[s]]||0;else if("%F"==o)a[1]=R.calendar.monthFull_hash[n[s]]||0;else if("%j"==o||"%d"==o)a[2]=n[s]||1;else if("%g"==o||"%G"==o||"%h"==o||"%H"==o)a[3]=n[s]||0;else if("%a"==o)a[3]=a[3]%12+((n[s]||"")==R.am[0]?0:12);else if("%A"==o)a[3]=a[3]%12+((n[s]||"")==R.am[1]?0:12);else if("%i"==o)a[4]=n[s]||0;else if("%s"==o)a[5]=n[s]||0;else if("%S"==o)a[6]=n[s]||0;else if("%c"==o){var l=/(\d+)-(\d+)-(\d+)T(\d+):(\d+):(\d+)(\+.*|)/g.exec(t);a[0]=1*(l[1]||0),a[0]<30&&(a[0]+=2e3),a[1]=(l[2]||1)-1,a[2]=l[3]||1,a[3]=l[4]||0,a[4]=l[5]||0,a[5]=l[6]||0}}return i?new Date(Date.UTC(a[0],a[1],a[2],a[3],a[4],a[5],a[6])):new Date(a[0],a[1],a[2],a[3],a[4],a[5],a[6])};for(s=0;s<r.length;s++)switch(r[s]){case"%j":case"%d":o+="set[2]=temp["+s+"]||1;";break;case"%n":case"%m":o+="set[1]=(temp["+s+"]||1)-1;";break;case"%y":o+="set[0]=temp["+s+"]*1+(temp["+s+"]>30?1900:2000);";break;case"%g":case"%G":case"%h":case"%H":o+="set[3]=temp["+s+"]||0;";break;case"%i":o+="set[4]=temp["+s+"]||0;";break;case"%Y":o+="set[0]=(temp["+s+"]||0)*1; if (set[0]<30) set[0]+=2000;";break;case"%a":o+="set[3]=set[3]%12+(temp["+s+"]==i18n.am[0]?0:12);";break;case"%A":o+="set[3]=set[3]%12+(temp["+s+"]==i18n.am[1]?0:12);";break;case"%s":o+="set[5]=temp["+s+"]||0;";break;case"%S":o+="set[6]=temp["+s+"]||0;";break;case"%M":o+="set[1]=i18n.calendar.monthShort_hash[temp["+s+"]]||0;";break;case"%F":o+="set[1]=i18n.calendar.monthFull_hash[temp["+s+"]]||0;";break;case"%c":o+="var res = date.split('T');",o+="if(res[0]){ var d = res[0].split('-');",o+="set[0]= (d[0]||0)*1; if (set[0]<30) set[0]+=2000;",o+="set[1]= (d[1]||1)-1;",o+="set[2]= d[2]||1;}",o+="if(res[1]){ var t = res[1].split(':');",o+="set[3]= t[0]||0;",o+="set[4]= t[1]||0;",o+="set[5]= parseInt(t[2])||0;}"}var l="set[0],set[1],set[2],set[3],set[4],set[5],set[6]";i&&(l=" Date.UTC("+l+")");var h=new Function("date","i18n","if (!date) return ''; if (typeof date == 'object') return date; var set=[0,0,1,0,0,0,0]; "+o+" return new Date("+l+");");return function(t){return h(t,R)}},getISOWeek:function(t){if(!t)return!1;var e=t.getDay();0===e&&(e=7);var i=new Date(t.valueOf());i.setDate(t.getDate()+(4-e));var s=i.getFullYear(),n=Math.floor((i.getTime()-new Date(s,0,1).getTime())/864e5);return 1+Math.floor(n/7)},getUTCISOWeek:function(t){return this.getISOWeek(t)},_correctDate:function(t,e,i,s){if(i){var n=s(t,e);if(n)for(var a=i>0?1:-1;n;)t.setHours(t.getHours()+a),n=s(t,e),a+=i>0?1:-1}},add:function(t,e,i,s){s&&(t=this.copy(t));var n=$n.copy(t);switch(i){case"day":t.setDate(t.getDate()+e),this._correctDate(t,n,e,(function(t,e){return $n.datePart(e,!0).valueOf()==$n.datePart(t,!0).valueOf()}));break;case"week":t.setDate(t.getDate()+7*e),this._correctDate(t,n,7*e,(function(t,e){return $n.datePart(e,!0).valueOf()==$n.datePart(t,!0).valueOf()}));break;case"month":t.setMonth(t.getMonth()+e),this._correctDate(t,n,e,(function(t,e){return e.getMonth()==t.getMonth()&&e.getYear()==t.getYear()}));break;case"quarter":t.setMonth(t.getMonth()+3*e),this._correctDate(t,n,e,(function(t,e){return e.getMonth()==t.getMonth()&&e.getYear()==t.getYear()}));break;case"year":t.setYear(t.getFullYear()+e),this._correctDate(t,n,e,(function(t,e){return e.getFullYear()==t.getFullYear()}));break;case"hour":t.setHours(t.getHours()+e),this._correctDate(t,n,e,(function(t,e){return e.getHours()==t.getHours()&&Date.datePart(e,!0)==Date.datePart(t,!0)}));break;case"minute":t.setMinutes(t.getMinutes()+e);break;default:$n.add[i](t,e,i)}return t},datePart:function(t,e){e&&(t=this.copy(t));var i=this.copy(t);return i.setHours(0),i.getDate()!=t.getDate()?t.setHours(1):t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},timePart:function(t,e){return e&&(t=this.copy(t)),(t.valueOf()/1e3-60*t.getTimezoneOffset())%86400},copy:function(t){return new Date(t.valueOf())},equal:function(t,e){return!(!t||!e)&&t.valueOf()===e.valueOf()},isHoliday:function(t){if(0===(t=t.getDay())||6==t)return"webix_cal_event"}},Sn={getConfig:function(t){var e={decimalSize:0,groupSize:999,minusSign:R.minusSign,minusPosition:R.minusPosition,prefix:"",sufix:""},i=t.split(/[0-9].*[0-9]/g);i[0].length&&(e.prefix=i[0]),i[1].length&&(e.sufix=i[1]),(e.prefix||e.sufix)&&(t=t.substr(e.prefix.length,t.length-e.prefix.length-e.sufix.length));var s=t.indexOf("1");s>0&&(e.prefix=t.substr(0,s),t=t.substr(s));var n=t.indexOf("0");n>0&&(e.decimalSize=t.length-n,e.decimalDelimiter=t[n-1],t=t.substr(0,n-1));var a=t.match(/[^0-9]/);return a&&(e.groupSize=t.length-a.index-1,e.groupDelimiter=t[a.index]),e},parse:function(t,e){if(!t||"string"!=typeof t)return t;var i=t;(e=e||R).prefix&&(t=t.replace(e.prefix,"")),e.sufix&&(t=t.replace(e.sufix,""));var s=1;switch(e.minusPosition){case"before":case"after":-1!=t.indexOf(e.minusSign)&&(s=-1,t=t.replace(e.minusSign,""));break;case"parentheses":-1!=t.indexOf(e.minusSign[0])&&-1!=t.indexOf(e.minusSign[1])&&(s=-1,t=t.replace(e.minusSign[0],"").replace(e.minusSign[1],""))}t=t.trim();var n="";if(e.decimalDelimiter){var a=t.indexOf(e.decimalDelimiter);if(a>-1){if(n=t.substr(a+1),!Oe.isNumber(n))return i;var r=e.decimalOptional?1/0:e.decimalSize;n=n.substr(0,Math.min(n.length,r)),t=t.substr(0,a)}}if(e.groupSize){for(var o=t.split(e.groupDelimiter),l=0;l<o.length;l++)if(!(!l&&o[l].length<=e.groupSize||o[l].length==e.groupSize)||!Oe.isNumber(o[l]))return i;t=o.join("")}return t||(t="0"),n&&(t+="."+n),Oe.isNumber(t)?t*s:i},format:function(t,e){if(""===t||void 0===t)return t;e=e||R;var i=(t=parseFloat(t))<0?"-":"";t=Math.abs(t),e.decimalOptional||(t=t.toFixed(e.decimalSize));var s=t.toString();s=s.split(".");var n="";if(e.groupSize){var a=e.groupSize,r=s[0].length;do{n=((r-=a)>0?s[0].substr(r,a):s[0].substr(0,a+r))+(n?e.groupDelimiter+n:"")}while(r>0)}else n=s[0];if(s=e.decimalSize||e.decimalOptional?n+(s[1]?e.decimalDelimiter+s[1]:""):n,i)switch(e.minusPosition){case"before":s=e.minusSign+s;break;case"after":s+=e.minusSign;break;case"parentheses":s=e.minusSign[0]+s+e.minusSign[1]}return e.prefix&&(s=e.prefix+s),e.sufix&&(s+=e.sufix),s},numToStr:function(t){return function(e){return Sn.format(e,t)}}};function In(t,i){for(var s in i)"object"!=e(i[s])||B(i[s])?t[s]=i[s]:(t[s]||(t[s]={}),In(t[s],i[s]))}var An=["fullDateFormat","timeFormat","dateFormat","longDateFormat","parseFormat","parseTimeFormat"];R.setLocale=function(t){if("string"==typeof t&&(R.locale=t,t=R.locales[t]),t){var e=I(Cn);t.priceSettings=I(t.priceSettings||t),In(e,t),In(R,e),delete R.calendar.monthShort_hash,delete R.calendar.monthFull_hash}for(var i=0;i<An.length;i++){var s=An[i],n=R[s+"UTC"];R[s+"Str"]=$n.dateToStr(R[s],n),R[s+"Date"]=$n.strToDate(R[s],n)}var a=le(R.price),r=R.priceSettings||R;R.intFormat=Sn.numToStr({groupSize:R.groupSize,groupDelimiter:R.groupDelimiter,decimalSize:0}),R.priceFormat=function(t){var e=t<0;if(e&&(t=Math.abs(t)),t=Sn.format(t,r),e)switch(r.minusPosition){case"before":return r.minusSign+a(t);case"parentheses":return r.minusSign[0]+a(t)+r.minusSign[1];case"after":t+=r.minusSign;break;case"inside":t=r.minusSign+t}return a(t)},R.numberFormat=Sn.format},R.locales={"en-US":Cn},R.setLocale("en-US");var Dn={prefix:function(t,e){return t+=".",{put:function(i,s){return e.put(t+i,s)},get:function(i){return e.get(t+i)},remove:function(i){return e.remove(t+i)}}}};Dn.local={put:function(t,e){t&&window.JSON&&window.localStorage&&window.localStorage.setItem(t,z(e))},get:function(t){if(t&&window.JSON&&window.localStorage){var e=window.localStorage.getItem(t);return e?Xt.json.toObject(e):null}return null},remove:function(t){t&&window.JSON&&window.localStorage&&window.localStorage.removeItem(t)},clear:function(){window.localStorage.clear()}},Dn.session={put:function(t,e){t&&window.JSON&&window.sessionStorage&&window.sessionStorage.setItem(t,z(e))},get:function(t){if(t&&window.JSON&&window.sessionStorage){var e=window.sessionStorage.getItem(t);return e?Xt.json.toObject(e):null}return null},remove:function(t){t&&window.JSON&&window.sessionStorage&&window.sessionStorage.removeItem(t)},clear:function(){window.sessionStorage.clear()}},Dn.cookie={put:function(t,e,i,s){t&&window.JSON&&(document.cookie=t+"="+escape(z(e))+(s&&s instanceof Date?";expires="+s.toUTCString():"")+(i?";domain="+i:"")+(Ot.https?";secure":""))},getRaw:function(t){for(var e=document.cookie.split(";"),i="",s="",n=0;n<e.length;n++){if((i=e[n].split("="))[0].replace(/^\s+|\s+$/g,"")==t)return i.length>1&&(s=unescape(i[1].replace(/^\s+|\s+$/g,""))),s;i=null}return null},get:function(t){if(t&&window.JSON){var e=this.getRaw(t);return e?Xt.json.toObject(unescape(e)):null}return null},remove:function(t,e){t&&this.getRaw(t)&&(document.cookie=t+"="+(e?";domain="+e:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT")},clear:function(t){for(var e=document.cookie.split(";"),i=0;i<e.length;i++)document.cookie=/^[^=]+/.exec(e[i])[0]+"="+(t?";domain="+t:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT"}},Ot.printPPI=96,Ot.printMargin=.75*Ot.printPPI,Ot.printSizes=[{id:"a3",preset:"A3",width:11.7,height:16.5},{id:"a4",preset:"A4",width:8.27,height:11.7},{id:"letter",preset:"letter",width:8.5,height:11}];var En={page:!0,data:!0},jn={portrait:!0,landscape:!0};function Vn(t){Et(document.body,"webix_print"),mt("print"),t.docHeader&&wt(t.docHeader),t.docFooter&&wt(t.docFooter)}function Nn(t,e){var i=t.$view.cloneNode(!0),s=t.$view.getElementsByTagName("canvas");if(s.length)for(var n=s.length-1;n>=0;n--)i.getElementsByTagName("canvas")[n].getContext("2d").drawImage(s[n],0,0);yt(i,e.docFooter,document.body),Dt(i,"webix_ui_print"),!e.scroll&&(t._dataobj&&t.data&&t.data.pull||t.getBody)&&Dt(i,"webix_print_noscroll"),window.print(),wt(i)}function Tn(t,e){var i=vt("div",{class:"webix_view webix_print_"+t.toLowerCase(),style:"height:0px;visibility:hidden;"},e["doc"+t]);"Header"===t?yt(i,document.body.firstChild):document.body.appendChild(i),e["doc"+t]=i}var Fn={number:{greater:function(t,e){return t>e},less:function(t,e){return t<e},greaterOrEqual:function(t,e){return t>=e},lessOrEqual:function(t,e){return t<=e},equal:function(t,e){return t==e},notEqual:function(t,e){return t!=e},contains:function(t,e){return-1!==t.toString().toLowerCase().indexOf(e.toString().toLowerCase())},notContains:function(t,e){return-1===t.toString().toLowerCase().indexOf(e.toString().toLowerCase())}},text:{equal:function(t,e){return t.toLowerCase()===e.toLowerCase()},notEqual:function(t,e){return t.toLowerCase()!==e.toLowerCase()},contains:function(t,e){return-1!==t.toLowerCase().indexOf(e.toLowerCase())},notContains:function(t,e){return-1===t.toLowerCase().indexOf(e.toLowerCase())},beginsWith:function(t,e){return 0===t.toLowerCase().lastIndexOf(e.toLowerCase(),0)},notBeginsWith:function(t,e){return 0!==t.toLowerCase().lastIndexOf(e.toLowerCase(),0)},endsWith:function(t,e){return-1!==t.toLowerCase().indexOf(e.toLowerCase(),t.length-e.length)},notEndsWith:function(t,e){return-1===t.toLowerCase().indexOf(e.toLowerCase(),t.length-e.length)}},date:{greater:function(t,e){return t>e},less:function(t,e){return t<e},greaterOrEqual:function(t,e){return t>=e},lessOrEqual:function(t,e){return t<=e},equal:function(t,e){return!(!t||!e)&&t.valueOf()===e.valueOf()},notEqual:function(t,e){return!t||!e||t.valueOf()!==e.valueOf()},between:function(t,e){return(!e.start||t>e.start)&&(!e.end||t<e.end)},notBetween:function(t,e){return!e.start||t<=e.start||!e.end||t>=e.end}}},Pn={phone:{mask:"+# (###) ###-####",allow:/[0-9]/g},card:{mask:"#### #### #### ####",allow:/[0-9]/g},date:{mask:"####-##-## ##:##",allow:/[0-9]/g}},Bn="__webix_remote_error";function Mn(t,e){this._proxy={},this._queue=[],this._url=t,this._key="",e?this._process(e):this._ready=Z(t).then((function(t){return t.text()})).then(A((function(t){return t=t.split("/*api*/")[1],this._process(JSON.parse(t)),this._proxy}),this))}function On(t,e){var i=new Mn(t,e)._getProxy();for(var s in i)Ln[s]=i[s];return i}Mn.prototype={_process:function(t){if(t.$key&&(this._key=t.$key),t.$vars)for(var e in t.$vars)this._proxy[e]=t.$vars[e];this._parse(t,this._proxy,"")},_parse:function(t,i,s){for(var n in t)if("$key"!==n&&"$vars"!==n){var a=t[n];if("object"==e(a)){var r=i[n]={};this._parse(a,r,s+n+".")}else i[n]=this._proxy_call(this,s+n)}},_call:function(t,e){var i=this._deffer(this,t,e);return this._queue.push(i),this._start_queue(),i},_start_queue:function(){this._timer||(this._timer=setTimeout(A(this._run_queue,this),1))},_run_queue:function(){for(var t=[],e=this._queue,i=0;i<this._queue.length;i++){var s=this._queue[i];s.$sync?(e.splice(i,1),i--):t.push({name:s.$name,args:s.$args})}if(e.length){var n=Z(),a=this._pack(t);U("onBeforeRemoteCall",[n,a,{}]);var r=n.post(this._url,a).then((function(t){for(var i=t.json().data,s=0;s<i.length;s++){var n=i[s],a=i[s]&&i[s][Bn];a?(U("onRemoteError",[a]),e[s].reject(a)):e[s].resolve(n)}}),(function(t){for(var i=0;i<e.length;i++)e[i].reject(t);throw t}));U("onAfterRemoteCall",[r])}this._queue=[],this._timer=null},_sync:function(){var t=null;this.$sync=!0;var e=[{name:this.$name,args:this.$args}];try{var i=Z(),s=this.$context._pack(e);U("onBeforeRemoteCall",[i,s,{sync:!0}]);var n=i.sync().post(this.$context._url,s);U("onAfterRemoteCall",[null]),(t=JSON.parse(n.responseText).data[0])[Bn]&&(t=null)}catch(t){}return t},_deffer:function(t,e,i){var s=d.defer();return s.sync=t._sync,s.$name=e,s.$args=i,s.$context=this,s},_proxy_call:function(t,e){return function(){return t._call(e,[].slice.call(arguments))}},_getProxy:function(){return this._ready||this._proxy},_pack:function(t){return{key:this._key,payload:t}}};var Ln=function(t,i){if("object"===e(t)){var s=document.getElementsByTagName("script");return i=t,On(t=s[s.length-1].src,i)}return On(t,i)};function Rn(){return!!((window.screen.orientation?window.screen.orientation.angle:window.orientation)%180)}function zn(){var t=Rn();me.orientation!==t&&(me.orientation=t,U("onRotate",[t]))}Ot.mobile&&(me.orientation=Rn(),window.screen.orientation?pe(window.screen.orientation,"change",zn):pe(window,"orientationchange",zn));var Hn={textWaitDelay:500,summColumn:{getValue:function(t){return t.innerText},setValue:function(){},refresh:function(t,e,i){var s=0;t.mapCells(null,i.columnId,null,1,(function(t){t*=1,isNaN(t)||(s+=t)}),!0),i.format&&(s=i.format(s)),i.template&&(s=i.template({value:s})),e.innerHTML=s},trackCells:!0,render:function(t,e){return e.template&&(e.template=le(e.template)),""}},masterCheckbox:{getValue:function(){},setValue:function(){},getHelper:function(t,e){return{check:function(){e.checked=!1,t.onclick()},uncheck:function(){e.checked=!0,t.onclick()},isChecked:function(){return e.checked}}},refresh:function(t,e,i){e.onclick=function(){this.getElementsByTagName("input")[0].checked=i.checked=!i.checked;var e=t.getColumnConfig(i.columnId),s=i.checked?e.checkValue:e.uncheckValue;t.data.each((function(e){e[i.columnId]=s,t.callEvent("onCheck",[e.id,i.columnId,s]),this.callEvent("onStoreUpdated",[e.id,e,"save"])})),t.refresh()}},render:function(t,e){return"<input type='checkbox' "+(e.checked?"checked='1'":"")+">"}},textFilter:{getInputNode:function(t){return t.querySelector("input")||{value:null}},getValue:function(t){return this.getInputNode(t).value},setValue:function(t,e){this.getInputNode(t).value=e},refresh:function(t,e,i){e.component=t._settings.id,t.registerFilter(e,i,this),e._comp_id=t._settings.id,i.value&&this.getValue(e)!=i.value&&this.setValue(e,i.value),e.onclick=St,_e(e,"keydown",this._on_key_down)},render:function(t,e){return this.init&&this.init(e),e.css=(e.css||"")+" webix_ss_filter","<input "+(e.placeholder?'placeholder="'+e.placeholder+'" ':"")+"type='text'>"},_on_key_down:function(t){var e=this._comp_id;9!=(t.which||t.keyCode)&&(this._filter_timer&&window.clearTimeout(this._filter_timer),this._filter_timer=window.setTimeout((function(){var t=ke(e);t&&t.filterByAll()}),Hn.textWaitDelay))}},selectFilter:{getInputNode:function(t){return t.querySelector("select")||{value:null}},getValue:function(t){return this.getInputNode(t).value},setValue:function(t,e){this.getInputNode(t).value=e},refresh:function(t,e,i){i.compare=i.compare||function(t,e){return t==e},e.component=t._settings.id,t.registerFilter(e,i,this);var s=Hn._get_data(t,i);!1!==i.emptyOption&&s.unshift({id:"",value:i.emptyOption||""});for(var n=document.createElement("select"),a=0;a<s.length;a++){var r=document.createElement("option");r.value=s[a].id,r.text=s[a].value,n.add(r)}e.innerHTML="",e.appendChild(n),i.value&&this.setValue(e,i.value),e.onclick=St,n._comp_id=t._settings.id,_e(n,"change",this._on_change)},render:function(t,e){return this.init&&this.init(e),e.css=(e.css||"")+" webix_ss_filter",""},_on_change:function(){ke(this._comp_id).filterByAll()}},_get_data:function(t,e){var i=e.options;return i?t._collectValues.call(i,"id","value"):t.collectValues(e.columnId,e.collect)}};Hn.serverFilter=t.extend({$server:!0,_on_key_down:function(t){var e=this._comp_id,i=t.which||t.keyCode;9==i||i>=33&&i<=40||(this._filter_timer&&window.clearTimeout(this._filter_timer),this._filter_timer=window.setTimeout((function(){ke(e).filterByAll()}),Hn.textWaitDelay))}},Hn.textFilter),Hn.serverSelectFilter=t.extend({$server:!0,_on_change:function(){ke(this._comp_id).filterByAll()}},Hn.selectFilter),Hn.numberFilter=t.extend({init:function(t){t.prepare=function(e){var i,s=this,n=-1!=e.indexOf("="),a=this.format(e);return""===a?"":(-1!=e.indexOf(">")?i=this._greater:-1!=e.indexOf("<")&&(i=this._lesser),t.compare=i&&n?function(t,e){return s._equal(t,e)||i(t,e)}:i||this._equal,a)}},format:function(t){return t.replace(/[^\-.0-9]/g,"")},_greater:function(t,e){return 1*t>e},_lesser:function(t,e){return""!==t&&1*t<e},_equal:function(t,e){return""!==t&&1*t==e}},Hn.textFilter),Hn.dateFilter=t.extend({format:function(t){if(""===t)return"";var e=new Date;if(-1!=t.indexOf("today"))e=$n.dayStart(e);else if(-1==t.indexOf("now")){var i=t.match(/[0-9]+/g);if(!i||!i.length)return"";i.length<3?(i.reverse(),e=new Date(i[0],(i[1]||1)-1,1)):e=R.dateFormatDate(t.replace(/^[>< =]+/,""))}return e.valueOf()}},Hn.numberFilter);var qn={name:"baselayout",restore:function(t,e,i){var s=this._restore(I(t),e);if(i)return s;be(s.cols||s.rows,this)},_restore:function(t,e){if(!t.$layout)return e.call(this,t);for(var i=t.cols||t.rows,s=0;s<i.length;s++)i[s]=this._restore(i[s],e);return t},serialize:function(t){for(var e=[],i=this.getChildViews(),s=0;s<i.length;s++){var n=i[s];if(n.movePortlet){var a=n.getChildViews();e.push(t.call(this,a[a.length-1]))}else n.serialize?e.push(n.serialize(t,!0)):e.push(t.call(this,n))}var r={$layout:!0,type:this.config.type};return this.config.rows?r.rows=e:r.cols=e,r},$init:function(e){this.$ready.push(this._parse_cells),this._dataobj=this._contentobj,this._layout_sizes=[],this._responsive=[],this._padding={top:0,left:0,right:0,bottom:0},e.$topView&&(e.borderless=!0,e._inner={top:!0,left:!0,bottom:!0,right:!0}),e.isolate&&t.extend(this,cs)},rows_setter:function(t){return this._vertical_orientation=1,this._collection=t,!0},cols_setter:function(t){return this._vertical_orientation=0,this.$view.style.whiteSpace="nowrap",this._collection=t,!0},_remove:function(t){var e=L.find.call(this._cells,t);this._beforeRemoveView&&this._beforeRemoveView(e),L.removeAt.call(this._cells,e),this._fix_hidden_cells(!0)},_fix_hidden_cells:function(t){this._hiddencells=0;for(var e=0;e<this._cells.length;e++){var i=this._cells[e];(i._settings.hidden||i.$nospace)&&this._hiddencells++}t&&this.resizeChildren(!0)},_replace:function(t,e){if(E(e)){for(var i=0;i<this._cells.length;i++)this._cells[i].destructor();this._collection=t,this._parse_cells()}else{var s;"number"==typeof e?((e<0||e>this._cells.length)&&(e=this._cells.length),L.insertAt.call(this._cells,t,e),t._settings.hidden||this._insertBeforeView(t,this._cells[e])):(s=ke(e),f(-1!=(e=L.find.call(this._cells,s)),"Attempt to replace the non-existing view"),t._settings.hidden||this._insertBeforeView(t,s),s.destructor(),this._cells[e]=t),this._vertical_orientation||this._fix_vertical_layout(t)}this._fix_hidden_cells(!0);var n=this.elements?this:this.getFormView();n&&!this._fill_data&&n._recollect_elements(),U("onReconstruct",[this])},_fix_vertical_layout:function(t){t._viewobj.style.display="inline-block",t._viewobj.style.verticalAlign="top"},addView:function(t,e){E(e)&&(e=this._cells.length);var i=this.$$?this:this.getTopParentView();me._parent_cell=this;var s=i&&i.ui?i.ui(t,this,e):be(t,this,e);return me._parent_cell=null,s._settings.id},removeView:function(t){var i;i="object"!=e(t)?ke(t)||(this.$$?this.$$(t):null):t;var s=L.find.call(this._cells,i);if(s>=0){this._beforeRemoveView&&this._beforeRemoveView(s,i);var n=this.elements?this:this.getFormView();this._cells.splice(s,1),n&&je(i,(function(t){t.name&&delete n.getCleanValues()[t.config.name]}),n,!0),i.destructor(),this._fix_hidden_cells(!0),n&&n._recollect_elements()}else f(!1,"Attemp to remove not existing view: "+t);U("onReconstruct",[this])},reconstruct:function(){this._hiddencells=0,this._replace(this._collection)},_hide:function(t,e,i){t._settings.hidden||(t._settings.hidden=!0,wt(t._viewobj),this._hiddencells++,i||me._ui_creation||this.resizeChildren(!0))},_signal_hidden_cells:function(t){t.callEvent&&t.callEvent("onViewShow",[])},resizeChildren:function(){if(!me._freeze_resize&&this._layout_sizes){var t=this.getParentView();if(t)return t.resizeChildren?t.resizeChildren():t.resize();var e,i,s,n,a=this.$getSize(0,0);if(s=e=this._layout_sizes[0]||0,n=i=this._layout_sizes[1]||0,(a[1]>=1e5||a[3]>=1e5)&&this._viewobj.parentNode&&(s=e=Math.max(a[0],this._settings.width||this._viewobj.parentNode.offsetWidth||e||0),n=i=Math.max(a[2],this._settings.height||this._viewobj.parentNode.offsetHeight||i||0)),t)this._set_child_size(e,i);else{a[0]>e&&(s=a[0]),a[2]>i&&(n=a[2]);var r=this._viewobj.parentNode==document.body&&!this.setPosition;!r&&e>a[1]&&(s=a[1]),!r&&i>a[3]&&(n=a[3]),this.$setSize(s,n)}me._responsive_exception&&(me._responsive_exception=!1,this.resizeChildren()),U("onResize",[])}},getChildViews:function(){return this._cells},index:function(t){t._settings&&(t=t._settings.id);for(var e=0;e<this._cells.length;e++)if(this._cells[e]._settings.id==t)return e;return-1},_insertBeforeView:function(t,e){if(e)if(e._settings.hidden||t===e){for(var i=this.index(e)+1;this._cells[i]&&this._cells[i]._settings.hidden;)i++;e=this._cells[i]?this._cells[i]._viewobj:null}else e=e._viewobj;yt(t._viewobj,e,this._dataobj||this._viewobj)},_show:function(t,e,i){t._settings.hidden&&(this._insertBeforeView(t,t),t._settings.hidden=!1,this._hiddencells--,i||(this.resizeChildren(!0),t.refresh&&t.refresh()),t.callEvent&&(t.callEvent("onViewShow",[]),je(t,this._signal_hidden_cells)))},showBatch:function(t,e){var i=void 0!==e;if(e=!1!==e,i)this._settings.visibleBatch="";else{if(this._settings.visibleBatch==t)return;this._settings.visibleBatch=t}for(var s=[],n=0;n<this._cells.length;n++)this._cells[n]._settings.batch||this._cells[n]._settings.hidden?this._cells[n]._settings.batch==t?e?s.push(this._cells[n]):this._hide(this._cells[n],null,!0):i||this._hide(this._cells[n],null,!0):s.push(this._cells[n]);for(var a=0;a<s.length;a++)this._show(s[a],null,!0),s[a]._render_hidden_views();this.resizeChildren(!0)},_parse_cells:function(t){this._cells=[],f(t,this.name+" was incorrectly defined. <br><br> You have missed rows|cols|cells|elements collection");for(var e=0;e<t.length;e++)me._parent_cell=this,t[e]._inner||(t[e].borderless=!0),this._cells[e]=be._view(t[e],this),this._vertical_orientation||this._fix_vertical_layout(this._cells[e]),this._settings.visibleBatch&&this._settings.visibleBatch!=this._cells[e]._settings.batch&&this._cells[e]._settings.batch&&(this._cells[e]._settings.hidden=!0),this._cells[e]._settings.hidden||(this._dataobj||this._contentobj).appendChild(this._cells[e]._viewobj);this._fix_hidden_cells(),this._parse_cells_ext_end&&this._parse_cells_ext_end(t)},_fix_container_borders:function(t,e){e.top&&(t.borderTopWidth="0px"),e.left&&(t.borderLeftWidth="0px"),e.right&&(t.borderRightWidth="0px"),e.bottom&&(t.borderBottomWidth="0px")},_bubble_size:function(t,e,i){if(this._vertical_orientation!=i)for(var s=0;s<this._cells.length;s++)this._cells[s]._settings[t]=e,this._cells[s]._bubble_size&&this._cells[s]._bubble_size(t,e,i)},$getSize:function(t,e){w(this,!0);var i=0,s=1e5,n=1e5,a=0;this._vertical_orientation?n=0:s=0;var r=0,o=0,l=0;this._sizes=[];for(var h=0,c=0;c<this._cells.length;c++)if(this._cells[c]._settings.hidden)h++;else{var d=this._sizes[c]=this._cells[c].$getSize(0,0);this._cells[c]._hiddenByCells&&h++,this._cells[c].$nospace?o++:this._vertical_orientation?(d[0]>i&&(i=d[0]),d[1]<s&&(s=d[1]),a+=d[2],n+=d[3],d[2]==d[3]&&-1!=d[2]?(r+=d[2],o++):l+=d[4]):(d[2]>a&&(a=d[2]),d[3]<n&&(n=d[3]),i+=d[0],s+=d[1],d[0]==d[1]&&-1!=d[0]?(r+=d[0],o++):l+=d[4])}if(h==this._cells.length){this._hiddenByCells=!0;var u=this.getParentView();u&&u._collection&&(u._vertical_orientation?(n=0,s=1e5,e=0):(n=1e5,s=0,t=0))}else delete this._hiddenByCells;a>n&&(n=a),i>s&&(s=i),this._master_size=[r,this._cells.length-o,l],this._desired_size=[i+t,a+e];var _=pi.api.$getSize.call(this,0,0);return _[1]>=1e5&&(_[1]=0),_[3]>=1e5&&(_[3]=0),_[0]=(_[0]||i)+t,_[1]=Math.max(_[0],(_[1]||s)+t),_[2]=(_[2]||a)+e,_[3]=Math.max(_[2],(_[3]||n)+e),y(0,_),!this._vertical_orientation&&this._settings.responsive&&(_[0]=0),_},$setSize:function(t,e){this._layout_sizes=[t,e],w(this),pi.api.$setSize.call(this,t,e),this._set_child_size(t,e),y(0,[t,e])},_set_child_size_a:function(t,e,i){var s=e=t[e];if(e!=(i=t[i])){var n=this._set_size_delta*t[4]/this._set_size_gravity;if(n<e)s=e,this._set_size_gravity-=t[4],this._set_size_delta-=s;else{if(!(n>i))return-1;s=i,this._set_size_gravity-=t[4],this._set_size_delta-=s}}return s},_responsive_hide:function(t,e){var i=ke(e);"hide"!==i&&i?(i||(i=be({view:"popup",body:[{}]})),t._responsive_width=t._settings.width,t._responsive_height=t._settings.height,t._responsive_marker=i._settings.id,t._settings.width=0,t._settings.height||(t._settings.autoheight=!0),be(t,i,this._responsive.length)):(t.hide(),t._responsive_marker="hide"),this._responsive.push(t)},_responsive_show:function(t){var e=t._responsive_marker;if(t._responsive_marker=0,"hide"!==e&&e){t._settings.width=t._responsive_width,t._settings.height=t._responsive_height,delete t._settings.autoheight;for(var i=0;this._cells[i]&&!1===this._cells[i]._settings.responsiveCell;)i++;be(t,this,i)}else t.show();this._responsive.pop()},_responsive_cells:function(t){if(me._responsive_tinkery=!0,t+this._padding.left+this._padding.right+this._margin*(this._cells.length-1)<this._desired_size[0])for(var e=this._cells.length-1,i=0;i<e;i++){var s=this._cells[i];if(!s._responsive_marker){if(!1!==s._settings.responsiveCell){this._responsive_hide(s,this._settings.responsive),U("onResponsiveHide",[s._settings.id]),me._responsive_exception=!0;break}e=this._cells.length}}else if(this._responsive.length){var n=this._responsive[this._responsive.length-1],a="hide"==n._responsive_marker?0:n._responsive_width;n.$getSize(a,0)[0]+this._desired_size[0]+this._margin+20<=t&&(this._responsive_show(n),U("onResponsiveShow",[n._settings.id]),me._responsive_exception=!0)}me._responsive_tinkery=!1},_set_child_size:function(t,e){me._child_sizing_active=(me._child_sizing_active||0)+1,!this._vertical_orientation&&this._settings.responsive&&this._responsive_cells(t,e),this._set_size_delta=(this._vertical_orientation?e:t)-this._master_size[0],this._set_size_gravity=this._master_size[2];for(var i=t,s=e,n=[],a=0;a<this._cells.length;a++)if(!this._cells[a]._settings.hidden&&this._sizes[a]){var r=this._sizes[a];if(this._vertical_orientation){if((s=this._set_child_size_a(r,2,3))<0){n.push({oldIndex:a,view:this._cells[a]});continue}}else if((i=this._set_child_size_a(r,0,1))<0){n.push({oldIndex:a,view:this._cells[a]});continue}this._cells[a].$setSize(i,s)}for(var o=0;o<n.length;o++){var l=n[o].oldIndex,h=this._sizes[l],c=Math.round(this._set_size_delta*h[4]/this._set_size_gravity);this._set_size_delta-=c,this._set_size_gravity-=h[4],this._vertical_orientation?s=c:i=c,n[o].view.$setSize(i,s)}me._child_sizing_active-=1},_next:function(t,e){var i=this.index(t);return-1==i?null:this._cells[i+e]},_first:function(){return this._cells[0]}},Un={api:qn,view:t.protoUI(qn,H,pi.view)},Wn={name:"layout",$init:function(){this._hiddencells=0},defaults:{type:"line"},_parse_cells:function(){this._parse_cells_ext&&(i=this._parse_cells_ext(i)),this._parse_once||(this._viewobj.className+=" webix_layout_"+(this._settings.type||""),this._parse_once=1),void 0!==this._settings.margin&&(this._margin=this._settings.margin),void 0!==this._settings.padding&&"object"!==e(this._settings.padding)&&(this._padding.left=this._padding.right=this._padding.top=this._padding.bottom=this._settings.padding),void 0!==this._settings.paddingX&&(this._padding.left=this._padding.right=this._settings.paddingX),void 0!==this._settings.paddingY&&(this._padding.top=this._padding.bottom=this._settings.paddingY),"object"===e(this._settings.padding)&&t.extend(this._padding,this._settings.padding,!0),(this._padding.left||this._padding.right||this._padding.top||this._padding.bottom)&&(this._padding.defined=!0),this._hasBorders()&&!this._settings.borderless&&(this._contentobj.style.borderWidth="1px",this._render_borders=!0);var i=this._collection;this._settings.borderless&&(this._settings._inner={top:!0,left:!0,right:!0,bottom:!0}),this._beforeResetBorders(i),Un.api._parse_cells.call(this,i),this._afterResetBorders(i)},$getSize:function(t,e){t=t||0,e=e||0;var i=this._margin*(this._cells.length-this._hiddencells-1);if(this._render_borders||this._hasBorders()){var s=this._settings._inner;s&&(t+=(s.left?0:1)+(s.right?0:1),e+=(s.top?0:1)+(s.bottom?0:1))}return this._settings.height||(e+=this._padding.top+this._padding.bottom+(this._vertical_orientation?i:0)),this._settings.width||(t+=this._padding.left+this._padding.right+(this._vertical_orientation?0:i)),Un.api.$getSize.call(this,t,e)},$setSize:function(t,e){this._layout_sizes=[t,e],w(this),this._hasBorders()||this._render_borders?mi.api.$setSize.call(this,t,e):pi.api.$setSize.call(this,t,e),e=this._content_height,t=this._content_width,this._settings.scroll&&(e=Math.max(e,this._desired_size[1]),t=Math.max(t,this._desired_size[0])),this._set_child_size(t,e),y(0,[t,e])},_set_child_size:function(t,e){var i=this._margin*(this._cells.length-this._hiddencells-1);return e-=this._padding.top+this._padding.bottom,t-=this._padding.left+this._padding.right,this._vertical_orientation?e-=i:t-=i,Un.api._set_child_size.call(this,t,e)},resizeChildren:function(t){if(t){this._last_size=null;for(var e=[],i=0;i<this._cells.length;i++){var s=this._cells[i];e[i]=s._settings;var n=s._layout_sizes&&!s._render_borders||s._settings.borderless?"0px":"1px";s._viewobj.style.borderTopWidth=s._viewobj.style.borderBottomWidth=s._viewobj.style.borderLeftWidth=s._viewobj.style.borderRightWidth=n}this._beforeResetBorders(e);for(var a=0;a<e.length;a++)e[a].borderless&&this._cells[a]._set_inner&&this._cells[a]._set_inner(e[a]);this._afterResetBorders(this._cells)}me._responsive_tinkery||Un.api.resizeChildren.call(this)},_hasBorders:function(){return this._padding.defined&&this._margin>0&&!this._cleanlayout},_beforeResetBorders:function(t){if(!this._hasBorders()||this._settings.borderless&&"space"!=this._settings.type){for(var e=0;e<t.length;e++)t[e]._inner=S(this._settings._inner);var i=!1;this._cleanlayout&&(i=!0);var s=t.length;if(this._vertical_orientation){for(var n=1;n<s-1;n++)t[n]._inner.top=t[n]._inner.bottom=i;if(s>1){for("head"!=this._settings.type&&(t[0]._inner.bottom=i);t[s-1].hidden&&s>1;)s--;s>0&&(t[s-1]._inner.top=i)}}else{for(var a=1;a<s-1;a++)t[a]._inner.left=t[a]._inner.right=i;if(s>1){for("head"!=this._settings.type&&(t[0]._inner.right=i),t[s-1]._inner.left=i;s>1&&t[s-1].hidden;)s--;s>0&&(t[s-1]._inner.left=i)}}}else for(var r=0;r<t.length;r++)t[r]._inner&&t[r].borderless||(t[r]._inner={top:!1,left:!1,right:!1,bottom:!1})},_afterResetBorders:function(t){for(var e=0,i=0;i<t.length;i++){var s=this._cells[i],n=s._settings._inner;if(s._settings.hidden&&this._cells[i+1]){var a=this._cells[i+1]._settings._inner;n.top||(a.top=!1),n.left||(a.left=!1),i==e&&e++}this._fix_container_borders(s._viewobj.style,s._settings._inner)}for(var r=this._vertical_orientation?"marginLeft":"marginTop",o=this._vertical_orientation?"marginTop":"marginLeft",l=this._vertical_orientation?this._padding.left:this._padding.top,h=this._vertical_orientation?this._padding.top:this._padding.left,c=0;c<t.length;c++)this._cells[c]._viewobj.style[r]=l+"px";this._cells.length&&(this._cells[e]._viewobj.style[o]=h+"px");for(var d=e+1;d<t.length;d++)this._cells[d]._viewobj.style[o]=this._margin+"px"},type_setter:function(t){return this._margin=void 0!==this._margin_set[t]?this._margin_set[t]:this._margin_set.line,this._padding.left=this._padding.right=this._padding.top=this._padding.bottom=void 0!==this._margin_set[t]?this._padding_set[t]:this._padding_set.line,this._cleanlayout="material"==t||"clean"==t,"material"==t&&(this._settings.borderless=!0),t},$skin:function(){this._margin_set=vi.layoutMargin,this._padding_set=vi.layoutPadding}},Yn=t.protoUI(Wn,Un.view),Gn={api:Wn,view:Yn};Yn.call(-1);var Kn={name:"daterange",defaults:{button:!1,icons:!1,calendarCount:2,borderless:!1},$init:function(e){e.calendar=e.calendar||{},e.value=this.$prepareValue(e.value),delete e.calendar.type,this._viewobj.className+=" webix_daterange",this._zoom_level=this._types[e.calendar.type]||0;for(var i=[],s=vi.calendar,n=s&&s.height?s.height:0,a=s&&s.width?s.width:0,r=n||250,o=a||250,l=t.extend({view:"calendar",width:a,height:n},e.calendar||{},!0),h=e.calendarCount=0===this._zoom_level&&e.calendarCount||this.defaults.calendarCount,c=(l.css?l.css+" ":"")+"webix_range_",d=e.value.start||new Date,u=0;u<h;u++){var _=$n.copy(d);_.setDate(1),_=$n.add(_,this._steps[this._zoom_level]*u,"month"),t.extend(l,{events:A(this._isInRange,this),css:c+(1===h?"":0===u?"0":u+1==h?"N":"1"),monthSelect:0===u||u+1===h,timepicker:0===this._zoom_level&&e.timepicker,borderless:!0,date:_},!0),i.push(I(l))}e.rows=[{type:"clean",cols:i}],(e.button||e.icons)&&e.rows.push(this._footer_row(e,o*h)),e.height=E(e.height)?r+(e.icons||e.button?30:0):e.height,e.width=E(e.width)?o*h:e.width,e.type="line",this.$ready.push(this._after_init),_e(this.$view,"keydown",A((function(t){this._onKeyPress(t.which||t.keyCode,t)}),this))},value_setter:function(t){return this.$prepareValue(t)},getValue:function(t){var e=this._settings,i=I(e.value);if(t)for(var s in i)i[s]=$n.dateToStr(t)(i[s]);else if(e.stringResult)for(var n in i)i[n]=R.parseFormatStr(i[n]);return i},setValue:function(t,e,i){t=this.$prepareValue(t),this._settings.value=t;var s=t.start||t.end||new Date;if(!i){this._cals[0].showCalendar(t.start);for(var n=1;n<this._cals.length;n++)this._cals[n].define("date",s),this._changeDateSilent(this._cals[n],1,n)}this.callEvent("onChange",[t,e]),this.refresh()},refresh:function(){for(var t=0;t<this._cals.length;t++)if(this._cals[t]._zoom_level===this._zoom_level){Et(this._cals[t].$view,"webix_cal_timepicker"),Et(this._cals[t].$view,"webix_range_timepicker");var e=this._related_date(this._cals[t].getVisibleDate());if(e.start||e.end){if(this._cals[t].define("date",e.start||e.end),this._settings.timepicker){var i="webix_"+(e.start&&e.end?"range":"cal")+"_timepicker";Dt(this._cals[t].$view,i)}}else $n.datePart(this._cals[t]._settings.date);this._cals[t].refresh()}},addToRange:function(t,e){var i=this._add_date(this._string_to_date(t));this.setValue(i,e)},_icons:[{template:function(){return"<span role='button' tabindex='0' class='webix_cal_icon_today webix_cal_icon'>"+R.calendar.today+"</span>"},on_click:{webix_cal_icon_today:function(){var t=new Date;this._settings.timepicker||(t=$n.datePart(t)),this.addToRange(t,"user"),this.callEvent("onTodaySet",[this.getValue()])}}},{template:function(){return"<span role='button' tabindex='0' class='webix_cal_icon_clear webix_cal_icon'>"+R.calendar.clear+"</span>"},on_click:{webix_cal_icon_clear:function(){this.setValue("","user"),this.callEvent("onDateClear",[])}}}],_icons_template:function(t){if(t){t="object"==e(t)?t:this._icons;for(var i={css:"webix_cal_footer ",borderless:!0,template:"<div class='webix_cal_icons'>",onClick:{}},s=0;s<t.length;s++){if(t[s].template){var n="function"==typeof t[s].template?t[s].template:le(t[s].template);i.template+=n.call(this)}if(t[s].on_click)for(var a in t[s].on_click)i.onClick[a]=A(t[s].on_click[a],this)}return i.template+="</div>",i.width=jt(i.template).width+30,i}return{width:0}},_footer_row:function(t,e){var i={view:"button",value:R.calendar.done,minWidth:100,maxWidth:230,align:"center",click:function(){this.getParentView().getParentView().hide()}},s=this._icons_template(t.icons),n={css:"webix_range_footer",height:30,cols:[{width:s.width}]};return(t.button||t.icons)&&2*s.width+i.minWidth>e&&(n.cols[0].width=0),n.cols.push(t.button?i:{}),n.cols.push(s),n},_types:{time:-1,month:1,year:2},_steps:{0:1,1:12,2:120},$prepareValue:function(t){return t||(t={start:null,end:null}),t.start||t.end||(t={start:t}),t.end=this._string_to_date(t.end)||null,t.start=this._string_to_date(t.start)||null,(t.end&&t.end<t.start||!t.start)&&(t.end=[t.start,t.start=t.end][0]),t},_string_to_date:function(t){return"string"==typeof t&&(t=R.parseFormatDate(t)),isNaN(1*t)?null:t},_isInRange:function(t,e){if(!e){var i=this._settings.value,s=i.start?$n.datePart($n.copy(i.start)):null,n=i.end?$n.datePart($n.copy(i.end)):null,a=$n.datePart(t),r=$n.add(a,1,"day",!0),o=$n.add(a,-1,"day",!0),l="";a>=s&&n&&a<=n&&(l="webix_cal_range",$n.equal(o,s)&&(l+=" webix_cal_range_first"),$n.equal(r,n)&&(l+=" webix_cal_range_last")),$n.equal(a,s)&&(l="webix_cal_range_start"),$n.equal(a,n)&&(l="webix_cal_range_end");var h=$n.isHoliday(t)||"";return l+" "+(h?h+" ":"")}},_after_init:function(){var t=this._cals=this.getChildViews()[0].getChildViews(),e=this,i=this.config.id;this._cals_hash={};for(var s=0;s<t.length;s++)t[s].config.master=i,this._cals_hash[t[s].config.id]=s,t[s].attachEvent("onBeforeDateSelect",(function(t){return e._on_date_select(this,t)})),t[s].attachEvent("onBeforeZoom",(function(t){return e._before_zoom(this,t)})),0!==s&&s!==t.length-1||(t[s].attachEvent("onAfterMonthChange",A(this._month_change,this)),t[s].attachEvent("onAfterZoom",(function(t,i){e._after_zoom(this,t,i)})));this._settings.timepicker&&this.refresh()},_before_zoom:function(t,e){var i=this._getIndexById(t.config.id);if(e>=0&&i>0&&i!==this._cals.length-1)return!1;if(-1===e){var s=this._related_date(t.getVisibleDate());s.start&&s.end&&t.define("date",s[this._time_mode])}return!0},_month_change:function(t,e){var i=t>e?1:-1,s=t>e?this._cals[this._cals.length-1]:this._cals[0],n=s._zoom_logic[s._zoom_level]._changeStep;this._shift(i,n,s),this.refresh()},_after_zoom:function(t,e,i){var s=t._zoom_logic[t._zoom_level]._changeStep,n=this._getIndexById(t.config.id),a=0===n?1:-1;if(this._cals[n+a]){var r=this._cals[n+a].getVisibleDate();if(i>e&&e>=0){var o=0;if(1===e){var l=r.getFullYear();(this._zoom_level||-1===a&&11===r.getMonth()||1===a&&0===r.getMonth())&&(l-=a),o=t._settings.date.getFullYear()-l}else if(0===e){var h=r.getMonth()-a;12!==h&&-1!=h||(h=-1===h?11:0),o=t._settings.date.getMonth()-h}this._shift(o,s,t),this.refresh()}}},_changeDateSilent:function(t,e,i){t.blockEvent(),t._zoom_level>=0&&t._changeDate(e,i),t.unblockEvent()},_getIndexById:function(t){return this._cals_hash[t]},_shift:function(t,e,i){for(var s=0;s<this._cals.length;s++){var n=this._cals[s];i&&n.config.id===i.config.id||this._changeDateSilent(n,t,e)}},_related_date:function(t){var e=this._settings.value,i={};return e.start&&e.start.getYear()===t.getYear()&&e.start.getMonth()===t.getMonth()&&(i.start=e.start),e.end&&e.end.getYear()===t.getYear()&&e.end.getMonth()===t.getMonth()&&(i.end=e.end),i},_set_time:function(t,e){t.setHours(e.getHours()),t.setMinutes(e.getMinutes()),t.setSeconds(e.getSeconds()),t.setMilliseconds(e.getMilliseconds())},_add_date:function(t,e){var i=I(this._settings.value);return 0===this._zoom_level||E(e)?i.start&&!i.end?i.end=t:(i.start=t,i.end=null):i[e?"end":"start"]=t,i},_on_date_select:function(e,i){if(this.callEvent("onBeforeDateSelect",[i])){var s=this._settings.value;if(e._zoom_level<0){var n,a=I(this._related_date(i));(n=a.start&&a.end?a[this._time_mode]:a.start||a.end)&&this._set_time(n,i),e._zoom_level=0,s=t.extend(I(s),a,!0)}else{var r=e.getVisibleDate(),o=this._getIndexById(e.config.id);if(i.getMonth()!==r.getMonth()&&(0===o||o===this._cals.length-1)){var l=i>r?1:-1;this._shift(l,1)}s=this._add_date(i,o)}e._zoom_level!==this._zoom_level&&e.showCalendar(i),this.setValue(s,"user",!0),this.callEvent("onAfterDateSelect",[this.getValue()])}return!1}},Xn={api:Kn,view:t.protoUI(Kn,Gn.view)};Hn.excelFilter={getValue:function(t){var e=this._get_filter(t);if(e)return e.getValue()},setValue:function(t,e){var i=this._get_filter(t);i&&(e=e||{},i.setValue(e),this._mark_column(e,t))},$icon:!0,refresh:function(t,e,i){var s=this;if(!t.$destructed){i.node=e,e.$webix=i.filter,t.registerFilter(e,i,this);var n=ke(i.filter),a=n.getBody(),r=this._get_data(t,i);a.clearAll(),a.parse(r),i.value?this.setValue(e,i.value):i.compare=function(){return!0},e.onclick=function(t){-1===t.target.className.indexOf("webix_excel_filter")||n.isVisible()||n.show(s._get_position(e,n))}}},render:function(e,i){var s=this;if(!i.filter){i.template&&(i.template=le(i.template));var n=t.extend(i.filterConfig||{},{view:"filter",mode:i.mode,field:"value",template:function(t,e){var s=t.value;return null==s&&(s=""),i.format&&(s=i.format(s)),i.template&&(s=i.template(t,e,s)),s}},!0),a=be({view:"popup",body:n}),r=a.getBody(),o=e.getColumnConfig(i.columnId).collection;r.attachEvent("onChange",(function(){var t=r.getFilterFunction();i.compare=function(e,s,n){var a=n[i.columnId];if(o){var r=o.getItem(a);r&&(a=r.value)}return t({value:a})},e.filterByAll(),i.value&&s._mark_column(i.value,i.node)})),e.attachEvent("onScrollX",(function(){return a.hide()})),i.originText=i.text||"",i.filter=a._settings.id,e._destroy_with_me.push(a)}return i.css=(i.css||"")+" webix_ss_excel_filter","<span class='webix_excel_filter webix_icon wxi-filter'></span>"+i.originText},_get_position:function(t,e){var i=kt(t);return{x:i.x+i.width-e.$width,y:i.y+i.height}},_mark_column:function(t,e){var i=t.condition&&t.condition.filter;if(t.includes||i&&(i.start!==i.end||null!==i.end))return Dt(e,"webix_ss_filter_active",!0);Et(e,"webix_ss_filter_active")},_get_filter:function(t){var e=ke(t.$webix);return e?e.getBody():null},_get_data:function(t,e){return e.options?t._collectValues.call(e.options,"id","value"):t.collectValues(e.columnId,e.collect)}},Hn.serverExcelFilter=t.extend({$server:!0},Hn.excelFilter),Hn.richSelectFilter={getInputNode:function(t){return ke(t.$webix)||null},getValue:function(t,e){var i=this.getInputNode(t);return e&&i&&i.getText?i.getText():i?i.getValue():""},setValue:function(t,e){var i=this.getInputNode(t);return i?i.setValue(e):""},compare:function(t,e){return t==e},refresh:function(t,e,i){if(!t.$destructed){var s=ke(i.richselect);s.$view.parentNode||vt("div",{class:"webix_richfilter"}).appendChild(s.$view),e.$webix=i.richselect,i.compare=i.compare||this.compare,i.prepare=i.prepare||this.prepare,t.registerFilter(e,i,this);var n=Hn._get_data(t,i),a=s.getPopup().getList();if(e.appendChild(s.$view.parentNode),a.parse&&(a.clearAll(),a.parse(n),!this.$noEmptyOption&&!1!==i.emptyOption||i.emptyOption)){var r={id:"$webix_empty",value:i.emptyOption||"",$empty:!0};a.add(r,0)}s.render(),i.value&&this.setValue(e,i.value),j(s.resize,s)}},render:function(e,i){if(!i.richselect){var s={container:vt("div",{class:"webix_richfilter"}),view:this.inputtype,options:[]},n=t.extend(this.inputConfig||{},i.inputConfig||{},!0);t.extend(s,n),i.separator&&(s.separator=i.separator),i.suggest&&(s.suggest=i.suggest);var a=be(s);a.attachEvent("onChange",(function(){e.filterByAll()})),i.richselect=a._settings.id,e._destroy_with_me.push(a)}return i.css=(i.css||"")+" webix_div_filter"," "},inputtype:"richselect"},Hn.serverRichSelectFilter=t.extend({$server:!0},Hn.richSelectFilter),Hn.multiSelectFilter=t.extend({$noEmptyOption:!0,inputtype:"multiselect",prepare:function(t,e){if(!t)return t;for(var i={},s=t.toString().split(e.separator||","),n=0;n<s.length;n++)i[s[n]]=1;return i},compare:function(t,e){return!e||e[t]}},Hn.richSelectFilter),Hn.serverMultiSelectFilter=t.extend({$server:!0,_on_change:function(){ke(this._comp_id).filterByAll()}},Hn.multiSelectFilter),Hn.multiComboFilter=t.extend({inputtype:"multicombo",inputConfig:{tagMode:!1}},Hn.multiSelectFilter),Hn.serverMultiComboFilter=t.extend({inputtype:"multicombo",inputConfig:{tagMode:!1}},Hn.serverMultiSelectFilter),Hn.datepickerFilter=t.extend({prepare:function(t){return t||""},compare:function(t,e){return 1*t==1*e},inputtype:"datepicker"},Hn.richSelectFilter),Hn.columnGroup={getValue:function(t){return t.innerHTML},setValue:function(){},getHelper:function(t,e){return{open:function(){e.closed=!0,t.onclick()},close:function(){e.closed=!1,t.onclick()},isOpened:function(){return e.closed}}},refresh:function(t,e,i){e.onclick=function(e){It(e);var s=this.firstChild;i.closed?(i.closed=!1,s.className="webix_tree_open"):(i.closed=!0,s.className="webix_tree_close"),j((function(){t.callEvent("onColumnGroupCollapse",[i.columnId,i.batch,!i.closed]),t.showColumnBatch(i.batch,!i.closed)}))},i.firstRun||(i.firstRun=!0,i.closed&&t.showColumnBatch(i.batch,!1))},render:function(t,e){return"<div role='button' tabindex='0' aria-label='"+R.aria[e.closed?"openGroup":"closeGroup"]+"' class='"+(e.closed?"webix_tree_close":"webix_tree_open")+"'></div>"+(e.groupText||"")}},Hn.dateRangeFilter=t.extend({prepare:function(t){return t.start||t.end?Xn.api.$prepareValue(t):""},compare:function(t,e){return(!e.start||t>=e.start)&&(!e.end||t<=e.end)},inputtype:"daterangepicker"},Hn.richSelectFilter),Hn.serverDateRangeFilter=t.extend({$server:!0},Hn.dateRangeFilter),(Ot.mobile||Ot.$customScroll)&&(Ot.scrollSize=0),Ne((function(){Ot.scrollSize=function(){var t=vt("div");t.className="webix_skin_mark",t.style.cssText="position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;min-height:100px;overflow-y:scroll;",document.body.appendChild(t);var e=t.offsetWidth-t.clientWidth,i={200:"flat",210:"compact",220:"contrast",230:"material",240:"mini",250:"willow",260:"dark"}[10*Math.floor(t.offsetHeight/10)];return document.body.removeChild(t),i&&$i(i),Ot.$customScroll?0:e}()}));var Jn=!1;_("fixHeight",(function(){Jn||(gt("html, body{ height:100%; }"),document.body.className+=" webix_full_screen",Ii.limit(!1),Jn=!0)})),be.animate=function(t,e,i){var s=ke(e);if(s){var n=i||{type:"slide",direction:"left"},a=s._viewobj.cloneNode(!0),r=be(t,e);r._viewobj.parentNode.appendChild(a);var o=Ci.formLine(r._viewobj,a,n);return n.callback=function(){Ci.breakLine(o)},Ci(o,n),r}},be.animateView=function(t,e,i){if(t=ke(t)){i=i||{type:"slide",direction:"left"};for(var s=function(t){var e=t._viewobj,i=e.className,s=e.innerHTML;return"<div class='"+i+"' style='width:"+e.offsetWidth+"px;height:"+e.offsetHeight+"px;'>"+s+"</div>"},n=[],a=0;a<t._viewobj.childNodes.length;a++){var r=t._viewobj.childNodes[a],o=r.currentStyle?r.currentStyle.display:getComputedStyle(r,null).display;n.push(o||"")}var l=s(t);"function"==typeof e&&e.call(this);for(var h=s(t),c=t._viewobj.insertBefore(vt("DIV",{class:"webix_view_animate",style:"width:"+t._viewobj.offsetWidth+"px;height:"+t._viewobj.offsetHeight+"px;"},h+l),t._viewobj.firstChild),d=1;d<t._viewobj.childNodes.length;d++)t._viewobj.childNodes[d].style.display="none";var u=Ci.formLine(c.childNodes[0],c.childNodes[1],i);return i.callback=function(){if(c){t._viewobj.removeChild(c),c=null;for(var e=0;e<t._viewobj.childNodes.length;e++)t._viewobj.childNodes[e].style.display=n[e]}},Ci(u,i),t}},be.freeze=De,be.resize=Ee,be.zIndex=Ve,be.datafilter=Hn,be.fullScreen=function(){if(Ot.mobile){Pt("viewport","initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no"),Ot.fastClick=!0,Ot.isMac?Pt("apple-mobile-web-app-capable","yes"):(Pt("mobile-web-app-capable","yes"),gt("body.webix_full_screen{ overflow-y: auto; }"));var t=function(){var t=window.innerWidth,e=window.innerHeight;e&&(document.body.style.height=e+"px",document.body.style.width=t+"px"),me._freeze_resize=!1,Ee()},e=function(){me._freeze_resize=!0,j(t,null,[],50)};W("onRotate",e),zn(),j(e)}};R.locales["de-DE"]={groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,minusPosition:"before",minusSign:"-",dateFormat:"%d.%n.%Y",timeFormat:"%H:%i",longDateFormat:"%j. %F %Y",fullDateFormat:"%j. %F %Y %H:%i",am:null,pm:null,price:"{obj} ",priceSettings:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,minusPosition:"before",minusSign:"-"},calendar:{monthFull:["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthShort:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dayFull:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],dayShort:["So","Mo","Di","Mi","Do","Fr","Sa"],hours:"Stunden",minutes:"Minuten",done:"Fertig",clear:"Entfernen",today:"Heute"},dataExport:{page:"Seite",of:"von"},PDFviewer:{of:"von",automaticZoom:"Automatisch Zoom",actualSize:"Aktuelles Ausma",pageFit:"Seite Ausma",pageWidth:"Seite Breite",pageHeight:"Seite Hhe",enterPassword:"Passwort eingeben",passwordError:"Falsches passwort"},aria:{calendar:"Kalender",increaseValue:"Wert erhhen",decreaseValue:"Wert verringern",navMonth:["Vorheriger Monat","Nchsten Monat"],navYear:["Vorheriges Jahr","Nchstes Jahr"],navDecade:["Zurck Jahrzehnt","Als nchstes Jahrzehnt"],dateFormat:"%j. %F %Y",monthFormat:"%F %Y",yearFormat:"%Y",hourFormat:"Stunden: %H",minuteFormat:"Minuten: %i",removeItem:"Element entfernen",pages:["Erste Seite","Vorherige Seite","Folgeseite","Letzte Seite"],page:"Seite",headermenu:"Titelmen",openGroup:"ffnen Spaltengruppe ",closeGroup:"Schlieen Spaltengruppe ",closeTab:"Tab schlieen",showTabs:"Weitere Tabs",resetTreeMap:"Zurck zur ursprnglichen Ansicht",navTreeMap:"Aufleveln",nextTab:"Weiter tab",prevTab:"Zurck tab",multitextSection:"Element hinzufgen",multitextextraSection:"Element entfernen",showChart:"Chart anzeigen",hideChart:"Chart verstecken",resizeChart:"Chart Gre ndern"},richtext:{underline:"Unterstreichen",bold:"Fettgedruckt",italic:"Kursiv"},combo:{select:"Auswhlen",selectAll:"Alles auswhlen",unselectAll:"Alles widerrufen"},message:{ok:"OK",cancel:"Abbrechen"},comments:{send:"Absenden",confirmMessage:"Der Kommentar wird entfernt. Sind Sie sicher?",edit:"Redigieren",remove:"Lschen",placeholder:"Geben Sie hier ein..",moreComments:"Mehr Kommentare"},filter:{less:"weniger",lessOrEqual:"weniger oder gleich",greater:"mehr",greaterOrEqual:"grer oder gleich",contains:"enthlt",notContains:"nicht enthlt",equal:"gleich",notEqual:"ungleich",beginsWith:"beginnt mit",notBeginsWith:"nicht beginnt mit",endsWith:"endet mit",notEndsWith:"nicht endet mit",between:"zwischen",notBetween:"nicht zwischen"},timeboard:{seconds:"Sekunden"}},R.locales["es-ES"]={groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,minusPosition:"before",minusSign:"-",dateFormat:"%d/%n/%Y",timeFormat:"%G:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d %F %Y %G:%i",am:null,pm:null,price:"{obj} ",priceSettings:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,minusPosition:"before",minusSign:"-"},calendar:{monthFull:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],monthShort:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],dayFull:["domingo","lunes","martes","mircoles","jueves","viernes","sbado"],dayShort:["dom","lun","mar","mi","jue","vie","sb"],hours:"Horas",minutes:"Minutos",done:"Listo",clear:"Reinicio",today:"Hoy"},dataExport:{page:"Pgina",of:"de"},PDFviewer:{of:"de",automaticZoom:"Zoom automtico",actualSize:"Tamao real",pageFit:"Tamao de pgina",pageWidth:"Ancho de pgina",pageHeight:"Altura de la pgina",enterPassword:"Introduzca la contrasea",passwordError:"Contrasea incorrecta"},aria:{calendar:"alendario",increaseValue:"Aumentar el valor",decreaseValue:"Disminuye el valor",navMonth:["Mes anterior","Prximo mes"],navYear:["Ao anterior","Prximo ao"],navDecade:["Dcada anterior","Prxima dcada"],dateFormat:"%d %F %Y",monthFormat:"%F %Y",yearFormat:"%Y",hourFormat:"Horas: %G",minuteFormat:"Minutos: %i",removeItem:"Retire el elemento",pages:["Primera pgina","Pagina anterior","Siguiente pgina","ltima pgina"],page:"Pgina",headermenu:"Men de ttulos",openGroup:"Grupo de columnas abiertas",closeGroup:"Primer grupo de columnas",closeTab:"Cerrar tab",showTabs:"Mostrar ms tabs",resetTreeMap:"Volver a la vista original",navTreeMap:"Elevar a mismo nivel",nextTab:"Siguiente tab",prevTab:"Tab anterior",multitextSection:"Aadir elemento",multitextextraSection:"Retire el elemento",showChart:"Espectculo chart",hideChart:"Esconder chart",resizeChart:"Cambiar el tamao el chart"},richtext:{underline:"Subrayar",bold:"Negrita",italic:"Itlico"},combo:{select:"Seleccionar",selectAll:"Seleccionar todo",unselectAll:"Deselecciona todo"},message:{ok:"OK",cancel:"Cancelar"},comments:{send:"Enviar",confirmMessage:"El comentario ser eliminado. Ests seguro?",edit:"Corregir",remove:"Suprimir",placeholder:"Escriba aqu..",moreComments:"Ms comentarios"},filter:{less:"menos",lessOrEqual:"menor o igual",greater:"mayor",greaterOrEqual:"mayor o igual",contains:"contiene",notContains:"no contiene",equal:"igual",notEqual:"no es igual",beginsWith:"comienza con",notBeginsWith:"no comienza con",endsWith:"termina con",notEndsWith:"no termina con",between:"entre",notBetween:"no entre"},timeboard:{seconds:"segundos"}},R.locales["fr-FR"]={groupDelimiter:" ",groupSize:3,decimalDelimiter:",",decimalSize:2,minusPosition:"before",minusSign:"-",dateFormat:"%d/%m/%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",price:"{obj} ",priceSettings:null,calendar:{monthFull:["Janvier","Fvrier","Mars","Avril","Mai","Juin","Juillet","Aot","Septembre","Octobre","Novembre","Dcembre"],monthShort:["Jan","Fv","Mar","Avr","Mai","Juin","Juil","Au","Sep","Oct","Nov","Dc"],dayFull:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],hours:"Heures",minutes:"Minutes",done:"Fini",clear:"Effacer",today:"Aujourd'hui"},dataExport:{page:"Page",of:"sur"},PDFviewer:{of:"sur",automaticZoom:"Zoom automatique",actualSize:"Taille actuelle",pageFit:"Taille de la page",pageWidth:"Largeur de la page",pageHeight:"Hauteur de page",enterPassword:"Entrez le mot de passe",passwordError:"Mauvais mot de passe"},aria:{calendar:"alendrier",increaseValue:"Augmenter la valeur",decreaseValue:"Diminution de la valeur",navMonth:["Le mois prcdent","Le mois prochain"],navYear:["Anne prcdente","L'anne prochaine"],navDecade:["Dcennie prcdente","Suivant dcennie"],dateFormat:"%d %F %Y",monthFormat:"%F %Y",yearFormat:"%Y",hourFormat:"Heures: %H",minuteFormat:"Minutes: %i",removeItem:"Retirer l'lment",pages:["Premire page","Page prcdente","Page suivante","Dernire page"],page:"Page",headermenu:"Menu de titre",openGroup:"Ouvrir groupe de colonnes ",closeGroup:"Fermer groupe de colonnes",closeTab:"Fermer tab",showTabs:"Montrer plus tabs",resetTreeMap:"Revenir  la vue originale",navTreeMap:"Niveau suprieur",nextTab:"Prochain tab",prevTab:"Prcdent tab",multitextSection:"Ajouter l'lment",multitextextraSection:"Retirer l'lment",showChart:"Montrer chart",hideChart:"Cacher chart",resizeChart:"Redimensionner chart"},richtext:{underline:"Souligner",bold:"Gras",italic:"Italique"},combo:{select:"Slectionner",selectAll:"Tout slectionner",unselectAll:"Tout dselectionner"},message:{ok:"OK",cancel:"Annuler"},comments:{send:"Envoyer",confirmMessage:"Le commentaire sera supprim. tes-vous sr?",edit:"Modifier",remove:"Effacer",placeholder:"crivez ici..",moreComments:"Plus de commentaires"},filter:{less:"moins",lessOrEqual:"infrieur ou gal",greater:"plus grand",greaterOrEqual:"suprieur ou gal",contains:"contient",notContains:"ne contient",equal:"gal",notEqual:"pas gal",beginsWith:"commence par",notBeginsWith:"ne commence par",endsWith:"se termine par",notEndsWith:"pas se termine par",between:"entre",notBetween:"pas entre"},timeboard:{seconds:"secondes"}},R.locales["it-IT"]={groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,minusPosition:"before",minusSign:"-",dateFormat:"%d/%m/%Y",timeFormat:"%H:%i",longDateFormat:"%j %F %Y",fullDateFormat:"%j %F %Y %H:%i",am:null,pm:null,price:" {obj}",priceSettings:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,minusPosition:"before",minusSign:"-"},calendar:{monthFull:["gennaio","febbraio","marzo","aprile","maggio","giugno","luglio","agosto","settembre","ottobre","novembre","dicembre"],monthShort:["gen","feb","mar","apr","mag","giu","lug","ago","set","ott","nov","dic"],dayFull:["domenica","luned","marted","mercoled","gioved","venerd","sabato"],dayShort:["dom","lun","mar","mer","gio","ven","sab"],hours:"Orario",minutes:"Minuti",done:"Pronto",clear:"Pulisci",today:"Oggi"},dataExport:{page:"Pagina",of:"di"},PDFviewer:{of:"di",automaticZoom:"Zoom automatico",actualSize:"Dimensione reale",pageFit:"Dimensioni della pagina",pageWidth:"Larghezza della pagina",pageHeight:"Altezza della pagina",enterPassword:"Inserisci la password",passwordError:"Password errata"},aria:{calendar:"Calendario",increaseValue:"Aumenta il valore",decreaseValue:"Riduci il valore",navMonth:["Il mese scorso","Il prossimo mese"],navYear:["L'anno scorso","L'anno prossimo"],navDecade:["Decennio precedente","Prossimo decennio"],dateFormat:"%j %F %Y",monthFormat:"%F %Y",yearFormat:"%Y",hourFormat:"Orario: %H",minuteFormat:"Minuti: %i",removeItem:"Rimuovere l'elemento",pages:["Prima pagina","Pagina precedente","Pagina successiva","Ultima pagina"],page:"Pagina",headermenu:"Menu del titolo",openGroup:"Aperto gruppo di colonne",closeGroup:"Chiudi gruppo di colonne",closeTab:"Chiudi tab",showTabs:"Mostra pi tabs",resetTreeMap:"Tornare alla vista originale",navTreeMap:"Livello superiore",nextTab:"Tab successivo",prevTab:"Tab precedente",multitextSection:"Aggiungi elemento",multitextextraSection:"Rimuovere l'elemento",showChart:"Mostrare grafico",hideChart:"Nascondere grafico",resizeChart:"Ridimensionare grafico"},richtext:{underline:"Sottolineare",bold:"Grassetto",italic:"Corsivo"},combo:{select:"Selezionare",selectAll:"Seleziona tutto",unselectAll:"Deseleziona tutto"},message:{ok:"OK",cancel:"Annullare"},comments:{send:"Inviare",confirmMessage:"Il commento verr rimosso. Sei sicuro?",edit:"Correggere",remove:"Elimina",placeholder:"Digitare qui..",moreComments:"Altri commenti"},filter:{less:"meno",lessOrEqual:"minore o uguale",greater:"maggiore",greaterOrEqual:"maggiore o uguale",contains:"contiene",notContains:"non contiene",equal:"uguale",notEqual:"non uguale",beginsWith:"inizia con",notBeginsWith:"non inizia con",endsWith:"finisce con",notEndsWith:"non termina con",between:"tra",notBetween:"non tra"},timeboard:{seconds:"secondi"}},R.locales["ja-JP"]={groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2,minusPosition:"before",minusSign:"-",dateFormat:"%Y.%m.%d",timeFormat:"%H:%i",longDateFormat:"%Y%m%d",fullDateFormat:"%Y.%m.%d %H:%i",price:"{obj}",priceSettings:{groupSize:3,groupDelimiter:",",decimalDelimiter:"",decimalSize:0,minusPosition:"before",minusSign:"-"},calendar:{monthFull:["1","2","3","4","5","6","7","8","9","10","11","12"],monthShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayFull:["","","","","","",""],dayShort:["","","","","","",""],hours:"",minutes:"",done:"",clear:"",today:""},dataExport:{page:"",of:""},PDFviewer:{of:"",automaticZoom:"",actualSize:"",pageFit:"",pageWidth:"",pageHeight:"",enterPassword:"",passwordError:""},aria:{calendar:"",increaseValue:"",decreaseValue:"",navMonth:["",""],navYear:["",""],navDecade:["","10"],dateFormat:"%Y%m%d",monthFormat:"%Y%m",yearFormat:"%Y",hourFormat:": %H",minuteFormat:": %i",removeItem:"",pages:["","","",""],page:"",headermenu:"",openGroup:"",closeGroup:"",closeTab:"",showTabs:"",resetTreeMap:"",navTreeMap:"",nextTab:"",prevTab:"",multitextSection:"",multitextextraSection:"",showChart:"",hideChart:"",resizeChart:""},richtext:{underline:"",bold:"",italic:""},combo:{select:"",selectAll:"",unselectAll:""},message:{ok:"OK",cancel:""},comments:{send:"",confirmMessage:". ",edit:"",remove:"",placeholder:"..",moreComments:""},filter:{less:"",lessOrEqual:"",greater:"",greaterOrEqual:"",contains:"",notContains:"",equal:"",notEqual:"",beginsWith:"",notBeginsWith:"",endsWith:"",notEndsWith:"",between:"",notBetween:""},timeboard:{seconds:""}},R.locales["pt-BR"]={groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,minusPosition:"before",minusSign:"-",dateFormat:"%d/%m/%Y",timeFormat:"%G:%i",longDateFormat:"%d de %F de %Y",fullDateFormat:"%d de %F de %Y %G:%i",am:null,pm:null,price:"R$ {obj}",priceSettings:{groupDelimiter:".",groupSize:3,decimalDelimiter:",",decimalSize:2,minusPosition:"before",minusSign:"-"},fileSize:["b","Kb","Mb","Gb","Tb","Pb","Eb"],calendar:{monthFull:["Janeiro","Fevereiro","Maro","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],dayFull:["Domingo","Segunda-Feira","Tera-Feira","Quarta-Feira","Quinta-Feira","Sexta-Feira","Sbado"],dayShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sb"],hours:"Horas",minutes:"Minutos",done:"Feito",clear:"Limpar",today:"Hoje"},dataExport:{page:"Pgina",of:"de"},PDFviewer:{of:"de",automaticZoom:"Zoom automtico",actualSize:"Tamanho atual",pageFit:"Tamanho da pgina",pageWidth:"Largura da pgina",pageHeight:"Altura da pgina",enterPassword:"Digite a senha",passwordError:"Senha incorreta"},aria:{calendar:"Calendrio",increaseValue:"Aumentar o valor",decreaseValue:"Diminuir o valor",navMonth:["Ms anterior","Prximo ms"],navYear:["Ano anterior","Prximo ano"],navDecade:["Dcada anterior","Prxima dcada"],dateFormat:"%d de %F de %Y",monthFormat:"%F de %Y",yearFormat:"%Y",hourFormat:"Horas: %G",minuteFormat:"Minutos: %i",removeItem:"Remover elemento",pages:["Primeira pgina","Pgina anterior","Prxima pgina","ltima pgina"],page:"Pgina",headermenu:"Menu de ttulos",openGroup:"Grupo coluna aberta",closeGroup:"Fechar grupo de colunas",closeTab:"Fechar tab",showTabs:"Mostre mais tabs",resetTreeMap:"oltar  vista original",navTreeMap:"Upar",nextTab:"Prximo tab",prevTab:"Anterior tab",multitextSection:"Adicionar elemento",multitextextraSection:"Remover elemento",showChart:"Exposio chart",hideChart:"Esconder chart",resizeChart:"Redimensionar chart"},richtext:{underline:"Sublinhado",bold:"Negrito",italic:"itlico"},combo:{select:"Selecionar",selectAll:"Selecionar tudo",unselectAll:"Desmarque todos"},message:{ok:"OK",cancel:"Cancelar"},comments:{send:"Enviar",confirmMessage:"Comentrio ser removido. Voc tem certeza?",edit:"Editar",remove:"Excluir",placeholder:"Digite aqui..",moreComments:"Mais comentrios"},filter:{less:"menos",lessOrEqual:"menor ou igual",greater:"maior",greaterOrEqual:"maior ou igual",contains:"contm",notContains:"no contm",equal:"igual",notEqual:"no  igual",beginsWith:"comea com",notBeginsWith:"no comea com",endsWith:"termina com",notEndsWith:"no termina com",between:"entre",notBetween:"no entre"},timeboard:{seconds:"segundos"}},R.locales["zh-CN"]={groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2,minusPosition:"before",minusSign:"-",dateFormat:"%Y/%m/%j",timeFormat:"%G:%i",longDateFormat:"%Y''%m''%j''",fullDateFormat:"%Y''%m''%j'' %G:%i",am:["",""],pm:["",""],price:"{obj}",priceSettings:{groupDelimiter:",",groupSize:3,decimalDelimiter:".",decimalSize:2,minusPosition:"inside",minusSign:"-"},calendar:{monthFull:["","","","","","","","","","","",""],monthShort:["","","","","","","","","","","",""],dayFull:["","","","","","",""],dayShort:["","","","","","",""],hours:"",minutes:"",done:"",clear:"",today:""},dataExport:{page:"",of:""},PDFviewer:{of:"",automaticZoom:"",actualSize:"",pageFit:"",pageWidth:"",pageHeight:"",enterPassword:"",passwordError:""},aria:{calendar:"",increaseValue:"",decreaseValue:"",navMonth:["",""],navYear:["",""],navDecade:["",""],dateFormat:"%Y''%m''%j''",monthFormat:"%Y''%m'",yearFormat:"%Y'",hourFormat:": %G",minuteFormat:": %i",removeItem:"",pages:["","","",""],page:"",headermenu:"",openGroup:"",closeGroup:"",closeTab:"",showTabs:"",resetTreeMap:"",navTreeMap:"",nextTab:"",prevTab:"",multitextSection:"",multitextextraSection:"",showChart:"",hideChart:"",resizeChart:""},richtext:{underline:"",bold:"",italic:""},combo:{select:"",selectAll:"",unselectAll:""},message:{ok:"",cancel:""},comments:{send:"",confirmMessage:"?",edit:"",remove:"",placeholder:"..",moreComments:""},filter:{less:"",lessOrEqual:"",greater:"",greaterOrEqual:"",contains:"",notContains:"",equal:"",notEqual:"",beginsWith:"",notBeginsWith:"",endsWith:"",notEndsWith:"",between:"",notBetween:""},timeboard:{seconds:""}},R.locales["ru-RU"]={groupDelimiter:" ",groupSize:3,decimalDelimiter:",",decimalSize:2,minusPosition:"before",minusSign:"-",dateFormat:"%d.%m.%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",price:"{obj} .",priceSettings:{groupDelimiter:" ",groupSize:3,decimalDelimiter:",",decimalSize:2,minusPosition:"before",minusSign:"-"},calendar:{monthFull:["","","","","Ma","","","","","O","",""],monthShort:["","","Ma","A","Ma","","","A","","","",""],dayFull:["","","","","","",""],dayShort:["","","","","","",""],hours:"",minutes:"",done:"oo",clear:"",today:""},dataExport:{page:"",of:""},PDFviewer:{of:"",automaticZoom:" ",actualSize:" ",pageFit:" ",pageWidth:" ",pageHeight:" ",enterPassword:" ",passwordError:" "},aria:{calendar:"",increaseValue:" ",decreaseValue:" ",navMonth:[" "," "],navYear:[" "," "],navDecade:["  ","  "],dateFormat:"%d %F %Y",monthFormat:"%F %Y",yearFormat:"%Y",hourFormat:": %H",minuteFormat:": %i",removeItem:" ",pages:[" "," "," "," "],page:"",headermenu:"  ",openGroup:"  ",closeGroup:"  ",closeTab:" ",showTabs:"  ",resetTreeMap:"   ",navTreeMap:"   ",nextTab:" ",prevTab:" ",multitextSection:" ",multitextextraSection:" ",showChart:" ",hideChart:" ",resizeChart:"  "},richtext:{underline:"",bold:"",italic:""},combo:{select:"",selectAll:" ",unselectAll:" "},message:{ok:"OK",cancel:""},comments:{send:"",confirmMessage:"  .  ?",edit:"",remove:"",placeholder:" ..",moreComments:" "},filter:{less:"",lessOrEqual:"  ",greater:"",greaterOrEqual:"  ",contains:"",notContains:" ",equal:"",notEqual:" ",beginsWith:" ",notBeginsWith:"  ",endsWith:"",notEndsWith:" ",between:"",notBetween:" "},timeboard:{seconds:""}},R.locales["be-BY"]={groupDelimiter:" ",groupSize:3,decimalDelimiter:",",decimalSize:2,minusPosition:"before",minusSign:"-",dateFormat:"%d.%m.%Y",timeFormat:"%H:%i",longDateFormat:"%d %F %Y",fullDateFormat:"%d.%m.%Y %H:%i",price:"{obj} .",priceSettings:{groupSize:3,groupDelimiter:" ",decimalDelimiter:",",decimalSize:0,minusPosition:"before",minusSign:"-"},calendar:{monthFull:["","","","","","","","","","","",""],monthShort:["","","","","","","","","","","",""],dayFull:["","","","","","",""],dayShort:["","","","","","",""],hours:"",minutes:"",done:"",today:"C",clear:""},dataExport:{page:"",of:""},PDFviewer:{of:"",automaticZoom:" ",actualSize:" ",pageFit:" ",pageWidth:" ",pageHeight:" ",enterPassword:" ",passwordError:" "},aria:{calendar:"",increaseValue:" ",decreaseValue:" ",navMonth:[" "," "],navYear:[" "," "],navDecade:["  ","  "],dateFormat:"%d %F %Y",monthFormat:"%F %Y",yearFormat:"%Y",hourFormat:"Hours: %h",minuteFormat:": %i",removeItem:" ",pages:[" "," "," "," "],page:"",headermenu:" ",openGroup:"  ",closeGroup:"  ",closeTab:" ",showTabs:"  ",resetTreeMap:"   ",navTreeMap:"   ",nextTab:" ",prevTab:" ",multitextSection:" ",multitextextraSection:" ",showChart:" ",hideChart:" ",resizeChart:"  "},richtext:{underline:"",bold:"",italic:""},combo:{select:"",selectAll:" ",unselectAll:" "},message:{ok:"",cancel:""},comments:{send:"",confirmMessage:"  .  ?",edit:"",remove:"",placeholder:" ..",moreComments:" "},filter:{less:"",lessOrEqual:"  ",greater:"",greaterOrEqual:"  ",contains:"",notContains:" ",equal:"",notEqual:" ",beginsWith:" ",notBeginsWith:"  ",endsWith:"",notEndsWith:" ",between:"",notBetween:" "},timeboard:{seconds:""}};var Zn=(t.protoUI({name:"spacer",defaults:{borderless:!0},$init:function(){this._viewobj.className+=" webix_spacer"}},mi.view),{name:"template",$init:function(e){var i=this._template_types[e.type];i&&(i.css&&e.css&&(this._viewobj.className+=" "+i.css),t.extend(e,i),e.borderless&&(delete e._inner,this._set_inner(e))),this._dataobj==this._viewobj?(this._dataobj=vt("DIV"),this._dataobj.className=" webix_template",this._viewobj.appendChild(this._dataobj)):this._dataobj.className+=" webix_template",this.attachEvent("onAfterRender",this._correct_height)},setValues:function(e,i){this.data=i?t.extend(this.data,e,!0):e,this.render()},getValues:function(){return this.data},$skin:function(){this._template_types.header.height=vi.barHeight-2*vi.borderWidth,this._template_types.section.height=vi.barHeight},_template_types:{header:{css:"webix_header"},section:{css:"webix_section",borderless:!0},clean:{css:"webix_clean",borderless:!0}},onClick_setter:function(e){return this.on_click=t.extend(this.on_click||{},e,!0),this._onClick||t.extend(this,_s),e},defaults:{template:le.empty},_render_me:function(){this._not_render_me=!1,this._probably_render_me(),this.resize()},_probably_render_me:function(){this._not_render_me||(this._not_render_me=!0,this.render())},src_setter:function(t){return this._not_render_me=!0,this.callEvent("onBeforeLoad",[])?(Z(t,A((function(t){this._settings.template=le(t),this._render_me(),this.callEvent("onAfterLoad",[])}),this)),t):""},content_setter:function(t){t&&(this._not_render_me=!0,this.render=function(){},this._dataobj.appendChild(F(t)),this._correct_height())},refresh:function(){this.render()},setHTML:function(t){this._settings.template=function(){return t},this.refresh()},setContent:function(t){this._dataobj.innerHTML="",this.content_setter(t)},$setSize:function(t,e){if(mi.api.$setSize.call(this,t,e)){if(this._probably_render_me(),this._settings.autoheight){var i=this.getTopParentView();clearTimeout(i._template_resize_timer),i._template_resize_timer=j(this.resize,this)}return!0}},$getSize:function(t,e){return!this._settings.autoheight||this._settings.type&&"clean"!=this._settings.type||(this._settings.height=this._get_auto_height()),mi.api.$getSize.call(this,t,e)},_correct_height:function(){this._settings.autoheight&&(this._last_size=null,this.resize())},_get_auto_height:function(){var t=0;return this.isVisible()&&!this.queryView((function(t){return t.config.collapsed}),"parent")&&(this._probably_render_me(),this._dataobj.style.height="auto",t=this._dataobj.scrollHeight,this._dataobj.style.height=""),t},_one_time_scroll:!0}),Qn={api:Zn,view:t.protoUI(Zn,bs,xi,Zt,he,H,mi.view)},ta={name:"scrollview",defaults:{scroll:"y",scrollSpeed:"300ms"},$init:function(){this._viewobj.className+=" webix_scrollview"},body_setter:function(t){t.borderless=!0,me._parent_cell=this,this._body_cell=be._view(t),this._dataobj.appendChild(this._body_cell._viewobj)},getChildViews:function(){return[this._body_cell]},getBody:function(){return this._body_cell},resizeChildren:function(){this._body_cell&&(this._desired_size=this._body_cell.$getSize(0,0),this._resizeChildren(),U("onResize",[]))},_resizeChildren:function(){var t=Math.max(this._content_width,this._desired_size[0]),e=Math.max(this._content_height,this._desired_size[2]);this._body_cell.$setSize(t,e);var i=this.getScrollState(),s=this._body_cell._content_height-this._content_height;s<i.y&&this.scrollTo(null,s),me._responsive_exception&&(me._responsive_exception=!1,this._desired_size=this._body_cell.$getSize(0,0),this._resizeChildren())},$getSize:function(t,e){var i=this._desired_size=this._body_cell.$getSize(0,0),s=mi.api.$getSize.call(this,t,e),n=this._native_scroll||Ot.scrollSize;return"x"==this._settings.scroll?(s[2]=Math.max(s[2],i[2])+n,s[3]=Math.min(s[3],i[3])+n):"y"==this._settings.scroll&&(s[0]=Math.max(s[0],i[0])+n,s[1]=Math.min(s[1],i[1])+n),s},$setSize:function(t,e){var i=Ot.scrollSize;Ot.scrollSize=this._native_scroll||i,(mi.api.$setSize.call(this,t,e)||me._force_resize)&&this._resizeChildren(),Ot.scrollSize=i},scroll_setter:function(t){var e=Ot.$customScroll;return"string"==typeof t&&0===t.indexOf("native-")&&(this._native_scroll=17,t=t.replace("native-",""),Ot.$customScroll=!1),t=bs.scroll_setter.call(this,t),Ot.$customScroll=e,t},_replace:function(t){this._body_cell.destructor(),this._body_cell=t,this._dataobj.appendChild(this._body_cell._viewobj),this.resizeChildren()},showView:function(t){var e=ke(t).$view;this.scrollTo(e.offsetLeft-e.parentNode.offsetLeft,e.offsetTop-e.parentNode.offsetTop)}},ea=(t.protoUI(ta,bs,H,mi.view),{name:"iframe",$init:function(){this._dataobj=this._contentobj,this._contentobj.innerHTML="<iframe style='width:100%; height:100%' frameborder='0' onload='var t = $$(this.parentNode.getAttribute(\"view_id\")); if (t) t.callEvent(\"onAfterLoad\",[]);' src='about:blank'></iframe>"},load:function(t){this.src_setter(t)},src_setter:function(t){return this.callEvent("onBeforeLoad",[])?(this.getIframe().src=t,t):""},getIframe:function(){return this._contentobj.getElementsByTagName("iframe")[0]},getWindow:function(){return this.getIframe().contentWindow}}),ia=(t.protoUI(ea,mi.view,H),{name:"accordion",defaults:{panelClass:"accordionitem",multi:!1,collapsed:!1},$init:function(){this._viewobj.setAttribute("role","tablist"),this._viewobj.setAttribute("aria-multiselectable","true")},_replace:function(t){Gn.api._replace.apply(this,arguments),t.collapsed_setter&&t.refresh&&t.refresh()},_parse_cells:function(){for(var t=this._settings.panelClass,e=this._collection,i=0;i<e.length;i++)!e[i].body&&!e[i].header||e[i].view||e[i].align||(e[i].view=t),E(e[i].collapsed)&&(e[i].collapsed=this._settings.collapsed);this._skin_render_collapse=!0,Gn.api._parse_cells.call(this),this._skin_render_collapse=!1;for(var s=0;s<this._cells.length;s++)this._cells[s].name==t&&this._cells[s].refresh(),this._cells[s]._accLastChild=!1;for(var n=!1,a=this._cells.length-1;a>=0&&!n;a--)this._cells[a]._settings.hidden||(this._cells[a]._accLastChild=!0,n=!0)},_afterOpen:function(t){if(!1===this._settings.multi&&!0!==this._skin_render_collapse)for(var e=0;e<this._cells.length;e++)t!=this._cells[e]&&!this._cells[e]._settings.collapsed&&this._cells[e].collapse&&this._cells[e].collapse();t.callEvent&&(t.callEvent("onViewShow",[]),je(t,this._signal_hidden_cells))},_canCollapse:function(t){if(!0===this._settings.multi||this._skin_render_collapse)return!0;for(var e=0;e<this._cells.length;e++)if(t!=this._cells[e]&&!this._cells[e]._settings.collapsed&&this._cells[e].isVisible()&&!this._cells[e].$nospace)return!0;return!1},$skin:function(){Gn.api.$skin.call(this),vi.accordionType&&(this.defaults.type=vi.accordionType)}}),sa={api:ia,view:t.protoUI(ia,Gn.view)},na=(t.protoUI({name:"headerlayout",defaults:{type:"accordion",multi:"mixed",collapsed:!1}},sa.view),{name:"accordionitem",$init:function(t){this._viewobj.innerHTML="<div tabindex='0' webix_ai_id='"+t.id+"'  class='webix_accordionitem_header'><div class='webix_accordionitem_button' ></div><div class='webix_accordionitem_label' ></div></div><div class='webix_accordionitem_body'></div>",this._contentobj=this._viewobj,this._headobj=this._contentobj.childNodes[0],t.header||(this._headobj.style.display="none"),this._headlabel=this._contentobj.childNodes[0].childNodes[1],this._headbutton=this._contentobj.childNodes[0].childNodes[0],this._bodyobj=this._contentobj.childNodes[1],this._viewobj.className+=" webix_accordionitem",this._head_cell=this._body_cell=null,this._cells=!0,this._bodyobj.setAttribute("role","tabpanel"),this._headobj.setAttribute("role","tab"),this.attachEvent("onKeyPress",this._onKeyPress)},_remove:function(){this.body_setter()},_replace:function(t){this._body_cell.destructor(),this._body_cell=t,this._bodyobj.appendChild(this._body_cell._viewobj),this.resize()},_id:"webix_ai_id",getChildViews:function(){return[this._body_cell]},body_setter:function(t){return"object"!=e(t)&&(t={template:t}),t._inner={top:!0,left:!0,right:!0,bottom:!0},me._parent_cell=this,this._body_cell=be._view(t),this._bodyobj.appendChild(this._body_cell._viewobj),t},header_setter:function(t){return t&&(t=le(t)),t},headerAlt_setter:function(t){return t&&(t=le(t)),t},$getSize:function(t,e){var i=this._body_cell.$getSize(0,0),s=this._settings._inner;s&&(t+=(s.left?0:1)+(s.right?0:1),e+=(s.top?0:1)+(s.bottom?0:1));var n=0,a=pi.api.$getSize.call(this,0,0);a[0]=(a[0]||i[0])+t,a[1]>=1e5&&(a[1]=i[1]),a[1]+=t,a[2]=(a[2]||i[2])+e;var r=a[3]<1e5;return r||(a[3]=i[3]),a[3]+=e,this.getParentView()._vertical_orientation?this._settings.collapsed?a[2]=a[3]=this._getHeaderSize()+e:this._settings.header&&(n=this._settings.headerHeight):(this._settings.collapsed&&(a[0]=a[1]=this._getHeaderSize()+t),this._settings.header&&(n=this._settings.headerHeight)),r||(a[2]+=n,a[3]+=n),x(this,a,!0),a},on_click:{webix_accordionitem_header:function(t){return this._toggle(t),!1},webix_accordionitem_header_v:function(t){return this._toggle(t),!1}},_toggle:function(){this.define("collapsed",!this._settings.collapsed)},collapsed_setter:function(t){if(!1!==this._settings.header){var e=this.getParentView();if(e){if(t)if(e._canCollapse(this))this._collapse();else{var i=0;if(e._cells.length>1)for(var s=0;s<e._cells.length;s++){var n=e._cells[s];if(this!=n&&n.isVisible()&&n.expand){n.expand(),this._collapse(),i=1;break}}if(!i)return}else this._expand();this._settings.collapsed=t,t||e._afterOpen(this),this.refresh(),me._ui_creation||this.resize(),e.callEvent("onAfter"+(t?"Collapse":"Expand"),[this._settings.id]),this._settings.$noresize=t}return t}},collapse:function(){this.define("collapsed",!0),ni._moveChildFocus(this)},expand:function(){this.define("collapsed",!1)},_show:function(){this.show()},_hide:function(){this.hide()},_expand:function(){this._bodyobj.style.display="",Et(this.$view,"collapsed"),Et(this._headobj,"collapsed"),this._headobj.setAttribute("aria-expanded","true"),this._childRefresh(this._body_cell)},_childRefresh:function(t){var e=this;t.refresh?t.refresh():t.getChildViews&&t.getChildViews().forEach((function(t){return e._childRefresh(t)}))},_collapse:function(){this._settings.headerAlt&&(this._headlabel.innerHTML=this._settings.headerAlt()),this._bodyobj.style.display="none",Dt(this.$view,"collapsed"),Dt(this._headobj,"collapsed"),this._headobj.setAttribute("aria-expanded","false")},refresh:function(){var t=this._settings[this._settings.collapsed?"headerAlt":"header"]||this._settings.header;t&&(this._headlabel.innerHTML=t(),this._headbutton.setAttribute("aria-label",t()));var e=this.getParentView()._vertical_orientation?"vertical":"horizontal";this._viewobj.className.indexOf(" "+e)<0&&Dt(this._viewobj,e)},_getHeaderSize:function(){return this._settings.collapsed?this._settings.headerAltHeight:this._settings.headerHeight},$setSize:function(t,e){if(mi.api.$setSize.call(this,t,e)||this._getHeaderSize()!=this._last_set_header_size){t=this._content_width,e=this._content_height;var i=this._last_set_header_size=this._getHeaderSize();if(this._settings.header)if(this._headobj.style.height=i+"px",this._headobj.style.width="auto",this._headobj.style[Ot.transform]="",this._headobj.style.borderBottomWidth=(this._settings.collapsed?0:1)+"px",this.getParentView()._vertical_orientation||!this._settings.collapsed)e-=this._getHeaderSize();else if(this._settings.collapsed){this._headobj.style.width=e+"px",this._headobj.style.height=t+3+"px";var s=Math.floor(e/2-t/2)+(t-this._settings.headerAltHeight)/2;this._headobj.style[Ot.transform]="rotate(90deg) translate("+s+"px, "+(s+1)+"px)"}this._settings.collapsed||(this._body_cell.$setSize(t,e),this._last_size_y=e)}else if(!this._settings.collapsed){var n=this._body_cell;this._last_size_y&&n.$setSize(this._content_width,this._last_size_y)}},$skin:function(){this.defaults.headerAltHeight=this.defaults.headerHeight=vi.barHeight-2*vi.borderWidth},defaults:{header:!1,headerAlt:!1,body:""}}),aa=(t.protoUI(na,_s,H,mi.view),{name:"resizearea",defaults:{dir:"x"},$init:function(t){var e=this,i=t.dir||"x",s=F(t.container),n="x"==i?"width":"height",a=t.margin?t.margin+"px":0;this._key_property="x"==i?"left":"top",this._viewobj=vt("DIV",{class:"webix_resize_area webix_dir_"+i}),a&&(a="x"==i?a+" 0 "+a:"0 "+a+" 0 "+a),this._dragobj=vt("DIV",{class:"webix_resize_handle_"+i,style:a?"padding:"+a:""},"<div class='webix_handle_content'></div>"),this._originobj=vt("DIV",{class:"webix_resize_origin_"+i}),t[n]&&(this._originobj.style[n]=t[n]+(t.border?1:0)+"px",this._dragobj.style[n]=t[n]+"px"),t.cursor&&(this._dragobj.style.cursor=this._originobj.style.cursor=this._viewobj.style.cursor=t.cursor),this._moveev=pe(s,Ot.mouse.move,this._onmove,{bind:this}),this._upev=pe(document,Ot.mouse.up,this._onup,{bind:this}),Ot.touch&&(this._moveev_t=pe(s,Ot.touch.move,(function(t){return e._onmove(t,"touch")}),{passive:!1}),this._upev_t=pe(document,Ot.touch.up,this._onup,{bind:this})),this._dragobj.style[this._key_property]=this._originobj.style[this._key_property]=t.start+"px",s.appendChild(this._viewobj),s.appendChild(this._dragobj),s.appendChild(this._originobj)},_onup:function(){this.callEvent("onResizeEnd",[this._last_result]),fe(this._moveev),fe(this._upev),Ot.touch&&(fe(this._moveev_t),fe(this._upev_t)),wt(this._viewobj),wt(this._dragobj),wt(this._originobj),this._viewobj=this._dragobj=this._originobj=null},_onmove:function(t,e){var i=$t(t);this._last_result=("x"==this._settings.dir?i.x:i.y)+this._settings.start-this._settings.eventPos,this._dragobj.style[this._key_property]=this._last_result+"px",this.callEvent("onResize",[this._last_result]),"touch"===e&&St(t)}}),ra=(t.protoUI(aa,H,ai),{name:"resizer",defaults:{width:7,height:7},$init:function(t){var e=this;f(this.getParentView(),"Resizer can't be initialized outside a layout"),this._viewobj.className+=" webix_resizer";var i=this.getParentView()._margin;_e(this._viewobj,Ot.mouse.down,(function(t){return e._rsDown(t,"mouse")})),Ot.touch&&_e(this._viewobj,Ot.touch.down,(function(t){return e._rsDown(t,"touch")}));var s=this._getResizeDir();this._rs_started=!1,this._resizer_dir=s,this._resizer_dim="x"==s?"width":"height","x"==s?t.height=0:t.width=0,i>0?(this._viewobj.className+=" webix_resizer_v"+s,this._viewobj.style.marginRight="-"+i+"px","x"==s?t.width=i:t.height=i,this.$nospace=!0):this._viewobj.className+=" webix_resizer_"+s,this._viewobj.innerHTML="<div class='webix_resizer_content'></div>","y"==s&&i>0&&(this._viewobj.style.marginBottom="-"+(t.height||this.defaults.height)+"px"),this._viewobj.setAttribute("webix_disable_drag","true"),this._viewobj.setAttribute("tabindex","-1"),this._viewobj.setAttribute("aria-grabbed","false")},_rsDown:function(t,e){var i=this,s=this._getResizerCells();if(s&&!this._settings.disabled){this._rs_started=!0,this._rs_process=$t(t),this._rsLimit=[],this._viewobj.setAttribute("aria-grabbed","true");for(var n=0;n<2;n++)s[n].$view.setAttribute("aria-dropeffect","move");this._viewobj.setAttribute("aria-dropeffect","move"),this._rsStart(t,s[0]);var a=pe(document,Ot[e].up,(function(t){return fe(a),i._rsUp(t)}))}},_rsUp:function(){this._rs_started=!1,this._rs_process=!1},_rsStart:function(t,e){var i,s,n,a,r;i=this._resizer_dir,this.getParentView()._viewobj.style.position="relative",n=kt(this._viewobj),a=kt(this.getParentView()._viewobj),r=n[i]-a[i],s=kt(e.$view)[i]-kt(this.getParentView().$view)[i],this._rs_progress=[i,e,r,s],this._resizeStick=new be.resizearea({container:this.getParentView()._viewobj,dir:i,eventPos:this._rs_process[i],start:r-1,height:this.$height,width:this.$width,border:1,margin:this.getParentView()._padding["x"===i?"left":"top"]}),this._resizeStick.attachEvent("onResizeEnd",A(this._rsEnd,this)),this._resizeStick.attachEvent("onResize",A(this._rsResizeHandler,this)),Dt(document.body,"webix_noselect",1)},_getResizeDir:function(){return this.getParentView()._vertical_orientation?"y":"x"},_rsResizeHandler:function(){var t,e,i,s,n,a,r,o,l;if(this._rs_progress)for(t=this._getResizerCells(),s=this._rs_progress[0],i=this._resizeStick._last_result-this._rs_progress[2],o=this._rsGetDiffCellSizes(t,s,i),l=t[0]["$"+this._resizer_dim]+t[1]["$"+this._resizer_dim],n=0;n<2;n++){e=n?-i:i,a=t[n].$getSize(0,0);var h="y"==s?a[2]:a[0],c="y"==s?a[3]:a[1];if(h===c&&(h=t[n]._settings["y"==s?"minHeight":"minWidth"]||3,c=t[n]._settings["y"==s?"maxHeight":"maxWidth"]||1e5),e>0&&c&&c<=o[n]||e<0&&h&&h>=o[n])return this._rsLimit[n]=e>0?c:h,r=this._rsGetLimitCellSizes(t,s),void(this._resizeStick._dragobj.style["y"==s?"top":"left"]=this._rs_progress[3]+r[0]+"px");o[n]<3?this._resizeStick._dragobj.style["y"==s?"top":"left"]=this._rs_progress[3]+n*l+1+"px":this._rsLimit[n]=null}},_getResizerCells:function(){var t,e,i;for(t=this.getParentView()._cells,e=0;e<t.length;e++)if(t[e]==this)return(i=[this._getRsCell(t,e,1,-1),this._getRsCell(t,e,1,1)])[0]&&i[1]||(i=null),i},_getRsCell:function(t,e,i,s){var n=t[e+s*i];return n&&n._settings.hidden?this._getRsCell(t,e,i+1,s):n&&n._settings.$noresize?null:n},_rsEnd:function(t){if(void 0!==t){var e,i,s,n,a=this.getParentView()._vertical_orientation;if(this._resizerStick=null,this._rs_progress){if(i=this._rs_progress[0],s=t-this._rs_progress[2],(e=this._getResizerCells())[0]&&e[1]){n=this._rsGetCellSizes(e,i,s);for(var r=0;r<2;r++){var o=e[r].$getSize(0,0);if(a?o[2]==o[3]:Math.abs(o[1]-o[0])<3)e[r]._settings[this._resizer_dim]=n[r],e[r]._bubble_size&&e[r]._bubble_size(this._resizer_dim,n[r],a);else{var l=e[r].$view[a?"offsetHeight":"offsetWidth"];e[r]._settings.gravity=n[r]/l*e[r]._settings.gravity}}e[0].resize();for(var h=0;h<2;h++)e[h].callEvent&&e[h].callEvent("onViewResize",[]),e[h].$view.removeAttribute("aria-dropeffect");U("onLayoutResize",[e])}this._rs_progress=!1}this._rs_progress=!1,this._rs_started=!1,this._rsLimit=null,Et(document.body,"webix_noselect"),this._viewobj.setAttribute("aria-grabbed","false"),this._viewobj.removeAttribute("aria-dropeffect")}},_rsGetLimitCellSizes:function(t){var e,i,s;return s=t[0]["$"+this._resizer_dim]+t[1]["$"+this._resizer_dim],this._rsLimit[0]?i=s-(e=this._rsLimit[0]):this._rsLimit[1]&&(e=s-(i=this._rsLimit[1])),[e,i]},_rsGetDiffCellSizes:function(t,e,i){for(var s=[],n="height"==this._resizer_dim?"offsetHeight":"offsetWidth",a=0;a<2;a++)s[a]=t[a].$view[n]+(a?-1:1)*i;return s},_rsGetCellSizes:function(t,e,i){var s,n,a;if(this._rsLimit[0]||this._rsLimit[1])n=this._rsGetLimitCellSizes(t,e);else for(n=this._rsGetDiffCellSizes(t,e,i),s=0;s<2;s++)n[s]<0&&(a=n[0]+n[1],n[s]=1,n[1-s]=a-1);return n}}),oa=(t.protoUI(ra,_s,ri,mi.view),{name:"align",defaults:{borderless:!0,left:0,top:0,right:0,bottom:0},$init:function(){this._viewobj.className+=" webix_view_align"},_remove:function(){this.body_setter({})},_replace:function(t){this._body_cell.destructor(),this._body_cell=t,this._viewobj.appendChild(this._body_cell._viewobj),this.resize()},getChildViews:function(){return[this._body_cell]},body_setter:function(t){return t._inner={top:!1,left:!1,right:!1,bottom:!1},me._parent_cell=this,this._body_cell=be._view(t),this._viewobj.appendChild(this._body_cell._viewobj),t},align_setter:function(t){"string"==typeof t&&(t=t.split(",")),this._x_align=this._y_align=this._p_align="";for(var e=0;e<t.length;e++){var i=t[e];"center"!==i&&"left"!==i&&"right"!==i||(this._x_align=i),"top"!==i&&"bottom"!==i&&"middle"!==i||(this._y_align=i),"absolute"===i&&(this._x_align=this._y_align=this._p_align="precise")}return t},getBody:function(){return this._body_cell},$setSize:function(t,e){var i,s;mi.api.$setSize.call(this,t,e),this._p_align?(i=t-this._settings.left-this._settings.right,s=e-this._settings.top-this._settings.bottom):(i=this._desired_size[0]||t,s=this._desired_size[2]||e),this._body_cell.$setSize(i,s);var n=this._body_cell._viewobj;"center"==this._x_align?n.style.marginLeft=Math.ceil((t-i)/2)+"px":"right"==this._x_align?n.style.marginLeft=t-i+"px":n.style.marginLeft=(this._p_align?this._settings.left:0)+"px","middle"==this._y_align?n.style.marginTop=Math.ceil((e-s)/2)+"px":"bottom"==this._y_align?n.style.marginTop=e-s+"px":n.style.marginTop=(this._p_align?this._settings.top:0)+"px"},$getSize:function(t,e){var i=this._desired_size=this._body_cell.$getSize(0,0),s=pi.api.$getSize.call(this,0,0);return this._p_align&&(t+=this._settings.left+this._settings.right,e+=this._settings.top+this._settings.bottom),!this._x_align||this._p_align?(s[0]=i[0]+t,s[1]=i[1]+t):(s[0]=(s[0]||i[0])+e,s[1]+=t),!this._y_align||this._p_align?(s[2]=i[2]+e,s[3]=i[3]+e):(s[2]=(s[2]||i[2])+e,s[3]+=e),s}}),la=(t.protoUI(oa,mi.view),{name:"multiview",defaults:{animate:{}},setValue:function(t){ke(t).show()},getValue:function(){return this.getActiveId()},$init:function(){this._active_cell=0,this._vertical_orientation=1,this._viewobj.style.position="relative",this._viewobj.className+=" webix_multiview",this._back_queue=[]},_ask_render:function(t,e){var i=ke(t);i._render_hash||(i._render_queue=[],i._render_hash={}),i._render_hash[e]||(i._render_hash[e]=!0,i._render_queue.push(e))},_render_activation:function(t){var e=ke(t);if(this._settings.keepViews&&(e._viewobj.style.display=""),this._back_queue[this._back_queue.length-2]!=t?(10==this._back_queue.length&&this._back_queue.splice(0,1),this._back_queue.push(t)):this._back_queue.splice(this._back_queue.length-1,1),e._render_hash){for(var i=0;i<e._render_queue.length;i++){var s=ke(e._render_queue[i]);s&&s.render()}e._render_queue=[],e._render_hash={}}},addView:function(t,e){var i=!E(e)&&e<=this._active_cell?1:0,s=Un.api.addView.apply(this,arguments);return this._cells.length>1&&(this._settings.keepViews?ke(s)._viewobj.style.display="none":wt(ke(s)._viewobj),this._active_cell+=i),s},_replace:function(t){if(!t._settings.borderless){var e=S(this._settings._inner);t._settings._inner=e;var i=t._viewobj.style;i.borderTopWidth=i.borderBottomWidth=i.borderLeftWidth=i.borderRightWidth="1px",this._fix_container_borders(i,e)}Un.api._replace.apply(this,arguments)},_beforeRemoveView:function(t){if(t==this._active_cell){var e=t?t-1:1;this._cells[e]&&(this._animation_promise=null,this._show(this._cells[e],!1))}t<this._active_cell&&this._active_cell--},_hide:function(){},_parse_cells:function(t){t=t||this._collection;for(var e=0;e<t.length;e++)t[e]._inner=this._settings.borderless?{top:1,left:1,right:1,bottom:1}:this._settings._inner||{};Un.api._parse_cells.call(this,t);for(var i=1;i<this._cells.length;i++)this._settings.keepViews?this._cells[i]._viewobj.style.display="none":wt(this._cells[i]._viewobj);for(var s=0;s<t.length;s++){var n=this._cells[s];n._cells&&!n._render_borders||(this._fix_container_borders(n._viewobj.style,n._settings._inner),n._viewobj.setAttribute("role","tabpanel"))}this._render_activation(this.getActiveId())},cells_setter:function(t){f(t&&t.length,"Multiview must have at least one view in 'cells'"),this._collection=t},_getDirection:function(t,e){var i=(this._settings.animate||{}).direction,s="top"==i||"bottom"==i;return t<e?s?"bottom":"right":s?"top":"left"},_show:function(e,i){var s=arguments,n=this,a=this.getParentView();if(a&&a.getTabbar){var r=a.getTabbar();r.blockEvent(),r.setValue(e._settings.$id||e._settings.id),r.unblockEvent()}if(this._animation_promise)return this._animation_promise.then((function(){return n._show.apply(n,s)}));for(var o=-1,l=0;l<this._cells.length;l++)if(this._cells[l]==e){o=l;break}if(!(o<0||o==this._active_cell)){var h=this._cells[this._active_cell],c=this._cells[o];if(h.$getSize(0,0),(i||E(i))&&this._settings.animate){var u=t.extend({},this._settings.animate);this._settings.keepViews&&(u.keepViews=!0),u.direction=this._getDirection(o,this._active_cell),u=ai._mergeSettings(i||{},u);var _=Ci.formLine(c._viewobj,h._viewobj,u);c.$getSize(0,0),c.$setSize(this._content_width,this._content_height);var p=u.callback;u.callback=function(){Ci.breakLine(_,this._settings.keepViews),this._animation_promise=null,u.wait_animation.resolve(),p&&p.call(this),p=u.master=u.callback=null,this.resize()},u.master=this,this._active_cell=o,this._render_activation(this.getActiveId()),Ci(_,u),this._animation_promise=u.wait_animation=d.defer()}else this._settings.keepViews?h._viewobj.style.display="none":(wt(h._viewobj),this._viewobj.appendChild(this._cells[l]._viewobj)),this._active_cell=o,this.resizeChildren(),this._render_activation(this.getActiveId());c.callEvent&&(c.callEvent("onViewShow",[]),je(c,this._signal_hidden_cells)),this.callEvent("onViewChange",[h._settings.id,c._settings.id])}},$getSize:function(t,e){if(!this._cells.length)return pi.api.$getSize.call(this,0,0);w(this,!0);var i=this._cells[this._active_cell].$getSize(0,0);if(this._settings.fitBiggest)for(var s=0;s<this._cells.length;s++)if(s!=this._active_cell)for(var n=this._cells[s].$getSize(0,0),a=0;a<4;a++)i[a]=Math.max(i[a],n[a]);var r=pi.api.$getSize.call(this,0,0);return r[1]>=1e5&&(r[1]=0),r[3]>=1e5&&(r[3]=0),r[0]=(r[0]||i[0])+t,r[1]=(r[1]||i[1])+t,r[2]=(r[2]||i[2])+e,r[3]=(r[3]||i[3])+e,y(0,r),r},$setSize:function(t,e){this._cells.length&&(this._layout_sizes=[t,e],pi.api.$setSize.call(this,t,e),this._cells[this._active_cell].$setSize(t,e))},isVisible:function(t,e){return e&&e!=this.getActiveId()?(t&&this._ask_render(e,t),!1):mi.api.isVisible.call(this,t,this._settings.id)},getActiveId:function(){return this._cells.length?this._cells[this._active_cell]._settings.id:null},back:function(t){if(t=t||1,this.callEvent("onBeforeBack",[this.getActiveId(),t])){if(this._back_queue.length>t){var e=this._back_queue[this._back_queue.length-t-1];return ke(e).show(),e}return null}return null},_insertBeforeView:function(t,e){!this._settings.keepViews&&e&&e!=this._cells[this._active_cell]||Un.api._insertBeforeView.call(this,t,e)}}),ha=(t.protoUI(la,Un.view),{name:"tabview",setValue:function(t,e){this._cells[0].setValue(t,e)},getValue:function(){return this._cells[0].getValue()},getTabbar:function(){return this._cells[0]},getMultiview:function(){return this._cells[1]},addView:function(t){var e=this.getMultiview().addView(t.body);return t.id=e,t.value=t.header,delete t.body,delete t.header,this.getTabbar().addOption(t),e},removeView:function(t){var e=this.getTabbar();e.removeOption(t),e.refresh()},$init:function(e){this.$ready.push(this._init_tabview_handlers);var i=e.cells,s=[];f(i&&i.length,"tabview must have cells collection");for(var n=i.length-1;n>=0;n--){var a=i[n].body||i[n];a.id||(a.id="view"+T()),s[n]={value:i[n].header,id:a.id,close:i[n].close,width:i[n].width,hidden:!!i[n].hidden},i[n]=a}var r={view:"tabbar",multiview:!0},o={view:"multiview",cells:i,animate:!!e.animate};e.value&&(r.value=e.value),e.tabbar&&t.extend(r,e.tabbar,!0),e.multiview&&t.extend(o,e.multiview,!0),r.options=r.options||s,e.rows=[r,o],delete e.cells,delete e.tabs},_init_tabview_handlers:function(){this.getTabbar().attachEvent("onOptionRemove",(function(t){var e=ke(t);if(e){var i=e.getParentView();i&&i.removeView(e)}}))}}),ca=(t.protoUI(ha,Gn.view),{name:"carousel",defaults:{scrollSpeed:"300ms",type:"clean",navigation:{},animate:!0},$init:function(){this._viewobj.className+=" webix_carousel",this._layout=null,this._dataobj=null,this._active_cell=0,this.$ready.unshift(this._initLayout),this.$ready.push(this._after_init_call)},addView:function(t,e){var i=this._layout.addView(t,e);return this._fix_after_view_add(),i},removeView:function(t){this._layout.removeView(t),this._fix_after_view_add()},_replace:function(t,e){this._layout._replace(t,e),this._fix_after_view_add()},_fix_after_view_add:function(){this._cells=this._layout._cells,this._renderPanel(),this.setActiveIndex(Math.min(this._active_cell,this._cells.length-1))},_initLayout:function(){var e=this;this._layout&&this._layout.destructor&&this._layout.destructor();var i="";this.config.cols?(i="cols",this._vertical_orientation=0):(i="rows",this._vertical_orientation=1);var s={borderless:!0,type:"clean"};s[i]=I(this._settings[i]);for(var n=["type","margin","marginX","marginY","padding","paddingX","paddingY"],a={},r=0;r<n.length;r++)this._settings[n[r]]&&(a[n[r]]=this._settings[n[r]]);t.extend(s,a,!0),me._parent_cell=this,this._layout=be._view(s),this._viewobj.appendChild(this._layout._viewobj),this._cells=this._layout._cells,this._layout._show=A(ca._show,this),this._layout.adjustScroll=A(ca.adjustScroll,this);var o=W("onReconstruct",(function(t){t==e._layout&&e._setScroll()}));this.attachEvent("onDestruct",(function(){Y(o)})),this._contentobj=this._viewobj.firstChild},_onKeyPress:function(t,e){this._settings.navigation.items&&"tab"===e.target.getAttribute("role")&&this._moveActive(t,e),pi.api._onKeyPress.call(this,t,e)},getChildViews:function(){return[this._layout]},getLayout:function(){return this._layout},_after_init_call:function(){this._contentobj.setAttribute("touch_scroll",this._vertical_orientation?"y":"x"),this._layout.attachEvent("onAfterScroll",A((function(){this.callEvent("onShow",[this.getActiveId()])}),this)),je(this._layout,(function(t){t._viewobj.setAttribute("role","tabpanel")}))},adjustScroll:function(t){var e,i=this._vertical_orientation?this._content_height:this._content_width;return this._vertical_orientation?(e=Math.round(t.f/i),t.f=e*i):(e=Math.round(t.e/i),t.e=e*i),this._active_cell=-e,this._settings.navigation&&this._renderNavItems(),!0},_show:function(t){var e,i,s,n,a,r;for(s=-1,i=this._layout,e=0;e<i._cells.length;e++)if(i._cells[e]==t){s=e;break}s<0||s==this._active_cell||(this._active_cell=s,n=i._vertical_orientation?this._content_height:this._content_width,a=-(i._vertical_orientation?0:s*n),r=-(i._vertical_orientation?s*n:0),this.scrollTo(a,r),this.callEvent("onShow",[i._cells[this._active_cell]._settings.id]),this._settings.navigation&&this._renderPanel())},scrollTo:function(t,e){Ii&&this._settings.animate?Ii._set_matrix(this._contentobj,t,e,this._settings.scrollSpeed||"100ms"):(this._contentobj.style.marginLeft=t+"px",this._contentobj.style.marginTop=e+"px")},navigation_setter:function(t){return this._mergeSettings(t,{type:"corner",buttons:!0,items:!0}),t},showNext:function(){this._active_cell<this._layout._cells.length-1&&this.setActiveIndex(this._active_cell+1)},showPrev:function(){this._active_cell>0&&this.setActiveIndex(this._active_cell-1)},setActiveIndex:function(t){f(t<this._layout._cells.length,"Not existing index in collection"),ke(this._layout._cells[t]._settings.id).show()},getActiveIndex:function(){return this._active_cell},$getSize:function(t,e){var i=this._layout.$getSize(0,0),s=mi.api.$getSize.call(this,t,e);return this._layout._vertical_orientation?(s[0]=Math.max(s[0],i[0]),s[1]=Math.min(s[1],i[1])):(s[2]=Math.max(s[2],i[2]),s[3]=Math.min(s[3],i[3])),s},$setSize:function(t,e){var i=this._layout,s=i._cells.length,n=mi.api.$setSize.call(this,t,e),a=this._content_height*(i._vertical_orientation?s:1),r=this._content_width*(i._vertical_orientation?1:s);n?(this._contentobj.style.height=a+"px",this._contentobj.style.width=r+"px",i.$setSize(r,a),this._setScroll()):i.$setSize(r,a)},_setScroll:function(){var t=this._layout,e=this._active_cell||0,i=t._vertical_orientation?this._content_height:this._content_width,s=-(t._vertical_orientation?0:e*i),n=-(t._vertical_orientation?e*i:0);this.scrollTo(s,n),this._settings.navigation&&this._renderPanel()},getActiveId:function(){var t=this._layout._cells[this._active_cell];return t?t._settings.id:null},setActive:function(t){ke(t).show()}}),da=(t.protoUI(ca,H,ps,mi.view),{name:"proxy",body_setter:function(t){return me._parent_cell=this,this._body_cell=be._view(t),this._viewobj.appendChild(this._body_cell._viewobj),t},getChildViews:function(){return[this._body_cell]},$setSize:function(t,e){mi.api.$setSize.call(this,t,e),this._body_cell.$setSize(this.$width,this.$height)},$getSize:function(t,e){var i=mi.api.$getSize.call(this,t,e),s=this._body_cell.$getSize(t,e);return s[0]=Math.max(i[0],s[0]),s[1]=Math.min(i[1],s[1]),s[2]=Math.max(i[2],s[2]),s[3]=Math.min(i[3],s[3]),s[4]=Math.max(i[4],s[4]),s},_replace:function(t){this._body_cell.destructor(),this._body_cell=t,this._viewobj.appendChild(t._viewobj),this.resize()}}),ua=(t.protoUI(da,mi.view),{name:"portlet",defaults:{layoutType:"wide",icon:"wxi-drag"},$longTouchLimit:!0,$init:function(t){this._viewobj.style.position="relative",t.header&&t.body&&(t.body=[{template:t.header,type:"header"},t.body]),this.attachEvent("onDestruct",(function(){this._markerbox=null})),this.$ready.push(this._init_drag_area)},_refreshChildScrolls:function(t){je(t,(function(t){t._restore_scroll_state&&t._restore_scroll_state()}))},_init_drag_area:function(){var t=this.getChildViews();if(t.length>1)Ai.addDrag(t[0].$view,this);else if(this._settings.icon){var e=vt("div",{class:"portlet_drag"},"<span class='webix_icon "+this._settings.icon+"'></span>");this._viewobj.appendChild(e),Ai.addDrag(e,this)}else Ai.addDrag(this.$view,this)},body_setter:function(t){return this.rows_setter(B(t)?t:[t])},_targetInside:function(t){var e=this;return!!t.queryView((function(t){return t===e}),"parent")},markDropArea:function(t,e){if(!t)return wt(this._markerbox);t=ke(t),this._targetInside(t)||(this._markerbox||(this._markerbox=vt("div",null,"&nbsp;")),-1===["left","right","top","bottom"].indexOf(e)&&(e=""),this._markerbox.className="portlet_marker"+e,t.$view.appendChild(this._markerbox))},movePortlet:function(t,e){if(!this._targetInside(t)){var i=t.getParentView(),s=this.getParentView(),n=i.index(t),a=s.index(this);if(U("onBeforePortletMove",[s,i,this,t,e])){me._freeze_resize=!0;var r=s!=i?1:0,o=i._vertical_orientation;"top"==e||"bottom"==e?(1!==o&&(i=be({type:t._settings.layoutType,rows:[]},i,n+r),be(t,i,0),n=0,r=1),"bottom"==e&&(r+=1)):"left"!=e&&"right"!=e||(0!==o&&(i=be({type:t._settings.layoutType,cols:[]},i,n+r),be(t,i,0),n=0,r=1),"right"==e&&(r+=1)),a<n&&(r-=1),be(this,i,n+r),"replace"==e&&be(t,s,a),this._removeEmptySource(s),me._freeze_resize=!1,t.resize(),s.$destructed||(s.resize(),this._refreshChildScrolls(s)),U("onAfterPortletMove",[s,i,this,t,e])}}},_removeEmptySource:function(t){for(var e,i=0;t.getChildViews().length<=i;)e=t,t=t.getParentView(),i=1;e&&t.removeView(e)},$drag:function(t){return Dt(this._viewobj,"portlet_in_drag"),Ai._drag_context={source:t,from:t},U("onClick",[]),Ii._start_context&&j((function(){Ii._start_context=null})),this._viewobj.innerHTML},$dragDestroy:function(t,e){Et(this._viewobj,"portlet_in_drag"),wt(e),this._portlet_drop_target&&(this.movePortlet(this._portlet_drop_target,this._portlet_drop_mode),this._portlet_drop_target=this._portlet_drop_mode=null,this.markDropArea())},_getDragItemPos:function(){return kt(this.$view)},$dragPos:function(t,e){var i=$t(e),s=document.body.scrollTop||document.documentElement.scrollTop||0,n=document.body.scrollLeft||document.documentElement.scrollLeft||0,a=document.elementFromPoint(i.x-n,i.y-s),r=a?ke(a):null,o=this._portlet_drop_target=this._getPortletTarget(r),l=this._portlet_drop_mode=this._getPortletMode(this._portlet_drop_target,e);(o==this||o&&!U("onPortletDrag",[this,o,l]))&&(o=l=this._portlet_drop_target=this._portlet_drop_mode=null),this.markDropArea(o,l);var h=Ai._drag_context;t.y+=h.y_offset,t.x+=h.x_offset,Ai._skip=!0},_getPortletMode:function(t,e){var i="",s="";if(t&&e){var n=kt(t.$view),a=$t(e),r=a.x-n.x-n.width/2,o=a.y-n.y-n.height/2;(s=t._settings.mode)||(s=Math.abs(r)*(n.height/n.width)>Math.abs(o)?"cols":"rows"),"cols"==s?i=r>=0?"right":"left":"rows"==s&&(i=o>=0?"bottom":"top")}return i||s},_getPortletTarget:function(t){for(;t;){if(t.movePortlet)return t;t=t.getParentView()}}}),_a=(t.protoUI(ua,Gn.view),{name:"abslayout",$init:function(){this.$view.className+=" webix_abslayout",delete this.rows_setter,delete this.cols_setter,this._collection=[]},cells_setter:function(t){this._collection=t},_parse_cells:function(){for(var t=0;t<this._collection.length;t++)this._collection[t]._inner={};Un.api._parse_cells.call(this,this._collection)},$getSize:function(){for(var t=pi.api.$getSize.call(this,0,0),e=null,i=0;i<this._cells.length;i++)this._cells[i]._settings.relative&&(e=this._cells[i].$getSize(0,0));return e&&(t[1]>=1e5&&(t[1]=0),t[3]>=1e5&&(t[3]=0),t[0]=Math.max(t[0],e[0]),t[1]=Math.max(t[1],e[1]),t[2]=Math.max(t[2],e[2]),t[3]=Math.max(t[3],e[3])),t},$setSize:function(t,e){this._layout_sizes=[t,e],w(this),pi.api.$setSize.call(this,t,e),this._set_child_size(t,e),y(0,[t,e])},_set_child_size:function(t,e){for(var i=0;i<this._cells.length;i++){var s=this._cells[i],n=s._settings,a=s.$getSize(0,0);n.relative?(n.left=n.top=0,s.$setSize(t,e)):s.$setSize(a[0],a[2]);for(var r=s.$view,o=["left","right","top","bottom"],l=0;l<o.length;l++){var h=o[l];h in n&&(r.style[h]=n[h]+"px")}}}}),pa={api:_a,view:t.protoUI(_a,Un.view)},fa={name:"gridlayout",defaults:{autoplace:!0,gridColumns:2,gridRows:2,margin:10,padding:10},gridRows_setter:function(t){return this._actual_rows=t},removeView:function(t){pa.api.removeView.call(this,t),this._do_compact(),this.callEvent("onChange",[])},_check_default_pos:function(t){if(t.dx=t.dx||1,t.dy=t.dy||1,E(t.y)||E(t.x)){for(var e=this._buildMatrix(),i=0;i<this._actual_rows;i++)for(var s=0;s<this._settings.gridColumns;s++)if(!e[s][i]&&this._isFree(e,s,i,s+t.dx,i+t.dy))return t.x=s,void(t.y=i);t.x=0,t.y=this._actual_rows}var n=t.x+t.dx-this._settings.gridColumns;n>0&&(t.dx-=n)},_replace:function(t,e){if(E(e)){for(var i=0;i<this._cells.length;i++)this._cells[i].destructor();this._collection=t,this._parse_cells()}else this._check_default_pos(t.config),this._cells.push(t),this.$view.appendChild(t._viewobj),this._reserveSpace(t.config,t.config.id);this._do_compact(!0);var s=this.getFormView();s&&s._recollect_elements(),this._silent||this.callEvent("onChange",[])},_isFree:function(t,e,i,s,n){for(var a=e;a<s;a++)for(var r=i;r<n;r++)if(!t[a]||t[a][r])return!1;return!0},_markMatrix:function(t,e,i){for(var s=0;s<e.dx;s++)for(var n=0;n<e.dy;n++)t[s+e.x][n+e.y]=i},_canMoveRight:function(t,e,i){for(var s=this._settings.gridColumns,n=e.x+e.dx;n+i.dx<=s;n++)if(this._isFree(t,n,i.y,n+i.dx,i.y+i.dy))return n-i.x;return 0},_canMoveLeft:function(t,e,i){for(var s=e.x-i.dx;s>=0;s--)if(this._isFree(t,s,i.y,s+i.dx,i.y+i.dy))return i.x-s;return 0},_canMoveTop:function(t,e,i){for(var s=e.y-i.dy;s>=0;s--)if(this._isFree(t,i.x,s,i.x+i.dx,s+i.dy))return i.y-s;return 0},_buildMatrix:function(t){for(var e=[],i=0;i<this._settings.gridColumns;i++)e[i]=[];for(var s=0;s<this._cells.length;s++){var n=this._cells[s].config;n.id===t||n.hidden||this._markMatrix(e,n,n.id)}return e},_do_compact:function(t){(this._compact()||t)&&this._apply_new_grid()},_compact:function(){if(!this._settings.autoplace)return!1;var t=this._settings.gridColumns,e=this._actual_rows,i=this._buildMatrix(),s=!1;t:for(var n=e-1;n>=0;n--){for(var a=t-1;a>=0;a--)if(i[a][n])continue t;s=!0;for(var r=0;r<this._cells.length;r++){var o=this._cells[r].config;!o.hidden&&o.y>=n&&(o.y-=1)}}return s},_reserveSpace:function(t,e){if(t.x-=Math.max(0,t.x+t.dx-this._settings.gridColumns),this._settings.autoplace){for(var i=[],s=this._buildMatrix(e),n=0;n<this._cells.length;n++){var a=this._cells[n].config;a.id===e||a.hidden||a.y<t.y+t.dy&&a.y+a.dy>t.y&&a.x<t.x+t.dx&&a.x+a.dx>t.x&&i.push(a)}for(var r=[],o=0;o<i.length;o++){var l=i[o];this._markMatrix(s,l,0);var h=this._canMoveRight(s,t,l);if(h)l.x+=h;else{var c=this._canMoveLeft(s,t,l);if(c)l.x-=c;else{var d=this._canMoveTop(s,t,l);d?l.y-=d:(l.y=t.y+t.dy,r.push(l))}}this._markMatrix(s,l,l.id)}for(var u=0;u<r.length;u++)this._reserveSpace(r[u],r[u].id)}else t.y-=Math.max(0,t.y+t.dy-this._settings.gridRows)},_apply_new_grid:function(){for(var t=this._settings.gridRows,e=0;e<this._cells.length;e++){var i=this._cells[e].config;i.hidden||(t=Math.max(t,i.y+i.dy))}this._actual_rows!=t&&(this._actual_rows=t,this.resize()),this._set_child_size()},moveView:function(e,i){i=t.extend(ke(e).config,i,!0),this._reserveSpace(i,e),this._do_compact(!0),this.callEvent("onChange",[])},serialize:function(t){for(var e=[],i=0;i<this._cells.length;i++)if(t)e.push(t.call(this,this._cells[i]));else{var s=this._cells[i].config;e.push({id:s.id,name:s.name,x:s.x,y:s.y,dx:s.dx,dy:s.dy})}return e},clearAll:function(){for(var t=0;t<this._cells.length;t++)this._cells[t].destructor();this._cells=[],this.callEvent("onChange",[])},restore:function(e,i){i=i||this._settings.factory,e=I(e),this._silent=!0;for(var s={},n=0;n<e.length;n++){var a,r=e[n],o=ke(r.id);o?(t.extend(o.config,r,!0),a=o.config.id):(o=i.call(this,r),a=this.addView(o)),s[a]=1}for(var l=this._cells.length-1;l>=0;l--)s[this._cells[l].config.id]||(this._cells[l].destructor(),this._cells.splice(l,1));this._apply_new_grid(),this._silent=!1},$getSize:function(){for(var t=pi.api.$getSize.call(this,0,0),e=0;e<this._cells.length;e++)this._cells[e].$getSize(0,0);var i=this._settings.cellWidth,s=this._settings.cellHeight,n=this._getActualSize(0,0,this._settings.gridColumns,this._actual_rows);return i&&(t[0]=n.dx+2*n.x),s&&(t[2]=n.dy+2*n.y),t},_getActualSize:function(t,e,i,s){var n=this._settings.margin,a=this._settings.paddingX||this._settings.padding,r=this._settings.paddingY||this._settings.padding,o=this._settings.cellWidth;o||(o=(this.$width-2*a+n)/this._settings.gridColumns-n);var l=this._settings.cellHeight;return l||(l=(this.$height-2*r+n)/this._actual_rows-n),{x:a+(o+n)*t,y:r+(l+n)*e,dx:Math.ceil(o+(o+n)*(i-1)),dy:Math.ceil(l+(l+n)*(s-1))}},_set_child_size:function(){for(var t=0;t<this._cells.length;t++){var e=this._cells[t],i=e._settings,s=this._getActualSize(i.x,i.y,i.dx,i.dy);e.$getSize(0,0),e.$setSize(s.dx,s.dy);var n=e.$view;n.style.left=s.x+"px",n.style.top=s.y+"px"}}},ga={api:fa,view:t.protoUI(fa,pa.view)},ma={name:"dashboard",$longTouchLimit:!0,$init:function(){Ai.addDrag(this.$view,this),Ai.addDrop(this.$view,this,!0)},_isDragNode:function(t){if(!t.getAttribute||t.getAttribute("webix_disable_drag")||t.getAttribute("webixignore"))return!1;var e=t.getAttribute("contentEditable");return"INPUT"!=t.tagName&&"TEXTAREA"!=t.tagName&&"true"!=e&&""!=e&&(-1!=(t.className||"").toString().indexOf("panel_drag")?t:!(!t.parentNode||t==this.$view)&&this._isDragNode(t.parentNode))},$dragCreate:function(t,e){if(!e.target||!this._isDragNode(e.target))return!1;var i=ke(e);i.$resizeMove||(i=i.queryView((function(t){return t.$resizeMove}),"parent"));var s=kt(this.$view),n=$t(e),a=Ai._drag_context={source:i,from:this,dashboard:{sx:n.x-s.x-parseInt(i.$view.style.left)+this._settings.margin/2,sy:n.y-s.y-parseInt(i.$view.style.top)+this._settings.margin/2}};return this.callEvent("onBeforeDrag",[a,e])?(this._addDragMarker(i._settings.dx,i._settings.dy),U("onClick",[]),Ii._start_context&&j((function(){Ii._start_context=null})),i.$view):void 0},_addDragMarker:function(t,e){var i=this._dragMarker=vt("div",{class:"panel_target"}),s=this._getActualSize(0,0,t,e);i.style.width=s.dx+"px",i.style.height=s.dy+"px",this.$view.appendChild(this._dragMarker)},$drop:function(t,e,i){var s=Ai._drag_context,n={x:s.dashboard.x,y:s.dashboard.y};if(this.callEvent("onBeforeDrop",[s,i])){if(s.from===this){var a=s.source.config;this.moveView(a.id,n)}else{if(!(s.from&&s.from.callEvent&&s.from.callEvent("onBeforeDropOut",[s,i])))return;for(var r=s.source.length-1;r>=0;r--){var o=I(n);o.name=s.source[r],o.dx=s.dashboard.dx,o.dy=s.dashboard.dy,o.id=o.name+":"+T(),(o=this._settings.factory.call(this,o))&&this.addView(o)}}this.callEvent("onAfterDrop",[s,i])}},$dragDestroy:function(t,e){e.style.zIndex=1,wt(this._dragMarker),this._dragMarker=null,this._apply_new_grid()},_getPosFromCoords:function(t,e,i){var s=this._settings.margin,n=this._settings.paddingX||this._settings.padding,a=this._settings.paddingY||this._settings.padding,r=this._settings.cellWidth;r||(r=(this.$width-2*n+s)/this._settings.gridColumns-s);var o=this._settings.cellHeight;return o||(o=(this.$height-2*a+s)/this._actual_rows-s),t+=i?s:-n,e+=i?s:-a,t=Math.round(t/(r+s)),e=Math.round(e/(o+s)),{x:t=Math.max(0,Math.min(t,this._settings.gridColumns-(i?0:1))),y:e=Math.max(0,Math.min(e,this._actual_rows)),width:r,height:o,margin:s,rx:t*(r+s)+n,ry:e*(o+s)+a}},$dragOut:function(t,e,i,s){var n=Ai._drag_context;this.callEvent("onDragOut",[n,s]),this._dragMarker&&n.external&&(wt(this._dragMarker),this._dragMarker=null)},$dragIn:function(e,i,s){var n=Ai._drag_context;if(this.callEvent("onBeforeDragIn",[n,s])){if(!this._dragMarker){if(!n.from||!n.from.getItem)return!1;if(!this._settings.factory)return!1;var a=n.from.getItem(n.source[0]);t.extend(n,{external:!0,dashboard:{dx:a.dx,dy:a.dy}},!0),this._addDragMarker(a.dx,a.dy)}if(n.external){var r=this._dragMarker,o=$t(s),l=kt(this.$view),h=this._getPosFromCoords(o.x-l.x,o.y-l.y);t.extend(n.dashboard,h,!0),r.style.left=h.rx+"px",r.style.top=h.ry+"px"}return!0}},$dragPos:function(e,i){var s=Ai._drag_context,n=$t(i),a=kt(this.$view),r=s.dashboard,o=this._getPosFromCoords(n.x-a.x-r.sx,n.y-a.y-r.sy);e.x=n.x-r.sx-a.x,e.y=n.y-r.sy-a.y;var l=this._dragMarker;l.style.left=o.rx+"px",l.style.top=o.ry+"px",t.extend(r,o,!0)}},va=(t.protoUI(ma,ga.view),{name:"panel",$init:function(t){if(t.header&&t.body){var i=t.header;"object"!==e(i)&&(i={template:t.header,type:"header",css:"webix_header"}),t.body=[i,t.body]}Dt(this.$view,"panel_drag_view"),this.$ready.push(this._init_drag_area)},_init_drag_area:function(){var t=this.getChildViews(),e=1===t.length?this:t[1];if(this._settings.icon){var i=vt("div",{class:"panel_icon"},"<span class='webix_icon "+this._settings.icon+" panel_icon_span'></span>");e!=this&&(e.$view.style.position="relative"),e.$view.appendChild(i)}},body_setter:function(t){return this.rows_setter(B(t)?t:[t])},$resizeEnd:function(t){var e=this.getParentView();if(e&&e._getPosFromCoords){var i=e._getPosFromCoords(t.mx,t.my,!0),s=Math.max(i.x,1),n=Math.max(i.y,1);e.moveView(this._settings.id,{dx:s,dy:n})}},$resizeMove:function(t){var e=this.getParentView();if(e&&e._getPosFromCoords){t.mx=t.x,t.my=t.y;var i=e._getPosFromCoords(t.x,t.y,!0);t.x=(i.width+i.margin)*i.x-i.margin,t.y=(i.height+i.margin)*i.y-i.margin}}}),ba=(t.protoUI(va,Gn.view,Vi),{$init:function(){t.extend(this,ns,!0)},name:"flexlayout"}),wa=(t.protoUI(ba,Gn.view),{name:"datalayout",$init:function(){this.data.provideApi(this,!0),this.data.attachEvent("onStoreUpdated",A(this.render,this))},_parse_cells:function(){return this._origin_cells||(this._origin_cells=this._collection,this._collection=[{}]),Gn.api._parse_cells.call(this,this._collection)},setValue:function(t){this.parse(t)},getValue:function(){for(var t=this._origin_cells.length,e=0;e<this._cells.length;e++){var i=this.data.order[Math.floor(e/t)],s=this.data.getItem(i);this._save_data(this._cells[e],s)}return this.data.serialize()},_save_data:function(e,i){var s=e._settings.name;if(s){var n=null;e.getValues?n=e.getValues():e.getValue?n=e.getValue():e.serialize&&(n=e.serialize()),"$value"==s?t.extend(i,n,!0):i[s]=n}else{var a=e._cells;if(a)for(var r=0;r<a.length;r++)this._save_data(a[r],i)}},_fill_data:function(t,e){var i,s=t._settings.name;if(s)i="$value"==s?e:e[s],t.setValues?t.setValues(i,!1,"auto"):t.setValue?t.setValue(i,"auto"):t.parse&&(t.openAll&&(i=I(i)),t.parse(i));else{var n=t._cells;if(n)for(var a=0;a<n.length;a++)this._fill_data(n[a],e)}},render:function(t,e,i){var s=this._origin_cells.length;if(t&&"update"===i)for(var n=this.getItem(t),a=this.getIndexById(t),r=0;r<s;r++)this._fill_data(this._cells[a*s+r],n);else{for(var o=this._collection=[],l=this.data.order,h=0;h<l.length;h++)if(s)for(var c=0;c<s;c++)o.push(I(this._origin_cells[c]));else o.push(this.getItem(l[h]));if(o.length||o.push({}),this.reconstruct(),s)for(var d=0;d<l.length;d++)for(var u=this.getItem(l[d]),_=0;_<s;_++){var p=this._cells[d*s+_];this._fill_data(p,u)}}}}),ya={api:wa,view:t.protoUI(wa,Gi,Gn.view)},xa={$init:function(){t.extend(this,ns,!0)},name:"flexdatalayout"},ka=(t.protoUI(xa,ya.view),{name:"popup",$init:function(){var t=this;this._settings.head=!1,this.$view.className+=" webix_popup";var e=W("onClick",(function(e){return t._hide(e)}));this.attachEvent("onDestruct",(function(){Y(e)})),this.attachEvent("onHide",this._hide_point)},$skin:function(){Ti.api.$skin.call(this),this.defaults.padding=vi.popupPadding,this.defaults.point=!vi.popupNoPoint,this.defaults.borderless=vi.borderlessPopup},close:function(){wt(this._point_element),Ti.api.close.call(this)},$getSize:function(t,e){return Ti.api.$getSize.call(this,t+2*this._settings.padding,e+2*this._settings.padding)},$setSize:function(t,e){mi.api.$setSize.call(this,t,e),t=this._content_width-2*this._settings.padding,e=this._content_height-2*this._settings.padding,this._contentobj.style.padding=this._settings.padding+"px",this._headobj.style.display="none",this._body_cell.$setSize(t,e)},_inner_body_set:function(t){void 0===t.borderless&&(t.borderless=!1)},head_setter:function(){},_set_point:function(t,e,i,s){this._hide_point(),document.body.appendChild(this._point_element=vt("DIV",{class:"webix_point_"+t},"")),this._point_element.style.zIndex=this._viewobj.style.zIndex,this._point_element.style.position=s?"fixed":"absolute",this._point_element.style.top=i+"px",this._point_element.style.left=e+"px"},_hide_point:function(){this._point_element=wt(this._point_element)}}),Ca={api:ka,view:t.protoUI(ka,Ti.view)},$a={name:"toolbar",defaults:{type:"toolbar"},_render_borders:!0,_form_classname:"webix_toolbar",_form_vertical:!1,$init:function(t){t.borderless||(this._contentobj.style.borderWidth="1px",this._settings._inner={top:!1,left:!1,right:!1,bottom:!1}),this._contentobj.className+=" "+this._form_classname,this._viewobj.setAttribute("role","toolbar")},_recollect_elements:function(){var t=this;t.elements={},je(this,(function(e){if(e._settings.name&&e.getValue&&e.setValue&&(t.elements[e._settings.name]=e,e.mapEvent&&e.mapEvent({onbeforetabclick:t,onaftertabclick:t,onitemclick:t,onchange:t})),e.setValues||e._fill_data)return!1}));var e=this._values;if(this.setDirty(!1),e){var i=this._values;for(var s in t.elements)e[s]&&i[s]!=e[s]&&(i[s]=e[s],this.setDirty(!0))}},_parse_cells_ext_end:function(){this._recollect_elements()},_parse_cells_ext:function(t){var e=this._settings;return e.elements&&!t&&(this._collection=t=e.elements,this._vertical_orientation=this._form_vertical,delete e.elements),this._settings.elementsConfig&&this._rec_apply_settings(this._collection,e.elementsConfig),t},_rec_apply_settings:function(e,i){for(var s=0;s<e.length;s++){var n=e[s];t.extend(n,i);var a,r=i;n.elementsConfig&&(r=t.extend(t.extend({},n.elementsConfig),i)),(a=n.body?[n.body]:n.rows||n.cols||n.cells||n.body)&&this._rec_apply_settings(a,r)}},$getSize:function(t,e){var i=Gn.api.$getSize.call(this,t,e),s=this.getParentView(),n=this._vertical_orientation?3:1;return s&&this._vertical_orientation!=s._vertical_orientation&&(i[n]+=1e5),x(this,i,!0),i},render:function(){},refresh:function(){this.render()}},Sa={api:$a,view:t.protoUI($a,bs,Zt,Js,Gn.view,Hi)},Ia={name:"form",defaults:{type:"form",autoheight:!0},_default_height:-1,_form_classname:"webix_form",_form_vertical:!0,$init:function(){this._viewobj.setAttribute("role","form")},$getSize:function(t,e){this._scroll_y&&!this._settings.width&&(t+=Ot.scrollSize);var i=Gn.api.$getSize.call(this,t,e);return!this._settings.scroll&&this._settings.autoheight||(i[2]=this._settings.height||this._settings.minHeight||0,i[3]=this._settings.height||1e5),i}},Aa=(t.protoUI(Ia,Sa.view),{name:"fieldset",defaults:{borderless:!0,$cssName:"webix_fieldset",paddingX:18,paddingY:30},$init:function(t){t.body=t.body||{};var e=this.defaults.$cssName;this._viewobj.className+=" "+e,this._viewobj.innerHTML="<fieldset><legend class='"+e+"_label"+(t.required?" webix_required":"")+"'></legend><div class='"+e+"_body'></div></fieldset>"},label_setter:function(t){return this._viewobj.firstChild.childNodes[0].innerHTML=t,t},getChildViews:function(){return[this._body_view]},body_setter:function(t){return me._parent_cell=this,this._body_view=be(t,this._viewobj.firstChild.childNodes[1]),t},getBody:function(){return this._body_view},resizeChildren:function(){if(this._body_view){var t=this.$width-this._settings.paddingX,e=this.$height-this._settings.paddingY,i=this._body_view.$getSize(0,0);i[0]>t&&(t=i[0]),i[2]>e&&(e=i[2]),this._body_view.$setSize(t,e),this.resize()}},$getSize:function(t,e){w(this,!0),t+=this._settings.paddingX,e+=this._settings.paddingY;var i=this._body_view.$getSize(t,e),s=this._last_body_size=mi.api.$getSize.call(this,t,e);return s[0]<i[0]&&(s[0]=i[0]),s[2]<i[2]&&(s[2]=i[2]),s[1]>i[1]&&(s[1]=i[1]),s[3]>i[3]&&(s[3]=i[3]),s[1]<s[0]&&(s[1]=s[0]),s[3]<s[2]&&(s[3]=s[2]),y(0,s),s},$setSize:function(t,e){mi.api.$setSize.call(this,t,e)&&(t=Math.min(this._last_body_size[1],t),e=Math.min(this._last_body_size[3],e),this._body_view.$setSize(t-this._settings.paddingX,e-this._settings.paddingY))}}),Da={api:Aa,view:t.protoUI(Aa,mi.view)},Ea={name:"forminput",defaults:{$cssName:"webix_forminput",labelWidth:80,labelAlign:"left",paddingY:0,paddingX:0},setValue:function(t,e){this._body_view.setValue?this._body_view.setValue(t,e):this._body_view.setValues&&this._body_view.setValues(t,!1,e)},focus:function(){return!!this._body_view.focus&&this._body_view.focus()},getValue:function(){return this._body_view.getValue?this._body_view.getValue():this._body_view.getValues?this._body_view.getValues():void 0},getBody:function(){return this._body_view},$skin:function(){this._inputPadding=vi.inputPadding,this._inputSpacing=vi.inputSpacing,this._labelTopHeight=vi.labelTopHeight},$init:function(){this.$ready.push((function(){var t=this._viewobj.firstChild.childNodes[0],e=this._viewobj.firstChild.childNodes[1],i=this._settings;if("top"!=i.labelPosition?(i.labelWidth=i.label?this._getLabelWidth(i.labelWidth,i.label,i.required):0,i.paddingX=i.labelWidth+this._inputSpacing):(i.paddingY=this._labelTopHeight,i.paddingX=this._inputSpacing),!i.label||!i.labelWidth&&"top"!=i.labelPosition)return t.style.display="none",e.style.padding="0 "+this._inputSpacing/2+"px",i.paddingX=this._inputSpacing,void(i.paddingY=0);"top"==i.labelPosition?(t.style.lineHeight=this._labelTopHeight-this._inputPadding+"px",t.className+=" "+this.defaults.$cssName+"_label_top",e.style.padding="0 "+this._inputSpacing/2+"px"):t.style.width=i.paddingX-this._inputSpacing/2+"px",t.style.textAlign=i.labelAlign,i.value&&this.setValue(i.value,"auto")}))},_getLabelWidth:function(t,e,i){return"auto"==t&&(t=jt(e,"webix_inp_label"+(i?" webix_required":"")).width),t?Math.max(t,vi.dataPadding):0},setBottomText:function(t){var e=this._settings;if(void 0!==t){if(e.bottomLabel==t)return;e.bottomLabel=t}var i=(e.invalid?e.invalidMessage:"")||e.bottomLabel;this._invalidMessage&&wt(this._invalidMessage),i&&(this.$view.style.position="relative",this._invalidMessage=vt("div",{class:"webix_inp_bottom_label",role:e.invalid?"alert":"","aria-relevant":"all",style:"position:absolute; bottom:0px; padding:2px 0; background:"+vi.backColor+"; left:"+(this._inputSpacing/2+(e.label?e.labelWidth:0))+"px; "},i),this._viewobj.appendChild(this._invalidMessage))}};function ja(t){return t.tagName?t.tagName.toLowerCase():null}function Va(t,e){if(!t.getAttribute)return null;var i=t.getAttribute(e);return i?i.toLowerCase():null}function Na(){var t=ja(this);return Ta[t]?Ta[t](this):Ta.other(this)}t.protoUI(Ea,Da.view);var Ta={radio:function(t){for(var e=0;e<t.length;e++)if(t[e].checked)return t[e].value;return""},input:function(t){return"checkbox"===Va(t,"type")?t.checked:t.value},textarea:function(t){return t.value},select:function(t){var e=t.selectedIndex;return t.options[e].value},other:function(t){return t.innerHTML}};function Fa(t){var e=ja(this);return Pa[e]?Pa[e](this,t):Pa.other(this,t)}var Pa={radio:function(t,e){for(var i=0;i<t.length;i++)t[i].checked=t[i].value==e},input:function(t,e){"checkbox"===Va(t,"type")?t.checked=!!e:t.value=e},textarea:function(t,e){t.value=e},select:function(t,e){t.value=e,-1===t.selectedIndex&&(t.value=t.firstElementChild.value)},other:function(t,e){t.innerHTML=e}},Ba={name:"htmlform",$init:function(t){this.elements={},this._default_values=!1,t.content&&(t.container==t.content||!t.container&&t.content==document.body)&&(this._copy_inner_content=!0)},content_setter:function(t){if(t=F(t),this._copy_inner_content)for(;t.childNodes.length>1;)this._viewobj.childNodes[0].appendChild(t.childNodes[0]);else this._viewobj.childNodes[0].appendChild(t);return this._parse_inputs(),!0},render:function(){Qn.api.render.apply(this,arguments),this._parse_inputs()},_parse_inputs:function(){var t=this._viewobj.querySelectorAll("[name]");this.elements={};for(var e=0;e<t.length;e++){var i=t[e],s=Va(i,"name");if(s){var n="button"===ja(i),a=Va(i,"type"),r=n||"button"===a||"submit"===a;if("radio"===a){var o=this.elements[s]||[];o.tagName="radio",o.push(i),i=o}this.elements[s]=i,i.getValue=Na,i.setValue=Fa,i.$allowsClear=!r}}return this.elements},_mark_invalid:function(t,e){this._clear_invalid(t,e);var i=this._viewobj.querySelector('[name="'+t+'"]');i&&Dt(i,"invalid")},_clear_invalid:function(t){var e=this._viewobj.querySelector('[name="'+t+'"]');e&&Et(e,"invalid")},focus:function(t){if(!t&&this.$view.contains(document.activeElement))return!1;Js.focus.apply(this,arguments)}},Ma=(t.protoUI(Ba,Qn.view,Js),{name:"property",$init:function(){this._contentobj.className+=" webix_property",this._contentobj.setAttribute("role","listbox"),this._destroy_with_me=[],this.attachEvent("onAfterEditStart",(function(t){Dt(this.getItemNode(t),"webix_focused")})),this.attachEvent("onAfterEditStop",(function(t,e){Et(this.getItemNode(e.config.id),"webix_focused")})),this.types||(this.types={default:this.type},this.type.name="default"),this.type=S(this.type)},defaults:{nameWidth:100,editable:!0},on_render:{password:is.password.masterFormat,checkbox:function(t){return"<input type='checkbox' class='webix_property_check' "+(t?"checked":"")+">"},color:function(t){return"<div class='webix_property_col_ind' style='margin-top:"+(this.type.height-20)/2+"px;background-color:"+(t||"#FFFFFF")+";'></div>"+t}},on_edit:{label:!1},_id:"webix_f_id",on_click:{webix_property_check:function(t){var e=this.locate(t),i=this.getItem(e);return this.callEvent("onCheck",[e,i.value=!i.value]),!1}},on_dblclick:{},registerType:function(t,e){if(E(e.template)||(this.on_render[t]=e.template),E(e.editor)||(this.on_edit[t]=e.editor),!E(e.click))for(var i in e.click)this.on_click[i]=e.click[i]},elements_setter:function(t){this._idToLine={};for(var e=0;e<t.length;e++){var i=t[e];"multiselect"==i.type&&(i.optionslist=!0),i.id=i.id||T(),i.label=i.label||"",i.value=i.value||"",this._idToLine[i.id]=e,this._map_options(t[e])}return t},showItem:function(t){vs.showItem.call(this,t)},item_setter:function(t){return this.type_setter(t)},type_setter:function(t){return vs.type_setter.call(this,t)},locate:function(){return xt(arguments[0],this._id)},getItemNode:function(t){return this._dataobj.childNodes[this._idToLine[t]]},getItem:function(t){return this._settings.elements[this._idToLine[t]]},_get_editor_type:function(t){var e=this.getItem(t).type;if("checkbox"==e)return"inline-checkbox";var i=this.on_edit[e];return!1!==i&&(i||e)},_get_edit_config:function(t){return this.getItem(t)},_find_cell_next:function(t,e,i){var s=this._idToLine[t.id],n=this._settings.elements;if(i){for(var a=s+1;a<n.length;a++)if(e.call(this,n[a].id))return n[a].id}else for(var r=s-1;r>=0;r--)if(e.call(this,n[r].id))return n[r].id;return null},updateItem:function(e,i){var s=this.getItem(e);s&&t.extend(s,i||{},!0),this.refresh()},_cellPosition:function(t){var e=this.getItemNode(t);return{left:e.offsetLeft+this._settings.nameWidth,top:e.offsetTop,height:e.firstChild.offsetHeight,width:this._data_width,parent:this._contentobj}},_clear:function(){for(var t=this._settings.elements,e=0;e<t.length;e++)t[e].value=""},clear:function(){this._clear(),this._props_dataset={},this.refresh()},setValues:function(t,e){var i=this;for(var s in this._settings.complexData&&(t=Qt.collapseNames(t,"",{},(function(t){return E(i._idToLine[t])}))),e||this._clear(),t){var n=this.getItem(s);n&&(n.value=t[s])}this._props_dataset=t,this.refresh()},getValues:function(){for(var t=S(this._props_dataset||{}),e=0;e<this._settings.elements.length;e++){var i=this._settings.elements[e];"label"!=i.type&&(t[i.id]=i.value)}return this._settings.complexData&&(t=Qt.expandNames(t)),t},refresh:function(){this.render()},$setSize:function(t,e){mi.api.$setSize.call(this,t,e)&&(this._data_width=this._content_width-this._settings.nameWidth,this.render())},$getSize:function(t,e){if(this._settings.autoheight){var i=this._settings.elements.length;this._settings.height=Math.max(this.type.height*i,this._settings.minHeight||0)}return mi.api.$getSize.call(this,t,e)},_toHTML:function(){var t=[],i=this._settings.elements;if(i)for(var s="height:".concat(this.type.height,"px;line-height:").concat(this.type.height,"px;"),n=0;n<i.length;n++){var a=i[n];a.css&&"object"==e(a.css)&&(a.css=ft(a.css));var r='<div webix_f_id="'+a.id+'"'+("label"!==a.type?'role="option" tabindex="0"':"")+' class="webix_property_line '+(a.css||"")+'">';if("label"==a.type)t[n]=r+"<div class='webix_property_label_line' style='"+s+"'>"+a.label+"</div></div>";else{var o=this.on_render[a.type],l="<div class='webix_property_label' style='"+s+"width:"+this._settings.nameWidth+"px'>"+a.label+"</div><div class='webix_property_value' style='"+s+"width:"+this._data_width+"px'>",h=void 0;h=a.collection||a.options?a.template(a,this.type,a.value,a):a.format?a.format(a.value):a.value,o&&(h=o.call(this,a.value,a)),t[n]=r+l+h+"</div></div>"}}return t.join("")},type:{height:24,templateStart:le(""),templateEnd:le("</div>")},$skin:function(){this.type.height=vi.propertyItemHeight}}),Oa=(t.protoUI(Ma,xi,ss,us,_s,bs,wi,Zt,H,mi.view),{name:"calendar",defaults:{date:$n.datePart(new Date),navigation:!0,monthSelect:!0,weekHeader:!0,monthHeader:!0,weekNumber:!1,skipEmptyWeeks:!1,calendarHeader:"%F %Y",events:$n.isHoliday,minuteStep:5,timeIcon:"wxi-clock",icons:!1,timepickerHeight:30,headerHeight:30,dayTemplate:function(t){return t.getDate()},width:260,height:250,separator:", "},dayTemplate_setter:le,calendarHeader_setter:$n.dateToStr,calendarTime_setter:function(t){return this._calendarTime=t,$n.dateToStr(t)},date_setter:function(t){return(t=$n.copy(this._string_to_date(t))).setDate(1),t},maxDate_setter:function(t){return $n.datePart(this._string_to_date(t))},minDate_setter:function(t){return $n.datePart(this._string_to_date(t))},minTime_setter:function(t){return"string"==typeof t&&(t=[(t=R.parseTimeFormatDate(t)).getHours(),t.getMinutes()]),t},maxTime_setter:function(t){return"string"==typeof t&&(t=[(t=R.parseTimeFormatDate(t)).getHours(),t.getMinutes()]),t},_ariaFocus:function(){var t=this;_e(this.$view,"mousedown",(function(){t._mouse_time=new Date})),_e(this.$view,"focus",(function(e){if(!t._settings.master){var i=e.relatedTarget,s=-1!==e.target.className.indexOf("webix_cal_day");if(i&&new Date-t._mouse_time>100&&s&&t.$view.contains(i)){var n=t._locate_day(e.target);t._selectedDay(n)||t._moveSelection(n)}}}),{capture:!0})},$init:function(){this._viewobj.className+=" webix_calendar",this._viewobj.setAttribute("role","region"),this._viewobj.setAttribute("aria-label",R.aria.calendar),this._special_dates={},this._selected_days={},this._zoom_level=0,this._ariaFocus(),this.attachEvent("onKeyPress",this._onKeyPress)},_onKeyPress:function(t,e){var i=e.target,s=i.getAttribute("role");13!==t&&32!==t||"button"!=s&&"log"!=s||this._settings.disabled||(At(i,"MouseEvent","click"),St(e))},minuteStep_setter:function(t){return Math.max(Math.min(t,60),this.defaults.minuteStep)},type_setter:function(t){return"time"==t?(this._zoom_in=!0,this._zoom_level=-1):"year"==t&&(this._fixed=!0),t},$setSize:function(t,e){mi.api.$setSize.call(this,t,e)&&this.render()},$getSize:function(t,e){var i=this._settings;if(i.cellHeight&&!i.type){var s=this._getDateBoundaries(i.date);i.height=i.cellHeight*s._rows+i.headerHeight+(i.weekHeader?vi.calendarWeekHeaderHeight:0)+(i.timepicker||this._icons?i.timepickerHeight:0)+2*(this._content_padding+vi.borderWidth)}return mi.api.$getSize.call(this,t,e)},moveSelection:function(t,e,i){if(!this.config.master){var s=this.getSelectedDate(!0),n=$n.copy(s||this.getVisibleDate());this._moveSelection(n,t,i)}},_moveSelection:function(t,e,i){var s=this._zoom_logic[this._zoom_level]._keyshift(t,e,this);!1!==i&&this._restore_focus(s)},_restore_focus:function(t,e){var i;(i=e?(i=this._viewobj.querySelector(".webix_cal_body")).childNodes[e.rind].childNodes[e.cind+(this._settings.weekNumber?1:0)]:this._viewobj.querySelector("."+t+"[tabindex='0']"))&&i.focus()},_getDateBoundaries:function(t,e){if(!this._set_date_bounds||e){var i=t.getMonth(),s=t.getFullYear(),n=new Date(s,i+1,1),a=$n.weekStart(new Date(s,i,1)),r=Math.round((n.valueOf()-a.valueOf())/864e5),o=this._settings.skipEmptyWeeks?Math.ceil(r/7):6;this._set_date_bounds={_month:i,_start:a,_next:n,_rows:o}}return this._set_date_bounds},$skin:function(){vi.calendar&&(vi.calendar.width&&(this.defaults.width=vi.calendar.width),vi.calendar.height&&(this.defaults.height=vi.calendar.height),vi.calendar.headerHeight&&(this.defaults.headerHeight=vi.calendar.headerHeight),vi.calendar.timepickerHeight&&(this.defaults.timepickerHeight=vi.calendar.timepickerHeight)),this._content_padding=vi.layoutPadding.form},_getColumnConfigSizes:function(t){for(var e=this._getDateBoundaries(t),i=this._settings,s=[],n=[],a=this._content_width-2*(this._content_padding+vi.borderWidth),r=this._content_height-(i.monthHeader?i.headerHeight:0)-(i.weekHeader?vi.calendarWeekHeaderHeight:0)-(i.timepicker||this._icons?i.timepickerHeight:0)-2*(this._content_padding+vi.borderWidth),o=i.weekNumber?8:7,l=0;l<o;l++)n[l]=Math.ceil(a/(o-l)),a-=n[l];for(var h=e._rows,c=0;c<h;c++)s[c]=Math.ceil(r/(h-c)),r-=s[c];return[n,s]},icons_setter:function(t){t?"object"==e(t)?this._icons=t:this._icons=this._icons2:this._icons=null},_icons:[],_icons2:[{template:function(){return"<span role='button' tabindex='0' class='webix_cal_icon_today webix_cal_icon'>"+R.calendar.today+"</span>"},on_click:{webix_cal_icon_today:function(){var t=new Date;this._settings.timepicker||(t=$n.datePart(t)),this.setValue(t,"user"),this.callEvent("onTodaySet",[this.getSelectedDate()])}}},{template:function(){return"<span role='button' tabindex='0' class='webix_cal_icon_clear webix_cal_icon'>"+R.calendar.clear+"</span>"},on_click:{webix_cal_icon_clear:function(){this.setValue("","user"),this.callEvent("onDateClear",[this.getSelectedDate()])}}}],refresh:function(){this.render()},render:function(){this._zoom_level=0,this._zoom_size=!1;var t=this._settings;if(this.isVisible(t.id)){this._current_time=$n.datePart(new Date),this.callEvent("onBeforeRender",[]);var e=this.getVisibleDate(),i=this._getDateBoundaries(e,!0),s=this._getColumnConfigSizes(e),n=this._content_padding+"px",a=s[0],r=s[1],o="";t.monthHeader&&(o+="<div class='webix_cal_month' style='margin:0 "+n+"'><span role='log' aria-live='assertive' aria-atomic='true' class='webix_cal_month_name"+(t.monthSelect&&t.navigation?"' role='button' tabindex='0'":" webix_readonly'")+">"+t.calendarHeader(e)+"</span>",t.navigation&&(o+="<div role='button' tabindex='0' aria-label='"+R.aria.navMonth[0]+"' class='webix_cal_prev_button'></div><div role='button' tabindex='0' aria-label='"+R.aria.navMonth[1]+"' class='webix_cal_next_button'></div>"),o+="</div>"),t.weekHeader&&(o+="<div class='webix_cal_header' style='margin:0 "+n+"' aria-hidden='true'>"+this._week_template(a)+"</div>"),o+="<div class='webix_cal_body' role='grid' style='margin:0 "+n+"'>"+this._body_template(a,r,i)+"</div>",(t.timepicker||this._icons)&&(o+="<div class='webix_cal_footer' style='margin:0 "+n+"'>",t.timepicker&&(o+=this._timepicker_template(e)),this._icons&&(o+=this._icons_template()),o+="</div>"),this._contentobj.innerHTML=o,this._contentobj.firstChild.style.marginTop=n,"time"==t.type?this._changeZoomLevel(-1,e):"month"==t.type?this._changeZoomLevel(1,e):"year"==t.type&&this._changeZoomLevel(2,e),this._fix_cover(),this.callEvent("onAfterRender",[])}},_icons_template:function(e){for(var i="<div class='webix_cal_icons'>",s=this._icons,n=0;n<s.length;n++){if(s[n].template){var a="function"==typeof s[n].template?s[n].template:a(s[n].template);i+=a.call(this,e)}s[n].on_click&&t.extend(this.on_click,s[n].on_click)}return i+"</div>"},_timepicker_template:function(t){var e=this._settings.calendarTime||R.timeFormatStr,i=this._settings.timeIcon,s="";if(this._settings.master){var n=I(ke(this._settings.master)._settings.value);for(var a in $n.equal(n.end,t)&&(n.start=n.end),n)s+="<div role='button' tabindex='0' class='webix_range_time_"+a+" webix_cal_time'><span class='webix_icon "+i+"'></span> "+e(n[a])+"</div>"}else s="<div role='button' tabindex='0' class='webix_cal_time"+(this._icons?" webix_cal_time_icons":"")+"'><span class='webix_icon "+i+"'></span> "+e(t)+"</div>";return s},_week_template:function(t){var e=this._settings,i="",s=0;e.weekNumber&&(s=1,i+="<div class='webix_cal_week_header' style='width: "+t[0]+"px;' >"+(e.calendarWeekHeader||"")+"</div>");for(var n=$n.startOnMonday?1:0,a=0;a<7;a++){var r=(n+a)%7,o=R.calendar.dayShort[r];i+="<div day='"+r+"' style='width: "+t[a+s]+"px;' >"+o+"</div>"}return i},blockDates_setter:function(t){return P(t,this.$scope)},_day_css:function(t,e){var i="",s=!1;return $n.equal(t,this._current_time)&&(i+=" webix_cal_today"),this._checkDate(t)||(i+=" webix_cal_day_disabled"),t.getMonth()!=e._month&&(s=!0,i+=" webix_cal_outside"),!s&&this._selectedDay(t)&&(i+=" webix_cal_select"),this._settings.events&&(i+=" "+(this._settings.events(t,s)||"")),i+" webix_cal_day"},_body_template:function(t,i,s){for(var n,a,r=this._settings,o=r.weekNumber?1:0,l=$n.datePart($n.copy(s._start)),h=$n.getISOWeek($n.add(l,2,"day",!0)),c="",d=0;d<i.length;d++){c+="<div class='webix_cal_row' role='row' style='height:"+i[d]+"px;line-height:"+i[d]+"px'>",o&&(!l.getMonth()&&l.getDate()<7&&(h=$n.getISOWeek($n.add(l,2,"day",!0))),c+="<div class='webix_cal_week_num' aria-hidden='true' style='width:"+t[0]+"px'>"+h+"</div>");for(var u=o;u<t.length;u++){var _=this._selectedDay(l),p=this._day_css(l,s),f=r.dayTemplate.call(this,l),g="";"object"==e(f)?(g=f.aria||g,f=f.text):g=$n.dateToStr(R.aria.dateFormat)(l);var m=l.getMonth()!=s._month,v=_&&!m?"0":"-1";1!=l.getDate()||m||(v="$webix_tabindex"),"0"==v&&(n=!0),a=Math.min(i[d],t[u]),c+="<div day='"+u+"' role='gridcell' "+(m?"aria-hidden='true'":"")+" aria-label='"+g+"' tabindex='"+v+"' aria-selected='"+(_&&!m?"true":"false")+"' class='"+p+"' style='text-align:center; width:"+t[u]+"px'><span aria-hidden='true' class='webix_cal_day_inner' style='display:inline-block; "+this._getCalSizesString(a,a)+"'>"+f+"</span></div>",(l=$n.add(l,1,"day")).getHours()&&(l=$n.datePart(l))}c+="</div>",h++}return c.replace("$webix_tabindex",n||r.master?"-1":"0")},_changeDate:function(t,e){e||(e=this._zoom_logic[this._zoom_level]._changeStep);var i=this._settings.date,s=$n.add(i,t*e,"month",!0);this._changeDateInternal(i,s,t)},_changeDateInternal:function(t,e,i){if(this.callEvent("onBeforeMonthChange",[t,e])){if(this._zoom_level)this._update_zoom_level(e);else if(this.showCalendar(e),this._settings.monthHeader&&this._settings.navigation){var s="webix_cal_"+(i>0?"next":"prev")+"_button";this._restore_focus(s)}this.callEvent("onAfterMonthChange",[e,t])}},_zoom_logic:{"-2":{_isBlocked:function(t){var e=this._settings,i=e.date,s=!1,n=e.minTime?e.minTime[0]:0,a=e.maxTime?e.maxTime[0]+(e.maxTime[1]?1:0):24,r=e.minTime&&i.getHours()==n?e.minTime[1]:0,o=e.maxTime&&e.maxTime[1]&&i.getHours()==a-1?e.maxTime[1]:60;if(this._settings.blockTime){var l=$n.copy(i);l.setMinutes(t),s=this._settings.blockTime(l)}return t<r||t>=o||s},_setContent:function(t,e){t.setMinutes(e)},_findActive:function(t,e,i){if(!this._isBlocked.call(i,t.getMinutes()))return t;var s=i._settings.minuteStep,n=$n.add(t,"right"==e?s:-s,"minute",!0);return t.getHours()===n.getHours()?this._findActive(n,e,i):void 0}},"-1":{_isBlocked:function(t){var e=this._settings,i=e.date,s=e.minTime?e.minTime[0]:0,n=e.maxTime?e.maxTime[0]+(e.maxTime[1]?1:0):24;if(t<s||t>=n)return!0;if(e.blockTime){var a=$n.copy(i);a.setHours(t);for(var r=e.minTime&&t==s?e.minTime[1]:0,o=e.maxTime&&e.maxTime[1]&&t==n-1?e.maxTime[1]:60,l=r;l<o;l+=e.minuteStep)if(a.setMinutes(l),!e.blockTime(a))return!1;return!0}},_setContent:function(t,e){t.setHours(e)},_keyshift:function(t,e,i){var s,n,a=i._settings.minuteStep;return"bottom"===e||"top"===e?(t.setHours("bottom"===e?23:0),t.setMinutes("bottom"===e?55:0),t.setSeconds(0),t.setMilliseconds(0),s=t):"left"===e||"right"===e?(n="right"===e?a:-a,"left"===e&&t.getMinutes()<a&&(n=60-a),"right"===e&&t.getMinutes()>=60-a&&(n=a-60),n-=t.getMinutes()%a,s=i._zoom_logic[-2]._findActive($n.add(t,n,"minute"),e,i)):"up"===e||"down"===e?(n="down"===e?1:-1,"down"===e&&23===t.getHours()&&(n=-23),"up"===e&&0===t.getHours()&&(n=23),s=this._findActive($n.add(t,n,"hour"),e,i)):!1===e&&(s=this._findActive(t,e,i)),s&&(i._update_zoom_level(s),i.selectDate(s,!1,!1,"user")),"webix_cal_block"+("left"===e||"right"===e?"_min":"")},_findActive:function(t,e,i){if(!this._isBlocked.call(i,t.getHours()))return t;var s=$n.add(t,"down"==e?1:-1,"hour",!0);return t.getDate()===s.getDate()?this._findActive(s,e,i):void 0}},0:{_changeStep:1,_keyshift:function(t,e,i){var s=t;return"pgup"===e||"pgdown"===e?s=$n.add(t,"pgdown"===e?1:-1,"month"):"bottom"===e?s=new Date(t.getFullYear(),t.getMonth()+1,0):"top"===e?s=new Date(t.setDate(1)):"left"===e||"right"===e?s=$n.add(t,"right"===e?1:-1,"day"):"up"!==e&&"down"!==e||(s=$n.add(t,"down"===e?1:-1,"week")),i._checkDate(s)||(s=i._findActive(t,e)),s&&i.selectDate(s,!0,!1,"user"),"webix_cal_day"}},1:{_isBlocked:function(t){var e=this.getVisibleDate();e.setMonth(t);var i=this._settings.blockDates&&this._settings.blockDates.call(this,e),s=this._settings.minDate,n=this._settings.maxDate,a=this._settings.date.getFullYear();if(s&&!i){var r=s.getFullYear();i=a<r||a==r&&s.getMonth()>t}if(n&&!i){var o=n.getFullYear();i=a>o||a==o&&n.getMonth()<t}return i},_correctDate:function(t,e){return(t=$n.monthStart(t))<e._settings.minDate?t=$n.copy(e._settings.minDate):t>e._settings.maxDate&&(t=$n.copy(e._settings.maxDate)),t},_getTitle:function(t){return t.getFullYear()},_getContent:function(t){return R.calendar.monthShort[t]},_setContent:function(t,e){e!=t.getMonth()&&t.setDate(1),t.setMonth(e)},_changeStep:12,_keyshift:function(t,e,i){var s=t;return"pgup"===e||"pgdown"===e?s=$n.add(t,"pgdown"===e?1:-1,"year"):"bottom"===e?s=new Date(t.setMonth(11)):"top"===e?s=new Date(t.setMonth(0)):"left"===e||"right"===e?s=$n.add(t,"right"===e?1:-1,"month"):"up"!==e&&"down"!==e||(s=$n.add(t,"down"===e?4:-4,"month")),s=i._correctDate(s),i._checkDate(s)||(s=i._findActive(t,e)),s&&(i._update_zoom_level(s),i.selectDate(s,!1,!1,"user")),"webix_cal_block"}},2:{_isBlocked:function(t){t+=this._zoom_start_date;var e=this.getVisibleDate();e.setFullYear(t);var i=this._settings.blockDates&&this._settings.blockDates.call(this,e),s=this._settings.minDate,n=this._settings.maxDate;return!!(i||s&&s.getFullYear()>t||n&&n.getFullYear()<t)},_correctDate:function(t,e){return(t=$n.yearStart(t))<e._settings.minDate?t=$n.copy(e._settings.minDate):t>e._settings.maxDate&&(t=$n.copy(e._settings.maxDate)),t},_getTitle:function(t,e){var i=t.getFullYear();return e._zoom_start_date=i=i-i%10-1,i+" - "+(i+10+1)},_getContent:function(t,e){return e._zoom_start_date+t},_setContent:function(t,e,i){t.setFullYear(i._zoom_start_date+e)},_changeStep:120,_keyshift:function(t,e,i){var s=t;return"pgup"===e||"pgdown"===e?s=$n.add(t,"pgdown"===e?10:-10,"year"):"bottom"===e?s=new Date(t.setYear(i._zoom_start_date+10)):"top"===e?s=new Date(t.setYear(i._zoom_start_date)):"left"===e||"right"===e?s=$n.add(t,"right"===e?1:-1,"year"):"up"!==e&&"down"!==e||(s=$n.add(t,"down"===e?4:-4,"year")),s=i._correctDate(s),i._checkDate(s)||(s=i._findActive(t,e)),s&&(i._update_zoom_level(s),i.selectDate(s,!1,!1,"user")),"webix_cal_block"}}},_correctBlockedTime:function(){var t;if(this._zoom_logic[-1]._isBlocked.call(this,this._settings.date.getHours()))for(t=0;t<24;t++)if(!this._zoom_logic[-1]._isBlocked.call(this,t)){this._settings.date.setHours(t);break}if(this._zoom_logic[-2]._isBlocked.call(this,this._settings.date.getMinutes()))for(t=0;t<60;t+=this._settings.minuteStep)if(!this._zoom_logic[-2]._isBlocked.call(this,t)){this._settings.date.setMinutes(t);break}},_update_zoom_level:function(t){var e,i,s,n,a,r,o,l,h,c,d,u,_="",p=this._content_padding+"px";if(a=2-((e=this._settings).weekHeader?0:1)-(e.monthHeader?0:1),c=this._zoom_logic[this._zoom_level],r=this._contentobj.childNodes,t&&this.define("date",t),l=e.type,this._zoom_size||(this._reserve_box_height=this._contentobj.offsetHeight-(e.monthHeader||this._zoom_in?e.headerHeight:0)-2*(this._content_padding+vi.borderWidth),"year"!=l&&"month"!=l&&(this._reserve_box_height-=e.timepickerHeight),this._reserve_box_width=r[a].offsetWidth,this._zoom_size=1),this._zoom_in){s=this._reserve_box_height/6;var f=6,g=(this._calendarTime||R.timeFormat).match(/%([a,A])/);for(g&&f++,h=parseInt((this._reserve_box_width-3)/f,10),u=Math.min(h,s),_+="<div class='webix_time_header' style='margin:0 "+p+"'>"+this._timeHeaderTemplate(h,g)+"</div>",_+="<div  class='webix_cal_body' style='height:"+this._reserve_box_height+"px; margin:0 "+p+";'>",this._correctBlockedTime(),_+="<div role='grid' class='webix_hours'><div role='row'>",o=e.date.getHours(),d=$n.copy(e.date),n=0;n<24;n++){if(i="",g&&n%4==0){var m=n?12==n?R.pm[0]:"":R.am[0];_+="<div class='webix_cal_block_empty"+i+"' style='"+this._getCalSizesString(h,s)+"clear:both;'>"+m+"</div>"}this._zoom_logic[-1]._isBlocked.call(this,n)?i+=" webix_cal_day_disabled":o==n&&(i+=" webix_selected"),d.setHours(n),_+="<div aria-label='"+$n.dateToStr(R.aria.hourFormat)(d)+"' role='gridcell' tabindex='"+(o==n?"0":"-1")+"' aria-selected='"+(o==n?"true":"false")+"' class='webix_cal_block"+i+"' data-value='"+n+"' style='"+this._getCalSizesString(h,s)+(n%4!=0||g?"":"clear:both;")+"'><span style='display:inline-block; "+this._getCalSizesString(u,u)+"'>"+$n.toFixed(g?n&&12!=n?n%12:12:n)+"</span></div>"}for(_+="</div></div>",_+="<div role='grid' class='webix_minutes'><div role='row'>",o=e.date.getMinutes(),d=$n.copy(e.date),n=0;n<60;n+=e.minuteStep)i="",this._zoom_logic[-2]._isBlocked.call(this,n)?i=" webix_cal_day_disabled":o==n&&(i=" webix_selected"),d.setMinutes(n),_+="<div aria-label='"+$n.dateToStr(R.aria.minuteFormat)(d)+"' role='gridcell' tabindex='"+(o==n?"0":"-1")+"' aria-selected='"+(o==n?"true":"false")+"' class='webix_cal_block webix_cal_block_min"+i+"' data-value='"+n+"' style='"+this._getCalSizesString(h,s)+(n/e.minuteStep%2==0?"clear:both;":"")+"'><span style='display:inline-block; "+this._getCalSizesString(u,u)+"'>"+$n.toFixed(n)+"</span></div>";_+="</div></div>",_+="</div>",_+="<div class='webix_time_footer' style='margin:0 "+p+"'>"+this._timeButtonsTemplate()+"</div>",this._contentobj.innerHTML=_,this._contentobj.firstChild.style.marginTop=p}else{if(e.monthHeader){var v=r[0].childNodes,b=c._getTitle(e.date,this);if(v[0].innerHTML!=b&&(v[0].innerHTML=b),e.navigation){var w=R.aria["nav"+(1==this._zoom_level?"Year":"Decade")];v[1].setAttribute("aria-label",w[0]),v[2].setAttribute("aria-label",w[1])}}else c._getTitle(e.date,this);for(s=Math.floor(this._reserve_box_height/3),h=Math.floor(this._reserve_box_width/4),u=Math.min(s,h),o=1===this._zoom_level?e.date.getMonth():e.date.getFullYear()-this._zoom_start_date,n=0;n<12;n++){i="",c._isBlocked.call(this,n)?i=" webix_cal_day_disabled":o==n&&(i=" webix_selected");var y=R.aria[(1==this._zoom_level?"month":"year")+"Format"];_+="<div role='gridcell' aria-label='"+$n.dateToStr(y)(e.date)+"' tabindex='"+(-1!==i.indexOf("selected")?"0":"-1")+"' aria-selected='"+(-1!==i.indexOf("selected")?"true":"false")+"' class='webix_cal_block"+i+"' data-value='"+n+"' style='"+this._getCalSizesString(h,s)+"'><span style='display:inline-block; "+this._getCalSizesString(u,u)+"'>"+c._getContent(n,this)+"</span></div>"}e.weekHeader&&(r[a-1].style.display="none",1===a&&(r[a].style.marginTop=p)),r[a].innerHTML="<div role='row'>"+_+"</div>","year"!=l&&"month"!=l?r[a+1]?r[a+1].innerHTML=this._timeButtonsTemplate():this._contentobj.innerHTML+="<div class='webix_time_footer' style='margin:0 "+p+"'>"+this._timeButtonsTemplate()+"</div>":r[a+1]&&(r[a+1].style.display="none"),r[a].style.height=this._reserve_box_height+"px"}},_getCalSizesString:function(t,e){return"width:"+t+"px; height:"+e+"px; line-height:"+e+"px;"},_timeButtonsTemplate:function(){return"<input type='button' style='width:100%' class='webix_cal_done' value='"+R.calendar.done+"'>"},_timeHeaderTemplate:function(t,e){var i=2*t;return"<div class='webix_cal_hours' style='width:"+t*(e?5:4)+"px'>"+R.calendar.hours+"</div><div class='webix_cal_minutes' style='width:"+i+"px'>"+R.calendar.minutes+"</div>"},_changeZoomLevel:function(t,e){var i=this._zoom_level;this.callEvent("onBeforeZoom",[t,i])&&(this._zoom_level=t,t?this._update_zoom_level(e):this.showCalendar(e),this.callEvent("onAfterZoom",[t,i]))},_correctDate:function(t){return this._zoom_logic[this._zoom_level]._correctDate&&!this._checkDate(t)&&(t=this._zoom_logic[this._zoom_level]._correctDate(t,this)),t},_mode_selected:function(t,e){var i=this._locate_date(t),s=this._zoom_level-(this._fixed?0:1);if(i=this._correctDate(i),this._checkDate(i)){this._changeZoomLevel(s,i);var n=this._settings.type;"month"!=n&&"year"!=n||this._selectDate(i,!1,e)}},_selectDate:function(t,e,i){this.callEvent("onBeforeDateSelect",[t])&&(this.selectDate(t,!0,e,i),this.callEvent("onAfterDateSelect",[t]))},_locate_day:function(t,e){var i=pt(t)-(this._settings.weekNumber?1:0),s=pt(t.parentNode);if(e)return{cind:i,rind:s};var n=$n.add(this._getDateBoundaries()._start,i+7*s,"day",!0);return this._settings.timepicker&&(n.setHours(this._settings.date.getHours()),n.setMinutes(this._settings.date.getMinutes())),n},_locate_date:function(t){var e=1*t.getAttribute("data-value"),i=-1!=t.className.indexOf("webix_cal_block_min")?this._zoom_level-1:this._zoom_level,s=this.getVisibleDate();return this._zoom_logic[i]._setContent(s,e,this),s},on_click:{webix_cal_prev_button:function(){this._changeDate(-1)},webix_cal_next_button:function(){this._changeDate(1)},webix_cal_day_disabled:function(){return!1},webix_cal_outside:function(){if(!this._settings.navigation)return!1},webix_cal_day:function(t,e,i){var s=this._locate_day(i),n=this._settings.multiselect?this._locate_day(i,!0):null,a="touch"===this._settings.multiselect||t.ctrlKey||t.metaKey;this._selectDate(s,a,"user"),this._restore_focus("webix_cal_day",n)},webix_cal_time:function(){if(this._zoom_logic[this._zoom_level-1]){this._zoom_in=!0;var t=this._zoom_level-1;this._changeZoomLevel(t)}},webix_range_time_start:function(){ke(this._settings.master)._time_mode="start"},webix_range_time_end:function(){ke(this._settings.master)._time_mode="end"},webix_cal_done:function(){var t=this.getVisibleDate();if(this._zoom_in){var e=this.getSelectedDate(!0);e&&(e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),t=e)}t=this._correctDate(t),this._selectDate(t,!1,"user")},webix_cal_month_name:function(){if(this._settings.navigation&&(this._zoom_in=!1,2!=this._zoom_level&&this._settings.monthSelect)){var t=Math.max(this._zoom_level,0)+1;this._changeZoomLevel(t)}},webix_cal_block:function(t,e,i){if(this._zoom_in){if(-1!==i.className.indexOf("webix_cal_day_disabled"))return!1;var s=this._locate_date(i);this._update_zoom_level(s);var n="webix_cal_block";-1!==i.className.indexOf("webix_cal_block_min")&&(n="webix_cal_block_min"),this._restore_focus(n)}else-1==i.className.indexOf("webix_cal_day_disabled")&&this._mode_selected(i,"user")}},_string_to_date:function(t,e){return t?("string"==typeof t&&(t=e?$n.strToDate(e)(t):R.parseFormatDate(t)),t):$n.datePart(new Date)},_checkDate:function(t){var e=this._settings.blockDates&&this._settings.blockDates.call(this,t),i=this._settings.minDate,s=this._settings.maxDate,n=i&&t<i||s&&t>=$n.add(s,1,"day",!0);return!e&&!n},_findActive:function(t,e){var i,s="top"===e||"left"===e||"pgup"===e||"up"===e?-1:1,n=$n.add(t,s,"day",!0);return this._checkDate(n)?n:(0===this._zoom_level?i=t.getMonth()===n.getMonth():1===this._zoom_level?i=t.getFullYear()===n.getFullYear():2===this._zoom_level&&(i=n.getFullYear()>this._zoom_start_date&&n.getFullYear()<this._zoom_start_date+10),i?this._findActive(n,e):void 0)},showCalendar:function(t){this.define("date",t),this.render(),this.resize()},_selectedDay:function(t){return t&&this._selected_days[t.valueOf()]},getSelectedDate:function(t){for(var e=[],i=Object.keys(this._selected_days),s=t?Math.min(1,i.length):i.length,n=0;n<s;n++)e.push($n.copy(this._selected_days[i[n]]));return this.config.multiselect&&!t?e:e[0]||null},getVisibleDate:function(){return $n.copy(this._settings.date)},setValue:function(t,e){this.selectDate(t,!0,!1,e)},getValue:function(t){var e=this,i=this.getSelectedDate();return B(i)?(i=i.map((function(i){return e._formatValue(i,t)})),this._settings.stringResult&&(i=i.join(this._settings.separator))):i=this._formatValue(i,t),i},_formatValue:function(t,e){return e?t=$n.dateToStr(e)(t):this._settings.stringResult&&(t="time"==this._settings.type?R.parseTimeFormatStr(t):R.parseFormatStr(t)),t},selectDate:function(t,e,i,s){if(t&&i&&this.config.multiselect||(this._selected_days={}),t){"string"==typeof t?t=t.split(this._settings.separator):B(t)||(t=[t]);for(var n=0;n<t.length;n++){var a=this._string_to_date(t[n]),r=$n.datePart($n.copy(a)).valueOf();if(this._selected_days[r]&&i?delete this._selected_days[r]:this._selected_days[r]=a,!this.config.multiselect)break}t.length&&e&&this.showCalendar(t[0])}!1!==e&&this.render(),this.callEvent("onChange",[t,s])},locate:function(){return null}}),La=(t.protoUI(Oa,ds,_s,mi.view,H),{name:"colorboard",defaults:{template:function(t){return'<div class="webix_color_item" style="background-color:'.concat(t.val,';"></div>')},palette:null,height:250,width:260,cols:11,rows:10,minLightness:.15,maxLightness:1,navigation:!0,grayScale:!0,type:"material"},$init:function(){_e(this._viewobj,"click",A((function(t){var e=xt(t.target.parentNode,"webix_val");if(e){var i=this._settings.value;this.setValue(e,"user"),e=this._settings.value,this.callEvent("onItemClick",[e,t]),e!=i&&this.callEvent("onSelect",[e])}}),this)),this.$view.setAttribute("role","grid"),this._viewobj.setAttribute("aria-readonly","true")},_get_clear_palette:function(){return["#F34336","#FF9700","#FFEA3B","#4CB050","#009788","#00BCD4","#2196F3","#3F51B5","#673BB7","#9C28B1","#EA1E63"]},_set_item_focus:function(){this.getValue()||this.moveSelection("up")},_findIndex:function(t){var e=this._settings.palette;t=(t||"").toUpperCase();for(var i=0,s=e.length;i<s;i++)for(var n=0,a=e[i].length;n<a;n++)if(e[i][n].toUpperCase()==t)return{row:i,col:n};return null},$setSize:function(t,e){mi.api.$setSize.call(this,t,e)&&this.render()},getValue:function(){return this._settings.value},_getBox:function(){return this._viewobj.firstChild},$prepareValue:function(t){return(t=t?t.toString(16):"")&&"#"!=t.charAt(0)&&/^[0-9a-fA-F]+$/.test(t)&&(t="#"+t),t},value_setter:function(t){return this.$prepareValue(t)},setValue:function(t,e){t=this.$prepareValue(t);var i=this._settings.value;i!=t&&(this._settings.value=t,this.$setValue(t),this.callEvent("onChange",[t,i,e]))},$setValue:function(t){if(this.isVisible(this._settings.id)){if(this._activeSelection){var e=this._getCell(this._activeSelection);this._setSelection(e,!1)}var i=this._activeSelection=this._findIndex(t);if(i){var s=this._getCell(i);this._setSelection(s,!0)}}},_getCell:function(t){return this._viewobj.lastChild.childNodes[t.row].childNodes[t.col]},_setSelection:function(t,e){e?(t.setAttribute("tabindex","0"),t.setAttribute("aria-selected","true"),Dt(t,"webix_color_selected")):(t.setAttribute("tabindex","-1"),t.removeAttribute("aria-selected"),Et(t,"webix_color_selected"))},_numToHex:function(t){return ys.toHex(t,2)},_rgbToHex:function(t,e,i){return"#"+this._numToHex(Math.floor(t))+this._numToHex(Math.floor(e))+this._numToHex(Math.floor(i))},_hslToRgb:function(t,e,i){var s,n,a;if(e){var r=i<.5?i*(1+e):i+e-i*e,o=2*i-r;s=this._hue2rgb(o,r,t+1/3),n=this._hue2rgb(o,r,t),a=this._hue2rgb(o,r,t-1/3)}else s=n=a=i;return{r:255*s,g:255*n,b:255*a}},_hue2rgb:function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<=.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},_lightenRgb:function(t,e){return{r:t[0]*e+255*(1-e),g:t[1]*e+255*(1-e),b:t[2]*e+255*(1-e)}},_getGrayScale:function(t){for(var e=[],i=255,s=i/t,n=0;n<t;n++)i=Math.round(i>0?i:0),e.push(this._rgbToHex(i,i,i)),i-=s;return e[e.length-1]="#000000",e},_initPalette:function(t){var e=this._get_clear_palette();t.cols=e.length;var i=[],s=t.rows-1,n=1/t.rows,a=null;if(this._settings.grayScale){var r=this._getGrayScale(t.cols);i.push(r.reverse()),n=1/s,s-=1}i.push(e);for(var o=0,l=t.maxLightness;o<s;o++){l-=n,a=[];for(var h=0;h<t.cols;h++){var c=ys.toRgb(e[h]),d=this._lightenRgb(c,l);a.push(this._rgbToHex(d.r,d.g,d.b))}i.push(a)}this._settings.palette=i},_initOldPalette:function(t){var e=[],i=1/t.cols,s=t.rows,n=null;this._settings.grayScale&&(e.push(this._getGrayScale(t.cols)),s-=1);for(var a=(t.maxLightness-t.minLightness)/s,r=0,o=t.minLightness;r<s;r++){n=[];for(var l=0,h=0;l<t.cols;l++){var c=this._hslToRgb(h,1,o);n.push(this._rgbToHex(c.r,c.g,c.b)),h+=i}e.push(n),o+=a}this._settings.palette=e},moveSelection:function(t,e,i){var s,n,a=this.getValue();if(a&&(s=this._findIndex(a)),s||(s={row:0,col:0}),s){if("up"==t||"down"==t?s.row=s.row+("up"==t?-1:1):"right"==t||"left"==t?s.col=s.col+("right"==t?1:-1):"top"==t?s.row=s.col=0:"bottom"==t&&(s.row=this._viewobj.lastChild.querySelectorAll(".webix_color_row").length-1,s.col=this._viewobj.lastChild.childNodes[s.row].childNodes.length-1),s.row=Math.max(s.row,0),s.row>=0){var r=this._viewobj.lastChild.childNodes[s.row];r&&(n=r.childNodes[s.col])}if(n){a=n.getAttribute("webix_val");var o=e&&e.e instanceof KeyboardEvent?"user":"auto";if(this.setValue(a,o),this.callEvent("onSelect",[this._settings.value]),!1!==i){var l=this._viewobj.querySelector("div[tabindex='0']");l&&l.focus()}}}},_renderRow:function(t,e,i){for(var s={width:0,height:0,val:0},n='<div class="webix_color_row" role="row">',a=0;a<t.length;a++)s.width=e[a],s.height=i,s.val=t[a],n+=this._renderItem(s);return n+"</div>"},_renderItem:function(t){var e=le(this._settings.template||"");return'<div role="gridcell" tabindex="-1" aria-label="'.concat(t.val,'" style="width:').concat(t.width,"px;height:").concat(t.height,'px;" ',"webix_val",'="').concat(t.val,'">').concat(e(t),"</div>")},render:function(){if(this.isVisible(this._settings.id)){var t=this._settings.type;this._settings.palette||("classic"===t?this._initOldPalette(this._settings):this._initPalette(this._settings));var i=this._settings.palette;this.callEvent("onBeforeRender",[]);for(var s="classic"===t?0:vi.colorPadding,n="object"==e(i[0]),a=n?i[0]:i,r=2*s+s*(a.length-1),o=2*s+s*(n?i.length-1:0),l=this.$width-r,h=this.$height-o,c=[],d='<div class="webix_color_palette '.concat("webix_palette_"+t,'" role="rowgroup">'),u=0;u<a.length;u++)c[u]=Math.floor(l/(a.length-u)),l-=c[u];if("object"==e(i[0]))for(var _=0;_<i.length;_++){var p=Math.floor(h/(i.length-_));h-=p;var f=i[_];d+=this._renderRow(f,c,p)}else d+=this._renderRow(i,c,h);d+="</div>",this._viewobj.innerHTML=d,this._settings.value?this.$setValue(this._settings.value):this._viewobj.lastChild.childNodes[0].childNodes[0].setAttribute("tabindex","0"),this._fix_cover(),this.callEvent("onAfterRender",[])}},refresh:function(){this.render()}}),Ra=(t.protoUI(La,ds,mi.view,H),{name:"colorselect",defaults:{width:260,height:250,value:"#751FE0"},$init:function(){var t=this;this._hValue=this._sValue=this._vValue=0,_e(this.$view,"keydown",(function(e){return t._handle_move_keyboard(e)})),this.attachEvent("onAfterRender",(function(){var t=this;_e(this._colorBlock,Ot.mouse.down,(function(e){return t._handle_dnd(e,"mouse")})),_e(this._colorLine,Ot.mouse.down,(function(e){return t._handle_dnd(e,"mouse",!0)})),Ot.touch&&(_e(this._colorBlock,Ot.touch.down,(function(e){return t._handle_dnd(e,"touch")})),_e(this._colorLine,Ot.touch.down,(function(e){return t._handle_dnd(e,"touch",!0)}))),_e(this._colorOutText,"change",(function(){return t.setValue(t._colorOutText.value,"user")})),this._settings.button&&_e(this._viewobj.querySelector(".webix_button"),"click",(function(){t.callEvent("onColorSelect",[t.getValue()])}))})),this.attachEvent("onDestruct",(function(){this._colorCircle=this._colorLineCircle=this._colorBlock=null,this._colorLine=this._colorOutText=this._colorOutBlock=this._offset=null}))},$skin:function(){this._inpHeight=vi.inputHeight-2*vi.inputPadding},$setSize:function(t,e){mi.api.$setSize.call(this,t,e)&&this.render()},getValue:function(){return this._settings.value},$prepareValue:function(t){return(t=t?t.toString(16):"")&&"#"!=t.charAt(0)&&/^[0-9a-fA-F]+$/.test(t)&&(t="#"+t),t},value_setter:function(t){return this.$prepareValue(t)},setValue:function(t,e){t=this.$prepareValue(t);var i=this._settings.value;i!=t&&(this._settings.value=t,this.$setValue(t),this.callEvent("onChange",[t,i,e]))},$setValue:function(t){if(this.isVisible(this._settings.id)){var e=ys.toRgb(t);if(t!==this._current_value){var i=ys.rgbToHsv.apply(ys,s(e));this._hValue=i[0],this._sValue=i[1],this._vValue=i[2]}var n=this._hValue*this._offset.width/359;this._colorLineCircle.style.left=n+"px";var a=this._sValue*this._offset.width,r=Math.abs(this._offset.height*(this._vValue-1));this._colorCircle.style.left=Math.max(Math.min(a,this._offset.width),0)+"px",this._colorCircle.style.top=Math.max(Math.min(r,this._offset.height),0)+"px",this._colorCircle.setAttribute("aria-valuetext",t),this._colorLineCircle.setAttribute("aria-valuetext",t),this._setOutColors(e,t),this._setBlockColors()}},_setOutColors:function(t,e){t||(t=ys.hsvToRgb(this._hValue,this._sValue,this._vValue)),e||(e="#"+ys.rgbToHex(t));var i="rgb(".concat(t[0],", ").concat(t[1],", ").concat(t[2],")");this._colorCircle.style.backgroundColor=i,this._colorOutBlock.style.backgroundColor=i,this._colorOutText.value=e.toUpperCase(),this._current_value=e},_setBlockColors:function(){var t=ys.hsvToRgb(this._hValue,1,1),e="rgb(".concat(t[0],", ").concat(t[1],", ").concat(t[2],")");this._colorLineCircle.style.backgroundColor=e,this._colorBlock.style.backgroundColor=e},_move_block:function(t){var e=$t(t),i=e.x-this._offset.x,s=e.y-this._offset.y;i=Math.max(Math.min(i,this._offset.width),0),s=Math.max(Math.min(s,this._offset.height),0),this._colorCircle.style.left=i+"px",this._colorCircle.style.top=s+"px";var n=this._offset.width/100,a=this._offset.height/100,r=Math.ceil(i/n)/100,o=Math.ceil(Math.abs(s/a-100))/100;this._sValue=r,this._vValue=o,this._setOutColors()},_move_line:function(t){var e=$t(t).x-this._offset.x;e=Math.max(Math.min(e,this._offset.width),0),this._colorLineCircle.style.left=e+"px";var i=Math.round(359*e/this._offset.width);this._hValue=Math.max(Math.min(i,359),0),this._setOutColors(),this._setBlockColors()},_handle_dnd:function(t,e,i){var s=this;this._offset=kt(this._colorBlock),i?(Dt(this._colorLine,"webix_color_area_active"),this._move_line(t)):(Dt(this._colorBlock,"webix_color_area_active"),this._move_block(t));var n="touch"===e?{passive:!1}:null;this._handle_drag_events=[pe(document.body,Ot[e].move,(function(t){return s._handle_move_process(t,e,i)}),n),pe(document,Ot[e].up,(function(){return s._handle_move_stop(i)}))],Dt(document.body,"webix_noselect")},_handle_move_process:function(t,e,i){i?this._move_line(t):this._move_block(t),"touch"===e&&St(t)},_handle_move_stop:function(t){fe(this._handle_drag_events[0]),fe(this._handle_drag_events[1]),this._handle_drag_events=null,this.setValue(this._current_value,"user"),t?(Et(this._colorLine,"webix_color_area_active"),this._colorLineCircle.focus()):(Et(this._colorBlock,"webix_color_area_active"),this._colorCircle.focus()),Et(document.body,"webix_noselect")},_move_block_value:function(t,e){return Math.min(Math.max(t+e/100,0),1)},_move_line_value:function(t,e){return Math.min(Math.max(t+e,0),359)},_handle_move_keyboard:function(t){var e=t.which||t.keyCode;if(e>32&&e<41){var i=/webix_color_(\w*)circle/.exec(t.target.className);if(!i)return;if(St(t),i[1].length){if(36===e)this._hValue=0;else if(35===e)this._hValue=359;else{var s=37===e||40===e||34===e?-1:1;this._hValue=this._move_line_value(this._hValue,s)}this._setBlockColors()}else if(36===e)this._sValue=0,this._vValue=1;else if(35===e)this._sValue=this._vValue=1;else if(39===e||37===e){var n=39===e?1:-1;this._sValue=this._move_block_value(this._sValue,n)}else{var a=33===e||38===e?1:-1;this._vValue=this._move_block_value(this._vValue,a)}this._setOutColors(),this._settings.value==this._current_value?this.$setValue(this._current_value):this.setValue(this._current_value,"user")}},moveSelection:function(t){if("pgup"==t||"pgdown"==t){var e="pgup"===t?-1:1;this._hValue=this._move_line_value(this._hValue,e),this._setBlockColors()}else if("top"!=t&&"bottom"!==t){var i="up"==t||"right"==t?1:-1;"down"==t||"up"==t?this._vValue=this._move_block_value(this._vValue,i):this._sValue=this._move_block_value(this._sValue,i)}this._setOutColors(),this.setValue(this._current_value,"auto")},render:function(){if(this.isVisible(this._settings.id)){this.callEvent("onBeforeRender",[]);var t=(this.$width-3*vi.dataPadding)/2,e=this.$height-3*vi.dataPadding-22-this._inpHeight-(this._settings.button?this._inpHeight+vi.dataPadding:0),i='<div class="webix_color_area">';i+="\n\t\t\t<div ".concat("webix_disable_drag",'="true" class="webix_color_block" style="height:',e,'px;">\n\t\t\t\t<div class="webix_color_circle" tabindex="0" role="slider"></div>\n\t\t\t</div>\n\t\t\t<div ',"webix_disable_drag",'="true" class="webix_color_line">\n\t\t\t\t<div class="webix_color_line_circle" tabindex="0" role="slider"></div>\n\t\t\t</div>\n\t\t\t<div class="webix_color_out">\n\t\t\t\t<div style="width:').concat(t,'px" class="webix_color_out_block"></div>\n\t\t\t\t<input type="text" style="width:').concat(t,'px" class="webix_color_out_text"></input>\n\t\t\t</div>\n\t\t'),this._settings.button&&(i+="<div class='webix_secondary'><button class=\"webix_button\">".concat(R.combo.select,"</button></div>")),i+="</div>",this._viewobj.innerHTML=i,this._collect_vars(),this.$setValue(this._settings.value),this._fix_cover(),this.callEvent("onAfterRender",[])}},_collect_vars:function(){this._colorCircle=this._viewobj.querySelector(".webix_color_circle"),this._colorLineCircle=this._viewobj.querySelector(".webix_color_line_circle"),this._colorBlock=this._viewobj.querySelector(".webix_color_block"),this._colorLine=this._viewobj.querySelector(".webix_color_line"),this._colorOutText=this._viewobj.querySelector(".webix_color_out_text"),this._colorOutBlock=this._viewobj.querySelector(".webix_color_out_block"),this._offset=kt(this._colorBlock)},refresh:function(){this.render()}}),za=(t.protoUI(Ra,mi.view,H),{name:"button",touchable:!0,$skin:function(){this.defaults.height=vi.buttonHeight||vi.inputHeight},defaults:{template:function(t,e){var i=e.$renderInput(t,e);return(t.badge||0===t.badge)&&(i=i.replace("</button>","<span class='webix_badge'>"+t.badge+"</span></button>")),"<div class='webix_el_box' style='width:"+t.awidth+"px; height:"+t.aheight+"px'>"+i+"</div>"},label:"",value:"",borderless:!0},$renderInput:function(t){return"<button type='button' "+(t.popup?"aria-haspopup='true'":"")+" class='webix_button'>"+(t.label||t.value)+"</button>"},$init:function(t){this._viewobj.className+=" webix_control webix_el_"+(this.$cssName||this.name),this._destroy_with_me=[],this._set_default_css(t),this.data=this._settings,this._dataobj=this._viewobj,this.$ready.push((function(){this._calc_size(this.config)}))},hotkey_setter:function(t){var e=this;this._addElementHotKey(t,(function(t,i){e.isVisible()&&(At(e.$view.firstChild,"MouseEvent","click"),St(i))}))},_set_default_css:function(t){t.css&&this._get_class(t.css)&&(!this.defaults.css||this._get_class(this.defaults.css))||(this._viewobj.className+=" webix_secondary")},_get_class:function(t){if("string"==typeof t){for(var e in{webix_danger:1,webix_transparent:1,webix_primary:1})if(-1!==t.indexOf(e))return!0}return!1},_addElementHotKey:function(t,e,i){var s=ni.addHotKey(t,e,i);this.attachEvent("onDestruct",(function(){ni.removeHotKey(s,e,i)}))},type_setter:function(t){return this._types[t]&&(this.$renderInput=le(this._types[t])),t},_set_inner_size:!1,_types:{image:"<button type='button' class='webix_button webix_img_btn' style='line-height:#cheight#px;'><img class='webix_image' style='max-width:#cheight#px; max-height:#cheight#px;' src = '#image#'>#label#</button>",imageTop:"<button type='button' class='webix_button webix_img_btn_top'><img class='webix_image' style='max-width:#cheight#px; max-height:#cheight#px;' src = '#image#'><div class='webix_img_btn_text'>#label#</div></button>",icon:"<button type='button' class='webix_button webix_img_btn' style='line-height:#cheight#px;'><span class='webix_icon_btn #icon#' style='max-width:#cheight#px;'></span>#label#</button>",iconTop:"<button type='button' class='webix_button webix_img_btn_top' style='width:100%;text-align:center;'><span class='webix_icon #icon#'></span><div class='webix_img_btn_text'>#label#</div></button>"},_findAllInputs:function(){for(var t=[],e=["input","select","textarea","button"],i=0;i<e.length;i++)for(var s=this.$view.getElementsByTagName(e[i]),n=0;n<s.length;n++)t.push(s[n]);return t},disable:function(){var t,e,i=this._getBox();if(pi.api.disable.apply(this,arguments),i&&-1==i.className.indexOf(" webix_disabled_box")){i.className+=" webix_disabled_box";var s=this._findAllInputs();for(t=0;t<s.length;t++)s[t].setAttribute("disabled",!0);if((e=this.getInputNode())&&"div"==e.tagName.toLowerCase()&&(this._disabledTabIndex=e.getAttribute("tabIndex"),e.removeAttribute("tabIndex")),"top"==this._settings.labelPosition){var n=this._dataobj.firstChild;n&&(n.className+=" webix_disabled_top_label")}}},enable:function(){pi.api.enable.apply(this,arguments);var t,e=this._getBox();if(e){e.className=e.className.replace(" webix_disabled_box","");for(var i=this._findAllInputs(),s=0;s<i.length;s++)i[s].removeAttribute("disabled");if((t=this.getInputNode())&&!E(this._disabledTabIndex)&&t.setAttribute("tabIndex",this._disabledTabIndex),"top"==this._settings.labelPosition){var n=this._dataobj.firstChild;n&&(n.className=n.className.replace(" webix_disabled_top_label",""))}}},$setSize:function(t,e){mi.api.$setSize.call(this,t,e)&&this.render()},setValue:function(t,e){t=this.$prepareValue(t);var i=this._settings.value;if(this.$compareValue(i,t)){if(this._rendered_input&&this._pattern){t=this._pattern(t);var s=this.getInputNode();s&&!E(s.value)&&s.value!=t&&this.$setValue(t)}}else this._settings.value=t,this._rendered_input&&this.$setValue(t),this.callEvent("onChange",[t,i,e])},$compareValue:function(t,e){return"number"==typeof e&&(e=e.toString()),"number"==typeof t&&(t=t.toString()),t==e},$prepareValue:function(t){return 0===t?"0":(t||"").toString()},value_setter:function(t){return this.$prepareValue(t)},$setValue:function(t){var e=this.getInputNode();e&&!this._types[this._settings.type]&&(t=this._settings.label||t,"BUTTON"==e.tagName?e.innerHTML=t:e.value=t)},getValue:function(){var t=this._rendered_input?this.$getValue():this._settings.value;return void 0===t?"":t},$getValue:function(){return this._settings.value||""},focus:function(){if(!ni.canFocus(this))return!1;var t=this.getInputNode();t&&t.focus&&t.focus()},blur:function(){var t=this.getInputNode();t&&t.blur&&t.blur()},getInputNode:function(){return this._dataobj.getElementsByTagName("input")[0]||this._dataobj.getElementsByTagName("button")[0]},_getBox:function(){for(var t=0;t<this._dataobj.childNodes.length;t++)if(this._dataobj.childNodes[t].className.indexOf("webix_el_box")>=0)return this._dataobj.childNodes[t];return null},_get_tooltip_data:function(t,e){var i=e.target,s=this._getBox();return"top"==this._settings.labelPosition&&this._dataobj.firstChild.contains(i)||s&&s.contains(i)?this._settings:null},_sqrt_2:Math.sqrt(2),_calc_size:function(t){if((t=t||this._settings).autowidth){var e=jt(t.value||t.label||"","webixbutton").width+(t.badge||0===t.badge?2*jt(t.badge,"webix_badge").width-32:0)+("icon"===t.type?24:0)+("image"===t.type?t.height-vi.inputPadding:0);e=Math.max(t.minWidth||0,e),t.width=Math.min(t.maxWidth||1/0,e)}},_calck_input_size:function(){this._input_width=this._settings.inputWidth||(this._content_width-this._settings.width>2?this._settings.width:0)||this._content_width,this._input_height=this._settings.inputHeight||this._inputHeight||0},resize:function(){return this._calc_size(),mi.api.resize.apply(this,arguments)},render:function(){if(this._calck_input_size(),this._settings.awidth=this._input_width||this._content_width,this._settings.aheight=this._input_height||this._content_height,this._settings.bheight=this._settings.aheight+2,this._settings.cheight=this._settings.aheight-2*vi.inputPadding,this._settings.dheight=this._settings.cheight-2,he.render.call(this)){if(this._rendered_input=!0,this._set_inner_size&&this._set_inner_size(),this._settings.align){var t=this._dataobj.firstChild;switch("top"==this._settings.labelPosition&&t.nextSibling&&(t=t.nextSibling),this._settings.align){case"right":t.style.cssFloat="right";break;case"center":t.style.display="inline-block",t.parentNode.style.textAlign="center";break;case"middle":t.style.marginTop=Math.round((this._content_height-this._input_height)/2)+"px";break;case"bottom":t.style.marginTop=this._content_height-this._input_height+"px";break;case"left":t.style.cssFloat="left";break;default:f(!1,"Unknown align mode: "+this._settings.align)}}this.$render&&this.$render(this.data),this._settings.disabled&&this.disable(),this._init_once&&(this._init_once(this.data),this._init_once=0)}},refresh:function(){this.render()},on_click:{_handle_tab_click:function(t){var e=xt(t,"button_id"),i=this.getOption(e);i&&!i.disabled&&this.callEvent("onBeforeTabClick",[e,t])&&(this.setValue(e,"user"),this.focus(),this.callEvent("onAfterTabClick",[e,t]))},webix_all_segments:function(t,e){this.on_click._handle_tab_click.call(this,t,e)},webix_all_tabs:function(t,e){this.on_click._handle_tab_click.call(this,t,e)},webix_inp_counter_next:function(){this._settings.readonly||this.next(this._settings.step,"user")},webix_inp_counter_prev:function(){this._settings.readonly||this.prev(this._settings.step,"user")},webix_input_icon:function(){this.getInputNode().focus()},webix_clear_icon:function(){return this.$allowsClear&&this.setValue("","user"),!1},webix_inp_checkbox_border:function(t){this._settings.disabled||"DIV"==t.target.tagName||this._settings.readonly||this.toggle("user")},webix_inp_checkbox_label:function(){this._settings.readonly||this.toggle("user")},webix_inp_radio_border:function(t){var e=xt(t,"radio_id"),i=this.getOption(e);i&&!i.disabled&&(this.setValue(e,"user"),this.focus())},webix_tab_more_icon:function(t,e,i){var s=this.getPopup();s.isVisible()?s.hide():(s.resize(),s.show(i,null,!0))},webix_tab_close:function(t){var e=xt(t,"button_id"),i=this.getOption(e);return i&&!i.disabled&&this.callEvent("onBeforeTabClose",[e,t])&&this.removeOption(e),!1}},_check_options:function(t){f(!!t,this.name+": options not defined"),f(B(t),this.name+": options must be an array");for(var e=0;e<t.length;e++)f(!t[e].text,"Please replace .text with .value in control config"),f(!t[e].label,"Please replace .label with .value in control config"),"string"==typeof t[e]?t[e]={id:t[e],value:t[e]}:(E(t[e].id)&&(t[e].id=t[e].value),E(t[e].value)&&(t[e].value=t[e].id));return t},_get_div_placeholder:function(t){var e=t?t.placeholder:this._settings.placeholder;return e?"<span class='webix_placeholder'>"+e+"</span>":""}}),Ha={api:za,view:t.protoUI(za,mi.view,xi,he,ai,H)},qa={name:"label",defaults:{template:"<div class='webix_el_box' style='width:#awidth#px;height:#aheight#px;line-height:#cheight#px'>#label#</div>"},$skin:function(){Ha.api.$skin.call(this),this.defaults.height=vi.inputHeight},focus:function(){return!1},_getBox:function(){return this._dataobj.firstChild},setHTML:function(t){this._settings.label=t,this.refresh()},setValue:function(t){this._settings.label=t,Ha.api.setValue.apply(this,arguments)},$setValue:function(t){this._dataobj.firstChild.innerHTML=t},$render:function(t){"right"===t.align&&(this._dataobj.firstChild.style.textAlign="right")},_set_inner_size:!1,_set_default_css:function(){},_calc_size:function(t){var e="webix_el_box webixlabel"+(this.queryView("toolbar","parent")?" webixtoolbarlabel":"");(t=t||this._settings).autowidth&&(t.width=jt(t.label,e).width)}},Ua=(t.protoUI(qa,Ha.view),{9:"tab",38:"up",40:"down",37:"left",39:"right"}),Wa={$init:function(t){var i=this.defaults.pattern||t.pattern,s=this.defaults.format||t.format;t.value=E(t.value)?"":t.value,(i||s&&!this.format_setter)&&(this.attachEvent("onKeyPress",(function(t,e){if(!(e.ctrlKey||e.altKey||this._settings.readonly||this._custom_format||(t>105&&t<112&&(t-=64),Ua[t]&&8!==t&&46!==t)))return this._on_key_pressed(e,t),!1})),this.attachEvent("onAfterRender",this._after_render),this.getText=function(){return this.getInputNode().value},this.$prepareValue=function(t){return this._pattern(t,!1)},this._pattern=function(t,e){return!1===e?this._getRawValue(t):this._matchPattern(t)},s&&("object"===e(s)?this._custom_format=s:(s=Sn.getConfig(s),this._custom_format={parse:function(t){return Sn.parse(t,s)},edit:function(t){return Sn.format(t,s)}}))),i&&(this._settings.pattern=this.pattern_setter(i),delete t.pattern)},pattern_setter:function(t){var e=Pn[t]||t;return"string"==typeof e&&(e={mask:e}),e.allow=e.allow||/[A-Za-z0-9]/g,this._patternScheme(e),e},_init_validation:function(){this.config.validate=this.config.validate||A((function(){var t=this.getText(),e=t.replace(this._pattern_chars,"");return(t.toString().match(this._pattern_allows)||[]).join("").length==e.length&&t.length==this._settings.pattern.mask.length}),this)},_after_render:function(){var t=this;this._custom_format||_e(this.getInputNode(),"input",(function(){var t=(new Date).valueOf();(!this._property_stamp||t-this._property_stamp>100)&&(this._property_stamp=t,this.$setValue(this.getText()))}),{bind:this}),_e(this.getInputNode(),"blur",(function(){return t._applyChanges("user")}))},_patternScheme:function(t){for(var e=t.mask,i={},s="",n=0,a=0;a<e.length;a++)"#"===e[a]?(i[a]=n,n++):(i[a]=!1,-1===s.indexOf(e[a])&&(s+="\\"+e[a]));this._pattern_allows=t.allow,this._pattern_chars=new RegExp("["+s+"]","g"),this._pattern_scheme=i,this._init_validation()},_on_key_pressed:function(t,e){var i=this.getInputNode(),s=i.value,n=Ft(i),a="";if(e)if(8==e||46==e)n.start==n.end&&(8==e?n.start--:n.end++);else{a=String.fromCharCode(e);var r=t.getModifierState("CapsLock");(!t.shiftKey&&!r||t.shiftKey&&r)&&(a=a.toLowerCase())}s=s.substr(0,n.start)+a+s.substr(n.end),n=this._getCaretPos(a,s.length,n.start,e),this._input_code=e,this.$setValue(s),Tt(i,n)},_getCaretPos:function(t,e,i,s){if(t&&t.match(this._pattern_allows)||8==s||46==s)i=t?i+1:i,i=this._fixCaretPos(i,s);else if(e-1==i&&8!==s&&46!==s){var n=this._settings.pattern.mask.indexOf("#",i);n>0&&(i+=n)}return i},_fixCaretPos:function(t,e){var i=t-1*(46!==e);return!1===this._pattern_scheme[i]?(t+=8==e?-1:1,this._fixCaretPos(t,e)):!1===this._pattern_scheme[t]&&8!==e?this._fixCaretPos(t+1,e)-1:t},_getRawValue:function(t){return this._custom_format?this._custom_format.parse(t):((t=t||0===t?t:"").toString().match(this._pattern_allows)||[]).join("").replace(this._pattern_chars,"")},_matchPattern:function(t){if(this._custom_format)return this._custom_format.edit(this._custom_format.parse(t));var e=this._getRawValue(t),i=this._settings.pattern.mask,s=this._settings.pattern.mask,n=this._pattern_scheme,a=!1,r=0,o=0,l=0;for(var h in n)if(!1!==n[h]){if(!a){r=1*h;var c=e[o=n[h]]||"",d=e[o+1];i=(c?i.substr(0,r):"")+c+(c&&d?i.substr(r+1):""),d||(a=!0)}l++}var u=this._input_code;if(u&&8!==u||!u&&l-1===o&&i.length<s.length)if(e){var _=r+1;if("#"!==s.charAt(_)&&i.length<s.length){var p=s.indexOf("#",_);p<0&&(p=s.length),i+=s.substr(_,p-_)}}else 46!==u&&(i+=s.substr(0,s.indexOf("#")));return this._input_code=null,i}},Ya={name:"text",$allowsClear:!0,_init_onchange:function(){var t=this;if(this.$allowsClear){var e=this._settings,i=this.getInputNode();if(this.$onBlur||_e(i,"change",(function(){return t._applyChanges("user")})),e.suggest&&ke(e.suggest).linkInput(this),e.clear&&!this.addSection){this._clear_icon=this.$view.querySelector(".webix_input_icon:last-child"),"INPUT"!=i.tagName&&"SELECT"!=i.tagName||_e(i,"input",(function(e){return t._toggleClearIcon(e.target.value)}));var s=this.getText?this.getText():e.text||e.value;this._toggleClearIcon(s)}}},_applyChanges:function(t){var e=this.getValue();this.setValue(e,t)},_toggleClearIcon:function(t){var e=this._settings;if(!e.readonly&&e.clear&&this._clear_icon)if("hover"==e.clear||"replace"==e.clear){var i=t?"webix_clear_icon "+("hover"==e.clear?e.icon:"wxi-close"):e.icon;this._clear_icon.className="webix_input_icon "+i}else{var s=t?"":"hidden";this._clear_icon.style.visibility!==s&&(this._clear_icon.style.visibility=s)}},$skin:function(){Ha.api.$skin.call(this),this.defaults.height=vi.inputHeight,this.defaults.inputPadding=vi.inputPadding,this._inputSpacing=vi.inputSpacing,this._labelTopHeight=vi.labelTopHeight},$init:function(t){"top"==t.labelPosition&&E(t.height)&&this.defaults.height&&(t.height=this.defaults.height+(t.label?this._labelTopHeight:0)),E(t.icon)||(this._settings.icon=t.icon),this.$onBlur&&this.attachEvent("onBlur",(function(){this._rendered_input&&this.$onBlur()})),this.attachEvent("onAfterRender",this._init_onchange),this.attachEvent("onDestruct",(function(){this._clear_icon=null}))},clear_setter:function(t){return t&&(this._settings.icon||(t=!0),"hover"!==t&&"replace"!==t&&(t=!!t)),t},$renderIcon:function(t){var e=t.aheight-2*t.inputPadding,i=(e-18)/2-1,s=this._inputSpacing/2-24,n="";return t.icon&&(n+="<span style='right:"+(s+=24)+"px;height:"+(e-i)+"px;padding-top:"+i+"px;' class='webix_input_icon "+t.icon+"'></span>"),t.readonly||!0!==t.clear||(n+="<span style='right:"+(s+=24)+"px;height:"+(e-i)+"px;padding-top:"+i+"px;' class='webix_input_icon webix_clear_icon webix_icon_transparent wxi-close'></span>"),n},relatedView_setter:function(t){return this.attachEvent("onChange",(function(){var t=this.getValue(),e=this._settings.relatedAction,i=this._settings.relatedView,s=ke(i);if(!s){var n=this.getTopParentView();n&&n.$$&&(s=n.$$(i))}f(s,"Invalid relatedView: "+i),"enable"==e?t?s.enable():s.disable():t?s.show():s.hide()})),t},validateEvent_setter:function(t){return"blur"==t&&this.attachEvent("onBlur",this.validate),"key"==t&&this.attachEvent("onTimedKeyPress",this.validate),t},validate:function(){var t=this._settings.validate;!t&&this._settings.required&&(t=Oe.isNotEmpty);var e=this.getFormView(),i=this._settings.name,s=this.getValue(),n={};return n[i]=s,f(e,"Validation works only for fields in the form"),f(i,"Validation works only for fields with name"),!(t&&!e._validate(t,s,n,i))},_getInvalidText:function(){var t=this._settings.invalidMessage;return"function"==typeof t&&t.call(this),t},bottomLabel_setter:function(t){var e=this;j((function(){e.$destructed||e.setBottomText(t)}))},setBottomText:function(t){var e,i=this._settings;if(!E(t)){if(i.bottomLabel==t)return;i.bottomLabel=t}var s=this.getInputNode();s&&!E(s.value)&&(s==document.activeElement&&(e=Ft(s)),this._applyChanges("auto"));var n=(i.invalid?i.invalidMessage:"")||i.bottomLabel;n||i.bottomPadding||(i.inputHeight=0),!n||i.bottomPadding&&!this._restorePadding?!n&&this._restorePadding?(i.bottomPadding=this._restorePadding=0,i.height||this.render(),this.adjust(),this.resize()):this.render():(this._restorePadding=1,i.bottomPadding=jt(n,"webix_inp_bottom_label",this._get_input_width(i)).height,this.render(),this.adjust(),this.resize()),e&&Tt(this.getInputNode(),e.start,e.end)},$getSize:function(){var t=mi.api.$getSize.apply(this,arguments),e=this.config.bottomPadding;return e&&(t[2]+=e,t[3]+=e),t},$setSize:function(t,e){var i=this._settings;if(mi.api.$setSize.call(this,t,e)){if(!t||!e)return;"top"==i.labelPosition?(i.labelWidth=0,i.inputHeight||(this._inputHeight=this._content_height-(i.label?this._labelTopHeight:0)-(this.config.bottomPadding||0))):(i.label&&(i.labelWidth=this._getLabelWidth(i.labelWidth,i.label,i.required)),i.bottomPadding&&(i.inputHeight=this._content_height-this.config.bottomPadding)),this.render()}},_get_input_width:function(t){var e=(this._input_width||0)-(t.label?t.labelWidth:0)-this._inputSpacing-(t.iconWidth||0);return e<0?0:e},_render_div_block:function(t,e){var i="x"+T(),s=e._get_input_width(t),n=t.inputAlign||"left",a=t.aheight-2*vi.inputPadding-2*vi.borderWidth,r=!0===t.clear?"padding-right:51px;":"",o=t.text||t.value||this._get_div_placeholder(t),l="<div class='webix_inp_static' role='combobox' aria-label='"+le.escape(t.label)+"' tabindex='0'"+(t.readonly?" aria-readonly='true'":"")+(t.invalid?"aria-invalid='true'":"")+" onclick='' style='line-height:"+a+"px;width:"+s+"px;text-align:"+n+";"+r+"'>"+o+"</div>";return e.$renderInput(t,l,i)},_baseInputHTML:function(t){var e="<"+t+(this._settings.placeholder?" placeholder='"+le.escape(this._settings.placeholder)+"' ":" ");this._settings.readonly&&(e+="readonly='true' aria-readonly=''"),this._settings.required&&(e+="aria-required='true'"),this._settings.invalid&&(e+="aria-invalid='true'");var i=this._settings.attributes;if(i)for(var s in i)e+=s+"='"+i[s]+"' ";return e},$renderLabel:function(t,e){var i="";if(t.label){var s="top"==this._settings.labelPosition,n="text-align:".concat(t.labelAlign||"left","; line-height:").concat(this._getLabelHeight(s),"px; ");i="<label style='"+(n+=s?"display:block;":t.labelWidth?"width:".concat(t.labelWidth,"px;"):"display:none;")+"' onclick='' for='"+e+"' class='webix_inp_"+(s?"top_":"")+"label "+(t.required?"webix_required":"")+"'>"+(t.label||"")+"</label>"}return i},_getLabelHeight:function(t){return t?this._labelTopHeight-this._settings.inputPadding:this._settings.aheight-2*this._settings.inputPadding},$renderInput:function(t,e,i){var s=t.inputAlign||"left",n="top"==t.labelPosition,a=this._get_input_width(t);i=i||T();var r=this.$renderLabel(t,i),o="";if(e)o+=e;else{var l=le.escape(t.text||this._pattern(t.value)),h=(t.icon||t.clear?27:0)+(t.icon&&!0===t.clear?24:0);h=h&&!this.addSection?"padding-right:"+h+"px;":"",o+=this._baseInputHTML("input")+"id='"+i+"' type='"+(t.type||this.name)+"'"+(t.editable?" role='combobox'":"")+" value='"+l+"' style='width:"+a+"px;text-align:"+s+";"+h+"'";var c=t.attributes;if(c)for(var d in c)o+=" "+d+"='"+c[d]+"'";o+=" />"}o+=this.$renderIcon?this.$renderIcon(t):"";var u="";u=n?r+"<div class='webix_el_box' style='width:"+t.awidth+"px; height:"+t.aheight+"px'>"+o+"</div>":"<div class='webix_el_box' style='width:"+t.awidth+"px; height:"+t.aheight+"px'>"+r+o+"</div>";var _=(t.invalid?t.invalidMessage:"")||t.bottomLabel;if(_){var p=t.awidth-a-vi.inputPadding;u+="<div class='webix_inp_bottom_label'"+(t.invalid?"role='alert' aria-relevant='all'":"")+" style='width:"+(a||t.awidth)+"px;margin-left:"+Math.max(p,vi.inputPadding)+"px;'>"+_+"</div>"}return u},defaults:{template:function(t,e){return e.$renderInput(t)},label:"",labelWidth:80},_getLabelWidth:function(t,e,i){return"auto"==t&&(t=jt(e,"webix_inp_label"+(i?" webix_required":"")).width),t?Math.max(t,vi.dataPadding):0},type_setter:function(t){return t},_set_inner_size:!1,_set_default_css:function(){},_pattern:function(t){return t},$setValue:function(t){t=this._pattern(t),this.getInputNode()&&(this.getInputNode().value=t),this._toggleClearIcon(t)},$getValue:function(){return this._pattern(this.getInputNode().value,!1)},setValueHere:function(t,e,i){if(i&&i.symbol){var s=i.symbol,n=this.getValue(),a=n.substring(i.pos);n=(n=n.substring(0,i.pos)).substring(0,n.lastIndexOf(s)+s.length)+t,this.setValue(n+a,i.config),Tt(this.getInputNode(),n.length)}else this.setValue(t,i&&i.config)},suggest_setter:function(e){var i=this;if(e){if(f(!0!==e,"suggest options can't be set as true, data need to be provided instead"),"string"==typeof e){if(ke(e))return ke(e)._settings.id;e={body:{url:e,dataFeed:e}}}else e.getItem?e={body:{data:e}}:B(e)?e={body:{data:this._check_options(e)}}:e.body||(e.body={});t.extend(e,{view:"suggest"});var s=be(e);return this._destroy_with_me.push(s),this.$ready.push((function(){return s._settings.master=i._settings.id})),s._settings.id}return!1}},Ga={api:Ya,view:t.protoUI(Ya,Wa,Ha.view)},Ka=t.proto({name:"DataCollection",isVisible:function(){return!!(this.data.order.length||this.data._filter_order||this._settings.dataFeed)},$init:function(t){this.data.provideApi(this,!0);var e=t&&t.id?t.id:T();this._settings.id=e,be.views[e]=this,this.data.attachEvent("onStoreLoad",A((function(){this.callEvent("onBindRequest",[])}),this))},refresh:function(){this.callEvent("onBindRequest",[])}},zi,oi,ci,Xs,Gi,us,H,di,ri,ai);_("DataCollection",Ka);var Xa={name:"select",defaults:{template:function(t,e){var i="x"+T(),s=e._baseInputHTML("select")+"id='"+i+"' style='width:"+e._get_input_width(t)+"px;'>",n=ke(t.options);if(n&&n.data&&n.data.each)n.data.each((function(e){s+="<option"+(e.id==t.value?" selected='true'":"")+" value='"+e.id+"'>"+e.value+"</option>"}));else for(var a=e._check_options(t.options),r=0;r<a.length;r++)s+="<option"+(a[r].id==t.value?" selected='true'":"")+" value='"+a[r].id+"'>"+a[r].value+"</option>";return s+="</select>",e.$renderInput(t,s,i)}},$init:function(){this.attachEvent("onAfterRender",(function(){var t=this,e=this.getInputNode();_e(e,Ot.mouse.down,(function(e){return t._checkReadOnly(e)})),_e(e,"keydown",(function(e){return t._checkReadOnly(e,9==(e.which||e.keyCode))})),Ot.touch&&_e(e,Ot.touch.down,(function(e){return t._checkReadOnly(e)}))}))},_checkReadOnly:function(t,e){!e&&this._settings.readonly&&St(t)},options_setter:function(t){var e=this;if(t)return"string"==typeof t&&(this._loading_data=!0,(t=new Ka({url:t})).data.attachEvent("onStoreLoad",(function(){delete e._loading_data,e.refresh()}))),t},getValue:function(){return this._loading_data?this._settings.value:Ga.api.getValue.call(this)},$renderIcon:function(){return""},getInputNode:function(){return this._dataobj.getElementsByTagName("select")[0]}},Ja=(t.protoUI(Xa,Ga.view),{name:"checkbox",defaults:{checkValue:1,uncheckValue:0,template:function(t,e){var i="x"+T(),s="";t.labelRight&&(s="<label class='webix_label_right'>"+t.labelRight+"</label>",t.labelWidth&&(t.label=t.label||"&nbsp;"));var n=t.checkValue==t.value,a=Math.floor((e._settings.aheight-16)/2),r=e._baseInputHTML("input")+"style='margin-top:"+a+"px;"+(t.customCheckbox?"display:none":"")+"' id='"+i+"' type='checkbox' "+(n?"checked='1'":"")+(t.labelRight?" aria-label='"+le.escape(t.labelRight)+"'":"")+"/>",o="webix_inp_checkbox_border webix_el_group webix_checkbox_"+(n?"1":"0"),l=t.customCheckbox||"";l&&(l=(l=(l=l.replace(/(aria-checked=')\w*(?=')/,"$1"+(t.value==t.checkValue?"true":"false"))).replace(/(aria-label=')\w*(?=')/,"$1"+le.escape(t.labelRight||t.label))).replace(/(aria-invalid=')\w*(?=')/,"$1"+(t.invalid?"true":"false")));var h="<div style='line-height:"+e._settings.cheight+"px' class='"+o+"'>"+r+l+s+"</div>";return e.$renderInput(t,h,i)}},customCheckbox_setter:function(t){return!0===t&&vi.customCheckbox&&(t="<a role='presentation' onclick='javascript:void(0)'><button role='checkbox' aria-checked='false' aria-label='' type='button' aria-invalid='' class='webix_custom_checkbox'></button></a>"),t},blur:function(){var t=this.getInputNode();t&&t.blur()},$prepareValue:function(t){return t},_init_onchange:function(){},$setValue:function(t){var e=t==this._settings.checkValue,i=this.$view.getElementsByTagName("input")[0],s=i?i.parentNode:null;if(s&&this._settings.customCheckbox){var n=s.getElementsByTagName("BUTTON");n[0]&&n[0].setAttribute("aria-checked",e?"true":"false")}s&&(s.className=s.className.replace(/(webix_checkbox_)\d/,"$1"+(e?1:0))),i.checked=e},toggle:function(t){var e=this._settings,i=this.getValue()!=e.checkValue?e.checkValue:e.uncheckValue;this.setValue(i,t)},getValue:function(){var t=this._settings;return t.value==t.checkValue?t.checkValue:t.uncheckValue},getInputNode:function(){return this.$view.getElementsByTagName(this._settings.customCheckbox?"button":"input")[0]},$skin:function(){Ga.api.$skin.call(this),this.defaults.customCheckbox=!!vi.customCheckbox}}),Za={api:Ja,view:t.protoUI(Ja,Ga.view)},Qa={name:"radio",defaults:{template:function(t,e){var i=e._radioId(),s=e._optionsTemplate(i);return s="<div class='webix_el_group' role='radiogroup' style='margin-left:"+(t.label?t.labelWidth:0)+"px;'>"+s+"</div>",e.$renderInput(t,s,i)}},_radioId:function(){return"x"+T()},_optionsTemplate:function(t){var e=this._settings;this._check_options(e.options);for(var i,s,n,a,r,o,l,h,c,d,u=this._filterOptions(e.options),_=this._getFirstActive(),p=[],f=0;f<u.length;f++)i=f?this._radioId():t,f&&(u[f].newline||e.vertical)&&p.push("<div class='webix_line_break'></div>"),d=(s=u[f].id==e.value)||!e.value&&u[f].id===_,n=!!u[f].disabled,a=u[f].value||"",r=e.tooltip?" webix_t_id='"+u[f].id+"'":"",(o=e.customRadio||"")&&(l=(0===f?e.label+" ":"")+a,o=(o=(o=(o=(o=o.replace(/(aria-label=')\w*(?=')/,"$1"+le.escape(l))).replace(/(aria-checked=')\w*(?=')/,"$1"+(s?"true":"false"))).replace(/(tabindex=')\w*(?=')/,"$1"+(!n&&d?"0":"-1"))).replace(/(aria-invalid=')\w*(?=')/,"$1"+(e.invalid?"true":"false"))).replace(/(button_id=')\w*(?=')/,"$1"+u[f].id),n&&(o=o.replace("role='radio'","role='radio' webix_disabled='true'"))),h=this._baseInputHTML("input")+" name='"+(e.name||e.id)+"' type='radio' "+(s?"checked='1'":"")+"tabindex="+(!n&&d?"0":"-1")+" value='"+u[f].id+"' id='"+i+"'"+(n?" disabled='true'":"")+" style='"+(o?"display:none":"")+"' />",c="<div radio_id='"+u[f].id+"' class='webix_inp_radio_border webix_radio_"+(s?"1":"0")+"' role='presentation'>"+h+o+"</div>",a&&(a="<label for='"+i+"' class='webix_label_right'>"+a+"</label>"),p.push('<div style="height:'.concat(e.optionHeight,'px;" class="webix_radio_option').concat(n?" webix_disabled":"",'" role="presentation"').concat(r,">").concat(c+a,"</div>"));return p.join("")},refresh:function(){this.render(),this._last_size&&this.$getSize(0,0)[2]!=this._last_size[1]&&this.resize()},$getSize:function(t,e){var i=Ha.api.$getSize.call(this,t,e);if(!this._settings.autoheight){var s=this._filterOptions(this._settings.options);if(s){for(var n=this._settings.vertical?0:1,a=0;a<s.length;a++)(this._settings.vertical||s[a].newline)&&n++;i[3]=i[2]=Math.max(i[2],(this._settings.optionHeight||25)*n+2*this._settings.inputPadding+("top"==this._settings.labelPosition?this._labelTopHeight:0))}var r=this.config.bottomPadding;r&&(i[2]+=r,i[3]+=r)}return i},_getInputNode:function(){return this._dataobj.getElementsByTagName(this._settings.customRadio?"button":"input")},$setValue:function(t){for(var e,i,s,n,a,r=this._dataobj.getElementsByTagName("input"),o=this._getFirstActive(),l=0;l<r.length;l++)e=r[l].parentNode.getAttribute("radio_id"),i=this.getOption(e),r[l].checked=e==t,s=i&&!i.disabled&&(r[l].checked||!t&&i.id==o),r[l].setAttribute("tabindex",s?"0":"-1"),(n=r[l]?r[l].parentNode:null)&&(n.className=n.className.replace(/(webix_radio_)\d/,"$1"+(r[l].checked?1:0)),this._settings.customRadio&&(a=n.getElementsByTagName("BUTTON"))[0]&&(a[0].setAttribute("aria-checked",r[l].checked?"true":"false"),a[0].setAttribute("tabindex",s?"0":"-1")))},getValue:function(){return this._settings.value},focus:function(){return this._focus()},blur:function(){this._blur()},customRadio_setter:function(t){return!0===t&&vi.customRadio&&(t="<a role='presentation' onclick='javascript:void(0)'><button type='button' class='webix_custom_radio' button_id='' role='radio' aria-checked='false' aria-label='' aria-invalid='' tabindex=''></button></a>"),t},$skin:function(){Ga.api.$skin.call(this),this.defaults.customRadio=!!vi.customRadio,vi.optionHeight&&(this.defaults.optionHeight=vi.optionHeight)},_set_inner_size:function(){var t=this;if(this._settings.autoheight){var e=this._getOptionsHeight()+(this._settings.bottomPadding||0)+2*vi.inputPadding;if("top"==this._settings.labelPosition&&(e+=this._labelTopHeight),this._last_size[1]!=e){this._settings.height=e;var i=this.getTopParentView();clearTimeout(i._template_resize_timer),i._template_resize_timer=j((function(){t.$destructed||t.resize()}))}}},_getOptionsHeight:function(){var t=this.$view.querySelector(".webix_el_group").offsetWidth;return jt(this._optionsTemplate(),"webix_el_radio webix_el_group",t).height}},tr=(t.protoUI(Qa,Ga.view,ls),{name:"datepicker",_editable:!0,$init:function(t){t.multiselect&&(this._settings.multiselect=t.multiselect),t.type&&(this._settings.type=t.type),this.$ready.push(this._init_popup)},defaults:{template:function(t,e){"time"==e._settings.type&&(e._settings.icon=e._settings.timeIcon);var i=t.type;t.type="";var s=t.editable?e.$renderInput(t):e._render_div_block(t,e);return t.type=i,s},stringResult:!1,timepicker:!1,icon:"wxi-calendar",icons:!0,timeIcon:"wxi-clock",separator:", "},$onBlur:function(){var t=this.getText();if(this._settings.text!=t){var e=this._settings.editable?this.getValue():this.getPopup().getValue();this.setValue(e||"","user")}},$skin:function(){Ga.api.$skin.call(this),this.defaults.inputPadding=vi.inputPadding,this.defaults.point=!vi.popupNoPoint},getPopup:function(){return ke(this._settings.popup)},_init_popup:function(){var t=this._settings;if(t.suggest)t.popup=t.suggest;else if(!t.popup){var e=this._settings.timepicker;t.popup=t.suggest=this.suggest_setter({type:"calendar",point:!1!==this._settings.point,padding:0,body:{height:240+(e||this._settings.icons?30:0),width:250,multiselect:this._settings.multiselect,timepicker:e,type:this._settings.type,icons:this._settings.icons,timeIcon:this._settings.timeIcon}})}this._init_once=function(){}},$render:function(t){this.$setValue(t.value)},$prepareValue:function(t){if(this._settings.multiselect){"string"==typeof t?t=t.split(this._settings.separator):M(t)?t=[t]:t||(t=[]);for(var e=0;e<t.length;e++)t[e]=this._prepareSingleValue(t[e]);return t}return this._prepareSingleValue(t)},_prepareSingleValue:function(t){var e=this._settings.type,i="time"==e;if(isNaN(parseFloat(t))||(t=""+t),"string"==typeof t&&t&&(t=("month"!=e&&"year"!=e||!this._formatDate?i?R.parseTimeFormatDate:R.parseFormatDate:this._formatDate)(t)),t){if(i&&B(t)){var s=new Date;s.setHours(t[0]),s.setMinutes(t[1]),t=s}isNaN(t.getTime())&&(t="")}return t},_get_visible_text:function(t){var e=this;return this._settings.multiselect?[].concat(t).map((function(t){return e._get_visible_text_single(t)})).join(this.config.separator):this._get_visible_text_single(t)},_get_visible_text_single:function(t){var e=this._formatStr;return e||(e="time"==this._settings.type?R.timeFormatStr:this.config.timepicker?R.fullDateFormatStr:R.dateFormatStr),e(t)},_set_visible_text:function(){var t=this.getInputNode();E(t.value)?t.innerHTML=this._settings.text||this._get_div_placeholder():t.value=this._settings.text||""},$compareValue:function(t,e){return!t&&!e||$n.equal(t,e)},$setValue:function(t){this._settings.text=t?this._get_visible_text(t):"",this._set_visible_text(),this._toggleClearIcon(this._settings.text)},format_setter:function(t){return t?"function"==typeof t?this._formatStr=t:(this._formatStr=$n.dateToStr(t),this._formatDate=$n.strToDate(t)):this._formatStr=this._formatDate=null,t},getInputNode:function(){return this._settings.editable?this._dataobj.getElementsByTagName("input")[0]:this._dataobj.getElementsByTagName("DIV")[1]},getValue:function(){var t=this;if(this._settings.multiselect){var e=this._settings.value;if(!e)return[];var i=[].concat(e).map((function(e){return t._get_value_single(e)}));return this._settings.stringResult?i.join(this._settings.separator):i}return this._get_value_single(this._settings.value)},_get_value_single:function(t){var e=this._settings.type,i="time"==e;if(this._rendered_input){if(this._settings.editable){var s=this._formatDate;s||(s=i?R.timeFormatDate:this.config.timepicker?R.fullDateFormatDate:R.dateFormatDate);var n=s(this.getInputNode().value);i&&M(t)&&M(n)?((t=$n.copy(t)).setHours(n.getHours()),t.setMinutes(n.getMinutes()),t.setSeconds(n.getSeconds()),t.setMilliseconds(n.getMilliseconds())):t=n}}else t=this.$prepareValue(t)||null;if(this._settings.stringResult){var a=R.parseFormatStr;return i&&(a=R.parseTimeFormatStr),!this._formatStr||"month"!=e&&"year"!=e||(a=this._formatStr),this._settings.multiselect?[].concat(t).map((function(t){return t?a(t):""})):t?a(t):""}return t||null},getText:function(){var t=this.getInputNode();return t?E(t.value)?t.firstChild&&"webix_placeholder"===t.firstChild.className?"":t.innerHTML:t.value:""}}),er={api:tr,view:t.protoUI(tr,Ga.view)},ir={name:"colorpicker",$init:function(){this.$ready.push(this._init_popup)},defaults:{icon:!0},_init_popup:function(){var t=this._settings;t.suggest?t.popup=t.suggest:t.popup||(t.popup=t.suggest=this.suggest_setter({type:"colorboard"})),this._init_once=function(){}},clear_setter:function(t){return!!t},getValue:function(){return this._rendered_input&&this._settings.editable?this.getInputNode().value:this._settings.value},$prepareValue:function(t){return(t=t?t.toString(16):"")&&"#"!=t.charAt(0)&&/^[0-9a-fA-F]+$/.test(t)&&(t="#"+t),t},_getColorNode:function(){return this.$view.getElementsByTagName("DIV")[this._settings.editable?1:2]},_get_visible_text:function(t){return t},$compareValue:function(t,e){return t==e},$setValue:function(t){this._getColorNode().style.backgroundColor=t,this._settings.text=t,this._toggleClearIcon(t);var e=this.getInputNode();E(e.value)?e.innerHTML=t||this._get_div_placeholder():e.value=t},$renderIcon:function(t){var e=this._inputSpacing/2+5,i="<div class='webix_input_icon' style='top:"+(t.inputPadding+4)+"px;right:"+e+"px;background-color:"+t.value+";'></div>";if(!t.readonly&&t.clear){var s=t.aheight-2*t.inputPadding,n=(s-18)/2-1;i+="<span style='right:"+(e+=24)+"px;height:"+(s-n)+"px;padding-top:"+n+"px;' class='webix_input_icon webix_clear_icon webix_icon_transparent wxi-close'></span>"}return i}},sr=(t.protoUI(ir,er.view),{name:"richselect",defaults:{template:function(t,e){return e._render_div_block(t,e)},popupWidth:200,icon:"wxi-menu-down"},$onBlur:function(){var t=this.getText();if(this._settings.text!=t&&(!E(this._settings.text)||t)){var e=this.getPopup();if(!e.$view.contains(document.activeElement)){var i,s=this.config.newValues,n=this.getInputNode().value,a=this.getList();s?(i=a.find((function(t){return e.getItemText(t.id)==n}),!0))?i=i.id:n&&(i=a.add({value:n})):i=e.getSuggestion(n);var r=this.getValue();!i||i==r||""===n&&""!==e.getItemText(i)?""===n?this.setValue("","user"):this._revertValue&&this._revertValue():this.setValue(i,"user")}}},suggest_setter:function(t){return this.options_setter(t)},options_setter:function(t){var e=this;t=this._suggest_config?this._suggest_config(t):t;var i=this._settings.popup=this._settings.suggest=Ga.api.suggest_setter.call(this,t),s=ke(i).getList();return s&&s.attachEvent("onAfterLoad",(function(){return e._reset_value()})),i},getList:function(){var t=ke(this._settings.suggest);return f(t,"Input doesn't have a list"),t.getList()},_reset_value:function(){var t=this._settings.value;t&&(this.$setValue(t),this.getPopup().isVisible()&&this.getPopup()._show_selection())},$skin:function(){Ga.api.$skin.call(this),this.defaults.inputPadding=vi.inputPadding},$render:function(t){this.$setValue(t.value)},getInputNode:function(){return this._dataobj.getElementsByTagName("DIV")[1]},getPopup:function(){return ke(this._settings.popup)},getText:function(){var t=this._settings.value,e=this.getInputNode();return e?E(e.value)?e.firstChild&&"webix_placeholder"===e.firstChild.className?"":e.innerHTML:e.value:t?this.getPopup().getItemText(t):""},$prepareValue:function(t){return t&&t.id?t:Ga.api.$prepareValue.call(this,t)},$setValue:function(t){var e=t,i=this.getPopup();if(i&&(e=i.getItemText(t)),t&&t.id){var s=i.getList(),n=s.exists(t.id);n||s.add(t),e=i.getItemText(t.id),s._settings.dynamic&&!n&&s.remove(t.id),this._settings.value=this.$prepareValue(t.id)}var a=this.getInputNode();E(a.value)?a.innerHTML=e||this._get_div_placeholder():a.value=e=e.replace(/<[^>]*>/g,""),this._settings.text=e,this._toggleClearIcon(e)},getValue:function(){return this._settings.value||""},_ignoreLabelClick:function(t){t.type&&(this.focus(),St(t))}}),nr={api:sr,view:t.protoUI(sr,Ga.view)},ar={name:"combo",getInputNode:function(){return this._dataobj.getElementsByTagName("input")[0]},_init_onchange:function(){var t=this;_e(this.getInputNode(),"keydown",(function(e){13==e.keyCode&&nr.api.$onBlur.apply(t,[])})),nr.api._init_onchange.apply(this,arguments)},_revertValue:function(){var t=this.getValue();this.$setValue(E(t)?"":t)},_applyChanges:function(t){var e=this.getInputNode(),i="",s=this.getPopup();e.value&&(i=this._settings.value,s.getItemText(i)!=this.getText()&&(i=s.getSuggestion()||i)),i!=this._settings.value?this.setValue(i,t):this.$setValue(i)},defaults:{template:function(t,e){return e.$renderInput(t).replace(/(<input)\s*(?=\w)/,"$1 role='combobox'")},icon:"wxi-menu-down"},on_click:{webix_clear_icon:function(){return this.$allowsClear&&this.setValue("","user"),!1},webix_inp_label:function(t){this._ignoreLabelClick(t)},webix_inp_top_label:function(t){this._ignoreLabelClick(t)}}},rr=(t.protoUI(ar,nr.view),{name:"counter",defaults:{template:function(t,e){var i=t.value,s="x"+T(),n="<div role='spinbutton' aria-label='"+le.escape(t.label)+"' aria-valuemin='"+t.min+"' aria-valuemax='"+t.max+"' aria-valuenow='"+t.value+"' class='webix_el_group' style='width:"+e._get_input_width(t)+"px'>";return n+="<button type='button' class='webix_inp_counter_prev' tabindex='-1' aria-label='"+R.aria.decreaseValue+"'>-</button>",n+=e._baseInputHTML("input")+" id='"+s+"' type='text' class='webix_inp_counter_value' aria-live='assertive' value='"+i+"'></input>",n+="<button type='button' class='webix_inp_counter_next' tabindex='-1' aria-label='"+R.aria.increaseValue+"'>+</button></div>",e.$renderInput(t,n,s)},min:0,max:1/0,value:0,step:1},$init:function(){_e(this.$view,"keydown",this._keyshift,{bind:this})},_keyshift:function(t){if(!this._settings.readonly){var e=t.which||t.keyCode,i=this._settings,s=this.getValue();e>32&&e<41&&(36===e?s=i.min:35===e?s=i.max===1/0?1e6:i.max:33===e?this.next(i.step,"user"):34===e?this.prev(i.step,"user"):s+=37===e||40===e?-1:1,e>34&&s>=i.min&&s<=i.max&&this.setValue(s,"user"))}},$setValue:function(t){this.getInputNode().value=t},$prepareValue:function(t){t=parseFloat(t);var e=this._settings.min,i=this._settings.max;return isNaN(t)&&(t=isFinite(e)?e:0),Math.min(Math.max(t,e),i)},getInputNode:function(){return this._dataobj.getElementsByTagName("input")[0]},getValue:function(){return 1*Ha.api.getValue.apply(this,arguments)},next:function(t,e){t=1*(t||this._settings.step),this.shift(t,e)},prev:function(t,e){t=-1*(t||this._settings.step),this.shift(t,e)},shift:function(t,e){var i=Math.round(1e5*(this.getValue()+t))/1e5;this.setValue(i,e)}}),or=(t.protoUI(rr,Ga.view),{name:"icon",$skin:function(){Ha.api.$skin.call(this),this.defaults.height=vi.inputHeight,this.defaults.width=vi.inputHeight},defaults:{template:function(t,e){var i=Math.min(t.awidth,t.aheight),s=Math.round((e._content_height-t.aheight)/2),n="<button type='button' style='height:"+i+"px;width:"+i+"px;' class='webix_icon_button'><span class='webix_icon "+t.icon+"'></span></button>",a=t.aheight!=i?t.aheight:0;return"<div class='webix_el_box' style='width:"+t.awidth+"px;height:"+t.aheight+"px;line-height:"+a+"px;margin-top:"+s+"px'>"+n+(t.badge||0===t.badge?"<span class='webix_badge'>"+t.badge+"</span>":"")+"</div>"}},_set_inner_size:!1,_set_default_css:function(){},$setValue:function(){}}),lr=(t.protoUI(or,Ha.view),{name:"search",on_click:{webix_clear_icon:function(){return this.$allowsClear&&this.setValue("","user"),!1},webix_input_icon:function(t){this.getInputNode().focus(),"hover"!==this.config.clear&&t.target&&-1!==t.target.className.indexOf(this.config.icon)&&this.callEvent("onSearchIconClick",[t])}},defaults:{type:"text",icon:"wxi-search"}}),hr=(t.protoUI(lr,Ga.view),{name:"segmented",$allowsClear:!1,$init:function(){this.attachEvent("onChange",(function(t){this._settings.multiview&&this._show_view(t)})),this.attachEvent("onAfterRender",V((function(){this._settings.multiview&&this._settings.value&&this._show_view(this._settings.value)})))},_show_view:function(t){var e=this.getTopParentView(),i=null;e&&e.$$&&(i=e.$$(t)),i||(i=ke(t)),i&&i.show&&i.show()},defaults:{template:function(t,e){e._check_options(t.options);var i,s,n=e._filterOptions(t.options),a=e._get_input_width(t),r="contrast"==bi?0:n.length-1,o=t.optionWidth||Math.floor((a-r)/n.length),l="<div style='width:"+a+"px' class='webix_all_segments' role='tablist' aria-label='"+le.escape(t.label)+"'>";t.value||(t.value=e._getFirstActive(!0));for(var h=0;h<n.length;h++)s=!!n[h].disabled,i=t.tooltip?" webix_t_id='"+n[h].id+"'":"",l+="<button type='button' style='width:"+(n[h].width||o)+"px' role='tab' aria-selected='"+(t.value==n[h].id?"true":"false")+"' tabindex='"+(s||t.value!=n[h].id?"-1":"0")+"' class='webix_segment_"+(h==n.length-1?"N":h>0?1:0)+(t.value==n[h].id?" webix_selected":"")+(s?" webix_disabled":"")+"' "+(s?"webix_disabled='true' ":"")+"button_id='"+n[h].id+"'"+i+">"+n[h].value+"</button>";return e.$renderInput(t,l+"</div>",T())}},_getInputNode:function(){return this.$view.getElementsByTagName("BUTTON")},focus:function(){return this._focus()},blur:function(){this._blur()},$setValue:function(t){var e=this.config.tabbarPopup;if(e&&ke(e)&&ke(e).getBody().exists(t))return this.refresh();for(var i,s,n=this._getInputNode(),a=0;a<n.length;a++)i=n[a].getAttribute("button_id"),s=this.getOption(i),n[a].setAttribute("aria-selected",t==i?"true":"false"),n[a].setAttribute("tabindex",s&&!s.disabled&&t==i?"0":"-1"),t==i?Dt(n[a],"webix_selected"):Et(n[a],"webix_selected")},$getValue:function(){return this._settings.value||""},getValue:function(){return this._settings.value},getInputNode:function(){return null},_set_inner_size:!1}),cr={api:hr,view:t.protoUI(hr,Ga.view,ls)},dr={$init:function(){var t=this;_e(this.$view,"keydown",(function(e){return t._checkPageUp(e)})),this.$ready.push((function(){var t=this;this._settings.autoheight&&(Dt(this.$view,"webix_noscroll"),this._settings.maxHeight||(this._settings.maxHeight=100),_e(this.$view,"input",(function(){t._sizeToContent(!0)}),{capture:!0}),this.attachEvent("onAfterRender",(function(){t._sizeToContent()})))}))},_checkPageUp:function(t){var e="PageUp"==t.key;if(Ot.isChromium&&(e||"PageDown"==t.key)){var i=this.getInputNode(),s=e?0:i.value.length,n=e?0:i.scrollHeight;St(t),i.setSelectionRange(s,s),i.scrollTo(0,n)}},_sizeToContent:function(t){var e=this;if(this._skipSizing)return this._skipSizing=!1;var i=this.getInputNode(),s=this._getTextHeight(i.value,i.offsetWidth),n=2*vi.inputPadding+2*vi.borderWidth;(s=Math.max(s+n,this._settings.minHeight))>this._settings.maxHeight?(Et(this.$view,"webix_noscroll"),s=this._settings.maxHeight):Dt(this.$view,"webix_noscroll",!0);var a=this.getTopParentView();clearTimeout(a._template_resize_timer),a._template_resize_timer=j((function(){if(e.config.height!=s){e.config.height=s;var n=i.selectionEnd;e._skipSizing=!0;var a=Ga.api.getValue.call(e);e.resize(),e.callEvent("onInputResize",[]),t&&(i=e.getInputNode(),Ga.api.$setValue.call(e,a),i.setSelectionRange(n,n),i.focus())}}))},_getTextHeight:function(t,e){var i=vt("textarea",{class:"webix_textarea_measure",rows:"1"},"");i.style.cssText="height:auto;visibility:hidden; position:absolute; top:0px; left:0px; width:"+e+"px;",document.body.appendChild(i),i.value=t;var s=i.scrollHeight;return wt(i),s},$setValue:function(t){Ga.api.$setValue.call(this,t),this._settings.autoheight&&this._sizeToContent()}},ur={name:"textarea",defaults:{template:function(t,e){var i=t.name||t.id,s="x"+T(),n=e._baseInputHTML("textarea")+"style='width:"+e._get_input_width(t)+"px;'";return n+=" id='"+s+"' name='"+i+"' class='webix_inp_textarea'>"+e._pattern(t.value)+"</textarea>",e.$renderInput(t,n,s)},minHeight:60},$skin:function(){Ga.api.$skin.call(this),this.defaults.height=0},_skipSubmit:!0,_getLabelHeight:function(t){return t?this._labelTopHeight-this._settings.inputPadding:""},$renderIcon:function(){return""},getInputNode:function(){return this._dataobj.getElementsByTagName("textarea")[0]}},_r={api:ur,view:t.protoUI(ur,dr,Ga.view),autoheight:dr},pr={name:"toggle",$allowsClear:!0,$init:function(){this.attachEvent("onItemClick",(function(){this.toggle("user")}))},$renderInput:function(t){return"<button type='button' "+(t.popup?"aria-haspopup='true'":"")+" class='webix_button'>"+t.label+"</button>"},$setValue:function(t){var e=this.getInputNode(),i=this._settings,s=t&&"0"!=t,n=(s?i.onLabel:i.offLabel)||i.label,a=e.children;if(this._types[i.type]){var r=a[0];"SPAN"==r.nodeName&&i.onIcon&&i.offIcon&&i.onIcon!=i.offIcon&&(r.className=r.className.replace(s?i.offIcon:i.onIcon,s?i.onIcon:i.offIcon)),"imageTop"==i.type||"iconTop"==i.type?a[1].innerHTML=n:(e.innerHTML=n,e.insertBefore(r,e.firstChild))}else e.innerHTML=n;e.setAttribute("aria-pressed",s?"true":"false"),(s?Dt:Et)(e.parentNode,"webix_pressed")},toggle:function(t){this.setValue(!this.getValue(),t)},getValue:function(){var t=this._settings.value;return t&&"0"!=t?1:0},defaults:{template:function(t,e){var i=t.value&&"0"!=t.value,s=i?" webix_pressed":"";t.label=(i?t.onLabel:t.offLabel)||t.label,t.icon=(i?t.onIcon:t.offIcon)||t.icon;var n="<div class='webix_el_box"+s+"' style='width:"+t.awidth+"px; height:"+t.aheight+"px'>"+e.$renderInput(t,e)+"</div>";return n=n.replace(/(button)\s*(?=\w)/,"$1 aria-pressed='"+(i?"true":"false")+"' "),(t.badge||0===t.badge)&&(n=n.replace(/<\/div>$/,"<span class='webix_badge'>"+t.badge+"</span></div>")),n}},_set_inner_size:!1},fr=(t.protoUI(pr,Ha.view),{name:"multitext",$cssName:"text",defaults:{icon:"wxi-plus-circle",iconWidth:25,separator:", "},getValueHere:function(){return Ga.api.getValue.call(this)},setValueHere:function(t){return Ga.api.$setValue.call(this,t)},getValue:function(){if("extra"==this.config.mode)return this.getValueHere();if(this._full_value)return this._full_value;for(var t=[this.getValueHere(this)],e=0;e<this._subs.length;e++){var i=ke(this._subs[e]).getValueHere();i&&t.push(i)}return t.join(this.config.separator)},$setValue:function(t){if(t=t||"","extra"==this.config.mode)return this.setValueHere(t);this._full_value=t;var e=t.split(this.config.separator);if(e.length!=this._subs.length+1){this.removeSection(),this.setValueHere.call(this,e[0]);for(var i=1;i<e.length;i++)this.addSection(e[i]);this._full_value=""}else{this.setValueHere(e[0]);for(var s=0;s<this._subs.length;s++)ke(this._subs[s]).setValueHere(e[s+1]);this._full_value=""}},$renderIcon:function(t){if(t.icon){var e=t.aheight-2*t.inputPadding,i=(e-18)/2-1,s="role='button' tabindex='0' aria-label='"+R.aria["multitext"+(t.mode||"")+"Section"]+"'";return"<span style='right:0;height:"+(e-i)+"px;padding-top:"+i+"px;' class='webix_input_icon webix_multitext_icon "+t.icon+"' "+s+"></span>"}return""},_subOnChange:function(t,e,i){var s=this.config.master?ke(this.config.master):this,n=s.getValue(),a=s._settings.value;n!=a&&(s._settings.value=n,s.callEvent("onChange",[n,a,i]))},addSection:function(e){var i=this.config,s={labelWidth:i.labelWidth,inputWidth:i.inputWidth,width:i.width,label:i.label?"&nbsp;":"",view:this.name,mode:"extra",value:e||"",icon:"wxi-minus-circle",tooltip:i.tooltip,suggest:i.suggest||null,master:i.id};t.extend(s,i.subConfig||{},!0);var n=this.getParentView().addView(s);return ke(n).attachEvent("onChange",this._subOnChange),this._subs.push(n),this.callEvent("onSectionAdd",[n,this._subs.length]),n},removeSection:function(t){for(var e=this.config.master?ke(this.config.master):this,i=e._subs.length-1;i>=0;i--){var s=e._subs[i];t&&s!=t||(e._subs.removeAt(i),this.getParentView().removeView(s),e.callEvent("onSectionRemove",[s,i+1]))}},on_click:{webix_input_icon:function(){if("extra"==this.config.mode){var t=this.getParentView();this.removeSection(this.config.id);var e=t.getChildViews();e[e.length-1].focus(),this._subOnChange(null,null,"user")}else ke(this.addSection()).focus();return!1}},$init:function(){this._subs=O([]),this.attachEvent("onKeyPress",this._onKeyPress)},$render:function(t){this.$setValue(t.value)}}),gr=(t.protoUI(fr,Ga.view),{name:"proto",$init:function(){this.data.provideApi(this,!0),this._dataobj=this._dataobj||this._contentobj,this.data.attachEvent("onStoreUpdated",A((function(){this.render.apply(this,arguments)}),this))},$setSize:function(){mi.api.$setSize.apply(this,arguments)&&this.render()},_id:"webix_item",on_mouse_move:{},type:{}}),mr={api:gr,view:t.protoUI(gr,gs,Ri,xi,Xs,vs,Gi,mi.view,H,ai)},vr={name:"list",_listClassName:"webix_list",_itemClassName:"webix_list_item",$init:function(t){var e=this;Dt(this._viewobj,this._listClassName+("x"==(t.layout||this.defaults.layout)?"-x":"")),this.data.provideApi(this,!0),this.data.attachEvent("onStoreUpdated",(function(t,i,s){t&&"add"!==s&&"delete"!==s||e._auto_resize()})),this.data.attachEvent("onSyncApply",(function(){return e._auto_resize()})),this._viewobj.setAttribute("role","listbox")},dynamic_setter:function(e){return e&&t.extend(this,Qs,!0),e},$dragHTML:function(t,e,i){var s;return"y"==this._settings.layout&&"auto"==this.type.width?(this.type.width=this._content_width,s=this._toHTML(t),this.type.width="auto"):s=this._toHTML(t),B(i.source)&&i.source.length>1&&(s=this._toMultipleHTML(s,i.source.length)),s},defaults:{select:!1,scroll:!0,layout:"y",navigation:!0,datafetch:50},_id:"webix_l_id",on_click:{webix_list_item:function(t,e){this._settings.select&&(this._no_animation=!0,"multiselect"==this._settings.select||this._settings.multiselect?this.select(e,!1,t.ctrlKey||t.metaKey||"touch"==this._settings.multiselect,t.shiftKey):this.select(e),this._no_animation=!1)}},on_dblclick:{},getVisibleCount:function(){return Math.floor(this._content_height/this._one_height())},_auto_resize:function(){var t=this._settings;if(t.autoheight||t.autowidth)return this.resize();"y"==t.layout?t.yCount&&this._auto_height_calc(t.yCount):t.xCount&&this._auto_width_calc(t.xCount)},_auto_height_calc:function(t){var e=this.data.$pagesize||this.count();this._settings.autoheight&&e<(t||1/0)&&(t=e);var i=this._one_height()*t+(this.type.margin||0);this.getUnits&&(i+=this.getUnits().length*this.type.headerHeight);var s=this._settings.maxHeight||1/0;return i=Math.max(i,this._settings.minHeight||0),this._onoff_scroll(t&&t<e||i>s,"y"),Math.min(i,s)},_one_height:function(){return this.type.height+(this.type.margin||0)},_auto_width_calc:function(t){var e=this.data.$pagesize||this.count();return this._onoff_scroll(t&&t<e,"x"),this._settings.autowidth&&e<(t||1/0)&&(t=e),this.type.width*t},$getSize:function(t,e){return"y"==this._settings.layout?("auto"!=this.type.width&&(this._settings.width=this.type.width+(this._scroll_y?Ot.scrollSize:0)),(this._settings.yCount||this._settings.autoheight)&&(this._settings.height=this._auto_height_calc(this._settings.yCount)||1)):("auto"!=this.type.height&&(this._settings.height=this._one_height()+(this._scroll_x?Ot.scrollSize:0)),(this._settings.xCount||this._settings.autowidth)&&(this._settings.width=this._auto_width_calc(this._settings.xCount)||1)),mi.api.$getSize.call(this,t,e)},$setSize:function(){mi.api.$setSize.apply(this,arguments)},type:{css:"",widthSize:function(t,e){return e.width+(e.width>-1?"px":"")},heightSize:function(t,e){return e.height+(e.height>-1?"px":"")},classname:function(t,i,s){var n="webix_list_item";return i.css&&(n+=" "+i.css),t.disabled&&(n+=" webix_disabled"),t.$css&&("object"==e(t.$css)&&(t.$css=ft(t.$css)),n+=" "+t.$css),s&&s.$css&&(n+=" "+s.$css),n},aria:function(t,e,i){return'role="option"'+(i&&i.webix_selected?' aria-selected="true" tabindex="0"':' tabindex="-1"')+(t.$count&&t.$template?'aria-expanded="true"':"")+(t.disabled?' aria-disabled="true" webix_disabled="true"':"")},template:function(t){return(t.icon?"<span class='webix_list_icon webix_icon "+t.icon+"'></span>":"")+t.value+(t.badge||0===t.badge?"<div class='webix_badge'>"+t.badge+"</div>":"")},width:"auto",templateStart:le('<div webix_l_id="#id#" class="{common.classname()}" style="width:{common.widthSize()}; height:{common.heightSize()}; overflow:hidden;" {common.aria()}>'),templateEnd:le("</div>")},$skin:function(){this.type.height=vi.listItemHeight},disableItem:function(t){this._set_item_disabled(t,!0)},enableItem:function(t){this._set_item_disabled(t,!1)},_set_item_disabled:function(t,e){var i=this.getItem(t);i&&(i.disabled=e,this.refresh(t))},isItemEnabled:function(t){var e=this.getItem(t);return e&&!e.disabled},_skip_item:function(t,e,i){return this.isItemEnabled(t)?t:(t=this.getNextId(t,i)||null)&&t!=e?this._skip_item(t,e,i):e}},br={api:vr,view:t.protoUI(vr,Oi,ds,zi,Xi,_s,ws,bs,mr.view,Mi)},wr={name:"multiselect",$cssName:"richselect",defaults:{separator:",",stringResult:!0},_suggest_config:function(i){var s=!B(i)&&"object"==e(i)&&!i.name,n={view:"checksuggest",separator:this.config.separator,buttonText:this.config.buttonText,button:this.config.button};this._settings.optionWidth?n.width=this._settings.optionWidth:n.fitMaster=!0,s&&t.extend(n,i,!0);var a=be(n),r=a.getList();return"string"==typeof i?r.load(i):s||r.parse(i),a.attachEvent("onShow",(function(){a.setValue(ke(a._settings.master).config.value,"auto")})),a},$compareValue:function(t,e){return t.toString()==e.toString()},$prepareValue:function(t){return"string"==typeof(t=t||[])?t.split(this._settings.separator):B(t)?t:[Ha.api.$prepareValue.call(this,t)]},$setValue:function(t){if(this._rendered_input){var i=this.getPopup(),s="";i&&"object"==e(s=i.setValue(t,"auto"))&&(s=s.join(this.config.separator+" ")),this._settings.text=s,this._toggleClearIcon(s),this.getInputNode().innerHTML=s||this._get_div_placeholder()}},getValue:function(){var t=this._settings.value||[];return this._settings.stringResult?t.join(this._settings.separator):t}};is.multiselect=t.extend({popupType:"multiselect",popupInit:function(t){t.linkInput(document.body)}},is.richselect),ge(br.view,{name:"multilist",templateStart:le('<div webix_l_id="#!id#" class="{common.classname()}" style="width:{common.widthSize()}; height:{common.heightSize()}; overflow:hidden;" {common.aria()}>')}),ge(br.view,{name:"checklist",templateStart:le('<div webix_l_id="#!id#" class="{common.classname()}" style="width:{common.widthSize()}; height:{common.heightSize()}; overflow:hidden;" {common.aria()}>{common.checkbox()}'),checkbox:function(t){var e=t.$checked?"wxi-checkbox-marked":"wxi-checkbox-blank";return"<span role='checkbox' tabindex='-1' aria-checked='"+(t.$checked?"true":"false")+"' class='webix_icon "+e+"'></span>"},aria:function(t){return"role='option' tabindex='-1' "+(t.$checked?"aria-selected='true'":"")+(t.disabled?' aria-disabled="true" webix_disabled="true"':"")},template:le("#value#")}),t.protoUI(wr,nr.view);var yr={name:"multicombo",$cssName:"text",defaults:{keepText:!1,separator:",",stringResult:!0,icon:!1,iconWidth:0,tagMode:!0,tagTemplate:function(t){return t.length?t.length+" item(s)":""},template:function(t,e){return e._render_value_block(t,e)}},$init:function(){var t=this;this.$view.className+=" webix_multicombo",this.attachEvent("onAfterRender",(function(){this._last_size=null})),_e(this.$view,"scroll",(function(){t.$view.scrollTop=0}))},$skin:function(){nr.api.$skin.call(this),this._inputHeight=vi.inputHeight},on_click:{webix_multicombo_delete:function(t,e,i){return!this._settings.readonly&&i&&this._removeValue(i.parentNode.getAttribute("optvalue")),!1},webix_inp_label:function(t){this._ignoreLabelClick(t)},webix_inp_top_label:function(t){this._ignoreLabelClick(t)}},$onBlur:function(){var t=this.getInputNode(),e=t.value;e&&this._settings.newValues&&new Date-(this.getPopup()._click_stamp||0)>100&&(e=e.trim(),this._addNewValue(e,"user")),this._inputValue=t.value=this._settings.keepText?e:"",this.$setValue()},_removeValue:function(t){var e,i=O(I(this._settings.value||[]));if(t&&-1!==(e=i.find(t))){i.removeAt(e),this.setValue(i,"user");var s=ke(this.config.suggest);s&&s._settings.selectAll&&s.getBody()._cells[0].setValue(0,"auto")}},_addValue:function(t,e){var i=ke(this.config.suggest);if(i.getList().getItem(t)){var s=i.getValue();s&&"string"==typeof s&&(s=s.split(i.config.separator)),(s=O(s||[])).find(t)<0&&(s.push(t),i.setValue(s,e),this.setValue(i.getValue(),e))}},_addNewValue:function(t,e){var i,s=ke(this.config.suggest),n=s.getList();if(t=le.escape(t.trim())){for(var a in n.data.pull)s.getItemText(a)==t&&(i=a);i||(i=n.add({value:t})),this._addValue(i,e)}},_suggest_config:function(i){var s=!B(i)&&"object"==e(i)&&!i.name,n={view:"checksuggest",separator:this.config.separator,buttonText:this.config.buttonText,button:this.config.button},a=this;s&&t.extend(n,i,!0),!n.width&&this._settings.optionWidth&&t.extend(n,{width:this._settings.optionWidth,fitMaster:!1},!0),n.width=n.fitMaster||E(n.fitMaster)?0:n.width;var r=be(n);n.width||(r.$customWidth=function(){this.config.width=a._get_input_width(a._settings)}),r.attachEvent("onBeforeShow",(function(t,e,i){if(this._settings.master&&(this.setValue(ke(this._settings.master).config.value,"auto"),ke(this._settings.master).getInputNode().value||this.isVisible()?(this.getList().refresh(),this._dont_unfilter=!0):this.getList().filter(),t.tagName&&"input"==t.tagName.toLowerCase()))return Ca.api.show.apply(this,[t.parentNode,e,i]),!1}));var o=r.getList();return"string"==typeof i?o.load(i):s||o.parse(i),r._suggest_after_filter=function(){if(!this._resolve_popup)return!0;this._resolve_popup=!1,this.show(a._getInputDiv())},r},_render_value_block:function(t,e){var i,s,n,a,r,o,l,h,c,d,u,_,p="",f="top"==this._settings.labelPosition;return i="x"+T(),_=e._get_input_width(t),s=t.inputAlign||"left",r=this._input_height-2*vi.inputPadding-2,a=this._inputValue||"",h="<ul class='webix_multicombo_listbox' style='line-height:"+r+"px'></ul>",n="width:"+Math.min(_,e._inputWidth||7)+"px;height:"+r+"px;max-width:"+(_-20)+"px",u=t.readonly?" readonly ":"",o="<div class='webix_inp_static' onclick='' style='line-height:"+r+"px;width:"+_+"px;text-align:"+s+";height:auto' >"+h+"<input id='"+i+"' role='combobox' aria-multiline='true' aria-label='"+le.escape(t.label)+"' tabindex='0' type='text' class='webix_multicombo_input' "+u+" style='"+n+"' value='"+a+"'/></div>",l=e.$renderLabel(t,i),d=this._settings.awidth-_-2*vi.inputPadding,(c=(t.invalid?t.invalidMessage:"")||t.bottomLabel)&&(p="<div class='webix_inp_bottom_label' style='width:"+_+"px;margin-left:"+Math.max(d,vi.inputPadding)+"px;'>"+c+"</div>"),f?l+"<div class='webix_el_box' style='width:"+this._settings.awidth+"px; height:auto;'>"+o+p+"</div>":"<div class='webix_el_box' style='width:"+this._settings.awidth+"px; height:auto; min-height:"+this._settings.aheight+"px;'>"+l+o+p+"</div>"},_getValueListBox:function(){return this._getBox().getElementsByTagName("UL")[0]},_set_inner_size:function(){var t=this.getPopup();if(t){var e=t?t.setValue(this._settings.value,"auto"):null;t._toMultiValue&&(this._settings.value=t._toMultiValue(this._settings.value));var i="",s=this._getValueListBox(),n=e&&e.length;if(n){var a=this._get_input_width(this._settings)-2-6,r=this._input_height-2*vi.inputPadding-2-6,o=this._settings.value||[];if(this._settings.tagMode)for(var l=0;l<e.length;l++)i+=this.$renderTag(e[l],a,r,o[l]);else i+="<li class='webix_multicombo_tag' style='line-height:"+r+"px;max-width:"+a+"px;'><span class='webix_multicombo_text'>"+this._settings.tagTemplate(o)+"</span></li>"}s.innerHTML=i;var h=this.getInputNode();this._settings.placeholder&&(n?(h.placeholder="",!h.value&&h.offsetWidth>20&&(h.style.width="20px")):h.value||(h.placeholder=this._settings.placeholder,h.style.width=this._get_input_width(this._settings)+"px")),!this._settings.tagMode&&s.firstChild&&(h.style.width=this._getMultiComboInputWidth()+"px")}this._resizedToContent?delete this._resizedToContent:this._resizeToContent()},$renderTag:function(t,e,i,s){var n=this._settings,a="<span class='webix_multicombo_text'>"+t+"</span>",r=n.readonly?"":"<span class='webix_multicombo_delete' role='button' aria-label='"+R.aria.removeItem+"'></span>";return"<li class='webix_multicombo_value"+(n.readonly?" webix_readonly":"")+"' style='line-height:"+i+"px;max-width:"+e+"px;' optvalue='"+le.escape(s)+"'>"+a+r+"</li>"},_focusAtEnd:function(t){if(t=t||this.getInputNode()){var e=t.value.length;t.selectionStart=e,t.selectionEnd=e,t.focus()}},_resizeToContent:function(t){var e="top"==this._settings.labelPosition,i=this._getInputDiv(),s=Math.max(i.offsetHeight+2*vi.inputPadding,this._input_height);if(e&&(s+=this._labelTopHeight),(s+=this._settings.bottomPadding||0)!=this.$getSize(0,0)[2]){var n=i.offsetHeight+(e?this._labelTopHeight:0)+2*vi.inputPadding,a=this.getTopParentView();clearTimeout(a._template_resize_timer),a._template_resize_timer=j((function(){this.config.height!=n&&(this.config.height=n,this._resizedToContent=!0,this.resize()),ni.getFocus()===this&&(t?this.getInputNode().select():this._focusAtEnd(this.getInputNode()));var e=this.getPopup();if(e.isVisible()){var i,s=this._getInputDiv(),a=this.queryView((function(t){return t.config.scroll&&-1!=t.config.scroll.indexOf("y")}),"parent");if(a){var r=kt(s),o=kt(a.$view);r.y+r.height>o.y+o.height&&(i={pos:"top"})}e.show(s,i)}}),this)}t&&this.getInputNode().select()},_getInputDiv:function(){for(var t=this._getBox(),e=t.childNodes,i=0;i<e.length;i++)if(e[i].className&&-1!=e[i].className.indexOf("webix_inp_static"))return e[i];return t},getInputNode:function(){return this._dataobj.getElementsByTagName("INPUT")[0]},$compareValue:function(t,e){return t.toString()==e.toString()},$prepareValue:function(t){return"string"==typeof(t=t||[])?t.split(this._settings.separator):B(t)?t:[Ha.api.$prepareValue.call(this,t)]},$setValue:function(){this._rendered_input&&this._set_inner_size()},getValue:function(t){if("object"==e(t)&&t.options)return this._getSelectedOptions();var i=this._settings.value||[];return this._settings.stringResult?i.join(this._settings.separator):i},getText:function(){var t=this._settings.value||[];if(!t.length)return"";for(var e=[],i=0;i<t.length;i++)e.push(this.getPopup().getItemText(t[i]));return e.join(this._settings.separator)},_getSelectedOptions:function(){var t,e,i,s=[],n=this._settings.value||[];if(!n.length)return n;for(i=this.getPopup(),t=0;t<n.length;t++)(e=i.getList().getItem(n[t])||(i._valueHistory?i._valueHistory[n[t]]:null))&&s.push(e);return s},$setSize:function(t,e){var i=this._settings;if(mi.api.$setSize.call(this,t,e)){if(!t||!e)return;"top"==i.labelPosition&&(i.labelWidth=0),this.render()}},$render:function(){},_calcInputWidth:function(t){var e=vt("span",{type:"text",style:"visibility:visible; white-space:pre-wrap; position:absolute; top:-9999px;"});e.className="webix_el_text",e.innerHTML='<span class="webix_multicombo_input" style="margin:0;">'.concat(t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"</span>"),document.body.appendChild(e);var i=e.offsetWidth+1;return document.body.removeChild(e),i},_getMultiComboInputWidth:function(){var t=this._getValueListBox(),e=t.offsetWidth-(t.firstChild.offsetWidth+1);return e<=25?t.offsetWidth-12:e-15},_getLastInputValue:function(t,e){for(var i=t.split(this._settings.separator),s=this.getPopup(),n="",a=0;a<i.length;a++){var r=i[a].trim();if(r)if(n=r,this._settings.newValues)this._addNewValue(r,e);else{var o=s.getItemId(r);o&&this._addValue(o,e)}}return n},_init_onchange:function(){_e(this._getBox(),"click",(function(t){var e=this.getInputNode();e.contains(t.target)?e.focus():this._focusAtEnd(e)}),{bind:this}),_e(this.getInputNode(),"focus",(function(){-1==this._getBox().className.indexOf("webix_focused")&&(this._getBox().className+=" webix_focused")}),{bind:this}),_e(this.getInputNode(),"blur",(function(){this._getBox().className=this._getBox().className.replace(" webix_focused","")}),{bind:this}),_e(this.getInputNode(),"input",(function(){var t,e,i=this.getInputNode(),s=!1;if(this._settings.tagMode&&i.value.indexOf(this._settings.separator)>-1){var n=this._getLastInputValue(i.value,"user");this._inputValue=i.value=this._settings.keepText?n:"",s=this._settings.keepText}var a=this._settings.value||[];!this._settings.placeholder||i.value||a.length?(e=t=this._calcInputWidth(i.value),!this._settings.tagMode&&this._getValueListBox().firstChild&&(e=this._getMultiComboInputWidth())):e=this._get_input_width(this._settings),i.style.width=e+"px",(s||t!=this._inputWidth)&&(this._inputWidth=t||e,this._inputValue=i.value,this._resizeToContent(s))}),{bind:this}),_e(this.getInputNode(),"keydown",(function(t){var e=this.getInputNode(),i=this.getPopup(),s=t.which||t.keyCode,n=this._getValueListBox().lastChild;if(8==s&&!this._settings.readonly&&n&&(!e.value&&(new Date).valueOf()-(this._backspaceTime||0)>100?this._removeValue(n.getAttribute("optvalue")):this._backspaceTime=(new Date).valueOf()),13==s||9==s){var a=e.value;i.getList().getSelectedId()||(a=this._getLastInputValue(e.value,"user")),this._inputValue=e.value=this._settings.keepText?a:"";var r=this._settings.value||[];13!=s||e.value||r.length||(i.getList().filter(),this._settings.placeholder&&(e.style.width=this._get_input_width(this._settings)+"px")),this._resizeToContent(13==s)}}),{bind:this}),ke(this._settings.suggest).linkInput(this)}},xr=(t.protoUI(yr,nr.view),{name:"slider",defaults:{min:0,max:100,value:50,step:1,title:!1,moveTitle:!0,template:function(t,e){var i,s=e._handle_id="x"+T(),n="<div class='webix_slider_title"+(t.moveTitle?" webix_slider_move":"")+"'"+(!t.moveTitle&&t.vertical?" style='line-height:"+(t.aheight-2*t.inputPadding)+"px;'":"")+">&nbsp;</div>",a="<div class='webix_slider_left'>&nbsp;</div>",r="<div class='webix_slider_right'></div>",o="<div class='webix_slider_handle' webix_disable_drag='true' role='slider' aria-label='"+t.label+(t.title?" "+t.title(t):"")+"' aria-valuemax='"+t.max+"' aria-valuemin='"+t.min+"' aria-valuenow='"+t.value+"' tabindex='0' id='"+s+"'>&nbsp;</div>";return i=t.vertical?"<div class='webix_slider_box'>"+r+a+o+"</div>"+n:n+"<div class='webix_slider_box'>"+a+r+o+"</div>",e.$renderInput(t,i,s)}},type_setter:function(t){this._viewobj.className+=" webix_slider_"+t},title_setter:function(t){return"string"==typeof t?le(t):t},_get_slider_handle:function(){return this.$view.querySelector(".webix_slider_handle")},_set_inner_size:function(){var t=this._get_slider_handle(),e=this._settings;if(t){var i=e.vertical?this._content_height:this._get_input_width(e),s=e.value%e.step?Math.round(e.value/e.step)*e.step:e.value,n=e.max-e.min;s=this._safeValue(s),s=e.vertical?n-(s-e.min):s-e.min;var a=Math.ceil((i-2*this._sliderPadding)*s/n),r=i-2*this._sliderPadding-a,o=e.vertical?"top":"left",l=e.vertical?"height":"width";t.style[o]=this._sliderPadding+a-this._sliderHandleWidth/2+"px",t.parentNode.style[l]=i+"px",r=this._safeValue(r,2*this._sliderBorder,i-2*this._sliderPadding-2*this._sliderBorder),a=this._safeValue(a,2*this._sliderBorder,i-2*this._sliderPadding-2*this._sliderBorder);var h=t.previousSibling;h.style[l]=r+"px",h.previousSibling.style[l]=a+"px",this._set_title(t,a,r,o)}},_set_title:function(t,e,i,s){var n=this._settings;if(this._settings.title){var a=t.parentNode[n.vertical?"nextSibling":"previousSibling"];if(a.innerHTML=this._settings.title(this._settings,this),this._settings.moveTitle){var r=0;if(n.vertical)r=e+2*this._sliderBorder-this._sliderHandleWidth/2;else{var o=a.clientWidth/2,l=o>e?o-e-2*this._sliderBorder:0,h=o>i?o-i-2*this._sliderBorder-this._sliderHandleWidth/2:0;r=this._sliderPadding+e-o+l-h}a.style[s]=r+"px"}}},_set_value_now:function(){this._get_slider_handle().setAttribute("aria-valuenow",this._settings.value)},_safeValue:function(t,e,i){return e=e||this._settings.min,i=i||this._settings.max,Math.min(Math.max(t,e),i)},refresh:function(){var t=this._get_slider_handle();t&&(this._set_value_now(),this._settings.title&&t.setAttribute("aria-label",this._settings.label+" "+this._settings.title(this._settings,this)),this._set_inner_size())},$setValue:function(){this.refresh()},$getValue:function(){return this._settings.value},$prepareValue:function(t){return t=parseFloat(t),isNaN(t)&&(t=this._settings.min),this._safeValue(t)},$init:function(t){var e=this;_e(this._viewobj,Ot.mouse.down,(function(t){return e._on_mouse_down_start(t,"mouse")})),Ot.touch&&_e(this._viewobj,Ot.touch.down,(function(t){return e._on_mouse_down_start(t,"touch")})),_e(this.$view,"keydown",A(this._handle_move_keyboard,this)),t.vertical&&(t.height=t.height||vi.vSliderHeight,this._viewobj.className+=" webix_slider_vertical",this._sliderPadding=vi.vSliderPadding)},$skin:function(){Ga.api.$skin.call(this),this._sliderHandleWidth=vi.sliderHandleWidth,this._sliderPadding=vi.sliderPadding,this._sliderBorder=vi.sliderBorder},_handle_move_keyboard:function(t){var e=t.which||t.keyCode,i=this._settings,s=i.value;if(e>32&&e<41){St(t);var n=t.target,a=/webix_slider_handle_(\d)/.exec(n.className);if(this._activeIndex=a?parseInt(a[1],10):-1,a&&(s=i.value[this._activeIndex]),s=s<i.min?i.min:s>i.max?i.max:s,36===e)s=i.min;else if(35===e)s=i.max;else{var r=37===e||40===e||34===e?-1:1;(33===e||34===e||i.step>1)&&(r*=i.step),s=1*s+r}if(a){var o=i.value[this._activeIndex?0:1];s=this._activeIndex&&s<=o||!this._activeIndex&&s>=o?o:s}if(s>=i.min&&s<=i.max){if(a){for(var l=[],h=0;h<i.value.length;h++)l[h]=h===this._activeIndex?s:i.value[h];s=l}this.setValue(s,"user"),this._activeIndex=-1}}},_on_mouse_down_start:function(t,e){var i=this,s=this._settings;if(!s.disabled&&!s.readonly){var n=t.target;this._mouse_down_process&&this._mouse_down_process(t);var a=s.value;B(a)&&(a=I(a)),this._start_value=a,-1!==n.className.indexOf("webix_slider")&&(s.value=this._get_value_from_event(t));var r="touch"===e?{passive:!1}:null;this._handle_drag_events=[pe(document.body,Ot[e].move,(function(t){return i._handle_move_process(t,e)}),r),pe(document,Ot[e].up,(function(){return i._handle_move_stop()}))],Dt(document.body,"webix_noselect")}},_handle_move_stop:function(){fe(this._handle_drag_events[0]),fe(this._handle_drag_events[1]),this._handle_drag_events=null;var t=this._settings.value;B(t)&&(t=I(t)),this._settings.value=this._start_value,this.setValue(t,"user"),this._get_slider_handle(this._activeIndex).focus(),this._activeIndex=-1,Et(document.body,"webix_noselect")},_handle_move_process:function(t,e){this._settings.value=this._get_value_from_event(t),this.refresh(),this.callEvent("onSliderDrag",[]),"touch"===e&&St(t)},_get_value_from_event:function(t){var e=this._settings.vertical?"y":"x",i=$t(t)[e];return this._get_value_from_pos(i)},_get_value_from_pos:function(t){var e=this._settings,i=e.max-e.min,s=e.vertical?"y":"x",n=kt(this._get_slider_handle().parentNode)[s]+this._sliderPadding,a=(e.vertical?this._content_height:this._get_input_width(e))-2*this._sliderPadding,r=a?(t-n)*i/a:0;return e.vertical&&(r=i-r),r=Math.round((r+1*e.min)/e.step)*e.step,this._safeValue(r)},_init_onchange:function(){}}),kr={api:xr,view:t.protoUI(xr,Ga.view)},Cr={name:"rangeslider",$cssName:"slider webix_rangeslider",defaults:{separator:",",min:0,max:100,value:[20,80],template:function(t,e){var i="x"+T();e._handle_id=[i+"_0",i+"_1"];var s="role='slider' aria-label='"+t.label+(t.title?" "+t.title(t):"")+"' aria-valuemax='"+t.max+"' aria-valuemin='"+t.min+"' tabindex='0'",n="<div class='webix_slider_handle webix_slider_handle_0' webix_disable_drag='true' id='"+e._handle_id[0]+"' "+s+" aria-valuenow='"+t.value[0]+"'>&nbsp;</div>";n+="<div class='webix_slider_handle webix_slider_handle_1' webix_disable_drag='true' id='"+e._handle_id[1]+"' "+s+" aria-valuenow='"+t.value[1]+"'>&nbsp;</div>";var a="<div class='webix_slider_title"+(t.moveTitle?" webix_slider_move":"")+"'"+(!t.moveTitle&&t.vertical?" style='line-height:"+(t.aheight-e._sliderPadding-2*t.inputPadding)+"px;'":"")+">&nbsp;</div>";t.moveTitle&&(a="<div class='webix_slider_title_box'>"+(a+a)+"</div>");var r,o="<div class='webix_slider_right'>&nbsp;</div><div class='webix_slider_left'></div>";return r=t.vertical?"<div class='webix_slider_box'>"+o+n+"</div>"+a:a+"<div class='webix_slider_box'>"+o+n+"</div>",e.$renderInput(t,r,i)}},$prepareValue:function(t){var e=this._settings.min;if(B(t)||(t=(t||"").toString().split(this._settings.separator)),t[0]=parseFloat(t[0]),t[0]=isNaN(t[0])?e:this._safeValue(t[0]),t.length<2?t[1]=t[0]:(t[1]=parseFloat(t[1]),t[1]=isNaN(t[1])?t[0]:this._safeValue(t[1])),t[0]>t[1]){var i=[t[1],t[0]];t[0]=i[0],t[1]=i[1]}return t},_get_slider_handle:function(t){return t=t&&t>=0?t:0,this.$view.querySelector(".webix_slider_handle_"+(t||0))},_get_left_pos:function(t,e){var i,s,n;return s=(i=this._settings).max-i.min,n=i.value[e]%i.step?Math.round(i.value[e]/i.step)*i.step:i.value[e],n=this._safeValue(n),Math.ceil((t-2*this._sliderPadding)*(n-i.min)/s)},_set_left_pos:function(t,e,i){var s=this._sliderPadding+e-this._sliderHandleWidth/2*(i?-1:1);return(s=i?t-s:s)+"px"},_set_value_pos:function(t,e,i,s){var n=e+this._sliderPadding+2*this._sliderBorder;return s&&(n=t-n-i),n+"px"},_set_inner_size:function(){var t,e,i,s,n,a,r,o,l,h,c;e=this._get_slider_handle(0),i=this._get_slider_handle(1),B((t=this._settings).value)||this.define("value",t.value),e&&(l=t.vertical?"height":"width",c=t.vertical?"top":"left",a=(h=t.vertical?this._content_height:this._get_input_width(t))-2*this._sliderPadding-2*this._sliderBorder,s=this._get_left_pos(h,0),r=(n=this._get_left_pos(h,1))-s,e.style[c]=this._set_left_pos(h,s,t.vertical),i.style[c]=this._set_left_pos(h,n,t.vertical),(o=e.parentNode).style[l]=h+"px",o.firstChild.style[l]=a+"px",o.childNodes[1].style[l]=r+"px",o.childNodes[1].style[c]=this._set_value_pos(h,s,r,t.vertical),this._set_title(e,[s,n],a,c))},_title_hidden:0,_hide_title:function(t,e){E(this._title_hidden)||(t[this._title_hidden].style.visibility="visible"),E(e)||(t[e].style.visibility="hidden",this._title_hidden=e)},_set_title:function(t,e,i,s){var n=this._settings;if(this._settings.title){var a=t.parentNode,r=n.vertical?"nextSibling":"previousSibling";if(n.moveTitle){for(var o=a[r].childNodes,l=[],h=0;h<2;h++)l.push(this._set_title_n(o[h],n.value[h],e[h],i,s,h));var c=n.vertical?l[0]-l[1]-this._sliderHandleWidth:l[1]-l[0],d=n.vertical?"clientHeight":"clientWidth";o[0][d]/2+o[1][d]/2>c?this._hide_title(o,E(this._activeIndex)||this._activeIndex?0:1):this._hide_title(o);for(var u=0;u<2;u++)o[u].style[s]=l[u]+"px"}else a[r].innerHTML=this._settings.title(this._settings,this)}},_set_title_n:function(t,e,i,s,n,a){t.innerHTML=this._settings.title({value:e},this);var r=t.clientWidth/2,o=0;return this._settings.vertical?o=s-i-this._sliderHandleWidth/2-(a?this._sliderPadding:0)+2*this._sliderBorder:(o=i+this._sliderHandleWidth/2+2*this._sliderBorder-r,o=r>i?r-i+o:o,o=a&&r+i>s?o-r+(s-i):o),o},_set_value_now:function(){for(var t=0;t<2;t++)this._get_slider_handle(t).setAttribute("aria-valuenow",this._settings.value[t])},_mouse_down_process:function(t){var e=t.target,i=/webix_slider_handle_(\d)/.exec(e.className);this._activeIndex=i?parseInt(i[1],10):-1,i&&this._set_handle_active(this._activeIndex)},$compareValue:function(t,e){return e=this.$prepareValue(e),t[0]===e[0]&&t[1]===e[1]},$getValue:function(){var t=this._settings.value;return this._settings.stringResult?t.join(this._settings.separator):t},_set_handle_active:function(t){var e=this._get_slider_handle(t),i=this._get_slider_handle(1-t);-1==e.className.indexOf("webix_slider_active")&&(e.className+=" webix_slider_active"),i.className=i.className.replace(" webix_slider_active",""),e.focus()},_get_value_from_pos:function(t){var e=this._settings,i=e.value,s=e.max-e.min,n=e.vertical?"y":"x",a=kt(this._get_slider_handle().parentNode)[n],r=Math.ceil((t-a)*s/(e.vertical?this._content_height:this._get_input_width(e)));r=Math.round((r+1*e.min)/e.step)*e.step,e.vertical&&(r=s-r);var o=null,l=kt(this._get_slider_handle(0))[n],h=kt(this._get_slider_handle(1))[n];return l!=h||e.value[0]!=e.min&&e.value[0]!=e.max?this._activeIndex>=0?o=this._activeIndex:l==h?o=t<l?0:1:(o=Math.abs(l-t)<Math.abs(h-t)?0:1,this._activeIndex=o):(this._activeIndex=o=e.value[0]==e.min?1:0,this._set_handle_active(o)),i[o]=o?this._safeValue(r,i[0],e.max):this._safeValue(r,e.min,i[1]),i}},$r=(t.protoUI(Cr,kr.view),{name:"switch",defaults:{template:function(t,e){e._calck_switch_size();var i=t.name||"x"+T(),s="";t.labelRight&&(s="<label class='webix_label_right'>"+t.labelRight+"</label>",t.labelWidth&&(t.label=t.label||"&nbsp;"));var n=t.checkValue==t.value,a='aria-label="'+(t.label||t.labelRight||"")+'" role="checkbox" tabindex="0" aria-checked="'+(n?"true":"false")+'" '+(t.readonly?"aria-readonly='true'":"")+'"',r='<div class="webix_switch_box '+(n?" webix_switch_on":"")+'" style="width:'+e._switchWidth+'px"><span class="webix_switch_text">'+((n?t.onLabel:t.offLabel)||"")+'</span><button class="webix_switch_handle" '+a+' style="left:'+(n?e._switchWidth-e._switchHeight:0)+'px;"><input  id="'+i+'" class="webix_switch_toggle" type="checkbox" '+(n?"checked":"")+"></button></div>"+s;return e.$renderInput(t,r,i)}},$skin:function(){Za.api.$skin.call(this),this._switchHeight=vi.switchHeight,this._switchWidth=vi.switchWidth},$setValue:function(t){var e=this._settings,i=t==e.checkValue,s=this.$view.querySelector(".webix_switch_box");if(s){var n=s.childNodes[1],a=(i?e.onLabel:e.offLabel)||"";i?Dt(s,"webix_switch_on"):Et(s,"webix_switch_on"),n.style.left=(i?this._switchWidth-this._switchHeight:0)+"px",n.firstChild.checked=i,n.setAttribute("aria-checked",i?"true":"false"),a&&(s.childNodes[0].innerHTML=a)}},_calck_switch_size:function(){var t=this._settings;if(t.onLabel||t.offLabel){var e=t.onLabel?jt(t.onLabel,"webix_switch_text").width:0,i=t.onLabel?jt(t.offLabel,"webix_switch_text").width:0;this._switchWidth=Math.max(e,i)+this._switchHeight}},on_click:{webix_switch_box:function(){this._settings.readonly||this.toggle("user")},webix_label_right:function(){this._settings.readonly||this.toggle("user")}}}),Sr=(t.protoUI($r,Za.view),{name:"tabbar",$init:function(){this.attachEvent("onKeyPress",this._onKeyPress)},$skin:function(){var t=vi,e=this.defaults;e.topOffset=t.tabTopOffset||0,e.tabOffset=void 0!==t.tabOffset?t.tabOffset:10,e.bottomOffset=t.tabBottomOffset||0,e.height=t.tabbarHeight,e.tabMargin=t.tabMargin,e.inputPadding=t.inputPadding,e.tabMinWidth=t.tabMinWidth||100,e.tabMoreWidth=t.tabMoreWidth||40,e.borderless=!t.tabBorder},_getTabbarSizes:function(t){for(var e=this._settings,i=this._input_width-2*e.tabOffset,s=this._filterOptions(e.options),n=e.optionWidth||e.tabMinWidth,a=s.find((function(e){return e.id==t})).width||n,r=1,o=0;o<s.length;o++)if(s[o].id!=t){if((a+=s[o].width||n)>i)return{max:r};r++}return{width:i/s.length}},_init_popup:function(){var e=this,i=this._settings;if(!i.tabbarPopup||!ke(i.tabbarPopup)){var s=t.extend({view:"popup",autofocus:!1,width:200},i.tabbarPopup||{}),n=t.extend({view:"list",borderless:!0,select:!0,autoheight:!0,yCount:7,template:le("#value#")},i.tabbarPopup&&i.tabbarPopup.body||{},!0);n.css="webix_tab_list ".concat(n.css||""),s.body=n;var a=be(s),r=a.getBody();a.attachEvent("onShow",(function(){r.unselect(),ni.setFocus(r);var t=r.getItemNode(r.getFirstId());t&&t.focus()})),r.attachEvent("onItemClick",(function(t){return e._popupInnerClick(t)})),r.attachEvent("onEnter",(function(){return e._popupInnerClick()})),i.tabbarPopup=a._settings.id,this._destroy_with_me.push(a)}this._init_popup=function(){}},_popupInnerClick:function(t){var e=ke(this._settings.tabbarPopup);return(t=t||e.getBody().getSelectedId())&&this.callEvent("onBeforeTabClick",[t])&&(this.setValue(t,"user"),e.hide(),this.callEvent("onAfterTabClick",[t]),this.refresh(),this.focus()),!1},getPopup:function(){return this._init_popup(),ke(this._settings.tabbarPopup)},moreTemplate_setter:le,defaults:{moreTemplate:'<span class="webix_icon wxi-dots"></span>',template:function(t,e){e._check_options(t.options);var i,s,n,a,r,o,l,h=e._filterOptions(t.options);if(h.length){t.value||(t.value=e._getFirstActive(!0)),i="",t.tabOffset&&(i+="<div class='webix_tab_filler' style='width:"+t.tabOffset+"px;'>&nbsp;</div>"),e._input_width,t.tabOffset,t.type||(t.tabMargin,h.length),o=t.topOffset+t.bottomOffset;var c=e._getTabbarSizes(t.value);if(c.max&&c.max<h.length){var d=e.getPopup();d.hide();var u=d.getBody()||null;if(u)if(c.max){for(var _=0,p=!1;_<h.length&&!p;_++)if(h[_].id==t.value&&(p=!0,_+1>c.max)){var f=h.splice(_,1),g=h.splice(0,c.max-1).concat(f);h=g.concat(h)}u.clearAll(),u.parse(h.slice(c.max))}else u.clearAll()}else if(e._settings.tabbarPopup){var m=ke(e._settings.tabbarPopup);m&&m.hide()}r=t.tabOffset;for(var v=0,b=!1;v<h.length&&!b;v++)c&&c.max?(c.max==v+1&&(b=!0),l=(e._input_width-2*t.tabOffset-(!t.type&&c.max>1?t.tabMargin*(c.max-1):0)-t.tabMoreWidth)/c.max):l=c.width,r+=(l=h[v].width||t.optionWidth||l)+(v&&!t.type?t.tabMargin:0),t.tabMargin>0&&v&&!t.type&&(i+="<div class='webix_tab_filler' style='width:"+t.tabMargin+"px;'></div>"),i+=e._getTabHTML(h[v],l),b&&(i+='<div role="button" tabindex="0" aria-label="'+R.aria.showTabs+'" class="webix_tab_more_icon" style="width:'+t.tabMoreWidth+'px;">'+t.moreTemplate(t,e)+"</div>",r+=t.tabMoreWidth);(s=e._content_width-r)>0&&!t.type&&(i+="<div class='webix_tab_filler' style='width:"+s+"px;'>&nbsp;</div>")}else i="<div class='webix_tab_filler' style='width:"+e._input_width+"px; border-right:0px;'></div>";return n="",a=o&&!t.type?"height:"+(e._content_height-o)+"px":"",t.topOffset&&!t.type&&(n+="<div class='webix_before_all_tabs' style='width:100%;height:"+t.topOffset+"px'></div>"),n+="<div style='"+a+"' role='tablist' class='webix_all_tabs "+(t.type?"webixtype_"+t.type:"")+"'>"+i+"</div>",t.bottomOffset&&!t.type&&(n+="<div class='webix_after_all_tabs' style='width:100%;height:"+t.bottomOffset+"px'></div>"),n}},_getInputNode:function(){return this.$view.querySelectorAll(".webix_item_tab")},_getTabHTML:function(e,i){var s,n="",a="",r=!!e.disabled,o=this.config;if(e.id==o.value&&(n+=" webix_selected"),r&&(n+=" webix_disabled"),e.css&&(n+=" "+e.css),o.tooltip&&(a=" webix_t_id='"+e.id+"'"),i=e.width||i,s='<div class="webix_item_tab'+n+'" button_id="'+e.id+'" role="tab" aria-selected="'+(e.id==o.value?"true":"false")+'" tabindex="'+(r||e.id!=o.value?"-1":"0")+'" style="width:'+i+'px;"'+(r?' webix_disabled="true"':"")+a+">",this._tabTemplate){var l=this._content_height-2*o.inputPadding-2,h=this._content_height-2,c=t.extend({cheight:l,aheight:h},e);s+=this._tabTemplate(c)}else s+=(e.icon?"<span class='webix_icon "+e.icon+"'></span> ":"")+e.value;return r||!e.close&&!o.close||(s+="<span role='button' tabindex='0' aria-label='"+R.aria.closeTab+"' class='webix_tab_close webix_icon wxi-close'></span>"),s+"</div>"},_getBox:function(){return this._dataobj.firstChild},_types:{image:"<div class='webix_img_btn_top' style='height:#cheight#px;background-image:url(#image#);'><div class='webix_img_btn_text'>#value#</div></div>",icon:"<div class='webix_img_btn' style='line-height:#cheight#px;height:#cheight#px;'><span class='webix_icon_btn #icon#' style='max-width:#cheight#px;max-height:#cheight#px;'></span>#value#</div>",iconTop:"<div class='webix_img_btn_top' style='height:#cheight#px;width:100%;top:0px;text-align:center;'><span class='webix_icon #icon#'></span><div class='webix_img_btn_text'>#value#</div></div>"},type_setter:function(t){return this._settings.tabOffset=0,this._types[t]&&(this._tabTemplate=le(this._types[t])),t}}),Ir=(t.protoUI(Sr,cr.view),{name:"richtext",defaults:{label:"",labelWidth:80,labelPosition:"left"},$init:function(){this._viewobj.className+=" webix_richtext",this.$ready.unshift(this._setLayout)},$skin:function(){Gn.api.$skin.call(this),this.defaults.paddingX=vi.inputSpacing/2,this.defaults.paddingY=vi.inputPadding},getInputNode:function(){return this.$view.querySelector(".webix_richtext_editor")},_button:function(t){return{view:"toggle",type:"icon",icon:"wxi-"+t,name:t,id:t,label:R.richtext[t],autowidth:!0,action:t,click:this._add_data}},_setLayout:function(){var t=this,e={view:"template",css:"webix_richtext_container",borderless:!0,template:"<div class='webix_richtext_editor' contenteditable='true'>"+this.getValue()+"</div>",on:{onAfterRender:function(){t._rendered_input=!0,t.refresh(),_e(t.getInputNode(),"blur",(function(){t._updateValue(this.innerHTML,"user")})),_e(t.getInputNode(),"keyup",(function(){t._getselection("auto")}))}},onClick:{webix_richtext_editor:function(){t._getselection("auto")}}},i=[this._button("underline"),this._button("bold"),this._button("italic"),{}],s={view:"toolbar",id:"toolbar",elements:i},n=[s,e],a=this.config;"top"==a.labelPosition?(s.elements=i.concat([{view:"label",label:a.label,align:"right"},{width:4}]),this.rows_setter(n)):(a.labelWidth=a.label?this._getLabelWidth(a.labelWidth,a.label,a.required):0,a.labelWidth?(a.margin=0,this.cols_setter([{template:a.label,css:"webix_richtext_inp_label"+(a.required?" webix_required":""),borderless:!0,width:a.labelWidth},{rows:n}])):this.rows_setter(n))},_getLabelWidth:function(t,e,i){return"auto"==t&&(t=jt(e,"webix_inp_label"+(i?" webix_required":"")).width),t?Math.max(t,vi.dataPadding):0},_getselection:function(t){var e,i=this;i.$$("toolbar").setValues({italic:!1,underline:!1,bold:!1},!1,t),e=window.getSelection?window.getSelection():document.selection.createRange();for(var s=0;s<e.rangeCount;++s)i.$view.contains(this.getInputNode())&&(document.queryCommandState("bold")&&i.$$("bold").setValue(!0,t),document.queryCommandState("underline")&&i.$$("underline").setValue(!0,t),document.queryCommandState("italic")&&i.$$("italic").setValue(!0,t))},refresh:function(){this._rendered_input&&(this.getInputNode().innerHTML=this._settings.value)},_execCommandOnElement:function(t){var e,i;i=(e=window.getSelection()).toString().length;var s=this.getInputNode();if(s.contains(e.anchorNode)&&s.contains(e.focusNode)&&i>0)for(var n=0;n<e.rangeCount;++n){var a=e.getRangeAt(n);if(e.isCollapsed){var r=e.focusNode.textContent,o=e.focusNode,l=e.anchorOffset,h=r.substring(0,l).match(/[A-Za-z]*$/)[0],c=r.substring(l).match(/^[A-Za-z]*/)[0],d=l-h.length,u=l+c.length;a.setStart(o,d),a.setEnd(o,u),e.removeAllRanges(),e.addRange(a),document.execCommand(t,!1,"")}else document.execCommand(t,!1,"")}},_add_data:function(){this.getTopParentView()._execCommandOnElement(this.config.action)},focus:function(){if(!ni.canFocus(this))return!1;this.getInputNode().focus()},_updateValue:function(t,e){t=this.$prepareValue(t);var i=this._settings.value;i!=t&&(this._settings.value=t,this.callEvent("onChange",[t,i,e]))},setValue:function(t,e){this._updateValue(t,e),this.refresh()},$prepareValue:function(t){return 0===t?"0":(t||"").toString()},value_setter:function(t){return this.$prepareValue(t)},getValue:function(){var t=this.getInputNode();return t?t.innerHTML:this._settings.value}});t.protoUI(Ir,cs,Gn.view),ge(br.view,{name:"uploader",template:"{common.removeIcon()}{common.percent()}<div style='float:right'>#sizetext#</div>{common.fileName()}",percent:function(t){return"transfer"==t.status?"<div style='width:60px; text-align:center; float:right'>"+t.percent+"%</div>":"<div class='webix_upload_"+t.status+"'><span class='"+("error"==t.status?"webix_error_icon":"webix_icon wxi-check")+"'></span></div>"},removeIcon:function(){return"<div class='webix_remove_upload'><span class='webix_cancel_icon'></span></div>"},fileName:function(t){return"<div style='text-overflow:ellipsis; white-space:nowrap; overflow:hidden; padding-right:8px;'>"+t.name+"</div>"},on_click:{webix_remove_upload:function(t,e){ke(this.config.uploader).files.remove(e)}}});var Ar={name:"uploader",defaults:{autosend:!0,multiple:!0,inputName:"upload"},$cssName:"button webix_uploader",$allowsClear:!0,on_click:{webix_hidden_upload:function(){return!1}},send:function(){},fileDialog:function(){},stopUpload:function(){},$skin:function(){Ha.api.$skin.call(this),"material"!=bi&&"mini"!=bi||(this.defaults.css="webix_primary")},$init:function(){this.files=new Ka,this._destroy_with_me=[this.files],t.extend(this,Ks,!0)},$setSize:function(t,e){mi.api.$setSize.call(this,t,e)&&this.render()},apiOnly_setter:function(t){return j(this.render,this),this.$apiOnly=t},_add_files:function(t){for(var e=0;e<t.length;e++)this.addFile(t[e])},link_setter:function(t){return t&&j((function(){var t=ke(this._settings.link);if(!t){var e=this.getTopParentView();e.$$&&(t=e.$$(this._settings.link))}t.sync&&t.filter?t.sync(this.files):t.setValues&&this.files.data.attachEvent("onStoreUpdated",(function(){t.setValues(this,!1,"auto")})),t._settings.uploader=this._settings.id}),this),t},addFile:function(i,s,n,a){var r=null;"object"==e(i)&&(i=(r=i).name,s=r.size);var o=this._format_size(s);n=n||i.split(".").pop();var l={file:r,name:i,id:T(),size:s,sizetext:o,type:n,context:this._last_file_context,status:"client"};if(r&&r.webkitRelativePath&&(l.name=r.webkitRelativePath),a&&t.extend(l,a,!0),this.callEvent("onBeforeFileAdd",[l])){this._settings.multiple||this.files.clearAll();var h=this.files.add(l);this.callEvent("onAfterFileAdd",[l]),h&&this._settings.autosend&&this.send(h)}return l},_get_active_url:function(e){var i=this._settings.upload,s=t.extend(e.urlData||{},this._settings.urlData||{});if(i&&s){var n=[];for(var a in s)n.push(encodeURIComponent(a)+"="+encodeURIComponent(s[a]));n.length&&(i+=(-1==i.indexOf("?")?"?":"&")+n.join("&"))}return i},addDropZone:function(t,e){var i=F(t),s="";e&&(s=" "+ft({content:'"'+e+'"'},":before"));var n="webix_drop_file"+s,a=null;_e(i,"dragover",St),_e(i,"dragover",(function(){Dt(i,n,!0),a&&(clearTimeout(a),a=null)})),_e(i,"dragleave",(function(){a=setTimeout((function(){Et(i,n)}),150)})),_e(i,"drop",A((function(t){return Et(i,n),this.$drop(t),St(t)}),this))},_format_size:function(t){for(var e=0;t>1024;)e++,t/=1024;return Math.round(100*t)/100+" "+R.fileSize[e]},_complete:function(e,i){var s=this.files.getItem(e);t.extend(s,i,!0),s.status="server",s.progress=100,this.callEvent("onFileUpload",[s,i]),this.callEvent("onChange",[]),this.files.updateItem(e),this.isUploaded()&&this._upload_complete(i)},_upload_complete:function(t){this.callEvent("onUploadComplete",[t]),this._last_assigned_upload_callback&&(this._last_assigned_upload_callback.call(this,t),this._last_assigned_upload_callback=0)},isUploaded:function(){for(var t=this.files.data.order,e=0;e<t.length;e++)if("server"!=this.files.getItem(t[e]).status)return!1;return!0},$onUploadComplete:function(){},$updateProgress:function(t,e){this.files.getItem(t).percent=Math.round(e),this.files.updateItem(t)},setValue:function(t){"string"==typeof t&&t&&(t={value:t,status:"server"}),this.files.clearAll(),t&&this.files.parse(t),this.callEvent("onChange",[])},getValue:function(){var t=[];return this.files.data.each((function(e){"server"==e.status&&t.push(e.value||e.name)})),t.join(",")}},Dr=(t.protoUI(Ar,Ha.view),{name:"texthighlight",defaults:{template:function(t,e){var i=t.name||t.id,s="x"+T(),n=e._get_input_width(t),a='<div class="webix_text_highlight" style="width:'.concat(n,'px;"><div class="webix_text_highlight_value"');return"textarea"==t.type&&Ot.isIOS&&(a+=' style="margin-left:'.concat(vi.dataPadding+3,"px; margin-right:").concat(vi.dataPadding+3,'px;"')),a+="></div></div>","textarea"==t.type?(a+="".concat(e._baseInputHTML("textarea"),' style="width:').concat(n,'px;" id="').concat(s,'" name="').concat(i,'" class="webix_inp_textarea">').concat(e._pattern(t.value),"</textarea>"),e.$renderInput(t,a,s)):a+e.$renderInput(t)},highlight:function(t){return le.escape(t)},type:"text"},$init:function(t){var e=this,i=t.type||this.defaults.type;this._viewobj.className+=" webix_el_"+i,"textarea"==i?(delete t.clear,t.height=t.height||0,t.minHeight=t.minHeight||60,this._skipSubmit=!0):(this.scrollEv=pe(document,"selectionchange",(function(){e.$view.contains(document.getSelection().focusNode)&&e._syncText()})),this.attachEvent("onDestruct",(function(){fe(e.scrollEv)}))),this.attachEvent("onChange",(function(){return e._syncText()})),this.attachEvent("onAfterRender",(function(){e._updatePos(),["scroll","focus","blur","paste","cut","keyup","input"].forEach((function(t){return _e(e.getInputNode(),t,(function(){return e._syncText()}))})),e._handleInput(!0)}))},$setSize:function(){Ga.api.$setSize.apply(this,arguments),this._updatePos()},$renderIcon:function(t){return"text"==t.type?Ga.api.$renderIcon.apply(this,arguments):""},_getLabelHeight:function(t){return"textarea"==this._settings.type?t?this._labelTopHeight-this._settings.inputPadding:"":Ga.api._getLabelHeight.apply(this,arguments)},getInputNode:function(){return this._dataobj.querySelector("text"==this._settings.type?"input":"textarea")},_getHighlightNode:function(){return this._dataobj.querySelector(".webix_text_highlight")},_handleInput:function(t){var e=this._getHighlightNode().firstElementChild,i=this.getValue();(t||i!=(this._lastText||""))&&(this._lastText=i,e.innerHTML=this._settings.highlight.apply(this,[i])+"&nbsp;")},_handleScroll:function(){var t=this._getHighlightNode();"text"==this._settings.type&&(t=t.firstElementChild);var e=this.getInputNode();t.scrollTop=e.scrollTop,t.scrollLeft=e.scrollLeft},_updatePos:function(){if(this._rendered_input&&this.isVisible()){var t=this.getInputNode(),e=this._getHighlightNode().style;e.left=t.offsetLeft+"px",e.top=t.offsetTop+"px",e.height=t.getBoundingClientRect().height+"px"}},_syncText:function(){j((function(){this.$destructed||(this._handleInput(),this._handleScroll())}),this)}}),Er=(t.protoUI(Dr,_r.autoheight,Ga.view),{name:"timeboard",defaults:{width:260,hours:!0,seconds:!1,twelve:/%([a,A])/.test(R.timeFormat)},$skin:function(){Gn.api.$skin.call(this),this.defaults.margin=vi.layoutMargin.form,this.defaults.padding=vi.layoutPadding.space},$init:function(t){var e=this;this.$view.className+=" webix_timeboard";var i=[],n=E(t.twelve)?this.defaults.twelve:t.twelve,a=E(t.hours)?this.defaults.hours:t.hours,r=t.seconds||this.defaults.seconds;if(E(t.height)){var o=1+1*a+1+1*r+1*!!t.button;t.height=vi.inputHeight*o+(t.margin||this.defaults.margin)*(o-1)+2*(t.padding||this.defaults.padding)}i.push(this._getClock(a,r,n)),i.push.apply(i,s(this._getSliders(a,r,n))),t.button&&i.push(this._getDoneButton()),t.rows=[{view:"form",elements:i,padding:0,borderless:!0,on:{onChange:function(t,i,s){return e._recollectValues(s)}}}],this.$ready.push((function(){this._form=this.queryView("form");var t=this._settings.value;t&&this.setValue(t,"auto")}))},setValue:function(t,e){t=this.$prepareValue(t);var i=this._settings.value;$n.equal(t,i)||(this._settings.value=t,this.$setValue(t),this.callEvent("onChange",[t,i,e]))},$prepareValue:function(t){return"string"==typeof t&&(t=R.parseTimeFormatDate(t)),t||$n.datePart(new Date)},$setValue:function(t){var e={};e.minutes=e.sminutes=t.getMinutes(),this._settings.hours&&(e.shours=e.hours=t.getHours()),this._settings.seconds&&(e.sseconds=e.seconds=t.getSeconds()),this._settings.twelve&&(E(e.hours)||(e.day_part=e.hours>11?R.pm[1]:R.am[1],e.hours=e.hours&&12!=e.hours?e.hours%12:12,e.shours=12==e.hours?0:e.hours)),this._form.setValues(e,!1,"auto")},_recollectValues:function(t){var e=this.$getValue(),i=this._settings.value?$n.copy(this._settings.value):new Date;i.setHours(e.hours||0),i.setMinutes(e.minutes),this._settings.seconds&&i.setSeconds(e.seconds),this.setValue(i,t)},$getValue:function(){var t=this._form.getValues();return this._settings.twelve&&this._settings.hours&&(t.day_part==R.pm[1]&&t.hours<12?t.hours=(1*t.hours+12).toString():t.day_part==R.am[1]&&12==t.hours&&(t.hours=0)),t},getValue:function(){if(this._settings.stringResult){var t=this.$getValue(),e=[];return t.hours&&e.push(t.hours),t.minutes&&e.push(t.minutes),t.seconds&&e.push(t.seconds),e.join(":")}return this._settings.value},_getClock:function(t,e,i){var s=[{},this._getText("minutes"),{}],n={css:"webix_colon_template",template:":",borderless:!0,width:16};if(t&&s.splice(1,0,this._getText("hours",i),I(n)),e&&s.splice(-1,0,I(n),this._getText("seconds")),i&&t){var a=R.am[1],r=R.pm[1],o={view:"label",name:"day_part",css:"webix_day_part",template:"<div tabindex='0' role='button' class='webix_el_box' style='width:#awidth#px;height:#aheight#px;line-height:#cheight#px'>#label#</div>",inputWidth:30,on:{onItemClick:function(){this.setValue(this.getValue()==a?r:a,"user")},onKeyPress:function(t,e){this._onKeyPress(t,e)}}};s.splice(-1,1,o)}return{type:"clean",cols:s}},_getText:function(t,e){var i=this,s="hours"===t?e?11:23:59;return{view:"text",width:jt("00").width+2*vi.dataPadding+2*vi.inputPadding,name:t,format:{parse:function(i){return 12==i&&"hours"===t&&e&&(i="00"),i.length>1?i.replace(/^0/,""):i||0},edit:function(i){return i<=0&&"hours"===t&&e?i=12:i<0?i=0:i>s&&(i=s),1===(i+"").length?"0"+i:i+""||"00"}},on:{onChange:function(s){var n=1*(!e||"hours"!==t||s&&12!=s?s:0);i._form.elements["s"+t].setValue(n,"auto")}}}},_getSliders:function(t,e,i){var s=[this._getSlider("minutes",R.calendar.minutes,59)];return t&&s.unshift(this._getSlider("hours",R.calendar.hours,i?11:23)),e&&s.push(this._getSlider("seconds",R.timeboard.seconds,59,i)),s},_getSlider:function(t,e,i,s){var n=this,a="hours"===t&&s;return{view:"slider",name:"s"+t,title:e,moveTitle:!1,min:0,max:i,on:{onChange:function(e){n._form.elements[t].setValue((a?e&&12!=e?e%12:12:e)+"","auto")},onSliderDrag:function(){var e=this.getValue(),i=this.getFormView();i.blockEvent(),i.elements[t].setValue((a?e&&12!=e?e%12:12:e)+"","auto"),i.unblockEvent()}}}},_getDoneButton:function(){var t=this;return{view:"button",value:R.calendar.done,css:"webix_primary",click:function(){t.callEvent("onTimeSelect",[t._settings.value])}}}}),jr=(t.protoUI(Er,Gn.view),{name:"suggest",defaults:{autofocus:!1,type:"list",keyPressTimeout:1,body:{yCount:10,autoheight:!0,body:!0,select:!0,borderless:!0,navigation:!0},filter:function(t,e){return 0===t.value.toString().toLowerCase().indexOf(e.toLowerCase())}},template_setter:le,filter_setter:function(t){return P(t,this.$scope)},_show_on_key_press:!0,$init:function(e){var i={};t.extend(i,I(this.defaults.body)),i.view=e.type||this.defaults.type;var s=this._get_extendable_cell(i);e.body&&t.extend(s,e.body,!0),e.data&&(s.data=e.data),e.url&&(s.url=e.url),e.datatype&&(s.datatype=e.datatype),e.id&&(i.id=i.id||e.id+"_"+i.view),e.body=i,this.$ready.push(this._set_on_popup_click),this.attachEvent("onShow",(function(){if(this._settings.master){var t=ke(this._settings.master);t&&(t._getInputDiv?t._getInputDiv():t.getInputNode()).setAttribute("aria-expanded","true"),this._show_selection()}})),this.attachEvent("onHide",(function(){if(this._settings.master){var t=ke(this._settings.master);t&&(t._getInputDiv?t._getInputDiv():t.getInputNode()).setAttribute("aria-expanded","false")}})),this._old_text={}},_get_extendable_cell:function(t){return t},_get_details:function(t){return E(t)?null:{config:t}},_set_input_value:function(t){var e=this._last_input_target;"true"==e.getAttribute("contentEditable")||""==e.getAttribute("contentEditable")?e.innerText=t:e.value=t},_preselectMasterOption:function(t){var e,i=t.id?this.getItemText(t.id):t.text||t.value;if(this._settings.master){var s=ke(this._settings.master);if(e=s.getInputNode()){var n=s._settings.text;s.options_setter?s.$setValue(t.$empty?"":t.id):s.$setValueHere?s.$setValueHere(i,t,this._get_details()):s.$setValue(i),s._settings.text=n}}else this._last_input_target&&this._set_input_value(i);(e=e||this._last_input_target)&&e.focus()},setMasterValue:function(t,e,i){var s=t.id?this.getItemText(t.id):t.text||t.value;if(this._settings.master){var n=ke(this._settings.master);e&&t.id?n.refresh():n.options_setter?n.setValue(t.$empty?"":t.id,i):n.setValueHere?n.setValueHere(s,t,this._get_details(i)):n.setValue(s,i)}else this._last_input_target&&this._set_input_value(s);e||(this.hide(),this._last_input_target&&this._last_input_target.focus()),this.callEvent("onValueSuggest",[t,s])},getMasterValue:function(){return this._settings.master?ke(this._settings.master).getValue():null},getItemId:function(t){var e=this.getList();for(var i in e.data.pull){var s=e.getItem(i);if(this._settings.filter.call(this,s,t))return s.id}},getItemText:function(t){var e=this.getList().getItem(t);if(!e)return this._old_text[t]||"";if(this._settings.template)return this._settings.template.call(this,e,this.type);if(this._settings.textValue)return""+e[this._settings.textValue];var i=this.getList().type,s=i.template.call(i,e,i);return this._old_text[t]=s},getSuggestion:function(t){var i,s=this.getList(),n=s.data.order;return s.getSelectedId&&(i=s.getSelectedId()),t&&n.length&&(!i||n.find(i)<0)&&(i=n[0],!s.config.dataFeed&&!this.config.filter.call(this,s.data.pull[i],t))||i&&("object"==e(i)&&(i+=""),s.getItem(i).$empty)?null:i},getList:function(){return this._body_cell},_set_on_popup_click:function(){var t=this.getList(),e=this._settings.type;t.count?(t.attachEvent("onItemClick",A((function(e){this.setMasterValue(t.getItem(e),!1,"user")}),this)),t.data.attachEvent("onStoreUpdated",A((function(t,e,i){"delete"==i&&t==this.getMasterValue()?this.setMasterValue({id:"",text:""},!0,"auto"):"update"==i&&t==this.getMasterValue()&&this.setMasterValue(e,!0,"auto")}),this)),t.data.attachEvent("onAfterFilter",A(this._suggest_after_filter,this)),t.data.attachEvent("onStoreLoad",A(this._suggest_after_filter,this)),E(this._settings.fitMaster)&&(this._settings.fitMaster=!0)):"calendar"==e?(t.attachEvent("onAfterDateSelect",(function(){this.getParentView().setMasterValue({value:t.getSelectedDate()},t.config.multiselect,"user")})),t.attachEvent("onTodaySet",(function(t){this.getParentView().setMasterValue({value:t},!1,"user")})),t.attachEvent("onDateClear",(function(t){this.getParentView().setMasterValue({value:t},!1,"user")}))):"colorboard"==e?t.attachEvent("onItemClick",(function(t){this.getParentView().setMasterValue({value:t},!1,"user")})):"timeboard"==e?t.attachEvent("onTimeSelect",(function(t){this.getParentView().setMasterValue({value:t},!1,"user")})):"colorselect"==e&&t.attachEvent("onColorSelect",(function(t){this.getParentView().setMasterValue({value:t},!1,"user")}))},input_setter:function(t){return this.linkInput(t),0},linkInput:function(t){var e;t.getInputNode?((e=t.getInputNode()).webix_master_id=t._settings.id,t.attachEvent("onInputResize",A(this._resetPosition,this))):e=F(t),_e(e,"keydown",(function(i){e==document.body&&!this.isVisible()||(t.config?t.config.readonly:e.getAttribute("readonly"))||this._suggestions(i,e)}),{bind:this}),t._getInputDiv&&(e=t._getInputDiv()),e.setAttribute("aria-autocomplete","list"),e.setAttribute("aria-expanded","false"),"DIV"===e.tagName&&(e.setAttribute("aria-live","assertive"),e.setAttribute("aria-atomic","true")),this._non_ui_mode=!0},_suggestions:function(t,e){this._last_delay&&(this._last_delay=clearTimeout(this._last_delay));var s=this.getList(),n=t.target;if((n!=document.body||this.isVisible())&&"webix_clipbuffer"!=n.className){this._settings.master=n.webix_master_id,e!=document.body&&(this._last_input_target=n);var a=t.which||t.keyCode;if(16!=a&&17!=a&&18!=a&&91!=a&&!(a>32&&a<40&&38!=a)){var r=t.ctrlKey||t.metaKey,o=[8,46,86,88,89,90].map((function(t){return a==t})),l=i(o,6),h=l[0],c=l[1],d=l[2],u=l[3],_=l[4],p=l[5];if(!r||h||c||d||u||_||p){if(h||c||r&&u){var f=n.selectionStart,g=n.selectionEnd;if(h&&0==f||u&&f==g||c&&f==(n.value||n.innerText).length)return}if(9==a)return this._tab_key(t,s);if(27==a)return this._escape_key(t,s);if(13==a)return this.$enterKey(t,s);if(this._navigate(t)&&this.isVisible())return St(t),!1;var m="true"==n.getAttribute("contentEditable")||""==n.getAttribute("contentEditable");E(n.value)&&!m||(this._last_delay=j((function(){if(this._non_ui_mode||ni.getFocus()==ke(this._settings.master)){this._resolve_popup=!0;var t=m?n.innerText:n.value;this._before_filtering&&this._before_filtering(),s.config.dataFeed?s.filter("value",t):s.filter&&s.filter(A((function(e){return this._settings.filter.call(this,e,t)}),this))}}),this,[],this._settings.keyPressTimeout))}}}},_suggest_after_filter:function(){if(!this._resolve_popup)return!0;this._resolve_popup=!1,this.getList().count()>0?(this.adjust(),this.isVisible()||(this._dont_unfilter=!0),this.show(this._last_input_target,null,!0),this._dont_unfilter=!1):this._last_input_target&&(this.hide(),this._last_input_target=null)},show:function(t){var e=!t||"INPUT"!=t.tagName&&"TEXTAREA"!=t.tagName?null:t;if(!this.isVisible()||e&&e!=this._last_input_target){var i=this.getList();i.filter&&!this._dont_unfilter&&(i.eachColumn&&i.eachColumn((function(t){var e=i.getFilter(t);e&&(e.setValue?e.setValue(""):e.value="")})),i.filter("")),this.$customWidth?this.$customWidth(t):t&&t.tagName&&this._settings.fitMaster&&(this._settings.width=t.offsetWidth-2),i._zoom_level&&i.render(),this.adjust(),e&&(this._last_input_target=e)}Ca.api.show.apply(this,arguments)},_show_selection:function(){var t=this.getList(),e=this.getMasterValue();t.select&&t.showItem?e&&t.exists&&t.exists(e)?(t.select(e),t.showItem(e)):(t.unselect(),t.showItem(t.getFirstId())):t.setValue&&(this._settings.master&&(e=ke(this._settings.master).$prepareValue(e)),t.setValue(e,"auto"))},$enterKey:function(t,e){var i,s,n=this.isVisible();this._settings.master&&(s=ke(this._settings.master)),s&&s._editable&&s._settings.editable?s._applyChanges("user"):n&&(e.count?(i=e.getSelectedId(!1,!0),1==e.count()&&e.getFirstId()!=i&&(i=e.getFirstId()),i&&(i=e.getItem(i))):(e.getSelectedDate?i=e.getSelectedDate():e.getValue&&(i=e.getValue()),i&&(i={value:i})),i&&this.setMasterValue(i,!1,"user")),n?this.hide():this._show_on_key_press&&this.show(this._last_input_target)},_escape_key:function(){return this.hide()},_tab_key:function(){return this.hide()},_navigate:function(t){var e,i=this.getList(),s=t.which||t.keyCode;if(i.moveSelection&&s<41&&s>32&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey){if(40===s||38===s){this._show_on_key_press&&!this.isVisible()&&this.show(this._last_input_target);var n=38===s?"up":"down";i.moveSelection(n,!1,!1)}else{if(i.count||!i.count&&!i.isVisible())return!1;var a;33==s&&(a="pgup"),34==s&&(a="pgdown"),35==s&&(a="bottom"),36==s&&(a="top"),37==s&&(a="left"),39==s&&(a="right"),i.moveSelection(a,!1,!1)}return i.count?e=i.getSelectedItem(!1):(i.getSelectedDate?e=i.getSelectedDate():i.getValue&&(e=i.getValue()),e&&(e={value:e})),e&&this.isVisible()&&this._preselectMasterOption(e),!0}return!1},getValue:function(){var t=this.getList(),e=(t.getValue?t.getValue():t.getSelectedId())||"";if(e=e.id||e,t.getItem){var i=t.getItem(e);if(i&&i.$empty)return""}return e},setValue:function(t){var e=this.getList();t?e.exists(t)&&(e.select(t),e.showItem(t)):(e.unselect(),e.showItem(e.getFirstId()))},_resetPosition:function(){if(!this._settings.hidden&&this._settings.master){var t=ke(this._settings.master);t&&this.show(t.$view)}}}),Vr={api:jr,view:t.protoUI(jr,Ca.view)},Nr={name:"multisuggest",defaults:{separator:",",type:"layout",button:!0,width:0,filter:function(t,e){return this.getItemText(t.id).toString().toLowerCase().indexOf(e.toLowerCase())>-1},body:{rows:[{view:"list",type:"multilist",borderless:!0,autoheight:!0,yCount:5,multiselect:"touch",select:!0,on:{onItemClick:function(t){var e=this.getParentView().getParentView();j((function(){e._toggleOption(t)}))}}},{view:"button",click:function(){this.getParentView().getParentView().hide(),j((function(){U("onEditEnd",[])}))}}]}},_toggleOption:function(t,e,i){var s=this.getValue(),n=i||O(s?this.getValue().split(this._settings.separator):[]),a=ke(this._settings.master);i||(n.find(t)<0?n.push(t):n.remove(t));var r=n.join(this._settings.separator),o=this.setValue(n).join(this._settings.separator);if(a?a.setValue(r,"user"):this._last_input_target&&(this._last_input_target.value=o),this.callEvent("onValueSuggest",[{id:r,text:o}]),e){var l=this.getList().getItemNode(t).getElementsByTagName("SPAN");l&&l.length&&l[0].focus()}},_get_extendable_cell:function(t){return t.rows[0]},_set_on_popup_click:function(){var t=this.getButton(),e=this._settings.button?this._settings.buttonText||R.combo.select:0;if(t&&(e?(t._settings.value=e,t.refresh()):t.hide()),this._settings.selectAll)return this.getBody().getChildViews()[0].show();var i=this.getList();i.data.attachEvent("onAfterFilter",A((function(){return this._suggest_after_filter()}),this)),i.data.attachEvent("onStoreLoad",A((function(){return this._suggest_after_filter()}),this))},_show_selection:function(){var t=this.getList(),e=this.getMasterValue();if(e&&(e=e.toString().split(this.config.separator))[0])for(var i=0;i<e.length;i++)t.exists(e[i])&&t.select(e[i],!0)},getButton:function(){return this.getBody().getChildViews()[1]},getList:function(){return this.getBody().getChildViews()[0]},setValue:function(t){var e=[],i=this.getList();if(i.unselect(),t&&(B(t)||(t=t.toString().split(this.config.separator)),t[0]))for(var s=0;s<t.length;s++)i.exists(t[s])&&(i.select(t[s],!0),e.push(this.getItemText(t[s])));return this._settings.value=t?t.join(this.config.separator):"",e},getValue:function(){return this._settings.value}},Tr={api:Nr,view:t.protoUI(Nr,Vr.view)},Fr={name:"checksuggest",defaults:{button:!1,selectAll:!1,body:{rows:[{view:"checkbox",hidden:!0,customCheckbox:!1,borderless:!1,css:"webix_checksuggest_select_all",labelRight:R.combo.selectAll,labelWidth:0,height:28,inputHeight:20,on:{onItemClick:function(t){for(var e=this.getParentView().getParentView(),i=e.getList(),s=i.data.order,n=0;n<s.length;n++)i.getItem(s[n]).$checked=this.getValue();var a=this.getValue()?[].concat(s):[];e._toggleOption(s[0],t,a),i.refresh()},onChange:function(){var t=this.$view.querySelector("label"),e=R.combo;t.textContent=this.getValue()?e.unselectAll:e.selectAll},onAfterRender:function(){var t=this.getParentView().getParentView();this.setValue(1*t._is_all_selected())}}},{view:"list",css:"webix_multilist",borderless:!0,autoheight:!0,yCount:5,type:"checklist",on:{onItemClick:function(t,e){var i=this.getItem(t);i.$checked=i.$checked?0:1,this.refresh(t);var s=this.getParentView().getParentView();s._click_stamp=new Date,s._toggleOption(t,e),s.config.selectAll&&(i.$checked?s._is_all_selected()&&s.getBody()._cells[0].setValue(1,"auto"):s.getBody()._cells[0].setValue(0,"auto"))}}},{view:"button",click:function(){this.getParentView().getParentView().hide(),j((function(){U("onEditEnd",[])}))}}]}},_is_all_selected:function(){var t=this.getValue();return(t?t.split(this.config.separator):[]).length===this.getList().count()},_get_extendable_cell:function(t){return t.rows[1]},getButton:function(){return this.getBody().getChildViews()[2]},getList:function(){return this.getBody().getChildViews()[1]},$init:function(){this._valueHistory={},this._editor_initialized=!0,this.$ready.push(this._onReady)},_onReady:function(){var t=this.getList();if(t.config.dataFeed){var e=this;t.attachEvent("onAfterLoad",(function(){e.setValue(e._settings.value,"auto")})),t.getItem=function(t){return this.data.pull[t]||e._valueHistory[t]}}this.config.master&&!this.config.selectAll&&this.getBody().getChildViews()[0].hide()},$enterKey:function(t,e){if(e.count&&e.count())if(this.isVisible()){var i=e.getSelectedId(!1,!0);i&&this._toggleOption(i),this.hide()}else this.show(this._last_input_target);else this.isVisible()&&this.hide()},_show_selection:function(){var t=this.getList();t.select&&t.unselect()},setValue:function(t){var e,i=this.getList(),s=[],n={},a=[];for(B(t=t||[])?i.config.dataFeed&&(t=this._toMultiValue(t)):t=t.toString().split(this.config.separator),e=0;e<t.length;e++)n[t[e]]=1,i.getItem(t[e])&&(this._valueHistory&&(this._valueHistory[t[e]]=I(i.getItem(t[e]))),s.push(this.getItemText(t[e])));for(i.data.each((function(t){t.$checked?n[t.id]||(t.$checked=0,a.push(t.id)):n[t.id]&&(t.$checked=1,a.push(t.id))}),this,!0),e=0;e<a.length;e++)i.refresh(a[e]);return this._settings.value=t.length?t.join(this.config.separator):"",s},getValue:function(){return this._settings.value},_preselectMasterOption:function(){var t;this._settings.master&&(t=ke(this._settings.master).getInputNode()),(t=t||this._last_input_target)&&t.focus()},_toMultiValue:function(t){if(t&&B(t)){for(var e=[],i=0;i<t.length;i++)t[i].id?(this._valueHistory[t[i].id]=I(t[i]),e.push(t[i].id)):e.push(t[i]);t=e}return t}},Pr=(t.protoUI(Fr,Tr.view),{name:"datasuggest",defaults:{type:"dataview",fitMaster:!1,width:0,body:{xCount:3,autoheight:!0,select:!0}}}),Br=(t.protoUI(Pr,Vr.view),{name:"gridsuggest",defaults:{type:"datatable",fitMaster:!1,width:0,body:{navigation:!0,autoheight:!0,autowidth:!0,select:!0},filter:function(t,e){return 0===this.config.template(t).toString().toLowerCase().indexOf(e.toLowerCase())}},$init:function(t){t.body.columns||(t.body.autoConfig=!0),t.template||(t.template=A(this._getText,this))},_getText:function(t){var e=this.getBody(),i=this.config.textValue||e.config.columns[0].id;return e.getText(t.id,i)}}),Mr=(t.protoUI(Br,Vr.view),{name:"mentionsuggest",defaults:{symbol:"@",filter:function(t,e){var i=this._settings.symbol;return-1!==(e=e.substring(0,this._last_cursor_pos)).indexOf(i)&&!!(e=e.substring(e.lastIndexOf(i)+i.length)).length&&-1!==(t.id?this.getItemText(t.id):t.text||t.value).toString().toLowerCase().indexOf(e.toLowerCase())}},$init:function(){this.attachEvent("onValueSuggest",this._before_filtering)},$enterKey:function(t){var e;return this.isVisible()&&(St(t),this._settings.master&&(e=ke(this._settings.master)),e&&e.callEvent&&e.callEvent("onEnter")),Vr.api.$enterKey.apply(this,arguments)},_before_filtering:function(){this._last_input_target&&(this._last_cursor_pos=Ft(this._last_input_target).start)},_get_details:function(t){return{pos:this._last_cursor_pos,symbol:this._settings.symbol,config:t}},_preselectMasterOption:function(){},_set_input_value:function(t){var e=this._settings.symbol,i=this._last_input_target.value,s=i.substring(this._last_cursor_pos);i=(i=i.substring(0,this._last_cursor_pos)).substring(0,i.lastIndexOf(e)+e.length)+t,this._last_input_target.value=i+s,Tt(this._last_input_target,i.length)},_show_on_key_press:!1}),Or=(t.protoUI(Mr,Vr.view),{name:"daterangesuggest",defaults:{type:"daterange",body:{view:"daterange",icons:!0,button:!0,borderless:!0}},getValue:function(){return this.getRange().getValue()},setValue:function(t,e){this.getRange().setValue(I(t),e)},getRange:function(){return this.getBody()},getButton:function(){return this.getBody().getChildViews()[1].getChildViews()[1]},_setValue:function(t){var e=ke(this._settings.master);e&&e.setValue(t,"user")},_set_on_popup_click:function(){var t=this.getRange();t.attachEvent("onAfterDateSelect",A((function(t){this._setValue(t)}),this)),t.attachEvent("onDateClear",A((function(t){this._setValue(t)}),this)),t.attachEvent("onTodaySet",A((function(t){this._setValue(t)}),this))}}),Lr=(t.protoUI(Or,Vr.view),{$cssName:"datepicker",name:"daterangepicker",$init:function(t){delete t.type,delete t.multiselect,delete this._settings.multiselect},defaults:{value:{},separator:" - "},_init_popup:function(){var t=this._settings;t.suggest?t.popup=t.suggest:t.popup||(t.popup=t.suggest=this.suggest_setter({view:"daterangesuggest",body:{timepicker:t.timepicker,calendarCount:t.calendarCount,height:250+(t.button||t.icons?30:0)}})),this._init_once=function(){}},$prepareValue:function(){return Xn.api.$prepareValue.apply(this,arguments)},_string_to_date:function(t){return"string"==typeof t&&(t=R.parseFormatDate(t)),isNaN(1*t)?null:t},$compareValue:function(t,e){var i=er.api.$compareValue,s=i.call(this,t.start,e.start),n=i.call(this,t.end,e.end);return s&&n},$setValue:function(t){t=t||{},this._settings.text=(t.start?this._get_visible_text(t.start):"")+(t.end?this._settings.separator+this._get_visible_text(t.end):""),this._set_visible_text(),this._toggleClearIcon(this._settings.text)},getValue:function(){var t=this._settings.value;if(this._rendered_input){if(this._settings.editable){var e=this._formatDate||R.dateFormatDate,i=(this.getInputNode().value||"").split(this._settings.separator);t=this._formatValue(e,{start:i[0],end:i[1]})}}else t=this.$prepareValue(t)||null;if(this._settings.stringResult){var s=R.parseFormatStr;return this._formatValue(s,t)}return t||null},_formatValue:function(t,e){return e.start&&(e.start=t(e.start)),e.end&&(e.end=t(e.end)),e}}),Rr=(t.protoUI(Lr,er.view),{name:"excelbar",defaults:{padding:0,type:"line"},$init:function(t){t.cols=[{view:"tabbar",options:[""],optionWidth:200,borderless:!0,on:{onaftertabclick:function(){this.getParentView().callEvent("onExcelSheetSelect",[this.getValue()])}}}]},getValue:function(){return this.getInput().getValue()},setValue:function(t,e){return this.getInput().setValue(t,e)},getInput:function(){return this.getChildViews()[0]},setSheets:function(t){var e=this.getInput();e.config.options=t,e.refresh()}}),zr=(t.protoUI(Rr,Sa.view),{name:"vscroll",$apiOnly:!0,defaults:{scroll:"x",scrollPos:0,scrollSize:18,scrollVisible:!0,zoom:1},$init:function(t){var e=this,i=t.scroll||"x",s=this._viewobj=F(t.container);s.className+=" webix_vscroll_"+i,s.innerHTML="<div class='webix_vscroll_body'></div>",_e(s,"scroll",(function(){return e._onscroll_delay()})),this._last_set_size=0},$skin:function(){this.defaults.scrollStep=vi.rowHeight},reset:function(){this.config.scrollPos=0,this._viewobj["x"==this.config.scroll?"scrollLeft":"scrollTop"]=0,this._scroll_delay&&clearTimeout(this._scroll_delay[0])},_check_quantum:function(t){return t>15e5?(this._settings.zoom=t/1e6,t=1e6):this._settings.zoom=1,t},scrollWidth_setter:function(t){return t=this._check_quantum(t),this._viewobj.firstChild.style.width=t+"px",t},scrollHeight_setter:function(t){return t=this._check_quantum(t),this._viewobj.firstChild.style.height=t+"px",t},sizeTo:function(t,e,i){t=t-(e||0)-(i||0);var s=this._settings.scrollSize;s||!this._settings.scrollVisible||Ot.$customScroll||(this._viewobj.style.pointerEvents="none",s=14),s?(this._viewobj.style.display="block",e&&(this._viewobj.style.marginTop=e+"px"),this._viewobj.style["x"==this._settings.scroll?"width":"height"]=Math.max(0,t)+"px",this._viewobj.style["x"==this._settings.scroll?"height":"width"]=s+"px"):this._viewobj.style.display="none",this._last_set_size=t},getScroll:function(){return Math.round(this._settings.scrollPos*this._settings.zoom)},getSize:function(){return Math.round((this._settings.scrollWidth||this._settings.scrollHeight)*this._settings.zoom)},_fixSize:function(){var t=this.getScroll(),e=Math.max(this.getSize()-this._last_set_size,0);t>e&&this.scrollTo(e)},_sync:function(t,e){var i=this._settings;if((t=Math.round(t/i.zoom))<0&&(t=0),e&&this._viewobj.scrollTo){var s={top:0,left:0,behavior:"smooth"};s["x"==i.scroll?"left":"top"]=t,this._viewobj.scrollTo(s)}else this._viewobj["x"==i.scroll?"scrollLeft":"scrollTop"]=t;this._onscroll_delay(150),this._settings.scrollPos=t||0},scrollTo:function(t){var e=this._settings;(t=Math.round(t/e.zoom))<0&&(t=0),t!=this._settings.scrollPos&&(this._viewobj["x"==e.scroll?"scrollLeft":"scrollTop"]=t,this._onscroll_inner(t,!0))},_onscroll_delay:function(t){this._scroll_delay&&(t=t||this._scroll_delay[1],clearTimeout(this._scroll_delay[0])),this._scroll_delay=[j(this._onscroll,this,[!!t],t),t]},_onscroll:function(t){if(this._scroll_delay=null,!t){var e=Math.round(this._viewobj["x"==this._settings.scroll?"scrollLeft":"scrollTop"]);e!=this._settings.scrollPos&&this._onscroll_inner(e,!1)}},_onscroll_inner:function(t,e){var i=this._settings.scrollWidth||this._settings.scrollHeight;t>=i-this._last_set_size/(e?this._settings.zoom:1)&&(t=Math.max(0,i-this._last_set_size/this._settings.zoom)),this._settings.scrollPos=t||0,this.callEvent("onScroll",[this.getScroll()])},activeArea:function(t,e){this._x_scroll_mode=e,_e(t,"wheel",this._on_wheel,{bind:this,passive:!1})},_on_wheel:function(t){if(t.ctrlKey)return!1;var e=0,i=0===t.deltaMode?30:1;if(t.deltaX&&Math.abs(t.deltaX)>Math.abs(t.deltaY)||t.shiftKey?this._x_scroll_mode&&this._settings.scrollVisible&&(e=(t.shiftKey?t.deltaY:t.deltaX)/i):!this._x_scroll_mode&&this._settings.scrollVisible&&(e=t.deltaY/i),Ot.isSafari&&(this._scroll_trg=t.target),e){var s=this.getScroll();this.scrollTo(s+e*this._settings.scrollStep),s!==this.getScroll()&&St(t)}}}),Hr=(t.protoUI(zr,H,ai),{_init_areaselect:function(){var e=this;this._arSelCheckKeys=!0,this._areaSelStorage={},this._areaSelStorageHidden={},this.define("select","area"),this.attachEvent("onAfterScroll",(function(){this.refreshSelectArea()})),this.attachEvent("onAfterRender",(function(){this.refreshSelectArea(),this._setTabindex()})),this.attachEvent("onColumnResize",(function(){this.refreshSelectArea()})),this.attachEvent("onBeforeColumnHide",(function(t){var e=this._areaSelStorage;for(var i in e)this._areaSelStorageHidden[i]||(this._areaSelStorageHidden[i]=I(e[i]));this._areaSelHiddenIndex=this.getColumnIndex(t)})),this.attachEvent("onAfterColumnHide",(function(){this._excludeColumnFromAreas(this._areaSelHiddenIndex)})),this.attachEvent("onAfterColumnShow",(function(t){this._restoreSelArea(t)})),this.attachEvent("onSyncScroll",this._syncSelectArea),this._bs_do_select=function(e,i,s,n){if(e.row&&i.row){if(this.$handleStart){var a=this._correctHandleSelection(e,i);t.extend(e,a.start,!0),t.extend(i,a.end,!0)}if(!this.callEvent("onBeforeBlockSelect",[e,i,s,n]))return;if(s)return this.addSelectArea(e,i,!0),this._arSelCheckKeys=!0,!1;if(!this.callEvent("onAreaDrag",[e,i,n]))return!1;this._activeAreaSName||!this._arSelCheckKeys||this._settings.multiselect&&n&&n.ctrlKey||(this.removeSelectArea(),this._arSelCheckKeys=!1,this._areaSelStorageHidden={})}},this.attachEvent("onBeforeAreaAdd",this._span_correct_range),_e(this._body,Ot.mouse.down,(function(t){return e._ars_down(t,"mouse")})),Ot.touch&&_e(this._body,Ot.touch.down,(function(t){return e._ars_down(t,"touch")}))},_syncSelectArea:function(t,e,i){Ii._set_matrix(this._rselect_box,t,e,i),Ii._set_matrix(this._rselect_box_left,0,e,i),Ii._set_matrix(this._rselect_box_right,0,e,i)},_block_sel_flag:!0,_excludeColumnFromAreas:function(t){var e=this._areaSelStorage;for(var i in e){var s=e[i];if(this.getColumnIndex(s.start.column)<0)if(s.start.column==s.end.column)this.removeSelectArea(s.name);else{var n=this.columnId(t);n&&this._updateSelectArea(s.name,{row:s.start.row,column:n},null,!1,!0)}else if(this.getColumnIndex(s.end.column)<0){var a=this.columnId(t-1);a&&this._updateSelectArea(s.name,null,{row:s.end.row,column:a},!1,!0)}}this.refreshSelectArea()},_restoreSelArea:function(e){var i=this._areaSelStorageHidden,s=this._areaSelStorage;for(var n in i){var a=i[n];a&&(s[a.name]&&s[a.name].start.column===a.start.column&&s[a.name].start.row===a.start.row&&s[a.name].end.column===a.end.column&&s[a.name].end.row===a.end.row&&delete i[n],s[a.name]||e!==a.start.column&&e!==a.end.column?(e===a.start.column&&this._updateSelectArea(a.name,{row:a.start.row,column:e},null),e===a.end.column&&this._updateSelectArea(a.name,null,{row:a.end.row,column:e})):this.addSelectArea({row:a.start.row,column:e},{row:a.end.row,column:e},!0,a.name))}for(var r in s){var o=s[r],l={start:o.start,end:o.end};this._span_correct_range(l),t.extend(o,l,!0)}},_extendAreaRange:function(t,e,i,s){var n,a,r,o,l,h,c,d;if(e){n=this.getColumnIndex(e.start.column),a=this.getColumnIndex(e.end.column),r=this.getIndexById(e.start.row),o=this.getIndexById(e.end.row),l=this.getColumnIndex(t.column),h=this.getIndexById(t.row),c=this.getIndexById(e.init.row),d=this.getColumnIndex(e.init.column),n>l||"left"==i?"left"===i&&s.ctrl?(n=this._extendAreaToData(c,n,i),a=d):"left"===i&&a>d?a--:n=l:(a<=l||"right"==i)&&("right"==i&&s.ctrl?(a=this._extendAreaToData(c,a,i),n=d):"right"==i&&n<d?n++:a=l),r>h||"up"==i||"pgup"==i?"up"==i&&s.ctrl?(r=this._extendAreaToData(r,d,i),o=c):o>c&&("up"==i||"pgup"==i)?(o-=s.step,o=Math.max(c,o)):r=h:(o<h||"down"==i||"pgdown"==i)&&("down"==i&&s.ctrl?(o=this._extendAreaToData(o,d,i),r=c):("down"==i||"pgdown"==i)&&r<c?(r+=s.step,r=Math.min(c,r)):o=h);var u={row:this.getIdByIndex(r),column:this.columnId(n)},_={row:this.getIdByIndex(o),column:this.columnId(a)};this.callEvent("onBeforeBlockSelect",[u,_,!0])&&(this._updateSelectArea(e.name,u,_),this.callEvent("onSelectChange",[]),this.callEvent("onAfterBlockSelect",[u,_]))}},_extendAreaToData:function(t,e,i){var s=this.config.columns,n=this.data.order,a=this.data.pull[n[t]],r=s[e].id,o=0;if("right"==i)for(var l=e+1;l<s.length;l++){if(a[s[l].id]){o=l;break}o=l}else if("left"==i){for(var h=e-1;h>=0;h--)if(a[s[h].id]){o=h;break}}else if("down"==i)for(var c=t+1;c<n.length;c++){if(this.getItem(n[c])[r]){o=c;break}o=c}else if("up"==i)for(var d=t-1;d>=0;d--)if(this.getItem(n[d])[r]){o=d;break}return o},_updateSelectArea:function(e,i,s,n,a){var r=this._areaSelStorage[e];if(!r)return!1;var o=I(r),l={start:i||r.start,end:s||r.end};this._span_correct_range(l),t.extend(r,l,!0),a||this.refreshSelectArea(),this._setTabindex(o),n&&this.callEvent("onSelectChange",[])},areaselect_setter:function(t){return t&&(this._init_areaselect(),this._init_areaselect=function(){}),this.define("blockselect",t),t},addSelectArea:function(t,e,i,s,n,a){var r,o,l,h,c;(r=this.getIndexById(t.row))>(o=this.getIndexById(e.row))&&(c=r,r=o,o=c),(l=this.getColumnIndex(t.column))>(h=this.getColumnIndex(e.column))&&(c=l,l=h,h=c),s=s||this._activeAreaSName||T(),this._activeAreaSName=null;var d={start:{row:this.getIdByIndex(r),column:this.columnId(l)},end:{row:this.getIdByIndex(o),column:this.columnId(h)}};if(n&&(d.css=n),(a||!1===a)&&(d.handle=a),this._areaSelStorage[s])return this._updateSelectArea(s,d.start,d.end,!0);d.handle=!0,d.name=s,d.init=d.start,this.callEvent("onBeforeAreaAdd",[d])&&(this._lastDefArea=s,i||(this.removeSelectArea(),this._areaSelStorageHidden={}),this._areaSelStorage[d.name]=d,this._selected_areas.push(d),this.refreshSelectArea(),this._setTabindex(),this.callEvent("onAfterAreaAdd",[d]),this.callEvent("onSelectChange",[]))},_renderSelectAreaBox:function(){var t=vt("DIV");return t.className="webix_area_selection_layer",t.style.top=this._render_scroll_shift+"px",t},refreshSelectArea:function(){var t,e,i,s,n=null,a=null,r=null,o=this._settings.prerender;if(this._render_full_rows){t=this._get_x_range(o),e=this._get_y_range(!0===o),this._rselect_box||(this._rselect_box=this._renderSelectAreaBox(),this._body.childNodes[1].appendChild(this._rselect_box),this._rselect_box_left=this._renderSelectAreaBox(),this._body.childNodes[0].appendChild(this._rselect_box_left),this._rselect_box_right=this._renderSelectAreaBox(),this._body.childNodes[2].appendChild(this._rselect_box_right)),this._rselect_box.innerHTML="",this._rselect_box_left.innerHTML="",this._rselect_box_right.innerHTML="";var l=this._settings.leftSplit,h=this._settings.rightSplit;for(i in this._areaSelStorage){s=this._areaSelStorage[i];var c=this._calcAreaSelectIndexes(s,t,e);if(null!==c){var d=this.getColumnIndex(s.start.column),u=this.getColumnIndex(s.end.column);if(c.r0<=c.r1){if(this._settings.topSplit&&undefined>=this._settings.topSplit&&undefined<this._render_scroll_top)return!1;d<l&&(a=this._getSelectAreaCellPositions(c.r0,d,c.r1,Math.min(u,l-1))),c.c0<=c.c1&&(n=this._getSelectAreaCellPositions(c.r0,c.c0,c.r1,c.c1)),h&&u>=this._rightSplit&&(r=this._getSelectAreaCellPositions(c.r0,Math.max(d,this._rightSplit),c.r1,u)),(a||n||r)&&this._setSelectAreaBorders(a,n,r,i,s.css,s.handle)}}else this.removeSelectArea(i)}}},_calcAreaSelectIndexes:function(t,e,i){var s,n,a=this.getIndexById(t.start.row),r=this.getIndexById(t.end.row),o=this.getColumnIndex(t.start.column),l=this.getColumnIndex(t.end.column);if(-1===o||-1===l)return null;if(-1===a||-1===r)return null;if(n=Math.min(i[1],r),this._settings.topSplit){if((s=a)>=this._settings.topSplit&&(s=Math.max(i[0]-this._settings.topSplit,a)),n>=this._settings.topSplit){var h=this._cellPosition(this.getIdByIndex(r),t.end.column),c=this._cellPosition(this.getIdByIndex(this._settings.topSplit-1),t.end.column);c.top+c.height>h.top+h.height&&(n=this._settings.topSplit-1)}}else s=Math.max(i[0],this.getIndexById(t.start.row));return{r0:s,r1:n,c0:Math.max(e[0],o),c1:Math.min(this._rightSplit?e[1]-1:e[1],l)}},_getSelectAreaCellPositions:function(t,e,i,s){return[this._cellPosition(this.getIdByIndex(t),this.columnId(e)),this._cellPosition(this.getIdByIndex(i),this.columnId(s))]},_setSelectAreaBorders:function(t,e,i,s,n,a){var r,o,l=this._areaSelStorage[s],h=0;this._settings.topSplit&&(h=this._getTopSplitOffset(l.start,!0));var c=function(t,e,i,a,r){var o,l,c,d,u,_,p={top:1,right:1,bottom:1,left:1};for(o in a&&delete p.left,r&&delete p.right,l=i.top-e.top+i.height-1,c=i.left-e.left+i.width,p){d=e.top+h,"bottom"==o&&(d=i.top+i.height),u=e.left,"right"==o&&(u=i.left+i.width),_="top"==o||"bottom"==o,t.appendChild(vt("DIV",{class:"webix_area_selection webix_area_selection_"+o+(n?" "+n:""),style:"left:"+u+"px;top:"+d+"px;"+(_?"width:"+c+"px;":"height:"+(l-h)+"px;"),webix_area_name:s},""));var f=t.lastChild;"right"==o&&(f.style.left=u-f.offsetWidth+"px"),"bottom"==o&&(f.style.top=d-f.offsetHeight+"px"),h&&("top"==o&&(f.style.display="none"),i.height==h&&"bottom"==o&&(f.style.display="none"))}};i&&c(this._rselect_box_right,i[0],i[1],!!e,!1),e&&c(this._rselect_box,e[0],e[1],!!t,!!i),t&&c(this._rselect_box_left,t[0],t[1],!1,!!e),a&&(o=i?i[1]:e?e[1]:t[1],(r=i?this._rselect_box_right:e?this._rselect_box:this._rselect_box_left).appendChild(vt("DIV",{class:"webix_area_selection_handle"+(n?" "+n:""),style:"left:"+(o.left+o.width)+"px;top:"+(o.top+o.height)+"px;",webix_area_name:s},"")),h&&o.height==h&&(r.lastChild.style.display="none"))},_removeAreaNodes:function(t){if(t){var e=function(e){for(var i=e.childNodes,s=i.length-1;s>=0;s--)i[s].getAttribute("webix_area_name")==t&&e.removeChild(i[s])};e(this._rselect_box),e(this._rselect_box_left),e(this._rselect_box_right)}},removeSelectArea:function(t){if(t&&this._areaSelStorage[t]){if(this.callEvent("onBeforeAreaRemove",[t])){for(var e in this._setTabindex(I(this._areaSelStorage[t]),!0),delete this._areaSelStorage[t],this._render_full_rows&&this._removeAreaNodes(t),this._selected_areas=[],this._areaSelStorage)this._selected_areas.push(this._areaSelStorage[e]);this.callEvent("onAfterAreaRemove",[t])}}else for(var i in this._areaSelStorage)this.removeSelectArea(i)},_ars_down:function(t,e){var i=Nt(t.target);if(i&&-1!=i.indexOf("webix_area_selection_handle")){var s=t.target.getAttribute("webix_area_name");this._activeAreaSName=s;var n=this._areaSelStorage[s],a=this._cellPosition(n.start.row,n.start.column),r=this._cellPosition(n.end.row,n.end.column),o=this._settings.prerender,l=this.getColumnIndex(n.start.column)<this._settings.leftSplit?0:this._left_width,h=this.getColumnIndex(n.end.column)<this._settings.leftSplit?0:this._left_width,c=r.left+1+h-this._scrollLeft,d=r.top+1-(o?this._scrollTop:0);this._bs_ready=[a.left+1+l-this._scrollLeft,a.top+1-(o?this._scrollTop:0),{row:n.start.row,column:n.start.column},c,d,{row:n.end.row,column:n.end.column}],this._bs_position=kt(this._body),this._bs_start(!0),this._bs_progress=[c,d],this._bs_select(!1,!1,t),St(t),this._bs_handler_init(t.target,e)}},getSelectArea:function(t){return this._areaSelStorage[t||this._lastDefArea]},getAllSelectAreas:function(){return this._areaSelStorage},_span_correct_range:function(t,e){var i,s,n,a,r,o,l,h,c=t.start,d=t.end;i=r=this._getAreaRowIndex(c.row),n=l=this._getHiddenColumnIndex(c.column),s=o=this._getAreaRowIndex(d.row),a=h=this._getHiddenColumnIndex(d.column);var u=e||[{},{}];if(!e)for(var _=i;_<=s;_++)if(this.getItem(this._getAreaRowId(_)).$row)return t.start.column=this.columnId(0),t.end.column=this.columnId(this._columns.length-1),this._span_correct_range(t,u);if(this.config.spans){var p=this.getSpan();for(var f in p)for(var g in p[f]){var m=u[0][f]=u[0][f]||0===u[0][f]?u[0][f]:this._getAreaRowIndex(f),v=u[1][g]=u[1][g]||0===u[1][g]?u[1][g]:this._getHiddenColumnIndex(g),b=p[f][g];m>=0&&v>=0&&!(m>o||m+b[1]-1<r||v+b[0]-1<l||v>h)&&(r=Math.min(r,m),o=Math.max(o,m+b[1]-1),l=Math.min(l,v),h=Math.max(h,v+b[0]-1))}i!=r||n!=l||s!=o||a!=h?(t.start={row:this._getAreaRowId(r),column:this._getHiddenColumnId(l)},t.end={row:this._getAreaRowId(o),column:this._getHiddenColumnId(h)},this._span_correct_range(t,u)):this._applyAreaHiddenBounds([i,s],[n,a],t)}},_setTabindex:function(t,e){var i;if(t&&(i=this.getItemNode({row:t.start.row,column:t.start.column}))&&i.removeAttribute("tabindex"),!e&&this._selected_areas.length){var s=this.getSelectedId(!0)[0];(i=this.getItemNode(s))&&i.setAttribute("tabindex","1")}},_getAreaRowId:function(t){return this.data._filter_order?this.data._filter_order[t]:this.data.order[t]},_getAreaRowIndex:function(t){return(this.data._filter_order||this.data.order).find(t)},_applyAreaHiddenBounds:function(t,e,i){if(this._hidden_column_order.length){for(var s=e[0],n=e[1];this.getColumnConfig(this._hidden_column_order[s]).hidden&&s<n;)s++;for(;this.getColumnConfig(this._hidden_column_order[n]).hidden&&n>s;)n--;s!=e[0]&&(i.start.column=this._getHiddenColumnId(s)),n!=e[1]&&(i.end.column=this._getHiddenColumnId(n))}if(this.data._filter_order){for(var a=t[0],r=t[1];this.data.order.find(this.data._filter_order[a])<0;)a++;for(;this.data.order.find(this.data._filter_order[r])<0;)r--;a!=t[0]&&(i.start.row=this.data._filter_order[a]),r!=t[1]&&(i.end.row=this.data._filter_order[r])}},_correctHandleSelection:function(t,e){var i,s,n=this.getColumnIndex(t.column),a=this.getColumnIndex(e.column),r=n>a;if(r)s=this.columnId(a);else{var o=this.getIndexById(t.row),l=this.getIndexById(e.row);(r=o>l)&&(i=this.getIdByIndex(l))}if(r){var h=this._bs_ready[5];t={row:i||t.row,column:s||t.column},e={row:h.row,column:h.column}}return{start:t,end:e}}}),qr={filterByAll:function(){var t=this,e=!1;this.data.silent((function(){var t=this;this.filter();var i=!1,s=function(s){if(f(s,"empty column id for column with filtering"),!t.isColumnVisible(s))return"continue";var n=t._filter_elements[s],a=n[2].getValue(n[0]),r=a;n[1].prepare&&(r=n[1].prepare.call(n[2],r,n[1],t)),n[1].value=a;var o=n[1].compare;if(!t.callEvent("onBeforeFilter",[s,r,n[1]]))return"continue";if(n[2].$server||e)e=!0;else{if(""===r)return"continue";o?(o=t._multi_compare(s,o),t.filter(A((function(t,e){return!!t&&o(t[s],e,t)}),t),r,i)):t.filter(s,r,i),i=!0}};for(var n in this._filter_elements)s(n)}),this),e?this._skip_server_op?this._skip_server_op.filter=!0:this.loadNext(0,0,0,0,!0,!0).then((function(){return t._on_after_filter()})):(this.refresh(),this.callEvent("onAfterFilter",[]))},_multi_compare:function(t,e){var i=this.getColumnConfig(t),s=i?i.optionslist:null;return s?("string"!=typeof s&&(s=","),function(t,i,n){if(!t)return!1;for(var a=t.toString().split(s),r=0;r<a.length;r++)if(e(a[r],i,n))return!0}):e},filterMode_setter:function(e){return t.extend(this.data._filterMode,e,!0)},getFilter:function(t){var e=this._filter_elements[t];return e&&e[2]._get_filter?e[2]._get_filter(e[0]):e&&e[2].getInputNode?e[2].getInputNode(e[0]):null},registerFilter:function(t,e,i){this._filter_elements[e.columnId]=[t,e,i]},collectValues:function(t,e){var i=this.getColumnConfig(t),s=e&&e.visible?null:i.collection,n={values:s?this._collectValues.call(s,"id","value"):this._collectValues(i.id,i.id)};return this.callEvent("onCollectValues",[t,n]),n.values},_collectValues:function(t,i){var s={"":!0},n=[];if(this.data.each((function(a){var r=a?a[t]:"";0===r&&(r="0"),"object"==e(r)&&(r=String(r)),void 0===r||s[r]||(s[r]=!0,n.push({id:r,value:a[i]}))}),this,!0),n.length){var a="string"==typeof n[0].value?"string":"raw";n.sort(this.data.sorting.create({as:a,by:"value",dir:"asc"}))}return n},_on_after_filter:function(){this.editStop&&this.editStop(),this.callEvent("onAfterFilter",[])}},Ur={hover_setter:function(t){var e=this;return t&&!this._hover_initialized&&(this._enable_mouse_move(),this.config.experimental=!0,this.attachEvent("onMouseMoving",(function(t){if(Ai.active)e._last_hover&&(e._last_hover=e.removeRowCss(e._last_hover,e._settings.hover));else{var i=e.locate(t);!i&&Ot.isEdge&&t.relatedTarget&&(i=e.locate(t.relatedTarget));var s=i?i.row:null;e._last_hover!=s&&(e._last_hover&&e.removeRowCss(e._last_hover,e._settings.hover),e._last_hover=s,e._last_hover&&e.addRowCss(e._last_hover,e._settings.hover))}})),_e(this.$view,"mouseout",(function(t){var i=t.target;e._last_hover&&document.body.contains(i)&&(t.relatedTarget&&e.locate(t.relatedTarget)||(e.removeRowCss(e._last_hover,e._settings.hover),e._last_hover=null))})),this._hover_initialized=1),t},select_setter:function(e){return!this.select&&e&&(t.extend(this,this._selections._commonselect,!0),!0===e?e="row":"multiselect"==e&&(e="row",this._settings.multiselect=!0),f(this._selections[e],"Unknown selection mode: "+e),t.extend(this,this._selections[e],!0)),e},getSelectedId:function(t){return t?[]:""},getSelectedItem:function(t){return ws.getSelectedItem.call(this,t)},_selections:{_commonselect:{_select_css:" webix_cell_select",$init:function(){this._reinit_selection(),this.on_click.webix_cell=A(this._click_before_select,this),this._data_cleared=this._data_filtered=function(){this.unselect()},this.data.attachEvent("onStoreUpdated",A(this._data_updated,this)),this.data.attachEvent("onSyncApply",A(this._data_synced,this)),this.data.attachEvent("onClearAll",A(this._data_cleared,this)),this.data.attachEvent("onAfterFilter",A(this._data_filtered,this)),this.data.attachEvent("onIdChange",A(this._id_changed,this)),this.$ready.push(ws._set_noselect)},_id_changed:function(t,e){for(var i=0;i<this._selected_rows.length;i++)this._selected_rows[i]==t&&(this._selected_rows[i]=e);for(var s=0;s<this._selected_areas.length;s++){var n=this._selected_areas[s];n.row==t&&(t=this._select_key(n),n.row=e,e=this._select_key(n),n.id=e,delete this._selected_pull[t],this._selected_pull[e]=!0)}},_data_updated:function(t,e,i){"delete"==i&&this.unselect(t)},_data_synced:function(){for(var t=this._selected_areas.length-1;t>=0;t--){var e=this._selected_areas[t].row;this.exists(e)||(this._selected_areas.splice(t,1),delete this._selected_pull[e])}},_reinit_selection:function(){this._selected_areas=[],this._selected_pull={},this._selected_rows=[]},isSelected:function(t,i){var s;return s=E(i)?"object"===e(t)?this._select_key(t):t:this._select_key({row:t,column:i}),this._selected_pull[s]},getSelectedId:function(t,e){var i;if(this._selected_areas.length>1||t){if(i=[].concat(this._selected_areas),e)for(var s=0;s<i.length;s++)i[s]=i[s].id}else if(i=this._selected_areas[0],e&&i)return i.id;return i},_id_to_string:function(){return this.row},_select:function(t,e){var i=this._select_key(t);if(null!==i){if(-1===e)return this._unselect(t);if(t.id=i,t.toString=this._id_to_string,!this.callEvent("onBeforeSelect",[t,e]))return!1;if(!this._selected_pull[i]||!e&&1!=this._selected_areas.length)return e||this._clear_selection(),this._selected_areas.push(t),this._selected_pull[i]=!0,this.callEvent("onAfterSelect",[t,e]),this._finalize_select(this._post_select(t)),!0}},_clear_selection:function(){if(!this._selected_areas.length)return!1;for(var t=0;t<this._selected_areas.length;t++)if(!this.callEvent("onBeforeUnSelect",[this._selected_areas[t]]))return!1;for(var e=0;e<this._selected_rows.length;e++)this.data.removeMark(this._selected_rows[e],"webix_selected",0,!0);var i=this._settings.columns;if(i)for(var s=0;s<i.length;s++)i[s].$selected=null;var n=this._selected_areas;this._reinit_selection();for(var a=0;a<n.length;a++)this.callEvent("onAfterUnSelect",[n[a]]);return!0},unselectAll:function(){this.clearSelection()},selectAll:function(){this.selectRange()},clearSelection:function(){this._clear_selection()&&(this.callEvent("onSelectChange",[]),this.render())},_unselect:function(t){var e=this._select_key(t);if(!e&&this._selected_areas.length&&(this.clearSelection(),this.callEvent("onSelectChange",[])),this._selected_pull[e]){if(!this.callEvent("onBeforeUnSelect",[t]))return!1;for(var i=0;i<this._selected_areas.length;i++)if(this._selected_areas[i].id==e){this._selected_areas.splice(i,1);break}delete this._selected_pull[e],this.callEvent("onAfterUnSelect",[t]),this._finalize_select(0,this._post_unselect(t))}},_add_item_select:function(t){var e=this.getItem(t);return this.data.addMark(e.id,"webix_selected",0,{$count:0},!0)},_finalize_select:function(t){t&&this._selected_rows.push(t),this._silent_selection||(this.render(),this.callEvent("onSelectChange",[]))},_click_before_select:function(t,e){var i=t.ctrlKey||t.metaKey||"touch"==this._settings.multiselect,s=t.shiftKey;if(this._settings.multiselect||"multiselect"==this._settings.select||"area"==this._settings.select||(i=s=!1),s&&this._selected_areas.length){var n=this._selected_areas[this._selected_areas.length-1];this._selectRange(e,n)}else i&&this._selected_pull[this._select_key(e)]?this._unselect(e):this._select({row:e.row,column:e.column},i);var a=this.getEditor(e);if(!a||!a.$inline||a.getPopup){var r=this.getItemNode(e);r&&r.focus()}},_mapSelection:function(t,e,i){var s=this._settings.columns;if(e){for(var n=[],a=0;a<s.length;a++)s[a].$selected&&n.push(s[a]);s=n}for(var r=this.data.order,o=0,l=0;l<r.length;l++){var h=this.getItem(r[l]);if(h){var c=this.data.getMark(h.id,"webix_selected");if(c||e){for(var d=0,u=0;u<s.length;u++){var _=s[u].id;if(i||e||c[_]){if(!t)return{row:r[l],column:_};h[_]=t(h[_],r[l],_,o,d),d++}}o++}}}}},row:{_select_css:" webix_row_select",_select_key:function(t){return t.row},select:function(t,e){t&&(t=t.toString()),f(this.data.exists(t),"Incorrect id in select command: "+t),this._select({row:t},e)},_post_select:function(t){return this._add_item_select(t.row).$row=!0,t.row},unselect:function(t){this._unselect({row:t})},_post_unselect:function(t){return this.data.removeMark(t.row,"webix_selected",0,!0),t.row},mapSelection:function(t){return this._mapSelection(t,!1,!0)},_selectRange:function(t,e){return this.selectRange(t.row,e.row)},selectRange:function(t,e,i){E(i)&&(i=!0);var s=t?this.getIndexById(t):0,n=e?this.getIndexById(e):this.data.order.length-1;if(s>n){var a=s;s=n,n=a}this._silent_selection=!0;for(var r=s;r<=n;r++){var o=this.getIdByIndex(r);if(!o){t&&this.select(t);break}this.select(o,i)}this._silent_selection=!1,this._finalize_select()}},cell:{_select_key:function(t){return t.column?t.row+"_"+t.column:null},select:function(t,e,i){f(this.data.exists(t),"Incorrect id in select command: "+t),this._select({row:t,column:e},i)},_post_select:function(t){var e=this._add_item_select(t.row);return e.$count++,e[t.column]=!0,t.row},unselect:function(t,e){this._unselect({row:t,column:e})},_post_unselect:function(t){var e=this._add_item_select(t.row);return e.$count--,e[t.column]=!1,e.$count<=0&&this.data.removeMark(t.row,"webix_selected",0,!0),t.row},mapSelection:function(t){return this._mapSelection(t,!1,!1)},_selectRange:function(t,e){return this.selectRange(t.row,t.column,e.row,e.column)},selectRange:function(t,e,i,s,n){E(n)&&(n=!0);var a=t?this.getIndexById(t):0,r=i?this.getIndexById(i):this.data.order.length-1,o=e?this.getColumnIndex(e):0,l=s?this.getColumnIndex(s):this._columns.length-1;if(a>r){var h=a;a=r,r=h}if(o>l){var c=o;o=l,l=c}this._silent_selection=!0;for(var d=a;d<=r;d++)for(var u=o;u<=l;u++)this.select(this.getIdByIndex(d),this.columnId(u),n);this._silent_selection=!1,this._finalize_select()}},column:{_select_css:" webix_column_select",_select_key:function(t){return t.column},_id_to_string:function(){return this.column},select:function(t,e){this._select({column:t},e)},_post_select:function(t){this._settings.columns[this.getColumnIndex(t.column)].$selected=!0,this._silent_selection||this._render_header_and_footer()},unselect:function(t){this._unselect({column:t})},_post_unselect:function(t){this._settings.columns[this.getColumnIndex(t.column)].$selected=null,this._render_header_and_footer()},mapSelection:function(t){return this._mapSelection(t,!0,!1)},_selectRange:function(t,e){return this.selectRange(t.column,e.column)},selectRange:function(t,e,i){E(i)&&(i=!0);var s=t?this.getColumnIndex(t):0,n=e?this.getColumnIndex(e):this._columns.length-1;if(s>n){var a=s;s=n,n=a}this._silent_selection=!0;for(var r=s;r<=n;r++)this.select(this.columnId(r),i);this._silent_selection=!1,this._render_header_and_footer(),this._finalize_select()},_data_synced:function(){}},area:{_select_key:function(t){return t.row+"_"+t.column},getSelectedId:function(t){var e=this.getSelectArea(),i=[];if(e)if(!t||e.start.row==e.end.row&&e.start.column==e.end.column)i.push(e.end);else{var s=this.getIndexById(e.start.row),n=this.getIndexById(e.end.row);if(-1==s||-1==n)return i;for(var a=this.getColumnIndex(e.start.column),r=this.getColumnIndex(e.end.column),o=s;o<=n;o++)for(var l=a;l<=r;l++)i.push({row:this.getIdByIndex(o),column:this.columnId(l)})}return t?i:i[0]},unselect:function(){this._unselect()},_unselect:function(){this.removeSelectArea(),this.callEvent("onSelectChange",[])},mapSelection:function(t){var e=this.getSelectArea();if(e)for(var i=this.getColumnIndex(e.start.column),s=this.getColumnIndex(e.end.column),n=this.getIndexById(e.start.row),a=this.getIndexById(e.end.row),r=n;r<=a;r++)for(var o=this.data.order[r],l=this.getItem(o),h=i;h<=s;h++){var c=this._columns[h].id;if(!t)return{row:o,column:c};l[c]=t(l[c],o,c,r-n,h-i)}},select:function(t,e,i){f(this.data.exists(t),"Incorrect id in select command: "+t),this._select({row:t,column:e},i)},_selectRange:function(t,e){this._extendAreaRange(t,e)},_select:function(t){return this.addSelectArea(t,t,!1),!0},_data_synced:function(){this._selected_areas.length&&this.refreshSelectArea()}}}},Wr={blockselect_setter:function(e){var i=this;return e&&this._block_sel_flag&&(_e(this._viewobj,Ot.mouse.down,(function(t){return i._bs_down(t,"mouse")})),Ot.touch&&this.attachEvent("onLongTouch",(function(t){return i._bs_down(t,"touch")})),this._block_sel_flag=this._bs_ready=this._bs_progress=!1,this.attachEvent("onAfterScroll",this._update_block_selection),t.extend(this,ce,!0),this.attachEvent("onBeforeAutoScroll",(function(){return this._bs_progress}))),e},_block_sel_flag:!0,_childOf:function(t,e){for(var i=t.target;i;){if(i.getAttribute&&i.getAttribute("webixignore"))return!1;if(i==e)return!0;i=i.parentNode}return!1},_bs_down:function(t,e){if((!this._settings.subview||this==ke(t.target))&&this._childOf(t,this._body)){if(t.target&&"INPUT"==t.target.tagName||this._rs_process)return;this._bs_position=kt(this._body);var i=$t(t);this._bs_ready=[i.x-this._bs_position.x,i.y-this._bs_position.y],this._bs_handler_init(t.target,e)}},_bs_handler_init:function(t,e){var i=this;"touch"===e?(this._bs_mm_handler=pe(t,Ot[e].move,(function(t){return i._bs_move(t,e)}),{passive:!1}),this._bs_mu_handler=pe(t,Ot[e].up,(function(t){return i._bs_up(t)}))):(this._bs_mm_handler=pe(this._viewobj,Ot[e].move,(function(t){return i._bs_move(t,e)})),this._bs_mu_handler=pe(document,Ot[e].up,(function(t){return i._bs_up(t)})))},_bs_up:function(t){this._block_panel&&(this._bs_select("select",!0,t),this._block_panel=wt(this._block_panel)),this._bs_mm_handler=fe(this._bs_mm_handler),this._bs_mu_handler=fe(this._bs_mu_handler),Et(document.body,"webix_noselect"),this._bs_ready=this._bs_progress=!1,this._auto_scroll_delay&&(this._auto_scroll_delay=window.clearTimeout(this._auto_scroll_delay))},_update_block_selection:function(){this._bs_progress&&j(this._bs_select,this,[!1,!1])},_bs_select:function(t,e,i){this._bs_ready[2]||(this._bs_ready[2]=this._locate_cell_xy(this._bs_ready[0],this._bs_ready[1]));var s=this._bs_ready[2],n={row:s.row,column:s.column},a=this._locate_cell_xy(this._bs_progress[0],this._bs_progress[1],!0);if(this._bs_do_select||this.callEvent("onBeforeBlockSelect",[n,a,e,i])){if((!this._bs_do_select||!1!==this._bs_do_select(n,a,e,i))&&n.row&&a.row)if("select"===t)this._clear_selection(),this._selectRange(n,a);else{var r,o,l,h;if("box"===t)r=Math.min(this._bs_ready[0],this._bs_progress[0]),l=Math.max(this._bs_ready[0],this._bs_progress[0]),o=Math.min(this._bs_ready[1],this._bs_progress[1]),h=Math.max(this._bs_ready[1],this._bs_progress[1]);else{var c=this.getIndexById(n.row),d=this.getIndexById(a.row),u=this.getColumnIndex(n.column),_=this.getColumnIndex(a.column),p=Math.min(c,d),f=Math.max(c,d),g=Math.min(u,_),m=Math.max(u,_),v=this._bs_cell_position(p,g,!1),b=this._bs_cell_position(f,m,!0);this._settings.prerender&&(v.top-=this._scrollTop,b.top-=this._scrollTop),this._settings.topSplit&&(v.top+=this._getTopSplitOffset(n)),r=v.left,l=b.left,o=v.top,h=b.top,i&&(this._auto_scroll_delay&&(this._auto_scroll_delay=window.clearTimeout(this._auto_scroll_delay)),this._touch_scroll&&!this._settings.prerender||(this._auto_scroll_delay=j(this._auto_scroll,this,[$t(i)],250)))}var w=this._block_panel.style;w.left=r+"px",w.top=o+"px",w.width=l-r+"px",w.height=h-o+"px"}e&&this.callEvent("onAfterBlockSelect",[n,a])}},_bs_cell_position:function(t,e,i){var s=this._cellPosition(this.getIdByIndex(t),this.columnId(e)),n=this.getScrollState(),a=s.left;return this.config.rightSplit&&e>this._columns.length-1-this.config.rightSplit?a+=this._left_width+this._center_width:this.config.leftSplit?e+1>this.config.leftSplit&&(a<n.x?(s.width-=n.x-a,a=this._left_width):a+=this._left_width-n.x):a-=n.x,i&&(a+=s.width,s.top+=s.height,this.config.rightSplit&&e<this._columns.length-this.config.rightSplit&&(a=Math.min(a,this._left_width+this._center_width))),{left:a,top:s.top}},_bs_start:function(t){this._block_panel=vt("div",{class:"webix_block_selection"},""),this._body.appendChild(this._block_panel),this.$handleStart=!!t},_bs_move:function(t,e){if(!this._rs_progress&&!1!==this._bs_ready){this._bs_progress||Dt(document.body,"webix_noselect");var i=$t(t),s=[i.x-this._bs_position.x,i.y-this._bs_position.y];if(Math.abs(this._bs_ready[0]-s[0])<5&&Math.abs(this._bs_ready[1]-s[1])<5)return;!1===this._bs_progress&&this._bs_start(),this._bs_progress=s,this._bs_select(this.config.blockselect,!1,t),"touch"===e&&St(t)}},_locate_cell_xy:function(t,e,i){var s=!1,n=null,a=null;if(this._right_width&&t>this._left_width+this._center_width?t+=this._x_scroll.getSize()-this._center_width-this._left_width-this._right_width:(!this._left_width||t>this._left_width)&&(t+=this._x_scroll.getScroll()),this._settings.topSplit&&this._render_scroll_top>this._settings.topSplit){var r=this._cellPosition(this.getIdByIndex(this._settings.topSplit-1),this.columnId(0));r.top+r.height>e&&(s=!0)}s||(e+=this.getScrollState().y),t<0&&(t=0),e<0&&(e=0);var o=this._settings.columns,l=this.data.order,h=i&&this.$handleStart,c=h?this._getHandleMoveDirection(t,e):null,d=0;if(!h||"x"==c)for(var u=0;u<o.length;u++)if((d+=o[u].width)>=t){a=o[u].id;break}if(a||(a=h?this._bs_ready[5].column:o[o.length-1].id),d=0,!h||"y"==c){var _=this.data.$min||0;if(this._settings.fixedRowHeight)n=l[_+Math.floor(e/this._settings.rowHeight)];else for(var p=_;p<l.length;p++)if((d+=this._getHeightByIndex(p))>=e){n=l[p];break}}return n||(n=h?this._bs_ready[5].row:l[l.length-1]),{row:n,column:a}},_getTopSplitOffset:function(t,e){var i=0,s=this.getIndexById(t.row);if(s>=this._settings.topSplit){var n=this._cellPosition(this.getIdByIndex(s),t.column),a=this._cellPosition(this.getIdByIndex(this._settings.topSplit-1),t.column);a.top+a.height>n.top&&(i=a.top+a.height-(n.top>0||!e?n.top:0))}return i},_getHandleMoveDirection:function(t,e){var i,s=[this._bs_ready[0],this._bs_ready[1]],n=[this._bs_ready[3],this._bs_ready[4]],a=n[0]+this._columns_pull[this._bs_ready[5].column].width,r=n[1]+this._getRowHeight(this._bs_ready[5].row);if(t<=a&&t>=s[0])i=e<=r&&e>=s[1]&&t<n[0]?"x":"y";else{var o=t>n[0]?a:s[0],l=e>n[1]?r:s[1];"y"==(i=Math.abs(t-o)>Math.abs(e-l)?"x":"y")&&t<s[0]&&e<=r&&e>=s[1]&&(i=null)}return i}},Yr={resizeRow_setter:function(t){return this._settings.scrollAlignY=!1,this._settings.fixedRowHeight=!1,this.resizeColumn_setter(t)},resizeColumn_setter:function(t){var e=this;return t&&this._rs_init_flag&&(_e(this._viewobj,"mousemove",(function(t){return e._rs_move(t)})),_e(this._viewobj,"mousedown",(function(t){return e._rs_down(t)})),_e(this._viewobj,"mouseup",(function(){return e._rs_up()})),this._rs_init_flag=!1),t},_rs_init_flag:!0,_rs_down:function(t){!this._rs_ready||this._settings.subview&&this!=ke(t.target)||(this._rs_process=[$t(t),this._rs_ready],Dt(document.body,"webix_noselect"),ut())},_rs_up:function(){this._rs_process=!1,Et(document.body,"webix_noselect"),_t()},_rs_start:function(){var t=this;if(!this._rs_progress){var e,s=i(this._rs_process[1],4),n=s[0],a=s[1],r=s[2],o=s[3],l=this._rs_process[0];"x"==n?(e=kt(r).x+a-kt(this._body).x,l=l.x):(e=kt(r).y+a-kt(this._body).y+this._header_height,l=l.y),this._rs_progress=[n,o,e],new be.resizearea({container:this._viewobj,eventPos:l,start:e,dir:n,cursor:("x"==n?"col":"row")+"-resize"}).attachEvent("onResizeEnd",(function(e){return t._rs_end(e)})),this._rs_ready=!1}},_rs_end:function(t){if(this._rs_progress){var e=this._rs_progress[1],i=t-this._rs_progress[2];if("x"==this._rs_progress[0]){this._settings.rightSplit&&e.cind>=this._rightSplit&&(i*=-1);var s=this._columns[e.cind],n=s.width;delete s.fillspace,delete s.adjust,this._setColumnWidth(e.cind,n+i,!0,!0),this._updateColsSizeSettings()}else{var a=this.getIdByIndex(e.rind),r=this._getRowHeight(this.getItem(a));this.setRowHeight(a,r+i)}this._rs_up()}this._rs_progress=null},_rs_move:function(t){if(this._rs_ready&&this._rs_process)return this._rs_start();this._rs_ready=!1;var e=!1,i=t.target,s=this._settings,n=i.getAttribute("class")||"",a=-1!=n.indexOf("webix_cell");if(a&&s.drag)return this._mark_resize(e);var r=-1!=n.indexOf("webix_hcell");if(a||r){var o=Ct(t),l=this._locate(i);e=this._is_column_rs(l,o,i,s.resizeColumn,a)||a&&this._is_row_rs(l,o,i,s.resizeRow)}this._mark_resize(e)},_is_column_rs:function(t,e,i,s,n){if(!s||n&&s.headerOnly)return!1;var a,r,o=i.offsetWidth;return s=s.size?s.size:3,e.x<s?(t.cind<this._rightSplit&&(t.cind-=t.span||1),a=this._columns[t.cind],r=["x",0,i,t]):o-e.x<s+1&&(this._settings.rightSplit&&t.cind+1>=this._rightSplit&&t.cind++,(!this._settings.rightSplit||t.cind<this._columns.length)&&(a=this._columns[t.cind],r=["x",o,i,t])),!(!a||!1===a.resize)&&(this._rs_ready=r,"col-resize")},_is_row_rs:function(t,e,i,s){if(!s||s.headerOnly&&t.cind>0)return!1;if(this._bs_progress)return!1;var n=i.offsetHeight;return s=s.size?s.size:3,e.y<s?t.rind>0&&(t.rind--,this._rs_ready=["y",0,i,t]):n-e.y<s+1&&(this._rs_ready=["y",n,i,t]),!!this._rs_ready&&"row-resize"},_mark_resize:function(t){this._cursor_timer&&window.clearTimeout(this._cursor_timer),this._cursor_timer=j(this._mark_resize_ready,this,[t],t?100:0)},_mark_resize_ready:function(t){this._last_cursor_mode!=t&&(this._last_cursor_mode=t,this._viewobj.style.cursor=t||"")}};W("onDataTable",(function(t,e){Ot.touch&&(Ii.$init(),e.scrollSize=0,Ii._disabled&&Ii.limit(),t.$ready.push(t.$touch))}));var Gr={$touch:function(){var e=this._settings;e.scrollAlignY=!1,t.extend(this,!0===e.prerender?this._touchNative:this._touch);var i="";e.autowidth||!1===e.scrollX||(i+="x"),e.autoheight||!1===e.scrollY||(i+="y"),this._body.setAttribute("touch_scroll",i),Ii._init_scroll_node(this._body.childNodes[1].firstChild),this._sync_scroll(0,0,"0ms")},$hasYScroll:function(){return this._dtable_height-this._dtable_offset_height>2},_touchNative:{_touch_scroll:!0,_scrollTo_touch:function(t,e){var i=Ii._get_sizes(this._body.childNodes[1].firstChild);t=Math.max(0,Math.min(t,i.dx-i.px)),e=Math.max(0,Math.min(e,i.dy-i.py)),this.callEvent("onAfterScroll",[{e:-t,f:-e}])},_getScrollState_touch:function(){var t=Ii._get_matrix(this._body.childNodes[1].firstChild);return{x:-t.e,y:-t.f}},$init:function(){this.attachEvent("onBeforeScroll",(function(){Ii._scroll_node=this._body.childNodes[1].firstChild,Ii._scroll_stat=Ii._get_sizes(Ii._scroll_node),Ii._scroll_master=this})),this.attachEvent("onTouchEnd",(function(){Ii._scroll_master=null})),this.attachEvent("onAfterScroll",(function(t){t&&(this._scrollLeft=-t.e,this._scrollTop=-t.f,this._sync_scroll(t.e,t.f,"0ms"))}))}},_touch:{_touch_scroll:!0,_scrollTo_touch:function(t,e){j((function(){this.callEvent("onAfterScroll",[{e:-t,f:-e}])}),this)},$scroll:{gravity:0,elastic:!1},$init:function(){this.attachEvent("onAfterColumnHide",(function(){this._scrollTo_touch(0,0)})),this.attachEvent("onAfterRender",(function(){this._x_scroll&&this._settings.scrollX&&this._x_scroll._fixSize(),this._y_scroll&&this._settings.scrollY&&this._y_scroll._fixSize()})),this.attachEvent("onBeforeScroll",(function(){Ii._scroll_node=this._body.childNodes[1].firstChild,Ii._scroll_stat=Ii._get_sizes(Ii._scroll_node),Ii._scroll_stat.dy=this._dtable_height,Ii._scroll_master=this})),this.attachEvent("onTouchEnd",(function(){Ii._scroll_master=null})),this.attachEvent("onAfterScroll",(function(t){t&&(this._scrollTop=0,this._scrollLeft=0,this._sync_scroll(0,0,"0ms"),this._scrollLeft=-t.e,this._scrollTop=-t.f,this._correctScrollSize(),this.render(),this._x_scroll&&(this._x_scroll._settings.scrollPos=-1,this._x_scroll.scrollTo(this._scrollLeft),this.callEvent("onScrollX",[])),this._y_scroll&&(this._y_scroll._settings.scrollPos=-1,this._y_scroll.scrollTo(this._scrollTop),this.callEvent("onScrollY",[])))}))}},_sync_scroll:function(t,e,i){var s=this._settings.prerender?0:this._scrollTop;e+=s,Ii._set_matrix(this._body.childNodes[1].firstChild,t,e,i),this._settings.leftSplit&&Ii._set_matrix(this._body.childNodes[0].firstChild,0,e,i),this._settings.rightSplit&&Ii._set_matrix(this._body.childNodes[2].firstChild,0,e,i),this._settings.header&&Ii._set_matrix(this._header.childNodes[1].firstChild,t,0,i),this._settings.footer&&Ii._set_matrix(this._footer.childNodes[1].firstChild,t,0,i);var n="0ms"!==i;this._x_scroll&&this._x_scroll._sync(-t,n),this._y_scroll&&this._y_scroll._sync(-e+s,n),this.callEvent("onSyncScroll",[t,e,i])},_sync_y_scroll:function(t,e){var i=-this.getScrollState().x;Ii._set_matrix(this._body.childNodes[1].firstChild,i,t,e),this._settings.leftSplit&&Ii._set_matrix(this._body.childNodes[0].firstChild,0,t,e),this._settings.rightSplit&&Ii._set_matrix(this._body.childNodes[2].firstChild,0,t,e),this.callEvent("onSyncScroll",[i,t,e])},_sync_x_scroll:function(t,e){var i=this._settings.prerender?-this.getScrollState().y:0;Ii._set_matrix(this._body.childNodes[1].firstChild,t,i,e),this._settings.header&&Ii._set_matrix(this._header.childNodes[1].firstChild,t,0,e),this._settings.footer&&Ii._set_matrix(this._footer.childNodes[1].firstChild,t,0,e),this.callEvent("onSyncScroll",[t,i,e])},_sync_pos:function(t){this._settings.prerender||(t.f-=this._scrollTop)}},Kr={$init:function(){this.data.attachEvent("onStoreUpdated",A((function(t){t||this._adjustColumns()}),this)),this.attachEvent("onStructureLoad",this._adjustColumns),this.attachEvent("onStructureUpdate",this._resizeColumns),this.attachEvent("onColumnResize",(function(t,e,i,s){s&&this._resizeColumns()})),this.attachEvent("onResize",this._resizeColumns)},_adjustColumns:function(){for(var t=!1,e=this._columns,i=0;i<e.length;i++)e[i].adjust&&("header"==e[i].adjust||this.count())&&(t=this._adjustColumn(i,e[i].adjust,!0)||t);t&&(this._updateColsSizeSettings(!0),this._resizeColumns())},_resizeColumns:function(){var t=this._settings.columns,e=[],i=0;if(t&&!this._settings.autowidth)for(var s=0;s<t.length;s++){var n=t[s].fillspace;n&&(e[s]=n,i+=1*n||1)}i&&this._fillColumnSize(e,i)},_fillColumnSize:function(t,e){var i=this._settings.columns;if(i){var s=this._content_width-this._scrollSizeY,n=!1;if(s>0){for(var a=0;a<i.length;a++)t[a]||(s-=i[a].width||this._settings.columnWidth);for(var r=0;r<t.length;r++)if(t[r]){var o=Math.min(s,Math.round(s*t[r]/e));n=this._setColumnWidth(r,o,!0)||n,s-=i[r].width,e-=t[r]}n&&this._updateColsSizeSettings(!0)}}},_getColumnConfigSize:function(t,e){var i=this._settings.columns[t],s=i.minWidth||this._settings.minColumnWidth;if("header"!=e){var n=this.data.order.length;i.adjustBatch&&i.adjustBatch<n&&(n=i.adjustBatch);for(var a=this.data.order.slice(0,n),r=0;r<n;r++)a[r]=a[r]?this._getValue(this.getItem(a[r]),i,0):"";s=Math.max(s,jt(a,"webix_table_cell webix_cell").width)}if("data"!=e){for(var o=0;o<i.header.length;o++){var l=i.header[o];if(l){var h=0;if(l.rotate)for(var c=0;c<(l.rowspan||1);c++)h+=this._headers[c];var d="webix_table_cell webix_cell "+(l.css||"")+(l.rotate?"webix_measure_rotate":""),u=jt([l.text],d,h);s=Math.max(s,l.rotate?u.height:u.width)}}i.sort&&(s+=10)}return s+=Ot.isIE?vi.layoutPadding.space:0,Math.min(s,i.maxWidth||this._settings.maxColumnWidth||1e5)},_adjustColumn:function(t,e,i){if(t>=0){var s=this._getColumnConfigSize(t,e);return this._setColumnWidth(t,s,i)}},adjustColumn:function(t,e){this._adjustColumn(this.getColumnIndex(t),e)},adjustRowHeight:function(t,e){if(t)this._adjustRowHeight(t,!0);else for(var i=this._settings.columns,s=0;s<i.length;s++)this._adjustRowHeight(i[s].id,!s);this._settings.scrollAlignY=!1,this._settings.fixedRowHeight=!1,e||this.refresh()},_adjustRowHeight:function(t,e){var i,s=this.getColumnConfig(t),n=vt("DIV",{class:"webix_table_cell webix_measure_size webix_cell"},"");n.style.cssText="width:"+s.width+"px; height:1px; visibility:hidden; position:absolute; top:0px; left:0px; overflow:hidden;",this.$view.appendChild(n),n.offsetHeight<1&&(i=this.$view.cloneNode(!0),document.body.appendChild(i),i.appendChild(n)),this.data.each((function(i){var a;n.innerHTML=this._getValue(i,s,0);var r=this._spans_pull;a=r&&r[i.id]&&r[i.id][t]?this._calcSpanAutoHeight(i.id,t,n):n.scrollHeight,a=Math.max(a,this._settings.rowHeight,this._settings.minRowHeight||0),a=Math.min(a,this._settings.maxRowHeight||1e5),i.$height=e?a:Math.max(a,i.$height)}),this),n=wt(n),i&&wt(i)}},Xr={math_setter:function(t){return t&&this._math_init(),t},_math_pref:"$",_math_init:function(){Ot.strict||(this.data.attachEvent("onStoreUpdated",A(this._parse_row_math,this)),this.data.attachEvent("onStoreLoad",A(this._parse_math,this)),this.attachEvent("onStructureLoad",this._parse_math))},_parse_row_math:function(t,e,i){if(t&&"paint"!=i)if("delete"==i)for(var s=0;s<this._columns.length;s++)this._remove_old_triggers(e,this._columns[s].id);else{"add"==i&&this._exprs_by_columns(e);for(var n=0;n<this._columns.length;n++)this._math_recalc={},this._parse_cell_math(t,this._columns[n].id);this._math_recalc={}}},_parse_cell_math:function(t,e){var i,s=this.getItem(t);if((i=s[this._math_pref+e]||s[e])&&i.length>0&&"="===i.toString().substr(0,1)?(s[this._math_pref+e]=i,s[e]=this._calculate(i,t,e)):(void 0!==s[this._math_pref+e]&&delete s[this._math_pref+e],this._remove_old_triggers(s,e)),void 0!==s.depends&&void 0!==s.depends[e])for(var n in s.depends[e]){var a=s.depends[e][n][0]+"__"+s.depends[e][n][1];void 0===this._math_recalc[a]&&(this._math_recalc[a]=!0,this._parse_cell_math(s.depends[e][n][0],s.depends[e][n][1]))}},_set_original_value:function(t,e){var i=this.getItem(t);void 0!==i[this._math_pref+e]&&(i[e]=i[this._math_pref+e])},_parse_math:function(){if(this._columns&&this.count()){this._exprs_by_columns();for(var t=0;t<this._columns.length;t++){var e=this.columnId(t);this.data.each((function(t){this._math_recalc={},this._parse_cell_math(t.id,e)}),this)}this._math_recalc={}}},_exprs_by_columns:function(t){for(var e=0;e<this._columns.length;e++)if(this._columns[e].math){var i=this.columnId(e),s="="+this._columns[e].math;s=s.replace(/\$c/g,"#$c#"),t?(t[i]=this._parse_relative_expr(s,t.id,i),delete t[this._math_pref+i],this._remove_old_triggers(t,i)):this.data.each((function(t){t[i]=this._parse_relative_expr(s,t.id,i),delete t[this._math_pref+i],this._remove_old_triggers(t,i)}),this)}},_parse_relative_expr:function(t,e,i){return le(t)({$r:e,$c:i})},_get_calc_value:function(t,e){var i;if(!this.exists(t))return"#out_of_range";var s=(i=this.getItem(t))[this._math_pref+e]||i[e]||0;return"="!==(s=s.toString()).substring(0,1)?s:(void 0===i[this._math_pref+e]&&(i[this._math_pref+e]=i[e]),i[e]=this._calculate(s,t,e,!0),i[e])},_calculate:function(t,e,i,s){if(!0===s){if(this._in_math_trace(e,i))return"#selfreference"}else this._start_math_trace();this._to_math_trace(e,i);var n=this.getItem(e);t=t.substring(1);var a=this._get_operations(t),r=this._get_refs(t,e);a?(t=this._replace_refs(t,r),t=this._parse_args(t,a)):t=this._replace_refs(t,r,!0);var o=this._math_exception(t);if(!1!==o)return o;this._from_math_trace(e,i),this._remove_old_triggers(n,i);for(var l=0;l<r.length;l++)this._add_trigger([e,i],r[l]);return!1!==(o=this._math_exception(t))?o:t?(t=this._compute(t.replace(/\$r/g,n.id)),!1!==(o=this._math_exception(t))?o:t):t},_get_operations:function(t){return t.replace(/\[[^)]*?\]/g,"").match(/(\+|-|\*|\/)/g)},_get_refs:function(t,e){var i=t.match(/\[([^\]]+),([^\]]+)\]/g);null===i&&(i=[]);for(var s=0;s<i.length;s++){var n=i[s],a=n;(n=(n=n.substr(1,n.length-2)).split(","))[0]=this._trim(n[0]),n[1]=this._trim(n[1]),":"===n[0].substr(0,1)&&(n[0]=this.getIdByIndex(n[0].substr(1))),"$r"===n[0]&&(n[0]=e),":"===n[1].substr(0,1)&&(n[1]=this.columnId(n[1].substr(1))),n[2]=a,i[s]=n}return i},_replace_refs:function(t,e,i){var s="(",n=")";i&&(s=n="");for(var a=0;a<e.length;a++){var r=e[a],o=this._get_calc_value(r[0],r[1]);isNaN(o)&&(o='"'+o+'"'),t=t.replace(r[2],s+o+n)}return t},_parse_args:function(t,e){for(var i=[],s=0;s<e.length;s++){var n=e[s],a=this._split_by(t,n);i.push(a[0]),t=a[1]}i.push(t);for(var r=0;r<i.length;r++){var o=this._trim(i[r]);i[r]=o}for(var l="",h=0;h<i.length-1;h++)l+=i[h]+e[h];return l+i[i.length-1]},_compute:function(t){var e;try{e=D(t)}catch(i){f(!1,"Math error in datatable<br>"+t),e=""}return e.toString()},_split_by:function(t,e){var i=t.indexOf(e);return[t.substr(0,i),t.substr(i+1)]},_trim:function(t){return(t=t.replace(/^ */g,"")).replace(/ *$/g,"")},_start_math_trace:function(){this._math_trace=[]},_to_math_trace:function(t,e){this._math_trace[t+"__"+e]=!0},_from_math_trace:function(t,e){void 0!==this._math_trace[t+"__"+e]&&delete this._math_trace[t+"__"+e]},_in_math_trace:function(t,e){return void 0!==this._math_trace[t+"__"+e]},_add_trigger:function(t,e){var i=this.getItem(e[0]);void 0===i.depends&&(i.depends={}),void 0===i.depends[e[1]]&&(i.depends[e[1]]={}),i.depends[e[1]][t[0]+"__"+t[1]]=t,void 0===(i=this.getItem(t[0])).triggers&&(i.triggers={}),void 0===i.triggers[t[1]]&&(i.triggers[t[1]]={}),i.triggers[t[1]][e[0]+"__"+e[1]]=e},_remove_old_triggers:function(t,e){if(t&&void 0!==t.triggers)for(var i in t.triggers[e]){var s=t.triggers[e][i],n=this.getItem(s[0]);n&&delete n.depends[s[1]][t.id+"__"+e]}},_math_exception:function(t){var e=t.match(/#\w+/);return null!==e&&e.length>0&&e[0]}},Jr={headermenu_setter:function(t){return t&&(t.data&&(this._preconfigured_hmenu=!0),t=this._init_hmenu_once(t)),t},_init_hmenu_once:function(i){var s={view:"contextmenu",template:"<span class='webix_icon webix_list_icon {common.hidden()}'></span> &nbsp; #value#",type:{hidden:function(t){return t.hidden?"wxi-eye-slash":"wxi-eye"}},on:{onMenuItemClick:A((function(t){var s=ke(this._settings.headermenu),n=s.getItem(t).hidden;s.getItem(t).hidden=!n,s.refresh(t),s.$blockRender=!0;var a={spans:"object"==e(i)&&i.spans};return n?this.showColumn(t,a):this.hideColumn(t,a),s.$blockRender=!1,!1}),this)},data:[]};"object"==e(i)&&t.extend(s,i,!0);var n=be(s);return n.attachTo(this._header),this._destroy_with_me.push(n),this.attachEvent("onStructureLoad",this._generate_menu_columns),this.attachEvent("onStructureUpdate",this._generate_menu_columns),this._init_hmenu_once=function(t){return t},n._settings.id},_generate_menu_columns:function(){var t=ke(this._settings.headermenu),e=this._hidden_column_hash;if(!t.$blockRender){if(this._preconfigured_hmenu)return t.data.each((function(t){t.hidden=!!e[t.id]})),void t.refresh();var i=[],s=this._hidden_column_order;s.length||(s=this._columns);for(var n=0;n<s.length;n++){var a=this.getColumnConfig(s[n].id||s[n]),r=a.header[0],o=!!e[a.id];!1!==a.headermenu&&r&&i.push({id:a.id,value:o?r.text:r.groupText||r.text,hidden:o})}i.length&&t.data.importData(i)}}};Hn.headerMenu={getValue:function(){},setValue:function(){},refresh:function(t,e){t._settings.headermenu||(t.define("headermenu",!0),t._generate_menu_columns()),e.onclick=function(){ke(t.config.headermenu).show(e)}},render:function(){return"<span class='webix_icon wxi-columns' role='button' tabindex='0' aria-label='"+R.aria.headermenu+"'>"}};var Zr={_get_editor_type:function(t){return this.getColumnConfig(t.column).editor},getEditor:function(t,e){return t?(1==arguments.length&&(e=t.column,t=t.row),(this._editors[t]||{})[e]):this._last_editor},_for_each_editor:function(t){for(var e in this._editors){var i=this._editors[e];for(var s in i)"$count"!=s&&t.call(this,i[s])}},_init_editor:function(t,e,i){var s=t.row,n=t.column,a=e.config=this.getColumnConfig(n);!1!==i&&this.showCell(s,n);var r=e.render();e.$inline&&(r=this._locateInput(t)),e.node=r;var o,l=this.getItem(s),h=a.editFormat;return this._settings.editMath&&(o=l["$"+n]),E(o=o||l[n])&&(o=""),e.setValue(h?h(o):o,l),e.value=l[n],this._addEditor(t,e),e.getPopup&&(e.getPopup()._editorMaster=this._settings.id),e.$inline||(e._editor_pos=this._sizeToCell(t,r,!0)),e.afterRender&&e.afterRender(),this._settings.liveValidation&&(_e(e.node,"keyup",this._bind_live_validation(t,this)),this.validateEditor(t)),r},_bind_live_validation:function(t,e){return function(){e.validateEditor(t)}},_get_new_value:function(t){var e=this.getColumnConfig(t.column).editParse,i=t.getValue();return e?e(i):i},_set_new_value:function(t,e,i){var s=i?{}:this.getItem(t.row);return s[t.column]=e,this._settings.editMath&&(s["$"+t.column]=null),s},_addEditor:function(t,e){var i=this._editors[t.row]=this._editors[t.row]||{};i.$count=(i.$count||0)+1,e.row=t.row,e.column=t.column,this._last_editor=i[t.column]=e,this._in_edit_mode++,this._last_editor_scroll=this.getScrollState()},_removeEditor:function(t){this._last_editor==t&&(this._last_editor=0),t.destroy&&t.destroy();var e=this._editors[t.row];delete e[t.column],e.$count--,e.$count||delete this._editors[t.row],this._in_edit_mode--},_changeEditorId:function(t,e){var i=this._editors[t];if(i)for(var s in this._editors[e]=i,delete this._editors[t],i)"$count"!=s&&(i[s].row=e)},_locate_cell:function(t){var e,i,s,n,a,r=this.getColumnConfig(t.column),o=0;if(r&&r.node&&r.attached){if(s=this.getIndexById(t.row),this._spans_pull&&this.getSpan(t.row,t.column))for(i=0;i<3;i++)for(e=this._spans_areas[i],n=0;!o&&n<e.childNodes.length;n++)(a=e.childNodes[n]).getAttribute("row")==s&&a.getAttribute("column")==this.getColumnIndex(t.column)&&(o=a);!o&&s>=r._yr0-this._settings.topSplit&&s<r._yr1&&(o=r.node.childNodes[s-r._yr0+this._settings.topSplit])}return o},editCell:function(t,e,i,s){return e=e||this._settings.columns[0].id,ss.edit.call(this,{row:t,column:e},i,s)},editRow:function(t){t&&t.row&&(t=t.row);var e=!1;this.eachColumn((function(i){this.edit({row:t,column:i},e,!e),e=!0}))},editColumn:function(t){t&&t.column&&(t=t.column);var e=!1;this.eachRow((function(i){this.edit({row:i,column:t},e,!e),e=!0}))},eachRow:function(t,e){var i=this.data.order;e&&(i=this.data._filter_order||i);for(var s=0;s<i.length;s++)t.call(this,i[s])},eachColumn:function(t,e){var i=this._hidden_column_order;if(e&&i.length)for(var s=0;s<i.length;s++){var n=this.getColumnConfig(i[s]);t.call(this,n.id,n)}else for(var a=[].concat(this._columns),r=0;r<a.length;r++){var o=a[r];t.call(this,o.id,o)}},_after_edit_next:function(t){if(this.getSelectedId&&1==this.getSelectedId(!0).length)return this._select(t),!1},_custom_tab_handler:function(t,e){if(this._settings.editable&&!this._in_edit_mode){if(e.target&&"INPUT"==e.target.tagName)return!0;var i=this.getSelectedId(!0);if(1==i.length){var s=i[0];return"row"==this._settings.select&&(s.column=this._settings.columns[e.shiftKey?0:this._settings.columns.length-1].id),this.editNext(t,s),!1}}return!0},_find_cell_next:function(t,e,i){var s=this.getIndexById(t.row),n=this.getColumnIndex(t.column),a=this.data.order,r=this._columns;if(i)for(var o=s;o<a.length;o++){for(var l=n+1;l<r.length;l++){var h={row:a[o],column:r[l].id};if(e.call(this,h)&&(!this._checkCellMerge||!this._checkCellMerge(t,h)))return h.toString=this._id_to_string,h}n=-1}else for(var c=s;c>=0;c--){for(var d=n-1;d>=0;d--){var u={row:a[c],column:r[d].id};if(e.call(this,u))return u.toString=this._id_to_string,u}n=r.length}return null},_correct_after_focus_y:function(){if(this._in_edit_mode){var t=this._body.childNodes[1].firstChild.scrollTop;t&&(this._y_scroll.scrollTo(this.getScrollState().y+t),this._body.childNodes[1].firstChild.scrollTop=0)}},_correct_after_focus:function(){if(this._in_edit_mode){var t=this._body.childNodes[1],e=t.scrollTop,i=t.scrollLeft;if(this._ignore_after_focus_scroll)return this._ignore_after_focus_scroll=!1;this._settings.prerender&&this._y_scroll.scrollTo(e),this._x_scroll.scrollTo(i),this._touch_scroll&&(e&&(this._body.childNodes[1].scrollTop=0),i&&(this._body.childNodes[1].scrollLeft=0),this._ignore_after_focus_scroll=e||i)}},_component_specific_edit_init:function(){var t=this;this.attachEvent("onScrollY",this._update_editor_y_pos),this.attachEvent("onScrollX",this._update_editor_y_pos),this.attachEvent("onScrollY",this._refocus_inline_editor),this.attachEvent("onColumnResize",(function(){this.editStop()})),this.attachEvent("onAfterFilter",(function(){this.editStop()})),this.attachEvent("onRowResize",(function(){this.editStop()})),this.attachEvent("onAfterScroll",(function(){this._settings.topSplit&&this.editStop()})),this._body.childNodes[1].onscroll=function(){return t._correct_after_focus()},this._settings.prerender||(this._body.childNodes[1].firstChild.onscroll=function(){return t._correct_after_focus_y()})},_update_editor_y_pos:function(){if(this._in_edit_mode){var t=this._last_editor_scroll;this._last_editor_scroll=this.getScrollState();var e=this._last_editor_scroll.y-t.y;this._for_each_editor((function(t){if(t.getPopup){var i=this.getItemNode(t),s=!1;if(this._settings.prerender){var n=t._editor_pos,a=n.top-this._scrollTop,r=n.left-this._scrollLeft;s=a<0||a+n.height>this._dtable_offset_height||r<0||r+n.width>this.$width-this._scrollSizeX}!i||s?t.getPopup().show({x:-1e4,y:-1e4}):t.getPopup().show(i)}this._settings.prerender||t.linkInput||t.$inline||(t.node.top-=e,t.node.style.top=t.node.top+"px")}))}}},Qr={$init:function(){this._clear_hidden_state(),this.attachEvent("onStructureLoad",this._hideInitialColumns)},_clear_hidden_state:function(){this._hidden_column_hash={},this._hidden_column_order=O(),this._hidden_split=[0,0,0]},_hideInitialColumns:function(){for(var t=this._columns,e=0;e<t.length;e++)t[e].header&&this._getInitialSpans(t,t[e].header),t[e].footer&&this._getInitialSpans(t,t[e].footer);for(var i=t.length-1;i>=0;i--)(t[i].hidden||t[i].batch&&this.config.visibleBatch&&t[i].batch!=this.config.visibleBatch)&&this.hideColumn(t[i].id,{},!0,!0)},_getInitialSpans:function(t,e){for(var i=0;i<e.length;i++){var s=e[i];s&&s.colspan&&!s.$colspan&&(s.$colspan=s.colspan)}},moveColumn:function(t,e){this._moveColumn(t,e)},_moveColumn:function(t,e,i){var s,n=this.getColumnIndex(t);if(n==e||-1==n)return!1;if(!E(i)){if(!this._check_source_span(n,e,i))return!1;if(s=this._get_span_columns(n,i,e),e+=this._get_target_span_shift(n,e),s)for(var a=0;a<s.length;a++){var r=n>e?a:0,o=s[a];this.getColumnIndex(o)<0&&a>0?this._moveHiddenSpanColumn(o,s[0],a):this._changeColumnIndex(s[a],e+r,i)}}s||this._changeColumnIndex(t,e,i),this._refresh_columns()},_changeColumnIndex:function(t,e,i){var s,n=this.getColumnIndex(t),a=this._hidden_column_order,r=this._settings.columns,o=r[n].header;if(!E(i)&&o&&o[i]){for(var l=o[i].colspan||1,h=!1,c=0;c<o.length;c++)if(c!=i&&o[c]&&o[c].colspan){var d=o[c];if(d.colspan>l){var u=r[n+l];u.batch&&!r[n].batch&&(h=!0,r[n].batch=u.batch,delete u.batch),u.header[c]=d}}for(var _=e==r.length?e-1:e,p=r[_].header,f=0;f<p.length;f++){var g=p[f]?p[f].colspan:1;f!=i&&g>1&&n>_&&n<_+g&&(h||!r[n].batch||r[_].batch||(r[_].batch=r[n].batch,delete r[n].batch),o[f]=p[f])}}var m=r.splice(n,1)[0];a.length&&(s=a.find(t),a.removeAt(s)),this._updateSplit(n,s,-1);var v,b=e-(e>n?1:0);if(L.insertAt.call(r,m,b),a.length){v=0;var w=r[b-1];if(w&&w.id){var y=w.id;v=this._getHiddenColumnIndex(y);do{y=a[v+=1]}while(this.getColumnIndex(y)<0&&v<a.length)}a.insertAt(m.id,v)}this._updateSplit(b,v,1)},_moveHiddenSpanColumn:function(t,e,i){var s=this._hidden_column_order,n=this._getHiddenColumnIndex(t);s.removeAt(n),this._updateSplit(-1,n,-1);var a=this._getHiddenColumnIndex(e)+i;s.insertAt(t,a),this._updateSplit(-1,a,1)},_check_source_span:function(t,e,i){e>t&&e--;for(var s=(this._columns[t].header[i].colspan||1)-1,n=0;n<this._columns.length;n++)for(var a=this._columns[n].header,r=0;r<a.length;r++)if(n!=t||r!=i){var o=a[r]&&a[r].colspan||1,l=n+o-1;if(o>1&&n<=t&&l>=t+s&&(n>e||l<e))return!1}return!0},_get_target_span_shift:function(t,e){for(var i=0;i<this._columns.length;i++)for(var s=this._columns[i].header,n=0;n<s.length;n++)if(i!=t){var a=s[n]&&s[n].colspan;if(a){var r=i+a-1;if(i<e&&r>=e&&(i>t||r<t))return(t>e?i:r+1)-e}}return 0},_get_span_columns:function(t,e){for(var i,s=this._columns[t].header,n=s[e].colspan||1,a=0;a<s.length;a++)s[a]&&s[a].$colspan&&s[a].$colspan>s[a].colspan&&(n=Math.max(n,s[a].$colspan));if(n>1){var r=this.columnId(t);i=[r];for(var o=this._getHiddenColumnIndex(r),l=o+1;l<o+n;l++)i.push(this._getHiddenColumnId(l))}return i},_init_horder:function(t,e){if(!t.length){for(var i=0;i<e.length;i++)t[i]=e[i].id;this._hidden_split=[this._settings.leftSplit,this._rightSplit,this._settings.rightSplit]}},isColumnVisible:function(t){return!this._hidden_column_hash[t]},hideColumn:function(t,e,i,s){var n,a=this._settings.columns,r=this._hidden_column_order,o=this._hidden_column_hash,l=1;if(e=e||{},!1!==s){var h=this.getColumnIndex(t);if(f(-1!=h,"hideColumn: invalid ID or already hidden"),-1==h||!this.callEvent("onBeforeColumnHide",[t]))return;if(this._init_horder(r,a),e.spans)for(var c=a[h].header,d=0;d<c.length;d++)c[d]&&(l=Math.max(l,c[d].colspan||1));this._fixSplit(h,l,-1);for(var u=h+l-1;u>=h;u--)this._hideColumn(h),o[(n=a.splice(h,1)[0]).id]=n,n._yr0=-1,n.hidden=!0,delete this._columns_pull[n.id];this.callEvent("onAfterColumnHide",[t])}else{if(f(n=o[t],"showColumn: invalid ID or already visible"),!n||!this.callEvent("onBeforeColumnShow",[t]))return;for(var _=null,p=0,g=0;g<r.length;g++){if(r[g]==t){p=g;break}o[r[g]]||(_=r[g])}if(e.spans)for(var m=n.header,v=0;v<m.length;v++)m[v]&&(m[v].colspan=m[v].$colspan||m[v].colspan,l=Math.max(l,m[v].colspan||1));for(var b=_?this.getColumnIndex(_)+1:0,w=p+l-1;w>=p;w--){var y=o[r[w]];y?(L.insertAt.call(a,y,b),delete y.hidden,delete o[y.id],this._columns_pull[y.id]=y):l--}this._fixSplit(p,l,1,!0),this.callEvent("onAfterColumnShow",[t])}n.header&&this._fixColspansHidden(n,!1!==s?0:1,"header"),n.footer&&this._fixColspansHidden(n,!1!==s?0:1,"footer"),r.length===a.length&&this._clear_hidden_state(),i||this._refresh_columns()},showColumn:function(t,e,i){return this.hideColumn(t,e,i,!1)},_fixSplit:function(t,e,s,n){var a=i(n?this._hidden_split:[this._settings.leftSplit,this._rightSplit],2),r=a[0],o=a[1];t<r&&(this._settings.leftSplit+=s*e),t>=o?this._settings.rightSplit+=s*e:this._rightSplit+=s*e},_updateSplit:function(t,e,i){t>=0&&(t<this._settings.leftSplit&&(this._settings.leftSplit+=i),this._settings.rightSplit&&t>=this._rightSplit?this._settings.rightSplit+=i:this._rightSplit+=i),this._hidden_column_order.length&&e>=0&&(e<this._hidden_split[0]&&(this._hidden_split[0]+=i),this._hidden_split[2]&&e>=this._hidden_split[1]?this._hidden_split[2]+=i:this._hidden_split[1]+=i)},_fixColspansHidden:function(t,e,i){for(var s=t[i].length-1;s>=0;s--)for(var n,a=this._hidden_column_order,r=!1,o=0,l=0;l<a.length;l++){var h=this.getColumnConfig(a[l]),c=h[i][s];this.isColumnVisible(a[l])?(r&&o>0&&n&&n.colspan>0?n=c=h[i][s]=n:c&&c.$colspan&&o<=0&&(o=c.colspan=c.$colspan,n=c),r=null):(c&&c.$colspan&&o<=0&&(o=c.colspan=c.$colspan,r=n=c),n&&o>0&&n.colspan--),o--}},refreshColumns:function(t){this._dtable_column_refresh=!0,t&&(this._clear_hidden_state(),this._filter_elements={}),this._columns_pull={};for(var e=0;e<this._columns.length;e++){var i=this._columns[e];this._columns_pull[i.id]=i,i.attached=i.node=null}for(var s=0;s<3;s++)this._header.childNodes[s].innerHTML="",this._body.childNodes[s].firstChild.innerHTML="";this._columns=this.config.columns=t||this.config.columns,this._rightSplit=this._columns.length-(this.config.rightSplit||0),this._dtable_fully_ready=0,this._define_structure(),this._update_scroll(),this.callEvent("onStructureUpdate"),this.render(),this._dtable_column_refresh=!1},_refresh_columns:function(){this._dtable_fully_ready=0,this.callEvent("onStructureUpdate"),this._apply_headers(),this.render()},showColumnBatch:function(t,e,i){var s=!E(e);e=!1!==e;var n=[];this.eachColumn((function(i,a){if(a.batch){var r=this._hidden_column_hash[a.id];e||(r=!r),a.batch==t&&r?this.hideColumn(a.id,{spans:!0},!0,!e):s||a.batch==t||r||this.hideColumn(a.id,{spans:!0},!0,e)}if(s&&e)for(var o=a.header,l=0;l<o.length;l++)o[l]&&o[l].batch&&o[l].closed&&n.push(o[l].batch)}),!0);for(var a=0;a<n.length;a++)n[a]!=t&&this.showColumnBatch(n[a],!1,!0);i||this._refresh_columns()},_getHiddenColumnIndex:function(t){if(this._hidden_column_order.length){for(var e=0;e<this._hidden_column_order.length;e++)if(this._hidden_column_order[e]==t)return e;return-1}return this.getColumnIndex(t)},_getHiddenColumnId:function(t){return this._hidden_column_order.length?this._hidden_column_order[t]:this.columnId(t)}},to={$init:function(t){this.attachEvent("onAfterScroll",this._set_focusable_item),this.attachEvent("onFocus",(function(){Dt(this.$view,"webix_dtable_focused")})),this.attachEvent("onBlur",(function(){Et(this.$view,"webix_dtable_focused")})),"column"!=t.select&&(this.open||this._subViewStorage)&&this.attachEvent("onEnter",(function(){var t=this.getSelectedId(!0);if(!(1!=t.length||this.getEditor&&this.getEditor())){var e=this.getItemNode(t[0]);t=t[0].row,("row"==this.config.select||e.querySelector(".webix_tree_open")||e.querySelector(".webix_tree_close"))&&(this.isBranchOpen(t)?this.close(t):this.open(t))}}))},_set_focusable_item:function(){if(!this._getVisibleSelection()){var t=this._dataobj.querySelector(".webix_cell");t&&t.setAttribute("tabindex","0")}},_getVisibleSelection:function(){for(var t=this.getSelectedId(!0),e=0;e<t.length;e++)if(t[e].column&&this.isColumnVisible(t[e].column))return this.getItemNode(t[e]);return null},moveSelection:function(e,i,s){if(!this._settings.disabled){i=i||{};var n=this.getSelectedId(!0),a=n.length-1,r=!(!this._settings.multiselect&&!this._settings.areaselect)&&i.shift;if(n.length>1&&"cell"!==this._settings.select&&(n=n.sort(A((function(t,e){return this.getIndexById(t.row)>this.getIndexById(e.row)||this.getColumnIndex(t.column)>this.getColumnIndex(e.column)?1:-1}),this)),"up"!=e&&"left"!=e&&"top"!=e&&"pgup"!=e||(a=0)),a<0&&this.count()){if("down"==e||"right"==e)e="top";else{if("up"!=e&&"left"!=e)return;e="bottom"}a=0,n=[{row:1,column:1}]}if(a>=0){var o=n[a].row,l=n[a].column,h={};if(this._delayRender(!1!==s&&h),"top"==e||"bottom"==e)o&&("top"==e?o=this.data.getFirstId():"bottom"==e&&(o=this.data.getLastId())),l&&(a=0,"bottom"==e&&(a=this.config.columns.length-1),l=this.columnId(a));else if(1!=n.length||!i.ctrl||i.shift||"up"!=e&&"down"!=e&&"left"!=e&&"right"!=e)if("up"==e||"down"==e||"pgup"==e||"pgdown"==e){if(o){var c=this.getIndexById(o),d=1;"pgup"!=e&&"pgdown"!=e||(d=this._pager?this._pager.config.size:this.getVisibleCount()),"up"==e||"pgup"==e?c-=d:"down"!=e&&"pgdown"!=e||(c+=d),c<0&&(c=0),c>=this.data.order.length&&(c=this.data.order.length-1),i.step=d,!(o=this.getIdByIndex(c))&&this._settings.pager&&this.showItemByIndex(c)}}else{if("right"!=e&&"left"!=e)return void f(!1,"Not supported selection moving mode");if(l&&"row"!=this.config.select){var u=this.getColumnIndex(l);"right"==e?u++:"left"==e&&u--,u<0&&(u=0),u>=this.config.columns.length&&(u=this.config.columns.length-1),l=this.columnId(u)}else{if((this.open||this._subViewStorage)&&"right"==e)return this.open?this.open(o):this.openSub(o);if((this.close||this._subViewStorage)&&"left"==e)return this.close?this.close(o):this.closeSub(o)}}else{var _=this._getNextCtrlSelection(n[0],e);o=_.row,l=_.column}if(o)if(h.row=o,h.column=l,this.callEvent("onMoveSelection",[h,e,i]),this.showCell(h.row,h.column),this.select||(t.extend(this,this._selections._commonselect,!0),this._settings.select=this.open||this._subViewStorage?"row":"cell",t.extend(this,this._selections[this._settings.select],!0)),h.row=o,h.column=l,r&&"area"==this._settings.select){var p=this._selected_areas[this._selected_areas.length-1];this._extendAreaRange(h,p,e,i)}else this._select(h,r)}return!1}},_getNextCtrlSelection:function(t,e){for(var i,s,n,a=t.row,r=t.column,o="up"==e||"left"==e?-1:1,l="up"==e||"down"==e,h=l?this.data.order:this._columns.map((function(t){return t.id})),c=l?a:r,d=l?this.getIndexById(a):this.getColumnIndex(r),u=o>0?h.length-1:0;!n&&h[d];){var _=h[d],p=l?_:a,f=l?r:_,g=this.$getExportValue?this.$getExportValue(p,f,{}):this.getItem(p)[f];_!=c&&i&&g?n=_:g||(s&&s!=c&&(n=s),i=_),d!=u||n||(n=_),s=g?_:null,d+=o}return l?{row:n,column:r}:{row:a,column:n}}},eo={_set_drop_area:function(t){for(var e=0;e<this._columns.length;e++){var i=this._columns[e],s=this.getItemNode({row:t,cind:e});s?s.parentNode.insertBefore(Ai._dropHTML[e],s):i.node.appendChild(Ai._dropHTML[e])}},_init_drop_area:function(){var t=[],e=this._columns.length,i=document.createElement("div");i.className="webix_drop_area",i.style.height=this._settings.rowHeight+"px",i.innerHTML=this.$dropHTML();for(var s=0;s<e;s++)t.push(i.cloneNode(!0));return t}},io={drag_setter:function(e){return this.attachEvent("onBeforeDrag",(function(t){return this._checkDragTopSplit(t.source)})),this.attachEvent("onBeforeDragIn",(function(t){var e=this._checkDragTopSplit(t.target);return!e&&Ai._dropHTML&&(wt(Ai._dropHTML),this._marked_item_id=Ai._dropHTML=null),e})),Xi.drag_setter.call(this,e),"order"!=e&&"move"!=e||t.extend(this,eo,!0),e},_add_css:function(t,e,i){var s=Ai._drag_context;this._settings.prerender||i||(t=[s.start]);for(var n=0;n<t.length;n++){for(var a=0;a<this._columns.length;a++){var r=this.getItemNode({row:t[n],cind:a});r&&Dt(r,e)}this.data.addMark(t[n],e,1,1,!0)}},_remove_css:function(t,e,i){var s=Ai._drag_context;this._settings.prerender||i||(t=[s.start]);for(var n=0;n<t.length;n++){for(var a=0;a<this._columns.length;a++){var r=this.getItemNode({row:t[n],cind:a});r&&Et(r,e)}this.data.removeMark(t[n],e,1,!0)}},_checkDragTopSplit:function(t){var e,i,s=!1;if(this._settings.topSplit&&t)for(B(t)||(t=[t]),e=0;!s&&e<t.length;e++)s=(i=this.getIndexById(t[e]))>=0&&i<this._settings.topSplit;return!s},_toHTML:function(t){for(var e="<div class='webix_dd_drag' style='width:"+(this._content_width-this._scrollSizeY)+"px;'>",i=this._settings.columns,s=0;s<i.length;s++){var n=this._getValue(t,i[s]);e+="<div style='width:"+i[s].width+"px;'>"+n+"</div>"}return e+"</div>"},getHeaderNode:function(t,e){return this._getHeaderNode(t,e,this._header)},getFooterNode:function(t,e){return this._getHeaderNode(t,e,this._footer)},_getHeaderNode:function(t,e,i){if(this.isColumnVisible(t)){var s=this.getColumnIndex(t),n=this._settings.leftSplit>s?0:this._rightSplit<=s?2:1;e=e||0;return i.childNodes[n].querySelector("div[".concat("column",'="').concat(s,'"][').concat("row",'="').concat(e,'"]'))}return null},getItemNode:function(t){if(t&&!t.header){var e=t.row||t,i="number"==typeof t.rind?t.rind:this.getIndexById(e),s=this._get_y_range(),n=s[0]-this._settings.topSplit;if(i<n&&i>s[1])return;var a=this._get_x_range(),r=this._settings.leftSplit?0:a[0],o="number"==typeof t.cind;if((t.column||o)&&(r=o?t.cind:this.getColumnIndex(t.column))<this._rightSplit&&r>=this._settings.leftSplit&&(r<a[0]||r>a[1]))return;var l=this._settings.columns[r];if(l&&l.attached&&l.node){if("$webix-drop"===e)return Ai._dropHTML[r];for(var h=i<this._settings.topSplit||this._settings.prerender?i:i-n,c=l.node.childNodes,d=Math.min(c.length,h+1),u=0;u<d;u++)"webix_drop_area"===c[u].className&&h++;return c[h]}}},_isDraggable:function(t){var e=t.target.nodeName;return"INPUT"!=e&&"TEXTAREA"!=e},_getColumnDragText:function(t,e){for(var i=this.getColumnConfig(t).header,s=i[e]?i[e].text:null,n=0;!s&&n<i.length;n++)i[n]&&i[n].text&&(s=i[n].text);return s||"&nbsp;"},dragColumn_setter:function(e){var i;return"order"==e?i={$drag:A((function(t,e,s){if(!this._isDraggable(e)||this._rs_process)return!1;var n=this.locate(e);if(!n||!this.callEvent("onBeforeColumnDrag",[n.column,e]))return!1;Ai._drag_context={from:i,start:n,custom:"column_dnd"};var a=this.getColumnConfig(n.column);if("touch"===s){var r=this.getHeaderNode(n.column,n.rind);this._relative_column_drag={x:$t(e).x-kt(r).x}}else this._relative_column_drag=Ct(e);return this._limit_column_drag=a.width,this._auto_scroll_force=!0,"<div class='webix_dd_drag_column' style='width:"+a.width+"px'>"+this._getColumnDragText(n.column,n.rind)+"</div>"}),this),$dragPos:A((function(t,e,i){var s=this,n=Ai.getContext(),a=kt(this.$view);i.style.display="none";var r=document.elementFromPoint(t.x,a.y+this._settings.headerRowHeight/2),o=r?this.locate(r):null,l=n.start.column;if(o&&o.column!=l&&(!this._column_dnd_temp_block||o.column!=this._last_sort_dnd_node)&&"column_dnd"==n.custom&&ke(r)==this){if(!this.callEvent("onBeforeColumnDropOrder",[l,o.column,e]))return;var h=this.getColumnIndex(l),c=this.getColumnIndex(o.column);e.touches&&(this._dragTarget=e.target,this._dragTarget.style.display="none",this.$view.parentNode.appendChild(this._dragTarget)),this._moveColumn(l,c+(h<c?1:0),n.start.rind),this._last_sort_dnd_node=o.column,this._column_dnd_temp_block=!0}if(o&&o.column==l&&(this._column_dnd_temp_block=!1),i.style.display="block",t.x=t.x-this._relative_column_drag.x,t.y=a.y,t.x<a.x)t.x=a.x;else{var d=a.x+this.$view.offsetWidth-this._scrollSizeY-this._limit_column_drag;t.x>d&&(t.x=d)}Ai._skip=!0,this._auto_scroll_delay&&(this._auto_scroll_delay=window.clearTimeout(this._auto_scroll_delay)),!1!==this._settings.dragscroll&&(this._auto_scroll_delay=j((function(t){return s._auto_scroll_column(t)}),this,[$t(e)],250))}),this),$dragDestroy:A((function(t,e){this._auto_scroll_force=null,this._auto_scroll_delay&&(this._auto_scroll_delay=window.clearTimeout(this._auto_scroll_delay)),wt(e),this._dragTarget&&wt(this._dragTarget);var i=Ai.getContext().start;this.callEvent("onAfterColumnDropOrder",[i.column,this._last_sort_dnd_node,t])}),this),$drop:function(){}}:e&&(i={_inner_drag_only:!0,$drag:A((function(t,e){if(!this._isDraggable(e)||this._rs_process)return!1;var s=this.locate(e);return!(!s||!this.callEvent("onBeforeColumnDrag",[s.column,e]))&&(Ai._drag_context={from:i,start:s,custom:"column_dnd"},this._auto_scroll_force=!0,"<div class='webix_dd_drag_column'>"+this._getColumnDragText(s.column,s.rind)+"</div>")}),this),$drop:A((function(t,e,i){var s=i;i.touches&&this._drag_column_last&&(s=this._drag_column_last);var n=this.locate(s);if(!n)return!1;var a=Ai.getContext().start,r=a.column;if(r!=n.column){if(!this.callEvent("onBeforeColumnDrop",[r,n.column,i]))return;var o=this.getColumnIndex(r),l=this.getColumnIndex(n.column);this._moveColumn(r,l+(o<l?1:0),a.rind),this.callEvent("onAfterColumnDrop",[r,n.column,i])}}),this),$dragIn:A((function(t,e,s){var n=this,a=Ai.getContext();if("column_dnd"!=a.custom||a.from!=i)return!1;for(var r=s.target;-1==(r.className||"").indexOf("webix_hcell");)if(!(r=r.parentNode))return;return this._auto_scroll_delay&&(this._auto_scroll_delay=window.clearTimeout(this._auto_scroll_delay)),!1!==this._settings.dragscroll&&(this._auto_scroll_delay=j((function(t){return n._auto_scroll_column(t)}),this,[$t(s)],250)),r!=this._drag_column_last&&(this._drag_column_last&&Et(this._drag_column_last,"webix_dd_over_column"),Dt(r,"webix_dd_over_column")),this._drag_column_last=r}),this),$dragDestroy:A((function(t,e){this._auto_scroll_force=null,this._auto_scroll_delay&&(this._auto_scroll_delay=window.clearTimeout(this._auto_scroll_delay)),this._drag_column_last&&Et(this._drag_column_last,"webix_dd_over_column"),wt(e)}),this)}),e&&(Ai.addDrag(this._header,i),Ai.addDrop(this._header,i,!0),this.attachEvent("onDestruct",(function(){return Ai.unlink(i)})),this._auto_scroll||t.extend(this,ce,!0)),e}},so={clearValidation:function(){for(var t in this.data._marks)this._clear_invalid_css(t);this.data.clearMark("webix_invalid",!0)},_mark_invalid:function(t,e){for(var i in this._clear_invalid_css(t),e)this.addCellCss(t,i,"webix_invalid_cell");this.addCss(t,"webix_invalid")},_clear_invalid:function(t){this._clear_invalid_css(t),this.removeCss(t,"webix_invalid")},_clear_invalid_css:function(t){var e=this.data.getMark(t,"$cellCss");if(e)for(var i in e)e[i]=e[i].replace(/(\s|^)webix_invalid_cell(\s|$)/,(function(t,e,i){return e&&i?" ":""}))},addRowCss:function(t,e,i){this.addCss(t,e,i)},removeRowCss:function(t,e,i){this.removeCss(t,e,i)},addCellCss:function(t,e,i,s){var n,a=this.data.getMark(t,"$cellCss"),r=a||{},o=new RegExp("\\b"+i+"\\b"),l=r[e]||"";l&&o.test(l)||(r[e]=l?l.trim()+" "+i:i,a||this.data.addMark(t,"$cellCss",!1,r,!0),n=!0);var h=this._getCellSpan(t,e);!h||h[3]&&o.test(h[3])||(h[3]=h[3]?h[3].trim()+" "+i:i,n=!0),!s&&n&&this.refresh(t)},removeCellCss:function(t,e,i,s){var n=this.data.getMark(t,"$cellCss");if(n){var a=n[e]||"",r=new RegExp("(\\s|^)"+i+"(\\s|$)");a&&(n[e]=a.replace(r,(function(t,e,i){return e&&i?" ":""})));var o=this._getCellSpan(t,e);o&&o[3]&&(o[3]=o[3].replace(r,(function(t,e,i){return e&&i?" ":""}))),s||this.refresh(t)}},_getCellSpan:function(t,e){return this.config.spans&&this._spans_pull[t]&&this._spans_pull[t][e]}},no={_prePrint:function(t,e){if(t.scroll&&!e)return!0;t.header=E(t.header)?!!this.config.header:t.header,t.footer=E(t.footer)?!!this.config.footer:t.footer,t.xCorrection=t.xCorrection||0},_findIndex:function(t,e){for(var i=-1,s=0;i<0&&s<t.length;s++)e(t[s])&&(i=s);return i},_getTableHeader:function(t,e,i){var s=this,n={},a=0;return t.forEach((function(r,o){var l=r[0],h=[],c=l.length;l.forEach((function(t,r){for(var l=e[r+a],d=0;d<l[i].length;d++){var u=l[i][d];if(u||n[o]&&n[o][d]){if(u=I(u||{text:""}),n[o]&&n[o][d]&&0===r&&(u.colspan=n[o][d],n[o][d]=0),u.colspan){var _=Math.min(u.colspan,c-r);n[o+1]=n[o+1]||{},n[o+1][d]=u.colspan-_,u.colspan=_}u.rowspan&&(u.height=(u.height||s.config.headerRowHeight)*u.rowspan,u.rowspan=null);var p={txt:u.rotate?s.getHeaderNode(l.id,d).innerHTML:u.text||(u.contentId?s.getHeaderContent(u.contentId).getValue():""),className:"webix_hcell webix_"+i+"_cell "+(u.css||""),style:{height:(u.height||s.config.headerRowHeight)+"px",width:u.colspan?"auto":l.width+"px"},span:u.colspan||u.rowspan?{colspan:u.colspan||1,rowspan:u.rowspan||1}:null};h[d]=h[d]||[],h[d][r]=p}}})),t[o]="header"==i?h.concat(r):r.concat(h),a+=c})),t},_getTableArray:function(t,e,i){var s=this,n=this.config.columns,a=this.getSelectedId(!0),r="page"==t.fit?1/0:this._getPageWidth(t),o=0,l=0,h=[],c=0,d=[];i=i||0+t.xCorrection,e=e||[];var u=this._spans_pull,_={};if(u)for(var p in u)for(var f in u[p])for(var g=u[p][f],m=this.data._filter_order,v=this._hidden_column_order,b=m?m.find(p):this.getIndexById(p),w=v.length?v.find(f):this.getColumnIndex(f),y={rowspan:0,colspan:0,css:g[5]||""},x=!0,k=b;k<b+g[1];k++)if(this.getIdByIndex(k)){y.rowspan++;for(var C=w;C<w+g[0];C++)this.columnId(C)&&(x&&y.colspan++,_[k]||(_[k]={}),y.$ready?_[k][C]={$inspan:!0}:(_[k][C]=y,y.$ready=!0));x=!1}return this.eachRow((function(e){for(var p=0,f=s.getItem(e),g=s.getIndexById(e),m=[],v=!1,b=i;b<n.length;b++){var w=n[b].id,y=s.getColumnIndex(w)-i;if(n[b]){if(p+=n[b].width,0===g&&d.push(n[b].width),p>r&&b>i){c=b;break}if("selection"!==t.data||"selection"==t.data&&-1!==s._findIndex(a,(function(t){return t.column==w&&t.row==e}))){var x=void 0;if(u&&_[g]&&_[g][y+i]&&(x=_[g][y+i]).$inspan){m.push(x),o=Math.max(y+1,o),l=Math.max(g+1,l);continue}var k=s.getText(e,w),C=s.getCss(e,w)+" "+(n[b].css||"")+(x?" webix_dtable_span "+x.css:""),$={height:x&&x.rowspan>1?"auto":(f.$height||s.config.rowHeight)+"px",width:x&&x.colspan>1?"auto":n[b].width+"px"};m.push({txt:k,className:C,style:$,span:x}),(k||0===k)&&(o=Math.max(y+1,o),l=Math.max(g+1,l)),v=v||!!k}}}t.skiprows&&!v||h.push(m)})),l&&o&&(t.trim&&(h.length=l,h=h.map((function(t){for(var e=t.length-1;e>=0;e--)if(t[e].span&&t[e].span.colspan){t[e].span.colspan=Math.min(t[e].span.colspan,t.length-e);break}return t.length=o,t}))),e.push(h)),c?this._getTableArray(t,e,c):(t.footer&&(e=this._getTableHeader(e,n,"footer")),t.header&&(e=this._getTableHeader(e,n,"header")),"page"==t.fit&&this._correctWidth(e,d,o,t)),e},_correctWidth:function(t,e,i,s){i&&s.trim&&(e.length=i);for(var n=0,a=0;a<e.length;a++)n+=e[a];n>this._getPageWidth(s)&&t[0]&&t[0].forEach((function(t){for(var e=0;e<t.length;e++)t[e]&&t[e].style&&t[e].style.width&&(t[e].style.width="auto")}))},_getTableHTML:function(t,e){var s=this,n=vt("div"),a=this.config.topSplit||0,r=e.header?this.config.columns[0].header.length:0,o=e.footer?this.config.columns[0].footer.length:0,l=r+a,h=l>6?r:l;return t.forEach((function(r,c){var d=vt("table",{class:"webix_table_print "+s.$view.className+(e.borderless?" borderless":""),style:"border-collapse:collapse",id:s.$view.getAttribute("id")},"<thead></thead><tbody></tbody><tfoot></tfoot>");n.appendChild(d);var u=i(d.children,3),_=u[0],p=u[1],f=u[2];if(r.forEach((function(t,e){var i=vt("tr");t.forEach((function(t){if(!t.$inspan){var e=vt("td",{class:t.className},t.txt);for(var s in t.style)e.style[s]=t.style[s];t.span&&(e.colSpan=t.span.colspan,e.rowSpan=t.span.rowspan),i.appendChild(e)}})),a&&e+1==l&&(i.className="webix_print_top_split"),e<h?_.appendChild(i):r.length-o>e?p.appendChild(i):f.appendChild(i)})),c+1<t.length){var g=vt("DIV",{class:"webix_print_pagebreak"});n.appendChild(g)}})),n}},ao={$exportView:function(e){this.isBranchOpen&&t.extend(e,{filterHTML:!0});var i=e.export_mode;if("pdf"!=i&&"excel"!=i||e.dataOnly||!e.styles)return this;e.dataOnly=!0,e.heights=E(e.heights)?"all":e.heights;var s="pdf"==i?hn(this,e):vn(this,e);return s[0].styles=this._getExportStyles(e),delete e.dataOnly,s},_getExportStyles:function(t){var e=t.export_mode,i=this.config.columns,s=[];return this._style_hash||(this._style_hash={}),this._style_hash[e]||(this._style_hash[e]={}),t.docHeader&&"excel"==e&&(s=[{0:this._getExportDocStyle(t.docHeader.css,e)},{0:{}}]),!1!==t.header&&(s=this._getExportHStyles(t,"header",s,e)),this.data.each((function(n){if(t.filter&&!t.filter(n))return!1;for(var a={},r=0;r<i.length;r++){var o=this.getCss(n.id,i[r].id),l=i[r].node.className,h="",c=null,d=null;if(this._spans_pull&&(c=this.getSpan(n.id,i[r].id))?(d=this.getSpanNode({row:c[0],column:c[1]}),h="webix_dtable_span "+(c[5]||"")):d=this.getItemNode({row:n.id,column:i[r].id}),!d){d=vt("div",{class:o,style:"visibility:hidden"});var u=i[r].node;i[r].attached||(u=vt("div",{class:l,style:"visibility:hidden"}),this._body.appendChild(u)),u.appendChild(d)}a[r]=this._getExportCellStyle(d,[o,l,h].join(":"),e)}s[s.length]=a}),this),!1!==t.footer&&this.config.footer&&(s=this._getExportHStyles(t,"footer",s,e)),t.docFooter&&"excel"==e&&(s=s.concat([{0:{}},{0:this._getExportDocStyle(t.docFooter.css,e)}])),s},_getExportHStyles:function(t,e,i,s){for(var n=this.config.columns,a=[],r=0;r<n[0][e].length;r++){for(var o={},l=0;l<n.length;l++){var h=n[l][e][r];if(h){var c=h.colspan?n[l+h.colspan-1].id:n[l].id,d="header"==e?this.getHeaderNode(c,r):this.getFooterNode(c,r);if(d){var u=[d.className,h.css||"",e];if(o[l]=this._getExportCellStyle(d,u.join(":"),s),h.colspan||h.rowspan){var _=I(o[l]);h.rowspan>1&&this._clearBorder(s,"bottom",o[l]),h.colspan>1&&this._clearBorder(s,"right",o[l]),a.push([r,l,{colspan:h.colspan-1||0,rowspan:h.rowspan-1||0},_])}}}else for(var p=0;p<a.length;p++){var f=a[p][2],g=a[p][1],m=a[p][0];if(g+f.colspan>=l&&m+f.rowspan>=r){var v=I(a[p][3]);m+f.rowspan!=r&&this._clearBorder(s,"bottom",v),g+f.colspan!=l&&this._clearBorder(s,"right",v),o[l]=v;break}}}i[i.length]=o}return i},_clearBorder:function(t,e,i){"pdf"==t?i["border"+e[0].toUpperCase()+e.substring(1)+"Color"]=i.backgroundColor:delete i.border[e]},_getBorderColor:function(t,e,i){return"0px"==t["border-".concat(i,"-width")]?null:ys.rgbToHex(t["border-".concat(i,"-color")])||e},_getExportCellStyle:function(t,e,i){if(this._style_hash[i][e])return this._style_hash[i][e];var s=this._getRules(t),n=ys.rgbToHex(s["background-color"])||"FFFFFF",a={backgroundColor:n,fontSize:.75*s["font-size"].replace("px",""),bold:"normal"!=s["font-weight"]&&400!=s["font-weight"],italic:"italic"==s["font-style"],underline:"line-through"==s["text-decoration-line"],strikethrough:"underline"==s["text-decoration-line"],color:ys.rgbToHex(s.color),textAlign:s["text-align"],whiteSpace:"normal"==s["white-space"],borderRightColor:this._getBorderColor(s,n,"right"),borderLeftColor:this._getBorderColor(s,n,"left"),borderBottomColor:this._getBorderColor(s,n,"bottom"),borderTopColor:this._getBorderColor(s,n,"top")},r="pdf"==i?a:this._getExcelCellRules(s,t,a);return this._style_hash[i][e]=r,r},_getExportDocStyle:function(e,i){e=t.extend(e||{},{visibility:"hidden","white-space":"nowrap","text-align":"left"});var s="";for(var n in e)s+=n+":"+e[n]+";";var a=vt("div",{style:s});this._body.appendChild(a);var r=this._getExportCellStyle(a,s,i);return wt(a),r},_getExcelCellRules:function(t,e,i){var s=e.firstChild&&e.firstChild.className&&-1!==e.firstChild.className.indexOf("webix_rotate");return{font:{name:t["font-family"].replace(/,.*$/,""),sz:i.fontSize,color:{rgb:i.color},bold:i.bold,underline:i.underline,italic:i.italic,strike:i.strikethrough},alignment:{horizontal:i.textAlign,vertical:t.height==t["line-height"]?"center":"top",wrapText:i.wrapText,textRotation:s?90:null},fill:{fgColor:{rgb:i.backgroundColor}},border:{right:i.borderRightColor?{style:"thin",color:{rgb:i.borderRightColor}}:null,bottom:i.borderBottomColor?{style:"thin",color:{rgb:i.borderBottomColor}}:null,left:i.borderLeftColor?{style:"thin",color:{rgb:i.borderLeftColor}}:null,top:i.borderTopColor?{style:"thin",color:{rgb:i.borderTopColor}}:null}}},_getRules:function(t){return window.getComputedStyle?window.getComputedStyle(t):t.currentStyle}},ro={subrow_setter:function(t){return!!t&&(this._init_subrow_once(),this._settings.scrollAlignY=!1,this._settings.fixedRowHeight=!1,le(t))},subview_setter:function(t){return t&&(this._settings.subrow=this.subrow_setter("<div></div>")),t},defaults:{subRowHeight:35},_refresh_sub_all:function(){this.data.each((function(t){t&&(t.$sub=this._settings.subrow(t,this.type))}),this),this._resize_sub_all()},_resize_sub_all:function(t){if("auto"===this._settings.subRowHeight&&this._content_width&&this._adjustSubRowHeight(),t&&this._settings.subview)for(var e in this._subViewStorage){var i=ke(this._subViewStorage[e]);i._settings.hidden||i.adjust()}},_refresh_sub_one:function(t){var e=this.getItem(t);e.$sub=this._settings.subrow(e,this.type),"auto"===this._settings.subRowHeight&&this._adjustSubRowHeight(e.id,e.$sub)},$init:function(){this._init_subrow_once=V((function(){var t="#"+this._top_id+" .webix_cell.webix_dtable_subview { line-height:normal;}";this._settings.fixedRowHeight&&(t+="#"+this._top_id+" .webix_column .webix_cell { white-space: nowrap;}"),gt(t),this._subViewScroll={},this._subViewStorage={},this.attachEvent("onSubViewRender",this._render_sub_view),this.attachEvent("onBeforeRender",this._track_subview_scrolls),this.data.attachEvent("onStoreUpdated",A((function(t,e,i){var s=this;t?"update"==i||"add"==i?this._refresh_sub_one(t):"delete"==i&&e.$subContent&&(this._get_all_subs_with_scroll(e.$subContent).forEach((function(t){delete s._subViewScroll[t.config.id]})),ke(e.$subContent).destructor(),delete this._subViewStorage[e.$subContent]):this._refresh_sub_all()}),this)),this.attachEvent("onDestruct",(function(){this._subViewStorage=this._subViewScroll=null})),this.attachEvent("onResize",(function(t,e,i){i!=t&&this._resize_sub_all(!0)}))})),this.type.subrow=function(t){return t.$sub?t.$subopen?"<div class='webix_tree_open webix_sub_open'></div>":"<div class='webix_tree_close webix_sub_close'></div>":"<div class='webix_tree_none'></div>"},this.on_click.webix_sub_open=function(t,e){return this.closeSub(e),!1},this.on_click.webix_sub_close=function(t,e){return this.openSub(e),!1}},openSub:function(t){var e=this.getItem(t);if(!e.$subopen){e.$row=this._settings.subrow,e.$subHeight=e.$subHeight||this._settings.subRowHeight,e.$subopen=!0;var i=this._subViewStorage[e.$subContent];i&&(i.repaintMe=!0),this.refresh(t),this.callEvent("onSubViewOpen",[t])}},getSubView:function(t){var e=this.getItem(t);if(e){var i=this._subViewStorage[e.$subContent];if(i)return ke(i)}return null},resizeSubView:function(t){var e=this.getSubView(t);e&&this._resizeSubView(this.getItem(t),e)},_resizeSubView:function(t,e){var i=e.$getSize(0,0)[2],s=t.$subHeight||this._settings.subRowHeight;Math.abs(i-(s||0))>2&&(t.$subHeight=i,this.refresh(t.id))},_checkSubWidth:function(t){var e=t.$width;if(t._layout_sizes){var i=t._cells.length-t._hiddencells;t._vertical_orientation?e-=t._padding.left+t._padding.right+2:e-=t._margin*(i-1)+t._padding.left+t._padding.right+2*i}return e>0},_render_sub_view:function(t,e){var i,s=this,n=this._subViewStorage[t.$subContent];if(n)e.firstChild.appendChild(n),i=ke(t.$subContent),this._checkSubWidth(i)||i.adjust(),n.repaintMe&&(delete n.repaintMe,i.config.hidden=!1,i._render_hidden_views());else{var a,r=this._settings.subview;"function"==typeof r?i=r.call(this,t,e.firstChild):((a=I(r)).$scope=this.$scope,i=be(a,e.firstChild)),i.getMasterView=A((function(){return this}),this),t.$subContent=i.config.id,this._subViewStorage[t.$subContent]=i.$view,this._destroy_with_me.push(i),i.attachEvent("onResize",A((function(e,i,s,n){i&&i!=n&&this.refresh(t.id)}),this)),this.callEvent("onSubViewCreate",[i,t])}i=i||ke(n),this._resizeSubView(t,i),this._get_all_subs_with_scroll(i).forEach((function(t){if(s._subViewScroll[t.config.id]){var e=s._subViewScroll[t.config.id];t._x_scroll&&(t._x_scroll.config.scrollPos=-1),t._y_scroll&&(t._y_scroll.config.scrollPos=-1),t.scrollTo(e.x,e.y)}}))},_adjustSubRowHeight:function(t,e){var i,s=vt("DIV",{class:"webix_measure_size webix_cell webix_dtable_subrow"},"");s.style.cssText="width:"+this._content_width+"px; height:auto; visibility:hidden; position:absolute; top:0px; left:0px; overflow:hidden;",this.$view.appendChild(s),s.offsetHeight<1&&(i=this.$view.cloneNode(!0),document.body.appendChild(i),i.appendChild(s)),this.data.each((function(i){(i&&!t||i.id==t&&i.$sub)&&(s.innerHTML=e||this._settings.subrow(i,this.type),i.$subHeight=s.offsetHeight)}),this),s=wt(s),i&&wt(i)},closeSub:function(t){var e=this.getItem(t);if(e.$subopen){e.$row=!1,e.$subopen=!1;var i=this._subViewStorage[e.$subContent];i&&(ke(i).config.hidden=!0),this.refresh(t),this.callEvent("onSubViewClose",[t])}},_track_subview_scrolls:function(){var t=this;for(var e in this._subViewStorage){var i=this._subViewStorage[e];i&&i.parentNode&&this._get_all_subs_with_scroll(i).forEach((function(e){t._subViewScroll[e.config.id]=e.getScrollState()}))}},_get_all_subs_with_scroll:function(t){var e=(t=ke(t)).queryView((function(t){return t.getScrollState}),"all");return t.getScrollState&&e.unshift(t),e}},oo={spans_setter:function(t){return t&&!this._spans_pull&&this._init_spans_once(),t},_init_spans_once:function(){var t=this;this._spans_pull={},this._spans_areas=[],this.data.attachEvent("onStoreLoad",A((function(t,e){e&&e.spans&&this.addSpan(e.spans)}),this)),this.data.attachEvent("onClearAll",A((function(){this._spans_pull={}}),this)),this.attachEvent("onSyncScroll",(function(t,e,i){for(var s=0;s<3;s++)Ii._set_matrix(this._spans_areas[s],1==s?t:0,e,i)})),this.attachEvent("onScrollY",this._adjust_spans_xy),this.attachEvent("onScrollX",this._adjust_spans_xy),this.attachEvent("onAfterRender",this._paint_spans),this.attachEvent("onColumnResize",this._paint_spans),this.attachEvent("onSelectChange",this._paint_spans_selection),this.data.attachEvent("onStoreUpdated",(function(e,i,s){"add"!=s&&"delete"!=s||t._adjustSpans(e,s)})),this.data.attachEvent("onBeforeDelete",(function(e){var i=t.data._filter_order;t._deletedItemIndex=i?i.find(e):t.getIndexById(e)}))},addSpan:function(t,i,s,n,a,r){if("object"!=e(t))n=n||1,s=s||1,this._spans_pull[t]||(this._spans_pull[t]={}),this._spans_pull[t][i]=[s,n,a,r];else for(var o=0;o<t.length;o++)this.addSpan.apply(this,t[o])},removeSpan:function(t,e){arguments.length||(this._spans_pull={});var i=this._spans_pull[t];i&&delete i[e]},getSpan:function(t,e){if(!t)return this._spans_pull;var i=this._spans_pull,s=this.data._filter_order,n=this._hidden_column_order,a=s?s.find(t):this.getIndexById(t),r=n.length?n.find(e):this.getColumnIndex(e);for(t in i)for(e in i[t])if("$"!=e.toString().charAt(0)){var o=i[t][e],l=s?s.find(t):this.getIndexById(t),h=n.length?n.find(e):this.getColumnIndex(e);if(h>=0&&l>=0&&!(a>l+o[1]-1||a<l||r>h+o[0]-1||r<h))return[t,e].concat(o)}return null},_prepareSpanData:function(){var t={};for(var e in this._spans_pull)for(var i in this._spans_pull[e]){var s=this._spans_pull[e][i],n=this.data._filter_order?this.data._filter_order.find(e):this.getIndexById(e),a=this._hidden_column_order.length?this._hidden_column_order.find(i):this.getColumnIndex(i),r=this._getFirstVisibleCell(n,a,s[1],s[0]);r&&(t[r[0]]||(t[r[0]]={}),t[r[0]][r[1]]=[e,i])}return t},_getFirstVisibleCell:function(t,e,i,s){for(var n=t;n<t+i;n++)for(var a=e;a<e+s;a++){var r=this.data._filter_order?this.getIndexById(this.data._filter_order[n]):n,o=this._hidden_column_order.length?this.getColumnIndex(this._hidden_column_order[a]):a;if(-1!=r&&-1!=o)return[r,o]}},_paint_spans:function(){var t,e,i=this._columns.length-this._settings.rightSplit;for(wt(this._spans_areas),e=0;e<3;e++)t=this._spans_areas[e]=vt("DIV",{class:"webix_span_layer"}),this._body.childNodes[e].appendChild(t);this._adjust_spans_xy();var s=this._prepareSpanData();this._settings.leftSplit&&this._paint_spans_area(this._spans_areas[0],0,this._settings.leftSplit,!1,s),this._settings.rightSplit&&this._paint_spans_area(this._spans_areas[2],i,this._columns.length,!1,s),this._paint_spans_area(this._spans_areas[1],this._settings.leftSplit,i,!1,s),this._settings.topSplit&&!Ot.touch&&this._paintSpansTop(s)},_getSplitSizesX:function(){for(var t,e=0,i=0,s=0,n=0;e<this._settings.leftSplit;)i+=this._columns[e].width,e++;for(t=(e=this._columns.length-1)-this._settings.rightSplit;e>=t;)n+=this._columns[e].width,e--;for(e=this._settings.leftSplit;e<this._columns.length-this._settings.rightSplit;e++)s+=this._columns[e].width;return[i,s,n]},_paintSpansTop:function(t){for(var e=3;e<6;e++)this._spans_areas[e]=vt("DIV",{class:"webix_span_layer_top"}),this._body.childNodes[e-3].appendChild(this._spans_areas[e]);var i=this._getSplitSizesX();this._settings.leftSplit&&(this._spans_areas[3].style.width=i[0]+"px",this._paint_spans_area(this._spans_areas[3],0,this._settings.leftSplit,!0,t));var s=this._columns.length-this._settings.rightSplit;this._settings.rightSplit&&(this._spans_areas[5].style.width=i[2]+"px",this._paint_spans_area(this._spans_areas[5],s,this._columns.length,!0,t)),this._spans_areas[4].style.width=i[1]+"px",this._paint_spans_area(this._spans_areas[4],this._settings.leftSplit,s,!0,t)},_paint_spans_area:function(t,e,s,n,a){for(var r=this.data.$min||0,o=this.data.$max||this.data.order.length,l=r;l<o;l++){var h=this.data.order[l];if(h&&(!n||l<this._settings.topSplit))for(var c=e;c<s;c++){var d=this._columns[c].id,u=a[l]?a[l][c]:null;if(u){var _=i(u,2);h=_[0],d=_[1];var p=this._hidden_column_order.length?this._hidden_column_order.find(d):c,f=this.data._filter_order?this.data._filter_order.find(h):l,g=this._spans_pull[u[0]];this._add_span_to_area(t,l,c,g,e,r,h,d,p,f)}}}},_paint_spans_selection:function(){for(var t=this.config.select,e="cell"==t||"column"==t,i=this.getSelectedId(!0),s=[],n=this._last_selected||[],a=T()+"",r=!1,o=0;o<i.length;o++){var l=this._spans_pull[i[o]];!l||e&&!l[i[o].column]||(l.$selected&&l.$selected.id==i[o].id||(r=!0),l.$selected=i[o],l.$time=a,s.push(i[o].id))}for(var h=0;h<n.length;h++){var c=this._spans_pull[n[h]];c&&c.$time!==a&&(delete c.$selected,r=!0)}this._last_selected=[].concat(i),r&&this._paint_spans()},_span_sum_width:function(t,e){for(var i,s=0,n=t;n<e;n++)s+=(i=this._hidden_column_order.length?this.getColumnConfig(this._hidden_column_order[n]):this._columns[n])&&!i.hidden?i.width:0;return s},_span_sum_height:function(t,e){for(var i=0,s=this.data._filter_order||this.data.order,n=t;n<e;n++){var a=this.getItem(s[n]);(!this.data._filter_order||this.data.order.find(a.id)>-1)&&(i+=a?this._getRowHeight(a):this._settings.rowHeight)}return i},_add_span_to_area:function(t,e,i,s,n,a,r,o,l,h){var c=s[o],d=this._span_sum_width(l,l+c[0]);if(!d)return!1;var u=this._span_sum_height(h,h+c[1]);if(!u)return!1;var _=c[2]||this.getText(r,o),p="";!s.$selected||"row"!==this._settings.select&&s.$selected.column!==o||(p="webix_selected ");var f="",g=i;if(this._hidden_column_order.length)for(var m=l;m<l+c[0];m++)this.isColumnVisible(this._hidden_column_order[m])&&g++;else g+=c[0];g==this._settings.leftSplit&&(f+=" webix_last_rightcell");var v=e;if(this.data._filter_order)for(var b=h;b<h+c[1];b++)-1!=this.data.order.find(this.data._filter_order[b])&&v++;else v+=c[1];v==this._settings.topSplit&&(f+=" webix_last_topcell");var w={column:i,row:e,class:p+"webix_cell webix_table_cell webix_dtable_span "+(c[3]||"")+f,"aria-colindex":i+1,"aria-rowindex":e+1};c[0]>1&&(w["aria-colspan"]=c[0]),c[1]>1&&(w["aria-rowspan"]=c[1]);var y=vt("DIV",w,""+_);y.style.top=this._span_sum_height(a,h)+"px",y.style.left=this._span_sum_width(n,l)+"px",y.style.width=d+"px",y.style.height=u+"px",t.appendChild(y)},_adjust_spans_xy:function(){if(!this._settings.prerender)for(var t=this.getScrollState(),e=0;e<3;e++)this._spans_areas[e].style.top="-"+(t.y||0)+"px"},_checkCellMerge:function(t,e){var i,s,n=!1;return this._spans_pull&&(i=this.getSpan(t.row,t.column),s=this.getSpan(e.row,e.column),i&&s&&i[0]==s[0]&&i[1]==s[1]&&(n=!0)),n},getSpanNode:function(t){for(var e=this._spans_areas,i=this.getIndexById(t.row),s=this.getColumnIndex(t.column),n=0;n<e.length;n++)for(var a=e[n].childNodes,r=0;r<a.length;r++)if(a[r].getAttribute("row")==i&&a[r].getAttribute("column")==s)return a[r];return null},_calcSpanAutoHeight:function(t,e,i){var s,n=this._spans_pull[t][e];if(n[1]>1)s=1;else if(n[0]>1){var a=this.getColumnIndex(e),r=i.offsetWidth;i.style.width=this._span_sum_width(a,a+n[0])+"px",s=i.scrollHeight,i.style.width=r+"px"}return s},_adjustSpans:function(t,e){var i,s,n=this._spans_pull,a=this.data._filter_order;for(var r in i="delete"==e?this._deletedItemIndex:a?a.find(t):this.getIndexById(t),n){var o=a?a.find(r):this.getIndexById(r);for(var l in"delete"==e&&o>=i&&o++,n[r])if("$"!=l.toString().charAt(0)){var h=n[r][l];if("add"==e)o<i&&o+h[1]>i&&(h[1]++,s=!0);else if(r==t||o<=i&&o+h[1]>i)if(h[1]--,s=!0,h[1]){if(r==t){var c=this.getIdByIndex(i);c&&this.addSpan(c,l,h[0],h[1],h[2],h[3]),this.removeSpan(r,l)}}else this.removeSpan(r,l)}}s&&this._paint_spans()}},lo={name:"datatable",defaults:{leftSplit:0,rightSplit:0,topSplit:0,columnWidth:100,sort:!0,prerender:!1,autoheight:!1,autowidth:!1,header:!0,fixedRowHeight:!0,scrollAlignY:!0,scrollX:!0,scrollY:!0,datafetch:50,navigation:!0},$skin:function(){this.defaults.rowHeight=vi.rowHeight,this.defaults.minRowHeight=vi.rowHeight-6,this.defaults.headerRowHeight=vi.barHeight-2*vi.borderWidth,this.defaults.minColumnWidth=2*vi.dataPadding+vi.borderWidth},on_click:{webix_excel_filter:function(){return!1},webix_richfilter:function(){return!1},webix_table_checkbox:function(t,e){e=this.locate(t);var i=this.getItem(e.row),s=this.getColumnConfig(e.column),n=t.target,a=("checkbox"==n.type?n.checked:i[e.column]!=s.checkValue)?s.checkValue:s.uncheckValue,r={};return r[e.column]=a,this.updateItem(e.row,r,this._settings.checkboxRefresh?"update":"save"),this.callEvent("onCheck",[e.row,e.column,a]),!1},webix_table_radio:function(t){var e=this.locate(t),i=this.getItem(e.row),s=this.getColumnConfig(e.column);return this.eachRow((function(t){var i=this.data.pull[t];i&&i[e.column]==s.checkValue&&(i[e.column]=s.uncheckValue)})),i[e.column]=s.checkValue,this.callEvent("onCheck",[e.row,e.column,!0]),this.refresh(),!1}},on_dblclick:{webix_table_checkbox:function(){return this.on_click.webix_table_checkbox.apply(this,arguments)}},on_context:{},$init:function(e){this.on_click=t.extend({},this.on_click);this._contentobj.innerHTML="<div class='webix_ss_header' section='header'><div class='webix_hs_left'></div><div class='webix_hs_center'></div><div class='webix_hs_right'></div></div><div class='webix_ss_body'><div class='webix_ss_left'><div class='webix_ss_center_scroll'></div></div><div class='webix_ss_center'><div class='webix_ss_center_scroll' role='rowgroup'></div></div><div class='webix_ss_right'><div class='webix_ss_center_scroll'></div></div></div><div class='webix_ss_hscroll' role='scrollbar' aria-orientation='horizontal'></div><div class='webix_ss_footer' section='footer'><div class='webix_hs_left'></div><div class='webix_hs_center'></div><div class='webix_hs_right'></div></div><div class='webix_ss_vscroll_header'></div><div class='webix_ss_vscroll' role='scrollbar' aria-orientation='vertical'></div><div class='webix_ss_vscroll_footer'></div>",this._top_id=this._contentobj.id=this.name+T(),this._contentobj.className+=" webix_dtable",this._dataobj=this._contentobj,this._header=this._contentobj.firstChild,this._body=this._header.nextSibling,this._footer=this._body.nextSibling.nextSibling,this._viewobj.setAttribute("role","grid"),e.editable||this._viewobj.setAttribute("aria-readonly","true"),this.data.provideApi(this,!0),this.data.attachEvent("onParse",A(this._call_onparse,this)),this.$ready.push(this._first_render),this._columns=[],this._headers=[],this._footers=[],this._rows_cache=[],this._active_headers={},this._filter_elements={},this._sort_signs={},this._sort_signs_order=[],this._header_height=this._footer_height=0,this._destroy_with_me=[],this.data.attachEvent("onServerConfig",A(this._config_table_from_file,this)),this.data.attachEvent("onServerOptions",A(this._config_options_from_file,this)),this.attachEvent("onViewShow",(function(){this._restore_scroll_state(),this._refresh_any_header_content()})),this.data.attachEvent("onClearAll",A((function(t){t||(this._scrollLeft=this._scrollTop=0,this._x_scroll&&this._x_scroll.reset(),this._y_scroll&&this._y_scroll.reset(),this._setLeftScroll(0))}),this)),this.attachEvent("onDestruct",this._clean_config_struct),this.attachEvent("onKeyPress",this._onKeyPress),this.attachEvent("onScrollY",this._adjust_rows),U("onDataTable",[this,e])},_render_initial:function(){this._scrollSizeX=this._scrollSizeY=Ot.scrollSize;var t=this._settings.headerRowHeight+1;gt("#"+this._top_id+" .webix_cell { height:"+this._settings.rowHeight+"px; line-height:"+(this._settings.rowLineHeight||this._settings.rowHeight)+"px;"+(this._settings.fixedRowHeight?"":"white-space:normal;")+" }"),gt("#"+this._top_id+" .webix_hcell { height:"+t+"px; line-height:"+t+"px;}"),this._render_initial=function(){}},_first_render:function(){var t=this;this.data.attachEvent("onStoreLoad",(function(){return t._refresh_any_header_content(!0)})),this.data.attachEvent("onSyncApply",(function(){return t._refresh_any_header_content(!0)})),this.data.attachEvent("onStoreUpdated",A((function(){return this.render.apply(this,arguments)}),this)),this.data.attachEvent("onStoreUpdated",A(this._refresh_tracking_header_content,this)),this.render()},refresh:function(){this.render()},_delayRender:function(t){var e=this;clearTimeout(this._renderDelay),this._renderDelay=j((function(t){if(e._renderDelay=0,E(e._delayedLeftScroll)||(e._setLeftScroll(e._delayedLeftScroll),delete e._delayedLeftScroll),e.render(),!e._settings.clipboard&&t){var i=e.getItemNode(t);i&&i.focus()}}),this,[t])},render:function(t,e,i){if("save"!=i&&!this._renderDelay){if(!this._columns.length){var s=this._settings.columns;if(!s||!s.length){if(!this._settings.autoConfig||!this.data.order.length||this._hidden_column_order.length)return;this._dtable_fully_ready=0,this._autoDetectConfig()}this._define_structure()}if(!this.isVisible(this._settings.id)||this.$blockRender)return this._render_initial();var n=this.config.experimental&&!this._settings.subview;return!t||-1==e||"paint"!=i&&"update"!=i||n?(this._render_timer&&(clearTimeout(this._render_timer),this._render_timer=0),this.callEvent("onBeforeRender",[this.data])?(this._render_initial(),this._dtable_fully_ready||this._apply_headers(),this._content_width&&(n&&("paint"==i||"update"==i)&&t?this._repaint_single_row(t):this._check_rendered_cols(!0,!0)),t&&"update"==i||(this._dtable_height=this._get_total_height(),this._set_split_sizes_y()),this._viewobj.setAttribute("aria-colcount",Math.max(this._hidden_column_order.length,this._columns.length)),this._viewobj.setAttribute("aria-rowcount",this.data.count()),this.callEvent("onAfterRender",[this.data]),!0):void 0):(this._render_timer&&clearTimeout(this._render_timer),void(this._render_timer&&this._render_timer_id!=t?(this._render_timer_id=null,this._render_timer=j((function(){this.render()}),this)):(this._render_timer_id=t,this._render_timer=j((function(){this.render(t,-1,i)}),this))))}},getColumns:function(t){var e=this._hidden_column_order;if(t&&e.length){for(var i=[],n=0;n<e.length;n++)i.push(this.getColumnConfig(e[n]));return i}return s(this._columns)},getColumnConfig:function(t){return this._columns_pull[t]||this._hidden_column_hash[t]},_config_options_from_file:function(t){for(var e in t){var i=this.getColumnConfig(e);f(i,"Orphan collection: "+e);var s=new Ka({data:t[e]});this._destroy_with_me.push(s),this._bind_collection(s,i)}},_config_table_from_file:function(t){this._create_scheme_init(),t.columns&&this._dtable_fully_ready&&this.refreshColumns(t.columns)},_define_structure:function(){if(this._settings.columns){this._columns_pull={},this._columns=this._settings.columns,this._rightSplit=this._columns.length-(this.config.rightSplit||0);for(var t=0;t<this._columns.length;t++)this._prepare_single_column(this._columns[t]);this._normalize_headers("header",this._headers),this._normalize_headers("footer",this._footers),this.callEvent("onStructureLoad",[])}},_prepare_single_column:function(t){this._columns_pull[t.id]=t,E(t.header)&&(t.header=t.id);var i=t.cssFormat;if(i&&(t.cssFormat=P(i,this.$scope)),t.width=this._correctColumnWidth(t.width||this._settings.columnWidth,t),"string"==typeof t.format&&(t.format=R[t.format]||window[t.format]),t.numberFormat){var s=t.numberFormat;"string"==typeof s&&(t.numberFormat=s=Sn.getConfig(s)),t.format=Sn.numToStr(s),t.editFormat=t.editFormat||function(t){return Sn.format(t,s)},t.editParse=t.editParse||function(t){return Sn.parse(t,s)}}E(t.checkValue)&&(t.checkValue=1),E(t.uncheckValue)&&(t.uncheckValue=0),t.css&&"object"==e(t.css)&&(t.css=ft(t.css));var n=t.template;n&&("string"==typeof n&&(n=n.replace(/#\$value#/g,"#"+t.id+"#")),t.template=le(n))},_define_structure_and_render:function(){this._apply_headers()},_clean_config_struct:function(){for(var t=0;t<this._columns.length;t++)delete this._columns[t].attached,delete this._columns[t].node},_apply_headers:function(){this._rightSplit=this._columns.length-(this.config.rightSplit||0),this._dtable_width=0;for(var t=0;t<this._columns.length;t++){if(!this._columns[t].node){var e=vt("DIV");e.style.width=this._columns[t].width+"px",this._columns[t].node=e}t>=this._settings.leftSplit&&t<this._rightSplit&&(this._dtable_width+=this._columns[t].width)}var i=[];if(this._settings.rightSplit){var s=this._columns.length-this._settings.rightSplit;i[s]=" webix_first",i[s-1]=" webix_last"}if(this._settings.leftSplit){var n=this._settings.leftSplit;i[n]=" webix_first",i[n-1]=" webix_last"}i[0]=(i[0]||"")+" webix_first webix_select_mark";var a=this._columns.length-1;i[a]=(i[a]||"")+" webix_last";for(var r=0;r<this._columns.length;r++){var o=this._columns[r].node;o.setAttribute("column",r),o.className="webix_column "+(this._columns[r].css||"")+(i[r]||"")}this._create_scrolls(),this._set_columns_positions(),this._set_split_sizes_x(),this._render_header_and_footer(),this._dtable_fully_ready=!0},_set_columns_positions:function(){for(var t=0,e=0;e<this._columns.length;e++){var i=this._columns[e];e!=this._settings.leftSplit&&e!=this._rightSplit||(t=0),i.node&&(i.node.style.left=t+"px",(this._settings.leftSplit||this._settings.rightSplit)&&(wt(i.node),i.attached=!1)),t+=i.width}},_render_header_and_footer:function(){this._header_fix_width||(this._header_fix_width=0),this._header_height=this._footer_height=0,this._settings.header&&(this._refreshHeaderContent(this._header,0,1),this._normalize_headers("header",this._headers),this._header_height=this._headers._summ,this._render_header_section(this._header,"header",this._headers)),this._settings.footer&&(this._refreshHeaderContent(this._footer,0,1),this._normalize_headers("footer",this._footers),this._footer_height=this._footers._summ,this._render_header_section(this._footer,"footer",this._footers)),this.refreshHeaderContent(!1,!1),this._size_header_footer_fix();for(var t=0;t<this._sort_signs_order.length;t++){var e=this._sort_signs_order[t];this._render_single_mark(e,this._sort_signs[e])}},_getHeaderHeight:function(t,e,i){var s=0,n=t.colspan||1,a="webix_hcell "+(t.css||"");if(t.rotate)a+=" webix_measure_rotate";else for(var r=0;r<n;r++)s+=this._columns[i+r]?this._columns[i+r].width:this.config.columnWidth;var o=jt([t.text],a,s);return t.rotate?o.width:o.height},_normalize_headers:function(t,i){var s=0;i.length=0;for(var n=0;n<this._columns.length;n++){var a=this._columns[n][t]||"";B(a)||(a=[a]);for(var r=0;r<a.length;r++)"object"!=e(a[r])&&(a[r]={text:a[r]}),a[r]&&a[r].height&&(i[r]=Math.max(i[r]||0,a[r].height)),a[r]&&a[r].autoheight&&(i[r]=Math.max(i[r]||0,this._getHeaderHeight(a[r],this._columns[n],n))),a[r]&&a[r].css&&"object"===e(a[r].css)&&(a[r].css=ft(a[r].css));s=Math.max(s,a.length),this._columns[n][t]=a}i._summ=s;for(var o=s-1;o>=0;o--)i[o]=i[o]||this._settings.headerRowHeight,i._summ+=1*i[o];for(var l=0;l<this._columns.length;l++)for(var h=this._columns[l][t],c=0;c<h.length;c++){if(h[c]&&h[c].rowspan)for(var d=1;d<h[c].rowspan;d++)h[c+d]=null;if(h[c]&&h[c].colspan)for(var u=1;u<h[c].colspan;u++)this._columns[l+u][t][c]=null}for(var _=0;_<this._columns.length;_++){var p=this._columns[_][t];if(p.length<s){var f=p.length-1;p[f].rowspan=s-p.length+1;for(var g=f+1;g<s;g++)p[g]=null}}return s},_find_header_content:function(t,e){return t.querySelector("DIV[".concat("active_id",'="').concat(e,'"]'))},getHeaderContent:function(e){var i=this._find_header_content(this._header,e);if(i||(i=this._find_header_content(this._footer,e)),i){var s=this._active_headers[e],n=Hn[s.content],a={type:n,getValue:function(t){return n.getValue(i,t)},setValue:function(t){return n.setValue(i,t)}};return n.getHelper&&t.extend(a,n.getHelper(i,s)),a}},_render_empty_hcell:function(t,e){return"<div class='".concat(e,"' style='height:").concat(t,"px;'></div>")},_render_subheader:function(t,e,i,s,n){if(t==e)return"";for(var a="",r='<div style="background:inherit;width:'.concat(i,'px;">'),o=this._columns[0][s].length,l=0,h=t;h<e;h++){var c=0,d=this._columns[h].width,u=h==t?"position:static;":"position:absolute;top:".concat(c,"px;left:").concat(l,"px;");r+='<div class="webix_hcolumn" style="'.concat(u,"width:").concat(d,'px;overflow:hidden;">');for(var _=0;_<o;_++){var p=this._columns[h][s][_],g=n[_],m="webix_hcell";if(this._columns[h].$selected&&(m+=" webix_sel_hcell"),h==t&&(m+=" webix_first"),h==e-1&&(m+=" webix_last"),_==o-1&&(m+=" webix_last_row"),p){p.content&&(p.contentId=p.contentId||T(),p.columnId=this._columns[h].id,p.format=this._columns[h].format,f(Hn,"Filtering extension was not included"),f(Hn[p.content],"Unknown content type: "+p.content),p.text=Hn[p.content].render(this,p),this._active_headers[p.contentId]=p,this._has_active_headers=!0),p.css&&(m+=" "+p.css);var v="<div row='"+_+"'column='"+(p.colspan?p.colspan-1+h:h)+"'",b="";p.contentId&&(v+=" active_id='"+p.contentId+"'");var w=!1,y=g;if(p.colspan&&p.colspan>1||p.rowspan&&p.rowspan>1){var x=this._summ_right(this._columns,h,p.colspan)||d;(y=this._summ_next(n,_,p.rowspan))<=0&&(y=g),r+=this._render_empty_hcell(g+1,m),p.colspan&&h+p.colspan>=e&&(m+=" webix_last"),p.rowspan&&_+p.rowspan>=o&&(m+=" webix_last_row"),m+=" webix_span",w=!0,b=" colspan='".concat(p.colspan||1,"' rowspan='").concat(p.rowspan||1,"' style='position:absolute;top:").concat(c,"px;left:").concat(l,"px;line-height:").concat(y+1,"px;width:").concat(x,"px;height:").concat(y+1,"px;'")}else g!=this._settings.headerRowHeight&&(b=" style='line-height:".concat(g+1,"px;height:").concat(g+1,"px;'"));v+=' class="'+m+'"',v+=" "+b+">";var k=""===p.text?"&nbsp;":p.text;p.rotate&&(k="<div class='webix_rotate' style='width:"+(y-10)+"px;transform-origin:center "+(y-15)/2+"px;'>"+k+"</div>"),v+=k+"</div>",w?a+=v:r+=v,c+=g+1}else r+=this._render_empty_hcell(g+1,m),c+=g+1}l+=d,r+="</div>"}return r+a+"</div>"},_summ_next:function(t,e,i){var s=-1;for(i+=e;e<i;e++)s+=t[e]+1;return s},_summ_right:function(t,e,i){var s=0;for(i+=e;e<i;e++)s+=t[e].width;return s},showItemByIndex:function(t,e){var i=this._settings.pager;if(i&&t>=this._settings.topSplit){var s=Math.floor(t/i.size);s!=i.page&&ke(i.id).select(s)}var n=this.getScrollState();if(t>=this._settings.topSplit||this._settings.prerender&&-1!=t){var a=this._get_y_range();if(t<a[0]+1||t>=a[1]-1){var r=this._getHeightByIndexSumm(i?this.data.$min:0,t),o=this._dtable_offset_height+1,l=this._getHeightByIndex(t);if(t<a[0]+1)r=Math.max(0,r)-this._get_top_split_height();else if(r+l>o){r+=l-o;for(var h=t;h>0&&o>0;h--)o-=this._getHeightByIndex(h);t>0&&o&&(r+=this._getHeightByIndex(t+1))}else r=n.y;n.y=r}}if(-1!=e){if(e<this._settings.leftSplit||e>=this._rightSplit)return this.scrollTo(n.x,n.y);var c=this._get_x_range();if(e<c[0]+1||e>=c[1]-1){for(var d=0,u=this._settings.leftSplit;u<e;u++)d+=this._columns[u].width;var _=this._columns[e].width;e<c[0]+1||(d+_>this._center_width?d+=_-this._center_width:d=n.x),n.x=d}}this.scrollTo(n.x,n.y)},showCell:function(t,e){if(!e||!t){var i=this.getSelectedId(!0);1==i.length&&(e=e||i[0].column,t=t||i[0].row)}e=e?this.getColumnIndex(e):-1,t=t?this.getIndexById(t):-1,this.showItemByIndex(t,e)},scrollTo:function(t,e){if(this._x_scroll){if(this._scrollTo_touch)return this._scrollTo_touch(t,e);null!==t&&this._x_scroll.scrollTo(t),null!==e&&this._y_scroll.scrollTo(e)}},getScrollState:function(){if(this._getScrollState_touch)return this._getScrollState_touch();var t=this._render_scroll_shift?0:this._render_scroll_diff||0;return{x:this._scrollLeft||0,y:this._scrollTop+t}},showItem:function(t){this.showItemByIndex(this.getIndexById(t),-1)},_render_header_section:function(t,e,i){var s=this,n=t.childNodes;n[0].innerHTML=this._render_subheader(0,this._settings.leftSplit,this._left_width,e,i),n[1].innerHTML=this._render_subheader(this._settings.leftSplit,this._rightSplit,this._dtable_width,e,i),n[2].innerHTML=this._render_subheader(this._rightSplit,this._columns.length,this._right_width,e,i);var a=this.getScrollState().x;Ot.touch?Ii._set_matrix(n[1].firstChild,-a,0,"0ms"):n[1].scrollLeft=a,n[1].onscroll=function(){return s._scroll_with_header()}},_scroll_with_header:function(){var t=this._header.childNodes[1].scrollLeft;if(this._ignore_after_focus_scroll)return this._ignore_after_focus_scroll=!1;this._x_scroll.scrollTo(t),this._touch_scroll&&(t&&(this._header.childNodes[1].scrollLeft=0),this._ignore_after_focus_scroll=t)},_refresh_tracking_header_content:function(){this.refreshHeaderContent(!0,!0)},_refresh_any_header_content:function(t){this.refreshHeaderContent(!1,!0,null,t)},refreshHeaderContent:function(t,e,i,s){this._settings.header&&(e&&this._refreshHeaderContent(this._header,t,1,i,s),this._refreshHeaderContent(this._header,t,0,i,s)),this._settings.footer&&(e&&this._refreshHeaderContent(this._footer,t,1,i,s),this._refreshHeaderContent(this._footer,t,0,i,s))},refreshFilter:function(t){this.refreshHeaderContent(!1,!0,t)},_refreshHeaderContent:function(t,e,i,s,n){if(this._has_active_headers&&t)for(var a=t.querySelectorAll("".concat("DIV","[").concat("active_id","]")),r=0;r<a.length;r++){var o=a[r].getAttribute("active_id");if(o){var l=this._active_headers[o];if(s&&s!=l.columnId)continue;var h=Hn[l.content];i?h.getValue&&(l.value=h.getValue(a[r])):e&&!h.trackCells||n&&this.getColumnConfig(l.columnId).collection||h.refresh(this,a[r],l)}}},headerContent:[],_set_size_scroll_area:function(t,e,i){this._scrollSizeY?(t.style.height=Math.max(e,1)-1+"px",t.style.width=(this._rightSplit?0:i)+this._scrollSizeY-1+"px"):t.style.display="none"},_size_header_footer_fix:function(){this._settings.header&&this._set_size_scroll_area(this._header_scroll,this._header_height,this._header_fix_width),this._settings.footer&&this._set_size_scroll_area(this._footer_scroll,this._footer_height,this._header_fix_width)},_update_scroll:function(){var t=!(this._settings.autowidth||!1===this._settings.scrollX),e=!(this._settings.autoheight||!1===this._settings.scrollY);this._scrollSizeX=t?Ot.scrollSize:0,this._scrollSizeY=e?Ot.scrollSize:0,this._x_scroll&&(this._x_scroll._settings.scrollSize=this._scrollSizeX,this._x_scroll._settings.scrollVisible=t),this._y_scroll&&(this._y_scroll._settings.scrollSize=this._scrollSizeY,this._y_scroll._settings.scrollVisible=e)},_create_scrolls:function(){this._scrollTop=0,this._scrollLeft=0;var t=!(this._settings.autowidth||!1===this._settings.scrollX),e=!(this._settings.autoheight||!1===this._settings.scrollY);if(t||(this._scrollSizeX=0),e||(this._scrollSizeY=0),this._x_scroll||(this._x_scroll=be({view:"vscroll",container:this._footer.previousSibling,scrollWidth:this._dtable_width,scrollSize:this._scrollSizeX,scrollVisible:t}),this._scrollSizeX||Ot.$customScroll||(this._x_scroll._viewobj.style.position="absolute"),this._x_scroll.attachEvent("onScroll",A(this._onscroll_x,this))),!this._y_scroll){this._header_scroll=this._footer.nextSibling;var i=this._header_scroll.nextSibling;this._footer_scroll=i.nextSibling,this._y_scroll=be({view:"vscroll",container:i,scrollHeight:100,scroll:"y",scrollSize:this._scrollSizeY,scrollVisible:e}),this._y_scroll.activeArea(this._body),this._x_scroll.activeArea(this._body,!0),this._y_scroll.attachEvent("onScroll",A(this._onscroll_y,this))}this._content_width&&this.callEvent("onResize",[this._content_width,this._content_height]),Ot.$customScroll&&Li.enable(this),this._create_scrolls=function(){}},columnId:function(t){return this._columns[t]&&this._columns[t].id},getColumnIndex:function(t){for(var e=0;e<this._columns.length;e++)if(this._columns[e].id==t)return e;return-1},_getNodeBox:function(t,e){var i,s=0,n=0,a=0,r=0,o=0;for(i=0;i<this._columns.length&&(this._rightSplit!=i&&this._settings.leftSplit!=i||(s=0,o++),this._columns[i].id!=e);i++)s+=this._columns[i].width;for(n+=this._columns[i].width,i=0;i<this.data.order.length&&this.data.order[i]!=t;i++)r+=this._getHeightByIndex(i);return a+=this._getHeightByIndex(i),[s,n,r-this._scrollTop,a,this._body.childNodes[o]]},_id_to_string:function(){return this.row},locate:function(t,e){var i=ke(t);if(this==i)t=t.target||t;else{if(!i||!i.config.container)return null;if(this!==ke(t=i.$view.parentNode))return null}for(;t&&t.getAttribute&&t!==this.$view;){var s=null,n=Nt(t).toString();if(-1!=n.indexOf("webix_cell")&&(s=this._locate(t))&&(s.row=this.data.order[s.rind]),-1!=n.indexOf("webix_hcell")&&(s=this._locate(t))&&(s.header=!0,s.span&&(s.cind-=s.span-1)),-1!=n.indexOf("webix_drop_area")&&(s=this._locate(t))&&(s.row=s.rind="$webix-drop"),s)return e?s.header?null:s.row:(s.column=this._columns[s.cind].id,s.toString=this._id_to_string,s);t=t.parentNode}return null},_locate:function(t){var e=t.parentNode;if(!e)return null;var i=1*(t.getAttribute("column")||e.getAttribute("column")),s=1*t.getAttribute("aria-rowindex");return{rind:t.getAttribute("row")||(s?s-1:0),cind:i,span:1*(t.getAttribute("colspan")||e.getAttribute("colspan"))}},_correctScrollSize:function(){for(var t=-this._center_width,e=0;e<this._columns.length;e++)t+=this._columns[e].width;this._scrollLeft=Math.min(this._scrollLeft,Math.max(0,t))},_updateColsSizeSettings:function(t){this._dtable_fully_ready&&(this._correctScrollSize(),this._set_columns_positions(),this._set_split_sizes_x(),this._render_header_and_footer(),this._set_split_sizes_y(),t||this._check_rendered_cols(!1,!1))},setColumnWidth:function(t,e,i){return this._setColumnWidth(this.getColumnIndex(t),e,i)},_setColumnWidth:function(t,e,i,s){if(!(isNaN(e)||t<0)){var n=this._columns[t];e=this._correctColumnWidth(e,n);var a=n.width;return a!=e&&(t>=this._settings.leftSplit&&t<this._rightSplit&&(this._dtable_width+=e-a),n.width=e,!!n.node&&(n.node.style.width=e+"px",i||this._updateColsSizeSettings(),this.callEvent("onColumnResize",[n.id,e,a,!!s]),!0))}},_correctColumnWidth:function(t,e){return t=Math.max(t,e.minWidth||this._settings.minColumnWidth||0),Math.min(t,e.maxWidth||this._settings.maxColumnWidth||1e5)},_getRowHeight:function(t){return(t.$height||this._settings.rowHeight)+(t.$subopen?t.$subHeight:0)},_getHeightByIndex:function(t){var e=this.data.order[t];return e?this._getRowHeight(this.data.pull[e]):this._settings.rowHeight},_getHeightByIndexSumm:function(t,e){if(this._settings.fixedRowHeight)return Math.max(e-t,0)*this._settings.rowHeight;for(var i=0;t<e;t++)i+=this._getHeightByIndex(t);return i},_cellPosition:function(t,e,i){t.row&&(e=t.column,t=t.row);var s=this.getColumnConfig(e).width,n=this.getItem(t).$height||this._settings.rowHeight;if(this.config.spans&&i){var a=this.getSpan(t,e);if(a){var r=this.getSpanNode({row:a[0],column:a[1]});s=r.offsetWidth,n=r.offsetHeight}}for(var o=0,l=0,h=0;h<this._columns.length;h++){h!=this._settings.leftSplit&&h!=this._rightSplit||(o=0);var c=this._columns[h];if(c.id==e){var d=h<this._settings.leftSplit?0:h>=this._rightSplit?2:1;l=this._body.childNodes[d].firstChild;break}o+=c.width}var u,_=this.getIndexById(t);if(_<this._settings.topSplit)u=this._getHeightByIndexSumm(0,_);else{var p=this._render_scroll_top||0;u=this._getHeightByIndexSumm(p,_)+(this._render_scroll_shift||0)+(_>=p?this._get_top_split_height():0)}return{parent:l,top:u,left:o,width:s,height:n}},_get_top_split_height:function(){return this._settings.topSplit?this._getHeightByIndexSumm(0,this._settings.topSplit):0},_get_total_height:function(){var t=this._settings.pager,e=0,i=this.data.order.length;return t&&(e=t.size*t.page,i=Math.min(i,e+t.size),t.level&&(e=this.data.$min,i=this.data.$max)),this._getHeightByIndexSumm(e,i)},setRowHeight:function(t,e){if(!isNaN(e)){e=Math.max(e,this._settings.minRowHeight||0),e=Math.min(e,this._settings.maxRowHeight||1e5);var i=this.getItem(t),s=i.$height||this._settings.rowHeight;s!=e&&(i.$height=e,this._settings.scrollAlignY=!1,this._settings.fixedRowHeight=!1,this.render(),this.callEvent("onRowResize",[t,e,s]))}},_onscroll_y:function(t){var e=this._scrollTop!==t;if(this._scrollTop=t,this._settings.prerender)if(Ot.touch)this._sync_y_scroll(-t,"0ms");else for(var i=this._body.childNodes,s=0;s<i.length;s++)i[s].scrollTop=t;else this._check_rendered_cols();Ot.$customScroll&&Li._update_scroll(this._body),e&&(this.callEvent("onScrollY",[]),this.callEvent("onAfterScroll",[]))},_setLeftScroll:function(t){if(this._scrollLeft=t,Ot.touch)return this._sync_x_scroll(-t,"0ms");this._body.childNodes[1].scrollLeft=t,this._settings.header&&(this._header.childNodes[1].scrollLeft=t),this._settings.footer&&(this._footer.childNodes[1].scrollLeft=t)},_onscroll_x:function(t){var e=this._scrollLeft!==t;this._renderDelay?this._delayedLeftScroll=t:this._setLeftScroll(t),this._settings.prerender||this._check_rendered_cols(!0),Ot.$customScroll&&Li._update_scroll(this._body),e&&(this.callEvent("onScrollX",[]),this.callEvent("onAfterScroll",[]))},_get_x_range:function(t){if(t)return[0,this._columns.length];for(var e=this._scrollLeft,i=this._settings.leftSplit;e>0&&this._columns.length-1>i;)e-=this._columns[i].width,i++;var s=i;for(e&&i>0&&i--,e+=this._center_width;e>0&&s<this._rightSplit;)e-=this._columns[s].width,s++;return[i,s]},getVisibleCount:function(){var t=this._settings.autoheight||this._settings.yCount?1:0;return Math.floor((this._dtable_offset_height+t)/this.config.rowHeight)},_get_y_range:function(t){var e=this._scrollTop,i=0,s=this.count(),n=this._settings.pager;n&&(i=n.page*n.size,s=Math.min(s,i+n.size),n.level&&(i=this.data.$min,s=this.data.$max));var a=i+this._settings.topSplit;if(t||this._settings.autoheight)return[a,s,0];var r=this._settings.fixedRowHeight?this._settings.rowHeight:0;if(r){var o=Math.ceil(e/r);e-=o*r,a+=o}else for(;e>0;)e-=this._getHeightByIndex(a),a++;var l=a>0&&e?-(this._getHeightByIndex(a-1)+e):0,h=a;if(e&&a--,e+=(this._dtable_offset_height||this._content_height)-this._get_top_split_height(),r){var c=Math.ceil(e/r);e-=c*r,h+=c}else for(;e>0&&h<s;)e-=this._getHeightByIndex(h),h++;return h>s&&(h=s),[a,h,l]},_repaint_single_row:function(t){var e=this.getItem(t),i=this.getIndexById(t),s=this._get_y_range(!0===this._settings.prerender),n=this._settings.topSplit,a="";if(i>=n){if(i<s[0]||i>=s[1])return;i-=s[0]-n}else a=i==n-1?" webix_topcell webix_last_topcell":" webix_topcell";for(var r=this._get_x_range(),o=0;o<this._columns.length;o++){var l=this._columns[o];if(o<this._rightSplit&&o>=this._settings.leftSplit&&(o<r[0]||o>r[1])&&(l._yr0=-999),l.attached&&l.node){var h=l.node.childNodes[i];if(!h)continue;var c=this._getValue(e,this._columns[o],0);h.innerHTML=c,h.className=this._getCss(this._columns[o],c,e,t)+a}}},_check_rendered_cols:function(t,e){if(this._columns.length&&!this._renderDelay){e&&this._clearColumnCache();var i=this._get_x_range(this._settings.prerender),s=this._get_y_range(!0===this._settings.prerender);if(t){for(var n=this._settings.leftSplit;n<i[0];n++)this._hideColumn(n,e);for(var a=i[1];a<this._rightSplit;a++)this._hideColumn(a,e)}this._render_full_rows=[];for(var r=0;r<this._settings.leftSplit;r++)this._renderColumn(r,s,e);for(var o=i[0];o<i[1];o++)this._renderColumn(o,s,e,o==i[0]);for(var l=this._rightSplit;l<this._columns.length;l++)this._renderColumn(l,s,e);this._check_and_render_full_rows(s[0],s[1],e),this._check_load_next(s)}},_delete_full_rows:function(t,e){this._rows_cache_start=t,this._rows_cache_end=e,wt(this._rows_cache),this._rows_cache=[]},_adjust_rows:function(){if(this._rows_body&&!this._touch_scroll&&this._settings.prerender){var t=this.getScrollState();this._rows_body.style.top="-"+(t.y||0)+"px"}},_check_and_render_full_rows:function(t,e,i){if(this._rows_body&&(this._rows_body.style.top=this._render_scroll_shift+"px"),i||t!=this._rows_cache_start||e!=this._rows_cache_end){if(this._delete_full_rows(t,e),this._render_full_row_some){this._render_full_row_some=!1;for(var s=0;s<this._render_full_rows.length;s++){var n,a=this._render_full_rows[s],r=this.getItem(a.id);n="function"==typeof r.$row?r.$row.call(this,r,this.type):this._getValue(r,this.getColumnConfig(r.$row),s);var o=this._rows_cache[s]=vt("DIV",null,n);o.className="webix_cell "+(r.$sub?"webix_dtable_sub"+(this._settings.subview?"view":"row"):"webix_dtable_colrow"+(r.$row?" webix_topcell"+(this.data.getMark(r.id,"webix_selected")?" webix_selected":""):"")),o.setAttribute("column",0),o.setAttribute("row",a.index);var l=r.$height||this._settings.rowHeight;r.$subopen?o.style.height=r.$subHeight+"px":o.style.height=l+"px",o.style.paddingRight=Ot.scrollSize+"px";var h=this._render_full_rows[s].index<this.config.topSplit?-this._render_scroll_shift:0;o.style.top=h+a.top+(r.$subopen?l-1:0)+"px",this._rows_body||(this._rows_body=vt("DIV"),this._rows_body.style.position="relative",this._rows_body.style.top=this._render_scroll_shift+"px",this._body.appendChild(this._rows_body),this.attachEvent("onSyncScroll",(function(t,e,i){Ii._set_matrix(this._rows_body,0,e,i)}))),this._rows_body.appendChild(o),this._settings.subview&&this.callEvent("onSubViewRender",[r,o])}}}else if(this.config.topSplit)for(var c=0;c<this._render_full_rows.length;c++){var d=this._rows_cache[c];this._render_full_rows[c].index<this.config.topSplit&&(d.style.top=this._render_full_rows[c].top-this._render_scroll_shift+"px")}},_check_load_next:function(t){var e=this._settings.pager,i=this._settings.datafetch,s=!this._last_valid_render_pos||t[0]>=this._last_valid_render_pos;if(this._last_valid_render_pos=t[0],this._data_request_flag){if(e&&(!i||i>=e.size)&&this._check_rows([0,e.size*e.page],Math.max(i,e.size),!0))return this._data_request_flag=null;this._run_load_next(this._data_request_flag,s),this._data_request_flag=null}else this._settings.loadahead&&this._check_rows(t,this._settings.loadahead,s)},_check_rows:function(t,e,i){var s=t[1],n=s+e;i||(s=t[0]-e,n=t[0]),s<0&&(s=0),n=Math.min(n,this.data.order.length-1);for(var a=!1,r=s;r<n;r++)this.data.order[r]||(a?(a.last=r,a.count=r-s):a={start:r,count:n-s});if(a)return this._run_load_next(a,i),!0},_run_load_next:function(t,e){var i=Math.max(t.count,this._settings.datafetch||this._settings.loadahead||0),s=e?t.start:t.last-i+1;this._maybe_loading_already(t.count,t.start)||this.loadNext(i,s)},_preserveScrollTarget:function(t){if(Ot.isSafari){var e,i,s,n,a=[this._x_scroll,this._y_scroll];for(e=0;e<2;e++)(n=a[e])&&n._scroll_trg&&n._scroll_trg.parentNode==t&&(i=n._scroll_trg);i&&(this._scrollWheelTrg&&wt(this._scrollWheelTrg),this._scrollWheelTrg=i,s=i.cloneNode(!0),i.parentNode.insertBefore(s,i),this._scrollWheelTrg.style.display="none",this._body.appendChild(this._scrollWheelTrg))}},_hideColumn:function(t){var e=this._columns[t];this._preserveScrollTarget(e.node),wt(e.node),e.attached=!1},_clearColumnCache:function(){for(var t=0;t<this._columns.length;t++)this._columns[t]._yr0=-1;this._rows_cache.length&&(wt(this._rows_cache),this._rows_cache=[])},getText:function(t,e){return this._getValue(this.getItem(t),this.getColumnConfig(e),0)},getCss:function(t,e){var i=this.getItem(t);return this._getCss(this.getColumnConfig(e),i[e],i,t)},_getCss:function(t,i,s,n){var a="webix_cell";if(t.cssFormat){var r=t.cssFormat(i,s,n,t.id);r&&("object"==e(r)?a+=" "+ft(r):a+=" "+r)}var o=s.$css;o&&("object"==e(o)&&(s.$css=o=ft(o)),a+=" "+o);var l=this.data._marks[n];if(l&&(l.$css&&(a+=" "+l.$css),l.$cellCss)){var h=l.$cellCss[t.id];h&&(a+=" "+h)}if(s.$cellCss){var c=s.$cellCss[t.id];c&&("object"==e(c)&&(c=ft(c)),a+=" "+c)}var d=this.data.getMark(s.id,"webix_selected");return(d&&(d.$row||d[t.id])||t.$selected)&&(a+=this._select_css),a},_getValue:function(t,e,i){return t?(null==(s=t[e.id])&&(s=""),e.format&&(s=e.format(s)),e.template&&(s=e.template(t,this.type,s,e,i)),s):"";var s},type:{checkbox:function(t,e,i,s){return"<input class='webix_table_checkbox' type='checkbox' "+(i==s.checkValue?'checked="true"':"")+">"},radio:function(t,e,i,s){return"<input class='webix_table_radio' type='radio' "+(i==s.checkValue?'checked="true"':"")+">"},editIcon:function(){return"<span class='webix_icon wxi-pencil'></span>"},trashIcon:function(){return"<span class='webix_icon wxi-trash'></span>"}},type_setter:function(e){return this.types&&this.types[e]?(this.type=S(this.types[e]),this.type.css&&(this._contentobj.className+=" "+this.type.css)):ge(this,e),this.type.on_click&&t.extend(this.on_click,this.type.on_click),e},_renderColumn:function(t,e,i,s){var n=this._columns[t];if(!n.attached){var a=t<this._settings.leftSplit?0:t>=this._rightSplit?2:1;this._body.childNodes[a].firstChild.appendChild(n.node),n.attached=!0,n.split=a}if(this._render_scroll_top=e[0],this._render_scroll_shift=0,this._render_scroll_diff=e[2],this._settings.scrollAlignY?e[1]==this.data.order.length||this.data.$pagesize&&e[1]%this.data.$pagesize==0?n.node.style.top=(this._render_scroll_shift=e[2])+"px":n._yr2&&(n.node.style.top="0px"):(this._render_scroll_shift=e[2],n.node.style.top=e[2]+"px"),!(i||n._yr0!=e[0]||n._yr1!=e[1]||this._settings.topSplit&&n._render_scroll_shift!=this._render_scroll_shift))return 0;for(var r="",o=this._settings.columns[t],l={row:this._settings.rowHeight,total:0,single:s},h=0;h<this._settings.topSplit;h++)r+=this._render_single_cell(h,o,e,l,-this._render_scroll_shift,t);this._data_request_flag=null;for(var c=Math.max(e[0],this._settings.topSplit);c<e[1];c++)r+=this._render_single_cell(c,o,e,l,-1,t);return this._preserveScrollTarget(n.node),n.node.innerHTML=r,n._yr0=e[0],n._yr1=e[1],n._yr2=e[2],n._render_scroll_shift=this._render_scroll_shift,1},_render_single_cell:function(t,e,i,s,n,a){var r=this.data.order[t],o=this.data.getItem(r),l="";if(o){var h=" role='gridcell' aria-rowindex='"+(t+1)+"' aria-colindex='"+(this.getColumnIndex(e.id)+1)+"'"+(o.$count||o.$sub?" aria-expanded='"+(o.open||o.$subopen?"true":"false")+"'":"")+(o.$level?" aria-level='"+o.$level+"'":"");if(s.single&&o.$row&&(this._render_full_row_some=!0,this._render_full_rows.push({top:s.total,id:o.id,index:t}),!o.$sub)){var c=o.$height||s.row;return s.total+=c,"<div"+h+" class='webix_cell' style='height:"+c+"px;'></div>"}var d=this._getValue(o,e,t),u=this._getCss(e,d,o,r),_=" aria-selected='true' tabindex='0'";-1!==u.indexOf("select")&&(-1!==u.indexOf("row")?this._get_x_range()[0]===a&&(h+=_):-1!==u.indexOf("col")?t===i[0]&&(h+=_):h+=_);var p=!!o.$subopen,f=p?"margin-bottom:"+o.$subHeight+"px;":"";n>=0&&(n>0&&(f+="top:"+n+"px;'"),u="webix_topcell "+u,t==this._settings.topSplit-1&&(u="webix_last_topcell "+u)),o.$height?(l="<div"+h+" class='"+u+"' style='height:"+o.$height+"px;"+f+"'>"+d+"</div>",s.total+=o.$height-s.row):l="<div"+h+" class='"+u+"'"+(f?" style='"+f+"'":"")+">"+d+"</div>",p&&(s.total+=o.$subHeight)}else l="<div role='gridcell' class='webix_cell'></div>",this._data_request_flag?this._data_request_flag.last=t:this._data_request_flag={start:t,count:i[1]-t};return s.total+=s.row,l},_set_split_sizes_y:function(){if(this._columns.length&&!isNaN(1*this._content_height)){x(this,["y-sizing"],!0);var t=this._dtable_height+(this._scrollSizeX?this._scrollSizeX:0);if(!this._settings.autoheight&&!this._settings.yCount||!this.resize()){this._y_scroll.sizeTo(this._content_height,this._header_height,this._footer_height),this._y_scroll.define("scrollHeight",t),this._dtable_offset_height=Math.max(0,this._content_height-this._scrollSizeX-this._header_height-this._footer_height);for(var e=0;e<3;e++)this._body.childNodes[e].style.height=this._dtable_offset_height+"px",this._settings.prerender?this._body.childNodes[e].firstChild.style.height=this._dtable_height+"px":this._body.childNodes[e].firstChild.style.height=this._dtable_offset_height+"px";this._header.style.height=this._header_height+"px"}}},_set_split_sizes_x:function(){if(this._columns.length){var t=0;for(this._left_width=0,this._right_width=0,this._center_width=0;t<this._settings.leftSplit;)this._left_width+=this._columns[t].width,t++;for(t=this._columns.length-1;t>=this._rightSplit;)this._right_width+=this._columns[t].width,t--;if(this._content_width&&(!this._settings.autowidth||!this.resize())){this._center_width=this._content_width-this._right_width-this._left_width-this._scrollSizeY,this._body.childNodes[1].firstChild.style.width=this._dtable_width+"px",this._body.childNodes[0].style.width=this._left_width+"px",this._body.childNodes[1].style.width=this._center_width+"px",this._body.childNodes[2].style.width=this._right_width+"px",this._header.childNodes[0].style.width=this._left_width+"px",this._header.childNodes[1].style.width=this._center_width+"px",this._header.childNodes[2].style.width=this._right_width+"px",this._footer.childNodes[0].style.width=this._left_width+"px",this._footer.childNodes[1].style.width=this._center_width+"px",this._footer.childNodes[2].style.width=this._right_width+"px";var e=this._center_width-this._dtable_width;e<0&&(e=0),e!=this._header_fix_width&&(this._header_fix_width=e,this._size_header_footer_fix()),this._x_scroll.sizeTo(this._content_width-this._scrollSizeY),this._x_scroll.define("scrollWidth",this._dtable_width+this._left_width+this._right_width)}}},$getSize:function(t,e){if((this._settings.autoheight||this._settings.yCount)&&this._settings.columns){var i=(this._settings.yCount||0)*this._settings.rowHeight;i||(i=this.isVisible()?this._dtable_height:this.count()*this._settings.rowHeight),this._settings.height=Math.max(i+(this._scrollSizeX?this._scrollSizeX:0)-1,this._settings.minHeight||0)+this._header_height+this._footer_height}this._settings.autowidth&&this._settings.columns&&(this._settings.width=Math.max(this._dtable_width+this._left_width+this._right_width+this._scrollSizeY,this._settings.minWidth||0));var s=this._left_width+this._right_width+this._scrollSizeY,n=mi.api.$getSize.call(this,t,e);return n[0]=Math.max(n[0]||s),n},_restore_scroll_state:function(){if(this._x_scroll){var t=this.getScrollState();this._x_scroll.config.scrollPos=this._y_scroll.config.scrollPos=-1,this.scrollTo(t.x,t.y)}},$setSize:function(){var t=this._content_width,e=this._content_height;mi.api.$setSize.apply(this,arguments)&&(this._dtable_fully_ready&&(this.callEvent("onResize",[this._content_width,this._content_height,t,e]),this._set_split_sizes_x(),this._set_split_sizes_y()),this.render())},_on_header_click:function(t,e){var i=this.getColumnConfig(t);if(this._settings.sort&&i.sort){var s="asc";this._last_sorted[i.id]?s="asc"==this._last_sorted[i.id].dir?"desc":"asc":this._sort_signs[i.id]&&(s="asc"==this._sort_signs[i.id].getAttribute("webix_sort_dir")?"desc":"asc"),this._sort(i.id,s,i.sort,e.ctrlKey||e.metaKey)}},markSorting:function(t,e,i){if(e=e||"asc",!i)for(var s in this._sort_signs_order=[],this._sort_signs)if(s!==t){var n=this._sort_signs[s].parentNode;n&&(n.removeAttribute("aria-sort"),n.removeAttribute("tabindex")),wt(this._sort_signs[s]),delete this._sort_signs[s]}else this._sort_signs_order.push(s),this._sort_signs[s].firstChild.innerHTML="1";if(t){if(this._sort_signs[t])this._sort_signs[t].className="webix_ss_sort_".concat(e);else{var a=vt("div",{webix_sort_dir:e,class:"webix_ss_sort_".concat(e)},'<div class="webix_ss_sort_num">'.concat(this._sort_signs_order.length+1,"</div>"));this._render_single_mark(t,a,e),this._sort_signs[t]=a,this._sort_signs_order.push(t)}var r=this._sort_signs[this._sort_signs_order[0]];switch(this._sort_signs_order.length){case 1:Dt(r,"webix_ss_sort_single");break;case 2:Et(r,"webix_ss_sort_single")}}},_render_single_mark:function(t,e,i){i=i||e.getAttribute("webix_sort_dir");var s=this._get_header_cell(this.getColumnIndex(t));s&&("absolute"!=s.style.position&&(s.style.position="relative"),s.appendChild(e),s.setAttribute("aria-sort",i+"ending"),s.setAttribute("tabindex","0"))},scroll_setter:function(t){return"string"==typeof t?(this._settings.scrollX=-1!=t.indexOf("x"),this._settings.scrollY=-1!=t.indexOf("y"),t):this._settings.scrollX=this._settings.scrollY=t},_get_header_cell:function(t){for(var e=this._header.querySelectorAll("div[".concat("column",'="').concat(t,'"]')),i=null,s=e.length-1;s>=0;s--){var n=e[s],a=n.getAttribute("active_id");if(!a||Hn[this._active_headers[a].content].$icon){if(!n.getAttribute("colspan"))return n;i||(i=n)}}return i},_last_order:[],_last_sorted:{},_sort:function(t,e,i,s){var n=this,a=!0;e=e||"asc",(s="multi"===this._settings.sort&&s)||(this._last_order=[],this._last_sorted={});var r=this.getColumnConfig(t),o={by:r.id,dir:e,as:r.sort};if(this._last_sorted[r.id]||this._last_order.push(r.id),this._last_sorted[r.id]=o,"server"==i){var l=[r.id,e,i];this._last_order.length>1&&(l=[this._last_order.map((function(t){return n._last_sorted[t]}))]),this.callEvent("onBeforeSort",l)?this._skip_server_op?this._skip_server_op.$params=l:this.loadNext(0,0,0,0,!0,!0).then((function(){return n._on_after_sort(l)})):a=!1}else"text"!=i&&"text_locale"!=i||this._sort_text(o,r.id,i),a=this._last_order.length>1?this.data.sort(this._last_order.map((function(t){return n._last_sorted[t]}))):this.data.sort(o);a&&this.markSorting(r.id,o.dir,s)},_sort_text:function(t,e,i){var s=this,n="$".concat(i,"_").concat(e);this.data.each((function(t){return t[n]=s.getText(t.id,e)})),t.as="string"+(-1!=i.indexOf("locale")?"_locale":""),t.by=n},_on_after_sort:function(t){this.callEvent("onAfterSort",t)},_mouseEventCall:function(t,e,i,s){var n;if(t.length)for(n=0;n<t.length;n++)if(!1===P(t[n],this.$scope).call(this,e,i,s))return!1},_mouseEvent:function(t,e,i,s){var n=t.target;if(!this._settings.subview||this==ke(n)){for(var a="",r=[],o=!1,l=null;n&&n.parentNode&&this._viewobj&&n!=this._viewobj.parentNode;){if((a=Nt(n))&&e)for(var h=(a=a.toString().split(" ")).length-1;h>=0;h--)e[a[h]]&&r.push(e[a[h]]);if(n.parentNode.getAttribute&&!l){var c=n.parentNode.getAttribute("column")||n.getAttribute("column");if(c){var d=this._body.contains(n);if(!this._columns[c])return;if(o=!0,d){var u=n.parentNode.getAttribute("row")||n.getAttribute("row");if(!u){if(n.getAttribute("column"))return;(u=pt(n))>=this._settings.topSplit&&(this._settings.pager||!this._settings.prerender&&!this._settings.autoheight)&&(u+=this._columns[c]._yr0-this._settings.topSplit)}this._item_clicked=l={row:this.data.order[u],column:this._columns[c].id},l.toString=this._id_to_string}else this._item_clicked=l={column:this._columns[c].id};if(!1===this._mouseEventCall(r,t,l,n))return;d&&!this._body.contains(n)&&(n=this.getItemNode(l)),d?this.callEvent("on"+i,[l,t,n])&&s&&this.callEvent("on"+s,[l,t,n]):"ItemClick"==i&&this._header.contains(n)&&this.callEvent("onHeaderClick",[l,t,n])&&this._on_header_click(l.column,t),r=[]}}n=n.parentNode}return this._mouseEventCall(r,t,l,this.$view),o}},_get_tooltip_data:function(t,e){var i=this.locate(e);if(!i)return null;var s,n=$e._tooltip;if(i.header){for(var a,r=e.target,o=r,l=-1;o&&!a;)a=(o=o.parentNode).getAttribute("section");for(;r&&l<0;){var h=r.getAttribute("row");h&&(l=h),r=r.parentNode}var c=this._columns[i.cind][a][l];if(!c.tooltip)return null;n.type.template=le(!0===c.tooltip?"#text#":c.tooltip),s=c}else{var d=n.type.column=this.getColumnConfig(i.column);if(!d.tooltip&&void 0!==d.tooltip)return null;if(!0===d.tooltip||!d.tooltip&&E(this._settings.tooltip.template))s=this.getText(i.row,i.column).toString();else if(d.tooltip){var u=e.target.getAttribute("webix_area");n.type.template=u?function(t,e){var i=t[d.id];return le(d.tooltip).call(this,t,e,i[u],u)}:le(d.tooltip)}else n.type.template=le(this._settings.tooltip.template)}return void 0!==s?s:this.getItem(i.row)},$tooltipOut:function(){return $e._hide_tooltip(),delete $e._tooltip.type.column,null},showOverlay:function(t){if(!this._datatable_overlay){var e=vt("DIV",{class:"webix_overlay"},"");this._body.appendChild(e),this._datatable_overlay=e}this._datatable_overlay.innerHTML=t},hideOverlay:function(){this._datatable_overlay&&(wt(this._datatable_overlay),this._datatable_overlay=null)},mapCells:function(t,e,i,s,n,a){if(null===t&&this.data.order.length>0&&(t=this.data.order[0]),null===e&&(e=this.columnId(0)),null===i&&(i=this.data.order.length),null===s&&(s=this._settings.columns.length),this.exists(t)&&(t=this.getIndexById(t),null!==(e=this.getColumnIndex(e))))for(var r=0;r<i&&t+r<this.data.order.length;r++){var o=t+r,l=this.data.order[o];if(l)for(var h=this.getItem(l),c=0;c<s&&e+c<this._settings.columns.length;c++){var d=e+c,u=this.columnId(d),_=n(h[u],l,u,r,c);a||(h[u]=_)}}},_call_onparse:function(t,e){!this._settings.columns&&t.getConfig&&this.define("columns",t.getConfig(e))},_autoDetectConfig:function(){var t=this.getItem(this.getFirstId()),e=this._settings.columns=[];for(var i in t)"id"!=i&&"$"!=i[0]&&e.push({id:i,header:i[0].toUpperCase()+i.substr(1),sort:"string",editor:"text"});e.length&&(e[0].fillspace=!0),void 0===this._settings.select&&this.define("select","row")}},ho=t.protoUI(lo,Hr,Ki,Os,zi,ss,ds,gs,Oi,no,Xs,so,ao,Xi,io,to,Qr,Zr,Xr,Jr,Kr,Gr,Yr,ro,Wr,Ur,qr,{topSplit_setter:function(t){return this.data&&(this.data.$freeze=t),t},freezeRow:function(t,e){var i=this._settings.topSplit;if(!this._settings.pager&&this._dtable_fully_ready){if(t){var s=this.data.order,n=this.data._filter_order;t=t.toString(),i=this._moveFrozenRow(t,e,s,i),n&&this._moveFrozenRow(t,e,n,i,!0)}else e||(i=0);this.define("topSplit",i),this.refresh()}},_moveFrozenRow:function(t,e,i,s,n){var a=this.data.pull[t]?i.find(t):-1;if(e&&a>=s){n||s++;for(var r=a;r>=s;r--)i[r]=i[r-1];i[s-1]=t}if(!e&&a<s){n||s--;for(var o=a;o<s;o++)i[o]=i[o+1];i[s]=t}return s}},oo,xi,os,Ri,Gi,_s,us,mi.view,H,ai),co={api:lo,view:ho},uo={name:"excelviewer",$init:function(){var t=this;this.$ready.push((function(){this._settings.toolbar&&ke(this._settings.toolbar).attachEvent("onExcelSheetSelect",A(this.showSheet,this))})),this.data.attachEvent("onClearAll",(function(){delete t._activeSheet}))},defaults:{datatype:"excel"},$onLoad:function(t){if(t.sheets){this._excel_data=t,this._settings.toolbar&&ke(this._settings.toolbar).setSheets(t.names);var e=t.names[0];return this.showSheet(e.id||e),!0}return!1},$exportView:function(e){var i=e.export_mode;if("pdf"!=i&&"excel"!=i||e.dataOnly)return this;!0===e.sheets?e.sheets=this.getSheets().map((function(t){return t.id||t})):e.sheets&&e.sheets.length?"string"==typeof e.sheets&&(e.sheets=[e.sheets]):e.sheets=[this._activeSheet],e.dataOnly=!0,e.heights=E(e.heights)&&e.styles?"all":e.heights;for(var s=[],n=this._activeSheet,a=0;a<e.sheets.length;a++){var r=e.sheets[a],o=r.id||r,l=r.options?t.extend(I(r.options),e):I(e);l.name||(l.name=o),this.showSheet(o),o!=n&&(l._hidden=!0),"pdf"==i&&E(l.textBefore)&&(l.textBefore=l.name);var h="pdf"==i?hn(this,l):vn(this,l);l.styles&&(h[0].styles=this._getExportStyles(l)),"pdf"==i&&e.autowidth&&pn(l,e),s=s.concat(h)}return this.showSheet(n),delete e.dataOnly,s},showSheet:function(t){if(t!=this._activeSheet){this.clearAll();var e=this.data.driver.sheetToArray(this._excel_data.sheets[t],{spans:this._settings.spans}),i=this._settings.excelHeader,s={},n={};if(e.sizes)for(var a=0;a<e.sizes.length;a++)"column"==e.sizes[a][0]?s[e.sizes[a][1]]=Math.round(e.sizes[a][2]):"row"==e.sizes[a][0]&&(n[e.sizes[a][1]]=Math.round(e.sizes[a][2]));if(i)if(!0===i){i=e.data.splice(0,1)[0];for(var r=0;r<i.length;r++)i[r]={header:i[r],id:"data"+r,width:s[r],adjust:!s[r],editor:"text",sort:"string"}}else i=I(i);else{i=I(e.data[0]);for(var o=0;o<i.length;o++)i[o]={header:"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[o],id:"data"+o,width:s[o],adjust:!s[o],editor:"text",sort:"string"}}this.config.columns=i,this.refreshColumns(),this.parse(e,this._settings.datatype),this._activeSheet=t;var l=this._paintSpans(e.spans),h=this._paintRowHeight(n),c=this._paintStyles(e.styles,l);(l||h||c)&&this.refresh()}},getSheets:function(){return this._excel_data.names},_getSpanCss:function(t,e,i,s){for(var n=!1,a=0;a<t.length;a++)if(t[a][0]===e&&t[a][1]===i){t[a][5]=ft(this._toCellStyle(s)),this.addSpan(t[a][0],t[a][1],t[a][2],t[a][3],t[a][4],t[a][5]),n=!0;break}return n},_paintStyles:function(t,e){var i=0;if(t&&t.length){for(var s=0;s<t.length;s++){var n=t[s][0]-(this.config.excelHeader?1:0);if(n>=0){var a=this.getIdByIndex(n);if(this.exists(a)){var r=this.getItem(a),o=this.columnId(t[s][1]);o&&(e.length&&this._getSpanCss(e,a,o,t[s][2])||(r.$cellCss=r.$cellCss||{},r.$cellCss[o]=this._toCellStyle(t[s][2])),i++)}}}return i}return!1},_safeColor:function(t){return 8===(t=t||"000000").length&&(t=t.substring(2)),"#"+t},_toCellStyle:function(t){var e={};if(t.fill&&t.fill.fgColor&&(e["background-color"]=this._safeColor(t.fill.fgColor.rgb)),t.font){var i=t.font;i.name&&(e["font-family"]=i.name),i.sz&&(e["font-size"]=i.sz/.75+"px"),i.color&&i.color.rgb&&(e.color=this._safeColor(i.color.rgb)),i.bold&&(e["font-weight"]="bold"),i.underline&&(e["text-decoration"]="underline"),i.italic&&(e["font-style"]="italic"),i.strike&&(e["text-decoration"]="line-through")}if(t.alignment){var s=t.alignment;s.vertical&&"center"==s.vertical&&(e.display="flex",e["justify-content"]="flex-start",e["align-items"]="center"),s.vertical&&"bottom"==s.vertical&&(e.display="flex",e["justify-content"]="flex-end",e["align-items"]="flex-end"),s.horizontal&&(!s.vertical||"center"!=s.vertical&&"bottom"!=s.vertical?e["text-align"]=s.horizontal:e["justify-content"]="center"),s.wrapText&&(e["white-space"]="normal")}if(t.border){var n=t.border;n.top&&(e["border-top"]="1px solid "+this._safeColor(n.top.color.rgb)),n.bottom&&(e["border-bottom"]="1px solid "+this._safeColor(n.bottom.color.rgb)+" !important"),n.left&&(e["border-left"]="1px solid "+this._safeColor(n.left.color.rgb)),n.right&&(e["border-right"]="1px solid "+this._safeColor(n.right.color.rgb)+" !important")}return e},_paintRowHeight:function(t){var e=0;for(var i in t){var s=this.config.excelHeader?i-1:i;if(s>=0){var n=this.getIdByIndex(s);this.exists(n)&&(this.getItem(n).$height=t[i],e++)}}return this.config.fixedRowHeight=!e,e},_paintSpans:function(t){var e=[];if(this._settings.spans&&t&&t.length){this._spans_pull={};for(var i=0;i<t.length;i++)this.config.excelHeader&&t[i][0]--,t[i][0]>=0&&(t[i][0]=this.getIdByIndex(t[i][0]),t[i][1]="data"+t[i][1],e.push(t[i]));return this.addSpan(e),e}return!1}},_o=(t.protoUI(uo,co.view),{name:"pdfbar",reset:function(){this.setPage(0),this.setValues(0,"auto")},$init:function(t){this.$view.className+=" pdf_bar",t.cols=[{view:"button",type:"icon",css:"webix_transparent",icon:"wxi-angle-left",width:35,click:function(){this.getParentView()._navigate("prev")}},{view:"text",width:70,value:"0",on:{onBlur:function(){this.getParentView()._navigate(this.getValue())},onKeyPress:function(t){13===t&&this.getParentView()._navigate(this.getValue())}}},{template:R.PDFviewer.of+" #limit#",width:70,data:{limit:0},borderless:!0},{view:"button",type:"icon",css:"webix_transparent",icon:"wxi-angle-right",width:35,click:function(){this.getParentView()._navigate("next")}},{},{view:"button",type:"icon",css:"webix_transparent",icon:"wxi-minus",width:35,click:function(){this.getParentView().zoom("out")}},{view:"richselect",options:[],maxWidth:195,suggest:{padding:0,css:"pdf_opt_list",borderless:!0,body:{type:{height:25},scroll:!1,yCount:13}},on:{onChange:function(){this.getParentView().setMasterScale(this.getValue())}}},{view:"button",type:"icon",css:"webix_transparent",icon:"wxi-plus",width:35,click:function(){this.getParentView().zoom("in")}},{view:"button",type:"icon",css:"webix_transparent",icon:"wxi-download",width:35,click:function(){this.getParentView().download()}}],this.$ready.push(this._setScaleOptions)},_setScaleOptions:function(){var t=this.getChildViews()[6].getPopup().getBody();t.clearAll(),t.parse([{id:"auto",value:R.PDFviewer.automaticZoom},{id:"page-actual",value:R.PDFviewer.actualSize},{id:"page-fit",value:R.PDFviewer.pageFit},{id:"page-width",value:R.PDFviewer.pageWidth},{id:"page-height",value:R.PDFviewer.pageHeight},{id:"0.5",value:"50%"},{id:"0.75",value:"75%"},{id:"1",value:"100%"},{id:"1.25",value:"125%"},{id:"1.5",value:"150%"},{id:"2",value:"200%"},{id:"3",value:"300%"},{id:"4",value:"400%"}]);var e=0;t.data.each((function(t){e=Math.max(jt(t.value,"webixbutton").width,e)})),this.getChildViews()[6].define("width",e+20),this.getChildViews()[6].resize()},_navigate:function(t){this.setMasterPage(t),this.setPage(this.$master.$pageNum)},setScale:function(t){var e=this.getChildViews()[6];e.blockEvent(),e.getPopup().getList().exists(t)?e.setValue(t):(e.setValue(""),e.getInputNode().innerHTML=(100*t).toFixed(0)+"%"),e.unblockEvent()},setMasterScale:function(t){this.$master&&this.$master.setScale(t)},setMasterPage:function(t){this.$master&&("prev"===t?this.$master.prevPage():"next"===t?this.$master.nextPage():isNaN(parseInt(t))||this.$master.renderPage(parseInt(t)))},zoom:function(t){this.$master&&("out"===t?this.$master.zoomOut():"in"===t&&this.$master.zoomIn())},setPage:function(t){this.getChildViews()[1].setValue(t,"auto")},setValues:function(t,e){this.getChildViews()[2].data.limit=t,this.getChildViews()[2].refresh(),this.setScale(e)},download:function(){this.$master&&this.$master.download()}}),po=(t.protoUI(_o,Sa.view),{name:"pdfviewer",defaults:{scale:"auto"},$init:function(t){this.$view.className+=" webix_pdf";var e=document.createElement("DIV");e.className="canvas_wrapper";var i=document.createElement("canvas");this._currentPage=this.$view,this._container=this.$view.appendChild(e),this._canvas=this._container.appendChild(i),this.$pdfDoc=null,this.$pageNum=0,this.$numPages=0,this._pageRendering=!1,this._pageNumPending=null,this._ctx=this._canvas.getContext("2d"),this._init_scale_value=.1,this._default_scale_delta=t.scaleDelta||1.1,this._min_scale=t.minScale||.25,this._max_scale=t.maxScale||10,this._max_auto_scale=1.25,this._hPadding=40,this._vPadding=10,this._destroy_with_me=[],this.$ready.push(this._attachHandlers)},toolbar_setter:function(t){if("string"==typeof t){var e=ke(t);return e&&(e.$master=this,e.refresh()),this.attachEvent("onDocumentReady",(function(){e?(e.setPage(this.$pageNum),e.setValues(this.$numPages,this._settings.scale)):this.toolbar_setter(t)})),t}},_attachHandlers:function(){delete this._settings.datatype,this.attachEvent("onScaleChange",(function(t){this._settings.toolbar&&ke(this._settings.toolbar).setScale&&ke(this._settings.toolbar).setScale(t)})),this.attachEvent("onPageRender",(function(t){this._settings.toolbar&&ke(this._settings.toolbar).setPage&&ke(this._settings.toolbar).setPage(t)})),Ot.touch&&(this._touchDelta=!1,_e(this._viewobj,Ot.touch.down,this._pdf_touch_down,{bind:this}),this.attachEvent("onSwipeY",(function(t,e){if(!this._touchDelta){var i=this.$view.clientHeight,s=this.$view.scrollHeight,n=this.$view.offsetHeight,a=this.$view.scrollTop,r=e.y-t.y;if(i===s||r<0&&a>s-n||r>0&&0===a){var o=this.$pageNum+(r>0?-1:1);o>0&&o<=this.$numPages&&(this.$pageNum=o,this._queueRenderPage(this.$pageNum),this.$view.scrollTop=r>0?s:0)}}}))),_e(this.$view,"wheel",(function(t){t.ctrlKey&&(St(t),t.wheelDelta<0?this.zoomOut():this.zoomIn())}),{bind:this,passive:!1})},_get_touch_delta:function(t){var e=i(t,2),s=e[0],n=e[1];return Math.sqrt(Math.pow(s.pageX-n.pageX,2)+Math.pow(s.pageY-n.pageY,2))},_pdf_touch_down:function(t){var e=this;2===t.touches.length&&(this._touchDelta=this._get_touch_delta(t.touches),this._handle_touch_events=[pe(document.body,Ot.touch.move,(function(t){return e._pdf_touch_move(t)}),{passive:!1}),pe(document,Ot.touch.up,this._pdf_touch_up,{bind:this})],St(t))},_pdf_touch_move:function(t){if(t.touches.length>1){var e=this._get_touch_delta(t.touches);Math.abs(e-this._touchDelta)>150&&(e>this._touchDelta?this.zoomIn():this.zoomOut(),this._touchDelta=e),St(t)}},_pdf_touch_up:function(){fe(this._handle_touch_events[0]),fe(this._handle_touch_events[1]),this._handle_touch_events=this._touchDelta=!1},$onLoad:function(t){return window.PDFJS?this._getDocument(t):Gt([Ot.cdn+"/extras/pdfjs/compatibility.min.js",Ot.cdn+"/extras/pdfjs/pdf.min.js"],(function(){PDFJS.workerSrc=Ot.cdn+"/extras/pdfjs/pdf.worker.min.js",this._getDocument(t)}),this),!0},_getDocument:function(t){if(t.name){var e=new FileReader;e.onload=A((function(t){this._getDocument({data:t.target.result})}),this),e.readAsArrayBuffer(t)}else this._uploadDocument({data:t.data})},_uploadDocument:function(t){var e=this;return PDFJS.getDocument({data:t.data,password:t.password}).then((function(t){e.clear(),e.$pdfDoc=t,e.$numPages=e.$pdfDoc.numPages,e.$pageNum=1,e._renderPage(e.$pageNum).then((function(){e.callEvent("onDocumentReady")}))}),(function(i){"PasswordException"==i.name&&e._tryPassword(t)}))},getPopup:function(){var t=this;return this._passWin||(this._passWin=be({view:"window",position:"center",modal:!0,head:R.PDFviewer.enterPassword,body:{view:"form",elements:[{view:"text",name:"password",type:"password",invalidMessage:R.PDFviewer.passwordError,required:!0},{cols:[{view:"button",value:R.message.cancel,hotkey:"esc",click:function(){t.getPopup().hide()}},{view:"button",css:"webix_primary",value:R.message.ok,hotkey:"enter",click:function(){var e=t.getPopup(),i=e.getBody();i.validate()?(t._uploadDocument({data:t._protectedData,password:i.getValues().password}),e.hide()):i.focus()}}]}]},on:{onHide:function(){var e=t.getPopup().getBody();e.clear("auto"),e.clearValidation(),delete t._protectedData}}}),this._destroy_with_me.push(this._passWin)),this._passWin},_tryPassword:function(t){var e=this.getPopup(),i=e.getBody();this._protectedData=t.data,t.password&&(i.markInvalid("password"),i.setValues({password:t.password},!1,"auto")),e.show(),i.focus()},_getViewPort:function(t,e){var i=t.getViewport(e);return this._canvas.height=i.height,this._canvas.width=i.width,this._container.style.width=i.width+"px",this._container.style.height=i.height+"px",i},_renderPage:function(t){var e=this;return this._pageRendering=!0,this.$pdfDoc.getPage(t).then((function(t){var i=isNaN(parseFloat(e._settings.scale))?e._init_scale_value:e._settings.scale,s=e._getViewPort(t,i);i!==e._settings.scale&&(i=e._getScale(e._settings.scale),s=e._getViewPort(t,i),e._settings.scale=i);var n={canvasContext:e._ctx,viewport:s};return t.cleanupAfterRender=!0,t.render(n).promise.then((function(){e.callEvent("onPageRender",[e.$pageNum]),e._pageRendering=!1,null!==e._pageNumPending&&(e._renderPage(e._pageNumPending),e._pageNumPending=null)}))}))},_queueRenderPage:function(t){this._pageRendering?this._pageNumPending=t:this._renderPage(t)},renderPage:function(t){!this.$pdfDoc||t<=0||t>this.$numPages||(this.$pageNum=t,this._queueRenderPage(this.$pageNum))},prevPage:function(){this.$pageNum<=1||(this.$pageNum--,this._queueRenderPage(this.$pageNum))},nextPage:function(){this.$pageNum>=this.$numPages||(this.$pageNum++,this._queueRenderPage(this.$pageNum))},zoomIn:function(){var t=this._settings.scale;t=(t*this._default_scale_delta).toFixed(2),t=Math.ceil(10*t)/10,t=Math.min(this._max_scale,t),this.setScale(t)},zoomOut:function(){var t=this._settings.scale;t=(t/this._default_scale_delta).toFixed(2),t=Math.floor(10*t)/10,t=Math.max(this._min_scale,t),this.setScale(t)},_getScale:function(t){if(!isNaN(parseFloat(t)))return t;isNaN(parseFloat(this._settings.scale))&&(this._settings.scale=this._init_scale_value);var e=1,i=((this._currentPage.clientWidth-this._hPadding)*this._settings.scale/this._canvas.clientWidth).toFixed(2),s=((this._currentPage.clientHeight-this._vPadding)*this._settings.scale/this._canvas.clientHeight).toFixed(2);switch(t){case"page-actual":e=1;break;case"page-width":e=i;break;case"page-height":e=s;break;case"page-fit":e=Math.min(i,s);break;case"auto":var n=this._currentPage.clientWidth>this._currentPage.clientHeight?Math.min(s,i):i;e=Math.min(this._max_auto_scale,n)}return e},setScale:function(t){if(isNaN(parseFloat(t))){var e=this._getScale(t);this._setScale(e)}else this._setScale(t)},_setScale:function(t){this._settings.scale=t,this.renderPage(this.$pageNum),this.callEvent("onScaleChange",[t])},download:function(){if(this.$pdfDoc){var t=(this._settings.downloadName||"document")+".pdf";this.$pdfDoc.getData().then((function(e){Vt(PDFJS.createBlob(e,"application/pdf"),t)}))}},clear:function(){this.$pdfDoc&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._container.style.height=this._container.style.width=this._canvas.width=this._canvas.height=0,this._settings.scale="auto",this.$pageNum=this.$numPages=0,this.$pdfDoc.transport.startCleanup(),this.$pdfDoc.destroy(),this.$pdfDoc=null,this._settings.toolbar&&ke(this._settings.toolbar)&&ke(this._settings.toolbar).reset())},$customPrint:function(){if(this.$numPages)return this.$pdfDoc.getData().then((function(t){var e=PDFJS.createBlob(t,"application/pdf"),i=document.querySelector(".webix_print_pdf");i||(i=vt("iframe",{class:"webix_print_pdf"}),document.body.appendChild(i)),i.src=URL.createObjectURL(e),i.onload=function(){i.contentWindow.focus(),i.contentWindow.print()}}))}}),fo=(t.protoUI(po,H,Zt,mi.view),{name:"video",$init:function(t){t.id||(t.id=T()),this.$ready.push(this._init_video)},_init_video:function(){var t=this._settings;if(this._contentobj=vt("video",{class:"webix_view_video",style:"width:100%;height:100%;",autobuffer:"autobuffer"},""),t.poster&&(this._contentobj.poster=t.poster),t.src){"object"!=e(t.src)&&(t.src=[t.src]);for(var i=0;i<t.src.length;i++)this._contentobj.innerHTML+=' <source src="'+t.src[i]+'">'}t.controls&&(this._contentobj.controls=!0),t.autoplay&&(this._contentobj.autoplay=!0),this._viewobj.appendChild(this._contentobj)},getVideo:function(){return this._contentobj},defaults:{src:"",controls:!0}}),go=(t.protoUI(fo,mi.view),{name:"gage",defaults:{value:0,minRange:0,maxRange:100,minWidth:250,minHeight:200,smoothFlow:!0,scale:3,stroke:7},$init:function(){this.$ready.push(A(this._setDefaultView,this)),this.attachEvent("onDestruct",(function(){this._circleGradient=this._gageGradientPoint=this._gage=null}))},$setSize:function(t,e){mi.api.$setSize.call(this,t,e)&&this._refresh()},_refresh:function(){this._value=this.config.value;var t=this.$view.querySelector(".webix_gage_curves"),e=this.$view.querySelector(".webix_gage_info"),i=this.config.scale,s=Math.min(this.$width,this.$height),n=s/100*this.config.stroke,a=s/i;if(t.setAttribute("r",a),t.setAttribute("strokeDasharray",Math.round(Math.PI*a)),t.style.r=a,t.style.strokeDasharray=Math.round(Math.PI*a),t.style["stroke-width"]=n+"px",e.setAttribute("style","width: "+Math.round(2*a)+"px;"),this._gage.setAttribute("style","height: "+Math.round(a+n)+"px;"),this._circleGradient.setAttribute("r",a),this._circleGradient.setAttribute("style","stroke-dasharray: "+Math.round(this.gradientLength*Math.PI*a)+", 1900; stroke-width:"+n+"px"),E(this._isFontSize))if(this.$view.className.indexOf("webix_gage_small_font")<0){var r=jt(this._format(this.config.maxRange),"webix_gage_value").width;this._isFontSize=r<a,this._isFontSize||(this.$view.className+=" webix_gage_small_font")}else this._isFontSize=!1;this._draw_line(a),this._animate()},_safeValue:function(t){return Math.min(Math.max(t,this._settings.minRange),this._settings.maxRange)},_draw_line:function(t){var e=this.$width,i=Math.min(this.$width,this.$height)/100*this.config.stroke,s=this._isFontSize?i:5;this._gageGradientPoint.style.transformOrigin=e/2+"px 0 0",this._gageGradientPoint.setAttribute("y1","0"),this._gageGradientPoint.setAttribute("x1",Math.round(e)/2+s),this._gageGradientPoint.setAttribute("y2","0"),this._gageGradientPoint.setAttribute("x2",Math.round((e+i)/2+t))},_animate:function(){var t=this.config.value,e=this.$view.querySelector(".webix_gage_value"),i=this._safeValue(t)-this.config.minRange,s=Math.round(180*i/(this.config.maxRange-this.config.minRange)),n=Math.min(this.$width,this.$height);this._isFontSize&&(this.$view.style.fontSize=Math.floor(n/8)+"px"),e.innerHTML=this._format(t),this._circleGradient.style.stroke=this.color,this._circleGradient.setAttribute("stroke",this.color),this._gageGradientPoint.setAttribute("transform","rotate("+s+" "+this.$width/2+" 0)"),this._gageGradientPoint.style.transform="rotate("+s+"deg)"},_setDash:function(){f(this.config.minRange<this.config.maxRange,"Invalid Range Values"),this.gradientLength=(this._safeValue(this.config.value)-this.config.minRange)/(this.config.maxRange-this.config.minRange);var t=this.config.color;this.color=t?"function"==typeof t?t.call(this,this.config.value):t:"hsl("+(120-Math.round(120*this.gradientLength))+", 100%, 50%)",!0===this.config.animation?this.defaultColor="hsl(125, 100%, 50%)":this.defaultColor="hsl("+(120-Math.round(120*this.gradientLength))+", 100%, 50%)"},_setDefaultView:function(){var t=this.config,e=t.smoothFlow&&Ot.svganimation&&!Ot.isEdge;this.gradientLength=0,this._setDash(),this.$view.innerHTML='<div class="webix_gage_box"><div>\n\t\t\t<div class="webix_gage_label"><span>'.concat(t.label||"",'</span></div>\n\t\t\t<svg class="webix_gage_body" style="height:300px; position: relative;">\n\t\t\t\t<circle class="webix_gage_curves" r="0" cx="50%" cy="0" stroke="#EEEEEE" fill="none"></circle>\n\t\t\t\t<circle class="webix_gage_gradient').concat(e?" webix_gage_animated":"",'" r="0" stroke=').concat(this.defaultColor,' cx="50%" cy="0" fill="none" style="stroke-dasharray: 0, 1900;"></circle>\n\t\t\t\t<line class="webix_gage_gradient_point').concat(e?" webix_gage_gradient_point_animated":"",'" x1="0" x2="0" y1="0" y2="0" style="stroke:#B0B0B0; stroke-width:4;"></line>\n\t\t\t</svg>\n\t\t\t<div class="webix_gage_info">\n\t\t\t\t<div class="webix_gage_min_range">').concat(this._format(t.minRange),'</div>\n\t\t\t\t<div class="webix_gage_max_range">').concat(this._format(t.maxRange),'</div>\n\t\t\t\t<div class="webix_gage_placeholder">\n\t\t\t\t\t<div class="webix_gage_value">').concat(this._format(t.value),'</div>\n\t\t\t\t\t<div class="webix_gage_range_info">').concat(t.placeholder||"","</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div></div>"),this._circleGradient=this.$view.querySelector(".webix_gage_gradient"),this._gageGradientPoint=this.$view.querySelector(".webix_gage_gradient_point"),this._gage=this.$view.querySelector(".webix_gage_body")},_format:function(t){var e=this.config.format;return e?e(t):t},refresh:function(){var t=this.config.value;this.config.smoothFlow&&t!=this._value&&(this.config.value=this._value),this._setDefaultView(),this._refresh(),this._value!=t&&this._viewobj.parentNode.clientHeight&&this.setValue(t)},setValue:function(t){this.config.value=t,this._setDash(),this._refresh()},getValue:function(){return this.config.value}}),mo=(t.protoUI(go,H,mi.view),{name:"barcode",defaults:{type:"ean13",height:160,width:220,paddingY:10,paddingX:20,textHeight:20,ariaLabel:"bars"},$init:function(){this.$view.className+=" webix_barcode",this.types||(this.types={default:this.type},this.type.name="default"),this.type=S(this.type)},$skin:function(){this.defaults.color="contrast"==bi||"dark"==bi?"#ffffff":"#000000"},type:{},render:function(){this.isVisible(this._settings.id)&&(this.canvas&&this.canvas.clearCanvas(!0),this.$view.innerHTML="",this._renderCanvas())},_renderCanvas:function(){this.canvas=new ki({container:this.$view,name:this.name,title:this._settings.ariaLabel,width:this.$width,height:this.$height}),this._drawBars()},_drawBars:function(){var t,e,i,s,n=this._settings.value,a=this._settings.type;if(!a||!this.types[a]||!n)return!1;if(s=(t=this.type.encode(n)).length,e=this.canvas.getCanvas(),s){var r=(this.$width-2*this.config.paddingX)/s,o=0;for(i=0;i<s;i++)parseInt(t.charAt(i),10)?(o++,i==s-1&&this._drawBar(e,i+1,r,o,s)):o&&(this._drawBar(e,i,r,o,s),o=0);this._addText(n,r)}},_drawBar:function(t,e,i,s,n){var a,r,o,l;r=parseInt(e*i+this.config.paddingX,10),a=parseInt(r-s*i,10),o=this.config.paddingY,l=this.$height-this.config.paddingY-this.config.textHeight,this._isEAN()&&(e<4||e>n-4||e<n/2+2&&e>n/2-2)&&(l+=this.config.textHeight/2),t.fillStyle=this.config.color,t.beginPath(),t.moveTo(a,o),t.lineTo(r,o),t.lineTo(r,l),t.lineTo(a,l),t.lineTo(a,o),t.fill()},_addText:function(t,e){var i,s,n;if(this.type.template&&(t=this.type.template(t)),this._isEAN()){if(this.type.firstDigit&&(this.canvas.renderTextAt(!0,"left",this.config.paddingX,this.$height-this.config.paddingY,t.charAt(0)),t=t.slice(1)),s=t.length,this.type.lastDigit&&s--,s){var a=(this.$width-2*this.config.paddingX-11*e)/s;for(i=0;i<s;i++)n=this.config.paddingX+i*a+(i<s/2?3:8)*e+a/2,this.canvas.renderTextAt(!0,!0,n,this.$height-this.config.paddingY,t.charAt(i));this.type.lastDigit&&(n=this.config.paddingX+s*a+11*e,this.canvas.renderTextAt(!0,!1,n,this.$height-this.config.paddingY,t.charAt(s)))}}else this.canvas.renderTextAt(!0,!0,this.$width/2,this.$height-this.config.paddingY,t)},setValue:function(t){this._settings.value=t,this.render()},getValue:function(){var t=this._settings.value;return this.type.template?this.type.template(t):t},type_setter:function(t){return this.types[t]?(this.type=S(this.types[t]),this.type.css&&(this._contentobj.className+=" "+this.type.css)):this.customize(t),t},_isEAN:function(){var t=this.config.type;return 0===t.indexOf("ean")||-1!=t.indexOf("upcA")},$setSize:function(t,e){mi.api.$setSize.call(this,t,e)&&this.render()}}),vo=t.protoUI(mo,mi.view);ge(vo,{name:"upcA",firstDigit:!0,lastDigit:!0,encode:function(t){return t.length<12&&(t="0"+t),bo.encode(t)},template:function(t){return t.replace(/[^0-9]/g,"").substring(0,11)+this.checksum(t)},checksum:function(t){return t.length<12&&(t="0"+t),bo.checksum(t)}}),ge(vo,{name:"ean8",encodings:[["0001101","1110010"],["0011001","1100110"],["0010011","1101100"],["0111101","1000010"],["0100011","1011100"],["0110001","1001110"],["0101111","1010000"],["0111011","1000100"],["0110111","1001000"],["0001011","1110100"]],encode:function(t){var e,i;if(7!=(t=t.replace(/[^0-9]/g,"").substring(0,7)).length)return"";for(t+=this.checksum(t),e="101",i=0;i<4;i++)e+=this.encodings[parseInt(t.charAt(i),10)][0];for(e+="01010",i=4;i<8;i++)e+=this.encodings[parseInt(t.charAt(i),10)][1];return e+"101"},template:function(t){return t.replace(/[^0-9]/g,"").substring(0,7)+this.checksum(t)},checksum:function(t){t=t.substring(0,7);var e,i=!0,s=0;for(e=0;e<7;e++)s+=(i?3:1)*parseInt(t.charAt(e),10),i=!i;return((10-s%10)%10).toString()}});var bo={name:"ean13",firstDigit:!0,encodings:[["0001101","0100111","1110010","000000"],["0011001","0110011","1100110","001011"],["0010011","0011011","1101100","001101"],["0111101","0100001","1000010","001110"],["0100011","0011101","1011100","010011"],["0110001","0111001","1001110","011001"],["0101111","0000101","1010000","011100"],["0111011","0010001","1000100","010101"],["0110111","0001001","1001000","010110"],["0001011","0010111","1110100","011010"]],encode:function(t){var e,i,s;if(12!=(t=t.replace(/[^0-9]/g,"").substring(0,12)).length)return"";for(t+=this.checksum(t),e="101",i=this.encodings[parseInt(t.charAt(0),10)][3],s=1;s<7;s++)e+=this.encodings[parseInt(t.charAt(s),10)][parseInt(i.charAt(s-1),10)];for(e+="01010",s=7;s<13;s++)e+=this.encodings[parseInt(t.charAt(s),10)][2];return e+"101"},template:function(t){return t.replace(/[^0-9]/g,"").substring(0,12)+this.checksum(t)},checksum:function(t){var e,i=!1,s=0;for(t=t.substring(0,12),e=0;e<12;e++)s+=(i?3:1)*parseInt(t.charAt(e),10),i=!i;return((10-s%10)%10).toString()}};ge(vo,bo);var wo,yo,xo,ko,Co={name:"bullet",defaults:{color:"#394646",marker:!1,markerColor:"rgba(0,0,0,0.5)",layout:"x",barWidth:40,minBarHeight:0,flowTime:500,labelWidth:150,minRange:0,maxRange:100,stroke:8,value:0,smoothFlow:!0,tickSize:10,origin:0,bands:[{value:100,color:"#5be5d6"},{value:80,color:"#fff07e"},{value:60,color:"#fd8b8c"}],scale:{step:10}},label_setter:le,placeholder_setter:le,$init:function(t){var e=E(t.tickSize)?this.defaults.tickSize:t.tickSize;t&&(t.layout&&"x"!=t.layout||!E(t.height)||(t.height=!1===t.scale?60:e?76+e:74),"y"==t.layout&&E(t.width)&&(t.width=!1===t.scale?60:e?87+e:87))},scale_setter:function(t){return t&&(t.step=t.step||10,t.template=le(t.template||"#value#")),t},$setSize:function(t,e){if(mi.api.$setSize.call(this,t,e)){var i=this._settings;this._setDefaultView("y"==i.layout?e:t);var s=i.origin;(i.value||0===i.value)&&this._animate(s,i.value)}},_safeValue:function(t){return Math.min(Math.max(t,this._settings.minRange),this._settings.maxRange)-this._settings.minRange},_animateFrame:function(t){var e=this._settings;this._dt=t-(this._time||t),this._time=t;var i=e.flowTime>this._dt?e.flowTime/this._dt:e.flowTime;(i>1e3||i<5)&&(i=30);var s,n=e.value,a=(n-this._prevValue)/i;this._nowValue+=a,Math.abs(this._nowValue-n)<Math.abs(a)&&(this._nowValue=n),this._nowValue!=n?this._requestId=requestAnimationFrame(this._animateFrame.bind(this)):(cancelAnimationFrame(this._requestId),this._requestId=null,s=!0),this._drawValue(this._nowValue,s)},_animate:function(t,e){this._prevValue=this._nowValue=t,this._settings.value=this._value=e,this.isVisible()&&this._settings.smoothFlow&&window.requestAnimationFrame?this._requestId||(this._requestId=requestAnimationFrame(this._animateFrame.bind(this))):this._drawValue(e,!0)},_drawValue:function(t,e){var i=this._settings,s=this._getValuePos(t),n=this._getValuePos(i.origin),a=this._bulletValue.style,r=s-n;r<0?(r=Math.abs(r),a.x=s):a.x=n,i.minBarHeight&&e&&t==i.origin&&(r=i.minBarHeight),a.width=r,a.fill=this._getColor(t)},_getColor:function(t){var e=this._settings.color;return"function"==typeof e?e(t):e},_setAttr:function(t,e,i){for(var s=0;s<e.length;s++)t.setAttribute(e[s],i[s])},_createNS:function(t,e,i){var s=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&this._setAttr(s,e,i),s},_dom:function(t){var e=this._createNS(t[0],t[1],t[2]),i=t[3];if(i)for(var s=0;s<i.length;s++)e.appendChild(this._dom(i[s]));return e},_getValuePos:function(t){return this._leftStart+Math.floor(this._safeValue(t)*this._scale)},_setView:function(){var t=this._settings,e="y"==t.layout,i="d"+T(),s=this._createNS("svg",["class"],["webix_bullet_graph_svg"]),n=this._createNS("g"),a=this._createNS("g"),r=this._createNS("rect",["y","height","class","style"],[this._topStart,t.stroke,"webix_bullet_value","filter:url(#"+i+");"]),o=this._createNS("text",["text-anchor","stroke"],["end","none"]),l=e?"50%":this._leftStart-10,h=e?11:17,c=this._createNS("tspan",["x","y","class"],[l,h,"webix_bullet_header"]),d=this._createNS("tspan",["x","y","class"],[l,h+17,"webix_bullet_subheader"]),u=this._dom(["filter",["id","x","y","width","height"],[i,"0","-150%","110%","400%"],[["feOffset",["in","dx","dy"],["SourceAlpha",0,0]],["feGaussianBlur",["stdDeviation"],["2"]],["feComponentTransfer",0,0,[["feFuncA",["type","slope"],["linear","0.5"]]]],["feMerge",0,0,[["feMergeNode"],["feMergeNode",["in"],["SourceGraphic"]]]]]]);s.appendChild(u);var _=document.createElement("div");if(n.appendChild(a),!1!==t.marker){var p=this._createNS("rect",["x","height","fill","class"],[this._getValuePos(t.marker)-2,t.barWidth-10,t.markerColor,"webix_bullet_marker"]);n.appendChild(p)}n.appendChild(r),o.appendChild(c),o.appendChild(d),s.appendChild(o);var f=t.tickSize;if(t.scale){for(var g=this._createNS("text",["class"],["webix_bullet_scale"]),m=this._createNS("g",["class"],["webix_bullet_scale_lines"]),v=this._leftStart,b=t.minRange;b<=t.maxRange;b+=t.scale.step){var w=Math.max(b-t.minRange,0),y=Math.floor(w*this._scale-(w?.1:-1)),x=e?(this.$width-t.barWidth)/2+(f?2-f:4):y+v,k=e?this._chartWidth+v-y+6:t.barWidth+(f?16+f:14),C=e?-4:t.barWidth+3+f,$=e?"end":"middle",S=this._createNS("tspan",["x","y","text-anchor"],[x,k,$]),I=this._createNS("line",["x1","y1","x2","y2","stroke-width"],[y+v,C,y+v,C-f,1]);_.innerHTML=t.scale.template({value:b}),S.appendChild(_.childNodes[0]),g.appendChild(S),m.appendChild(I)}e&&g.setAttribute("text-anchor","right"),n.appendChild(m),s.appendChild(g)}for(var A=0;A<t.bands.length;A++){var D=t.bands[A],E=this._createNS("path"),j=this._safeValue(D.value)*this._scale;E.setAttribute("d","M "+this._leftStart+",0 l "+j+",0 l 0,"+t.barWidth+" l -"+j+",0 z"),E.setAttribute("fill",D.color),a.appendChild(E)}if(s.appendChild(n),e){var V=t.scale?this.$width/2-10:0,N=this.$height+this._leftStart-28;n.setAttribute("transform","translate("+V+", "+N+") rotate(270)"),o.setAttribute("text-anchor","middle"),o.childNodes[0].setAttribute("x","55%"),o.childNodes[1].setAttribute("x","55%")}return s.setAttribute("viewBox","0 0 "+this.$width+" "+this.$height),s},_setDefaultView:function(t){var e=this._settings;f(e.minRange<e.maxRange,"Invalid Range Values"),t=t||("x"==e.layout?this.$width:this.$height);var i=this.$view;i.innerHTML="";var s=e.label&&e.label(e)||e.placeholder&&e.placeholder(e);this._leftStart=s?e.labelHeight||e.labelWidth:7,this._topStart=Math.floor((e.barWidth-e.stroke)/2),this._chartWidth=t-this._leftStart-30,this._scale=this._chartWidth/(e.maxRange-e.minRange);var n=this._setView();n.setAttribute("height",this.$height),n.setAttribute("width",this.$width),i.appendChild(n),this._bulletValue=i.querySelector(".webix_bullet_value");var a=e.label;a&&(i.querySelector(".webix_bullet_header").textContent=a(e));var r=e.placeholder;r&&(i.querySelector(".webix_bullet_subheader").textContent=r(e))},refresh:function(){this._setDefaultView(),this._animate(this._value,this._settings.value)},setValue:function(t){this._settings.value!=t&&this._animate(this._settings.value,t)},getValue:function(){return this._settings.value}},$o=(t.protoUI(Co,mi.view),{name:"geochart",defaults:{chart:{displayMode:"auto",region:"world",resolution:"countries"}},$init:function(e){this.$view.innerHTML="<div class='webix_map_content' style='width:100%;height:100%'></div>",this._contentobj=this.$view.firstChild,this._waitMap=d.defer(),e.chart=t.extend(e.chart||{},this.defaults.chart),this.data.provideApi(this,!0),this.$ready.push(this.render),this._drawData(),this.data.attachEvent("onClearAll",A(this._refreshColumns,this)),this.data.attachEvent("onStoreUpdated",A(this._drawData,this))},$skin:function(){this.defaults.chart.backgroundColor=vi.backColor},getMap:function(t){return t?this._waitMap:this._map},_getCallBack:function(t){return A((function(){"function"==typeof t&&t(),wo=wo||window.google,this._initMap()}),this)},render:function(){void 0===window.google||void 0===window.google.charts?(yo||((yo=document.createElement("script")).type="text/javascript",yo.src="//www.gstatic.com/charts/loader.js",document.getElementsByTagName("head")[0].appendChild(yo)),yo.onload=this._getCallBack(yo.onload)):this._getCallBack()()},_initMap:function(){wo.visualization&&wo.visualization.GeoChart?(this._map=new wo.visualization.GeoChart(this._contentobj),this._mapEvents(),this._waitMap.resolve(this._map)):(wo.charts.load("current",{packages:["geochart"],mapsApiKey:this._settings.key}),wo.charts.setOnLoadCallback(A((function(){this._initMap()}),this)))},$onLoad:function(t){return!this._map&&(this._waitMap.then(A((function(){this.parse(t,this._settings.datatype)}),this)),!0)},_drawData:function(){if(this._map){var t=this._columns&&this._columns.length?this._columns:this._defineColumns(),e=[];if(this.data.each((function(i){for(var s=[],n=0;n<t.length;n++){var a=i[t[n].label];"number"==t[n].type?a*=1:"tooltip"==t[n].role&&(a=this._settings.tooltip(i)),s.push(a)}e.push(s)}),this),t.length){for(var i=new wo.visualization.DataTable,s=0;s<t.length;s++)i.addColumn(t[s]);i.addRows(e);var n=new wo.visualization.DataView(i);this._map.draw(n,this._settings.chart)}else this._map.draw(wo.visualization.arrayToDataTable([["",""]]),{})}else this._map||this._waitMap.then(A(this._drawData,this))},setDisplayMode:function(t){this._settings.chart.displayMode=t,this.refresh()},setRegion:function(t){this._settings.chart.region=t,this.refresh()},refresh:function(){this._map.clearChart(),this._drawData()},tooltip_setter:function(e){var i=this._settings.chart.tooltip;return this._settings.chart.tooltip=t.extend(i||{},{isHtml:!0}),le(e)},$setSize:function(e,i){mi.api.$setSize.apply(this,arguments)&&this._map&&(t.extend(this._settings,{width:e,height:i}),this.refresh())},_refreshColumns:function(){this._columns=null,this._drawData()},_getColumnType:function(t,i){if(E(t[i]))return"string";var s=e(t[i]);return"string"!=s||isNaN(1*t[i])||(s="number"),s},_defineColumns:function(){var t=this._settings.columns||[],i=this.data.pull[this.data.order[0]];if(!t.length){if(!i)return[];for(var s in i)"id"!==s&&t.push(s)}for(var n=0;n<t.length;n++)if("object"!==e(t[n])){if(!i)return[];t[n]={type:this._getColumnType(i,t[n]),label:t[n]}}return this._settings.tooltip&&t.push({type:"string",role:"tooltip",p:{html:!0}}),this._columns=t,t},_mapEvents:function(){wo.visualization.events.addListener(this._map,"error",A((function(){this.callEvent("onMapError",arguments)}),this)),wo.visualization.events.addListener(this._map,"ready",A((function(){this.callEvent("onMapReady",arguments)}),this)),wo.visualization.events.addListener(this._map,"regionClick",A((function(){this.callEvent("onRegionClick",arguments)}),this)),wo.visualization.events.addListener(this._map,"select",A((function(){var t=this._map.getSelection()[0];t&&this.callEvent("onItemClick",[this.data.order[t.row]])}),this))}}),So=(t.protoUI($o,Gi,H,mi.view),{name:"google-map",$init:function(){this.$view.innerHTML="<div class='webix_map_content' style='width:100%;height:100%'></div>",this._contentobj=this.$view.firstChild,this._waitMap=d.defer(),this.data.provideApi(this,!0),this.$ready.push(this.render)},getMap:function(t){return t?this._waitMap:this._map},_getCallBack:function(t){return A((function(){"function"==typeof t&&t(),xo=xo||window.google,this._initMap.call(this)}),this)},render:function(){if(void 0===window.google||void 0===window.google.maps){if(!ko){(ko=document.createElement("script")).type="text/javascript";var t=this._settings,e=t.src||"//maps.google.com/maps/api/js";e+=-1===e.indexOf("?")?"?":"&",t.key&&(e+="&key="+t.key),t.libraries&&(e+="&libraries="+t.libraries),ko.src=e,document.getElementsByTagName("head")[0].appendChild(ko)}ko.onload=this._getCallBack(ko.onload)}else this._getCallBack()()},_initMap:function(){var t=this.config;this.isVisible(t.id)&&(this._map=new xo.maps.Map(this._contentobj,{zoom:t.zoom,center:new xo.maps.LatLng(t.center[0],t.center[1]),mapTypeId:xo.maps.MapTypeId[t.mapType]}),this._waitMap.resolve(this._map),this._contentobj.firstChild.setAttribute("webix_disable_drag","true"))},center_setter:function(t){return this._map&&this._map.setCenter(new xo.maps.LatLng(t[0],t[1])),t},mapType_setter:function(t){return this._map&&this._map.setMapTypeId(xo.maps.MapTypeId[t]),t},zoom_setter:function(t){return this._map&&this._map.setZoom(t),t},layerType_setter:function(e){return"heatmap"==e&&(this.config.libraries="visualization"),this._layerApi[e]&&(t.extend(this,this._layerApi[e],!0),this.data.attachEvent("onStoreUpdated",A((function(){this._waitMap.then(A((function(){this.drawData.call(this,arguments)}),this))}),this))),e},defaults:{zoom:5,center:[39.5,-98.5],mapType:"ROADMAP",layerType:"marker"},$setSize:function(){mi.api.$setSize.apply(this,arguments),this._map&&xo.maps.event.trigger(this._map,"resize")},$onLoad:function(t){return!this._map&&(this._waitMap.then(A((function(){this.parse(t)}),this)),!0)},_layerApi:{marker:{drawData:function(t,e,i){switch(i){case"add":case"update":e.$marker=this._getItemConfig(e);break;case"delete":e.$marker.setMap(null);break;default:this.data.each((function(t){t.$marker=this._getItemConfig(t)}),this)}},clearAll:function(t){this.data.each((function(t){t.$marker.setMap(null)})),this.data.clearAll(t)},showItem:function(t){var e=this.getItem(t);this._map.setCenter(new xo.maps.LatLng(e.lat,e.lng))},_getItemConfig:function(t){var e={};for(var i in t)e[i]=t[i];e.position=new xo.maps.LatLng(t.lat,t.lng),e.map=t.hidden?null:this._map;var s=t.$marker;return s?t.$marker.setMap(e.map):(s=new xo.maps.Marker(e),this._events(s)),this.callEvent("onItemRender",[t]),s},_events:function(t){var e=this;t.addListener("click",(function(){e.callEvent("onItemClick",[this.id,this])})),t.getDraggable()&&(t.addListener("dragend",(function(){e._onDrag(this,!0)})),t.addListener("drag",(function(){e._onDrag(this)})))},_onDrag:function(t,e){var i=this.getItem(t.id),s=t.getPosition(),n=e?"onAfterDrop":"onDrag";i.lat=s.lat(),i.lng=s.lng(),this.callEvent(n,[i.id,i])}},heatmap:{heatmapConfig_setter:function(t){return t||{}},drawData:function(){this._heatmap&&(this._heatmap.setMap(null),this._heatmap=null);var e=[];if(this.data.each((function(t){e.push(this._getConfig(t))}),this),e.length){var i=t.extend(this.config.heatmapConfig,{data:e,map:this._map},!0);this._heatmap=new xo.maps.visualization.HeatmapLayer(i),this.callEvent("onHeatMapRender",[this._heatmap])}},getHeatmap:function(){return this._heatmap},_getConfig:function(t){var e={};for(var i in t)e[i]=t[i];return e.location=new xo.maps.LatLng(t.lat,t.lng),e}}}}),Io=(t.protoUI(So,Gi,H,mi.view),{$render_pie:function(t,e,i,s,n,a){this._renderPie(t,e,i,s,1,a,n)},multilevel_setter:function(e){return e&&t.extend(this.data,Ws,!0),e},_renderPie:function(t,e,i,s,n,a,r){if(e.length){var o=this._getPieParameters(i,s),l=this._settings.radius?this._settings.radius:o.radius;if(!(l<0)){var h=this._settings.x?this._settings.x:o.x,c=this._settings.y?this._settings.y:o.y;this._lineWidth=E(this._settings.borderWidth)?2:this._settings.borderWidth;var d=[-Math.PI/2,3*Math.PI/2],u=this._series.length,_=this._innerRadius||0,p=(l-_)/u;if(this._levelCount=this._settings.multilevel?this._getLevelCount(e):1,this._linePoints=[],this._pieHeight=(this._settings.pieHeight||Math.floor(l/3))*(1-this._settings.cant)*3,this._sectorLen=this._series.length>1?p:Math.round((l-_)/this._levelCount),1==n&&this._settings.shadow&&!r&&this._addShadow(t,h,c,l),c/=n,t.scale(1,n),this._defColorsCursor=0,_&&1!=n&&!r&&this._createFirstLowerSectors(t,e,h,c,_),this._settings.gradient){var f=1!=n?h+l/3:h,g=1!=n?c+l/3:c;this._showRadialGradient(t,h,c,l,f,g,_+this._sectorLen*r)}if(this._renderLevel(t,e,{x:h,y:c},p*(r+1)+_,i,a,n,d,_+p*r,0,r),this._lineWidth){t.globalAlpha=.8;for(var m=0;m<this._linePoints.length;m++){var v=this._linePoints[m],b=v[0],w=v[1];this._drawLine(t,b.x,b.y,w.x,w.y,this._settings.lineColor.call(this,e[m]),this._lineWidth)}t.globalAlpha=1}t.scale(1,1/n),1!=n&&this._settings.legend&&(this._settings.legend.toggle=!1)}}},_getLevelCount:function(t,e){var i=this;e=e||1;var s=[];return t.forEach((function(t){return s.push(t.data?i._getLevelCount(t.data,e+1):e)})),Math.max.apply(null,s)},_renderLevel:function(t,e,i,s,n,a,r,o,l,h,c,d){for(var u=o[0],_=this._getValues(e),p=this._getTotalValue(_),f=i.x,g=i.y,m=this._getRatios(_,p,u,o[1]),v=this._innerRadius||0,b=0;b<e.length;b++){var w=e[b].data?this._sectorLen*(h+1)+v:s;if(_[b]||!p){t.lineWidth=this._lineWidth,t.strokeStyle=this._settings.lineColor.call(this,e[b]),t.beginPath();var y=m[b]-1e-4,x=void 0,k=void 0;l?(x=this._getPositionByAngle(u,f,g,l),k=this._getPositionByAngle(y,f,g,l),t.moveTo(x.x,x.y),t.arc(f,g,w,u,y,!1),t.lineTo(k.x,k.y),t.arc(f,g,l,y,u,!0),t.moveTo(x.x,x.y)):(t.moveTo(f,g),t.arc(f,g,w,u,y,!1),t.lineTo(f,g));var C=this._getColor(e[b],b,d,h);if(t.fillStyle=C,t.fill(),this._settings.pieInnerText){var $=this._settings.pieInnerText(e[b],p,h),S=this._series.length>1||this._levelCount>1?w-.5*this._sectorLen:.8*w;this._drawSectorLabel(f,g,S,u,y,r,$,!0,c,C)}var I=!e[b].data&&c==this._series.length-1;if(this._settings.label&&I){var A=this._settings.label(e[b],p,c);this._drawSectorLabel(f,g,w+this._settings.labelOffset,u,y,r,A,!1,c)}var D=1!=r&&I&&this._applyPieHeight(t,f,g,u,y,w,!1,e[b],b,C)?this._pieHeight*r:0;a.addSector(e[b].id,u,y,f-n.x,g*r-n.y,w,r,c,l,D),e[b].data&&this._renderLevel(t,e[b].data,i,s,n,a,r,[u,y],w,h+1,c,C);var E=this._getPositionByAngle(u,f,g,w);this._linePoints.push([{x:x?x.x:f,y:x?x.y:g},E]),this._lineWidth&&this._drawArcBorder(t,f,g,w,u,y,I),u=y}}},_getColor:function(t,e,i,s){var n=this._settings.color.call(this,t,e,s||0,i||null);return!n&&i&&(n=this._getLighterColor(i,.15*(e+1))),n},_getLighterColor:function(t,e){var i=ys.toRgb(t),s=ys.rgbToHsv(i[0],i[1],i[2]);return s[1]-=s[1]*(e||.5),"#"+ys.rgbToHex("rgb("+ys.hsvToRgb(s[0],s[1],s[2])+")")},_drawArcBorder:function(t,e,i,s,n,a,r){var o=t.lineWidth=this._lineWidth;t.strokeStyle=this._settings.borderColor?this._settings.borderColor.call(this):"#ffffff",t.beginPath(),t.arc(e,i,s-(r?0:o/2),n,a,!1),t.stroke()},_getValues:function(t){for(var e=[],i=0;i<t.length;i++){var s=t[i],n=parseFloat(this._settings.value(s));isNaN(n)&&s.data&&(n=this._getChildSum(s.id,s.data)),s.$value=n,e.push(Math.abs(n||0))}return e},_getChildSum:function(t,e){for(var i=0,s=0;s<e.length;s++){var n=parseFloat(this._settings.value(e[s]));isNaN(n)&&e[s].data?i+=this._getChildSum(e[s].id,e[s].data):i+=Math.abs(n||0)}return this.getItem(t).$value=i,i},_getTotalValue:function(t){for(var e=0,i=0;i<t.length;i++)e+=t[i];return e},_getRatios:function(t,e,i,s){var n,a,r=[],o=0,l=void 0!==i?s-i:2*Math.PI;for(n=0;n<t.length;n++)a=e?t[n]:1/t.length,r[n]=(i||0)+l*(a+o)/(e||1),o+=a;return r},_getPieParameters:function(t,e){var i=e.x-t.x,s=e.y-t.y;return{x:t.x+i/2,y:t.y+s/2,radius:Math.min(i/2,s/2)}},_createFirstLowerSectors:function(t,e,i,s,n){for(var a=this._getValues(e),r=this._getTotalValue(a),o=-Math.PI/2,l=this._getRatios(a,r,o,3*Math.PI/2),h=0;h<e.length;h++){var c=l[h]-1e-4,d=this._getColor(e[h],h);this._applyPieHeight(t,i,s,o,c,n,!0,e[h],h,d),o=c}this._defColorsCursor=0},_applyPieHeight:function(t,e,i,s,n,a,r,o,l,h){return!!(r||s<=0&&n>=0||s>=0&&n<=Math.PI||Math.abs(s-Math.PI)>.003&&s<=Math.PI&&n>=Math.PI)&&(t.fillStyle=h,t.strokeStyle=this._settings.lineColor.call(this,o,l),this._createLowerSector(t,e,i,s,n,a,!0,r),t.fillStyle="#000000",t.globalAlpha=.2,this._createLowerSector(t,e,i,s,n,a,!1,r),t.globalAlpha=1,!0)},_createLowerSector:function(t,e,i,s,n,a,r,o){return t.lineWidth=this._lineWidth,o||(s<=0&&n>=0&&(s=0,r=!1,this._drawSectorLine(t,e,i,a,s,n)),s<=Math.PI&&n>=Math.PI&&(n=Math.PI,r=!1,this._drawSectorLine(t,e,i,a,s,n))),t.beginPath(),t.arc(e,i,a,s,n,!1),t.lineTo(e+a*Math.cos(n),i+a*Math.sin(n)+this._pieHeight),t.arc(e,i+this._pieHeight,a,n,s,!0),t.lineTo(e+a*Math.cos(s),i+a*Math.sin(s)),t.fill(),r&&this._lineWidth&&t.stroke(),!0},_drawSectorLine:function(t,e,i,s,n,a){t.beginPath(),t.arc(e,i,s,n,a,!1),t.stroke()},_addShadow:function(t,e,i,s){t.globalAlpha=.5;for(var n=["#c4c4c4","#c6c6c6","#cacaca","#dcdcdc","#dddddd","#e0e0e0","#eeeeee","#f5f5f5","#f8f8f8"],a=n.length-1;a>-1;a--)t.beginPath(),t.fillStyle=n[a],t.arc(e+1,i+1,s+a,0,2*Math.PI,!0),t.arc(e+1,i+1,s-2,2*Math.PI,0,!1),t.fill();t.globalAlpha=1},_getGrayGradient:function(t){return t.addColorStop(0,"#ffffff"),t.addColorStop(.7,"#7a7a7a"),t.addColorStop(1,"#000000"),t},_showRadialGradient:function(t,e,i,s,n,a,r){var o;t.beginPath(),"function"!=typeof this._settings.gradient?(o=t.createRadialGradient(n,a,s/4,e,i,s),o=this._getGrayGradient(o)):o=this._settings.gradient(o),t.fillStyle=o,t.arc(e,i,s,0,2*Math.PI,!0),r&&t.arc(e,i,r,2*Math.PI,0,!1),t.fill(),t.globalAlpha=.75},_drawSectorLabel:function(t,e,i,s,n,a,r,o,l,h){var c=!o||this._getFontCss(h),d=this.canvases[l].renderText(0,0,r,c,1);if(d){var u=jt(r,c).width;d.style.width=u+"px",u>t&&(u=t);var _=n-s<.2?4:8;o&&(_=u/1.8);var p=s+(n-s)/2;i-=(_-8)/2;var f=-_,g="right";(p>=Math.PI/2&&p<Math.PI||p<=3*Math.PI/2&&p>=Math.PI)&&(f=-u-f+1,g="left");var m=0;!o&&a<1&&p>0&&p<Math.PI&&(m=(this._settings.height||Math.floor(i/4))/a);var v=(e+Math.floor((i+m)*Math.sin(p)))*a-8,b=t+Math.floor((i+_/2)*Math.cos(p))+f,w=n<Math.PI/2+.01,y=s<Math.PI/2;y&&w?b=Math.max(b,t+3):y||w?!o&&(p>=Math.PI/2&&p<Math.PI||p<=3*Math.PI/2&&p>=Math.PI)&&(b+=u/3):b=Math.min(b,t-u),d.style.top=v+"px",d.style.left=b+"px",d.style.width=u+"px",d.style.textAlign=g,d.style.whiteSpace="nowrap"}},_getFontCss:function(t){var e=ys.toRgb(t);return"webix_chart_pie_label webix_inner_text_"+(.2126*e[0]+.7152*e[1]+.0722*e[2]>180?"dark":"light")},$render_pie3D:function(t,e,i,s,n,a){this._renderPie(t,e,i,s,this._settings.cant,a,n)},$render_donut:function(t,e,i,s,n,a){this._renderDonut(t,e,i,s,a,n)},$render_donut3D:function(t,e,i,s,n,a){this._renderDonut(t,e,i,s,a,n,this._settings.cant)},_renderDonut:function(t,e,i,s,n,a,r){if(e.length){var o=this._settings,l=this._getPieParameters(i,s),h=o.radius?o.radius:l.radius;if(!(h<=0)){var c=o.x?o.x:l.x,d=o.y?o.y:l.y,u=o.innerRadius;if((!u||u>h)&&(u=h/3),this._innerRadius=u,this._renderPie(t,e,i,s,r||1,n,a),this._settings.donutInnerText){var _=this._getValues(e),p=this._getTotalValue(_),f=vi.dataPadding,g=2*u-2*f,m=this.canvases[0].renderText(c-u+f,d-u+f,'<div class="webix_donut_center_text">'.concat(this._settings.donutInnerText(e,p),"</div>"),"webix_donut_center_text_box",g);m.style.height=m.style.lineHeight=g+"px"}}}}}),Ao={$render_bar:function(t,e,i,s,n,a){var r,o,l,h,c,d,u,_,p,f=this._getLimits(),g=s.y-i.y,m=!!this._settings.yAxis,v=!!this._settings.xAxis;l=f.max,h=f.min;var b=(s.x-i.x)/e.length;n||"auto"!=this._settings.origin&&!m||this._drawScales(e,i,s,h,l,b),m&&(l=parseFloat(this._settings.yAxis.end),h=parseFloat(this._settings.yAxis.start)),c=(u=this._getRelativeValue(h,l))[0],d=u[1],p=c?g/c:c,m||"auto"!=this._settings.origin&&v||(_=10,p=c?(g-_)/c:_),!n&&"auto"!=this._settings.origin&&!m&&this._settings.origin>h&&this._drawXAxis(t,e,i,s,b,s.y-p*(this._settings.origin-h)),r=parseInt(this._settings.barWidth,10);var w=0,y=0;for(o=0;o<this._series.length;o++)o==n&&(y=w),"bar"==this._series[o].type&&w++;var x=this._getMinBarOffset(b);this._series&&r*w+x>b&&(r=(b-x)/w);var k=(b-r*w)/2,C=E(this._settings.radius)?Math.round(r/5):parseInt(this._settings.radius,10),$=!1,S=this._settings.gradient;for(S&&"function"!=typeof S?($=S,S=!1):S&&(S=t.createLinearGradient(0,s.y,0,i.y),this._settings.gradient(S)),v||this._drawLine(t,i.x,s.y+.5,s.x,s.y+.5,vi.dataBorderColor,1),o=0;o<e.length;o++){var I=parseFloat(this._settings.value(e[o])||0);if(this._logScaleCalc&&(I=this._log10(I)),I&&!isNaN(I)){I>l&&(I=l),I-=h,I*=d;var A=i.x+k+o*b+(r+1)*y,D=s.y,j=S||this._settings.color.call(this,e[o],o),V=this._settings.border?1:0,N=this._settings.label(e[o]);m||"auto"!=this._settings.origin&&v?I==this._settings.origin||"auto"==this._settings.origin&&this._settings.value(e[o])==h?(V=0,N=""):(I<0||this._settings.yAxis&&0===I&&!("auto"!=this._settings.origin&&this._settings.origin>h))&&(I=V=0,N=""):I+=_/p,t.globalAlpha=this._settings.alpha.call(this,e[o]);var T=this._drawBar(t,i,A,D,r,h,C,p,I,j,S,$,V);$&&this._drawBarGradient(t,A,D,r,h,C,p,I,j,$,V),V&&this._drawBarBorder(t,A,D,r,h,C,p,I,j),t.globalAlpha=1,T[0]!=A?this.canvases[n].renderTextAt(!1,!0,A+Math.floor(r/2),T[1],N):this.canvases[n].renderTextAt(!0,!0,A+Math.floor(r/2),T[3],N),a.addRect(e[o].id,[A-i.x,T[3]-i.y,T[2]-i.x,T[1]-i.y],n)}}},_correctBarParams:function(t,e,i,s,n,a,r){var o=i;return"auto"!=this._settings.origin&&this._settings.origin>r&&(o=i-=(this._settings.origin-r)*n,(s-=this._settings.origin-r)<0&&(s*=-1,t.translate(e+a,i),t.rotate(Math.PI),e=0,i=0),i-=.5),{value:s,x0:e,y0:i,start:o}},_drawBar:function(t,e,i,s,n,a,r,o,l,h,c,d,u){t.save(),t.fillStyle=h;var _=this._correctBarParams(t,i,s,l,o,n,a),p=this._setBarPoints(t,_.x0,_.y0,n,r,o,_.value,u);c&&!d&&t.lineTo(_.x0+u,e.y),t.fill(),t.restore();var f=_.x0,g=_.x0!=i?i+p[0]:p[0];return[f,_.x0!=i?_.start-p[1]-_.y0:_.y0,g,_.x0!=i?_.start-_.y0:p[1]]},_setBorderStyles:function(t,e){var i,s;s=ys.toRgb(e),(i=ys.rgbToHsv(s[0],s[1],s[2]))[2]/=1.4;var n="rgb("+ys.hsvToRgb(i[0],i[1],i[2])+")";t.strokeStyle=n,1==t.globalAlpha&&(t.globalAlpha=.9)},_drawBarBorder:function(t,e,i,s,n,a,r,o,l){var h;t.save(),h=this._correctBarParams(t,e,i,o,r,s,n),this._setBorderStyles(t,l),this._setBarPoints(t,h.x0,h.y0,s,a,r,h.value,t.lineWidth/2,1),t.stroke(),t.restore()},_drawBarGradient:function(t,e,i,s,n,a,r,o,l,h,c){t.save();var d=this._correctBarParams(t,e,i,o,r,s,n),u=this._setBarGradient(t,d.x0,d.y0,d.x0+s,d.y0-r*d.value+2,h,l,"y");t.fillStyle=u.gradient,this._setBarPoints(t,d.x0+u.offset,d.y0,s-2*u.offset,a,r,d.value,u.offset+c),t.fill(),t.restore()},_setBarPoints:function(t,e,i,s,n,a,r,o,l){t.beginPath();var h=0;if(n>a*r){var c=(n-a*r)/n;c<=1&&c>=-1&&(h=-Math.acos(c)+Math.PI/2)}t.moveTo(e+o,i);var d=i-Math.floor(a*r)+n+(n?0:o);n<a*r&&t.lineTo(e+o,d);var u=e+n;n&&n>0&&t.arc(u,d,Math.max(n-o,0),-Math.PI+h,-Math.PI/2,!1);var _=e+s-n-o,p=d-n+(n?o:0);t.lineTo(_,p),n&&n>0&&t.arc(_+o,d,Math.max(n-o,0),-Math.PI/2,0-h,!1);var f=e+s-o;return t.lineTo(f,i),l||t.lineTo(e+o,i),[f,p]}},Do={$render_line:function(t,i,s,n,a,r){var o,l,h,c,d,u,_,p,f,g,m,v;if(c=this._calculateLineParams(t,i,s,n,a),o=this._settings,i.length){for(d=o.offset?s.x+.5*c.cellWidth:s.x,h=[],l=0;l<i.length;l++)if((v=this._getPointY(i[l],s,n,c))||"0"==v){if(_=l?c.cellWidth*l-.5+d:d,f="object"==e(v)?v.y0:v,l&&this._settings.fixOverflow){if((m=this._getPointY(i[l-1],s,n,c)).out&&m.out==v.out)continue;u=c.cellWidth*(l-1)-.5+d,p="object"==e(m)?m.y0:m,m.out&&(g="min"==m.out?n.y:s.y,h.push({x:this._calcOverflowX(u,_,p,f,g),y:g})),v.out&&(g="min"==v.out?n.y:s.y,h.push({x:this._calcOverflowX(u,_,p,f,g),y:g}))}v.out||h.push({x:_,y:v,index:l})}for(this._mapStart=s,l=1;l<=h.length;l++)u=h[l-1].x,p=h[l-1].y,l<h.length&&(_=h[l].x,f=h[l].y,this._drawLine(t,u,p,_,f,o.line.color.call(this,i[l-1]),o.line.width),o.line&&o.line.shadow&&(t.globalAlpha="contrast"==bi||"dark"==bi?.1:.3,this._drawLine(t,u+2,p+o.line.width+8,_+2,f+o.line.width+8,"#eeeeee",o.line.width+3),t.globalAlpha=1)),void 0!==h[l-1].index&&this._drawItem(t,u,p,i[h[l-1].index],o.label(i[h[l-1].index]),a,r,s)}},_calcOverflowX:function(t,e,i,s,n){return t+(n-i)*(e-t)/(s-i)},_drawItem:function(t,e,i,s,n,a,r){var o=this._settings.item,l=parseInt(o.radius.call(this,s),10)||0,h=this._mapStart,c=o.type.call(this,s);if(l){if(t.save(),o.shadow){t.lineWidth=1,t.strokeStyle="#bdbdbd",t.fillStyle="#bdbdbd";for(var d=[.1,.2,.3],u=d.length-1;u>=0;u--)t.globalAlpha=d[u],t.strokeStyle="#d0d0d0",t.beginPath(),this._strokeChartItem(t,e,i+2*l/3,l+u+1,c),t.stroke();t.beginPath(),t.globalAlpha=.3,t.fillStyle="#bdbdbd",this._strokeChartItem(t,e,i+2*l/3,l+1,c),t.fill()}t.restore(),t.lineWidth=o.borderWidth,t.fillStyle=o.color.call(this,s),t.strokeStyle=o.borderColor.call(this,s),t.globalAlpha=o.alpha.call(this,s),t.beginPath(),this._strokeChartItem(t,e,i,l+1,c),t.fill(),t.stroke(),t.globalAlpha=1}if(n&&this.canvases[a].renderTextAt(!1,!0,e,i-l-this._settings.labelOffset,this._settings.label.call(this,s)),r){var _=this._settings.eventRadius||l+1;r.addRect(s.id,[e-_-h.x,i-_-h.y,e+_-h.x,i+_-h.y],a)}},_strokeChartItem:function(t,e,i,s,n){var a=[];if(!n||"square"!=n&&"s"!=n)if(!n||"diamond"!=n&&"d"!=n)a=!n||"triangle"!=n&&"t"!=n?[[e,i,s,0,2*Math.PI,!0]]:[[e,i-s],[e+Math.sqrt(3)*s/2,i+s/2],[e-Math.sqrt(3)*s/2,i+s/2],[e,i-s]];else{var r=t.lineWidth>1?t.lineWidth*Math.sqrt(2)/4:0;a=[[e,i-s],[e+s,i],[e,i+s],[e-s,i],[e+r,i-s-r]]}else a=[[e-(s*=Math.sqrt(2)/2)-t.lineWidth/2,i-s],[e+s,i-s],[e+s,i+s],[e-s,i+s],[e-s,i-s]];this._path(t,a)},_getPointY:function(t,e,i,s){var n=s.minValue,a=s.maxValue,r=s.unit,o=s.valueFactor,l=this._settings.value(t);this._logScaleCalc&&(l=this._log10(l));var h=(parseFloat(l||0)-n)*o;this._settings.yAxis||(h+=s.startValue/r);var c=i.y-r*h;return!this._settings.fixOverflow||"line"!=this._settings.type&&"area"!=this._settings.type?(l>a&&(c=e.y),(h<0||l<n)&&(c=i.y)):l>a?c={y:e.y,y0:c,out:"max"}:(h<0||l<n)&&(c={y:i.y,y0:c,out:"min"}),c},_calculateLineParams:function(t,e,i,s,n){var a,r={};r.totalHeight=s.y-i.y,this._settings.cellWidth?r.cellWidth=Math.min(s.x-i.x,this._settings.cellWidth):r.cellWidth=(s.x-i.x)/(this._settings.offset?e.length:e.length-1);var o=!!this._settings.yAxis,l=-1!=this._settings.type.indexOf("stacked")?this._getStackedLimits(e):this._getLimits();r.maxValue=l.max,r.minValue=l.min,n||this._drawScales(e,i,s,r.minValue,r.maxValue,r.cellWidth),o&&(r.maxValue=parseFloat(this._settings.yAxis.end),r.minValue=parseFloat(this._settings.yAxis.start));var h=this._getRelativeValue(r.minValue,r.maxValue);return a=h[0],r.valueFactor=h[1],r.unit=a?r.totalHeight/a:10,r.startValue=0,o||(r.startValue=10,r.unit!=r.totalHeight&&(r.unit=a?(r.totalHeight-r.startValue)/a:10)),r}},Eo={$render_barH:function(t,e,i,s,n,a){var r,o,l,h,c,d,u,_,p,f,g,m,v,b,w,y,x,k,C,$,S;l=(s.y-i.y)/e.length,_=(u=this._getLimits("h")).max,p=u.min,y=s.x-i.x,S=!!this._settings.xAxis,n||this._drawHScales(t,e,i,s,p,_,l),S&&(_=parseFloat(this._settings.xAxis.end),p=parseFloat(this._settings.xAxis.start)),m=(b=this._getRelativeValue(p,_))[0],g=b[1],k=m?y/m:10,S||(w=10,k=m?(y-w)/m:10),o=parseInt(this._settings.barWidth,10);var I=this._getMinBarOffset(l);for(o*this._series.length+I>l&&(o=(l-I)/this._series.length),r=Math.floor((l-o*this._series.length)/2),v=void 0!==this._settings.radius?parseInt(this._settings.radius,10):Math.round(o/5),f=!1,(c=this._settings.gradient)&&"function"!=typeof c?(f=c,c=!1):c&&(c=t.createLinearGradient(i.x,i.y,s.x,i.y),this._settings.gradient(c)),S||this._drawLine(t,i.x-.5,i.y,i.x-.5,s.y,vi.dataBorderColor,1),d=0;d<e.length;d++)if(x=parseFloat(this._settings.value(e[d]||0)),this._logScaleCalc&&(x=this._log10(x)),x&&!isNaN(x))if(x>_&&(x=_),x-=p,x*=g,C=i.x,$=i.y+r+d*l+(o+1)*n,x<0&&"auto"==this._settings.origin||this._settings.xAxis&&0===x&&!("auto"!=this._settings.origin&&this._settings.origin>p))this.canvases[n].renderTextAt("middle","right",C+10,$+o/2+r,this._settings.label(e[d]));else{x<0&&"auto"!=this._settings.origin&&this._settings.origin>p&&(x=0),S||(x+=w/k),h=c||this._settings.color.call(this,e[d],d),this._settings.border&&this._drawBarHBorder(t,C,$,o,p,v,k,x,h),t.globalAlpha=this._settings.alpha.call(this,e[d]);var A=this._drawBarH(t,s,C,$,o,p,v,k,x,h,c,f);f&&this._drawBarHGradient(t,C,$,o,p,v,k,x,h,f),t.globalAlpha=1,A[3]==$?(this.canvases[n].renderTextAt("middle","left",A[0]-5,A[3]+Math.floor(o/2),this._settings.label(e[d])),a.addRect(e[d].id,[A[0]-i.x,A[3]-i.y,A[2]-i.x,A[3]+o-i.y],n)):(this.canvases[n].renderTextAt("middle",!1,A[2]+5,A[1]+Math.floor(o/2),this._settings.label(e[d])),a.addRect(e[d].id,[A[0]-i.x,$-i.y,A[2]-i.x,A[3]-i.y],n))}},_setBarHPoints:function(t,e,i,s,n,a,r,o,l){var h=0;if(n>a*r){var c=(n-a*r)/n;h=-Math.asin(c)+Math.PI/2}t.moveTo(e,i+o);var d=e+a*r-n-(n?0:o);d=Math.max(e,d),n<a*r&&t.lineTo(d,i+o);var u=i+n;n&&n>0&&t.arc(d,u,n-o,-Math.PI/2+h,0,!1);var _=i+s-n-(n?0:o),p=d+n-(n?o:0);t.lineTo(p,_),n&&n>0&&t.arc(d,_,n-o,0,Math.PI/2-h,!1);var f=i+s-o;return t.lineTo(e,f),l||t.lineTo(e,i+o),[p,f]},_drawHScales:function(t,e,i,s,n,a,r){var o=0;this._settings.xAxis&&(this.canvases.x||(this.canvases.x=this._createCanvas("axis_x")),o=this._drawHXAxis(this.canvases.x.getCanvas(),e,i,s,n,a)),this._settings.yAxis&&(this.canvases.y||(this.canvases.y=this._createCanvas("axis_y")),this._drawHYAxis(this.canvases.y.getCanvas(),e,i,s,r,o))},_drawHYAxis:function(t,e,i,s,n,a){if(this._settings.yAxis){var r,o=parseInt(a||i.x,10)-.5,l=s.y+.5,h=i.y;this._drawLine(t,o,l,o,h,this._settings.yAxis.color,1);for(var c=0;c<e.length;c++){var d="auto"!=this._settings.origin&&"barH"==this._settings.type&&parseFloat(this._settings.value(e[c]))<this._settings.origin;r=h+n/2+c*n,this.canvases.y.renderTextAt("middle",!d&&"left",d?o+5:o-5,r,this._settings.yAxis.template(e[c]),"webix_axis_item_y",d?0:o-10),this._settings.yAxis.lines.call(this,e[c])&&this._drawLine(t,i.x,r,s.x,r,this._settings.yAxis.lineColor.call(this,e[c]),1)}this._settings.yAxis.lines.call(this,{})&&this._drawLine(t,i.x+.5,h+.5,s.x,h+.5,this._settings.yAxis.lineColor.call(this,{}),1),this._setYAxisTitle(i,s)}},_drawHXAxis:function(t,e,i,s,n,a){var r,o={},l=this._settings.xAxis;if(l){var h=s.y+.5,c=i.x-.5,d=s.x-.5,u=i.x;if(this._drawLine(t,c,h,d,h,l.color,1),l.step&&(r=parseFloat(l.step)),void 0!==this._configXAxis.step&&void 0!==this._configXAxis.start&&void 0!==this._configXAxis.end||(n=(o=this._calculateScale(n,a)).start,a=o.end,r=o.step,this._settings.xAxis.end=a,this._settings.xAxis.start=n,this._settings.xAxis.step=r),0!==r){for(var _=(d-c)*r/(a-n),p=0,f=n;f<=a;f+=r){var g=this._logScaleCalc?Math.pow(10,f):f;o.fixNum&&(g=parseFloat(g).toFixed(o.fixNum));var m=Math.floor(c+p*_)+.5;if(f==n&&"auto"==this._settings.origin||!l.lines.call(this,f)||this._drawLine(t,m,h,m,i.y,this._settings.xAxis.lineColor.call(this,f),1),f==this._settings.origin&&(u=m+1),r<1&&!this._logScaleCalc){var v=Math.min(Math.floor(this._log10(r)),n<=0?0:Math.floor(this._log10(n))),b=Math.pow(10,-v);f=g=Math.round(g*b)/b}this.canvases.x.renderTextAt(!1,!0,m,h+2,l.template(g.toString()),"webix_axis_item_x"),p++}return this.canvases.x.renderTextAt(!0,!1,c,s.y+this._settings.padding.bottom-3,this._settings.xAxis.title,"webix_axis_title_x",s.x-i.x),u}}},_correctBarHParams:function(t,e,i,s,n,a,r){var o=e;return this._settings.yAxis&&"auto"!=this._settings.origin&&this._settings.origin>r&&(o=e+=(this._settings.origin-r)*n,(s-=this._settings.origin-r)<0&&(s*=-1,t.translate(e,i+a),t.rotate(Math.PI),e=.5,i=0),e+=.5),{value:s,x0:e,y0:i,start:o}},_drawBarH:function(t,e,i,s,n,a,r,o,l,h,c,d){t.save();var u=this._correctBarHParams(t,i,s,l,o,n,a);t.fillStyle=h,t.beginPath();var _=this._setBarHPoints(t,u.x0,u.y0,n,r,o,u.value,this._settings.border?1:0);c&&!d&&t.lineTo(e.x,u.y0+(this._settings.border?1:0)),t.fill(),t.restore();var p=u.y0,f=u.y0!=s?s:_[1];return[u.y0!=s?u.start-_[0]:u.start,p,u.y0!=s?u.start:_[0],f]},_drawBarHBorder:function(t,e,i,s,n,a,r,o,l){t.save();var h=this._correctBarHParams(t,e,i,o,r,s,n);t.beginPath(),this._setBorderStyles(t,l),t.globalAlpha=.9,this._setBarHPoints(t,h.x0,h.y0,s,a,r,h.value,t.lineWidth/2,1),t.stroke(),t.restore()},_drawBarHGradient:function(t,e,i,s,n,a,r,o,l,h){t.save();var c=this._correctBarHParams(t,e,i,o,r,s,n),d=this._setBarGradient(t,c.x0,c.y0+s,c.x0+r*c.value,c.y0,h,l,"x");t.fillStyle=d.gradient,t.beginPath(),this._setBarHPoints(t,c.x0,c.y0+d.offset,s-2*d.offset,a,r,c.value,d.offset),t.fill(),t.globalAlpha=1,t.restore()}},jo={$render_stackedBar:function(t,e,i,s,n,a){var r,o,l,h,c,d,u=this._settings,_=s.y-i.y,p=!!u.yAxis,f=!!u.xAxis,g=this._getStackedLimits(e),m=0===u.origin;r=g.max,o=g.min;var v=Math.floor((s.x-i.x)/e.length);n||this._drawScales(e,i,s,o,r,v),p&&(r=parseFloat(u.yAxis.end),o=parseFloat(u.yAxis.start));var b=this._getRelativeValue(o,r);d=b[0],c=b[1];var w=d?_/d:10,y=parseInt(u.barWidth,10),x=this._getMinBarOffset(v);y+x>v&&(y=v-x);var k=Math.floor((v-y)/2),C=!!u.gradient&&u.gradient;f||this._drawLine(t,i.x,s.y+.5,s.x,s.y+.5,vi.dataBorderColor,1);for(var $=0;$<e.length;$++){var S=parseFloat(u.value(e[$]||0));this._logScaleCalc&&(S=this._log10(S)),l=i.x+k+$*v;var I=m&&S<0;if(n)h=I?e[$].$startYN:e[$].$startY;else{var A=s.y+.5;h=A-1,e[$].$startY=h,m&&(I&&(h=A+1),e[$].$startYN=A+1)}if(S&&!isNaN(S)){n||m||(S-=o),S*=c;var D=u.border,E=u.label(e[$]);if(!(h<i.y+1)){var j=u.color.call(this,e[$],$),V=Math.abs(h-(m?s.y+o*w:s.y))<3;t.globalAlpha=u.alpha.call(this,e[$]),t.fillStyle=t.strokeStyle=j,t.beginPath();var N=h-w*S+(V?I?-1:1:0);Math.floor(N)>s.y&&(N=s.y,""!=E&&N-h<jt('<div class="webix_canvas_text">'.concat(E,"</div>"),this.$view.className).height&&(E=""));var T=this._setStakedBarPoints(t,l-(D?.5:0),h,y+(D?.5:0),N,0,i.y);if(t.fill(),t.stroke(),C){t.save();var F=this._setBarGradient(t,l,h,l+y,T[1],C,j,"y");t.fillStyle=F.gradient,t.beginPath(),T=this._setStakedBarPoints(t,l+F.offset,h,y-2*F.offset,N,D?1:0,i.y),t.fill(),t.restore()}D&&(t.save(),"string"==typeof D?t.strokeStyle=D:this._setBorderStyles(t,j),t.beginPath(),this._setStakedBarPoints(t,l-.5,parseInt(h,10)+.5,y+1,parseInt(N,10)+.5,0,i.y,V),t.stroke(),t.restore()),t.globalAlpha=1,this.canvases[n].renderTextAt(!1,!0,l+Math.floor(y/2),T[1]+(h-T[1])/2-7,E),a.addRect(e[$].id,[l-i.x,T[1]-i.y,T[0]-i.x,e[$][I?"$startYN":"$startY"]-i.y],n),e[$][I?"$startYN":"$startY"]=T[1]}}}},_setStakedBarPoints:function(t,e,i,s,n,a,r,o){t.moveTo(e,i),n<r&&(n=r),t.lineTo(e,n);var l=e+s,h=n;t.lineTo(l,h);var c=e+s;return t.lineTo(c,i),o||t.lineTo(e,i),[c,h]}},Vo={$render_stackedBarH:function(t,e,i,s,n,a){var r,o,l,h,c=s.x-i.x,d=!!this._settings.yAxis,u=this._getStackedLimits(e);r=u.max,o=u.min;var _=Math.floor((s.y-i.y)/e.length);n||this._drawHScales(t,e,i,s,o,r,_),d&&(r=parseFloat(this._settings.xAxis.end),o=parseFloat(this._settings.xAxis.start));var p=this._getRelativeValue(o,r);h=p[0],l=p[1];var f=h?c/h:10,g=0;d||(g=10,f=h?(c-g)/h:10);var m=parseInt(this._settings.barWidth,10),v=this._getMinBarOffset(_);m+v>_&&(m=_-v);var b=(_-m)/2,w=!1,y=this._settings.gradient;y&&(w=!0),d||this._drawLine(t,i.x-.5,i.y,i.x-.5,s.y,vi.dataBorderColor,1);var x=0,k=0;for(C=0;C<this._series.length;C++)C==n&&(k=x),"stackedBarH"==this._series[C].type&&x++;for(var C=0;C<e.length;C++){k||(e[C].$startX=i.x);var $=Math.abs(parseFloat(this._settings.value(e[C]||0)));$>r&&($=r),$-=o,$*=l;var S=i.x,I=i.y+b+C*_;if(k?S=e[C].$startX:e[C].$startX=S,$&&!isNaN($)){d||($+=g/f);var A=this._settings.color.call(this,e[C],C);t.globalAlpha=this._settings.alpha.call(this,e[C]),t.fillStyle=A,t.beginPath();var D=this._setBarHPoints(t,S,I,m,0,f,$,0);if(y&&!w&&t.lineTo(i.x+c,I+(this._settings.border?1:0)),t.fill(),w){var E=this._setBarGradient(t,S,I+m,S,I,w,A,"x");t.fillStyle=E.gradient,t.beginPath(),D=this._setBarHPoints(t,S,I,m,0,f,$,0),t.fill()}this._settings.border&&this._drawBarHBorder(t,S,I,m,o,0,f,$,A),t.globalAlpha=1,this.canvases[n].renderTextAt("middle",!0,e[C].$startX+(D[0]-e[C].$startX)/2-1,I+(D[1]-I)/2,this._settings.label(e[C])),a.addRect(e[C].id,[e[C].$startX-i.x,I-i.y,D[0]-i.x,D[1]-i.y],n),e[C].$startX=D[0]}}}},No={$render_area:function(t,i,s,n,a,r){var o,l,h,c,d,u,_,p,f,g,m,v,b,w,y;if(u=this._calculateLineParams(t,i,s,n,a),c=(l=this._settings).eventRadius||Math.floor(u.cellWidth/2),i.length){for(_=[],g=l.offset?s.x+.5*u.cellWidth:s.x,h=0;h<i.length;h++)if(d=i[h],f=this._getPointY(d,s,n,u),b=g+u.cellWidth*h,f){if(w="object"==e(f)?f.y0:f,h&&this._settings.fixOverflow){if((p=this._getPointY(i[h-1],s,n,u)).out&&p.out==f.out)continue;m=u.cellWidth*(h-1)-.5+g,v="object"==e(p)?p.y0:p,p.out&&(y="min"==p.out?n.y:s.y,_.push([this._calcOverflowX(m,b,v,w,y),y])),f.out&&(y="min"==f.out?n.y:s.y,_.push([this._calcOverflowX(m,b,v,w,y),y]),h==i.length-1&&y==s.y&&_.push([b,s.y]))}f.out||(_.push([b,w]),r.addRect(d.id,[b-c-s.x,w-c-s.y,b+c-s.x,w+c-s.y],a)),l.yAxis||(o=l.offset||h!=i.length-1?"center":"left",this.canvases[a].renderTextAt(!1,o,b,w-l.labelOffset,l.label(d)))}_.length&&(_.push([b,n.y]),_.push([_[0][0],n.y])),t.globalAlpha=this._settings.alpha.call(this,i[0]),t.fillStyle=this._settings.color.call(this,i[0]),t.beginPath(),this._path(t,_),t.fill(),t.lineWidth=1,t.globalAlpha=1,l.border&&(t.lineWidth=l.borderWidth||1,l.borderColor?t.strokeStyle=l.borderColor.call(this,i[0]):this._setBorderStyles(t,t.fillStyle),t.beginPath(),this._path(t,_),t.stroke())}},$render_stackedArea:function(t,e,i,s,n,a){var r,o,l,h,c,d,u,_,p,f,g,m,v;if(p=this._calculateLineParams(t,e,i,s,n),u=(h=this._settings).eventRadius||Math.floor(p.cellWidth/2),e.length){f=[],v=[],g=h.offset?i.x+.5*p.cellWidth:i.x;var b=function(t,i){return n?e[t].$startY?i-s.y+e[t].$startY:0:i},w=function(t,e,i){var s=(i.y-e.y)/(i.x-e.x);return s*t+e.y-s*e.x};for(c=0;c<e.length;c++)_=e[c],c?g+=p.cellWidth:(m=b(c,s.y),f.push([g,m])),m=b(c,this._getPointY(_,i,s,p)),v.push(isNaN(m)&&!c?e[c].$startY||s.y:m),m&&(f.push([g,m]),a.addRect(_.id,[g-u-i.x,m-u-i.y,g+u-i.x,m+u-i.y],n),h.yAxis||(h.offset,l="center",this.canvases[n].renderTextAt(!1,l,g,m-h.labelOffset,h.label(_))));if(f.push([g,b(c-1,s.y)]),n)for(c=e.length-2;c>0;c--)g-=p.cellWidth,(m=e[c].$startY)&&f.push([g,m]);for(f.push([f[0][0],f[0][1]]),t.globalAlpha=this._settings.alpha.call(this,e[0]),t.fillStyle=this._settings.color.call(this,e[0]),t.beginPath(),this._path(t,f),t.fill(),c=0;c<e.length;c++){if(!(m=v[c]))for(c==e.length-1&&(m=e[c].$startY),d=c+1;d<e.length;d++)if(v[d]){r={x:i.x,y:v[0]},o={x:i.x+p.cellWidth*d,y:v[d]},m=w(i.x+p.cellWidth*c,r,o);break}e[c].$startY=m}}}},To={$render_radar:function(t,e,i,s,n,a){this._renderRadarChart(t,e,i,s,n,a)},_renderRadarChart:function(t,e,i,s,n,a){if(e.length){for(var r=this._getPieParameters(i,s),o=this._settings.radius?this._settings.radius:r.radius,l=this._settings.x?this._settings.x:r.x,h=this._settings.y?this._settings.y:r.y,c=[],d=0;d<e.length;d++)c.push(1);var u=this._getRatios(c,e.length);this._mapStart=i,n||this._drawRadarAxises(u,l,h,o,e),this._drawRadarData(t,u,l,h,o,e,n,a)}},_drawRadarData:function(t,e,i,s,n,a,r,o){var l,h,c,d,u,_,p,f,g,m,v,b,w,y,x,k,C,$,S;for(u=(c=this._settings).yAxis.start,_=c.yAxis.end,$=(b=(S=this._getRelativeValue(u,_))[0])?n/b:n/2,C=S[1],l=h=w=-Math.PI/2,g=[],f=0,d=0;d<a.length;d++)k?x=k:(y=c.value(a[d]),this._logScaleCalc&&(y=this._log10(y)),x=(parseFloat(y||0)-u)*C),m=Math.floor($*x),y=c.value(d!=a.length-1?a[d+1]:a[0]),this._logScaleCalc&&(y=this._log10(y)),k=(parseFloat(y||0)-u)*C,v=Math.floor($*k),l=h,h=d!=a.length-1?w+e[d]-1e-4:w,p=f||this._getPositionByAngle(l,i,s,m),f=this._getPositionByAngle(h,i,s,v),g.push(p);c.fill&&this._fillRadarChart(t,g,a),!c.disableLines&&a.length>2&&this._strokeRadarChart(t,g,a),(!c.disableItems||a.length<3)&&this._drawRadarItemMarkers(t,g,a,r,o),g=null},_drawRadarItemMarkers:function(t,e,i,s,n){for(var a=0;a<e.length;a++)this._drawItem(t,e[a].x,e[a].y,i[a],this._settings.label.call(this,i),s,n)},_fillRadarChart:function(t,e,i){var s,n;t.globalAlpha=this._settings.alpha.call(this,{}),t.beginPath();for(var a=0;a<e.length;a++)t.fillStyle=this._settings.fill.call(this,i[a]),s=e[a],n=e[a+1]||e[0],a||t.moveTo(s.x,s.y),t.lineTo(n.x,n.y);t.fill(),t.globalAlpha=1},_strokeRadarChart:function(t,e,i){for(var s,n,a=0;a<e.length;a++)s=e[a],n=e[a+1]||e[0],this._drawLine(t,s.x,s.y,n.x,n.y,this._settings.line.color.call(this,i[a]),this._settings.line.width)},_drawRadarAxises:function(t,e,i,s,n){var a=this._settings.yAxis,r=this._settings.xAxis,o=a.start,l=a.end,h=a.step,c={},d=this._configYAxis;if(void 0===d.step||void 0===d.start||void 0===d.end){var u=this._getLimits();o=(c=this._calculateScale(u.min,u.max)).start,l=c.end,h=c.step,a.end=l,a.start=o}var _,p,f,g,m,v=[],b=0,w=s*h/(l-o);h<1&&(g=Math.min(this._log10(h),o<=0?0:this._log10(o)),m=Math.pow(10,-g));var y=[];this.canvases.scale||(this.canvases.scale=this._createCanvas("radar_scale"));var x=this.canvases.scale.getCanvas();for(_=l;_>=o;_-=h){var k=this._logScaleCalc?Math.pow(10,_):_;c.fixNum&&(k=parseFloat(_).toFixed(c.fixNum)),v.push(Math.floor(b*w)+.5),m&&!this._logScaleCalc&&(_=k=Math.round(k*m)/m);var C=i-s+v[v.length-1];this.canvases.scale.renderTextAt("middle","left",e,C,a.template(k.toString()),"webix_axis_item_y webix_radar");var $,S=-Math.PI/2,I=S;for(p=0;p<t.length;p++)b||y.push(I),$=S+t[p]-1e-4,this._drawScaleSector(x,t.length>2?d.lineShape||"line":"arc",e,i,s-v[v.length-1],I,$,_,p,n[_]),I=$;b++}for(_=0;_<y.length;_++)f=this._getPositionByAngle(y[_],e,i,s),r&&(r.lines.call(this,n[_],_)&&this._drawLine(x,e,i,f.x,f.y,r.lineColor.call(this,n[_]),1),this._drawRadarScaleLabel(x,e,i,s,y[_],r.template.call(this,n[_])))},_drawScaleSector:function(t,e,i,s,n,a,r,o,l){var h,c;if(n<0)return!1;h=this._getPositionByAngle(a,i,s,n),c=this._getPositionByAngle(r,i,s,n);var d=this._settings.yAxis;d.bg&&(t.beginPath(),t.moveTo(i,s),"arc"==e?t.arc(i,s,n,a,r,!1):(t.lineTo(h.x,h.y),t.lineTo(c.x,c.y)),t.fillStyle=d.bg(o,l),t.moveTo(i,s),t.fill(),t.closePath()),d.lines.call(this,o)&&(t.lineWidth=1,t.beginPath(),"arc"==e?t.arc(i,s,n,a,r,!1):(t.moveTo(h.x,h.y),t.lineTo(c.x,c.y)),t.strokeStyle=d.lineColor.call(this,o),t.stroke())},_drawRadarScaleLabel:function(t,e,i,s,n,a){if(!a)return!1;var r=this.canvases.scale.renderText(0,0,a,"webix_axis_radar_title",1),o=r.scrollWidth,l=r.offsetHeight,h=.001,c=this._getPositionByAngle(n,e,i,s+5),d=0,u=0;(n<0||n>Math.PI)&&(u=-l),n>Math.PI/2&&(d=-o),Math.abs(n+Math.PI/2)<h||Math.abs(n-Math.PI/2)<h?d=-o/2:(Math.abs(n)<h||Math.abs(n-Math.PI)<h)&&(u=-l/2),r.style.top=c.y+u+"px",r.style.left=c.x+d+"px",r.style.width=o+"px",r.style.whiteSpace="nowrap"}},Fo={$render_scatter:function(t,e,i,s,n,a){if(this._settings.xValue){var r=this._settings,o=!(r.disableLines||void 0===r.disableLines),l=this._getLimits(),h=this._getLimits("h","xValue");n||(this.canvases.x||(this.canvases.x=this._createCanvas("axis_x")),this.canvases.y||(this.canvases.y=this._createCanvas("axis_y")),this._drawYAxis(this.canvases.y.getCanvas(),e,i,s,l.min,l.max),this._drawHXAxis(this.canvases.x.getCanvas(),e,i,s,h.min,h.max)),l={min:r.yAxis.start,max:r.yAxis.end},h={min:r.xAxis.start,max:r.xAxis.end};var c=this._getScatterParams(t,e,i,s,h,l);this._mapStart=i;for(var d,u,_,p,f,g=[],m=0;m<e.length;m++){var v=this._calculateScatterItemPosition(c,s,i,h,e[m],"X"),b=this._calculateScatterItemPosition(c,i,s,l,e[m],"Y");isNaN(v)||isNaN(b)||g.push({x:v,y:b,index:m})}for(var w=0;w<g.length;w++){if(f=g[w].index,o){var y=r.line.color.call(this,e[f]);d=g[w].x,u=g[w].y,w==g.length-1?r.shape&&g.length>2&&(this._drawLine(t,_,p,g[0].x,g[0].y,y,r.line.width),r.disableItems||this._drawScatterItem(t,a,g[0],e[0],n),r.fill&&this._fillScatterChart(t,g,e)):(_=g[w+1].x,p=g[w+1].y,this._drawLine(t,d,u,_,p,y,r.line.width))}!r.disableItems&&g[w]&&this._drawScatterItem(t,a,g[w],e[f],n)}}},_fillScatterChart:function(t,e,i){var s,n;t.globalAlpha=this._settings.alpha.call(this,{}),t.beginPath();for(var a=0;a<e.length;a++)t.fillStyle=this._settings.fill.call(this,i[a]),s=e[a],n=e[a+1]||e[0],a||t.moveTo(s.x,s.y),t.lineTo(n.x,n.y);t.fill(),t.globalAlpha=1},_getScatterParams:function(t,e,i,s,n,a){var r={};return r.totalHeight=s.y-i.y,r.totalWidth=s.x-i.x,this._calcScatterUnit(r,n.min,n.max,r.totalWidth,"X"),this._calcScatterUnit(r,a.min,a.max,r.totalHeight,"Y"),r},_drawScatterItem:function(t,e,i,s,n){this._drawItem(t,i.x,i.y,s,this._settings.label.call(this,s),n,e)},_calculateScatterItemPosition:function(t,e,i,s,n,a){var r=this._settings["X"==a?"xValue":"value"].call(this,n),o=t["valueFactor"+a],l=(parseFloat(r||0)-s.min)*o,h=t["unit"+a],c=i[a.toLowerCase()]-("X"==a?-1:1)*Math.floor(h*l);return l<0&&(c=i[a.toLowerCase()]),r>s.max&&(c=e[a.toLowerCase()]),r<s.min&&(c=i[a.toLowerCase()]),c},_calcScatterUnit:function(t,e,i,s,n){var a=this._getRelativeValue(e,i);t["relValue"+(n=n||"")]=a[0],t["valueFactor"+n]=a[1],t["unit"+n]=t["relValue"+n]?s/t["relValue"+n]:10}},Po={$render_splineArea:function(t,e,i,s,n,a){var r,o,l,h,c,d,u,_,p,f,g,m,v,b=this._settings,w=[];if(d=this._calculateLineParams(t,e,i,s,n),c=b.eventRadius||Math.floor(d.cellWidth/2),l=[],e.length){for(p=b.offset?i.x+.5*d.cellWidth:i.x,o=0;o<e.length;o++)((m=this._getPointY(e[o],i,s,d))||"0"==m)&&(_=o?d.cellWidth*o-.5+p:p,l.push({x:_,y:m,index:o}),a.addRect(e[o].id,[_-c-i.x,m-c-i.y,_+c-i.x,m+c-i.y],n));for(u=this._getSplineParameters(l),o=0;o<l.length;o++)if(f=l[o].x,o<l.length-1){for(g=l[o+1].x,v=l[o+1].y,h=f;h<g;h++){var y=this._getSplineYPoint(h,f,o,u.a,u.b,u.c,u.d);y<i.y&&(y=i.y),y>s.y&&(y=s.y);var x=this._getSplineYPoint(h+1,f,o,u.a,u.b,u.c,u.d);x<i.y&&(x=i.y),x>s.y&&(x=s.y),w.push([h,y]),w.push([h+1,x])}w.push([g,v])}r=this._settings.color.call(this,e[0]),w.length&&(w.push([g,s.y]),w.push([w[0][0],s.y])),t.globalAlpha=this._settings.alpha.call(this,e[0]),t.fillStyle=r,t.beginPath(),this._path(t,w),t.fill(),t.lineWidth=1,t.globalAlpha=1,b.border&&(t.lineWidth=b.borderWidth||1,b.borderColor?t.strokeStyle=b.borderColor.call(this,e[0]):this._setBorderStyles(t,r),t.beginPath(),w.splice(w.length-3),this._path(t,w),t.stroke())}}},Bo={dynamic_setter:function(t){return t&&function(t){if(!t._stockRenderHandler){var e=t._settings;e.cellWidth||(e.cellWidth=30),e.animateDuration||(e.animateDuration=400),e.offset=!1,t._stockRenderHandler=t.attachEvent("onBeforeRender",(function(i,s){var n=t._getChartBounds(t._content_width,t._content_height);(function(t){Lo(t,(function(e,i){i._resizeCanvas(t._content_width+2*t._settings.cellWidth,t._content_height)}))})(t),function(t,e,i,s){if(s&&t.length){var n=Math.ceil((i.x-e.x)/s);t.length>n+1&&t.splice(0,t.length-n-1)}}(i,n.start,n.end,e.cellWidth),"add"==s&&function(t){var e=t._settings.cellWidth;t._stockAnimationOffset!=e&&(t._stockAnimationOffset=e,t.render()),t._stockAnimationOffset=0,t._stockAnimationStart=null,window.requestAnimationFrame&&!document.hidden&&window.requestAnimationFrame((function(e){Mo(t,e)})),t._stockAnimateHandler||(t._stockAnimateHandler=t.attachEvent("onAfterRender",(function(e){!function(t,e){var i=t.count(),s=t._getChartBounds(t._content_width,t._content_height),n=t._settings.cellWidth,a=t._stockAnimationOffset||0,r=e.length<i||(e.length-1)*n>s.end.x-s.start.x;function o(t,s,r,o){var l=t.getCanvas(),h=t._canvas,c=t._canvas_labels,d=t._canvas_series;if(a&&(e.length<i||(e.length-1)*n>r-s)?(h.style.left=-a+"px",e.length>1&&(function(t,e,i){if(t.length){wt(t[0]);for(var s=1;s<t.length;s++)Oo(i,t[s])||(t[s].style.left=t[s].offsetLeft-e+"px")}}(c,a,d),l.clearRect(0,0,s+a,h.offsetHeight),l.clearRect(r+a,0,h.offsetWidth,h.offsetHeight))):(h.style.left="0px",o||a==n||l.clearRect(s+(e.length-1)*n-n+a,0,h.offsetWidth,h.offsetHeight)),c.length>1&&a&&a!=n){var u=c.length-1;Oo(d,c[u])&&(u-=1),c[u].style.display="none"}}Lo(t,(function(t,e){o(e,s.start.x,s.end.x,"x"==t)})),function(t,e,i){t._contentobj._htmlmap.style.left=e.start.x-i+"px",t._contentobj._htmlmap.style.width=e.end.x-e.start.x+i+"px"}(t,s,r?a:0)}(t,e)})))}(t)})),t._stockXAxisHandler=t.attachEvent("onBeforeXAxis",(function(e,i,s,n,a,r){return function(t,e,i,s,n,a,r){var o,l,h,c,d=t._settings,u=s.x-.5,_=parseInt(r||n.y,10)+.5,p=n.x;if(!d.dynamic)return!1;for(h=(i.length-1)*a>p-u||i.length<t.count(),l=0;l<i.length;l++)c=u+l*a,o=h?l>1:!!l,c=Math.ceil(c)-.5,t._drawXAxisLabel(c,_,i[l],o),l&&d.xAxis.lines.call(t,i[l])&&t._drawXAxisLine(e,c,n.y,s.y,i[l]);t.canvases.x.renderTextAt(!0,!1,u,n.y+d.padding.bottom-3,d.xAxis.title,"webix_axis_title_x",n.x-s.x),t._drawLine(e,u,_,p+(h?t._stockAnimationOffset:0),_,d.xAxis.color,1)}(t,e,i,s,n,a,r),!1}))}}(this),t}};function Mo(t,e){var i,s=t._settings.animateDuration,n=t._settings.cellWidth;n&&t.count()>1&&(t._stockAnimationStart||(t._stockAnimationStart=e),i=e-t._stockAnimationStart,t._stockAnimationOffset=Math.min(Math.max(i/s*n,1),n),t.render(),i<s&&window.requestAnimationFrame((function(e){Mo(t,e)})))}function Oo(t,e){return"axis_x"===t&&-1!==e.className.indexOf("webix_axis_title_x")}function Lo(t,e){if(t.canvases){for(var i=0;i<t._series.length;i++)t.canvases[i]&&e(i,t.canvases[i]);t.canvases.x&&e("x",t.canvases.x)}}var Ro={name:"chart",$init:function(t){if(this._series=[this._settings],this._legend_labels=[],this._contentobj.className+=" webix_chart",this.$ready.push(this._after_init_call),t.preset&&this._definePreset(t),t.series){var e=t.series;delete t.series,t.series=e}this.data.provideApi(this,!0)},_after_init_call:function(){this.data.attachEvent("onStoreUpdated",A((function(){this.render.apply(this,arguments)}),this))},defaults:{ariaLabel:"chart",color:"default",alpha:"1",radius:0,label:!1,value:"{obj.value}",padding:{},type:"pie",lineColor:"#ffffff",cant:.5,barWidth:30,line:{width:2,color:"#1ca1c1"},item:{radius:3,borderColor:"#1ca1c1",borderWidth:2,color:"#ffffff",alpha:1,type:"r",shadow:!1},shadow:!1,gradient:!1,border:!1,labelOffset:20,origin:"auto",scale:"linear"},_id:"webix_area_id",on_click:{webix_chart_legend_item:function(t,e,i){var s=i.getAttribute("series_id");if(this.callEvent("onLegendClick",[t,s,i])&&!E(s)&&this._series.length>1&&this._series[s]){var n=this._settings,a=n.legend.values,r=a&&a[s].toggle||n.legend.toggle;a&&r&&(-1!=i.className.indexOf("hidden")?this.showSeries(s):this.hideSeries(s))}}},on_dblclick:{},on_mouse_move:{},locate:function(t){return xt(t,this._id)},$setSize:function(t,e){var i=mi.api.$setSize.call(this,t,e);if(i){for(var s in this.canvases)this.canvases[s]._resizeCanvas(this._content_width,this._content_height);this.render()}return i},type_setter:function(t){return f(this["$render_"+t],"Chart type is not supported, or extension is not loaded: "+t),void 0===this._settings.offset&&(this._settings.offset=!(-1!=t.toLowerCase().indexOf("area"))),"radar"!=t||this._settings.yAxis||this.define("yAxis",{}),"scatter"==t&&(this._settings.yAxis||this.define("yAxis",{}),this._settings.xAxis||this.define("xAxis",{})),t},destructor:function(){this.removeAllSeries(),ri.destructor.apply(this,arguments)},removeAllSeries:function(){this.clearCanvas(),this._legendObj&&(this._legendObj.innerHTML="",this._legendObj.parentNode.removeChild(this._legendObj),this._legendObj=null),this.canvases&&(this.canvases={}),this._contentobj.innerHTML="",this._series=[]},clearCanvas:function(){if(this.canvases&&"object"==e(this.canvases))for(var t in this.canvases)this.canvases[t].clearCanvas()},render:function(t,i,s){var n,a,r,o;if(this.isVisible(this._settings.id)&&(a=this._getChartData(),this.callEvent("onBeforeRender",[a,s]))){if(this.canvases&&"object"==e(this.canvases))for(var l in this.canvases)this.canvases[l].clearCanvas();else this.canvases={};if(this._settings.legend&&(this.canvases.legend||(this.canvases.legend=this._createCanvas("legend")),this._drawLegend(this._getDataRange(),this._content_width,this._content_height)),this._map=r=new hs(this._id),o=this._settings,n=this._getChartBounds(this._content_width,this._content_height),this._series)for(var h=0;h<this._series.length;h++)this._settings=this._series[h],this.canvases[h]||(this.canvases[h]=this._createCanvas(this.name+" "+h,"z-index:"+(2+h),null,h,this._settings.ariaLabel)),this["$render_"+this._settings.type](this.canvases[h].getCanvas(),a,n.start,n.end,h,r);if(r.render(this._contentobj),this._contentobj.lastChild.style.zIndex=80,this._applyBounds(this._contentobj.lastChild,n),this.callEvent("onAfterRender",[a]),this._settings=o,this._settings.legend&&this._settings.legend.values)for(var c=this._settings.legend.values,d=0;d<c.length;d++)c[d].$hidden&&this.hideSeries(d)}},_applyBounds:function(t,e){var i={};for(var s in i.left=e.start.x,i.top=e.start.y,i.width=e.end.x-e.start.x,i.height=e.end.y-e.start.y,i)t.style[s]=i[s]+"px"},_getDataRange:function(){return this.data.branch?this._getChartTreeData():this.data.getRange()},_getChartData:function(){var t,i,s,n,a,r,o,l,h,c;if(n=this._getDataRange(),t=-1!=this._settings.type.toLowerCase().indexOf("barh")?"yAxis":"xAxis",(i=this._settings[t])&&i.units&&"object"==e(i.units)){if(l=[],void 0!==(s=i.units).start&&void 0!==s.end&&void 0!==s.next)for(o=s.start;o<=s.end;)l.push(o),o=s.next.call(this,o);else"[object Array]"===Object.prototype.toString.call(s)&&(l=s);if(r=[],l.length){for(h=i.value,c={},a=0;a<n.length;a++)c[h(n[a])]=a;for(a=0;a<l.length;a++)void 0!==c[l[a]]?(n[c[l[a]]].$unit=l[a],r.push(n[c[l[a]]])):r.push({$unit:l[a]})}return r}return n},_getChartTreeData:function(t){var e=this,i=[],s=this.data.branch[t||0];return s&&s.forEach((function(t){var s=e.data.getItem(t);i.push(s),e.data.branch[t]&&(s.data=e._getChartTreeData(t))})),i},series_setter:function(t){if(t&&"object"==e(t)){this._parseSettings(t.length?t[0]:t),this._series=[this._settings];for(var i=1;i<t.length;i++)this.addSeries(t[i])}else f(t,"Chart :: Series must be an array or object");return t},value_setter:le,xValue_setter:le,yValue_setter:function(t){this.define("value",t)},alpha_setter:le,label_setter:le,lineColor_setter:le,borderColor_setter:le,pieInnerText_setter:le,donutInnerText_setter:le,gradient_setter:function(t){return"function"!=typeof t&&t&&!0===t&&(t="light"),t},colormap:{RAINBOW:function(t){var e=Math.floor(this.getIndexById(t.id)/this.count()*1536);return 1536==e&&(e-=1),this._rainbow[Math.floor(e/256)](e%256)},default:function(t){var e=this.count(),i=this._defColors.length,s=this.data.getBranchIndex?this.data.getBranchIndex(t.id):this.getIndexById(t.id);return i>e?(s&&(s=s>0&&s<i-e?this._defColorsCursor+2:this._defColorsCursor+1),this._defColorsCursor=s):s%=i,this._defColors[s]}},color_setter:function(t){return this.colormap[t]||le(t)},childColor_setter:function(t){return le(t)},fill_setter:function(t){return!(!t||"0"==t)&&le(t)},_definePreset:function(t){this.define("preset",t.preset),delete t.preset},preset_setter:function(i){var s,n,a;if(this.defaults=t.extend({},this.defaults),"object"==e(a=this.presets[i])){for(s in a)if("object"==e(a[s]))if(this.defaults[s]&&"object"==e(this.defaults[s]))for(n in this.defaults[s]=t.extend({},this.defaults[s]),a[s])this.defaults[s][n]=a[s][n];else this.defaults[s]=t.extend({},a[s]);else this.defaults[s]=a[s];return i}return!1},legend_setter:function(t){return t?("object"!=e(t)&&(t={template:t}),this._mergeSettings(t,{width:150,height:18,layout:"y",align:"left",valign:"bottom",template:"",toggle:-1!=this._settings.type.toLowerCase().indexOf("stacked")?"":"hide",marker:{type:"square",width:15,height:15,radius:3},margin:4,padding:3}),t.template=le(t.template),t):(this._legendObj&&(this._legendObj.innerHTML="",this._legendObj=null),!1)},item_setter:function(i){"object"!=e(i)&&(i={color:i,borderColor:i}),this._mergeSettings(i,t.extend({},this.defaults.item));return this._converToTemplate(["alpha","borderColor","color","radius","type"],i),i},line_setter:function(i){return"object"!=e(i)&&(i={color:i}),(i=t.extend(i,this.defaults.line)).color=le(i.color),i},padding_setter:function(t){return"object"!=e(t)&&(t={left:t,right:t,top:t,bottom:t}),this._mergeSettings(t,{left:50,right:20,top:35,bottom:40}),t},xAxis_setter:function(i){if(!i)return!1;"object"!=e(i)&&(i={template:i}),this._mergeSettings(i,{title:"",color:vi.dataBorderColor,lineColor:vi.dataBorderColor,template:"{obj}",lines:!0});return this._converToTemplate(["lineColor","template","lines"],i),this._configXAxis=t.extend({},i),i},yAxis_setter:function(e){this._mergeSettings(e,{title:"",color:vi.dataBorderColor,lineColor:vi.dataBorderColor,template:"{obj}",lines:!0,bg:vi.backColor});return this._converToTemplate(["lineColor","template","lines","bg"],e),this._configYAxis=t.extend({},e),e},_converToTemplate:function(t,e){for(var i=0;i<t.length;i++)e[t[i]]=le(e[t[i]])},_createCanvas:function(t,e,i,s,n){var a={container:i||this._contentobj,name:t,title:E(n)?t:n||"",series:s,style:e||"",width:this._content_width,height:this._content_height};return new ki(a)},_drawScales:function(t,e,i,s,n,a){var r,o=0;return this._settings.yAxis&&(this.canvases.y||(this.canvases.y=this._createCanvas("axis_y")),o=this._drawYAxis(this.canvases.y.getCanvas(),t,e,i,s,n)),this._settings.xAxis&&(this.canvases.x||(this.canvases.x=this._createCanvas("axis_x")),r=this.canvases.x.getCanvas(),this.callEvent("onBeforeXAxis",[r,t,e,i,a,o])&&this._drawXAxis(r,t,e,i,a,o)),o},_drawXAxis:function(t,e,i,s,n,a){var r,o,l=this._settings,h=i.x-.5,c=parseInt(a||s.y,10)+.5,d=s.x,u=!0,_="stackedBar"==l.type?s.y+.5:c;for(r=0;r<e.length;r++){!0===l.offset?o=h+n/2+r*n:(o=r!=e.length-1||l.cellWidth?h+r*n:s.x,u=!!r),o=Math.ceil(o)-.5;var p="auto"!=l.origin&&"bar"==l.type&&parseFloat(l.value(e[r]))<l.origin;this._drawXAxisLabel(o,_,e[r],u,p),(l.offset||r||l.cellWidth)&&l.xAxis.lines.call(this,e[r])&&this._drawXAxisLine(t,o,s.y,i.y,e[r])}this.canvases.x.renderTextAt(!0,!1,h,s.y+l.padding.bottom-3,l.xAxis.title,"webix_axis_title_x",s.x-i.x),this._drawLine(t,h,c,d,c,l.xAxis.color,1),l.xAxis.lines.call(this,{})&&l.offset&&this._drawLine(t,d+.5,s.y,d+.5,i.y+.5,l.xAxis.lineColor.call(this,{}),1)},_drawYAxis:function(t,e,i,s,n,a){var r,o={};if(this._settings.yAxis){var l=i.x-.5,h=s.y,c=i.y,d=s.y+.5;if(this._settings.yAxis.step&&(r=parseFloat(this._settings.yAxis.step)),void 0===this._configYAxis.step||void 0===this._configYAxis.start||void 0===this._configYAxis.end?(n=(o=this._calculateScale(n,a)).start,a=o.end,r=o.step,this._settings.yAxis.end=a,this._settings.yAxis.start=n):"logarithmic"==this.config.scale&&(this._logScaleCalc=!0),this._setYAxisTitle(i,s),0!==r){if(a==n)return h;for(var u=(h-c)*r/(a-n),_=0,p=this._settings.origin,f=n;f<=a;f+=r){var g=this._logScaleCalc?Math.pow(10,f):f;o.fixNum&&(g=parseFloat(g).toFixed(o.fixNum));var m=Math.floor(h-_*u)+.5;if(f==n&&"auto"==p||!this._settings.yAxis.lines.call(this,f)||this._drawLine(t,l,m,s.x,m,this._settings.yAxis.lineColor.call(this,f),1),"auto"!=p&&f<=p&&f+r>p&&(d=m-u*(p-g)/r),r<1&&!this._logScaleCalc){var v=Math.min(Math.floor(this._log10(r)),n<=0?0:Math.floor(this._log10(n))),b=Math.pow(10,-v);f=g=Math.round(g*b)/b}this.canvases.y.renderText(0,m-5,this._settings.yAxis.template(g.toString()),"webix_axis_item_y",i.x-5),_++}return this._drawLine(t,l,h+1,l,c,this._settings.yAxis.color,1),d}}},_setYAxisTitle:function(t,e){var i=this.canvases.y.renderTextAt("middle",!1,0,parseInt((e.y-t.y)/2+t.y,10),this._settings.yAxis.title,"webix_axis_title_y");i&&(i.style.left=(i.offsetHeight-i.offsetWidth)/2+"px")},_calculateLogScale:function(t,e){return{start:Math.floor(this._log10(t)),step:1,end:Math.ceil(this._log10(e))}},_normStep:function(t){var e=Math.floor(this._log10(t)),i=Math.pow(10,e),s=t/i;return s=s>5?10:5,parseInt(s,10)*i},_calculateScale:function(t,e){if(this._logScaleCalc=!1,"logarithmic"==this._settings.scale){var i=Math.floor(this._log10(t)),s=Math.ceil(this._log10(e));if(t>0&&e>0&&s-i>1)return this._logScaleCalc=!0,this._calculateLogScale(t,e)}var n,a;"auto"!=this._settings.origin&&this._settings.origin<t&&(t=this._settings.origin);var r=this._normStep((e-t)/8||1),o=Math.floor(this._log10(r));if(r>Math.abs(t))n=t<0?-r:0;else{var l=Math.abs(t),h=Math.floor(this._log10(l)),c=l/Math.pow(10,h);for(n=0!=h||r>=.1?Math.ceil(10*c)/10*Math.pow(10,h)-r:l,l>1&&r>.1&&(n=Math.ceil(n));t<0?n<=t:n>=t;)n-=r;t<0&&(n=-n-2*r),n-=n%r,n=parseFloat((1*n).toFixed(Math.abs(o)))}for(e-n>10&&(r=this._normStep((e-n)/8||1)),a=n,0==e&&e==t&&(e=r);a<e;)a+=r,a=parseFloat((1*a).toFixed(Math.abs(o)));return{start:n,end:a,step:r,fixNum:o<0?Math.abs(o):0}},_getLimits:function(t,e){var i,s,n=this.data._obj_array(),a=arguments.length&&"h"==t?this._configXAxis:this._configYAxis;if(e=e||"value",a&&void 0!==a.end&&void 0!==a.start&&a.step)i=parseFloat(a.end),s=parseFloat(a.start);else if(i=as.max(this._series[0][e],n),s=a&&void 0!==a.start?parseFloat(a.start):as.min(this._series[0][e],n),this._series.length>1)for(var r=1;r<this._series.length;r++){var o=as.max(this._series[r][e],n),l=as.min(this._series[r][e],n);o>i&&(i=o),l<s&&(s=l)}return{max:i,min:s}},_log10:function(t){return Math.log(t)/Math.LN10},_drawXAxisLabel:function(t,e,i,s,n){if(this._settings.xAxis){var a=this.canvases.x.renderTextAt(n,s,t,e-(n?2:0),this._settings.xAxis.template(i));a&&(a.className+=" webix_axis_item_x")}},_drawXAxisLine:function(t,e,i,s,n){this._settings.xAxis&&this._settings.xAxis.lines&&this._drawLine(t,e,i,e,s,this._settings.xAxis.lineColor.call(this,n),1)},_drawLine:function(t,e,i,s,n,a,r){t.strokeStyle=a,t.lineWidth=r,t.beginPath(),t.moveTo(e,i),t.lineTo(s,n),t.stroke(),t.lineWidth=1},_getRelativeValue:function(t,e){return[e!=t?e-t:t,1]},_rainbow:[function(t){return"#FF"+ys.toHex(t/2,2)+"00"},function(t){return"#FF"+ys.toHex(t/2+128,2)+"00"},function(t){return"#"+ys.toHex(255-t,2)+"FF00"},function(t){return"#00FF"+ys.toHex(t,2)},function(t){return"#00"+ys.toHex(255-t,2)+"FF"},function(t){return"#"+ys.toHex(t,2)+"00FF"}],_defColors:["#f55b50","#ff6d3f","#ffa521","#ffc927","#ffee54","#d3e153","#9acb61","#63b967","#21a497","#21c5da","#3ea4f5","#5868bf","#7b53c0","#a943ba","#ec3b77","#9eb0b8"],_defColorsCursor:0,addSeries:function(e){var i=this._settings;this._settings=t.extend({},i),this._parseSettings(e),this._series.push(this._settings),this._settings=i},$tooltipIn:function(t){return t},_get_tooltip_data:function(e,i){var s=this.locate(i);if(!s)return null;var n=this._getActiveSeries(i),a=t.extend({dx:20,dy:0,template:"{obj.value}",css:""},this._series[n].tooltip||{template:""},!0);return $e._tooltip.define(a),this.getItem(s)},_getActiveSeries:function(t){var e=this._settings.type;if(e.indexOf("pie")>-1||e.indexOf("donut")>-1)return 1*t.target.getAttribute("userdata");for(var i,s=this._map._areas,n=kt(this._contentobj._htmlmap),a=$t(t),r=a.x-n.x,o=a.y-n.y,l=0;l<s.length;l++){var h=s[l].points;r<=h[2]&&r>=h[0]&&o<=h[3]&&o>=h[1]&&(i?s[l].index>i.index&&(i=s[l]):i=s[l])}return i?i.index:0},hideSeries:function(t){this.canvases[t].hideCanvas();var e=this._settings.legend;e&&e.values&&e.values[t]&&(e.values[t].$hidden=!0,this._drawLegend()),this._map.hide(this._contentobj,t,!0)},showSeries:function(t){this.canvases[t].showCanvas();var e=this._settings.legend;e&&e.values&&e.values[t]&&(delete e.values[t].$hidden,this._drawLegend()),this._map.hide(this._contentobj,t,!1)},_drawLegend:function(t,e){var i,s,n,a,r,o,l,h,c,d,u=0,_=0;if(t=t||[],e=e||this._content_width,h=this.canvases.legend.getCanvas(),s=this._settings.legend,l="x"!=this._settings.legend.layout?"width:"+s.width+"px":"",this._legendObj&&(this._legendObj.innerHTML="",this._legendObj.parentNode.removeChild(this._legendObj)),this.canvases.legend.clearCanvas(!0),n=vt("DIV",{class:"webix_chart_legend",style:"left:"+u+"px; top:"+_+"px;"+l},""),s.padding&&(n.style.padding=s.padding+"px"),this._legendObj=n,this._contentobj.appendChild(n),r=[],s.values)for(i=0;i<s.values.length;i++){var p=E(s.values[i].id)?i:s.values[i].id,f=this._drawLegendText(n,s.values[i].text,p,s.values[i].$hidden);r.push(f)}else for(i=0;i<t.length;i++)r.push(this._drawLegendText(n,s.template(t[i]),t[i].id));var g,m,v=document.body.contains(this._contentobj);for(v||(m=vt("DIV",{style:"visibility:hidden; position:absolute; top:0px; left:0px;"},""),g=this._contentobj.parentNode,document.body.appendChild(m),m.appendChild(this._contentobj)),o=n.offsetWidth,a=n.offsetHeight,o<e&&("x"==s.layout&&"center"==s.align?u=(e-o)/2:"right"==s.align&&(u=e-o),s.margin&&"center"!=s.align&&(u+=("left"==s.align?1:-1)*s.margin)),a<this._content_height&&("middle"==s.valign&&"center"!=s.align&&"x"!=s.layout?_=(this._content_height-a)/2:"bottom"==s.valign&&(_=this._content_height-a),s.margin&&"middle"!=s.valign&&(_+=("top"==s.valign?1:-1)*s.margin)),n.style.left=u+"px",n.style.top=_+"px",h.save(),i=0;i<r.length;i++){var b=r[i];s.values&&s.values[i].$hidden?(d=!0,c=s.values[i].disableColor||vi.dataBorderColor):(d=!1,c=s.values?s.values[i].color:this._settings.color.call(this,t[i],i)),this._drawLegendMarker(h,b.offsetLeft+u,b.offsetTop+_,c,b.offsetHeight,d,i)}h.restore(),v||(g.appendChild(this._contentobj),wt(m)),r=null},_drawLegendText:function(t,e,i,s){var n="";"x"==this._settings.legend.layout&&(n="float:left;");var a=vt("DIV",{style:n+"padding-left:"+(10+this._settings.legend.marker.width)+"px",class:"webix_chart_legend_item"+(s?" hidden":""),role:"button",tabindex:"0","aria-label":R.aria[(s?"show":"hide")+"Chart"]+" "+e},e);return arguments.length>2&&a.setAttribute("series_id",i),t.appendChild(a),a},_drawLegendMarker:function(t,e,i,s,n,a,r){var o=[],l=this._settings.legend.marker,h=this._settings.legend.values,c=h&&h[r].markerType?h[r].markerType:l.type;if(s&&(t.strokeStyle=t.fillStyle=s),"none"==c)return!1;if("round"!=c&&l.radius)if("item"==c){if(this._settings.line&&"scatter"!=this._settings.type&&!this._settings.disableLines){t.beginPath(),t.lineWidth=this._series[r].line.width,t.strokeStyle=a?s:this._series[r].line.color.call(this,{});var d=e+5,u=i+n/2;t.moveTo(d,u);var _=d+l.width;t.lineTo(_,u),t.stroke()}var p=this._series[r].item,f=parseInt(p.radius.call(this,{}),10)||0,g=p.type.call(this,{});f&&(t.beginPath(),a?(t.lineWidth=p.borderWidth,t.strokeStyle=s,t.fillStyle=s):(t.lineWidth=p.borderWidth,t.fillStyle=p.color.call(this,{}),t.strokeStyle=p.borderColor.call(this,{}),t.globalAlpha=p.alpha.call(this,{})),t.beginPath(),e+=l.width/2+5,i+=n/2,this._strokeChartItem(t,e,i,f+1,g),t.fill(),t.stroke()),t.globalAlpha=1}else t.beginPath(),t.lineWidth=1,e+=5,i+=n/2-l.height/2,o=[[e+l.radius,i+l.radius,l.radius,Math.PI,3*Math.PI/2,!1],[e+l.width-l.radius,i],[e+l.width-l.radius,i+l.radius,l.radius,-Math.PI/2,0,!1],[e+l.width,i+l.height-l.radius],[e+l.width-l.radius,i+l.height-l.radius,l.radius,0,Math.PI/2,!1],[e+l.radius,i+l.height],[e+l.radius,i+l.height-l.radius,l.radius,Math.PI/2,Math.PI,!1],[e,i+l.radius]],this._path(t,o),t.stroke(),t.fill();else{t.beginPath();var m=l.height/2;t.arc(e+m+5,i+n/2,m,0,2*Math.PI),t.fill()}},_getChartBounds:function(t,e){var i=this._settings.padding,s=i.left,n=i.top,a=t-i.right,r=e-i.bottom;if(this._settings.legend){var o=this._settings.legend,l=o.width,h=o.height;"x"==o.layout?"center"==o.valign?"right"==o.align?a-=l:"left"==o.align&&(s+=l):"bottom"==o.valign?r-=h:n+=h:"right"==o.align?a-=l:"left"==o.align&&(s+=l)}return{start:{x:s,y:n},end:{x:a,y:r}}},_getStackedLimits:function(t){var e,i,s,n,a;if(this._settings.yAxis&&void 0!==this._settings.yAxis.end&&void 0!==this._settings.yAxis.start&&this._settings.yAxis.step)s=parseFloat(this._settings.yAxis.end),n=parseFloat(this._settings.yAxis.start);else{for(e=0;e<t.length;e++)for(t[e].$sum=0,t[e].$min=1/0,i=0;i<this._series.length;i++)a=Math.abs(parseFloat(this._series[i].value(t[e])||0)),isNaN(a)||(-1!=this._series[i].type.toLowerCase().indexOf("stacked")&&(t[e].$sum+=a),a<t[e].$min&&(t[e].$min=a));for(s=-1/0,n=1/0,e=0;e<t.length;e++)t[e].$sum>s&&(s=t[e].$sum),t[e].$min<n&&(n=t[e].$min);n>0&&(n=0)}return{max:s,min:n}},_setBarGradient:function(t,e,i,s,n,a,r,o){var l,h,c,d,u,_;return"light"==a?(l="x"==o?t.createLinearGradient(e,i,s,i):t.createLinearGradient(e,i,e,n),_=[[0,"#FFFFFF"],[.9,r],[1,r]],h=2):"falling"==a||"rising"==a?(l="x"==o?t.createLinearGradient(e,i,s,i):t.createLinearGradient(e,i,e,n),c=ys.toRgb(r),(d=ys.rgbToHsv(c[0],c[1],c[2]))[1]*=.5,u="rgb("+ys.hsvToRgb(d[0],d[1],d[2])+")","falling"==a?_=[[0,u],[.7,r],[1,r]]:"rising"==a&&(_=[[0,r],[.3,r],[1,u]]),h=0):(t.globalAlpha=.37,h=0,l="x"==o?t.createLinearGradient(e,n,e,i):t.createLinearGradient(e,i,s,i),_=[[0,"#9d9d9d"],[.3,"#e8e8e8"],[.45,"#ffffff"],[.55,"#ffffff"],[.7,"#e8e8e8"],[1,"#9d9d9d"]]),this._gradient(l,_),{gradient:l,offset:h}},_getPositionByAngle:function(t,e,i,s){return t*=-1,{x:e+=Math.cos(t)*s,y:i-=Math.sin(t)*s}},_gradient:function(t,e){for(var i=0;i<e.length;i++)t.addColorStop(e[i][0],e[i][1])},_path:function(t,e){var i,s;for(i=0;i<e.length;i++)s=i?"lineTo":"moveTo",e[i].length>2&&(s="arc"),t[s].apply(t,e[i])},_addMapRect:function(t,e,i,s,n){t.addRect(e,[i[0].x-s.x,i[0].y-s.y,i[1].x-s.x,i[1].y-s.y],n)},_getMinBarOffset:function(t){var e=this._settings.barOffset;return(E(e)||e>t-1)&&(e=Math.ceil(t/5)),e}},zo=t.protoUI(Ro,Io,Ao,Do,Eo,jo,Vo,{$render_spline:function(t,e,i,s,n,a){var r,o,l,h,c,d,u,_,p,f,g,m,v;if(c=this._calculateLineParams(t,e,i,s,n),r=this._settings,this._mapStart=i,l=[],e.length){for(_=r.offset?i.x+.5*c.cellWidth:i.x,o=0;o<e.length;o++)((g=this._getPointY(e[o],i,s,c))||"0"==g)&&(u=o?c.cellWidth*o-.5+_:_,l.push({x:u,y:g,v:this._settings.value(e[o]),index:o}));for(d=this._getSplineParameters(l),o=0;o<l.length;o++){if(p=l[o].x,m=l[o].y,o<l.length-1){for(f=l[o+1].x,v=l[o+1].y,h=p;h<f;h++){var b=this._getSplineYPoint(h,p,o,d.a,d.b,d.c,d.d);b<i.y&&(b=i.y),b>s.y&&(b=s.y);var w=this._getSplineYPoint(h+1,p,o,d.a,d.b,d.c,d.d);w<i.y&&(w=i.y),w>s.y&&(w=s.y),this._drawLine(t,h,b,h+1,w,r.line.color(e[o]),r.line.width)}this._drawLine(t,f-1,this._getSplineYPoint(h,p,o,d.a,d.b,d.c,d.d),f,v,r.line.color(e[o]),r.line.width)}this._drawItem(t,p,m,e[l[o].index],r.label(e[l[o].index]),n,a)}}},_getSplineParameters:function(t){var e,i,s,n,a,r,o,l,h=[],c=[],d=t.length;for(a=0;a<d-1;a++)h[a]=t[a+1].x-t[a].x,c[a]=(t[a+1].y-t[a].y)/h[a];for(l=[],(o=[])[0]=0,o[1]=2*(h[0]+h[1]),l[0]=0,l[1]=6*(c[1]-c[0]),a=2;a<d-1;a++)o[a]=2*(h[a-1]+h[a])-h[a-1]*h[a-1]/o[a-1],l[a]=6*(c[a]-c[a-1])-h[a-1]*l[a-1]/o[a-1];for((r=[])[d-1]=r[0]=0,a=d-2;a>=1;a--)r[a]=(l[a]-h[a]*r[a+1])/o[a];for(e=[],i=[],s=[],n=[],a=0;a<d-1;a++)e[a]=t[a].y,i[a]=-h[a]*r[a+1]/6-h[a]*r[a]/3+(t[a+1].y-t[a].y)/h[a],s[a]=r[a]/2,n[a]=(r[a+1]-r[a])/(6*h[a]);for(a=0;a<t.length-1;a++)0===t[a].v&&0===t[a+1].v&&(e[a]=t[a].y,n[a]=s[a]=i[a]=0);return{a:e,b:i,c:s,d:n}},_getSplineYPoint:function(t,e,i,s,n,a,r){return s[i]+(t-e)*(n[i]+(t-e)*(a[i]+(t-e)*r[i]))}},No,To,Fo,{presets:{simple:{item:{borderColor:"#ffffff",color:"#2b7100",shadow:!1,borderWidth:2},line:{color:"#8ecf03",width:2}},plot:{color:"#8664C6",item:{borderColor:"#8664C6",borderWidth:1,color:"#ffffff",type:"r",shadow:!1},line:{color:"#8664C6",width:2}},diamond:{color:"#FF5C4C",item:{borderColor:"#FF5C4C",color:"#FF5C4C",type:"d",radius:3,shadow:!0},line:{color:"#FF5C4C",width:2}},point:{color:"#1ca1c1",disableLines:!0,fill:!1,disableItems:!1,item:{color:"#1ca1c1",borderColor:"#1ca1c1",radius:2,borderWidth:2,type:"r"},alpha:1},line:{line:{color:"#1ca1c1",width:2},item:{color:"#ffffff",borderColor:"#1ca1c1",radius:2,borderWidth:2,type:"d"},fill:!1,disableItems:!1,disableLines:!1,alpha:1},area:{fill:"#1ca1c1",line:{color:"#1ca1c1",width:1},disableItems:!0,alpha:.2,disableLines:!1},round:{item:{radius:3,borderColor:"#1ca1c1",borderWidth:1,color:"#1ca1c1",type:"r",shadow:!1,alpha:.6}},square:{item:{radius:3,borderColor:"#00a497",borderWidth:2,color:"#ffffff",type:"s",shadow:!1,alpha:1},line:{color:"#00a497"}},column:{color:"RAINBOW",gradient:!1,barWidth:45,radius:0,alpha:1,border:!0},stick:{barWidth:5,gradient:!1,color:"#1ca1c1",radius:2,alpha:1,border:!1},alpha:{color:"#b9a8f9",barWidth:70,gradient:"falling",radius:0,alpha:.5,border:!0}}},Po,Bo,os,xi,Gi,_s,H,mi.view),Ho={api:Ro,view:zo},qo={name:"rangechart",defaults:{type:"line"},$init:function(){this.attachEvent("onAfterRender",this._init_frame),this._set_full_range()},_init_frame:function(){var e=this;if(f(!/(pie|donut|radar|H)/.test(this._settings.type),"Not suppored chart type"),this._map._areas.length&&!this._frame){this._setMap(),this._item_radius=(this._map._areas[0].points[2]-this._map._areas[0].points[0])/2;var i={webix_disable_drag:"true",tabindex:"0",role:"button","aria-label":R.aria.resizeChart};this._rHandle=vt("div",t.extend({class:"webix_chart_resizer right"},i)),this._lHandle=vt("div",t.extend({class:"webix_chart_resizer left"},i)),this._frame=vt("div",{class:"webix_chart_frame",webix_disable_drag:"true"}),this._viewobj.appendChild(this._lHandle),this._viewobj.appendChild(this._frame),this._viewobj.appendChild(this._rHandle),this._setHandle(),_e(this._rHandle,Ot.mouse.down,(function(t){return e._frDown(t,"mouse")})),_e(this._lHandle,Ot.mouse.down,(function(t){return e._frDown(t,"mouse")})),_e(this._frame,Ot.mouse.down,(function(t){return e._frDown(t,"mouse")})),Ot.touch&&(_e(this._rHandle,Ot.touch.down,(function(t){return e._frDown(t,"touch")})),_e(this._lHandle,Ot.touch.down,(function(t){return e._frDown(t,"touch")})),_e(this._frame,Ot.touch.down,(function(t){return e._frDown(t,"touch")}))),_e(F(this._rHandle),"keydown",this._keyShift,{bind:this}),_e(F(this._lHandle),"keydown",this._keyShift,{bind:this}),this._value&&(this._settings.range=this._set_full_range(this._value)),this._refresh_range(),this.callEvent("onAfterRangeChange",[this._value]),this.data.attachEvent("onStoreUpdated",A(this._refresh_range,this))}else this._setHandle(!0)},$setSize:function(t,e){Ho.api.$setSize.call(this,t,e)&&(this._setMap(),this._refresh_range())},_setHandle:function(t){this._rHandle&&!this._handle_radius&&(this._handle_radius=this._rHandle.clientWidth/2,t&&this._refresh_range())},_setMap:function(){var t=this._getChartBounds(this._content_width,this._content_height);this._mapStart=t.start,this._mapEnd=t.end},removeAllSeries:function(){this._frame=this._rHandle=this._lHandle=null,Ho.api.removeAllSeries.apply(this,arguments)},_keyShift:function(t){var e=t.which||t.keyCode;if(37===e||39===e){St(t);var i=-1!==t.target.className.indexOf("right")?"eindex":"sindex",s=-1!==t.target.className.indexOf("right")?"end":"start",n=this._value;n[i]=n[i]+(37===e?-1:1),this._map._areas[n[i]]&&(n[s]=this._get_id_by_index(n[i]),this.setFrameRange(n))}},_frDown:function(t,e){var i=this;if(-1!==t.target.className.indexOf("webix_chart_resizer"))this._activeHandle=t.target;else if(this._map._areas.length){var s=this._map._areas[this._value.sindex].points[2]-this._item_radius,n=this._map._areas[this._value.eindex].points[2]-this._item_radius;this._activeFrame={ex:$t(t).x,fx:s+this._mapStart.x,fw:n-s}}Dt(this._viewobj,"webix_noselect webix_wresize_cursor"),this._frClear();var a="touch"===e?{passive:!1}:null;this._resizeHandlerMove=pe(document.body,Ot[e].move,(function(t){return i._frMove(t,e)}),a),this._resizeHandlerUp=pe(document,Ot[e].up,(function(t){return i._frUp(t,e)}))},_frClear:function(){this._resizeHandlerMove&&(fe(this._resizeHandlerMove),fe(this._resizeHandlerUp),this._resizeHandlerUp=this._resizeHandlerMove=null)},_frMove:function(e,i){if(this._activeHandle){var s=$t(e).x-kt(this.$view).x;s>=this._mapStart.x&&s<=this._mapEnd.x&&(-1!==this._activeHandle.className.indexOf("left")?s<this._rHandle.offsetLeft&&(this._activeHandle.style.left=s-this._handle_radius+"px",this._frame.style.left=s+"px",this._frame.style.width=this._rHandle.offsetLeft-this._lHandle.offsetLeft-1+"px"):s>this._lHandle.offsetLeft+this._handle_radius&&(this._activeHandle.style.left=s-this._handle_radius+"px",this._frame.style.width=this._rHandle.offsetLeft-this._lHandle.offsetLeft-1+"px"))}else if(this._activeFrame){var n=$t(e).x-this._activeFrame.ex,a=this._activeFrame.fx+n,r=a+this._activeFrame.fw;this._mapStart.x<=a&&this._mapEnd.x>=r&&(t.extend(this._activeFrame,{lx:a,rx:r},!0),this._lHandle.style.left=a-this._handle_radius+"px",this._rHandle.style.left=r-this._handle_radius+"px",this._frame.style.left=a+"px")}"touch"===i&&St(e)},_frUp:function(t,e){if(this._frClear(),Et(this._viewobj,"webix_noselect"),Et(this._viewobj,"webix_wresize_cursor"),this.count()){if(this._activeHandle){var i="touch"===e?t.changedTouches[0].pageX:$t(t).x;i-=kt(this.$view).x+this._mapStart.x;var s=this._get_index_by_pos(i),n=this._get_id_by_index(s);this._activeHandle===this._lHandle?(s>=this._value.eindex&&(s=this._value.eindex,n=this._get_id_by_index(s)),this._value.start=n,this._value.sindex=s):(s<=this._value.sindex&&(s=this._value.sindex,n=this._get_id_by_index(s)),this._value.end=n,this._value.eindex=s),this._activeHandle=null}else if(this._activeFrame&&this._activeFrame.lx){var a=this._value.sindex=this._get_index_by_pos(this._activeFrame.lx-this._mapStart.x),r=this._value.eindex=this._get_index_by_pos(this._activeFrame.rx-this._mapStart.x);this._value.start=this._get_id_by_index(a),this._value.end=this._get_id_by_index(r),this._activeFrame=null}this._refresh_range(),this.callEvent("onAfterRangeChange",[this._value.start,this._value.end])}},_get_id_by_index:function(t){return t>=this.data.order.length&&(t=this.data.order.length-1),this.getItem(this.data.order[t])[this._settings.frameId||"id"]},_get_index_by_pos:function(t){for(var e=this._map._areas,i=0;i<e.length;i++)if(t<=e[i].points[2]-this._item_radius)return i;return e.length-1},_get_frame_index:function(t){for(var e=this._settings.frameId||"id",i=0;i<this.data.order.length;i++)if(this.getItem(this.data.order[i])[e]==t)return i;return-1},_set_full_range:function(t){t?(t.start&&(t.sindex=this._get_frame_index(t.start)),t.end&&(t.eindex=this._get_frame_index(t.end)),t.start=t.start||this._get_id_by_index(t.sindex),t.end=t.end||this._get_id_by_index(t.eindex)):t={start:0,end:0,sindex:0,eindex:0},this._value=t},range_setter:function(t){return this._set_full_range(t),this._value},getFrameData:function(){for(var t=[],e=this._value.sindex;e<=this._value.eindex;e++){var i=this.getItem(this.data.order[e]);i&&t.push(i)}return t},setFrameRange:function(t){this._set_full_range(t),this._refresh_range(),this.callEvent("onAfterRangeChange",[t])},_refresh_range:function(){if(this._map){var t=this._map._areas;if(t.length){var e=t[this._value.sindex].points[0]+this._mapStart.x+this._item_radius-1,i=t[this._value.eindex].points[0]+this._mapStart.x+this._item_radius-1;this._lHandle.style.left=e-this._handle_radius+"px",this._rHandle.style.left=i-this._handle_radius+"px",this._frame.style.left=e+"px",this._frame.style.width=i-e+"px",this._settings.range=this._value}}},getFrameRange:function(){return this._settings.range}},Uo=(t.protoUI(qo,Ho.view),{name:"grouplist",defaults:{animate:{}},_listClassName:"webix_grouplist",$init:function(){t.extend(this.data,Ws,!0),this.data.count=function(){return this.order.length},this.data.provideApi(this,!0),this.data.attachEvent("onClearAll",A(this._onClear,this)),this._onClear()},_onClear:function(){this._nested_cursor=[],this._nested_chain=[]},$setSize:function(){mi.api.$setSize.apply(this,arguments)&&(this._dataobj.style.width=this._content_width)},on_click:{webix_list_item:function(t,e){return!this._animation_promise&&(this._level_up(e)||this._level_down(e)?this.render():void(this._settings.select&&(this._no_animation=!0,"multiselect"==this._settings.select||this._settings.multiselect?this.select(e,!1,"touch"==this._settings.multiselect||t.ctrlKey||t.metaKey,t.shiftKey):this.select(e),this._no_animation=!1)))}},_level_up:function(t){for(var e=0;e<this._nested_chain.length;e++)if(this._nested_chain[e]==t){for(var i=e;i<this._nested_chain.length;i++)this.data.getItem(this._nested_chain[i]).$template="";return e?(this._nested_cursor=this.data.branch[this._nested_chain[e-1]],this._nested_chain.splice(e)):(this._nested_cursor=this.data.branch[0],this._nested_chain=[]),this._is_level_down=!1,!0}},_level_down:function(t){var e=this.getItem(t);if(e.$count&&-1===L.find.call(this._nested_chain,t))return e.$template="Back",this._nested_cursor=this.data.branch[e.id],this._nested_chain.push(t),this._is_level_down=!0},getOpenState:function(){return{parents:this._nested_chain,branch:this._nested_cursor}},setOpenState:function(t){var e=0;if(t){var i=this.getItem(t);e=i.$count?i.id:i.$parent}for(this._nested_cursor=this.data.branch[e],this._nested_chain=[];e;)this.getItem(e).$template="Back",this._nested_chain.unshift(e),e=this.getItem(e).$parent;this._no_animation=!0,this.render(),this._no_animation=!1},render:function(e,i,s){var n,a,r=arguments,o=this;if(this._nested_chain=I(this._nested_chain),this._nested_cursor=I(this._nested_cursor),this._nested_chain.length)for(n=0;n<this._nested_chain.length;n++)this.data.branch[this._nested_chain[n]]||(this._nested_chain.splice(n,1),n--);if(a=this._nested_chain.length?this._nested_chain[this._nested_chain.length-1]:0,this._nested_cursor=I(this.data.branch[a]),!this._nested_cursor.length&&this._nested_chain.length&&(this._nested_cursor=[a],this._nested_chain.pop()),this._animation_promise)return this._animation_promise.then((function(){return o.render.apply(o,r)}));for(n=0;n<this._nested_cursor.length;n++)this.data.getItem(this._nested_cursor[n]).$template="";if(this._nested_cursor.length||(this._nested_cursor=this.data.branch[0]),this.data.order=O([].concat(this._nested_chain).concat(this._nested_cursor)),this.callEvent("onBeforeRender",[this.data])){if(!this._no_animation&&this._dataobj.innerHTML&&this._settings.animate&&this._prev_nested_chain_length!=this._nested_chain.length){if(this.callEvent("onBeforeRender",[this.data])){this._back_scroll_states||(this._back_scroll_states=[]);var l=this._dataobj.cloneNode(!1);l.innerHTML=this.data.getRange().map(this._toHTML,this).join("");var h=t.extend({},this._settings.animate);h.direction=this._is_level_down?"left":"right";var c,u=[S(h),S(h)];this._is_level_down?this._back_scroll_states.push(this.getScrollState()):c=this._back_scroll_states.pop();var _=Ci.formLine(l,this._dataobj,h);h.master=this,h.callback=function(){this._dataobj=l,this._is_level_down?this.scrollTo(0,0):c&&this.scrollTo(0,c.y),Ci.breakLine(_),h.master=h.callback=null,this._htmlmap=this._animation_promise=null,h.wait_animation.resolve(),this.callEvent("onAfterRender",[])},Ci(_,u),this._animation_promise=h.wait_animation=d.defer()}}else{if(e&&"delete"!==s&&-1===this.data.getIndexById(e))return;vs.render.apply(this,arguments)}this._prev_nested_chain_length=this._nested_chain.length}},templateBack_setter:function(t){this.type.templateBack=le(t)},templateItem_setter:function(t){this.type.templateItem=le(t)},templateGroup_setter:function(t){this.type.templateGroup=le(t)},type:{template:function(t,e){return t.$count?e.templateGroup(t,e):e.templateItem(t,e)},css:"group",classname:function(t,e,i){return"webix_list_item webix_"+(t.$count?"group":"item")+(t.$template?"_back":"")+(i&&i.webix_selected?" webix_selected":"")+(e.css?" "+e.css:"")+(t.$css?" "+t.$css:"")},templateStart:le('<div webix_l_id="#id#" class="{common.classname()}" style="width:{common.widthSize()}; height:{common.heightSize()};  overflow:hidden;" {common.aria()}>'),templateBack:le("#value#"),templateItem:le("#value#"),templateGroup:le("#value#"),templateEnd:function(t){var e="";return t.$count&&(e+="<div class='webix_arrow_icon'></div>"),e+"</div>"}},showItem:function(t){-1===this.data.getIndexById(t)&&this.setOpenState(t),vs.showItem.call(this,t)}});ge(t.protoUI(Uo,os,br.view),{});var Wo={name:"unitlist",_id:"webix_item_id",uniteBy_setter:le,render:function(t,e,i){var s=this._settings;if(this.isVisible(s.id)&&s.uniteBy){if(t){var n=this.getItemNode(t);if(n&&"update"==i&&this._settings.uniteBy.call(this,e)==this.getItem(t).$unitValue)return yt(this._htmlmap[t]=this._toHTMLObject(e),n),void wt(n)}this.callEvent("onBeforeRender",[this.data])&&(this.units=null,this._setUnits(),this.units&&(this.callEvent("onUnits",[]),this._dataobj.innerHTML=this._getUnitRange().map(this._toHTML,this).join(""),this._htmlmap=null),this.callEvent("onAfterRender",[]))}},getUnits:function(){var t=[];if(this.units)for(var e in this.units)t.push(e);return t},getUnitList:function(t){return this.units?this.units[t]:null},_toHTML:function(t){var e=this.data._marks[t.id];return f(!t.$template||this.type["template"+t.$template],"RenderStack :: Unknown template: "+t.$template),this.callEvent("onItemRender",[t]),t.$unit?this.type.templateStartHeader(t,this.type)+this.type.templateHeader.call(this,t.$unit)+this.type.templateEnd(t,this.type):this.type.templateStart(t,this.type,e)+(t.$template?this.type["template"+t.$template]:this.type.template)(t,this.type)+this.type.templateEnd(t,this.type)},_getUnitRange:function(){var t=[],e=this.data.$min||0,i=this.data.$max||1/0,s=0;for(var n in this.units){t.push({$unit:n});for(var a=this.units[n],r=0;r<a.length;r++){if(s==e&&(t=[{$unit:n}]),t.push(this.getItem(a[r])),s==i)return O(t);s++}}return O(t)},_setUnits:function(){var t=this;this.units={},this.data.each((function(e){var i=t._settings.uniteBy.call(this,e);e.$unitValue=i,t.units[i]||(t.units[i]=[]),t.units[i].push(e.id)}))},type:{headerHeight:20,classname:function(t,i,s){var n="webix_list_item";return i.css&&(n+=" webix_list_"+i.css+"_item"),s&&s.$css&&(n+=" "+s.$css),t.$css&&("object"==e(t.$css)&&(t.$css=ft(t.$css)),n+=" "+t.$css),n},templateHeader:function(t){return"<span class='webix_unit_header_inner'>"+t+"</span>"},templateStart:function(t,e,i){if(t.$unit)return e.templateStartHeader.apply(this,arguments);var s="width:"+e.widthSize(t,e,i)+"; height:"+e.heightSize(t,e,i)+"; overflow:hidden;"+(e.layout&&"x"==e.layout?"float:left;":"");return'<div webix_item_id="'+t.id+'" class="'+e.classname(t,e,i)+'" style="'+s+'" '+e.aria(t,e,i)+">"},templateStartHeader:function(t,e,i){var s="webix_unit_header"+(e.css?" webix_unit_header_"+e.css+"_item":""),n="width:"+e.widthSize(t,e,i)+"; height:"+e.headerHeight+"px; overflow:hidden;";return'<div webix_unit_id="'+t.$unit+'" class="'+s+'" style="'+n+'">'}},$skin:function(){br.api.$skin.call(this),this.type.headerHeight=vi.unitHeaderHeight}};t.protoUI(Wo,br.view),R.dbllist={selectAll:"<span class='webix_icon wxi-angle-double-right'></span>",selectOne:"<span class='webix_icon wxi-angle-right'></span>",deselectAll:"<span class='webix_icon wxi-angle-double-left'></span>",deselectOne:"<span class='webix_icon wxi-angle-left'></span>"};var Yo={name:"dbllist",defaults:{borderless:!0},$init:function(){this._moved={},this._inRight=A((function(t){return this._moved[t.id]}),this),this._inLeft=A((function(t){return!this._moved[t.id]}),this),this.$view.className+=" webix_dbllist",this.$ready.unshift(this._setLayout)},$onLoad:function(t,e){var i=this.$$("left"),s=this.$$("right");return this._updateAndResize((function(){i.data.driver=e,i.parse(t),s.data.driver=e,s.parse(t)})),this._data_ready=!0,this._refresh(),!0},_getButtons:function(){if(!1===this._settings.buttons)return{width:10};var t=R.dbllist,e=[this._getButton("deselect_all",t.deselectAll),this._getButton("select_all",t.selectAll),this._getButton("deselect_one",t.deselectOne),this._getButton("select_one",t.selectOne)];return e={width:120,template:e.join(""),onClick:{dbllist_button:function(t,e,i){this.getTopParentView()._update_list(i.getAttribute("action"))}}},this._settings.buttons&&(e.template=this._settings.buttons),e},_getButton:function(t,e){return"<button class='dbllist_button' action='"+t+"'>"+e+"</button>"},_getList:function(e,i,s,n){var a={view:"list",select:"multiselect",multiselect:"touch",id:e,action:i,drag:!0,type:{margin:3,id:e},on:{onBeforeDrop:function(t){var e=t.from,i=t.to,s=e.getTopParentView();if(s===this.getTopParentView()){var n="select_one"!=i._settings.action;s.select(t.source,n)}return!1},onItemDblClick:function(){return this.getTopParentView()._update_list(this.config.action)}}};return this._settings.list&&t.extend(a,this._settings.list,!0),s&&(a={rows:[{view:"label",label:s,css:"webix_inp_top_label"},a]}),n?{rows:[a,{view:"label",height:20,label:n,css:"bottom_label"}]}:a},_setLayout:function(){var t=[{margin:10,type:"clean",cols:[this._getList("left","select_one",this._settings.labelLeft,this._settings.labelBottomLeft),this._getButtons(),this._getList("right","deselect_one",this._settings.labelRight,this._settings.labelBottomRight)]}];this.cols_setter(t)},_update_list:function(t){var e=this,i=null,s=!1;"select_all"===t?(i=e.$$("left").data.order,s=!0):"select_one"===t?(i=e.$$("left").getSelectedId(!0),s=!0):"deselect_all"===t?(i=e.$$("right").data.order,s=!1):"deselect_one"===t&&(i=e.$$("right").getSelectedId(!0),s=!1),e.select(i,s)},select:function(t,i){var s;if("object"!==e(t)&&(t=[t]),i)for(s=0;s<t.length;s++)this._moved[t[s]]=!0;else for(s=0;s<t.length;s++)delete this._moved[t[s]];this._refresh(),this.callEvent("onChange",[])},_updateAndResize:function(t,e){De(A(t,this),!1),e&&(this.$$("left")._settings.autoheight||this.$$("right")._settings.autoheight)&&this.resize()},_refresh:function(){var t=this.$$("left"),e=this.$$("right");t&&this._updateAndResize((function(){t.filter(this._inLeft),e.filter(this._inRight)}),!0)},focus:function(){if(!ni.canFocus(this))return!1;ni.setFocus(this)},value_setter:function(t){this.setValue(t)},setValue:function(t){if(this._moved={},t){"object"!==e(t)&&(t=t.toString().split(","));for(var i=0;i<t.length;i++)this._moved[t[i]]=!0}this._refresh()},getValue:function(){var t=[],e=this.$$("left");for(var i in this._moved)this._data_ready&&!e.data.pull[i]||t.push(i);return t.join(",")}},Go=(t.protoUI(Yo,Zt,cs,Gn.view),{name:"tree",defaults:{scroll:"auto",navigation:!0},$init:function(){this._viewobj.className+=" webix_tree",t.extend(this.data,Ws,!0),t.extend(this.on_click,Rs),this.data.provideApi(this,!0),this._viewobj.setAttribute("role","tree")},_id:"webix_tm_id",on_context:{},on_dblclick:{webix_tree_checkbox:function(){if(this.on_click.webix_tree_checkbox)return this.on_click.webix_tree_checkbox.apply(this,arguments)}},$fixEditor:function(t){var e=this.getItemNode(t.id).querySelector("span");if(e){""===e.innerHTML&&(e.innerHTML="&nbsp;");var i=e.offsetLeft;t.node.style.width=this.$view.scrollWidth-i-10+"px",t.node.style.marginLeft=i+"px",t.node.style.left="0px"}},on_click:{webix_tree_item:function(t,e){if(this._settings.activeTitle&&(this.getItem(e).open?this.close(e):this.open(e)),this._settings.select)if("multiselect"==this._settings.select||this._settings.multiselect){var i=t.ctrlKey||t.metaKey||"touch"==this._settings.multiselect;if("level"==this._settings.multiselect&&(i||t.shiftKey)){var s=this.getSelectedId(!0)[0];if(s&&this.getParentId(e)!=this.getParentId(s))return}this.select(e,!1,i,t.shiftKey)}else this.select(e)}},_paste:{insert:function(t){var e=this.getSelectedId()||"0";this.add({value:t},null,e)},modify:function(t){for(var e=this.getSelectedId(!0),i=0;i<e.length;i++)this.getItem(e[i]).value=t,this.refresh(e[i])},custom:function(){}},_drag_order_complex:!0,$dragHTML:function(t,e,i){var s="<div class='webix_tree_item'>"+this.type.template(t,this.type)+"</div>";return B(i.source)&&i.source.length>1&&(s=this._toMultipleHTML(s,i.source.length)),s},_close_branches:function(t){for(var e=t.source,i=0;i<e.length;i++)this.close(e[i])},_set_drop_area:function(t,e){var i=this.getItemNode(t);i?i.parentNode.insertBefore(Ai._dropHTML[0],i):e.children[0].children[0].appendChild(Ai._dropHTML[0])},type:t.extend({template:function(t,e){return(e["template"+t.level]||e.templateCommon).apply(this,arguments)},classname:function(t,i,s){var n="webix_tree_item";return t.$css&&("object"==e(t.$css)&&(t.$css=ft(t.$css)),n+=" "+t.$css),s&&s.$css&&(n+=" "+s.$css),i.css&&(n+=" "+i.css),n},aria:function(t,e,i){return'role="treeitem"'+(i&&i.webix_selected?' aria-selected="true" tabindex="0"':' tabindex="-1"')+(t.$count?'aria-expanded="'+(t.open?"true":"false")+'"':"")+'aria-level="'+t.$level+'"'},templateCommon:le("{common.icon()}{common.folder()}<span>#value#</span>"),templateStart:le('<div webix_tm_id="#id#" class="{common.classname()}" {common.aria()}>'),templateEnd:le("</div>"),templateCopy:le("#value#")},Gs)}),Ko=t.protoUI(Go,Us,os,Ls,Xi,Hs,ws,ds,_s,bs,zs,mr.view,qs,Mi,H),Xo={api:Go,view:Ko};ge(Ko,{name:"lineTree",css:"webix_line_tree",icon:function(t,e){for(var i="",s="",n=1;n<=t.$level;n++){n==t.$level&&(s=t.$count?t.open?"webix_tree_open ":"webix_tree_close ":"webix_tree_none ");var a=e._icon_src(t,e,n);a&&(i+="<div class='"+s+"webix_tree_img webix_tree_"+a+"'></div>")}return i},_icon_src:function(t,e,i){var s=e._tree_branch_render_state,n=qs._obj;if(0===s&&n){var a=t.$level,r=t.id;for(s=[];a;){var o=n.getParentId(r),l=n.data.branch[o];l[l.length-1]==r&&(s[a]=!0),r=o,a--}e._tree_branch_render_state=s}if(!s)return 0;if(i==t.$level){var h=3;return t.$parent||0===t.$index&&(h=4),s[t.$level]&&(h=2),t.$count?t.open?"minus"+h:"plus"+h:"line"+h}return s[i]?"blank":"line1"}});var Jo={name:"treemap",defaults:{activeItem:!1,subRender:!0,header:!0,headerHeight:35,value:le("#value#"),headerTemplate:"",navigation:!0},value_setter:le,headerTemplate_setter:le,header_setter:function(t){return t&&!0!==t&&(this.type.header=t),t},$init:function(){this.$view.className+=" webix_treemap",this._viewobj.setAttribute("role","tree"),this._htmlElement=document.createElement("DIV"),t.extend(this.data,Ws,!0),this.data.provideApi(this,!0),this.data.attachEvent("onClearAll",A((function(){this._html="",this.$values={},this.$xy={}}),this)),this.attachEvent("onKeyPress",this._onKeyPress)},_toHTMLItem:function(t){var e=this.data._marks[t.id];this.callEvent("onItemRender",[t]);var i=t.$template?this.type["template"+t.$template].call(this,t,this.type,e):this.type.template.call(this,t,this.type,e);return this.type.templateStart.call(this,t,this.type,e)+i+this.type.templateEnd.call(this)},_renderHeader:function(t){var e=this.getItem(t),i=this._settings.headerHeight,s="<div class='webix_treemap_header' style='height:"+i+"px;line-height:"+i+"px;'>";return(s+=this.type.header.call(this,e,this.type))+"</div>"},_renderBranch:function(t){var e,i,s,n,a=[];if(!this.$width||!this.count())return this._html="",!1;if(t||(t=this.config.branch||0,this._html="",this.$values={},this.$xy={},this.$xy[t]={width:this.$width,height:this.$height,top:0,left:0},t&&this._settings.header&&(this.$xy[t].height-=this._settings.headerHeight,this.$xy[t].top=this._settings.headerHeight,this._html+=this._renderHeader(t)),n=0,this.data.each((function(t){var e=this.getParentId(t.id);if(!this.data.branch[t.id]&&(s=1*this.config.value.call(this,t),!isNaN(s)&&s))for(this.$values[t.id]=s,n+=s;e;)this.$values[e]||(this.$values[e]=0),this.$values[e]+=s,e=this.getParentId(e)}),this,!1,t)),this.data.eachChild(t,(function(t){this.$values[t.id]&&a.push(I(t))}),this),n=n||this.$values[t],a.length&&n){(i={top:(e=this.$xy[t]).top,left:e.left,dx:e.width,dy:e.height,set:[],sum:0}).dim=Math.min(i.dx,i.dy);for(var r=i.dx*i.dy/n,o=0;o<a.length;o++)a[o].$value=this.$values[a[o].id]*r;a.sort((function(t,e){return t.$value>e.$value?-1:1}));for(var l=1/0,h=0;a[h];){var c=this._worst(i,a[h]);if(c<l)i.sum+=a[h].$value,i.set.push(a[h]),l=c,h++;else{this._renderRow(i);var d={top:i.top,left:i.left,dx:i.dx,dy:i.dy,set:[],sum:0},u=i.sum/i.dim;i.dx>i.dy?(d.left+=u,d.dx-=u):(d.top+=u,d.dy-=u),(i=d).dim=Math.min(i.dx,i.dy),l=1/0}}}i&&this._renderRow(i)},_renderRow:function(t){var e,i,s,n,a=t.top,r=t.left;for(t.mode=t.dy<t.dx,t.contra=t.sum/t.dim,e=0;e<t.set.length;e++)i=t.set[e].id,t.mode?(s=t.contra,n=t.set[e].$value/t.contra):(s=t.set[e].$value/t.contra,n=t.contra),this.$xy[i]={},this.$xy[i].top=a,this.$xy[i].left=r,t.mode?a+=n:r+=s,this.$xy[i].width=s,this.$xy[i].height=n,this._html+=this._toHTMLItem(this.getItem(i)),this._settings.subRender&&this.data.branch[i]&&this._renderBranch(i)},_worst:function(t,e){var i=t.sum+e.$value,s=i*i/(t.dim*t.dim*e.$value);return t.set.length&&(s=Math.max(t.dim*t.dim*t.set[0].$value/(i*i),s)),s>1?s:1/s},_toHTMLObject:function(t){return this._htmlElement.innerHTML=this._toHTMLItem(t),this._htmlElement.firstChild},showBranch:function(t){this._settings.branch=t,this.refresh()},render:function(t,e,i){if(this.isVisible(this._settings.id)&&!this.$blockRender){if("update"==i){var s=this.getItemNode(t);s&&(yt(this._htmlmap[t]=this._toHTMLObject(e),s),wt(s))}else!this.data.branch||this._settings.branch&&!this.data.branch[this._settings.branch]||(this._htmlmap=null,this.callEvent("onBeforeRender",[]),this._renderBranch(),this._dataobj.innerHTML=this._html,this.callEvent("onAfterRender",[]));return!0}},_id:"webix_dm_id",on_click:{webix_treemap_item:function(t,e){this._settings.select&&("multiselect"==this._settings.select||this._settings.multiselect?this.select(e,!1,t.ctrlKey||t.metaKey||"touch"==this._settings.multiselect,t.shiftKey):this.select(e)),this._settings.activeItem&&this.isBranch(e)&&this.showBranch(e)},webix_treemap_header_item:function(t){var e=xt(t,"webix_dm_header_id");this.define("branch",e),this.refresh()},webix_treemap_reset:function(){this.define("branch",0),this.refresh()}},on_dblclick:{},on_mouse_move:{},_getCssText:function(t){var e="";for(var i in t)e+=i+":"+t[i]+";";return e},type:{template:le("#value#"),header:function(t,e){for(var i=t.id,s="<div role='button' tabindex='0' aria-label='"+R.aria.resetTreeMap+"' class='webix_treemap_reset'></div>",n=[];i;)t=this.getItem(i),n.push(e.headerItem.call(this,t,e)),i=this.getParentId(i);return n.reverse(),s+n.join("<span class='webix_icon wxi-angle-right webix_treemap_path_icon'></span>")},headerItem:function(t){var e=this.config.headerTemplate(t),i='<a role="button" tabindex="0" aria-label="'+e+'" webix_dm_header_id="'+t.id+'" class="webix_treemap_header_item">';return(i+=e)+"</a>"},classname:function(t,i,s){var n="webix_treemap_item";i.css&&(n+=" "+i.css),t.$css&&("object"==e(t.$css)&&(t.$css=ft(t.$css)),n+=" "+t.$css);var a=this.$xy[t.id];s&&s.$css&&(n+=" "+s.$css),n+=" webix_treemap_level_"+this.getItem(t.id).$level;var r=this.getParentId(t.id);if(r&&r!=this._settings.branch||(n+=" webix_treemap_level_top"),this.$height-a.top-a.height<1&&(n+=" webix_treemap_item_bottom"),this.$width-a.left-a.width<1&&(n+=" webix_treemap_item_right"),i.cssClass){var o=i.cssClass.call(this,t,i,s);o&&("object"==e(o)?n+=" "+ft(o):n+=" "+o)}return n},templateStart:function(t,e,i){var s="";if(this.$xy){var n=this.$xy[t.id];s+="width: "+n.width+"px; height: "+n.height+"px;",s+="top: "+n.top+"px; left: "+n.left+"px;"}return'<div role="treeitem" aria-level="'+t.$level+'" '+(i&&i.webix_selected?'aria-selected="true" tabindex="0"':"")+' webix_dm_id="'+t.id+'" class="'+e.classname.call(this,t,e,i)+'" style="'+s+'">'},templateEnd:le("</div>")}},Zo=(t.protoUI(Jo,os,Ls,ws,ds,_s,bs,zs,mr.view,qs,Mi,H),{name:"dataview",$init:function(e){e.sizeToContent&&this.$ready.unshift(this._after_init_call);var i=e.type||e.item;e.prerender||this.defaults.prerender||i&&"auto"==i.width||"move"==e.drag||"order"==e.drag||e.autoheight||t.extend(this,Zs,!0),e.autoheight&&(e.scroll=!1),i&&"tiles"==i.type&&(this._tilesPadding=i.padding||this.type.padding,this._viewobj.firstChild.style.float="left",this._viewobj.firstChild.style.padding=this._tilesPadding/2+"px"),this._contentobj.className+=" webix_dataview",this._viewobj.setAttribute("role","listbox")},_after_init_call:function(){var t=vt("DIV",0,this.type.template({}));t.className="webix_dataview_item",t.style.position="absolute",document.body.appendChild(t),this.type.width=t.offsetWidth+this._tilesPadding,this.type.height=t.offsetHeight+this._tilesPadding,wt(t)},defaults:{scroll:!0,datafetch:50,navigation:!0},_id:"webix_l_id",_itemClassName:"webix_dataview_item",_tilesPadding:0,_drag_direction:"x",on_click:{webix_dataview_item:function(t,e){this._settings.select&&("multiselect"==this._settings.select||this._settings.multiselect?this.select(e,!1,"touch"==this._settings.multiselect||t.ctrlKey||t.metaKey,t.shiftKey):this.select(e))}},on_dblclick:{},on_mouse_move:{},type:{template:le("#value#"),templateLoading:le("Loading..."),width:160,height:50,padding:8,classname:function(t,i,s){var n="webix_dataview_item";return i.css&&(n+=" "+i.css),i.type&&(n+=" "+i.type),t.$css&&("object"==e(t.$css)&&(t.$css=ft(t.$css)),n+=" "+t.$css),s&&s.$css&&(n+=" "+s.$css),n},aria:function(t,e,i){return'role="option"'+(i&&i.webix_selected?' aria-selected="true" tabindex="0"':' tabindex="-1"')},templateStart:function(t,e,i){var s=e.width,n=e.height,a=0;return"tiles"==e.type&&(s-=e.padding,n-=e.padding,a=e.padding/2),'<div webix_l_id="'+t.id+'" class="'+e.classname(t,e,i)+'" '+e.aria(t,e,i)+' style="margin:'+a+"px; width:"+s+"px; height:"+n+'px; float:left; overflow:hidden;">'},templateEnd:le("</div>")},$dropHTML:function(){var t=this._tilesPadding;return'<div class="webix_drop_area_inner" style="width:'.concat(this.type.width-t,"px; height:").concat(this.type.height-t,"px; margin:").concat(t/2,'px"></div>')},_calck_autoheight:function(t){return this._settings.height=this.type.height*Math.ceil(this.data.count()/Math.floor(t/this.type.width))},autoheight_setter:function(t){var e=this;return t&&(this.data.attachEvent("onStoreLoad",(function(){return e.resize()})),this.data.attachEvent("onStoreUpdated",(function(t,i,s){t&&"add"!==s&&"delete"!==s||e._auto_resize()})),this.data.attachEvent("onSyncApply",(function(){return e._auto_resize()})),this._contentobj.style.overflowY="hidden"),t},_auto_resize:function(){this._settings.autoheight&&this.resize()},$getSize:function(t,e){this._settings.xCount&&"auto"!=this.type.width&&!this._autowidth&&(this._settings.width=this.type.width*this._settings.xCount+this._tilesPadding+(this._scroll_y?Ot.scrollSize:0)),this._settings.yCount&&"auto"!=this.type.height&&!this._autoheight&&(this._settings.height=this.type.height*this._settings.yCount+this._tilesPadding);var i=this._settings.width||this._content_width;return this._settings.autoheight&&i&&(this._recalk_counts(),this._calck_autoheight(i),this.scroll_setter(!1)),mi.api.$getSize.call(this,t,e)},_recalk_counts:function(){return this._settings.yCount&&(this._autoheight||"auto"==this.type.height)&&(this.type.height=Math.floor((this._content_height-this._tilesPadding)/this._settings.yCount),this._autoheight=this._settings.yCount),this._settings.xCount&&(this._autowidth||"auto"==this.type.width)&&(this.type.width=Math.floor((this._content_width-this._tilesPadding)/this._settings.xCount),this._autowidth=this._settings.xCount),this._autoheight||this._autowidth},$setSize:function(t,e){var i=this._settings;if(mi.api.$setSize.call(this,t,e)){if(i.autoheight&&this._calck_autoheight()!=this._content_height)return j(this.resize,this);(this._recalk_counts()||this._render_visible_rows)&&this.render()}else(i.yCount&&i.yCount!=this._autoheight||i.xCount&&i.xCount!=this._autowidth)&&this._recalk_counts()&&this.render()}});t.protoUI(Zo,zi,Xi,_s,ds,ws,bs,Oi,mr.view),R.pager={first:"<span class='webix_icon wxi-angle-double-left'></span>",last:"<span class='webix_icon wxi-angle-double-right'></span>",next:"<span class='webix_icon wxi-angle-right'></span>",prev:"<span class='webix_icon wxi-angle-left'></span>"};var Qo={defaults:{size:10,page:0,group:5,template:"{common.pages()}",maxWidth:1e5,height:30,borderless:!0},name:"pager",on_click:{webix_pager_item:function(t,e){this.select(e)}},$init:function(t){this.data=this._settings,this._dataobj=this._viewobj,this._viewobj.className+=" webix_pager",!1!==t.master&&0!==t.master||this.$ready.push(this._remove_master)},_remove_master:function(){this.refresh(),this.$master={refresh:function(){},select:function(){}}},select:function(t){if(this.$master&&"pager"==this.$master.name)return this.$master.select(t);switch(t){case"next":t=this._settings.page+1;break;case"prev":t=this._settings.page-1;break;case"first":t=0;break;case"last":t=this._settings.limit-1}t<0&&(t=0),t>=this.data.limit&&(t=this.data.limit-1);var e=this.data.page;this.callEvent("onBeforePageChange",[t,e])&&(this.data.page=1*t,this.$master._scrollTop=0,this.refresh()&&(this._settings.animate&&this._animate(e,1*t,this._settings.animate)||this.$master.refresh()),this.callEvent("onAfterPageChange",[t]))},_id:"webix_p_id",template_setter:le,type:{template:function(t,e){return t.template.call(this,t,e)},pages:function(t){var e="";if(-1==t.page)return"";t.$min=t.page-Math.round((t.group-1)/2),t.$max=t.$min+1*t.group-1,t.$min<0&&(t.$max+=-1*t.$min,t.$min=0),t.$max>=t.limit&&(t.$min-=Math.min(t.$min,t.$max-t.limit+1),t.$max=t.limit-1);for(var i=t.$min||0;i<=t.$max;i++)e+=this.button({id:i,index:i+1,selected:i==t.page?"_selected":"",label:R.aria.page+" "+(i+1)});return e},page:function(t){return t.page+1},first:function(){return this.button({id:"first",index:R.pager.first,selected:"",label:R.aria.pages[0]})},last:function(){return this.button({id:"last",index:R.pager.last,selected:"",label:R.aria.pages[3]})},prev:function(){return this.button({id:"prev",index:R.pager.prev,selected:"",label:R.aria.pages[1]})},next:function(){return this.button({id:"next",index:R.pager.next,selected:"",label:R.aria.pages[2]})},button:le("<button type='button' webix_p_id='{obj.id}' class='webix_pager_item{obj.selected}' aria-label='{obj.label}'>{obj.index}</button>")},clone:function(t){t.$view||(t.view="pager",t=be(t)),this._clone=t,t.$master=this,this._refresh_clone()},refresh:function(){var t=this._settings;t.limit=Math.ceil(t.count/t.size)||1;var e=Math.min(t.limit-1,t.page);return e!=t.page?this.$master.setPage(e):(t.page=e,e>=0&&e!=t.old_page||t.limit!=t.old_limit||t.old_count!=t.count?(this.render(),this._refresh_clone(),t.old_limit=t.limit,t.old_page=t.page,t.old_count=t.count,!0):void 0)},apiOnly_setter:function(t){return this.$apiOnly=t},_refresh_clone:function(){this._clone&&(this._clone._settings.count=this._settings.count,this._clone._settings.page=this._settings.page,this._clone.refresh())},_animate:function(e,i,s){if(e==i)return!1;if(this._pgInAnimation)return this._pgAnimateTimeout&&window.clearTimeout(this._pgAnimateTimeout),!!(this._pgAnimateTimeout=j(this._animate,this,[e,i,s],100));var n=i>e?"left":"right";"top"!=s.direction&&"bottom"!=s.direction||(n=i>e?"top":"bottom"),s.flip&&(n="");var a=0,r=this.$master._dataobj,o=!!this.$master._body;o&&(a=(r=this.$master._body).offsetTop,Dt(this.$master.$view,"webix_animation"));var l,h=r.cloneNode(!0);h.style.width=r.style.width="100%",this.$master.refresh(),yt(h,r.nextSibling,r.parentNode),o&&(h.childNodes[1].scrollLeft=r.childNodes[1].scrollLeft);var c=!0!==s?s:{},d=t.extend({direction:n,callback:A((function(){d.callback=null,Ci.breakLine(l),this._pgInAnimation=!1,this.$master._body&&Et(this.$master.$view,"webix_animation")}),this),top:a,keepViews:o},c);return l=Ci.formLine(r,h,d),Ci([r,h],d),this._pgInAnimation=!0}},tl=(t.protoUI(Qo,_s,wi,mi.view,H),{name:"comments",defaults:{sendAction:"click",mode:"comments",highlight:!0,maxInputHeight:84},$init:function(t){this.$view.className+=" webix_comments",this._destroy_with_me=[],t.rows=[this.$configList(t)],t.moreButton||(t.moreButton=le(R.comments.moreComments)),t.readonly||(t.rows.push(this.$configForm(t)),this._initMenu()),Ot.mobile&&(t.keepButtonVisible=!0),this._initUsers(t.users),this.$ready.push(this._afterInit)},$exportView:function(){return this._list},_afterInit:function(){var t=this;this._list=this.queryView("list"),this._form=this.queryView("form"),this._sendButton=this.queryView("button"),this._input=this.queryView({localId:"textarea"}),this.config.mentions&&this._initMentions(this.config.mentions),this._list.data.provideApi(this,!0),this.serialize=function(){var e=t._list.serialize(),i=t.getIndexById("$more");return i>=0&&e.splice(i,1),e},this._settings.readonly||(this._clickHandler=W("onClick",(function(e){var i=ke(e);i==t._input?t.focus():i===t._sendButton||i===t._listMenu||t._userList&&i===t._userList.getList()||e&&-1!==(e.target.className||"").toString().indexOf("webix_comments_menu")||t._changeTextarea(!1)})),this.attachEvent("onDestruct",(function(){Y(this._clickHandler),fe(this._transitionEv)})),this._list.attachEvent("onAfterScroll",(function(){t._listMenu.hide()}))),this._list.$view.style.transition="height 0.5s ease",this._transitionEv=pe(this._list.$view,"transitionend",(function(){Ot.$customScroll&&Li.resize(),t.callEvent("onTransitionEnd",[])}))},$onLoad:function(t,e){return this._fillList(t,e)},_fillList:function(t,e){var i=this,s=this._list||this.queryView({view:"list"});s.data.driver=e;var n=!1;if("function"==typeof t.serialize?t=t.serialize():(n=t.more,t=e.getRecords(t)),this._moreCall){if(this._moreCall=!1,t.length){var a=s.data.order,r=1;if("chat"==this._settings.mode)s.data.order=O([a[0]].concat(new Array(t.length),a.slice(1)));else{var o=s.getIndexById("$more");s.data.order=O(a.slice(0,o).concat(new Array(t.length),a.slice(o))),r=o}s.parse({data:t,pos:r}),n&&Ui(this._list).ignore((function(){i._list.updateItem("$more",{value:n})})),"chat"==this._settings.mode&&s.showItem(s.getIdByIndex(t.length))}t.length&&n||Ui(this._list).ignore((function(){i._list.remove("$more")}))}else n&&!s.exists("$more")&&(n={id:"$more",value:n,$css:"webix_comments_more_item"},"chat"==this._settings.mode?t.unshift(n):t.push(n)),s.parse(t),"chat"==this._settings.mode&&s.waitData.then((function(){return s.showItem(s.getLastId())}));return!0},$skin:function(){Gn.api.$skin.call(this),this._inputHeight=vi.inputHeight+6},getUsers:function(){return this._users},getMenu:function(){return this._listMenu},setCurrentUser:function(t,e){this.config.currentUser=t,this._form.clear(e),this._list.refresh()},edit:function(t,e){if(!this.config.readonly&&this.callEvent("onBeforeEditStart",[t])){this._changeTextarea(!0);var i=this._list.getItem(t);this._form.setValues(i,!1,e),this._form.focus();var s=this._form.elements.text.getInputNode();s.scrollTop=s.scrollHeight,Tt(s,i.text.length),this.callEvent("onAfterEditStart",[t])}},_saveComment:function(t){var e=this._form.getValues();e.text&&(e.id?this.updateItem(e.id,e):(this.config.currentUser&&(e.user_id=this.config.currentUser),e.date=new Date,this.add(e),this._list.showItem(e.id)),this._form.clear("user"),t&&(this._input.getInputNode().value=""))},_removeComment:function(t){this._form.getValues().id==t&&this._form.clear("user"),this.remove(t)},_changeTextarea:function(t){if(t!==this._text_expanded){var e=this._settings;t?(this._sendButton.getParentView().show(),this._input.define({height:e.maxInputHeight})):(ni.hasFocus(this._sendButton)&&ni.setFocus(this._list),e.keepButtonVisible||this._sendButton.getParentView().hide(),this._input.define({height:e.minInputHeight||this._inputHeight})),this._input.resize(),this._text_expanded=t}},focus:function(){var t=this;this._changeTextarea(!0),j((function(){t._input.focus()}))},_toggleButton:function(t){t||(t=this._input.getValue()),t&&!this._sendButton.isEnabled()?this._sendButton.enable():!t&&this._sendButton.isEnabled()&&this._sendButton.disable()},_initMenu:function(){var t=this;this._listMenu=be({view:"contextmenu",autowidth:!0,point:!1,data:[{id:"edit",icon:"wxi-pencil",value:R.comments.edit},{id:"remove",icon:"wxi-trash",value:R.comments.remove}],on:{onShow:function(){var e=t._listMenu.getContext();t._list.addCss(e.id,"active_menu")},onHide:function(){var e=t._listMenu.getContext();t._list.removeCss(e.id,"active_menu")},onItemClick:function(e){var i=t._listMenu.getContext();t.callEvent("onBeforeMenuAction",[e,i.id])&&("edit"==e?t.edit(i.id,"user"):"remove"==e&&(R.comments.confirmMessage?Qe({text:R.comments.confirmMessage,callback:function(e){e&&t._removeComment(i.id)}}):t._removeComment(i.id)))}}}),this._destroy_with_me.push(this._listMenu)},$configForm:function(e){var i=this,s=R.comments,n={view:"textarea",localId:"textarea",css:"webix_comments_textarea",height:e.minInputHeight||this._inputHeight,name:"text",placeholder:s.placeholder,keyPressTimeout:100,on:{onTimedKeyPress:function(){i._toggleButton()},onChange:function(t){i._toggleButton(t)},onKeyPress:function(t,e){if(13==t){var s=i._settings.sendAction,n=e.shiftKey;("enter"==s&&!n||"enter"!==s&&n)&&(St(e),i._saveComment(!0))}}}};return!1!==e.highlight&&t.extend(n,{view:"texthighlight",type:"textarea",highlight:function(t){return i._highlightMention(le.escape(t),!0)}},!0),{view:"form",minHeight:50,paddingX:10,elements:[n,{hidden:!e.keepButtonVisible,cols:[{},{view:"button",disabled:!0,css:"webix_comments_send webix_primary",value:s.send,autowidth:!0,click:function(){i._saveComment()}}]}]}},_highlightMention:function(t,e){var i,s=this;if(-1===t.indexOf("@"))return t;"users"===this._settings.highlight&&(i=this._userList&&this._userList._settings.textValue||"value");var n=e?this._markedText:this._markedHTML;return t.replace(n,(function(t,n,a,r){return s._wrapName(t,r||n,i,e)}))},_wrapName:function(t,e,i,s){return i&&!this._users.find((function(t){return t[i]==e}),!0)?t:'<span class="webix_comments_mention">'.concat(s?t:"@"+e,"</span>")},$configList:function(e){var i=this,s="webix_comments_",n={height:"auto",templateStatus:function(t){return"<span class = '"+s+"status "+t.status+"'></span>"},templateUser:function(t){var e=i.getUsers(),n=e&&e.exists(t.user_id)?e.getItem(t.user_id):{};return"<span class = '"+s+"name'>"+(n.value||"")+"</span>"},templateMenu:function(){return i.config.readonly?"":"<span class='webix_icon wxi-dots "+s+"menu'></span>"},templateDate:function(t){var e=$n.dateToStr("%d %M, %H:%i");return t.date?"<span class='"+s+"date'>"+e(t.date)+"</span>":""},templateLinks:function(t){var e=t.text.replace(/(https?:\/\/[^\s]+)/g,(function(t){var e="<a target='_blank' href='"+(t=le.escape(t))+"'>";return t.match(/.(jpg|jpeg|png|gif)$/)?e+="<img class='webix_comments_image' src='"+t+"'/>":e+=t,e+"</a>"}));return e},templateMentioned:function(t){var e=t.text;return i._settings.mentions&&i._settings.highlight&&(e=i._highlightMention(t.text)),e},templateText:function(t){return"<div class = '"+s+"message'>"+t.text+"</div>"},templateAvatar:function(t,e){var n="<div class='"+s+"avatar'>",a=i.getUsers(),r=a&&a.exists(t.user_id)?a.getItem(t.user_id):{};if(r.status&&(n+=e.templateStatus(r)),n+="<div class='"+s+"avatar_image ",r.image)n+="'><img src = '"+r.image+"' class='"+s+"photo'>";else{var o=r.value?r.value[0].toUpperCase():"<span class='webix_icon wxi-user'></span>";n+=s+"avatar_text'>"+o}return n+"</div></div>"},template:function(t,e){var s;if("$more"==t.id)s="<div class='webix_comments_more'>"+i._settings.moreButton(t)+"</div>";else{t=I(t);var n=e.templateAvatar(t,e),a=e.templateUser(t,e),r=e.templateDate(t,e),o=e.templateMenu(t,e);t.text=e.templateMentioned(t),t.text=e.templateLinks(t),s=n+a+o+r+e.templateText(t,e)}return s},classname:function(t,e,s){var n=br.api.type.classname(t,e,s);return(t.user_id&&t.user_id==i._settings.currentUser||!i._users.count())&&(n+=" webix_comments_current"),n}};n=t.extend(n,e.listItem||{},!0);var a={$init:function(t){t.date&&(t.date=R.parseFormatDate(t.date))}};e.scheme&&Object.keys(e.scheme).forEach((function(t){a[t]=e.scheme[t]}));var r={view:"list",navigation:!1,type:n,scheme:a,onClick:{webix_comments_menu:function(t,e){i._listMenu.isVisible()?i._listMenu.hide():(i._listMenu.setContext({obj:i,id:e}),i._listMenu.show(t.target,n.menuPosition||{pos:"left",y:30,x:10}))},webix_comments_more:function(){if(i.config.url&&i.callEvent("onDataRequest",[])){i._moreCall=!0;var t=i._list.getItem("$more").value,e="chat"==i._settings.mode?t:i._list.getIndexById("$more"),s=rt.$parse(i.config.url),n={error:function(){i._moreCall=!1}};"string"==typeof s&&(s=s+(s.indexOf("?")<0?"?":"&")+"pos="+e+"&more="+t),i.load(s,n,{pos:e,more:t})}}}};return e.save&&(r.save=e.save),r},_initUsers:function(t){var e=this;t&&t.getItem?this._users=t:(this._users=new Ka,this._destroy_with_me.push(this._users),t&&"string"==typeof t?this._users.load(t):this._users.parse(t||[])),this._users.data.attachEvent("onStoreUpdated",(function(){return e._list.refresh()}))},_initMentions:function(t){var e=this,i=this.config.readonly;i||this._initUserList(t),this.config.highlight&&(i||(this._markedText=new RegExp("@((&quot;(.*?)&quot;)|([^\\s]{1,}))","g")),this._markedHTML=new RegExp('@(("(.*?)")|([^\\s]{1,}))',"g")),d.all([this._list.waitData,this._users.waitData]).then((function(){e._list.refresh()})),this._list.data.attachEvent("onStoreUpdated",(function(t,i,s){!t||"add"!==s&&"update"!==s||e._findMentioned(i)}))},_initUserList:function(i){var s="object"!=e(i)?{}:i;"object"!==e(s.body)?s.body={data:this._users}:s.body.data=this._users,t.extend(s,{view:"mentionsuggest"},!0);var n=this._input.define("suggest",s);this._input.setValueHere=function(t,e,i){return-1!=t.indexOf(" ")&&(t='"'.concat(t,'"')),Ga.api.setValueHere.apply(this,[t,e,i])},this._userList=ke(n)},_findMentioned:function(t){var e=this;if(-1!=t.text.indexOf("@")){var i=this._userList&&this._userList._settings.textValue||"value",s={};t.text.replace(this._markedHTML,(function(n,a,r,o){var l=o||a,h=e._users.find((function(t){return t[i]==l}),!0);return h&&!s[l]&&(e.callEvent("onUserMentioned",[h.id,t.id]),s[l]=!0),n}))}}}),el=(t.protoUI(tl,Zt,Gn.view),{name:"timeline",defaults:{scroll:"auto"},$init:function(t){var e=this,i="x"===t.layout;if(i){var s=t.type;this.type.type=s&&s.type||"top",E(t.scroll)&&(t.scroll="x")}this._viewobj.className+=i?" webix_timeline_horizontal":" webix_timeline",this.$blockRender=!0,this.data.provideApi(this,!0),this.data.attachEvent("onStoreUpdated",(function(t,i,s){return e.render(t,i,s)}))},_id:"webix_tl_id",on_click:{},$setSize:function(t,e){this.$blockRender=!1,pi.api.$setSize.call(this,t,e)&&this.refresh()},render:function(t,e,i){if(this.isVisible(this._settings.id)&&!this.$blockRender){if("update"==i){var s=this.getItemNode(t);return yt(this._htmlmap[t]=this._toHTMLObject(e),s),wt(s),!0}return this.callEvent("onBeforeRender",[this.data])&&(this._htmlmap=null,this._dataobj.innerHTML=this.data.getRange().map(this._toHTML,this).join(""),this.callEvent("onAfterRender",[])),!0}},_toHTML:function(t){this.callEvent("onItemRender",[t]);var e=this.getIndexById(t.id);return this.type.templateStart.call(this,t,this.type,e)+this.type.template.call(this,t,this.type,e)+this.type.templateEnd.call(this)},type:{type:"left",classname:function(t,i,s){var n="webix_timeline_item";return"alternate"!==i.type?n+="  webix_timeline_"+i.type:"x"==this._settings.layout?n+=" webix_timeline_"+(s%2?"bottom":"top"):n+=" webix_timeline_"+(s%2?"right":"left"),i.css&&(n+=" "+i.css),t.$css&&("object"==e(t.$css)&&(t.$css=ft(t.$css)),n+=" "+t.$css),n},lineColor:function(t){return t.color},templateValue:le("#value#"),templateDetails:function(t){return t.details||""},templateDate:function(t){return $n.dateToStr("%d %M, %Y")(t.date)},template:function(t,e,i){var s,n,a,r,o,l,h,c,d=vi.dataPadding,u="string"==typeof e.lineColor?e.lineColor:e.lineColor(t,e),_="stroke-width:".concat(2,"px; stroke:").concat(u||vi.timelineColor,";"),p=e.type,f=i+1==this.count(),g=14,m="position:relative;",v="",b="",w=e.templateDate(t,e),y=e.templateDetails(t,e),x='<div class="webix_timeline_value">'.concat(e.templateValue(t,e),"</div>\n\t\t\t\t").concat(y?'<div class="webix_timeline_details">'.concat(y,"</div>"):"");if("x"==this._settings.layout){var k=this.$height-2*d,C=vi.listItemHeight,$=d,S=k-C-g,I=C+g+d,A="top";"bottom"==p?($=(C=k-C)+g+d,I=k-C+d+g,A="bottom"):"alternate"==p&&(S=(C=Math.round(.5*k))-g,$=C-g+d-20,I=C+g+d,i%2&&($=I,A="bottom"));var D=t.$width||e.width;"auto"==D&&(D=this._getTextSize([{text:x,css:"webix_timeline_event",height:S},{text:w,css:"webix_timeline_date"}]).width+d),v="top:".concat($,"px;"),b="".concat(A,":").concat(I,"px; height:auto; max-height:").concat(S,"px; width:inherit;"),s=D,n=C+14,m+="left:1px;",r=C,a=13,l=C,o="100%",c=C,h=7}else{var E=this._settings.scroll?Ot.scrollSize:0,j=this.$width-2*d-E,V=Math.floor(.35*j),N=d,T=Math.floor(.65*j)-g,F=V+g+d,P=V-g;"right"==p?(N=(V=j-F+g+d)+g+d,F=d):"alternate"==p&&(F=(V=Math.floor(.5*j))+g+d,P=T=V-g,i%2&&(N=F,F=d));var B=t.$height||e.height;"auto"==B&&(B=this._getTextSize([{text:x,css:"webix_timeline_event",width:T},{text:w,css:"webix_timeline_date",width:P}]).height+d),v="left:".concat(N,"px; width:").concat(P,"px;"),b="left:".concat(F,"px; width:").concat(T,"px; height:").concat(B-d,"px;"),s=V+14,n=B,m+="top:3px;",a=V,r=13,o=V,l="100%",h=V,c=7}return'<div style="'.concat(v,'" class="webix_timeline_date">').concat(w,'</div>\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="').concat(s,'px" height="').concat(n,'px" style="').concat(m,'">\n\t\t\t\t\t\t').concat(f?"":'<line x1="'.concat(a,'" y1="').concat(r,'" x2="').concat(o,'" y2="').concat(l,'" class="webix_timeline_node" style="').concat(_,'"/>'),'\n\t\t\t\t\t\t<circle cx="').concat(h,'" cy="').concat(c,'" r="').concat(6,'" class="webix_timeline_node webix_timeline_point" style="').concat(_,' fill:transparent;" />\n\t\t\t\t\t</svg>\n\t\t\t\t\t<div class="webix_timeline_event" style="').concat(b,'">\n\t\t\t\t\t\t').concat(x,"\n\t\t\t\t\t</div>")},widthSize:function(t,e){var i=t.$width||e.width;return i+(i>-1?"px":"")},heightSize:function(t,e){var i=t.$height||e.height;return i+(i>-1?"px":"")},templateStart:function(t,e,i){return"x"==this._settings.layout?"<div ".concat("webix_tl_id",'="',t.id,'" class="').concat(e.classname.call(this,t,e,i),'" style="width:').concat(e.widthSize(t,e),';">'):"<div ".concat("webix_tl_id",'="',t.id,'" class="').concat(e.classname.call(this,t,e,i),'" style="height:').concat(e.heightSize(t,e),';">')},templateEnd:le("</div>")},_getTextSize:function(t){var e=vt("DIV");e.style.cssText="visibility:hidden;position:absolute;top:0px;left:0px;overflow:hidden;",document.body.appendChild(e);for(var i=0,s=0,n=0;n<t.length;n++){e.className="webix_measure_size "+t[n].css,e.style.width=t[n].width?t[n].width+"px":"auto",e.style.height=t[n].height?t[n].height+"px":"auto",e.innerHTML=t[n].text;var a=e.getBoundingClientRect();i=Math.max(i,Math.ceil(a.width)),s=Math.max(s,Math.ceil(a.height))}return wt(e),{width:i,height:s}},templateValue_setter:function(t){this.type.templateValue=le(t)},templateDetails_setter:function(t){this.type.templateDetails=le(t)},templateDate_setter:function(t){this.type.templateDate=le(t)},$skin:function(){this.type.height=vi.timelineItemHeight,this.type.width=3*vi.timelineItemHeight}}),il=(t.protoUI(el,bs,vs,Gi,_s,H,xi,pi.view),{name:"menu",_listClassName:"webix_menu",$init:function(t){t.autowidth&&(this._autowidth_submenu=!0,delete t.autowidth),this._init_mouse_events(),this.data.attachEvent("onStoreUpdated",A((function(){this._hide_sub_menu()}),this)),this.attachEvent("onItemClick",(function(t,e,i){var s=this.getItem(t);if(s){if(s.$template)return;var n=this.getTopMenu();if(!n.callEvent("onMenuItemClick",[t,e,i]))return void(e.showpopup=n._settings.id);this!=n&&n._call_onclick(t,e,i),this.type._submenu(s)||n._show_child_on_click?((e.pointerType&&"mouse"!==e.pointerType||this===n&&"click"==n._settings.openAction)&&this._mouse_move_activation(t,i),e.showpopup=n._settings.id):(n._hide_sub_menu(!0),n._hide_on_item_click&&n.hide())}})),this.attachEvent("onKeyPress",(function(t){if(9===t)this.getTopMenu()._hide_sub_menu();else if(13===t||32===t){var e,i=this.getSelectedId();i&&(e=this.getItemNode(i)),e&&At(e,"MouseEvent","click")}})),this.data.attachEvent("onClearAll",(function(){this._hidden_items=[]})),this.data._hidden_items=[],this._viewobj.setAttribute("role","menubar"),this._destroy_with_me=[]},_init_mouse_events:function(){this.attachEvent("onMouseMove",(function(t,e,i){this._menu_was_activated()&&this._mouse_move_activation(t,i)})),this.attachEvent("onMouseOut",(function(t){this._menu_was_activated()&&"click"==this._settings.openAction||this._child_menu_active||t.relatedTarget&&this.$view.contains(t.relatedTarget)||this._hide_sub_menu()}))},sizeToContent:function(){if("y"==this._settings.layout){var t=[],e=!1;this.data.each((function(i){t.push(this._toHTML(i)),i.submenu&&(e=!0)}),this),this.config.width=jt(t,this.$view.className).width+16+2+(e?15:0),this.resize()}else f(!1,"sizeToContent will work for vertical menu only")},getTopMenu:function(){for(var t=this;t._parent_menu;)t=ke(t._parent_menu);return t},_auto_height_calc:function(t){this._settings.autoheight&&(t=this.count());for(var e=this.count(),i=0,s=0;s<t;s++){var n=this.data.pull[this.data.order[s]];n&&"Separator"==n.$template?(i+=4,this._settings.autoheight||t++):i+=this.type.height}return this._onoff_scroll(t&&t<e,"y"),i},on_mouse_move:{},type:{_submenu:function(t){return t.submenu||t.data||t.item},css:"menu",width:"auto",aria:function(t,e,i){return'role="menuitem"'+(i&&i.webix_selected?' aria-selected="true" tabindex="0"':'tabindex="-1"')+(e._submenu(t)?'aria-haspopup="true"':"")+(t.disabled?' aria-disabled="true"  webix_disabled="true"':"")},templateStart:function(t,e,i){if("Separator"===t.$template||"Spacer"===t.$template)return'<div webix_l_id="#id#" role="separator" tabindex="-1" class="webix_context_'+t.$template.toLowerCase()+'">';var s=(t.href?" href='"+t.href+"' ":"")+(t.target?" target='"+t.target+"' ":"");return br.api.type.templateStart(t,e,i).replace(/^<div/,"<a "+s)+(e._submenu(t)&&e.subsign?"<div class='webix_submenu_icon'></div>":"")},templateEnd:function(t){return"Separator"===t.$template||"Spacer"===t.$template?"</div>":"</a>"},templateSeparator:le("<div class='sep_line'></div>"),templateSpacer:le("<div></div>")},getMenu:function(t){if(this.data.pull[t])return this;for(var e in this.data.pull){var i=this.getItem(e);if(i.submenu){var s=this._get_submenu(i).getMenu(t);if(s)return s}}},getSubMenu:function(t){var e=this.getMenu(t),i=e.getItem(t);return i.submenu?e._get_submenu(i):null},getMenuItem:function(t){return this.getMenu(t).getItem(t)},_get_submenu:function(t){var e=ke(t.submenu);return e||(t.submenu=this._create_sub_menu(t),e=ke(t.submenu)),e},_menu_was_activated:function(){var t=this.getTopMenu();if("click"==t._settings.openAction){var e=t._open_sub_menu;return!(!e||!ke(e).isVisible())}return!0},_mouse_move_activation:function(t,e){var i=this.getItem(t);if(i&&(this._child_menu_active=null,this._open_sub_menu&&i.submenu!=this._open_sub_menu&&this._hide_sub_menu(!0),this.type._submenu(i)&&!this.config.hidden)){var s=this._get_submenu(i);if(!this.isItemEnabled(t))return;s.show(e,{pos:this._settings.subMenuPos}),s._parent_menu=this._settings.id,this._open_sub_menu=i.submenu}},disableItem:function(t){var e=this.getMenu(t);e&&e._set_item_disabled(t,!0)},enableItem:function(t){var e=this.getMenu(t);e&&e._set_item_disabled(t,!1)},isItemEnabled:function(t){var e=this.getMenu(t);if(e)return br.api.isItemEnabled.apply(e,arguments)},_set_item_hidden:function(t,e){var i=this.data;i._hidden_items[t]!=e&&(i._hidden_items[t]=e,i.filter((function(t){return!i._hidden_items[t.id]})),this.resize())},hideMenuItem:function(t){var e=this.getMenu(t);e&&e._set_item_hidden(t,!0)},showMenuItem:function(t){var e=this.getMenu(t);e&&e._set_item_hidden(t,!1)},showItem:function(t){var e=this.getMenu(t);if(e)return br.api.showItem.call(e,t)},_hide_sub_menu:function(t){if(this._open_sub_menu){var e=ke(this._open_sub_menu);e._hide_sub_menu&&e._hide_sub_menu(t),!t&&e._show_on_mouse_out||(e.hide(),this._open_sub_menu=null)}},_create_sub_menu:function(e){var i={view:"submenu",data:this.type._submenu(e)},s=this.getTopMenu()._settings.submenuConfig;s&&t.extend(i,s,!0);var n=this.getMenuItem(e.id);n&&n.config&&t.extend(i,n.config,!0);var a=be(i);return this._destroy_with_me.push(a),a._parent_menu=this,a._settings.id},_skip_item:function(t,e,i){var s=this.getItem(t);return"Separator"!=s.$template&&"Spacer"!=s.$template&&this.isItemEnabled(t)?t:(t=this.getNextId(t,i)||null)&&t!=e?this._skip_item(t,e,i):e},$skin:function(){br.api.$skin.call(this),this.type.height=vi.menuHeight},defaults:{scroll:"",layout:"x",mouseEventDelay:100,subMenuPos:"bottom"}}),sl={api:il,view:t.protoUI(il,br.view)},nl={name:"submenu",$init:function(){this._body_cell=S(this._dummy_cell_interface),this._body_cell._view=this,this.attachEvent("onBeforeShow",(function(){this.getTopMenu()._autowidth_submenu&&this.sizeToContent&&!this.isVisible()&&this.sizeToContent()})),this._dataobj.setAttribute("role","menu")},$skin:function(){sl.api.$skin.call(this),Ca.api.$skin.call(this),this.type.height=vi.menuHeight},_init_mouse_events:function(){this.attachEvent("onMouseMove",(function(t,e,i){this._menu_was_activated()&&this._mouse_move_activation(t,i)})),this.attachEvent("onMouseOut",(function(t){"click"!=this.getTopMenu()._settings.openAction&&(this._child_menu_active||this._show_on_mouse_out||!t.relatedTarget||this.$view.contains(t.relatedTarget)||this.hide())})),this.attachEvent("onMouseMoving",(function(){this._parent_menu&&(ke(this._parent_menu)._child_menu_active=!0)}))},_dummy_cell_interface:{$getSize:function(t,e){var i=1*this._view._settings.height,s=1*this._view._settings.width,n=this._view._settings._inner;this._view._settings._inner={top:!0,left:!0,right:!0,bottom:!0};var a=sl.api.$getSize.call(this._view,t,e);return this._view._settings.height=i,this._view._settings.width=s,this._view._settings._inner=n,a},$setSize:function(t,e){this._view._settings.scroll&&(this._view._bodyobj.style.height=e+"px")},destructor:function(){this._view=null}},body_setter:function(){},getChildViews:function(){return[]},defaults:{width:150,subMenuPos:"right",layout:"y",autoheight:!0},type:{height:vi.menuHeight,subsign:!0}},al={api:nl,view:t.protoUI(nl,sl.view,Ca.view)},rl={name:"sidemenu",defaults:{animate:!0,position:"left",width:200,borderless:!0},$init:function(){this.$view.className+=" webix_sidemenu"},$skin:function(){Ca.api.$skin.call(this),this.defaults.padding=0},position_setter:function(t){var e=this._settings.position;return e&&Et(this.$view," webix_sidemenu_"+e),Dt(this.$view," webix_sidemenu_"+t),t},$getSize:function(){var t=Ti.api.$getSize.apply(this,arguments);return this._desired_sizes=t,t},$setSize:function(t,e){mi.api.$setSize.call(this,t,e),t=this._content_width-2*this._settings.padding,e=this._content_height-2*this._settings.padding,this._contentobj.style.padding=this._settings.padding+"px",this._headobj.style.display="none",this._bodyobj.style.height=e+"px",this._body_cell.$setSize(t,e)},show:function(){if(!this.callEvent("onBeforeShow",arguments))return!1;this._settings.hidden=!1,this._viewobj.style.zIndex=Ve(this._settings.zIndex),(this._settings.modal||this._modal)&&(this._modal_set(!0),this._modal=null),this._viewobj.style.display="block",this._render_hidden_views(),this._settings.position&&this._setPosition(),this._hide_timer=1,j((function(){this._hide_timer=0}),this,[],Ot.fastClick?100:400),this.config.autofocus&&(this._prev_focus=ni.getFocus(),ni.setFocus(this)),-1==me._popups.find(this)&&me._popups.push(this),this.callEvent("onShow",[])},_setPosition:function(t){var e,i,s,n,a,r=0,o=0,l={};this.$view.style.position="fixed",s=document.documentElement.offsetWidth,n=document.documentElement.offsetHeight,e=this._desired_sizes[0]||s,i=this._desired_sizes[2]||n,f(e&&i,"Attempt to show not rendered window"),"top"==(a=this._settings.position)?e=s:"right"==a?(i=n,r=s-e):"bottom"==a?(e=s,o=n-i):i=n,l={left:r,top:o,width:e,height:i,maxWidth:s,maxHeight:n},"function"==typeof this._settings.state&&this._settings.state.call(this,l),this._state=l,this.$setSize(l.width,l.height),void 0===t&&this._settings.animate?(Et(this.$view,"webix_animate"),this._animate[this._settings.position].beforeShow.call(this,l),j((function(){Dt(this.$view,"webix_animate",!0)}),this,null,1),j((function(){this._animate[this._settings.position].show.call(this,l)}),this,null,10)):("right"===this._settings.position&&(l.left=l.right?s-l.width-l.right:s-l.width),this.setPosition(l.left,l.top))},_state:{},hidden_setter:function(t){return t?this.hide():this.show(),!!t},_animate:{left:{beforeShow:function(t){this.$view.style.left=-t.width+"px",this.$view.style.top=t.top+"px"},show:function(t){this.$view.style.left=t.left?t.left+"px":"0px"},hide:function(t){this.$view.style.left=-t.width+"px"}},right:{beforeShow:function(t){this.$view.style.left="auto",this.$view.style.right=-t.width+"px",this.$view.style.top=t.top+"px"},show:function(t){this.$view.style.right=t.right?t.right+"px":"0px"},hide:function(t){this.$view.style.right=-t.width+"px"}},top:{beforeShow:function(t){this.setPosition(t.left,t.top),this.$view.style.height="0px",this._bodyobj.style.height="0px"},show:function(t){this.$view.style.height=t.height+"px",this._bodyobj.style.height=t.height+"px"},hide:function(){this.$view.style.height="0px",this._bodyobj.style.height="0px"}},bottom:{beforeShow:function(t){this.$view.style.left=t.left+"px",this.$view.style.top="auto";var e=null!=t.bottom?t.bottom:t.maxHeight-t.top-t.height;this.$view.style.bottom=e+"px",this.$view.style.height="0px"},show:function(t){this.$view.style.height=t.height+"px"},hide:function(){this.$view.style.height="0px"}}},_hiding_process:function(){var t=document.documentElement.offsetWidth,e=document.documentElement.offsetHeight;if(this._settings.animate&&t==this._state.maxWidth&&e==this._state.maxHeight){this._animate[this._settings.position].hide.call(this,this._state);var i=pe(this.$view,Ot.transitionEnd,A((function(){this._hide_callback(),fe(i)}),this))}else this._hide_callback()}},ol=(t.protoUI(rl,Ca.view),{name:"sidebar",defaults:{type:"sideBar",activeTitle:!0,select:!0,scroll:!1,collapsed:!1,collapsedWidth:44,position:"left",width:250,mouseEventDelay:10},$skin:function(){this.defaults.titleHeight=vi.sidebarTitleHeight},$init:function(t){this._fullWidth=E(t.width)?this.defaults.width:t.width,this._settings.width=t.width=t.collapsed?t.collapsedWidth||this.defaults.collapsedWidth:this._fullWidth,this.$view.className+=" webix_sidebar",this.$ready.push(this._initSidebar),this.$ready.push(this._initContextMenu),this.data._scheme_init=function(t){t.data?t.menu=I(t.data):t.item&&(t.menu=I(t.item.length?t.item:[t.item]))},t.multiselect=!1},on_context:{},on_mouse_move:{},_initSidebar:function(){this.attachEvent("onBeforeOpen",(function(t){if(!this.config.multipleOpen)for(var e=this.getOpenItems(),i=0;i<e.length;i++)this.getParentId(t)==this.getParentId(e[i])&&this.close(e[i]);return!this.config.collapsed})),this.attachEvent("onItemClick",(function(t,e,i){var s=this.getPopup();s&&!s.config.hidden&&(e.showpopup=s.config.id),e.pointerType&&"mouse"!==e.pointerType&&this._showPopup(t,i)})),this.attachEvent("onBeforeSelect",(function(t){return!this.getItem(t).$count&&(this.clearCss("webix_sidebar_selected"),!0)})),this.attachEvent("onAfterSelect",(function(t){this._markMenu(this,t,!vi.sidebarMarkAll),this.getPopup()._onMasterSelect(t)})),this.attachEvent("onAfterUnSelect",(function(){this.clearCss("webix_sidebar_selected")})),this.attachEvent("onMouseMove",(function(t,e,i){this._showPopup(t,i)})),this.attachEvent("onMouseOut",(function(){this.config.collapsed&&(this.getPopup().masterId=null)}))},_showPopup:function(t,e){if(this.config.collapsed){var i=this.getPopup();i&&(this._updateTitle(t,i),this._updateList(t,i),i.masterId=t,i.show(e,{x:"left"==this.config.position?this.config.collapsedWidth:-i.config.width,y:-1}))}},_updateTitle:function(t,e){var i=e.getBody().getChildViews()[0];i&&e.masterId!=t&&(i.parse(this.getItem(t)),this.getSelectedId()==t?Dt(i.$view,"webix_selected",!0):Et(i.$view,"webix_selected"))},_updateList:function(t,e){var i=e.getBody().getChildViews()[1];if(i&&e.masterId!=t){this.exists(e.masterId)&&this.getItem(e.masterId).menu&&this.updateItem(e.masterId,{menu:i.data.serialize()}),i.clearCss("webix_sidebar_selected"),i.unselectAll();var s=I(this.getItem(t).menu||[]);if(s.length){i.show(),i.data.importData(s);var n=this.getSelectedId();i.exists(n)?i.select(n):n&&this._markMenu(i,n)}else i.hide(),i.data.clearAll()}},_initContextMenu:function(){var e,i=this,s=i.config;if(s.popup&&(e=ke(s.popup)),!e){var n="left"==s.position?"webix_sidebar_popup_left":"webix_sidebar_popup_right",a="left"==s.position?"right":"left",r=function(t){var e="wxi-angle-"+("left"==s.position?"right":"left");return(t.submenu||t.data||t.item?'<div class="webix_icon '+e+'"></div>':"")+t.value},o=s.css?" "+s.css:"",l={view:"popup",css:"webix_sidebar_popup "+n+o,autofit:!1,width:this._fullWidth-this.config.collapsedWidth,borderless:!0,padding:0,body:{rows:[{view:"template",borderless:!0,css:"webix_sidebar_popup_title",template:"#value#",height:this.config.titleHeight+2,onClick:{webix_template:function(){var t=this.getValues().id;i.getItem(t).$count||i.select(t)}}},{view:"menu",submenu:"data",layout:"y",subMenuPos:a,select:!0,borderless:!0,autoheight:!0,css:"webix_sidebar_popup_list "+n+o,template:r,type:{subsign:!1},submenuConfig:{padding:0,subMenuPos:a,template:r,select:!0,type:{subsign:!1},css:"webix_sidebar_popup_list "+n+o,on:{onShow:function(){this.clearCss("webix_sidebar_selected"),this.unselectAll();var t=i.getSelectedId();t&&this.exists(t)?this.select(t):t&&i._markMenu(this,t)},onBeforeSelect:function(t){if(this.getSubMenu(t))return!1},onAfterSelect:function(t){for(var e=i.getPopup().queryView({view:"menu"}),s=i.getParentId(t);s;){var n=e.getMenu(s);n&&(n.unselectAll(),i._markMenu(n,t)),s=i.getParentId(s)}i._markMenu(this,t)}}},on:{onBeforeSelect:function(t){if(this.getSubMenu(t))return!1},onMenuItemClick:function(t){this.getSubMenu(t)||i.select(t)}}}]}};t.extend(l,s.popup||{},!0),(e=be(l))._onMasterSelect=function(t){if(i.config.collapsed&&1==i.getItem(t).$level){var s=e.getBody().getChildViews()[0];s&&Dt(s.$view,"webix_selected",!0)}},e.queryView({view:"menu"})._show_child_on_click=!0}e.attachEvent("onBeforeShow",(function(){return s.collapsed})),this._destroy_with_me=[e],s.popupId=e.config.id,_e(document.body,"pointermove",(function(t){var i=t.target;e.config.hidden||e.$view.contains(i)||this.$view.firstChild.contains(i)||e.queryView({view:"menu"})._open_sub_menu||this.$view._custom_scroll_size&&this.$view._custom_scroll_size._scroll_y_node||e.hide()}),{bind:this})},_markMenu:function(t,e,i){var s="webix_sidebar_selected";t.data.each((function(n){!this._isChild(e,n.id)||i&&"0"!=this.getParentId(n.id)?t.hasCss(n.id,s)&&t.removeCss(n.id,s):t.addCss(n.id,s)}),this)},_isChild:function(t,e){var i=this.getParentId(t);return e==i||!!i&&this._isChild(i,e)},getPopup:function(){return ke(this.config.popupId)},position_setter:function(t){var e=t,i="left"==t?"right":"left";Et(this.$view,"webix_sidebar_"+i),Dt(this.$view,"webix_sidebar_"+e,!0);var s=this.getPopup();if(s){var n=s.$view;Et(n,"webix_sidebar_popup_"+i),Dt(n,"webix_sidebar_popup_"+e,!0)}return t},select:function(t){t&&(B(t)&&(t=t.pop()),Xo.api.select.call(this,t))},selectAll:function(){},collapse:function(){this.define("collapsed",!0)},expand:function(){this.define("collapsed",!1)},toggle:function(){var t=!this.config.collapsed;this.define("collapsed",t)},collapsed_setter:function(t){var e;return t?(e=this.config.collapsedWidth,this.closeAll(),this.type.collapsed=!0,Et(this.$view,"webix_sidebar_expanded")):(e=this._fullWidth,this.type.collapsed=!1,Dt(this.$view,"webix_sidebar_expanded",!0)),E(e)||e===this.config.width||(this.define("width",e),this.resize()),t},getState:function(){var e={collapsed:this.config.collapsed};return t.extend(e,Ls.getState.call(this)),e},setState:function(t){Ls.setState.call(this,t),this.define("collapsed",t.collapsed)}});ge(Xo.view,{name:"sideBar",height:"auto",template:function(t,e){return e.collapsed?e.icon(t,e):e.arrow(t,e)+e.icon(t,e)+"<span>"+t.value+"</span>"},arrow:function(t){for(var e="",i=1;i<=t.$level;i++)i==t.$level&&t.$count&&(e+="<span class='webix_sidebar_dir_icon webix_icon wxi-angle-"+(t.open?"down":"left")+"'></span>");return e},icon:function(t){var e="";return t.$level>2&&(e='style="padding-left:'+40*(t.$level-2)+'px"'),t.icon?"<span class='webix_icon webix_sidebar_icon "+t.icon+"' "+e+"></span>":"<span "+e+"></span>"}}),t.protoUI(ol,Xo.view);var ll=(t.protoUI({name:"context"},Fi,Ca.view),{name:"contextmenu",_hide_on_item_click:!0,$init:function(e){e.submenuConfig&&t.extend(e,e.submenuConfig)}}),hl=(t.protoUI(ll,Fi,al.view),{name:"treetable",$init:function(){for(var e in t.extend(this.data,Ws,!0),t.extend(this.type,Gs),t.extend(this,Hs,!0),Rs)this.on_click[e]||(this.on_click[e]=this._unwrap_id(Rs[e]));this.type.treetable=le("{common.space()}{common.icon()} {common.folder()}"),this.type.treecheckbox=function(t){return t.indeterminate&&!t.nocheckbox?"<div class='webix_tree_checkbox webix_indeterminate'></div>":Gs.checkbox.apply(this,arguments)},this.data.provideApi(this,!0),this._viewobj.setAttribute("role","treegrid")},_drag_order_complex:!1,_unwrap_id:function(t){return function(e,i){return i=i.row,t.call(this,e,i)}},_close_branches:function(t){for(var e=this._settings.prerender?t.source:[t.start],i=0;i<e.length;i++)this.close(e[i])},getState:function(){var e=Ki.getState.call(this);return t.extend(e,Ls.getState.call(this)),e},setState:function(t){Ls.setState.call(this,t)&&Ki.setState.call(this,t)},clipboard_setter:function(e){return t.extend(this._paste,Ys),Os.clipboard_setter.call(this,e)},_run_load_next:function(t,e){for(var i=t.start,s=0;s<i;s++){var n=this.data.order[s];n&&1!=this.getItem(n).$level&&t.start--}return co.api._run_load_next.call(this,t,e)}}),cl=(t.protoUI(hl,Ls,Us,zs,co.view),{name:"filter",$init:function(t){t.mode=t.mode||"number",this._settings.conditions=t.conditions,this._settings.mode=this.mode_setter(t.mode),delete t.mode,t.rows=this._configFilter(t),this.$ready.push(this._afterInit)},$onLoad:function(t,e){return this._fillList(t,e)},_fillList:function(t,e){var i=this,s=this._list||this.queryView("list");s.data.driver=e;var n=[],a={};if("function"==typeof t.serialize?(t.data&&"DataStore"==t.data.name&&(t=t.data),t.each((function(t){return i._checkItem(t,n,a)}))):e.getRecords(t).forEach((function(t){return i._checkItem(t,n,a)})),s.clearAll(),s.parse(n),this._list){var r=this._settings.value.includes;this._filterList(),this._checkListData(r)}return!0},_checkItem:function(t,e,i){var s=t[this._settings.field];E(s)||i[s]||(i[s]=!0,e.push(I(t)))},_afterInit:function(){var t=this;this._after_init_config=!0,this._list=this.queryView("list"),this._toggle=this.queryView("toggle"),this._select=this.queryView("richselect"),this._input=this.queryView({batch:this._visibleBatch}),this._list.data.provideApi(this,!0),this._list.data.attachEvent("onSyncApply",(function(){return t._fillList(t._list,t._list.data.driver)})),this.setValue(this._settings.value,"auto"),delete this._after_init_config},mode_setter:function(t){if(f(this._content[t],"Unknown filter mode"),this._conditions=this._getConditions(this._settings.conditions,t),this._input){var e=this._select.getList();e.clearAll(),e.parse(this._conditions),this._select.config.value="",this._select.setValue(this._conditions[0].id,"auto")}else this._visibleBatch=this._conditions[0].batch;return t},_configFilter:function(t){var e=this,i=this._getInputs(t.inputs);return[{visibleBatch:this._visibleBatch,cols:[{view:"richselect",value:this._conditions[0].id,width:160,options:this._conditions,on:{onChange:function(t,i,s){e._changeInput(t),e.applyFilter(s)}}}].concat(s(i))},{view:"toggle",batch:"includes",onLabel:R.combo.unselectAll,offLabel:R.combo.selectAll,value:!0,on:{onItemClick:function(){e._selectAll(e._toggle.getValue()),e.callEvent("onChange",["user"])}}},{view:"list",batch:"includes",css:"webix_multilist",autoheight:!0,borderless:!0,yCount:5,type:"checklist",template:t.template||"#".concat(t.field,"#"),on:{onItemClick:function(t){var i=e._list.getItem(t);e._list.updateItem(t,{$checked:!i.$checked}),e._settings.value.includes=e._getIncludes(),e._setSubviewValue(e._toggle,e._is_all_selected()),e.callEvent("onChange",["user"])}}}]},_getInputs:function(t){var e=this;t=t||Object.keys(this._inputs);for(var i=0;i<t.length;i++)if(this._inputs[t[i]]){if(t[i]=I(this._inputs[t[i]]),t[i].on){var s=t[i].on;for(var n in s)s[n]=function(){return e.applyFilter("user")}}}else f(t[i]&&t[i].batch,"Filter: incorrect input configuration");return t},_inputs:{text:{view:"text",batch:"text",on:{onTimedKeyPress:!0}},datepicker:{view:"datepicker",batch:"datepicker",on:{onChange:!0}},daterangepicker:{view:"daterangepicker",batch:"daterangepicker",on:{onChange:!0}},none:{view:"spacer",batch:"none"}},_options:{number:Fn.number,text:Fn.text,date:{greater:{batch:"datepicker",handler:Fn.date.greater},less:{batch:"datepicker",handler:Fn.date.less},greaterOrEqual:{batch:"datepicker",handler:Fn.date.greaterOrEqual},lessOrEqual:{batch:"datepicker",handler:Fn.date.lessOrEqual},equal:{batch:"datepicker",handler:Fn.date.equal},notEqual:{batch:"datepicker",handler:Fn.date.notEqual},between:{batch:"daterangepicker",handler:Fn.date.between},notBetween:{batch:"daterangepicker",handler:Fn.date.notBetween}}},_content:{number:["greater","less","greaterOrEqual","lessOrEqual","equal","notEqual","contains","notContains"],text:["contains","notContains","equal","notEqual","beginsWith","notBeginsWith","endsWith","notEndsWith"],date:["greater","less","greaterOrEqual","lessOrEqual","equal","notEqual","between","notBetween"]},_getConditions:function(t,e){t=t||this._content[e];for(var i=[],s=0;s<t.length;s++){var n=this._getSingleOption(t[s],e);f(n,"Filter: unknown option id"),i.push(n)}return i},_getSingleOption:function(e,i){if(e&&"function"==typeof e.handler)return e;if(this._options[i][e]){var s={id:e,value:R.filter[e]},n="function"==typeof this._options[i][e]?{batch:"text",handler:this._options[i][e]}:this._options[i][e];return t.extend(s,n,!0)}return null},_getFilterConfig:function(t){for(var e=0;e<this._conditions.length;e++)if(this._conditions[e].id==t)return this._conditions[e]},_getIncludes:function(){var t=this,e=[];return this._list.data.each((function(i){i.$checked&&e.push(i[t._settings.field])})),e.length==this._list.count()?null:e},getValue:function(){return{condition:{filter:this._input.getValue?this._input.getValue()||"":null,type:this._select.getValue()},includes:this._getIncludes()}},_is_all_selected:function(){for(var t=this._list.data.order,e=0;e<t.length;e++)if(!this.getItem(t[e]).$checked)return!1;return!0},$compareValue:function(t,e){if(!t||t.condition.type!==e.condition.type)return!1;var i=this._input.$compareValue;if(i?!i.call(this,t.condition.filter,e.condition.filter):t.condition.filter!==e.condition.filter)return!1;if(t.includes&&e.includes){if(t.includes.length!==e.includes.length)return!1;for(var s={},n=0;n<t.includes.length;n++)s[t.includes[n]]=!0;for(var a=0;a<e.includes.length;a++)if(!s[e.includes[a]])return!1;return!0}return t.includes===e.includes},setValue:function(t,e){if(t=this.$prepareValue(t),!this.$compareValue(this._settings.value,t)){var i=t.condition,s=t.includes;this._changeInput(i.type),this._setSubviewValue(this._input,i.filter),this._setSubviewValue(this._select,i.type),this._filterList(),this._checkListData(s),this._setSubviewValue(this._toggle,this._is_all_selected()),this._settings.value=t,this._after_init_config||this.callEvent("onChange",[e])}},_checkListData:function(t){var e=this._settings.field,i="date"==this._settings.mode;t&&i&&(t=t.map((function(t){return t&&t.valueOf()}))),this._list.data.each((function(s){var n=s[e];s.$checked=!t||-1!=t.indexOf(i?n&&n.valueOf():n)})),this._list.refresh()},_setSubviewValue:function(t,e){t.setValue&&(t.blockEvent(),t.setValue(e),t.unblockEvent())},$prepareValue:function(t){return(t=t||{}).condition=t.condition||{filter:this._input.$prepareValue?this._input.$prepareValue(""):"",type:this._conditions[0].id},t.includes=t.includes||null,t},_filterList:function(){var t=this._input.getValue?this._input.getValue()||"":null;if(""===t)this._list.filter();else{var e=this._settings.field,i=this._getFilterConfig(this._select.getValue()).handler;this._list.filter((function(s){return i(s[e],t)}))}this.showBatch("includes",!!this._list.count())},_changeInput:function(t){var e=this._getFilterConfig(t).batch;e!=this._visibleBatch&&(this._visibleBatch=e,this._input=this.queryView({batch:e}),this._input.setValue&&this._input.setValue("","auto"),this._input.getParentView().showBatch(e))},applyFilter:function(t){this._filterList(),this._setSubviewValue(this._toggle,!0),this._selectAll(!0),this.callEvent("onChange",[t])},_selectAll:function(t){this._list.data.each((function(e){e.$checked=t})),this._list.refresh(),this._settings.value=this.getValue()},getFilterFunction:function(){var t=this._settings.field,e="date"==this._settings.mode,i=this.getValue(),s=i.includes,n=i.condition,a=this._getFilterConfig(n.type).handler;return s&&e&&(s=s.map((function(t){return t&&t.valueOf()}))),function(i){var r=i[t];return s?-1!=s.indexOf(e?r&&r.valueOf():r):""===n.filter||a(r,n.filter)}}}),dl=(t.protoUI(cl,Zt,Gn.view),function(t){var i={},s=[];for(var n in(t=ke(t)).config)fl[n]||"object"!=e(t.config[n])&&void 0!==t.config[n]&&"function"!=typeof t.config[n]&&("view"==n||"id"==n?s.push({label:n,id:n}):s.push({label:n,type:"text",id:n}),t.defaults[n]==t.config[n]&&(s[s.length-1].css={color:"#888"}),i[n]=t.config[n]);return s.sort((function(t,e){return!t.css&&e.css?-1:t.css&&!e.css||t.id>e.id?1:t.id==e.id?0:-1})),{elements:s,data:i,head:" ["+t.name+"] <strong>"+t._settings.id+"</strong>"}}),ul=function(t,e){ke("webix_debug_inspector_win")||be({id:"webix_debug_inspector_win",view:"window",top:2,left:0,width:350,height:350,head:!1,autofit:!1,body:{cols:[{width:10},{type:"clean",rows:[{view:"toolbar",elements:[{view:"label",value:"",id:"webix_debug_inspector_head"},{view:"button",width:100,value:"Hide",type:"custom",click:function(){ul()}}]},{id:"webix_debug_inspector",nameWidth:150,view:"property",scroll:"y",elements:[],on:{onaftereditstop:function(t,e){if(t.old!=t.value){var i=t.value;if("true"===i||"false"===i)i="true"===i;else{var s=parseInt(i,10);s==i&&(i=s)}var n=ke(this.config.view);n.define(e.id,i),n.refreshColumns?n.refreshColumns():n.refresh&&n.refresh(),n.resize()}}}}]}]}});var i=ke("webix_debug_inspector_win");if(t){var s=dl(t),n=document.body.offsetWidth,a=document.body.offsetHeight,r=e?$t(e):{x:0,y:0};i.define("height",Math.max(350,a-4)),i.resize();var o=ke("webix_debug_inspector");o.define("elements",s.elements),o.define("view",t),i.show({x:r.x>n/2?0:n-370,y:0}),ke("webix_debug_inspector").setValues(s.data),ke("webix_debug_inspector_head").setValue(s.head)}else i.hide()},_l=function(t){return t>=1e5?"Any":t},pl=function(t,e,i){if(window.console.log((t==i?">>":"  ")+e+t.name+" / "+t.config.id),e+="  ",t._cells)for(var s=0;s<t._cells.length;s++)pl(t._cells[s],e,i);t._head_cell&&pl(t._head_cell,e,i),t._body_cell&&pl(t._body_cell,e,i)};W("onLoadError",(function(t,e){var i;try{i=t.responseText}catch(t){i=""}var s="Data loading error, check console for details";if(0===(i=i||"[EMPTY DATA]").indexOf("<?php")?s="PHP support missed":0===i.indexOf("WEBIX_ERROR:")&&(s=i.replace("WEBIX_ERROR:","")),ei({type:"debug",text:s,expire:-1}),window.console){var n=window.console;n.log("Data loading error"),n.log("Object:",e),n.log("Response:",i),t&&n.log("XHTTP:",t)}})),Ne((function(){0===document.location.href.indexOf("file:")&&ei({type:"error",text:"Please open sample by http,<br>not as file://",expire:-1})}));var fl={_inner:!0,awidth:!0,cheight:!0,bheight:!0,aheight:!0},gl={view:"contextmenu",id:"webix:debugmenu",on:{onBeforeShow:function(t){if(!t.ctrlKey)return!1;var e=xt(t,"view_id");if(!e)return!1;this.config.lastTarget=e,G(),j((function(){K()}))},onShow:function(){var t=ke(this.config.lastTarget),e="<span style='color:#888'>"+t._settings.id+"<sup style='float:right'>["+t.name+"]</sup></span>";document.getElementById("webix_debug_cmx").innerHTML=e}},data:["<div id='webix_debug_cmx'></div>",{id:"inspect",value:"Inspect"},{id:"docs",value:"Documentation"},{value:"Log to Console",submenu:[{id:"size",value:"Sizes"},{id:"tree",value:"Tree"},{id:"dump",value:"Dump"}]}],click:function(t,e){var i=ke(this.config.lastTarget);if("dump"==t&&(window.console.info("\n"+i.name+" / "+i.config.id),window.console.log("\nView: ",i,", Config: ",i.config,", Data: ",i.data),window.console.log(i.$view)),"tree"==t){for(var s=i;i.getParentView();)i=i.getParentView();window.console.log(""),pl(i,"",s)}if("size"==t){window.console.info(""),window.console.info("\n"+i.name+" / "+i.config.id),window.console.info("\n[min]   ",i.config.width," x ",i.config.height);var n=i.$getSize(0,0);window.console.info("[max]    ",_l(n[1])," x ",_l(n[3])+(i.config.autoheight?", auto height":"")),window.console.info("[gravity]   ",i.config.gravity),window.console.info("\n[content]    ",i._content_width," x ",i._content_height),window.console.info("[last set]   ",i._last_size[0]," x ",i._last_size[1]),i._settings._inner?window.console.info("\n[borders]   ","left:",!i._settings._inner.left,"\ttop:",!i._settings._inner.top,"\tright:",!i._settings._inner.right,"\tbottom:",!i._settings._inner.bottom):window.console.info("\n[borders]   none")}"docs"==t&&window.open("http://docs.webix.com/api__refs__ui."+i.name+".html","__blank"),"inspect"==t&&ul(this.config.lastTarget,e)}};Ne((function(){gl.master=document.body,be(gl)}));var ml=t.proto({name:"DataRecord",isVisible:function(){return!0},$init:function(t){this.data=t||{};var e=t&&t.id?t.id:T();this._settings={id:e},be.views[e]=this},getValues:function(){return this.data},setValues:function(e,i,s){this.data=i?t.extend(this.data,e,!0):e,this.callEvent("onChange",[e,s])},refresh:function(){this.callEvent("onBindRequest")}},H,di,Zt,ai),vl=t.proto({name:"DataValue",isVisible:function(){return!0},$init:function(t){t&&!E(t.value)||(this.data=t||"");var e=t&&t.id?t.id:T();this._settings={id:e},be.views[e]=this},setValue:function(t,e){this.data=t,this.callEvent("onChange",[t,e])},getValue:function(){return this.data},refresh:function(){this.callEvent("onBindRequest")}},H,di),bl=t.proto({name:"TreeCollection",$init:function(){t.extend(this.data,Ws,!0),this.data.provideApi(this,!0),t.extend(this,Hs,!0)}},zs,Ka);t.Date=$n,t.Number=Sn,t.promise=d,t.DataCollection=Ka,t.DataRecord=ml,t.DataValue=vl,t.TreeCollection=bl,t.AtomDataLoader=Zt,t.AtomRender=he,t.AutoScroll=ce,t.AutoTooltip=xi,t.BaseBind=di,t.BindSource=ci,t.Canvas=ki,t.CodeParser=Qt,t.CollectionBind=oi,t.ContextHelper=Fi,t.CopyPaste=Mi,t.CustomPrint=Oi,t.CustomScroll=Li,t.DataMarks=Ri,t.DataMove=zi,t.DataLoader=Gi,t.DataState=Ki,t.DataStore=Yi,t.Destruction=ri,t.DragControl=Ai,t.DragItem=Xi,t.DragOrder=Ji,t.EditAbility=ss,t.EventSystem=H,t.FlexLayout=ns,t.Group=os,t.GroupMethods=as,t.GroupStore=rs,t.HTMLOptions=ls,t.HtmlMap=hs,t.IdSpace=cs,t.KeysNavigation=ds,t.MapCollection=us,t.Modality=ji,t.MouseEvents=_s,t.Movable=Di,t.NavigationButtons=ps,t.OverlayBox=fs,t.PagingAbility=gs,t.ProgressBar=ms,t.RecordBind=hi,t.RenderStack=vs,t.ResizeArea=Vi,t.SingleRender=wi,t.Scrollable=bs,t.SelectionModel=ws,t.Settings=ai,t.Sparklines=Ms,t.TablePaste=Os,t.TooltipControl=$e,t.Touch=Ii,t.TreeAPI=Ls,t.TreeClick=Rs,t.TreeDataLoader=zs,t.TreeDataMove=Hs,t.TreeRenderStack=qs,t.TreeStateCheckbox=Us,t.TreeStore=Ws,t.TreeTablePaste=Ys,t.TreeType=Gs,t.UIManager=ni,t.Undo=Zi,t.UploadDriver=Ks,t.ValidateCollection=Xs,t.ValidateData=Hi,t.ValueBind=li,t.Values=Js,t.VirtualRenderStack=Zs,t.VRenderStack=Qs,t.html=Bt,t.skin=Si,t.debug=function(t){if(t)if("object"!==e(t))m={events:!0};else for(var i in t)m[i]=t[i];else m={}},t.i18n=R,t.ready=Ne,t.env=Ot,t.color=ys,t.csv=Bi,t.clipbuffer=Pi,t.storage=Dn,t.template=le,t.type=ge,t.editors=is,t.animate=Ci,t.print=function(t,e){var i=ke(t);if(i&&i.$printView&&(i=i.$printView()),f(i,"non-existing view for printing"),i){var s;if(i.callEvent&&i.callEvent("onBeforePrint",[e]),function(t){Dt(document.body,"webix_print"),t.docHeader&&Tn("Header",t),t.docFooter&&Tn("Footer",t);var e=t.size;gt("@media print { @page{ size:"+(e.preset?e.preset+" "+t.mode:"portrait"==t.mode?"".concat(e.width,"in ").concat(e.height,"in"):"".concat(e.height,"in ").concat(e.width,"in"))+";margin-top:"+t.margin.top+"px;margin-bottom:"+t.margin.bottom+"px;margin-right:"+t.margin.right+"px;margin-left:"+t.margin.left+"px;}}","print")}(e=function(t){(t=t||{}).paper=t.paper||"a4",t.size=Ot.printSizes.find((function(e){return e.id==t.paper})),t.size||(t.size=Ot.printSizes[0],t.paper=t.size.id),t.mode=jn[t.mode]?t.mode:"portrait",t.fit=En[t.fit]?t.fit:"page",t.scroll=t.scroll||!1,t.margin=t.margin||0===t.margin?t.margin:{};var e=isNaN(1*t.margin)?Ot.printMargin:t.margin;return t.margin={top:t.margin.top||0===t.margin.top?t.margin.top:e,bottom:t.margin.bottom||0===t.margin.bottom?t.margin.bottom:e,right:t.margin.right||0===t.margin.right?t.margin.right:e,left:t.margin.left||0===t.margin.left?t.margin.left:e},t}(e)),i.$customPrint){if(s=i.$customPrint(e)){if(s.then)return s.then((function(){return Vn(e)}));Nn(i,e)}}else Nn(i,e);Vn(e)}},t.rules=Oe,t.filters=Fn,t.patterns=Pn,t.fullscreen=si,t.version="10.1.0",t.name="core",t.level_in=C,t.level_out=$,t.clone=S,t.copy=I,t.single=function(t){var e=null;return function(){return e||(e=new t({})),e._reinit&&e._reinit.apply(e,arguments),e}},t.bind=A,t.exec=D,t.wrap=function(t,e){return t?function(){var i=t.apply(this,arguments);return e.apply(this,arguments),i}:e},t.isUndefined=E,t.delay=j,t.once=V,t.uid=T,t.toNode=F,t.toFunctor=P,t.isArray=B,t.isDate=M,t._to_array=O,t._power_array=L,t._events_final_destructor=ue,t._event=_e,t.event=pe,t.eventRemove=fe,t.callEvent=U,t.attachEvent=W,t.detachEvent=Y,t.blockEvent=G,t.unblockEvent=K,t.mapEvent=function(t){return q.mapEvent(t)},t.hasEvent=function(t){return q.hasEvent(t)},t.stringify=z,t.toPNG=function(t,e){var i=d.defer();return Gt(Ot.cdn+"/extras/html2canvas-1.0.min.js").then((function(){"string"==typeof e&&(e={filename:e}),(e=e||{}).export_mode="png";var s=ke(t);if(s&&s.$exportView&&(s=s.$exportView(e)),f(s,tn),!s)return i.reject(tn);var n=s?s.$view:F(t),a=rn(e.filename,"png");return window.html2canvas(n,{background:"#fff",logging:!1,useCORS:!0}).then((function(t){var s=function(t){!1!==e.download&&Vt(t,a),i.resolve(t)};t.msToBlob?s(t.msToBlob()):t.toBlob(s,"image/png")})),i}))},t.toCSV=function(e,i){i=i||{};var s=ke(e);if(s&&s.$exportView&&(s=s.$exportView(i)),f(s,tn),!s)return d.reject(tn);i.export_mode="csv",t.extend(i,{filterHTML:!0});var n=an(s,i),a=function(t){return Bi.stringify(t)}(on(s,i,n)),r=rn(i.filename,"csv"),o=new Blob(["\ufeff"+a],{type:"text/csv"});return!1!==i.download&&Vt(o,r),d.resolve(o)},t.toPDF=hn,t.toExcel=vn,t.alert=function(){var t=Je.apply(this,arguments);return t.type=t.type||"alert",Ye(t)},t.confirm=Qe,t.modalbox=ti,t.prompt=function(){var t=Je.apply(this,arguments);return t.type=t.type||"prompt",t.input=t.input||{},Xe(t)},t.message=ei,t.editStop=function(){U("onEditEnd",[])},t.ajax=Z,t.DataDriver=Xt,t.dp=Ui,t.DataProcessor=Wi,t.remote=Ln,t.require=Gt,t.proxy=rt,t.send=function(t,e,i,s){var n=vt("FORM",{target:s||"_self",action:t,method:i||"POST"},"");for(var a in e){var r=vt("INPUT",{type:"hidden",name:a,value:e[a]},"");n.appendChild(r)}n.style.display="none",document.body.appendChild(n),n.submit(),document.body.removeChild(n)},t.ui=be,t.$$=ke,Object.defineProperty(t,"__esModule",{value:!0})}(e)},46700:(t,e,i)=>{var s={"./af":42786,"./af.js":42786,"./ar":30867,"./ar-dz":14130,"./ar-dz.js":14130,"./ar-kw":96135,"./ar-kw.js":96135,"./ar-ly":56440,"./ar-ly.js":56440,"./ar-ma":47702,"./ar-ma.js":47702,"./ar-sa":16040,"./ar-sa.js":16040,"./ar-tn":37100,"./ar-tn.js":37100,"./ar.js":30867,"./az":31083,"./az.js":31083,"./be":9808,"./be.js":9808,"./bg":68338,"./bg.js":68338,"./bm":67438,"./bm.js":67438,"./bn":8905,"./bn-bd":76225,"./bn-bd.js":76225,"./bn.js":8905,"./bo":11560,"./bo.js":11560,"./br":1278,"./br.js":1278,"./bs":80622,"./bs.js":80622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":50877,"./cv.js":50877,"./cy":47373,"./cy.js":47373,"./da":24780,"./da.js":24780,"./de":59740,"./de-at":60217,"./de-at.js":60217,"./de-ch":60894,"./de-ch.js":60894,"./de.js":59740,"./dv":5300,"./dv.js":5300,"./el":50837,"./el.js":50837,"./en-au":78348,"./en-au.js":78348,"./en-ca":77925,"./en-ca.js":77925,"./en-gb":22243,"./en-gb.js":22243,"./en-ie":46436,"./en-ie.js":46436,"./en-il":47207,"./en-il.js":47207,"./en-in":44175,"./en-in.js":44175,"./en-nz":76319,"./en-nz.js":76319,"./en-sg":31662,"./en-sg.js":31662,"./eo":92915,"./eo.js":92915,"./es":55655,"./es-do":55251,"./es-do.js":55251,"./es-mx":96112,"./es-mx.js":96112,"./es-us":71146,"./es-us.js":71146,"./es.js":55655,"./et":5603,"./et.js":5603,"./eu":77763,"./eu.js":77763,"./fa":76959,"./fa.js":76959,"./fi":11897,"./fi.js":11897,"./fil":42549,"./fil.js":42549,"./fo":94694,"./fo.js":94694,"./fr":94470,"./fr-ca":63049,"./fr-ca.js":63049,"./fr-ch":52330,"./fr-ch.js":52330,"./fr.js":94470,"./fy":5044,"./fy.js":5044,"./ga":29295,"./ga.js":29295,"./gd":2101,"./gd.js":2101,"./gl":38794,"./gl.js":38794,"./gom-deva":27884,"./gom-deva.js":27884,"./gom-latn":23168,"./gom-latn.js":23168,"./gu":95349,"./gu.js":95349,"./he":24206,"./he.js":24206,"./hi":30094,"./hi.js":30094,"./hr":30316,"./hr.js":30316,"./hu":22138,"./hu.js":22138,"./hy-am":11423,"./hy-am.js":11423,"./id":29218,"./id.js":29218,"./is":90135,"./is.js":90135,"./it":90626,"./it-ch":10150,"./it-ch.js":10150,"./it.js":90626,"./ja":39183,"./ja.js":39183,"./jv":24286,"./jv.js":24286,"./ka":12105,"./ka.js":12105,"./kk":47772,"./kk.js":47772,"./km":18758,"./km.js":18758,"./kn":79282,"./kn.js":79282,"./ko":33730,"./ko.js":33730,"./ku":1408,"./ku.js":1408,"./ky":33291,"./ky.js":33291,"./lb":36841,"./lb.js":36841,"./lo":55466,"./lo.js":55466,"./lt":57010,"./lt.js":57010,"./lv":37595,"./lv.js":37595,"./me":39861,"./me.js":39861,"./mi":35493,"./mi.js":35493,"./mk":95966,"./mk.js":95966,"./ml":87341,"./ml.js":87341,"./mn":5115,"./mn.js":5115,"./mr":10370,"./mr.js":10370,"./ms":9847,"./ms-my":41237,"./ms-my.js":41237,"./ms.js":9847,"./mt":72126,"./mt.js":72126,"./my":56165,"./my.js":56165,"./nb":64924,"./nb.js":64924,"./ne":16744,"./ne.js":16744,"./nl":93901,"./nl-be":59814,"./nl-be.js":59814,"./nl.js":93901,"./nn":83877,"./nn.js":83877,"./oc-lnc":92135,"./oc-lnc.js":92135,"./pa-in":15858,"./pa-in.js":15858,"./pl":64495,"./pl.js":64495,"./pt":89520,"./pt-br":57971,"./pt-br.js":57971,"./pt.js":89520,"./ro":96459,"./ro.js":96459,"./ru":21793,"./ru.js":21793,"./sd":40950,"./sd.js":40950,"./se":10490,"./se.js":10490,"./si":90124,"./si.js":90124,"./sk":64249,"./sk.js":64249,"./sl":14985,"./sl.js":14985,"./sq":51104,"./sq.js":51104,"./sr":49131,"./sr-cyrl":79915,"./sr-cyrl.js":79915,"./sr.js":49131,"./ss":85893,"./ss.js":85893,"./sv":98760,"./sv.js":98760,"./sw":91172,"./sw.js":91172,"./ta":27333,"./ta.js":27333,"./te":23110,"./te.js":23110,"./tet":52095,"./tet.js":52095,"./tg":27321,"./tg.js":27321,"./th":9041,"./th.js":9041,"./tk":19005,"./tk.js":19005,"./tl-ph":75768,"./tl-ph.js":75768,"./tlh":89444,"./tlh.js":89444,"./tr":72397,"./tr.js":72397,"./tzl":28254,"./tzl.js":28254,"./tzm":51106,"./tzm-latn":30699,"./tzm-latn.js":30699,"./tzm.js":51106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":67691,"./uk.js":67691,"./ur":13795,"./ur.js":13795,"./uz":6791,"./uz-latn":60588,"./uz-latn.js":60588,"./uz.js":6791,"./vi":65666,"./vi.js":65666,"./x-pseudo":14378,"./x-pseudo.js":14378,"./yo":75805,"./yo.js":75805,"./zh-cn":83839,"./zh-cn.js":83839,"./zh-hk":55726,"./zh-hk.js":55726,"./zh-mo":99807,"./zh-mo.js":99807,"./zh-tw":74152,"./zh-tw.js":74152};function n(t){var e=a(t);return i(e)}function a(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}n.keys=function(){return Object.keys(s)},n.resolve=a,t.exports=n,n.id=46700},99391:t=>{t.exports=class{get key(){return"activelist"}constructor(t,e){t.Label,t.labels,t.unique(this.key);var i={name:this.key};this.view=this.key,this._logic={},webix.protoUI(i,webix.ui.list,webix.ActiveContent)}}},60183:t=>{t.exports=class{get key(){return"countfooter"}constructor(t,e){t.Label,this.view=this.key,this._logic={},webix.ui.datafilter.countColumn=webix.extend({refresh:function(t,e,i){var s=0;(t.find({})||[]).forEach((t=>{if(null!=t){var e=t[i.columnId]||t[i.columnId+"__relation"];e&&Array.isArray(e)?s+=e.length:null!=e&&""!=e&&0!=e&&"false"!=e&&"0"!=e&&(s+=1)}})),e.innerHTML=s}},webix.ui.datafilter.summColumn)}}},12864:(t,e,i)=>{var s=[i(99391),i(60183),i(68362),i(16944),i(10511),i(41471),i(56562),i(29008),i(84756),i(43774),i(17943),i(64603),i(45835)];t.exports=class{constructor(){}initComponents(t){t.custom=t.custom||{},s.forEach((e=>{var i=new e(t);t.custom[i.key]=i})),t.AB.custom=t.custom}}},68362:t=>{t.exports=class{get key(){return"datetimepicker"}constructor(t){t.Label,t.labels,t.unique(this.key),t.unique("custom_datetimepicker"),this.view=this.key,this._logic={},webix.editors.$popup.datetime={view:"popup",width:250,height:250,padding:0,body:{view:"calendar",icons:!0,borderless:!0,timepicker:!0}},webix.editors.datetime=webix.extend({popupType:"datetime"},webix.editors.date)}}},16944:t=>{t.exports=class{get key(){return"editlist"}constructor(t){t.Label,t.labels,t.unique(this.key);var e={name:this.key};this.view=this.key,this._logic={},webix.protoUI(e,webix.EditAbility,webix.ui.list)}}},10511:t=>{t.exports=class{get key(){return"edittree"}constructor(t){t.Label,t.labels,t.unique(this.key);var e={name:this.key};this.view=this.key,this._logic={},webix.protoUI(e,webix.EditAbility,webix.ui.tree)}}},41471:t=>{t.exports=class{get key(){return"editunitlist"}constructor(t){var e={name:this.key};this.view=this.key,this._logic={},webix.protoUI(e,webix.EditAbility,webix.ui.unitlist)}}},56562:t=>{t.exports=class{get key(){return"focusabletemplate"}constructor(t){t.Label,t.labels,t.unique(this.key);var e={name:this.key,focus:function(){return!1}};this.view=this.key,this._logic={},webix.protoUI(e,webix.ui.template,webix.UIManager)}}},29008:(t,e,i)=>{var s=i(73686);t.exports=class extends s{get key(){return"formiopreview"}constructor(t){super(),t.Label,t.labels,t.unique(this.key);var e={name:this.key,defaults:{css:"scrolly",borderless:!0},$init:function(t){var e=t.formComponents?t.formComponents:{},i=t.formData?t.formData:{};for(var s in i)if(Array.isArray(i[s])&&"object"==typeof i[s][0]){var n=[];i[s].forEach((t=>{t.id&&n.push(t.id)})),i[s]=n}Formio.createForm(this.$view,e,{}).then((function(s){s.submission={data:i},(e.components||[]).forEach((e=>{"button"==e.type&&"event"==e.action&&e.event&&s.once(e.event,(function(i){t.onButton&&t.onButton(e.event)}))}))}))}};this.view=this.key,this._logic={},webix.protoUI(e,webix.ui.view)}}},84756:t=>{t.exports=class{get key(){return"numbertext"}constructor(t){t.Label,t.labels,t.unique(this.key);var e={name:this.key,defaults:{css:"webix_el_text"},$getValue:function(){var t=this.getInputNode().value;return t?JSON.parse(t):""}};this.view=this.key,this._logic={},webix.protoUI(e,webix.ui.text)}}},43774:t=>{t.exports=class{get key(){return"thaicalendar"}constructor(t){this.view=this.key;const e=webix.i18n,i={name:this.key,defaults:{calendarHeader:function(t){return`${e.calendar.monthFull[t.getMonth()]} ${t.getFullYear()+543}`}}};webix.ui.calendar.$protoWait[0]._zoom_logic&&(i._zoom_logic=AB.cloneDeep(webix.ui.calendar.$protoWait[0]._zoom_logic),i._zoom_logic[1]=Object.assign(i._zoom_logic[1],{_getTitle:this._getYearTitle}),i._zoom_logic[2]=Object.assign(i._zoom_logic[2],{_getTitle:this._getYearRangeTitle,_getContent:this._getYearContent,_setContent:this._setYear})),webix.ui.calendar.$protoWait[0].Qd&&(i.Qd=AB.cloneDeep(webix.ui.calendar.$protoWait[0].Qd),i.Qd[1]=Object.assign(i.Qd[1],{Jv:this._getYearTitle}),i.Qd[2]=Object.assign(i.Qd[2],{Jv:this._getYearRangeTitle,Zv:this._getYearContent,Xv:this._setYear})),webix.protoUI(i,webix.ui.calendar),webix.editors.$popup.thaidate={view:"popup",width:250,height:250,padding:0,body:{view:this.key,icons:!0,borderless:!0,timepicker:!1}},webix.editors.$popup.thaidatetime={view:"popup",width:250,height:250,padding:0,body:{view:this.key,icons:!0,borderless:!0,timepicker:!0}},webix.editors.thaidate=webix.extend({popupType:"thaidate"},webix.editors.date),webix.editors.thaidatetime=webix.extend({popupType:"thaidatetime"},webix.editors.date)}_getYearTitle(t){return t.getFullYear()+543}_getYearRangeTitle(t,e){let i=t.getFullYear()+543;return e._zoom_start_date=i=i-i%10-1,i+" - "+(i+10+1)}_getYearContent(t,e){return e._zoom_start_date+t}_setYear(t,e,i){t.setFullYear(i._zoom_start_date-543+e)}}},17943:t=>{t.exports=class{get key(){return"timepicker"}constructor(t){t.Label,t.labels,t.unique(this.key),t.unique("custom_timepicker"),this.view=this.key,this._logic={},webix.editors.$popup.time={view:"popup",body:{view:"calendar",width:220,height:200,type:"time"}},webix.editors.time=webix.extend({popupType:"time"},webix.editors.date)}}},64603:t=>{t.exports=class{get key(){return"totalfooter"}constructor(t,e){t.Label,this.view=this.key,this._logic={},webix.ui.datafilter.totalColumn=webix.extend({refresh:function(t,e,i){var s=0;t.eachRow((function(e){var n=t.getItem(e),a=i.field.format(n);a&&(s+=parseFloat(a))})),e.innerHTML=s}},webix.ui.datafilter.summColumn)}}},45835:t=>{t.exports=class{get key(){return"treesuggest"}constructor(t){t.Label,t.labels,t.unique(this.key);var e={name:this.key,defaults:{type:"tree",width:0,body:{borderless:!0,select:!0,template:function(t,e){return"<span>"+(t.$count?"<b>"+t.value+"</b>":t.value)+"</span>"},ready:function(){this.openAll()},on:{onAfterSelect:function(t,e){this.getItem(t).$count&&(this.getParentView().setMasterValue(""),this.show($$(this.getParentView().config.master).getInputNode()))}}}}};this.view=this.key,this._logic={},webix.protoUI(e,webix.ui.suggest)}}},93414:()=>{},70172:()=>{},2001:()=>{},33779:()=>{},66558:()=>{},82258:()=>{}}]);
//# sourceMappingURL=402.133034dfb86f4edfdb4f.js.map